<!DOCTYPE html>
<!--
  The AI Startup Game
  ====================
  Â© 2025 Ammon Salter, Stefano Baruffaldi, Federico Bignone
  
  Lead Author: Ammon Salter (Warwick Business School, The University of Warwick)
  Contributors: Stefano Baruffaldi (Politecnico di Milano), Federico Bignone (Warwick Business School, The University of Warwick)
  AI Assistants: Claude (Anthropic), Gemini (Google), ChatGPT & GPT-5 (OpenAI)
  
  Citation: Salter, A., Baruffaldi, S., & Bignone, F. (2025). The AI Startup Game. 
    https://github.com/[repository]
  
  Licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 
  International License (CC BY-NC-SA 4.0).
  
  You are free to:
    - Share: copy and redistribute the material in any medium or format
    - Adapt: remix, transform, and build upon the material
  
  Under the following terms:
    - Attribution: You must give appropriate credit to the creators
    - NonCommercial: You may not use the material for commercial purposes
    - ShareAlike: If you remix or transform, you must distribute under the same license
  
  Full license: https://creativecommons.org/licenses/by-nc-sa/4.0/
  
  This game was developed as part of the ESRC-funded project:
  "Profiting from Science: the development and valuation of Artificial Intelligence 
  new ventures and engagement with the science base"
  Grant Reference: ES/X003949/1
  Principal Investigator: Ammon Salter (Warwick Business School, The University of Warwick)
  Co-Investigator: Stefano Baruffaldi (Politecnico di Milano)
  Lead Researcher: Federico Bignone (Warwick Business School, The University of Warwick)
  
  Contributors: Paola Criscuolo, Linus Dahlander, Christos Kolympiris, Orietta Marsili, Rossella Salandra, Philipp Lucas WÃ¤hler, Giacomo Salter, Suki Salter
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The AI Startup Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3Q4006G31G"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-3Q4006G31G');
    
    // Custom game event tracking
    function trackGameEvent(eventName, eventData = {}) {
      gtag('event', eventName, eventData);
    }
  </script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { 
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      -webkit-tap-highlight-color: transparent;
    }
    
    /* Global touch improvements */
    button, a, [onclick] {
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    
    /* Hiring cards - large and readable */
    .hire-card {
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .hire-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    }
    .hire-card.selected {
      border-color: #22c55e !important;
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%) !important;
    }
    
    /* Executive portraits */
    .exec-portrait {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
    }
    .exec-portrait img, .exec-portrait svg { width: 100%; height: 100%; object-fit: cover; }
    
    .exec-portrait-lg {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
    }
    .exec-portrait-lg img, .exec-portrait-lg svg { width: 100%; height: 100%; object-fit: cover; }
    
    /* Line clamp for truncating text */
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    /* Thicker border for founder portraits */
    .border-3 {
      border-width: 3px;
    }
    .border-l-3 {
      border-left-width: 3px;
    }
    
    /* Fade in animation for modals */
    .animate-fade-in {
      animation: fadeInUp 0.2s ease-out;
    }
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Mood indicators */
    .mood-ring {
      position: absolute;
      inset: -3px;
      border-radius: 50%;
      border: 3px solid transparent;
    }
    .mood-happy .mood-ring { border-color: #22c55e; box-shadow: 0 0 12px #22c55e40; }
    .mood-neutral .mood-ring { border-color: #64748b; }
    .mood-frustrated .mood-ring { border-color: #f59e0b; box-shadow: 0 0 12px #f59e0b40; }
    .mood-upset .mood-ring { border-color: #ef4444; box-shadow: 0 0 12px #ef444440; }
    
    /* Decision cards - the main event */
    .decision-card {
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .decision-card:hover {
      background-color: #f8fafc;
      border-color: #94a3b8;
    }
    .decision-card.selected {
      background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
      border-color: #10b981;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }
    
    /* Pivot choice cards - enhanced transitions */
    .choice-card {
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .choice-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    .choice-card.selected {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);
    }
    
    /* Info button for pivot modals */
    .info-btn { 
      width: 22px; 
      height: 22px; 
      border-radius: 50%; 
      background: #e2e8f0; 
      color: #64748b; 
      font-size: 12px;
      display: inline-flex; 
      align-items: center; 
      justify-content: center;
      cursor: pointer; 
      transition: all 0.15s;
      border: none;
    }
    .info-btn:hover { 
      background: #cbd5e1; 
      color: #334155; 
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    /* News ticker */
    .news-ticker {
      background: linear-gradient(90deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
      overflow: hidden;
      white-space: nowrap;
    }
    .news-ticker-content {
      display: inline-block;
      animation: ticker 40s linear infinite;
    }
    @keyframes ticker {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    
    /* Market badges */
    .market-positive { background: #dcfce7; color: #166534; border: 1px solid #86efac; }
    .market-negative { background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }
    .market-neutral { background: #f1f5f9; color: #475569; border: 1px solid #cbd5e1; }
    
    /* Shock modal */
    .shock-overlay { animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes float-up {
      0% { transform: translateY(0) translateX(-50%); opacity: 1; }
      100% { transform: translateY(-50px) translateX(-50%); opacity: 0; }
    }
    
    /* Stat pills */
    .stat-pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 9999px;
      font-size: 11px;
      font-weight: 500;
    }
    
    /* Conference mini-game */
    .conf-delegate {
      position: absolute;
      bottom: 48px;
      transition: transform 0.1s ease;
      cursor: pointer;
      pointer-events: auto;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    .conf-delegate:hover, .conf-delegate:active {
      transform: scale(1.15);
    }
    .conf-delegate.interested {
      animation: delegateBounce 0.3s ease infinite;
    }
    .conf-delegate.disgusted {
      animation: delegateShake 0.3s ease;
    }
    .conf-delegate.converting {
      animation: delegateJump 0.4s ease;
    }
    .conf-delegate.leaving-angry {
      animation: delegateStorm 0.5s ease forwards;
    }
    @keyframes delegateBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
    }
    @keyframes delegateShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-3px); }
      75% { transform: translateX(3px); }
    }
    @keyframes delegateJump {
      0% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-15px) scale(1.2); }
      100% { transform: translateY(0) scale(1); opacity: 0; }
    }
    @keyframes delegateStorm {
      0% { transform: translateX(0); }
      100% { transform: translateX(100px); opacity: 0; }
    }
    @keyframes delegateWalk {
      0%, 100% { transform: translateY(0) rotate(-2deg); }
      50% { transform: translateY(-2px) rotate(2deg); }
    }
    .conf-delegate.walking {
      animation: delegateWalk 0.25s ease infinite;
    }
    .conf-action-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    .conf-action-btn:active:not(:disabled) {
      transform: scale(0.95);
    }
    .conf-effect {
      position: absolute;
      pointer-events: none;
      animation: effectPop 0.5s ease forwards;
    }
    @keyframes effectPop {
      0% { transform: translateY(0) scale(0.5); opacity: 1; }
      100% { transform: translateY(-30px) scale(1.1); opacity: 0; }
    }
    .conf-wave {
      position: absolute;
      border-radius: 50%;
      border: 3px solid #3b82f6;
      animation: waveExpand 0.6s ease forwards;
    }
    @keyframes waveExpand {
      0% { transform: scale(0.5); opacity: 1; }
      100% { transform: scale(2.5); opacity: 0; }
    }
    .conf-rival-action {
      animation: rivalPulse 0.5s ease;
    }
    @keyframes rivalPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); filter: brightness(1.2); }
    }
    
    /* Pitch mini-game styles */
    .pitch-action-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    .pitch-action-btn:active:not(:disabled) {
      transform: scale(0.95);
    }
    .pitch-effect {
      position: absolute;
      pointer-events: none;
      animation: pitchEffectPop 0.6s ease forwards;
      font-size: 20px;
      font-weight: bold;
    }
    @keyframes pitchEffectPop {
      0% { transform: translateY(0) scale(0.5); opacity: 1; }
      100% { transform: translateY(-40px) scale(1.2); opacity: 0; }
    }
    .pitch-investor {
      transition: all 0.3s ease;
    }
    .pitch-investor.interested {
      transform: scale(1.1);
    }
    .pitch-investor.bored {
      opacity: 0.6;
    }
    .pitch-investor.excited {
      animation: investorExcited 0.5s ease infinite;
    }
    @keyframes investorExcited {
      0%, 100% { transform: scale(1.1); }
      50% { transform: scale(1.15); }
    }
    .pitch-presenter-action {
      animation: presenterAction 0.3s ease;
    }
    @keyframes presenterAction {
      0%, 100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.2); }
    }
    .pitch-attention-pulse {
      animation: attentionPulse 0.3s ease;
    }
    @keyframes attentionPulse {
      0%, 100% { transform: scaleX(1); }
      50% { transform: scaleX(1.02); }
    }
    
    /* Mini-game intro transition */
    .minigame-intro-overlay {
      animation: introFadeIn 0.4s ease;
    }
    @keyframes introFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .minigame-intro-card {
      animation: introSlideUp 0.5s ease;
    }
    @keyframes introSlideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .minigame-intro-icon {
      animation: introPulse 2s ease-in-out infinite;
    }
    @keyframes introPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    .minigame-intro-glow {
      animation: introGlow 1.5s ease-in-out infinite alternate;
    }
    @keyframes introGlow {
      from { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
      to { box-shadow: 0 0 40px rgba(59, 130, 246, 0.6); }
    }
    .minigame-start-btn {
      transition: all 0.2s ease;
    }
    .minigame-start-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }
    .minigame-start-btn:active {
      transform: scale(0.98);
    }
    
    /* Investor confrontation modal */
    .confrontation-overlay {
      animation: confrontFadeIn 0.3s ease;
    }
    @keyframes confrontFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .confrontation-card {
      animation: confrontSlideDown 0.4s ease;
    }
    @keyframes confrontSlideDown {
      from { transform: translateY(-30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .confrontation-shake {
      animation: confrontShake 0.5s ease;
    }
    @keyframes confrontShake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      60% { transform: translateX(-5px); }
      80% { transform: translateX(5px); }
    }
    .investor-angry {
      animation: angryPulse 1s ease-in-out infinite;
    }
    @keyframes angryPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
      50% { box-shadow: 0 0 20px 5px rgba(239, 68, 68, 0.4); }
    }
    
    /* Decision feedback transition */
    .feedback-overlay {
      animation: feedbackFadeIn 0.4s ease;
    }
    @keyframes feedbackFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .feedback-card {
      animation: feedbackSlideIn 0.5s ease;
    }
    @keyframes feedbackSlideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .feedback-item {
      animation: feedbackItemIn 0.3s ease backwards;
    }
    .feedback-item:nth-child(1) { animation-delay: 0.1s; }
    .feedback-item:nth-child(2) { animation-delay: 0.25s; }
    .feedback-item:nth-child(3) { animation-delay: 0.4s; }
    .feedback-item:nth-child(4) { animation-delay: 0.55s; }
    @keyframes feedbackItemIn {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .feedback-exceeded {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border-left: 4px solid #10b981;
    }
    .feedback-met {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border-left: 4px solid #3b82f6;
    }
    .feedback-below {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-left: 4px solid #f59e0b;
    }
    .feedback-failed {
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      border-left: 4px solid #ef4444;
    }
    .feedback-pass {
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      border-left: 4px solid #94a3b8;
    }
    .milestone-contribution-bar {
      transition: width 0.8s ease-out;
    }
    @keyframes progressPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
      50% { box-shadow: 0 0 15px 3px rgba(16, 185, 129, 0.4); }
    }
    .progress-positive {
      animation: progressPulse 1s ease-in-out 2;
    }
    
    /* Sidebar Finance Card Styles */
    .sidebar-finance-card {
      transition: all 0.3s ease;
    }
    .sidebar-finance-card.runway-healthy {
      background: linear-gradient(135deg, #166534 0%, #15803d 100%);
      border-color: #22c55e;
    }
    .sidebar-finance-card.runway-ok {
      background: linear-gradient(135deg, #065f46 0%, #047857 100%);
      border-color: #10b981;
    }
    .sidebar-finance-card.runway-low {
      background: linear-gradient(135deg, #92400e 0%, #b45309 100%);
      border-color: #f59e0b;
    }
    .sidebar-finance-card.runway-critical {
      background: linear-gradient(135deg, #991b1b 0%, #b91c1c 100%);
      border-color: #ef4444;
      animation: criticalPulse 1.5s ease-in-out infinite;
    }
    .sidebar-finance-card.runway-profitable {
      background: linear-gradient(135deg, #0f766e 0%, #0d9488 100%);
      border-color: #14b8a6;
    }
    @keyframes criticalPulse {
      0%, 100% { 
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
      }
      50% { 
        box-shadow: 0 4px 25px rgba(239, 68, 68, 0.6);
      }
    }
    
    /* ===== MICRO-ANIMATION UTILITIES ===== */
    
    /* Pulse animation - for positive changes */
    @keyframes uiPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.04); }
      100% { transform: scale(1); }
    }
    .ui-pulse {
      animation: uiPulse 300ms ease-out;
    }
    
    /* Lift animation - for positive KPI changes */
    @keyframes uiLift {
      0% { transform: translateY(0); }
      40% { transform: translateY(-4px); }
      100% { transform: translateY(0); }
    }
    .ui-lift {
      animation: uiLift 400ms ease-out;
    }
    
    /* Shake animation - for negative changes (very subtle) */
    @keyframes uiShake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-3px); }
      40% { transform: translateX(3px); }
      60% { transform: translateX(-2px); }
      80% { transform: translateX(2px); }
    }
    .ui-shake {
      animation: uiShake 350ms ease-out;
    }
    
    /* Pop animation - for selection confirmation */
    @keyframes uiPop {
      0% { transform: scale(1); }
      30% { transform: scale(0.96); }
      100% { transform: scale(1); }
    }
    .ui-pop {
      animation: uiPop 200ms ease-out;
    }
    
    /* Fade animations */
    @keyframes uiFadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes uiFadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-8px); }
    }
    .ui-fade-in {
      animation: uiFadeIn 300ms ease-out forwards;
    }
    .ui-fade-out {
      animation: uiFadeOut 250ms ease-out forwards;
    }
    
    /* Slide animations */
    @keyframes uiSlideInRight {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes uiSlideOutLeft {
      from { opacity: 1; transform: translateX(0); }
      to { opacity: 0; transform: translateX(-20px); }
    }
    .ui-slide-in {
      animation: uiSlideInRight 350ms ease-out forwards;
    }
    .ui-slide-out {
      animation: uiSlideOutLeft 250ms ease-out forwards;
    }
    
    /* KPI highlight glows */
    .ui-glow-good {
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.4) !important;
      transition: box-shadow 0.3s ease;
    }
    .ui-glow-bad {
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.4) !important;
      transition: box-shadow 0.3s ease;
    }
    
    /* Decision card locked state */
    .decision-option {
      transition: all 0.25s ease;
      position: relative;
    }
    .decision-option.locked-out {
      opacity: 0.5;
      transform: scale(0.98);
      pointer-events: none;
    }
    .decision-option.locked-in {
      border-color: #10b981 !important;
      background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%) !important;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
    }
    .decision-option.locked-in .locked-badge {
      display: flex !important;
    }
    
    /* Toast notifications */
    .ui-toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 8px;
      pointer-events: none;
    }
    .ui-toast {
      background: rgba(30, 41, 59, 0.95);
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-family: ui-monospace, monospace;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      animation: toastIn 300ms ease-out forwards;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .ui-toast.toast-out {
      animation: toastOut 250ms ease-out forwards;
    }
    .ui-toast.toast-good { border-left: 3px solid #10b981; }
    .ui-toast.toast-bad { border-left: 3px solid #ef4444; }
    .ui-toast.toast-neutral { border-left: 3px solid #6366f1; }
    
    @keyframes toastIn {
      from { opacity: 0; transform: translateX(30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes toastOut {
      from { opacity: 1; transform: translateX(0); }
      to { opacity: 0; transform: translateX(30px); }
    }
    
    /* Quarter transition overlay */
    .quarter-transition-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.85);
      z-index: 60;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .quarter-transition-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }
    .quarter-results-card {
      background: white;
      border-radius: 16px;
      max-width: 480px;
      width: 90%;
      padding: 24px;
      transform: scale(0.95) translateY(20px);
      opacity: 0;
      transition: all 0.4s ease;
    }
    .quarter-transition-overlay.active .quarter-results-card {
      transform: scale(1) translateY(0);
      opacity: 1;
    }
    .result-line {
      opacity: 0;
      transform: translateX(-10px);
    }
    .result-line.revealed {
      opacity: 1;
      transform: translateX(0);
      transition: all 0.35s ease;
    }
    
    /* Number animation highlight */
    .animating-number {
      color: inherit;
    }
    
    /* Respect reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
      .ui-pulse, .ui-lift, .ui-shake, .ui-pop, 
      .ui-fade-in, .ui-fade-out, .ui-slide-in, .ui-slide-out,
      .ui-toast, .quarter-results-card, .result-line, .decision-option {
        animation: none !important;
        transition: none !important;
      }
      .ui-toast { opacity: 1; transform: none; }
      .quarter-results-card { opacity: 1; transform: none; }
      .result-line { opacity: 1; transform: none; }
    }
    
    /* ===== MOBILE RESPONSIVE STYLES ===== */
    
    /* Mobile-first base adjustments */
    @media (max-width: 768px) {
      /* Make body scroll properly */
      body {
        -webkit-overflow-scrolling: touch;
        overflow-x: hidden;
      }
      
      /* Header adjustments for mobile */
      header {
        padding: 0.5rem !important;
      }
      header .max-w-7xl {
        flex-direction: column;
        gap: 0.5rem;
      }
      header .gap-6 {
        gap: 0.5rem;
        flex-wrap: wrap;
        justify-content: center;
      }
      header .text-sm {
        font-size: 0.7rem;
      }
      
      /* Main container padding */
      .p-4 {
        padding: 0.75rem;
      }
      
      /* Exec row horizontal scroll on mobile */
      #execRow {
        flex-wrap: nowrap !important;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 0.5rem;
        justify-content: flex-start !important;
        gap: 0.5rem !important;
      }
      #execRow > div {
        flex-shrink: 0;
        min-width: 70px;
      }
      
      /* Exec portraits smaller on mobile */
      .exec-portrait {
        width: 44px;
        height: 44px;
      }
      .exec-portrait-lg {
        width: 60px;
        height: 60px;
      }
      
      /* Decision area takes full width */
      #decisionArea {
        min-height: 300px;
      }
      
      /* Choice cards more touch-friendly */
      .choice-card, [class*="choice"] {
        min-height: 60px;
        padding: 1rem !important;
      }
      
      /* AP tracker compact on mobile */
      #apTrackerContainer .grid-cols-3 {
        gap: 0.5rem;
      }
      #apTrackerContainer .text-2xl {
        font-size: 1.25rem;
      }
      
      /* Staff section compact */
      #staffInfoPanel {
        font-size: 0.7rem;
      }
      
      /* Sidebar becomes collapsible on mobile - hidden by default */
      aside.space-y-3 {
        display: none;
      }
      aside.space-y-3.mobile-visible {
        display: block;
      }
      
      /* Commit button larger touch target */
      #commitBtn {
        width: 100%;
        padding: 1rem !important;
        font-size: 1rem;
      }
      
      /* Modal adjustments for mobile */
      .fixed.inset-0 > div:first-child {
        max-height: 90vh;
        overflow-y: auto;
        margin: 1rem;
        max-width: calc(100vw - 2rem) !important;
      }
      
      /* Full screen modals on mobile */
      #preambleModal1, #preambleModal2, #tutorialModal, #ventureModal,
      #locationModal, #founderModal, #fundingModal, #funderModal,
      #milestoneModal, #hiringModal, #endModal {
        padding: 0.5rem !important;
      }
      #preambleModal1 > div, #preambleModal2 > div {
        padding: 1rem !important;
      }
      
      /* Preamble title smaller on mobile */
      #preambleModal1 h1 {
        font-size: 1.75rem !important;
      }
      
      /* Mini-game modals need full screen */
      #conferenceGameModal, #pitchGameModal, #demoDayModal {
        padding: 0.25rem !important;
      }
      #conferenceGameModal > div, #pitchGameModal > div, #demoDayModal > div {
        max-width: 100% !important;
        max-height: 100vh !important;
        border-radius: 0.5rem;
      }
      
      /* Conference game canvas sizing */
      #confCanvas, #confArena {
        max-width: 100% !important;
        height: 280px !important;
      }
      
      /* Pitch game responsive */
      .pitch-investor {
        width: auto !important;
        min-width: 60px;
        padding: 0.5rem !important;
      }
      .pitch-investor .text-4xl {
        font-size: 1.5rem;
      }
      .pitch-investor .text-xs {
        font-size: 0.6rem;
      }
      
      /* Decision choice buttons stack better */
      #decisionArea button {
        font-size: 0.875rem;
      }
      
      /* Milestone progress card */
      #milestoneCard {
        padding: 0.75rem !important;
      }
      
      /* Reduce text sizes */
      .text-xl {
        font-size: 1.1rem;
      }
      .text-lg {
        font-size: 1rem;
      }
      
      /* Touch-friendly tap targets */
      button, .clickable, [onclick] {
        min-height: 44px;
        min-width: 44px;
      }
      
      /* Help buttons stay small */
      button[title="How AP works"], 
      button[title="How staffing works"] {
        min-height: 20px;
        min-width: 20px;
      }
    }
    
    /* Tablet adjustments */
    @media (min-width: 769px) and (max-width: 1024px) {
      /* Sidebar narrower on tablet */
      aside.space-y-3 {
        max-width: 250px;
      }
      
      /* Exec portraits slightly smaller */
      .exec-portrait {
        width: 48px;
        height: 48px;
      }
    }
    
    /* Mobile toggle button for sidebar */
    .mobile-sidebar-toggle {
      display: none;
    }
    @media (max-width: 768px) {
      .mobile-sidebar-toggle {
        display: flex;
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        z-index: 40;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: white;
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        border: none;
        cursor: pointer;
      }
      .mobile-sidebar-toggle:active {
        transform: scale(0.95);
      }
    }
    
    /* Swipe hint animation */
    @keyframes swipeHint {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(-10px); }
    }
    .swipe-hint {
      animation: swipeHint 1.5s ease-in-out 2;
    }
    
    /* Mobile scroll shadows for horizontal scroll areas - mobile only */
    @media (max-width: 768px) {
      .mobile-scroll-container {
        position: relative;
      }
      .mobile-scroll-container::after {
        content: '';
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        width: 30px;
        background: linear-gradient(to right, transparent, white);
        pointer-events: none;
      }
    }
    
    /* Landscape phone adjustments */
    @media (max-height: 500px) and (orientation: landscape) {
      #preambleModal1 > div, #preambleModal2 > div {
        padding: 0.5rem !important;
      }
      #preambleModal1 h1 {
        font-size: 1.5rem !important;
        margin-bottom: 0.5rem !important;
      }
      .grid-cols-2.md\\:grid-cols-3 {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    /* iOS safe area support */
    @supports (padding-bottom: env(safe-area-inset-bottom)) {
      .mobile-sidebar-toggle {
        bottom: calc(1rem + env(safe-area-inset-bottom));
      }
      #commitBtn {
        margin-bottom: env(safe-area-inset-bottom);
      }
    }
    
    /* Custom range slider styling */
    input[type="range"].slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
    }
    
    input[type="range"].slider-thumb::-webkit-slider-runnable-track {
      height: 8px;
      background: linear-gradient(to right, #10b981, #475569, #f59e0b);
      border-radius: 4px;
    }
    
    input[type="range"].slider-thumb::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      cursor: pointer;
      margin-top: -6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      transition: transform 0.15s ease;
    }
    
    input[type="range"].slider-thumb::-webkit-slider-thumb:hover {
      transform: scale(1.1);
    }
    
    input[type="range"].slider-thumb::-moz-range-track {
      height: 8px;
      background: linear-gradient(to right, #10b981, #475569, #f59e0b);
      border-radius: 4px;
    }
    
    input[type="range"].slider-thumb::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    
    /* Revenue outlook slider (different gradient) */
    #revenueOutlookSlider::-webkit-slider-runnable-track {
      background: linear-gradient(to right, #ef4444, #eab308, #10b981);
    }
    
    #revenueOutlookSlider::-moz-range-track {
      background: linear-gradient(to right, #ef4444, #eab308, #10b981);
    }
  </style>
</head>
<body class="bg-slate-100 min-h-screen">

<!-- COMPACT HEADER -->
<header class="bg-slate-900 text-white py-2 px-4 shadow-lg">
  <div class="max-w-7xl mx-auto flex items-center justify-between">
    <div class="flex items-center gap-4">
      <div class="flex items-center gap-2">
        <h1 class="text-lg font-bold">The AI Startup Game</h1>
      </div>
      <div class="flex items-center gap-2">
        <!-- Founder Portrait -->
        <div id="founderPortraitHeader" class="w-10 h-10 rounded-full overflow-hidden border-2 border-slate-600 hidden"></div>
        <div id="companyLogo" class="w-6 h-6 hidden"></div>
        <div class="flex flex-col">
          <span id="companyDisplay" class="text-slate-400 text-sm">-</span>
          <span id="founderNameHeader" class="text-slate-500 text-[10px] hidden"></span>
        </div>
        <span id="locationDisplay" class="text-slate-500 text-xs hidden">ğŸ“ -</span>
      </div>
    </div>
    <div class="flex items-center gap-6 text-sm">
      <div id="extremeModeIndicator" class="hidden">
        <span class="px-2 py-1 bg-rose-600 text-white text-xs font-bold rounded-full animate-pulse">ğŸ”¥ EXTREME</span>
      </div>
      <div class="text-center group relative cursor-help" onclick="game.showHelp('quarter')">
        <div class="text-slate-400 text-[10px] uppercase">Quarter</div>
        <div id="turnDisplay" class="font-mono font-bold">Q1</div>
        <div id="chapterLabel" class="text-[9px] text-indigo-400 font-medium">Ch.1</div>
        <div class="hidden group-hover:block absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 p-2 bg-slate-800 text-white text-xs rounded-lg shadow-lg z-50">
          Game progresses in quarters. Make decisions, spend AP, burn cash. Complete 3 milestones to win!
        </div>
      </div>
      <div class="text-center group relative cursor-help" onclick="game.showHelp('cash')">
        <div class="text-slate-400 text-[10px] uppercase">Cash</div>
        <div id="headerCash" class="font-mono font-bold text-emerald-400">Â£0k</div>
        <div class="hidden group-hover:block absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 p-2 bg-slate-800 text-white text-xs rounded-lg shadow-lg z-50">
          Your available cash. Decreases by burn rate each quarter. Zero = game over! ğŸ’€
        </div>
      </div>
      <div class="text-center group relative cursor-help" onclick="game.showHelp('runway')">
        <div class="text-slate-400 text-[10px] uppercase">Runway</div>
        <div id="headerRunway" class="font-mono font-bold text-amber-400">0q</div>
        <div class="hidden group-hover:block absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 p-2 bg-slate-800 text-white text-xs rounded-lg shadow-lg z-50">
          Quarters until cash runs out (Cash Ã· Burn). Keep above 2! Raise funding or cut costs to extend.
        </div>
      </div>
      <div class="text-center group relative cursor-help" onclick="game.showHelp('valuation')">
        <div class="text-slate-400 text-[10px] uppercase">Valuation</div>
        <div id="headerVal" class="font-mono font-bold text-sky-400">Â£0k</div>
        <div class="hidden group-hover:block absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 p-2 bg-slate-800 text-white text-xs rounded-lg shadow-lg z-50">
          Your company's worth. Higher = better funding terms & exit options. Grows with milestones & metrics.
        </div>
      </div>
      <div class="text-center group relative cursor-help" onclick="game.showHelp('milestones')">
        <div class="text-slate-400 text-[10px] uppercase">Milestones</div>
        <div id="headerMilestones" class="font-mono font-bold">0/3</div>
        <div class="hidden group-hover:block absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 p-2 bg-slate-800 text-white text-xs rounded-lg shadow-lg z-50">
          Complete 3 milestones to win! Each has requirements & a deadline. Miss a deadline = game over! ğŸ¯
        </div>
      </div>
      <button onclick="game.showHelpModal()" class="p-2 hover:bg-slate-700 rounded-lg transition-colors" title="Help & Guide">
        <span>â“</span>
      </button>
      <button id="soundToggle" onclick="toggleSound()" class="p-2 hover:bg-slate-700 rounded-lg transition-colors" title="Toggle Sound">
        <span id="soundIcon">ğŸ”Š</span>
      </button>
    </div>
  </div>
</header>

<!-- NEWS TICKER -->
<div class="news-ticker py-1 text-xs text-slate-400">
  <div class="news-ticker-content">
    <span id="newsContent">UK tech sector shows steady growth â€¢ AI adoption continues â€¢ London retains European hub status â€¢ </span>
  </div>
</div>

<!-- MAIN GAME LAYOUT - Decisions are CENTER and LARGE -->
<main class="max-w-7xl mx-auto p-4">
  
  <!-- MILESTONE TRACKER - Top priority, always visible -->
  <div id="milestoneTracker" class="bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl shadow-sm p-4 border-2 border-amber-300 mb-4">
    <div class="flex items-center justify-between mb-2">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-amber-500 flex items-center justify-center text-white text-xl">ğŸ¯</div>
        <div>
          <div class="text-xs text-amber-600 font-medium uppercase tracking-wide">Current Milestone</div>
          <div id="milestoneLabel2" class="font-bold text-slate-800">None set</div>
        </div>
      </div>
      <div class="text-right flex items-center gap-3">
        <button id="strategicReviewBtn" onclick="game.showStrategicPivotModal()" class="hidden px-6 py-3 text-base bg-gradient-to-r from-violet-600 to-purple-700 hover:from-violet-500 hover:to-purple-600 text-white rounded-xl font-bold shadow-lg hover:shadow-xl transition-all transform hover:scale-105 animate-pulse" title="Consider changing strategic direction">
          ğŸ”„ Strategic Review
        </button>
        <div>
          <div class="text-2xl font-mono font-bold text-amber-600"><span id="milestoneProgress2">0</span>%</div>
          <div id="milestoneDeadline2" class="text-xs text-slate-500">-</div>
        </div>
      </div>
    </div>
    <div class="h-4 bg-white rounded-full overflow-hidden border border-amber-200 shadow-inner">
      <div id="milestoneBar2" class="h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all duration-500" style="width: 0%"></div>
    </div>
    <div id="milestoneHint" class="mt-2 text-xs text-amber-700 hidden">
      ğŸ’¡ Focus on: <span id="milestoneFocusAreas"></span>
    </div>
  </div>

  <div class="grid lg:grid-cols-[1fr_300px] gap-4">
    
    <!-- LEFT: THE BOARDROOM (Main focus) -->
    <div class="space-y-4">
      
      <!-- AP TRACKER - Redesigned -->
      <div id="apTrackerContainer" class="bg-white rounded-xl shadow-sm p-4 border border-slate-200">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2">
            <h2 class="font-bold text-slate-800">Attention Points</h2>
            <button onclick="game.showHelp('ap')" class="w-5 h-5 rounded-full bg-slate-200 hover:bg-slate-300 text-slate-500 text-xs flex items-center justify-center" title="How AP works">?</button>
          </div>
          <div class="text-xs text-slate-500">ğŸ’¡ Unused AP banks (max 2)</div>
        </div>
        
        <!-- Main display - three boxes -->
        <div id="apDisplayArea" class="bg-slate-100 rounded-lg p-3">
          <div class="grid grid-cols-3 gap-2 mb-3">
            <!-- Spent -->
            <div id="apSpentBox" class="bg-slate-200 rounded-lg p-2 text-center">
              <div id="apSpentNum" class="text-2xl font-bold text-slate-400">0</div>
              <div class="text-[10px] text-slate-500 font-medium uppercase tracking-wide">Spent</div>
            </div>
            <!-- Remaining - highlighted -->
            <div id="apLeftBox" class="bg-emerald-500 rounded-lg p-2 text-center shadow-md">
              <div id="apLeftNum" class="text-2xl font-bold text-white">5</div>
              <div id="apLeftLabel" class="text-[10px] text-emerald-100 font-medium uppercase tracking-wide">Left</div>
            </div>
            <!-- Banked -->
            <div id="apBankedBox" class="bg-slate-100 rounded-lg p-2 text-center border border-dashed border-slate-300">
              <div id="apBankedNum" class="text-2xl font-bold text-slate-300">0</div>
              <div class="text-[10px] text-slate-400 font-medium uppercase tracking-wide">Banked</div>
            </div>
          </div>
          
          <!-- Visual bar -->
          <div class="h-2 bg-slate-200 rounded-full overflow-hidden flex" id="apProgressBar">
            <div id="apBarSpent" class="bg-slate-400 h-full transition-all" style="width: 0%"></div>
            <div id="apBarBase" class="bg-emerald-500 h-full transition-all" style="width: 100%"></div>
            <div id="apBarBanked" class="bg-amber-400 h-full transition-all" style="width: 0%"></div>
            <div id="apBarOver" class="bg-red-500 h-full transition-all" style="width: 0%"></div>
          </div>
          <div class="flex justify-between text-[10px] text-slate-400 mt-1">
            <span id="apBaseDisplay">Base: 5 AP</span>
            <span>Est: <span id="estCost" class="font-medium">Â£0k</span></span>
            <span>Total: <span id="apTotalDisplay">5</span> AP</span>
          </div>
        </div>
        
        <div id="apWarning" class="mt-2 text-sm text-red-600 font-medium text-center hidden">
          âš  Over budget! Remove some choices.
        </div>
        
        <!-- OPPORTUNITY COST HINT - Updates based on player's choices -->
        <div id="opportunityCostHint" class="hidden mt-2 p-2 rounded-lg text-xs text-center">
          <span id="opportunityCostIcon">ğŸ’¡</span>
          <span id="opportunityCostText">Hint text here</span>
        </div>
        
        <!-- FOCUS INDICATOR - Shows when AP allocation is spread thin or focused -->
        <div id="focusIndicator" class="hidden mt-2 p-2 rounded-lg text-xs text-center">
          <span id="focusIndicatorIcon">ğŸ¯</span>
          <span id="focusIndicatorText">Focus status</span>
        </div>
        
        <!-- TEAM CAPACITY SECTION -->
        <div class="mt-4 pt-4 border-t border-slate-200">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-2">
              <span class="font-bold text-slate-800">Team Capacity</span>
              <button onclick="game.toggleStaffInfo()" class="w-5 h-5 rounded-full bg-slate-200 hover:bg-slate-300 text-slate-500 text-xs flex items-center justify-center" title="How staffing works">?</button>
            </div>
            <div id="staffAPBonusDisplay" class="px-2 py-1 rounded-full text-xs font-bold bg-indigo-100 text-indigo-700">+0 AP</div>
          </div>
          
          <!-- Visual Staff Display - AP Style -->
          <div class="bg-slate-100 rounded-lg p-3 mb-3">
            <div class="grid grid-cols-3 gap-2 mb-2">
              <!-- Staff Count -->
              <div class="bg-slate-200 rounded-lg p-2 text-center">
                <div id="staffCount" class="text-2xl font-bold text-slate-700">0</div>
                <div class="text-[10px] text-slate-500 font-medium uppercase tracking-wide">Staff</div>
              </div>
              <!-- AP Bonus - highlighted -->
              <div id="staffAPBox" class="bg-indigo-500 rounded-lg p-2 text-center shadow-md">
                <div id="staffAPValue" class="text-2xl font-bold text-white">+0</div>
                <div class="text-[10px] text-indigo-100 font-medium uppercase tracking-wide">AP Bonus</div>
              </div>
              <!-- Burn -->
              <div class="bg-slate-200 rounded-lg p-2 text-center">
                <div id="staffBurnImpact" class="text-2xl font-bold text-rose-600">Â£0k</div>
                <div class="text-[10px] text-slate-500 font-medium uppercase tracking-wide">Burn/Q</div>
              </div>
            </div>
            
            <!-- Progress to next tier -->
            <div class="h-1.5 bg-slate-200 rounded-full overflow-hidden">
              <div id="staffProgressBar" class="h-full bg-indigo-500 transition-all rounded-full" style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-[10px] text-slate-400 mt-1">
              <span id="staffTierCurrent">Lean team</span>
              <span id="staffTierNext">2 more â†’ +1 AP</span>
            </div>
          </div>
          
          <!-- Hidden: Staff icons for JS compatibility -->
          <div id="staffIconsRow" class="hidden"></div>
          
          <!-- Staff Info Panel (hidden by default) -->
          <div id="staffInfoPanel" class="hidden mb-3 p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs">
            <div class="font-bold text-slate-800 mb-3">ğŸ“Š How Staffing Works</div>
            
            <!-- AP Bonus Tiers -->
            <div class="mb-3">
              <div class="font-medium text-slate-700 mb-1">Hires â†’ Attention Points</div>
              <div class="text-slate-600 mb-2">Staff hired above your founding team increase capacity.</div>
              <div class="grid grid-cols-4 gap-1 text-center">
                <div class="bg-slate-200 rounded p-1"><div class="font-bold">0</div><div class="text-slate-500">+0 AP</div></div>
                <div class="bg-blue-100 rounded p-1"><div class="font-bold">1-2</div><div class="text-blue-700">+1 AP</div></div>
                <div class="bg-blue-200 rounded p-1"><div class="font-bold">3-4</div><div class="text-blue-700">+2 AP</div></div>
                <div class="bg-blue-300 rounded p-1"><div class="font-bold">5+</div><div class="text-blue-800">+3 AP</div></div>
              </div>
              <div class="text-xs text-slate-500 mt-1">Your first hire gives +1 AP (once integrated next quarter).</div>
            </div>
            
            <div id="staffUnlockNotice" class="mb-3 text-indigo-700 bg-indigo-50 p-2 rounded border border-indigo-200">
              ğŸ“‹ Post a job (1 AP) to attract candidates. Review applications and negotiate offers.
            </div>
            
            <!-- Hiring vs Firing comparison -->
            <div class="grid grid-cols-2 gap-2">
              <div class="bg-emerald-50 rounded p-2 border border-emerald-200">
                <div class="font-medium text-emerald-800 mb-1">â• Job Posting</div>
                <div class="space-y-0.5 text-emerald-700">
                  <div>â€¢ 1 AP to post</div>
                  <div>â€¢ Review 4-6 candidates</div>
                  <div>â€¢ Negotiate salary & equity</div>
                  <div class="text-emerald-600 italic">Find the right person for your team</div>
                </div>
              </div>
              <div class="bg-rose-50 rounded p-2 border border-rose-200">
                <div class="font-medium text-rose-800 mb-1">â– Layoffs</div>
                <div class="space-y-0.5 text-rose-700">
                  <div>â€¢ Â£40k severance cost</div>
                  <div>â€¢ âˆ’Â£25k/quarter burn</div>
                  <div>â€¢ âˆ’1 AP this quarter</div>
                  <div>â€¢ âˆ’1 morale all depts</div>
                  <div class="text-rose-600 italic">Painful but extends runway</div>
                </div>
              </div>
            </div>
            
            <!-- Strategic tips -->
            <div class="mt-3 pt-2 border-t border-slate-200 text-slate-500">
              <span class="font-medium">ğŸ’¡ Tip:</span> Hire before a big push, layoff when cash is tight. Both cause short-term disruption.
            </div>
          </div>
          
          <!-- Hire/Fire Action Buttons -->
          <div class="grid grid-cols-2 gap-2">
            <button id="hireBtn" onclick="game.showJobPostModal()" class="group relative overflow-hidden rounded-lg border-2 border-emerald-300 bg-gradient-to-b from-white to-emerald-50 hover:from-emerald-50 hover:to-emerald-100 transition-all p-2.5">
              <div class="flex items-center justify-center gap-2">
                <span class="w-7 h-7 rounded-full bg-emerald-500 text-white flex items-center justify-center text-sm font-bold group-hover:scale-110 transition-transform shadow-sm">+</span>
                <div class="text-left">
                  <div class="font-semibold text-emerald-800 text-sm">Post Job</div>
                  <div class="text-[10px] text-emerald-600">1 AP Â· Review candidates</div>
                </div>
              </div>
            </button>
            <button id="fireBtn" onclick="game.showFireStaffModal()" class="group relative overflow-hidden rounded-lg border-2 border-rose-300 bg-gradient-to-b from-white to-rose-50 hover:from-rose-50 hover:to-rose-100 transition-all p-2.5">
              <div class="flex items-center justify-center gap-2">
                <span class="w-7 h-7 rounded-full bg-rose-500 text-white flex items-center justify-center text-sm font-bold group-hover:scale-110 transition-transform shadow-sm">âˆ’</span>
                <div class="text-left">
                  <div class="font-semibold text-rose-800 text-sm">Layoff Staff</div>
                  <div class="text-[10px] text-rose-600">Â£40k Â· âˆ’Â£25k/q burn Â· âˆ’1 AP</div>
                </div>
              </div>
            </button>
          </div>
          
          <!-- Disruption warning (hiring integration or layoff reorganization) -->
          <div id="integrationNotice" class="hidden mt-2 text-xs text-amber-700 bg-amber-50 px-3 py-2 rounded-lg border border-amber-200">
            â³ <span id="disruptionText">Team disruption this quarter</span> <span class="font-medium">(âˆ’<span id="disruptionPenalty">1</span> AP)</span>. Normal capacity next Q.
          </div>
        </div>
      </div>
      
      <!-- EXECUTIVE ROW -->
      <div class="bg-white rounded-xl shadow-sm p-4 border border-slate-200">
        <div class="mobile-scroll-container overflow-x-auto lg:overflow-visible -mx-2 px-2">
          <div class="flex gap-2 justify-center lg:flex-wrap w-full" id="execRow">
          <!-- Rendered by JS -->
          </div>
        </div>
        
        <!-- Hired Staff Section -->
        <div id="hiredStaffSection" class="hidden mt-4 pt-4 border-t border-slate-200">
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-sm font-bold text-slate-600">ğŸ‘¥ Additional Team Members</h4>
            <span id="hiredStaffCount" class="text-xs text-slate-500"></span>
          </div>
          <div id="hiredStaffList" class="flex flex-wrap gap-2 justify-center">
            <!-- Rendered by JS -->
          </div>
        </div>
      </div>
      
      <!-- INVESTOR ADVICE PANEL - Shows what your investors recommend this quarter -->
      <div id="investorAdvicePanel" class="hidden bg-gradient-to-r from-violet-50 to-amber-50 rounded-xl shadow-sm border border-violet-200 p-4">
        <div id="investorAdviceContent">
          <!-- Fully populated by JS including header -->
        </div>
      </div>
      
      <!-- STRATEGIC FOCUS INDICATOR - Small badge showing current focus -->
      <div id="strategicFocusIndicator" class="hidden bg-slate-800 text-white rounded-lg px-3 py-2 text-center cursor-pointer hover:bg-slate-700 transition-all" onclick="game.showStrategicFocusModal()">
        <div class="text-[10px] uppercase tracking-wide text-slate-400">This Quarter's Focus</div>
        <div id="focusIndicatorText" class="font-bold text-sm">Not Set</div>
      </div>
      
      <!-- DECISION AREA - The main event (advisor opinions now integrated) -->
      <div id="decisionArea" class="bg-white rounded-xl shadow-lg border border-slate-200 min-h-[400px] overflow-hidden">
        <!-- Rendered by JS -->
      </div>
      
      <!-- Investor conflict warning (shown when applicable) -->
      <div id="conflictWarning" class="hidden bg-amber-100 rounded-xl p-3 border border-amber-300 text-sm text-amber-800">
        âš  <strong>Your investors disagree on this one.</strong> Pick the approach you believe in â€” investors understand you can't please everyone when advice conflicts.
      </div>
      
      <!-- COMMIT BAR -->
      <div class="bg-white rounded-xl shadow-sm p-4 border border-slate-200">
        <div class="flex items-center justify-center">
          <button id="commitBtn" disabled class="px-6 py-3 bg-slate-700 hover:bg-slate-800 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-bold rounded-xl text-sm uppercase tracking-wide transition-all">
            Commit Quarter â†’
          </button>
        </div>
      </div>
    </div>
    
    <!-- RIGHT SIDEBAR: Stats & Info -->
    <aside id="mobileSidebar" class="space-y-3 lg:block hidden lg:!block">
      
      <!-- SIDEBAR FINANCE CARD -->
      <div id="sidebarFinanceCard" class="sidebar-finance-card runway-healthy rounded-xl shadow-lg p-4 cursor-pointer hover:shadow-xl border-2 text-white" onclick="game.showFinanceDetailsModal()">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-bold text-sm flex items-center gap-2">
            ğŸ’° Finances
          </h3>
          <span id="sidebarFinanceStatus" class="text-[10px] px-2 py-0.5 rounded-full bg-white/20">Healthy</span>
        </div>
        
        <!-- Key stats -->
        <div class="grid grid-cols-2 gap-3 mb-3">
          <div class="text-center">
            <div class="text-[10px] text-white/70 uppercase">Cash</div>
            <div id="sidebarCash" class="font-bold font-mono text-lg">Â£420k</div>
          </div>
          <div class="text-center">
            <div class="text-[10px] text-white/70 uppercase">Runway</div>
            <div id="sidebarRunway" class="font-bold font-mono text-lg">8 QTR</div>
          </div>
        </div>
        
        <!-- Runway bar -->
        <div id="sidebarRunwayBar" class="flex gap-0.5 h-2 mb-2">
          <!-- 8 segments rendered by JS -->
        </div>
        
        <!-- Revenue row (shown when exists) -->
        <div id="sidebarRevenueRow" class="hidden pt-2 border-t border-white/20">
          <div class="flex justify-between text-xs">
            <span class="text-white/70">Revenue:</span>
            <span id="sidebarRevenue" class="font-mono">Â£0k/q</span>
          </div>
        </div>
        
        <div class="text-[10px] text-white/50 text-center mt-2">Click for details</div>
      </div>
      
      <!-- Company Health -->
      <div class="bg-white rounded-xl shadow-sm p-4 border border-slate-200">
        <h3 class="font-bold text-slate-800 text-sm mb-3">Company Health</h3>
        <div class="space-y-3">
          <div>
            <div class="flex justify-between text-xs mb-1">
              <span class="text-emerald-700 font-medium">ğŸ”¬ Research</span>
              <span id="sciScore" class="font-mono">10</span>
            </div>
            <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
              <div id="sciBar" class="h-full bg-emerald-500 rounded-full transition-all" style="width: 10%"></div>
            </div>
          </div>
          <div>
            <div class="flex justify-between text-xs mb-1">
              <span class="text-sky-700 font-medium">ğŸ’» Product</span>
              <span id="devScore" class="font-mono">10</span>
            </div>
            <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
              <div id="devBar" class="h-full bg-sky-500 rounded-full transition-all" style="width: 10%"></div>
            </div>
          </div>
          <div>
            <div class="flex justify-between text-xs mb-1">
              <span class="text-fuchsia-700 font-medium">ğŸ“£ Sales</span>
              <span id="mktScore" class="font-mono">10</span>
            </div>
            <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
              <div id="mktBar" class="h-full bg-fuchsia-500 rounded-full transition-all" style="width: 10%"></div>
            </div>
          </div>
          <div>
            <div class="flex justify-between text-xs mb-1">
              <span class="text-amber-700 font-medium">ğŸ‘¥ People</span>
              <span id="hrScore" class="font-mono">50</span>
            </div>
            <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
              <div id="hrBar" class="h-full bg-amber-500 rounded-full transition-all" style="width: 50%"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Milestone (hidden - using top tracker instead) -->
      <div class="hidden bg-white rounded-xl shadow-sm p-4 border border-slate-200">
        <h3 class="font-bold text-slate-800 text-sm mb-2">Current Milestone</h3>
        <p id="milestoneLabel" class="text-xs text-slate-600 mb-2">None set</p>
        <div class="h-3 bg-slate-100 rounded-full overflow-hidden mb-1">
          <div id="milestoneBar" class="h-full bg-amber-500 rounded-full transition-all" style="width: 0%"></div>
        </div>
        <div class="flex justify-between text-[10px] text-slate-400">
          <span id="milestoneProgress">0%</span>
          <span id="milestoneDeadline">-</span>
        </div>
      </div>
      
      <!-- Market -->
      <div class="bg-white rounded-xl shadow-sm p-4 border border-slate-200">
        <div class="flex items-center justify-between mb-2">
          <h3 class="font-bold text-slate-800 text-sm">Market</h3>
          <span id="marketBadge" class="stat-pill market-neutral">Stable</span>
        </div>
        <p id="marketDesc" class="text-xs text-slate-500">Business as usual.</p>
      </div>
      
      <!-- Progression Unlocks -->
      <div id="unlocksPanel" class="bg-gradient-to-r from-amber-50 to-yellow-50 rounded-xl shadow-sm p-4 border border-amber-200">
        <div class="flex items-center justify-between mb-2 cursor-pointer" onclick="game.toggleUnlocksPanel()">
          <h3 class="font-bold text-amber-800 text-sm">ğŸ† Progress</h3>
          <span id="unlocksCount" class="text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded-full">0/8</span>
        </div>
        <div id="unlocksList" class="space-y-1 text-xs">
          <!-- Rendered by JS -->
        </div>
      </div>
      
      <!-- Competition -->
      <div class="bg-white rounded-xl shadow-sm p-4 border border-slate-200">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-bold text-slate-800 text-sm">ğŸ Competition</h3>
          <span class="text-xs text-slate-500">Your Rank: <span id="playerRank" class="font-bold text-emerald-600">#1</span></span>
        </div>
        <div id="rivalsList" class="space-y-2"></div>
        <div id="rivalNews" class="mt-3 pt-2 border-t border-slate-100 text-[10px] text-slate-500 italic hidden"></div>
      </div>
      
      <!-- Legacy Financials (hidden - using sidebar finance card instead, kept for JS compatibility) -->
      <div id="legacyFinancialsCard" class="hidden bg-white rounded-xl shadow-sm p-4 border border-slate-200">
        <div class="flex justify-between items-center mb-2">
          <h3 class="font-bold text-slate-800 text-sm">Financials</h3>
          <button onclick="game.showProjectionsModal()" class="text-xs text-indigo-600 hover:text-indigo-800 hidden" id="projectionsBtn">
            ğŸ“ˆ Details
          </button>
        </div>
        <div class="grid grid-cols-2 gap-2 text-xs">
          <div><span class="text-slate-500">Revenue:</span> <span id="revenueDisplay" class="font-mono text-emerald-600">Â£0k/q</span></div>
          <div><span class="text-slate-500">Customers:</span> <span id="customerCountDisplay" class="font-mono">0</span></div>
          <div><span class="text-slate-500">Burn:</span> <span id="burnDisplay" class="font-mono">Â£0k/q</span></div>
          <div><span class="text-slate-500">Net:</span> <span id="netBurnDisplay" class="font-mono text-rose-600">-Â£0k/q</span></div>
          <div><span class="text-slate-500">Equity:</span> <span id="equityDisplay" class="font-mono">100%</span></div>
          <div><span class="text-slate-500">Runway:</span> <span id="runwayDisplay" class="font-mono">0q</span></div>
        </div>
        <!-- Projection status (hidden until revenue exists) -->
        <div id="projectionStatus" class="mt-2 pt-2 border-t border-slate-100 hidden">
          <div class="flex justify-between items-center text-xs">
            <span class="text-slate-500">vs Target:</span>
            <span id="projectionVariance" class="font-mono">â€”</span>
          </div>
        </div>
      </div>
      
      <!-- Log -->
      <div class="bg-white rounded-xl shadow-sm p-4 border border-slate-200">
        <h3 class="font-bold text-slate-800 text-sm mb-2">Log</h3>
        <div id="log" class="h-32 overflow-y-auto space-y-1 text-[11px] text-slate-600">
          <p class="text-slate-400">Your story begins...</p>
        </div>
      </div>
    </aside>
  </div>
  
  <!-- Mobile Stats Toggle Button -->
  <button id="mobileStatsToggle" class="mobile-sidebar-toggle" onclick="game.toggleMobileSidebar()" title="Show Stats">
    ğŸ“Š
  </button>
</main>

<!-- ==================== MODALS ==================== -->

<!-- Game Preamble / Introduction - Page 1 -->
<div id="preambleModal1" class="fixed inset-0 bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900 flex items-center justify-center z-50 p-4 overflow-y-auto">
  <div class="max-w-2xl w-full text-center my-auto">
    <!-- Header -->
    <div class="mb-8">
      <div class="text-7xl mb-4">ğŸš€</div>
      <h1 class="text-4xl md:text-5xl font-black text-white mb-3 tracking-tight">The AI Startup Game</h1>
      <p class="text-xl text-indigo-300 font-light">Can you build the next AI unicorn?</p>
    </div>
    
    <!-- The Quest -->
    <div class="bg-white/10 backdrop-blur rounded-2xl p-6 mb-8 border border-white/20 text-left">
      <p class="text-lg text-white leading-relaxed mb-4">
        It's 2026. AI may be the defining technology of our era.
      </p>
      <p class="text-slate-300 leading-relaxed mb-4">
        Economists call it a potential <em class="text-indigo-300">general purpose technology</em>â€”like steam, electricity, or computingâ€”capable of transforming every sector. But GPTs don't apply themselves. The value lies in identifying and exploiting opportunities: discovering solutions that weren't possible before, disrupting established industries, creating entirely new markets.
      </p>
      <p class="text-slate-300 leading-relaxed mb-4">
        Across the UK, a new generation of startups is racing to capture this value. Some spin out from world-leading AI labs, pushing the frontier of what's possible. Others bring deep domain expertiseâ€”in healthcare, finance, logistics, creative industriesâ€”and see exactly where AI could be transformative. All face the same challenge: turning potential into profit before the window closes.
      </p>
      <p class="text-slate-300 leading-relaxed mb-4">
        Now it's your turn. Choose your venture, assemble your team, and chase the ultimate prize: a billion-dollar unicorn.
      </p>
      <p class="text-indigo-200 font-medium text-center">
        The potential is enormous. So are the risks.<br>That's what makes it interestingâ€”and that's how you'll learn.
      </p>
    </div>
    
    <!-- CTA Buttons -->
    <div class="flex flex-col sm:flex-row justify-center gap-4 mb-6">
      <button onclick="soundManager.playRocketLaunch(); game.showPreamblePage2()" class="group px-10 py-5 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-400 hover:to-purple-500 text-white font-bold text-xl rounded-2xl shadow-lg shadow-indigo-500/30 hover:shadow-xl hover:shadow-indigo-500/40 transition-all transform hover:scale-105">
        Start Your Journey â†’
      </button>
      
      <button onclick="game.startTutorial()" class="group px-8 py-5 bg-white/10 hover:bg-white/20 text-white font-bold text-xl rounded-2xl border border-white/20 transition-all">
        ğŸ“š Tutorial
      </button>
    </div>
    
    <!-- Extreme Mode Toggle -->
    <div class="max-w-md mx-auto mb-6">
      <button id="extremeModeTogglePreamble" onclick="game.toggleExtremeMode()" class="w-full flex items-center justify-between p-3 rounded-xl border-2 border-slate-600 hover:border-rose-400 transition-all bg-slate-800/50 hover:bg-rose-900/30 group">
        <div class="flex items-center gap-3">
          <div class="text-left">
            <div class="font-bold text-white text-sm group-hover:text-rose-300 transition-colors">ğŸ”¥ Extreme Mode</div>
            <div class="text-xs text-slate-400 group-hover:text-rose-400 transition-colors">Hidden stats, no hints, less cash</div>
          </div>
        </div>
        <div id="extremeModeStatusPreamble" class="px-3 py-1 rounded-full text-xs font-medium bg-slate-700 text-slate-400">
          OFF
        </div>
      </button>
      <div id="extremeModeDetailsPreamble" class="hidden mt-2 p-3 bg-rose-900/50 rounded-lg border border-rose-500/50 text-xs text-left">
        <div class="text-rose-300 space-y-1">
          <div>â€¢ Hidden stat effects & impact tags</div>
          <div>â€¢ Silent advisors - no recommendations</div>
          <div>â€¢ Hidden strategic focus bonus</div>
          <div>â€¢ 20% less starting cash</div>
        </div>
      </div>
    </div>
    
    <p class="text-slate-400 text-sm mb-1">New to the game? The tutorial takes just 2 minutes.</p>
    <p class="text-slate-500 text-sm">Average game: 25-35 minutes</p>
    
    <!-- Learn More about UK AI Ecosystem -->
    <div class="mt-6 max-w-xl mx-auto">
      <button onclick="document.getElementById('ukAiEcosystem').classList.toggle('hidden'); this.querySelector('span').textContent = document.getElementById('ukAiEcosystem').classList.contains('hidden') ? 'â–¼' : 'â–²';" 
              class="w-full flex items-center justify-center gap-2 px-4 py-2 text-indigo-400 hover:text-indigo-300 text-sm transition-colors">
        <span>â–¼</span> Learn more about the UK AI ecosystem
      </button>
      <div id="ukAiEcosystem" class="hidden mt-3 bg-white/5 rounded-xl p-4 border border-white/10 text-left">
        <h4 class="text-white font-bold text-sm mb-3">ğŸ‡¬ğŸ‡§ UK AI Sector at a Glance <span class="font-normal text-slate-400">(DCMS 2024, Tech Nation 2025)</span></h4>
        <div class="grid grid-cols-2 gap-3 mb-4">
          <div class="bg-indigo-500/20 rounded-lg p-3 text-center">
            <div class="text-2xl font-bold text-indigo-300">~6,000</div>
            <div class="text-xs text-slate-400">AI companies</div>
            <div class="text-xs text-emerald-400">â†‘ 58% from 2023</div>
          </div>
          <div class="bg-emerald-500/20 rounded-lg p-3 text-center">
            <div class="text-2xl font-bold text-emerald-300">Â£23.9bn</div>
            <div class="text-xs text-slate-400">AI-related revenue</div>
            <div class="text-xs text-emerald-400">â†‘ 68% from 2023</div>
          </div>
          <div class="bg-violet-500/20 rounded-lg p-3 text-center">
            <div class="text-2xl font-bold text-violet-300">86,000+</div>
            <div class="text-xs text-slate-400">AI jobs</div>
            <div class="text-xs text-emerald-400">â†‘ 33% from 2023</div>
          </div>
          <div class="bg-amber-500/20 rounded-lg p-3 text-center">
            <div class="text-2xl font-bold text-amber-300">23</div>
            <div class="text-xs text-slate-400">AI unicorns</div>
            <div class="text-xs text-slate-500">avg 4.8 yrs to $1bn</div>
          </div>
        </div>
        
        <p class="text-xs text-slate-400 mb-3">The average UK AI unicorn reaches billion-dollar status in just <span class="text-white font-medium">4.8 years</span> (about <span class="text-white font-medium">19 quarters</span>)â€”faster than ever before.</p>
        
        <h5 class="text-white font-semibold text-xs mb-2 mt-4">ğŸ”¬ Research & Major Players</h5>
        <div class="text-xs text-slate-400 mb-3">
          <p class="mb-2">The UK is the <span class="text-white">third largest AI market globally</span>, after the US and China. World-class AI research spans universities across the countryâ€”from Edinburgh to Manchester, Warwick, Bristol, and Cardiffâ€”supported by the Alan Turing Institute as the national centre for AI and data science.</p>
          <p><span class="text-white">Google DeepMind</span>, founded in London in 2010, remains a global AI leader. <span class="text-white">Microsoft, Amazon, Meta, OpenAI, and Anthropic</span> all have significant and growing UK AI operations.</p>
        </div>
        
        <h5 class="text-white font-semibold text-xs mb-2">ğŸ¦„ Notable UK AI Unicorns</h5>
        <div class="grid grid-cols-2 gap-2 text-xs mb-3">
          <div class="bg-white/5 rounded p-2">
            <a href="https://wayve.ai/" target="_blank" class="text-white font-medium hover:text-indigo-300">Wayve</a>
            <span class="text-slate-500">â€” autonomous vehicles</span>
          </div>
          <div class="bg-white/5 rounded p-2">
            <a href="https://elevenlabs.io/" target="_blank" class="text-white font-medium hover:text-indigo-300">ElevenLabs</a>
            <span class="text-slate-500">â€” voice AI</span>
          </div>
          <div class="bg-white/5 rounded p-2">
            <a href="https://www.synthesia.io/" target="_blank" class="text-white font-medium hover:text-indigo-300">Synthesia</a>
            <span class="text-slate-500">â€” AI video</span>
          </div>
          <div class="bg-white/5 rounded p-2">
            <a href="https://www.quantexa.com/" target="_blank" class="text-white font-medium hover:text-indigo-300">Quantexa</a>
            <span class="text-slate-500">â€” decision intelligence</span>
          </div>
          <div class="bg-white/5 rounded p-2">
            <a href="https://stability.ai/" target="_blank" class="text-white font-medium hover:text-indigo-300">Stability AI</a>
            <span class="text-slate-500">â€” generative AI</span>
          </div>
          <div class="bg-white/5 rounded p-2">
            <a href="https://www.benevolent.com/" target="_blank" class="text-white font-medium hover:text-indigo-300">BenevolentAI</a>
            <span class="text-slate-500">â€” drug discovery</span>
          </div>
        </div>
        
        <div class="text-xs text-slate-400 space-y-2">
          <p>Many UK AI startups are <span class="text-white">university spinouts</span>â€”like PolyAI from Cambridgeâ€”while others bring deep domain expertise from healthcare, finance, or logistics to identify where AI can be transformative.</p>
          <p class="text-slate-500">Source: <a href="https://www.gov.uk/government/publications/artificial-intelligence-sector-study-2024" target="_blank" class="text-indigo-400 hover:text-indigo-300 underline">DCMS AI Sector Study 2024</a>, <a href="https://technation.io/uk-ai-companies/" target="_blank" class="text-indigo-400 hover:text-indigo-300 underline">Tech Nation</a></p>
        </div>
      </div>
    </div>
    
    <div class="mt-8 pt-4 border-t border-slate-700">
      <p class="text-slate-500 text-xs mb-2">A learning simulation inspired by practice, informed by research, and designed by academics for business students</p>
      <p class="text-slate-600 text-xs">Created by Ammon Salter, Stefano Baruffaldi & Federico Bignone</p>
      <p class="text-slate-600 text-xs mt-1">ESRC "Profiting from Science" [ES/X003949/1]</p>
      <p class="text-slate-600 text-xs mt-1">Â© 2026 Â· <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" class="text-indigo-400 hover:text-indigo-300 underline">CC BY-NC-SA 4.0</a></p>
    </div>
  </div>
</div>

<!-- Game Preamble / Introduction - Page 2 -->
<div id="preambleModal2" class="fixed inset-0 bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900 hidden items-center justify-center z-50 overflow-y-auto">
  <div class="max-w-4xl w-full mx-auto px-4 py-6">
    <!-- Header -->
    <div class="text-center mb-5">
      <h2 class="text-2xl font-bold text-white mb-1">How It Works</h2>
      <p class="text-indigo-300 text-sm">Every quarter, you'll make decisions that shape your startup's fate</p>
    </div>
    
    <!-- Six Pillars - 3x2 Grid -->
    <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-5">
      <!-- Attention Points -->
      <div class="bg-gradient-to-br from-emerald-500/20 to-teal-500/10 rounded-xl p-4 border border-emerald-500/30">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-10 h-10 rounded-lg bg-emerald-500 flex items-center justify-center text-white text-sm font-black">AP</div>
          <h3 class="text-sm font-bold text-white">Attention Points</h3>
        </div>
        <p class="text-slate-300 text-xs leading-relaxed">
          <span class="text-emerald-400 font-bold">5 AP per quarter.</span> You can't do everything-choose where to focus.
        </p>
      </div>
      
      <!-- Team -->
      <div class="bg-gradient-to-br from-blue-500/20 to-indigo-500/10 rounded-xl p-4 border border-blue-500/30">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-10 h-10 rounded-lg bg-blue-500 flex items-center justify-center text-lg">ğŸ‘¥</div>
          <h3 class="text-sm font-bold text-white">Your Team</h3>
        </div>
        <p class="text-slate-300 text-xs leading-relaxed">
          Recruit execs for <span class="text-blue-400 font-bold">Research, Product & Sales</span>. Keep them motivated.
        </p>
      </div>
      
      <!-- Investors -->
      <div class="bg-gradient-to-br from-violet-500/20 to-purple-500/10 rounded-xl p-4 border border-violet-500/30">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-10 h-10 rounded-lg bg-violet-500 flex items-center justify-center text-lg">ğŸ¦</div>
          <h3 class="text-sm font-bold text-white">Investors</h3>
        </div>
        <p class="text-slate-300 text-xs leading-relaxed">
          They offer cash for equity-but each has <span class="text-violet-400 font-bold">their own agenda</span>.
        </p>
      </div>
      
      <!-- Milestones -->
      <div class="bg-gradient-to-br from-amber-500/20 to-orange-500/10 rounded-xl p-4 border border-amber-500/30">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-10 h-10 rounded-lg bg-amber-500 flex items-center justify-center text-lg">ğŸ¯</div>
          <h3 class="text-sm font-bold text-white">Milestones</h3>
        </div>
        <p class="text-slate-300 text-xs leading-relaxed">
          Complete <span class="text-amber-400 font-bold">3 milestones</span> to win. Miss a deadline = game over.
        </p>
      </div>
      
      <!-- Competition -->
      <div class="bg-gradient-to-br from-pink-500/20 to-rose-500/10 rounded-xl p-4 border border-pink-500/30">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-10 h-10 rounded-lg bg-pink-500 flex items-center justify-center text-lg">âš”</div>
          <h3 class="text-sm font-bold text-white">Competition</h3>
        </div>
        <p class="text-slate-300 text-xs leading-relaxed">
          <span class="text-pink-400 font-bold">Rival startups</span> are racing toward the same goals. Don't fall behind.
        </p>
      </div>
      
      <!-- Strategic Pivots -->
      <div class="bg-gradient-to-br from-purple-500/20 to-violet-500/10 rounded-xl p-4 border border-purple-500/30">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-10 h-10 rounded-lg bg-purple-500 flex items-center justify-center text-lg">ğŸ”„</div>
          <h3 class="text-sm font-bold text-white">Strategic Pivots</h3>
        </div>
        <p class="text-slate-300 text-xs leading-relaxed">
          <span class="text-purple-400 font-bold">Change direction</span> when competitors get ahead or your strategy isn't working.
        </p>
      </div>
    </div>
    
    <!-- What Else -->
    <div class="bg-white/5 rounded-xl p-4 mb-5 border border-white/10">
      <h3 class="text-sm font-bold text-white mb-3 text-center">Plus: The Unexpected</h3>
      <div class="grid grid-cols-5 gap-3 text-center">
        <div>
          <div class="text-xl mb-1">âš¡</div>
          <div class="text-slate-300 text-xs">Market Shocks</div>
        </div>
        <div>
          <div class="text-xl mb-1">ğŸª</div>
          <div class="text-slate-300 text-xs">Trade Shows</div>
        </div>
        <div>
          <div class="text-xl mb-1">ğŸ˜¤</div>
          <div class="text-slate-300 text-xs">Team Moods</div>
        </div>
        <div>
          <div class="text-xl mb-1">ğŸ’·</div>
          <div class="text-slate-300 text-xs">Cash & Runway</div>
        </div>
        <div>
          <div class="text-xl mb-1">ğŸ’¼</div>
          <div class="text-slate-300 text-xs">HR Challenges</div>
        </div>
      </div>
    </div>
    
    <!-- CTAs -->
    <div class="flex flex-col sm:flex-row gap-3 justify-center items-center">
      <button onclick="game.backToPreamble1()" class="px-5 py-2 text-slate-400 hover:text-white transition-colors text-sm">
        â† Back
      </button>
      <button onclick="game.startFromPreamble()" class="group px-8 py-4 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-400 hover:to-teal-500 text-white font-bold text-lg rounded-xl shadow-lg shadow-emerald-500/30 hover:shadow-xl transition-all transform hover:scale-105">
        ğŸš€ Create Your Founder
        <span class="inline-block ml-2 group-hover:translate-x-1 transition-transform">â†’</span>
      </button>
    </div>
  </div>
</div>

<!-- Tutorial Type Selection -->
<div id="tutorialTypeModal" class="fixed inset-0 bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900 hidden items-center justify-center z-50">
  <div class="max-w-2xl w-full mx-auto px-4 py-8">
    <div class="text-center mb-8">
      <div class="text-6xl mb-4">ğŸ“š</div>
      <h1 class="text-3xl font-bold text-white mb-2">How Would You Like to Learn?</h1>
      <p class="text-slate-400">Choose the tutorial that fits your experience level</p>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <!-- Beginner Tutorial -->
      <button onclick="game.startBeginnerTutorial()" class="group bg-white/10 hover:bg-white/20 border-2 border-slate-500/50 hover:border-emerald-400 rounded-2xl p-6 text-left transition-all">
        <div class="flex items-center gap-4 mb-4">
          <div class="w-14 h-14 rounded-xl bg-emerald-500 flex items-center justify-center text-3xl">ğŸŒ±</div>
          <div>
            <h2 class="text-xl font-bold text-white">Full Tutorial</h2>
            <p class="text-emerald-400 text-sm">~10 minutes</p>
          </div>
        </div>
        <p class="text-slate-300 text-sm mb-4">Complete guide covering all aspects of the game, including deep dives into Research, Product, Sales, and HR management.</p>
        <div class="text-slate-500 text-xs">
          <span class="text-emerald-400">âœ“</span> 13 topics
          <span class="ml-3 text-emerald-400">âœ“</span> Departmental guides
          <span class="ml-3 text-emerald-400">âœ“</span> Best for first-time players
        </div>
      </button>
      
      <!-- Quick Tutorial -->
      <button onclick="game.startQuickTutorial()" class="group bg-white/10 hover:bg-white/20 border-2 border-slate-500/50 hover:border-amber-400 rounded-2xl p-6 text-left transition-all">
        <div class="flex items-center gap-4 mb-4">
          <div class="w-14 h-14 rounded-xl bg-amber-500 flex items-center justify-center text-3xl">âš¡</div>
          <div>
            <h2 class="text-xl font-bold text-white">Quick Start</h2>
            <p class="text-amber-400 text-sm">~3 minutes</p>
          </div>
        </div>
        <p class="text-slate-300 text-sm mb-4">Essential mechanics plus the key research concepts. Get playing fast!</p>
        <div class="text-slate-500 text-xs">
          <span class="text-amber-400">âœ“</span> 10 topics
          <span class="ml-3 text-amber-400">âœ“</span> Core mechanics + Research
          <span class="ml-3 text-amber-400">âœ“</span> For experienced gamers
        </div>
      </button>
    </div>
    
    <div class="text-center">
      <button onclick="game.skipTutorial()" class="text-slate-500 hover:text-slate-300 text-sm transition-colors">
        Skip tutorial entirely â†’
      </button>
    </div>
  </div>
</div>

<!-- Tutorial Hub - Menu-Based Learning -->
<div id="tutorialHubModal" class="fixed inset-0 bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900 hidden items-center justify-center z-50 overflow-y-auto">
  <div class="max-w-5xl w-full mx-auto px-4 py-6">
    <!-- Header -->
    <div class="text-center mb-6">
      <h1 class="text-3xl font-bold text-white mb-2" id="tutorialHubTitle">Learn the Game</h1>
      <p class="text-slate-400">Click any topic to learn more. Topics turn <span class="text-emerald-400">green</span> once read.</p>
      <div id="tutorialReadCounter" class="text-sm text-slate-500 mt-2">0 of 10 topics read</div>
    </div>
    
    <!-- Topic Grid -->
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 mb-6" id="tutorialTopicGrid">
      <!-- Topic cards generated by JavaScript -->
    </div>
    
    <!-- CTA -->
    <div class="flex justify-center items-center gap-4">
      <button onclick="game.backToTutorialType()" class="px-5 py-2 text-slate-400 hover:text-white transition-colors text-sm">
        â† Back
      </button>
      <button onclick="game.closeTutorialHub()" id="tutorialStartBtn" class="px-8 py-4 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-400 hover:to-teal-500 text-white font-bold text-lg rounded-xl shadow-lg transition-all transform hover:scale-105">
        ğŸš€ Start Playing
      </button>
    </div>
    <p class="text-center text-slate-500 text-xs mt-3">You can revisit this guide anytime from the menu</p>
  </div>
</div>

<!-- Tutorial Topic Detail Modal -->
<div id="tutorialTopicModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-[60] overflow-y-auto p-4">
  <div class="max-w-2xl w-full mx-auto my-4">
    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
      <!-- Topic Header -->
      <div id="topicHeader" class="p-6 bg-gradient-to-r from-indigo-500 to-purple-600">
        <div class="flex items-center gap-4">
          <div id="topicIcon" class="w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center text-3xl">ğŸ¯</div>
          <div>
            <h2 id="topicTitle" class="text-2xl font-bold text-white">Topic Title</h2>
            <p id="topicSubtitle" class="text-white/80 text-sm">Brief description</p>
          </div>
        </div>
      </div>
      
      <!-- Topic Content - All on one page -->
      <div class="p-6 max-h-[60vh] overflow-y-auto">
        <div id="topicContent">
          <!-- All content renders here -->
        </div>
      </div>
      
      <!-- Footer -->
      <div class="px-6 py-4 bg-slate-50 flex justify-between items-center">
        <button onclick="game.closeTutorialTopic()" class="text-slate-500 hover:text-slate-700 transition-colors">
          â† Back to Topics
        </button>
        <button onclick="game.closeTutorialTopic()" class="px-5 py-2 bg-indigo-500 hover:bg-indigo-600 text-white font-medium rounded-lg transition-colors">
          Got It âœ“
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Legacy Tutorial Modal (keeping for compatibility, hidden) -->
<div id="tutorialSelectModal" class="fixed inset-0 bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900 hidden items-center justify-center z-50">
</div>

<!-- Interactive Tutorial (legacy, hidden) -->
<div id="tutorialModal" class="fixed inset-0 bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900 hidden items-center justify-center z-50 overflow-y-auto">
  <div class="max-w-4xl w-full mx-auto px-4 py-6">
    <!-- Progress Bar -->
    <div class="mb-6">
      <div class="flex justify-between text-xs text-slate-400 mb-2">
        <span id="tutorialTypeLabel">Tutorial Progress</span>
        <span><span id="tutorialStepNum">1</span> of <span id="tutorialTotalSteps">14</span></span>
      </div>
      <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
        <div id="tutorialProgress" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-300" style="width: 7%"></div>
      </div>
    </div>
    
    <!-- Tutorial Content Area -->
    <div id="tutorialContent" class="bg-white rounded-2xl p-6 shadow-2xl mb-6">
      <!-- Populated by JS -->
    </div>
    
    <!-- Navigation -->
    <div class="flex justify-between items-center">
      <button id="tutorialBackBtn" onclick="game.tutorialBack()" class="px-5 py-2 text-slate-400 hover:text-white transition-colors">
        â† Back
      </button>
      <button onclick="game.closeTutorial()" class="text-slate-500 hover:text-slate-300 text-sm">
        Skip Tutorial
      </button>
      <button id="tutorialNextBtn" onclick="game.tutorialNext()" class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-400 hover:to-purple-500 text-white font-bold rounded-xl transition-all">
        Next â†’
      </button>
    </div>
  </div>
</div>

<!-- Venture Selection -->
<div id="ventureModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl max-w-4xl w-full p-8 shadow-2xl">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-2xl font-bold text-slate-800">Choose Your Venture</h2>
      <div class="flex items-center gap-3">
        <div id="extremeModeIndicatorVenture" class="hidden">
          <span class="px-3 py-1 bg-rose-600 text-white text-xs font-bold rounded-full">ğŸ”¥ EXTREME MODE</span>
        </div>
        <button onclick="game.backToFounder()" class="text-slate-400 hover:text-slate-600 text-sm px-3 py-1 border rounded">â† Back</button>
      </div>
    </div>
    <p class="text-slate-600 mb-6">Each AI startup faces unique market, technical, and competitive challenges. Which will you tackle?</p>
    <div id="ventureGrid" class="grid sm:grid-cols-2 gap-4 mb-6"></div>
  </div>
</div>

<!-- Location Selection -->
<div id="locationModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-50 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-6xl w-full mx-4 my-8 p-6 shadow-2xl">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-2xl font-bold text-slate-800">ğŸ“ Where Will You Build?</h2>
      <button onclick="game.backToVenture()" class="text-slate-400 hover:text-slate-600 text-sm px-3 py-1 border rounded">â† Back</button>
    </div>
    <p class="text-slate-600 mb-2">Location shapes your startup ecosystem for <span id="locationVentureName" class="font-semibold">your company</span>.</p>
    <p class="text-sm text-slate-500 mb-4">Each city offers different trade-offs: talent pools, salary costs, investor networks, and domain expertise. Click "Learn more" to understand each location's advantages and challenges.</p>
    <div id="locationGrid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;"></div>
  </div>
</div>

<!-- Founder Creation -->
<div id="founderModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-50 overflow-y-auto p-4">
  <div class="bg-white rounded-2xl max-w-5xl w-full mx-auto my-4 shadow-2xl max-h-[95vh] overflow-y-auto">
    <!-- Header -->
    <div class="p-6 border-b border-slate-200 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-t-2xl sticky top-0 z-10">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-2xl font-bold text-slate-800">ğŸ‘¤ Who Are You?</h2>
        <button onclick="game.backToPreamble()" class="text-slate-400 hover:text-slate-600 text-sm px-3 py-1 border rounded bg-white">â† Back</button>
      </div>
      <p class="text-slate-600">Your background shapes your strengths, challenges, and how investors perceive you.</p>
    </div>
    
    <!-- Name input + Profile selection -->
    <div class="p-6">
      <!-- Name Input -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-slate-700 mb-2">Your Name</label>
        <input type="text" id="founderNameInput" placeholder="Enter your name..." 
               class="w-full max-w-md px-4 py-3 border-2 border-slate-200 rounded-xl text-lg focus:border-indigo-400 focus:outline-none transition-colors">
        <p id="founderNameHint" class="text-xs text-slate-400 mt-1 hidden">Please enter your name above, then select a profile</p>
      </div>
      
      <!-- Profile Selection -->
      <div id="founderProfileGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" style="grid-auto-rows: 1fr;">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>
</div>

<!-- Profile Info Popup Modal -->
<div id="profileInfoModal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-[60] p-4" onclick="if(event.target === this) game.hideProfileInfo()">
  <div class="bg-white rounded-2xl max-w-lg w-full shadow-2xl overflow-hidden animate-fade-in">
    <div class="p-6">
      <div class="flex items-start gap-5 mb-5">
        <div id="profileInfoAvatar" class="w-24 h-24 rounded-full overflow-hidden border-3 border-indigo-300 flex-shrink-0 bg-white shadow-md"></div>
        <div class="flex-1">
          <h3 id="profileInfoName" class="font-bold text-xl text-slate-800 mb-1"></h3>
          <p id="profileInfoTitle" class="text-indigo-600 font-medium mb-2"></p>
          <p id="profileInfoSlogan" class="text-sm text-slate-500 italic"></p>
        </div>
        <button onclick="game.hideProfileInfo()" class="text-slate-400 hover:text-slate-600 text-2xl leading-none">&times;</button>
      </div>
      
      <p id="profileInfoDesc" class="text-slate-600 text-sm mb-5 leading-relaxed"></p>
      
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-emerald-50 rounded-xl p-4">
          <div class="text-xs font-bold text-emerald-700 mb-2 flex items-center gap-1">
            <span>ğŸ’ª</span> Strengths
          </div>
          <p id="profileInfoStrengths" class="text-sm text-emerald-800"></p>
        </div>
        <div class="bg-amber-50 rounded-xl p-4">
          <div class="text-xs font-bold text-amber-700 mb-2 flex items-center gap-1">
            <span>âš </span> Challenges
          </div>
          <p id="profileInfoChallenges" class="text-sm text-amber-800"></p>
        </div>
      </div>
    </div>
    
    <div class="bg-slate-50 px-6 py-4 flex justify-between gap-3">
      <button onclick="game.hideProfileInfo()" class="px-5 py-2.5 bg-slate-200 hover:bg-slate-300 text-slate-700 font-medium rounded-lg transition-colors">
        Back
      </button>
      <button id="profileInfoChooseBtn" onclick="game.chooseProfileFromPopup()" class="px-6 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg transition-colors">
        Choose this founder â†’
      </button>
    </div>
  </div>
</div>

<!-- Location Info Popup Modal -->
<div id="locationInfoModal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-[60] p-4" onclick="if(event.target === this) game.hideLocationInfo()">
  <div class="bg-white rounded-2xl max-w-lg w-full shadow-2xl overflow-hidden animate-fade-in">
    <div class="p-6">
      <div class="flex items-start gap-5 mb-5">
        <div id="locationInfoImage" class="w-28 h-20 rounded-lg overflow-hidden border-2 border-blue-200 flex-shrink-0 bg-slate-100 shadow-md flex items-center justify-center"></div>
        <div class="flex-1">
          <h3 id="locationInfoName" class="font-bold text-xl text-slate-800 mb-1"></h3>
          <p id="locationInfoRegion" class="text-blue-600 font-medium mb-1"></p>
          <p id="locationInfoTagline" class="text-sm text-slate-500 italic"></p>
        </div>
        <button onclick="game.hideLocationInfo()" class="text-slate-400 hover:text-slate-600 text-2xl leading-none">&times;</button>
      </div>
      
      <p id="locationInfoDesc" class="text-slate-600 text-sm mb-5 leading-relaxed"></p>
      
      <!-- Salary Cost -->
      <div class="bg-slate-50 rounded-xl p-4 mb-5">
        <div class="flex justify-between items-center">
          <span class="text-slate-700 font-medium">ğŸ’· Salary Costs</span>
          <span id="locationInfoSalary" class="text-lg font-bold"></span>
        </div>
        <p class="text-xs text-slate-500 mt-1">Affects your quarterly burn rate and hiring costs</p>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-emerald-50 rounded-xl p-4">
          <div class="text-xs font-bold text-emerald-700 mb-2 flex items-center gap-1">
            <span>âœ“</span> Advantages
          </div>
          <ul id="locationInfoPros" class="text-sm text-emerald-800 space-y-1"></ul>
        </div>
        <div class="bg-amber-50 rounded-xl p-4">
          <div class="text-xs font-bold text-amber-700 mb-2 flex items-center gap-1">
            <span>âœ—</span> Challenges
          </div>
          <ul id="locationInfoCons" class="text-sm text-amber-800 space-y-1"></ul>
        </div>
      </div>
    </div>
    
    <div class="bg-slate-50 px-6 py-4 flex justify-between gap-3">
      <button onclick="game.hideLocationInfo()" class="px-5 py-2.5 bg-slate-200 hover:bg-slate-300 text-slate-700 font-medium rounded-lg transition-colors">
        Back
      </button>
      <button id="locationInfoChooseBtn" onclick="game.chooseLocationFromPopup()" class="px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-colors">
        Choose this location â†’
      </button>
    </div>
  </div>
</div>

<!-- Executive CV Modal -->
<div id="execCVModal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-[60] p-4" onclick="if(event.target === this) game.hideExecCV()">
  <div class="bg-white rounded-2xl max-w-xl w-full shadow-2xl overflow-hidden animate-fade-in max-h-[90vh] overflow-y-auto">
    <div class="p-6">
      <!-- Header with photo and name -->
      <div class="flex items-start gap-4 mb-5">
        <div id="execCVAvatar" class="w-20 h-20 rounded-full overflow-hidden border-3 border-slate-200 flex-shrink-0 bg-slate-100 shadow-md"></div>
        <div class="flex-1">
          <h3 id="execCVName" class="font-bold text-xl text-slate-800 mb-1"></h3>
          <p id="execCVTitle" class="text-blue-600 font-medium mb-1"></p>
          <p id="execCVOrigin" class="text-sm text-slate-500"></p>
        </div>
        <button onclick="game.hideExecCV()" class="text-slate-400 hover:text-slate-600 text-2xl leading-none">&times;</button>
      </div>
      
      <!-- Quote -->
      <div class="bg-slate-50 rounded-xl p-4 mb-5 border-l-4 border-blue-400">
        <p id="execCVQuote" class="text-slate-600 italic"></p>
      </div>
      
      <!-- Education -->
      <div class="mb-5">
        <h4 class="text-sm font-bold text-slate-700 mb-2 flex items-center gap-2">ğŸ“ Education</h4>
        <p id="execCVEducation" class="text-sm text-slate-600"></p>
      </div>
      
      <!-- Experience -->
      <div class="mb-5">
        <h4 class="text-sm font-bold text-slate-700 mb-2 flex items-center gap-2">ğŸ’¼ Experience</h4>
        <ul id="execCVExperience" class="text-sm text-slate-600 space-y-1"></ul>
      </div>
      
      <!-- Strengths & Weaknesses -->
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div class="bg-emerald-50 rounded-xl p-4">
          <div class="text-xs font-bold text-emerald-700 mb-2 flex items-center gap-1">
            <span>âœ“</span> Strengths
          </div>
          <ul id="execCVStrengths" class="text-sm text-emerald-800 space-y-1.5"></ul>
        </div>
        <div class="bg-amber-50 rounded-xl p-4">
          <div class="text-xs font-bold text-amber-700 mb-2 flex items-center gap-1">
            <span>âš </span> Watch out for
          </div>
          <ul id="execCVWeaknesses" class="text-sm text-amber-800 space-y-1.5"></ul>
        </div>
      </div>
      
      <!-- Compensation -->
      <div class="bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl p-4">
        <h4 class="text-sm font-bold text-slate-700 mb-3">ğŸ’° Compensation Package</h4>
        <div class="grid grid-cols-3 gap-4 text-center">
          <div>
            <div id="execCVSalary" class="text-lg font-bold text-slate-800"></div>
            <div class="text-xs text-slate-500">per quarter</div>
          </div>
          <div>
            <div id="execCVEquity" class="text-lg font-bold text-amber-600"></div>
            <div class="text-xs text-slate-500">equity</div>
          </div>
          <div>
            <div id="execCVVesting" class="text-sm font-bold text-slate-700"></div>
            <div class="text-xs text-slate-500">vesting</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="bg-slate-50 px-6 py-4 flex justify-between gap-3 sticky bottom-0">
      <button onclick="game.hideExecCV()" class="px-5 py-2.5 bg-slate-200 hover:bg-slate-300 text-slate-700 font-medium rounded-lg transition-colors">
        Back
      </button>
      <button id="execCVHireBtn" onclick="game.hireFromCV()" class="px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-colors">
        Hire this person â†’
      </button>
    </div>
  </div>
</div>

<!-- Funding Stage Selection -->
<div id="fundingModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl max-w-3xl w-full p-8 shadow-2xl">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-2xl font-bold text-slate-800">Choose Your Funding Path</h2>
      <button onclick="game.backToLocation()" class="text-slate-400 hover:text-slate-600 text-sm px-3 py-1 border rounded">â† Back</button>
    </div>
    <p class="text-slate-600 mb-6">How will you fund your startup? Each path offers different resources and constraints.</p>
    <div id="fundingStageGrid" class="grid sm:grid-cols-3 gap-4"></div>
  </div>
</div>

<!-- Funder Selection -->
<div id="funderModal" class="fixed inset-0 bg-slate-900/90 hidden items-start justify-center z-50 overflow-y-auto p-4">
  <div class="bg-white rounded-2xl max-w-5xl w-full mx-auto my-4 shadow-2xl min-h-fit">
    <div class="p-5 border-b border-slate-200 bg-gradient-to-r from-emerald-50 to-slate-50 rounded-t-2xl sticky top-0 z-10">
      <div class="flex items-center justify-between mb-1">
        <h2 class="text-xl font-bold text-slate-800">Choose Your <span id="funderStageTitle">Investor</span></h2>
        <button onclick="game.backToFundingStage()" class="text-slate-400 hover:text-slate-600 text-sm px-3 py-1 border rounded bg-white">â† Back</button>
      </div>
      <p id="funderStageDesc" class="text-slate-600 text-sm">Select your investor carefully.</p>
    </div>
    <div class="p-5">
      <div id="funderGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4" style="grid-auto-rows: 1fr;"></div>
    </div>
  </div>
</div>

<!-- Investor Info Popup Modal -->
<div id="investorInfoModal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-[60] p-4" onclick="if(event.target === this) game.hideInvestorInfo()">
  <div class="bg-white rounded-2xl max-w-lg w-full shadow-2xl overflow-hidden animate-fade-in">
    <div class="p-6">
      <div class="flex items-start gap-5 mb-5">
        <div id="investorInfoAvatar" class="w-20 h-20 rounded-full overflow-hidden border-3 border-emerald-300 flex-shrink-0 bg-white shadow-md"></div>
        <div class="flex-1">
          <h3 id="investorInfoName" class="font-bold text-xl text-slate-800 mb-1"></h3>
          <p id="investorInfoTitle" class="text-emerald-600 font-medium mb-2"></p>
          <p id="investorInfoDesc" class="text-sm text-slate-500"></p>
        </div>
        <button onclick="game.hideInvestorInfo()" class="text-slate-400 hover:text-slate-600 text-2xl leading-none">&times;</button>
      </div>
      
      <!-- Financials summary -->
      <div class="bg-slate-50 rounded-xl p-4 mb-5">
        <div class="grid grid-cols-3 gap-3 text-center">
          <div>
            <div id="investorInfoCash" class="text-xl font-bold text-emerald-600"></div>
            <div id="investorInfoCashLabel" class="text-xs text-slate-500">Their Investment</div>
          </div>
          <div>
            <div id="investorInfoEquity" class="text-xl font-bold"></div>
            <div class="text-xs text-slate-500">Equity</div>
          </div>
          <div>
            <div id="investorInfoVal" class="text-xl font-bold text-slate-700"></div>
            <div class="text-xs text-slate-500">Valuation</div>
          </div>
        </div>
        <div id="investorInfoTotal" class="text-xs text-slate-500 text-center mt-2 pt-2 border-t border-slate-200 hidden"></div>
      </div>
      
      <!-- Quote -->
      <div class="p-3 bg-amber-50 rounded-lg border-l-3 border-amber-400 mb-5">
        <p id="investorInfoQuote" class="text-sm text-amber-800 italic"></p>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-emerald-50 rounded-xl p-4">
          <div class="text-xs font-bold text-emerald-700 mb-2 flex items-center gap-1">
            <span>âœ“</span> Benefits
          </div>
          <p id="investorInfoBenefits" class="text-sm text-emerald-800"></p>
        </div>
        <div class="bg-amber-50 rounded-xl p-4">
          <div class="text-xs font-bold text-amber-700 mb-2 flex items-center gap-1">
            <span>âš </span> Challenges
          </div>
          <p id="investorInfoChallenges" class="text-sm text-amber-800"></p>
        </div>
      </div>
    </div>
    
    <div class="bg-slate-50 px-6 py-4 flex justify-between gap-3">
      <button onclick="game.hideInvestorInfo()" class="px-5 py-2.5 bg-slate-200 hover:bg-slate-300 text-slate-700 font-medium rounded-lg transition-colors">
        Back
      </button>
      <button onclick="game.chooseInvestorFromPopup()" class="px-6 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-lg transition-colors">
        Choose this investor â†’
      </button>
    </div>
  </div>
</div>

<!-- Revenue Projections Modal -->
<div id="projectionsModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50 p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto my-4">
    <div class="p-5">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-bold text-slate-800">ğŸ“ˆ Revenue & Projections</h2>
        <button onclick="game.closeProjectionsModal()" class="text-slate-400 hover:text-slate-600 text-2xl leading-none">&times;</button>
      </div>
      
      <div id="projectionsContent">
        <!-- Populated dynamically by showProjectionsModal() -->
      </div>
      
      <div class="mt-5 pt-4 border-t">
        <button onclick="game.closeProjectionsModal()" class="w-full bg-slate-800 hover:bg-slate-700 text-white py-2.5 rounded-xl font-bold transition-colors">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Milestone Selection -->
<div id="milestoneModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-50 p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-6xl w-full shadow-2xl my-4">
    <!-- Header with advisor button -->
    <div class="px-6 py-4 border-b border-slate-200 bg-gradient-to-r from-amber-50 to-orange-50 rounded-t-2xl flex items-center justify-between">
      <div>
        <h2 id="milestoneModalTitle" class="text-xl font-bold text-slate-800">Choose Your First Milestone</h2>
        <p id="milestoneModalDesc" class="text-sm text-slate-600">Each path has different requirements and rewards. Choose wisely.</p>
      </div>
      <button id="openAdvisorBtn" onclick="game.showAdvisorSuggestions()" class="hidden px-4 py-2 bg-violet-500 hover:bg-violet-600 text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-2 shadow-md">
        ğŸ’¬ Get Recommendation
      </button>
    </div>
    
    <!-- Competitor Race Panel - Shows after M1 -->
    <div id="milestoneCompetitorPanel" class="hidden px-6 pt-4"></div>
    
    <!-- Advisor Panel - Shows when team hired -->
    <div id="milestoneAdvisorPanel" class="hidden px-6 pt-4"></div>
    
    <!-- Milestone Cards -->
    <div class="p-6">
      <div id="milestoneGrid" class="grid grid-cols-1 sm:grid-cols-3 gap-5" style="grid-auto-rows: 1fr;"></div>
    </div>
  </div>
</div>

<!-- ADVISOR SUGGESTIONS MODAL -->
<div id="advisorModal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-[60] p-4">
  <div class="bg-white rounded-xl max-w-xl w-full shadow-2xl">
    <div class="px-4 py-3 border-b border-slate-200 bg-gradient-to-r from-violet-50 to-slate-50 rounded-t-xl flex items-center justify-between">
      <div class="flex items-center gap-2">
        <span class="text-lg">ğŸ’¬</span>
        <h3 class="font-bold text-slate-800">Team & Advisor Input</h3>
      </div>
      <button onclick="game.closeAdvisorModal()" class="text-slate-400 hover:text-slate-600 text-xl">&times;</button>
    </div>
    <div id="advisorModalContent" class="p-4 max-h-[60vh] overflow-y-auto">
      <!-- Content filled by JS -->
    </div>
  </div>
</div>

<!-- MILESTONE INTEL MODAL - Competition analysis popup -->
<div id="milestoneIntelModal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-[60] p-4">
  <div class="bg-white rounded-2xl max-w-lg w-full shadow-2xl">
    <div class="px-5 py-4 border-b border-slate-200 bg-gradient-to-r from-indigo-50 to-slate-50 rounded-t-2xl flex items-center justify-between">
      <div>
        <h3 class="font-bold text-slate-800">ğŸ” Competitive Intel</h3>
        <p id="intelFocusAreas" class="text-xs text-slate-500">Focus areas: Research & Product</p>
      </div>
      <button onclick="game.closeMilestoneIntel()" class="text-slate-400 hover:text-slate-600 text-2xl leading-none">&times;</button>
    </div>
    <div id="milestoneIntelContent" class="p-4 max-h-[60vh] overflow-y-auto">
      <!-- Populated dynamically -->
    </div>
    <div class="px-5 py-3 bg-slate-50 rounded-b-2xl border-t border-slate-200">
      <button onclick="game.closeMilestoneIntel()" class="w-full px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white font-bold rounded-lg transition-colors">
        Back to Milestone Selection
      </button>
    </div>
  </div>
</div>

<!-- HIRING MODAL - Compact 3-column layout -->
<div id="hiringModal" class="fixed inset-0 bg-slate-900/95 hidden items-start justify-center z-50 overflow-y-auto p-4 pt-8">
  <div class="bg-white rounded-2xl max-w-6xl w-full shadow-2xl mb-8">
    
    <!-- Header with tabs -->
    <div class="p-4 border-b border-slate-200 bg-gradient-to-r from-slate-50 to-white rounded-t-2xl">
        <h2 class="text-xl font-bold text-slate-800 mb-3">Build Your Leadership Team</h2>
        <!-- Tab buttons -->
        <div class="flex gap-2">
          <button onclick="game.goToHiringStep(0)" id="hiringTab0" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-emerald-100 text-emerald-800 font-medium text-sm">
            ğŸ”¬ Research <span id="hiringCheck0" class="hidden">âœ“</span>
          </button>
          <button onclick="game.goToHiringStep(1)" id="hiringTab1" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-100 text-slate-400 font-medium text-sm">
            ğŸ’» Product <span id="hiringCheck1" class="hidden">âœ“</span>
          </button>
          <button onclick="game.goToHiringStep(2)" id="hiringTab2" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-100 text-slate-400 font-medium text-sm">
            ğŸ“£ Sales <span id="hiringCheck2" class="hidden">âœ“</span>
          </button>
        </div>
      </div>
      
      <!-- Content area -->
      <div class="p-4">
        <!-- Research Page -->
        <div id="hiringPage0" class="hiring-page">
          <div class="flex items-center gap-2 mb-3">
            <span class="text-xl">ğŸ”¬</span>
            <h3 class="font-bold text-emerald-800">Head of Research</h3>
            <span class="text-sm text-emerald-600">- Drives scientific breakthroughs</span>
          </div>
          <div id="researchHires" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;"></div>
        </div>
        
        <!-- Product Page -->
        <div id="hiringPage1" class="hiring-page hidden">
          <div class="flex items-center gap-2 mb-3">
            <span class="text-xl">ğŸ’»</span>
            <h3 class="font-bold text-sky-800">Head of Product</h3>
            <span class="text-sm text-sky-600">- Builds and ships features</span>
          </div>
          <div id="devHires" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;"></div>
        </div>
        
        <!-- Sales Page -->
        <div id="hiringPage2" class="hiring-page hidden">
          <div class="flex items-center gap-2 mb-3">
            <span class="text-xl">ğŸ“£</span>
            <h3 class="font-bold text-fuchsia-800">Head of Sales & Marketing</h3>
            <span class="text-sm text-fuchsia-600">- Wins customers and builds brand</span>
          </div>
          <div id="mktHires" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;"></div>
        </div>
      </div>
      
      <!-- Footer -->
      <div class="p-4 border-t border-slate-200 bg-slate-50 flex justify-between items-center rounded-b-2xl">
        <button id="hiringPrevBtn" onclick="game.prevHiringStep()" class="px-4 py-2 text-slate-600 hover:text-slate-800 font-medium rounded-lg hover:bg-slate-100 hidden">
          â† Back
        </button>
        <div class="flex-1 text-center">
          <span id="equityCommitted" class="text-amber-600 font-medium text-sm"></span>
        </div>
        <button id="hiringNextBtn" onclick="game.nextHiringStep()" disabled class="px-6 py-2 bg-emerald-600 hover:bg-emerald-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-bold rounded-xl">
          Next â†’
        </button>
      </div>
    </div>
</div>

<!-- Competitor Detail Modal -->
<div id="competitorModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-50 overflow-y-auto p-4">
  <div class="bg-white rounded-2xl max-w-3xl w-full shadow-2xl max-h-[90vh] overflow-y-auto">
    <!-- Header -->
    <div class="sticky top-0 bg-gradient-to-r from-slate-700 to-slate-800 text-white p-5 rounded-t-2xl">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <span id="competitorLogo" class="text-4xl"></span>
          <div>
            <h2 id="competitorName" class="text-2xl font-bold"></h2>
            <p id="competitorDesc" class="text-slate-300 text-sm"></p>
          </div>
        </div>
        <button onclick="game.closeCompetitorModal()" class="text-slate-300 hover:text-white text-3xl leading-none">&times;</button>
      </div>
    </div>
    
    <!-- Content -->
    <div class="p-5 space-y-5">
      
      <!-- CEO Profile -->
      <div class="bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-200">
        <div class="flex items-start gap-4">
          <div class="text-5xl" id="competitorCEOPhoto"></div>
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-1">
              <span class="text-xs font-bold text-amber-700 bg-amber-100 px-2 py-0.5 rounded">FOUNDER & CEO</span>
            </div>
            <h3 id="competitorCEOName" class="font-bold text-slate-800 text-lg"></h3>
            <p id="competitorCEOBackground" class="text-sm text-slate-600 mt-1"></p>
            <div class="mt-3 p-3 bg-white/60 rounded-lg border-l-4 border-amber-400">
              <p id="competitorCEOQuote" class="text-sm text-amber-800 italic"></p>
            </div>
            <p id="competitorCEOPersonality" class="text-xs text-slate-500 mt-2"></p>
          </div>
        </div>
      </div>
      
      <!-- Quick Stats -->
      <div class="grid grid-cols-4 gap-3">
        <div class="bg-slate-50 rounded-lg p-3 text-center">
          <div class="text-xs text-slate-500 mb-1">ğŸ“ Location</div>
          <div id="competitorLocation" class="font-bold text-slate-700 text-sm"></div>
        </div>
        <div class="bg-slate-50 rounded-lg p-3 text-center">
          <div class="text-xs text-slate-500 mb-1">ğŸ“… Founded</div>
          <div id="competitorFounded" class="font-bold text-slate-700 text-sm"></div>
        </div>
        <div class="bg-slate-50 rounded-lg p-3 text-center">
          <div class="text-xs text-slate-500 mb-1">ğŸ‘¥ Team Size</div>
          <div id="competitorEmployees" class="font-bold text-slate-700 text-sm"></div>
        </div>
        <div class="bg-slate-50 rounded-lg p-3 text-center">
          <div class="text-xs text-slate-500 mb-1">ğŸ’° Funding</div>
          <div id="competitorFundingStatus" class="font-bold text-slate-700 text-sm"></div>
        </div>
      </div>
      
      <!-- Development Progress -->
      <div class="bg-slate-50 rounded-xl p-4">
        <h4 class="font-bold text-slate-700 mb-3 flex items-center gap-2">
          <span>ğŸ“Š</span> Development Progress
        </h4>
        <div class="space-y-2" id="competitorScores"></div>
      </div>
      
      <!-- Leadership Team -->
      <div class="bg-blue-50 rounded-xl p-4 border border-blue-100">
        <h4 class="font-bold text-blue-800 mb-3 flex items-center gap-2">
          <span>ğŸ‘”</span> Leadership Team
        </h4>
        <div id="competitorTeam" class="grid grid-cols-1 md:grid-cols-3 gap-3"></div>
      </div>
      
      <!-- Funding -->
      <div class="bg-emerald-50 rounded-xl p-4 border border-emerald-100">
        <h4 class="font-bold text-emerald-800 mb-3 flex items-center gap-2">
          <span>ğŸ’µ</span> Investors
        </h4>
        <div id="competitorFunder" class="text-sm text-slate-700"></div>
      </div>
      
      <!-- Strategic Insights (dynamic) -->
      <div id="competitorInsights" class="bg-indigo-50 rounded-xl p-4 border border-indigo-100">
        <h4 class="font-bold text-indigo-800 mb-3 flex items-center gap-2">
          <span>ğŸ”®</span> Strategic Intelligence
        </h4>
        <!-- Populated dynamically -->
      </div>
      
      <!-- Recent Activity (dynamic) -->
      <div id="competitorActivity" class="bg-white rounded-xl p-4 border border-slate-200">
        <!-- Populated dynamically -->
      </div>
      
      <!-- Milestones -->
      <div class="bg-purple-50 rounded-xl p-4 border border-purple-100">
        <h4 class="font-bold text-purple-800 mb-3 flex items-center gap-2">
          <span>ğŸ¯</span> Milestone Progress
        </h4>
        <div id="competitorMilestones" class="space-y-2"></div>
      </div>
      
      <!-- Strengths & Weaknesses -->
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-emerald-50 rounded-xl p-4 border border-emerald-100">
          <h4 class="font-bold text-emerald-700 mb-2 text-sm">âœ… Strengths</h4>
          <ul id="competitorStrengths" class="text-sm text-slate-600 space-y-1"></ul>
        </div>
        <div class="bg-red-50 rounded-xl p-4 border border-red-100">
          <h4 class="font-bold text-red-700 mb-2 text-sm">âš ï¸ Weaknesses</h4>
          <ul id="competitorWeaknesses" class="text-sm text-slate-600 space-y-1"></ul>
        </div>
      </div>
      
    </div>
    
    <!-- Footer -->
    <div class="sticky bottom-0 bg-slate-100 p-4 rounded-b-2xl border-t border-slate-200">
      <button onclick="game.closeCompetitorModal()" class="w-full px-6 py-2.5 bg-slate-600 hover:bg-slate-700 text-white font-bold rounded-xl transition-colors">
        Close
      </button>
    </div>
  </div>
</div>

<!-- HR Hiring Modal -->
<div id="hrModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-50 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-6xl w-full mx-4 my-8 p-6 shadow-2xl">
    <div class="flex items-center gap-3 mb-2">
      <div class="w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center text-2xl">ğŸ‘¥</div>
      <div>
        <h2 class="text-2xl font-bold text-slate-800">Hire a Head of HR</h2>
        <p class="text-slate-600">After your first milestone, the board insists you formalise HR.</p>
      </div>
    </div>
    <p class="text-sm text-slate-500 mb-4">Choose carefully-your Head of HR will shape company culture and help retain your team.</p>
    <div id="hrHires" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;"></div>
  </div>
</div>

<!-- Milestone Achieved -->
<div id="achievedModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl max-w-md w-full p-8 shadow-2xl text-center">
    <div class="text-5xl mb-4">ğŸ‰</div>
    <h2 class="text-2xl font-bold text-slate-800 mb-2">Milestone Achieved!</h2>
    <p id="achievedText" class="text-slate-600 mb-6"></p>
    <button id="achievedContinueBtn" class="px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-xl">
      Continue
    </button>
  </div>
</div>

<!-- Hire Staff Modal -->
<div id="hireStaffModal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl max-w-lg w-full p-6 shadow-2xl">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold text-slate-800">ğŸ‘¥ Hire Staff</h2>
      <button onclick="game.closeHireStaffModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
    </div>
    
    <div class="bg-slate-50 rounded-xl p-4 mb-4">
      <div class="grid grid-cols-2 gap-4 text-sm">
        <div>
          <span class="text-slate-500">Current Staff:</span>
          <span id="hireModalStaff" class="font-bold text-slate-800 ml-1">0</span>
        </div>
        <div>
          <span class="text-slate-500">Current AP Bonus:</span>
          <span id="hireModalAPCurrent" class="font-bold text-emerald-600 ml-1">+0</span>
        </div>
        <div>
          <span class="text-slate-500">Cash Available:</span>
          <span id="hireModalCash" class="font-bold text-slate-800 ml-1">Â£0k</span>
        </div>
        <div>
          <span class="text-slate-500">Current Burn:</span>
          <span id="hireModalBurn" class="font-bold text-slate-800 ml-1">Â£0k/q</span>
        </div>
      </div>
    </div>
    
    <div class="space-y-3 mb-4">
      <h3 class="font-medium text-slate-700">Hiring Costs:</h3>
      <div class="grid grid-cols-1 gap-2 text-sm">
        <div class="flex items-center justify-between p-2 bg-amber-50 rounded-lg">
          <span class="text-amber-800">ğŸ’° Recruitment fee</span>
          <span id="hireModalCostDisplay" class="font-bold text-amber-700">Â£50k one-time</span>
        </div>
        <div class="flex items-center justify-between p-2 bg-rose-50 rounded-lg">
          <span class="text-rose-800">ğŸ”¥ Increased burn rate</span>
          <span class="font-bold text-rose-700">+Â£25k/quarter</span>
        </div>
        <div class="flex items-center justify-between p-2 bg-purple-50 rounded-lg">
          <span class="text-purple-800">â³ Integration period</span>
          <span id="hireModalIntegrationDisplay" class="font-bold text-purple-700">-1 AP this quarter</span>
        </div>
        <div class="flex items-center justify-between p-2 bg-blue-50 rounded-lg">
          <span class="text-blue-800">ğŸ˜“ Team stretched</span>
          <span id="hireModalMoodDisplay" class="font-bold text-blue-700">-0.5 mood all depts</span>
        </div>
      </div>
    </div>
    
    <div class="bg-emerald-50 rounded-xl p-4 mb-4">
      <h3 class="font-medium text-emerald-800 mb-2">After Hiring:</h3>
      <div class="grid grid-cols-2 gap-2 text-sm">
        <div>
          <span class="text-emerald-600">New Staff Count:</span>
          <span id="hireModalNewStaff" class="font-bold text-emerald-800 ml-1">0</span>
        </div>
        <div>
          <span class="text-emerald-600">AP Bonus (next Q):</span>
          <span id="hireModalAPNew" class="font-bold text-emerald-800 ml-1">+0</span>
        </div>
        <div>
          <span class="text-emerald-600">New Burn Rate:</span>
          <span id="hireModalNewBurn" class="font-bold text-emerald-800 ml-1">Â£0k/q</span>
        </div>
        <div>
          <span class="text-emerald-600">Cash After:</span>
          <span id="hireModalNewCash" class="font-bold text-emerald-800 ml-1">Â£0k</span>
        </div>
      </div>
    </div>
    
    <!-- Early-game hiring limit notice -->
    <div id="hireModalEarlyLimit" class="hidden text-sm p-3 bg-amber-50 rounded-lg mb-4 border border-amber-200"></div>
    
    <div class="flex gap-3">
      <button onclick="game.closeHireStaffModal()" class="flex-1 px-4 py-3 border border-slate-300 text-slate-700 font-medium rounded-xl hover:bg-slate-50">
        Cancel
      </button>
      <button id="confirmHireBtn" onclick="game.confirmHireStaff()" class="flex-1 px-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-xl disabled:bg-slate-300 disabled:cursor-not-allowed">
        Hire Staff (+1)
      </button>
    </div>
  </div>
</div>

<!-- Job Posting Modal -->
<div id="jobPostModal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-50 p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-2xl w-full shadow-2xl my-8">
    <div class="px-6 py-4 border-b border-slate-200 bg-gradient-to-r from-indigo-600 to-violet-600 rounded-t-2xl">
      <h2 class="font-bold text-white text-xl">ğŸ“ Post a Job</h2>
      <p class="text-indigo-100 text-sm">Create a job listing to attract candidates</p>
    </div>
    <div class="p-6 max-h-[60vh] overflow-y-auto">
      <!-- Role Selection -->
      <div class="mb-5">
        <label class="block text-sm font-bold text-slate-700 mb-2">Role *</label>
        <div class="grid grid-cols-2 gap-3" id="jobRoleOptions">
          <label class="job-role-option flex items-center gap-3 p-3 border-2 border-slate-200 rounded-xl cursor-pointer hover:border-indigo-300 hover:bg-indigo-50">
            <input type="radio" name="jobRole" value="research" class="hidden" onchange="game.updateJobPost()">
            <span class="text-2xl">ğŸ”¬</span>
            <div><div class="font-bold text-slate-800 text-sm">Research</div><div class="text-xs text-slate-500">Science & Innovation</div></div>
          </label>
          <label class="job-role-option flex items-center gap-3 p-3 border-2 border-slate-200 rounded-xl cursor-pointer hover:border-indigo-300 hover:bg-indigo-50">
            <input type="radio" name="jobRole" value="product" class="hidden" onchange="game.updateJobPost()">
            <span class="text-2xl">ğŸ’»</span>
            <div><div class="font-bold text-slate-800 text-sm">Product</div><div class="text-xs text-slate-500">Engineering & Design</div></div>
          </label>
          <label class="job-role-option flex items-center gap-3 p-3 border-2 border-slate-200 rounded-xl cursor-pointer hover:border-indigo-300 hover:bg-indigo-50">
            <input type="radio" name="jobRole" value="marketing" class="hidden" onchange="game.updateJobPost()">
            <span class="text-2xl">ğŸ“£</span>
            <div><div class="font-bold text-slate-800 text-sm">Marketing</div><div class="text-xs text-slate-500">Growth & Brand</div></div>
          </label>
          <label class="job-role-option flex items-center gap-3 p-3 border-2 border-slate-200 rounded-xl cursor-pointer hover:border-indigo-300 hover:bg-indigo-50">
            <input type="radio" name="jobRole" value="people" class="hidden" onchange="game.updateJobPost()">
            <span class="text-2xl">ğŸ¤</span>
            <div><div class="font-bold text-slate-800 text-sm">People</div><div class="text-xs text-slate-500">Culture & Talent</div></div>
          </label>
        </div>
      </div>
      
      <!-- Seniority -->
      <div class="mb-5">
        <label class="block text-sm font-bold text-slate-700 mb-2">Seniority Level *</label>
        <div class="space-y-2" id="jobSeniorityOptions">
          <label class="job-seniority-option flex items-center gap-3 p-3 border-2 border-slate-200 rounded-lg cursor-pointer hover:border-indigo-300 hover:bg-indigo-50">
            <input type="radio" name="jobSeniority" value="junior" class="hidden" onchange="game.updateJobPost()">
            <div class="w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 font-bold text-xs">Jr</div>
            <div class="flex-1"><div class="font-medium text-slate-800 text-sm">Junior</div><div class="text-xs text-slate-500">1-3 years Â· Learning curve</div></div>
            <div class="text-right text-xs"><div class="text-slate-600">Â£40-60k</div><div class="text-slate-400">0.25-1%</div></div>
          </label>
          <label class="job-seniority-option flex items-center gap-3 p-3 border-2 border-slate-200 rounded-lg cursor-pointer hover:border-indigo-300 hover:bg-indigo-50">
            <input type="radio" name="jobSeniority" value="senior" class="hidden" onchange="game.updateJobPost()">
            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-xs">Sr</div>
            <div class="flex-1"><div class="font-medium text-slate-800 text-sm">Senior</div><div class="text-xs text-slate-500">4-8 years Â· Hit ground running</div></div>
            <div class="text-right text-xs"><div class="text-slate-600">Â£65-100k</div><div class="text-slate-400">0.5-2%</div></div>
          </label>
          <label class="job-seniority-option flex items-center gap-3 p-3 border-2 border-slate-200 rounded-lg cursor-pointer hover:border-indigo-300 hover:bg-indigo-50">
            <input type="radio" name="jobSeniority" value="lead" class="hidden" onchange="game.updateJobPost()">
            <div class="w-8 h-8 rounded-full bg-violet-100 flex items-center justify-center text-violet-600 font-bold text-xs">Ld</div>
            <div class="flex-1"><div class="font-medium text-slate-800 text-sm">Lead / Director</div><div class="text-xs text-slate-500">8+ years Â· Strategic leadership</div></div>
            <div class="text-right text-xs"><div class="text-slate-600">Â£100-150k</div><div class="text-slate-400">1-3%</div></div>
          </label>
        </div>
      </div>
      
      <!-- Salary Range -->
      <div class="mb-5 p-4 bg-slate-50 rounded-xl">
        <label class="block text-sm font-bold text-slate-700 mb-3">ğŸ’· Salary Range Offered</label>
        <div class="flex items-center gap-4 mb-1">
          <input type="range" id="jobSalaryMin" min="35" max="150" value="65" class="flex-1" oninput="game.updateJobSalary()">
          <div class="text-center font-mono text-sm font-bold text-slate-800 w-36">Â£<span id="jobSalaryMinDisplay">65</span>k - Â£<span id="jobSalaryMaxDisplay">100</span>k</div>
          <input type="range" id="jobSalaryMax" min="40" max="160" value="100" class="flex-1" oninput="game.updateJobSalary()">
        </div>
      </div>
      
      <!-- Equity Range -->
      <div class="mb-5 p-4 bg-slate-50 rounded-xl">
        <label class="block text-sm font-bold text-slate-700 mb-3">ğŸ“Š Equity Range Offered</label>
        <div class="flex items-center gap-4 mb-1">
          <input type="range" id="jobEquityMin" min="0" max="3" value="0.5" step="0.25" class="flex-1" oninput="game.updateJobEquity()">
          <div class="text-center font-mono text-sm font-bold text-slate-800 w-28"><span id="jobEquityMinDisplay">0.5</span>% - <span id="jobEquityMaxDisplay">2</span>%</div>
          <input type="range" id="jobEquityMax" min="0.25" max="4" value="2" step="0.25" class="flex-1" oninput="game.updateJobEquity()">
        </div>
      </div>
      
      <!-- Cost info -->
      <div class="bg-amber-50 rounded-lg p-3 text-sm text-amber-800">
        â± Completing a hire costs <strong>1 AP</strong>. Browse candidates for free.
      </div>
      
      <!-- No HR prompt -->
      <div id="noHRPrompt" class="hidden mt-3 bg-indigo-50 rounded-lg p-3 text-sm text-indigo-700 border border-indigo-200">
        ğŸ’¡ <strong>Tip:</strong> Hire a People lead to get candidate recommendations and salary advice.
      </div>
    </div>
    <div class="px-6 py-4 border-t border-slate-200 bg-slate-50 rounded-b-2xl flex gap-3">
      <button type="button" onclick="game.closeJobPostModal()" class="flex-1 px-4 py-2.5 border border-slate-300 text-slate-600 rounded-lg hover:bg-white">Cancel</button>
      <button type="button" onclick="game.confirmJobPost()" id="confirmJobPostBtn" class="flex-1 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg">ğŸ“¤ Post Job</button>
    </div>
  </div>
</div>

<!-- Candidates Modal -->
<div id="candidatesModal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-50 p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-5xl w-full shadow-2xl my-8">
    <div class="px-6 py-4 border-b border-slate-200 bg-gradient-to-r from-emerald-600 to-teal-600 rounded-t-2xl">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="font-bold text-white text-xl">ğŸ“¬ Candidates</h2>
          <p id="candidatesSubtitle" class="text-emerald-100 text-sm">Review applications and make offers</p>
        </div>
        <button onclick="game.closeCandidatesModal()" class="text-white/70 hover:text-white text-2xl">&times;</button>
      </div>
    </div>
    <div class="p-6 max-h-[65vh] overflow-y-auto">
      <div id="candidatesList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </div>
  </div>
</div>

<!-- Candidate Detail Modal -->
<div id="candidateDetailModal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-50 p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-2xl w-full shadow-2xl my-8">
    <div id="candidateDetailContent"></div>
  </div>
</div>

<!-- Negotiation Modal -->
<div id="negotiationModal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl max-w-lg w-full shadow-2xl">
    <div id="negotiationContent"></div>
  </div>
</div>

<!-- Fire Staff Modal -->
<div id="fireStaffModal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-50 p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-lg w-full p-6 shadow-2xl my-8">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold text-slate-800">ğŸ“‰ Lay Off Staff</h2>
      <button onclick="game.closeFireStaffModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
    </div>
    
    <!-- Staff selection -->
    <div class="mb-4">
      <h3 class="font-medium text-slate-700 mb-2">Select who to lay off:</h3>
      <div id="fireStaffList" class="space-y-2 max-h-48 overflow-y-auto">
        <!-- Populated by JS -->
      </div>
      <p id="fireNoStaffMsg" class="hidden text-slate-500 text-sm italic py-4 text-center">No hired staff to lay off. Department heads cannot be laid off.</p>
    </div>
    
    <div class="bg-slate-50 rounded-xl p-4 mb-4">
      <div class="grid grid-cols-2 gap-4 text-sm">
        <div>
          <span class="text-slate-500">Current Staff:</span>
          <span id="fireModalStaff" class="font-bold text-slate-800 ml-1">0</span>
        </div>
        <div>
          <span class="text-slate-500">Current AP Bonus:</span>
          <span id="fireModalAPCurrent" class="font-bold text-emerald-600 ml-1">+0</span>
        </div>
        <div>
          <span class="text-slate-500">Cash Available:</span>
          <span id="fireModalCash" class="font-bold text-slate-800 ml-1">Â£0k</span>
        </div>
        <div>
          <span class="text-slate-500">Current Burn:</span>
          <span id="fireModalBurn" class="font-bold text-slate-800 ml-1">Â£0k/q</span>
        </div>
      </div>
    </div>
    
    <div class="space-y-3 mb-4">
      <h3 class="font-medium text-slate-700">Layoff Costs:</h3>
      <div class="grid grid-cols-1 gap-2 text-sm">
        <div class="flex items-center justify-between p-2 bg-amber-50 rounded-lg">
          <span class="text-amber-800">ğŸ’° Severance package</span>
          <span class="font-bold text-amber-700">Â£40k one-time</span>
        </div>
        <div class="flex items-center justify-between p-2 bg-rose-50 rounded-lg">
          <span class="text-rose-800">ğŸ˜¢ Morale impact</span>
          <span class="font-bold text-rose-700">-1 mood all depts</span>
        </div>
        <div class="flex items-center justify-between p-2 bg-purple-50 rounded-lg">
          <span class="text-purple-800">â³ Reorganization disruption</span>
          <span class="font-bold text-purple-700">-1 AP this quarter</span>
        </div>
        <div class="flex items-center justify-between p-2 bg-red-50 rounded-lg">
          <span class="text-red-800">âš¡ Capacity reduction</span>
          <span class="font-bold text-red-700">May lose AP tier</span>
        </div>
        <div class="flex items-center justify-between p-2 bg-slate-100 rounded-lg">
          <span class="text-slate-600">ğŸ“‰ Reduced burn rate</span>
          <span class="font-bold text-emerald-700">-Â£25k/quarter</span>
        </div>
      </div>
    </div>
    
    <div id="fireAfterSection" class="bg-rose-50 rounded-xl p-4 mb-4">
      <h3 class="font-medium text-rose-800 mb-2">After Layoff:</h3>
      <div class="grid grid-cols-2 gap-2 text-sm">
        <div>
          <span class="text-rose-600">New Staff Count:</span>
          <span id="fireModalNewStaff" class="font-bold text-rose-800 ml-1">0</span>
        </div>
        <div>
          <span class="text-rose-600">New AP Bonus:</span>
          <span id="fireModalAPNew" class="font-bold text-rose-800 ml-1">+0</span>
        </div>
        <div>
          <span class="text-rose-600">New Burn Rate:</span>
          <span id="fireModalNewBurn" class="font-bold text-rose-800 ml-1">Â£0k/q</span>
        </div>
        <div>
          <span class="text-rose-600">Cash After:</span>
          <span id="fireModalNewCash" class="font-bold text-rose-800 ml-1">Â£0k</span>
        </div>
      </div>
    </div>
    
    <div class="flex gap-3">
      <button onclick="game.closeFireStaffModal()" class="flex-1 px-4 py-3 border border-slate-300 text-slate-700 font-medium rounded-xl hover:bg-slate-50">
        Cancel
      </button>
      <button id="confirmFireBtn" onclick="game.confirmFireStaff()" class="flex-1 px-4 py-3 bg-rose-600 hover:bg-rose-700 text-white font-bold rounded-xl disabled:bg-slate-300 disabled:cursor-not-allowed">
        Lay Off Selected
      </button>
    </div>
  </div>
</div>

<!-- Milestone Failed -->
<div id="failedModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl max-w-md w-full p-8 shadow-2xl text-center">
    <div class="text-5xl mb-4">ğŸ’”</div>
    <h2 class="text-2xl font-bold text-slate-800 mb-2">Milestone Missed</h2>
    <p id="failedText" class="text-slate-600 mb-6"></p>
    <button onclick="location.reload()" class="px-6 py-3 bg-slate-600 hover:bg-slate-700 text-white font-bold rounded-xl">
      Try Again
    </button>
  </div>
</div>

<!-- Game End -->
<div id="endModal" class="fixed inset-0 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 hidden items-start justify-center z-50 overflow-y-auto">
  <div class="max-w-2xl w-full mx-auto px-4 py-8 min-h-full">
    <!-- Header -->
    <div class="text-center mb-6">
      <div id="endIcon" class="text-6xl mb-3">ğŸ’”</div>
      <h1 id="endTitle" class="text-3xl font-bold text-white mb-2">The End of the Road</h1>
      <p id="endSubtitle" class="text-slate-400">But every ending is a new beginning</p>
    </div>
    
    <!-- Main Card -->
    <div class="bg-white rounded-2xl p-6 shadow-2xl mb-6">
      <!-- What Happened -->
      <div id="endReason" class="bg-rose-50 border border-rose-200 rounded-xl p-4 mb-5">
        <!-- Populated by JS -->
      </div>
      
      <!-- Journey Stats -->
      <div class="mb-5">
        <h3 class="font-bold text-slate-800 mb-3 flex items-center gap-2">
          <span>ğŸ“Š</span> Your Entrepreneurial Journey
        </h3>
        <div id="endStats" class="grid grid-cols-2 gap-3 text-sm">
          <!-- Populated by JS -->
        </div>
      </div>
      
      <!-- What Went Well -->
      <div class="mb-5">
        <h3 class="font-bold text-emerald-700 mb-3 flex items-center gap-2">
          <span>âœ…</span> What Went Well
        </h3>
        <div id="endPositives" class="space-y-2 text-sm">
          <!-- Populated by JS -->
        </div>
      </div>
      
      <!-- Lessons Learned -->
      <div class="mb-5">
        <h3 class="font-bold text-amber-700 mb-3 flex items-center gap-2">
          <span>ğŸ’¡</span> Lessons for Next Time
        </h3>
        <div id="endLessons" class="space-y-2 text-sm">
          <!-- Populated by JS -->
        </div>
      </div>
      
      <!-- Encouragement -->
      <div id="endEncouragement" class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4 text-center border border-indigo-100">
        <!-- Populated by JS -->
      </div>
    </div>
    
    <!-- Play Again -->
    <div class="text-center">
      <button onclick="game.showJourneyModal()" class="px-8 py-4 bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-500 hover:to-slate-600 text-white font-bold text-lg rounded-xl shadow-lg transition-all transform hover:scale-105 mb-4">
        ğŸ“– View Your Entrepreneurial Journey
      </button>
      <br>
      <button onclick="location.reload()" class="px-8 py-4 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-400 hover:to-purple-500 text-white font-bold text-lg rounded-xl shadow-lg transition-all transform hover:scale-105">
        ğŸ”„ Try Again
      </button>
      <p class="text-slate-500 text-sm mt-3">90% of startups fail. The best founders fail forward.</p>
      
      <div class="mt-8 pt-6 border-t border-slate-700">
        <button onclick="game.showResearchModal()" class="text-indigo-400 hover:text-indigo-300 text-sm mb-4 flex items-center gap-2 mx-auto">
          <span>ğŸ“š</span> Learn more about AI startups and research
        </button>
        <p class="text-slate-500 text-sm mb-1">Created by Ammon Salter with Stefano Baruffaldi & Federico Bignone</p>
        <p class="text-slate-600 text-xs mb-2"><button onclick="game.showContributorsModal()" class="text-indigo-400 hover:text-indigo-300 underline">View all contributors</button></p>
        <p class="text-slate-600 text-xs mb-2">Part of the ESRC-funded project "Profiting from Science" [ES/X003949/1]</p>
        <p class="text-slate-600 text-xs">Â© 2025 Salter, Baruffaldi & Bignone Â· Licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" class="text-indigo-400 hover:text-indigo-300 underline">CC BY-NC-SA 4.0</a></p>
      </div>
    </div>
  </div>
</div>

<!-- Unicorn Event Modal -->
<div id="unicornModal" class="fixed inset-0 bg-gradient-to-br from-purple-900 via-pink-900 to-amber-900 hidden items-start justify-center z-50 overflow-y-auto">
  <div class="max-w-2xl w-full mx-auto px-4 py-8 min-h-full">
    <!-- Animated Background Stars -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <div class="absolute top-1/4 left-1/4 w-2 h-2 bg-white rounded-full animate-ping"></div>
      <div class="absolute top-1/3 right-1/3 w-1 h-1 bg-yellow-300 rounded-full animate-pulse"></div>
      <div class="absolute bottom-1/4 right-1/4 w-2 h-2 bg-pink-300 rounded-full animate-ping" style="animation-delay: 0.5s"></div>
      <div class="absolute top-1/2 left-1/6 w-1 h-1 bg-white rounded-full animate-pulse" style="animation-delay: 0.3s"></div>
    </div>
    
    <!-- Main Content -->
    <div class="relative bg-white/10 backdrop-blur-lg rounded-3xl p-8 border border-white/30 shadow-2xl text-center">
      <!-- Unicorn Icon -->
      <div class="text-8xl mb-4 animate-bounce">ğŸ¦„</div>
      
      <h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-400 via-purple-400 to-amber-400 mb-4">
        UNICORN!
      </h1>
      
      <p class="text-xl text-white/90 mb-6">
        Against all odds, lightning has struck!
      </p>
      
      <!-- Story -->
      <div class="bg-black/30 rounded-2xl p-6 mb-6 text-left">
        <p class="text-white/80 mb-4">
          Your breakthrough technology caught the attention of a major tech conglomerate. After a bidding war between three global giants, your valuation has exploded.
        </p>
        <p class="text-white/80 mb-4">
          This is the stuff of startup legend - the 1-in-10 outcome that every founder dreams of but few achieve.
        </p>
        <div class="flex items-center justify-center gap-4 mt-6">
          <div class="text-center">
            <div class="text-slate-400 text-sm">Previous Valuation</div>
            <div id="unicornPreVal" class="text-2xl font-bold text-white line-through opacity-60">Â£0k</div>
          </div>
          <div class="text-4xl text-amber-400">â†’</div>
          <div class="text-center">
            <div class="text-slate-400 text-sm">New Valuation</div>
            <div class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400">Â£1,000,000k</div>
            <div class="text-pink-400 text-sm font-bold">Â£1 BILLION</div>
          </div>
        </div>
        <div class="text-center mt-4">
          <span class="text-amber-400 font-bold text-lg">(<span id="unicornMultiplier">100</span>x multiplier!)</span>
        </div>
      </div>
      
      <!-- Hall of Fame Entry -->
      <div class="bg-gradient-to-r from-amber-900/50 to-yellow-900/50 rounded-2xl p-5 mb-6 border border-amber-500/30">
        <div class="text-amber-400 font-bold mb-3">ğŸ› Enter the Billionaire Founders Hall of Fame</div>
        <input 
          type="text" 
          id="unicornFounderName" 
          placeholder="Enter your name, founder..." 
          maxlength="30"
          class="w-full px-4 py-3 bg-black/40 border border-amber-500/50 rounded-xl text-white text-center text-lg placeholder-white/40 focus:outline-none focus:border-amber-400 focus:ring-2 focus:ring-amber-400/50"
        />
        <p class="text-amber-300/60 text-xs mt-2">Your name will appear alongside legendary founders</p>
      </div>
      
      <!-- Rarity Badge -->
      <div class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full text-white font-bold text-sm mb-6">
        âœ¨ Achieved by ~10% of winners
      </div>
      
      <!-- Continue Button -->
      <button onclick="game.acceptUnicorn()" class="w-full py-4 bg-gradient-to-r from-amber-500 via-pink-500 to-purple-500 hover:from-amber-400 hover:via-pink-400 hover:to-purple-400 text-white font-bold text-xl rounded-xl shadow-lg transform transition-all hover:scale-105">
        ğŸ‰ Join the Hall of Fame
      </button>
    </div>
  </div>
</div>

<!-- Hall of Fame Modal -->
<div id="hallOfFameModal" class="fixed inset-0 bg-gradient-to-br from-slate-900 via-amber-950 to-slate-900 hidden items-center justify-center z-50 overflow-y-auto">
  <div class="max-w-3xl w-full mx-auto px-4 py-8">
    <div class="relative bg-gradient-to-b from-amber-900/30 to-slate-900/80 backdrop-blur-lg rounded-3xl p-8 border border-amber-500/30 shadow-2xl">
      <!-- Header -->
      <div class="text-center mb-8">
        <div class="text-5xl mb-3">ğŸ›</div>
        <h1 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-yellow-300 mb-2">
          Billionaire Founders Hall of Fame
        </h1>
        <p class="text-amber-300/70 text-sm">The elite few who built billion-pound empires</p>
      </div>
      
      <!-- Hall of Fame List -->
      <div class="space-y-3 mb-8" id="hallOfFameList">
        <!-- Populated by JS -->
      </div>
      
      <!-- New Entry Highlight -->
      <div id="newHofEntry" class="hidden bg-gradient-to-r from-pink-600/30 to-purple-600/30 rounded-xl p-4 mb-6 border border-pink-500/50">
        <div class="flex items-center gap-4">
          <div class="text-4xl">ğŸ¦„</div>
          <div class="flex-1">
            <div class="text-pink-300 text-sm">Newest Member</div>
            <div id="newHofName" class="text-xl font-bold text-white">You</div>
            <div id="newHofCompany" class="text-amber-400 text-sm">Your Company â€¢ 2024</div>
          </div>
          <div class="text-right">
            <div class="text-2xl font-black text-emerald-400">Â£1B</div>
            <div class="text-emerald-300 text-xs">Valuation</div>
          </div>
        </div>
      </div>
      
      <!-- Stats -->
      <div class="grid grid-cols-3 gap-4 mb-8">
        <div class="bg-black/30 rounded-xl p-4 text-center">
          <div id="hofTotalFounders" class="text-2xl font-bold text-amber-400">0</div>
          <div class="text-slate-400 text-xs">Total Legends</div>
        </div>
        <div class="bg-black/30 rounded-xl p-4 text-center">
          <div id="hofYourRank" class="text-2xl font-bold text-emerald-400">#1</div>
          <div class="text-slate-400 text-xs">Your Rank</div>
        </div>
        <div class="bg-black/30 rounded-xl p-4 text-center">
          <div id="hofTotalWealth" class="text-2xl font-bold text-pink-400">Â£0T</div>
          <div class="text-slate-400 text-xs">Combined Wealth</div>
        </div>
      </div>
      
      <!-- Continue Button -->
      <button onclick="game.closeHallOfFame()" class="w-full py-4 bg-gradient-to-r from-amber-600 to-yellow-600 hover:from-amber-500 hover:to-yellow-500 text-white font-bold text-lg rounded-xl shadow-lg">
        Continue to Your Victory â†’
      </button>
    </div>
  </div>
</div>

<!-- Victory Modal - All Milestones Complete -->
<div id="victoryModal" class="fixed inset-0 bg-gradient-to-br from-emerald-900 via-slate-900 to-amber-900 hidden items-start justify-center z-50 overflow-y-auto">
  <div class="max-w-4xl w-full mx-auto px-4 py-8 min-h-full">
    <!-- Celebration Header -->
    <div class="text-center mb-6">
      <div class="text-6xl mb-3">ğŸ†</div>
      <h1 class="text-4xl font-black text-white mb-2">Victory!</h1>
      <p class="text-xl text-emerald-300">All three milestones complete</p>
      <div id="extremeModeBadge" class="hidden mt-3">
        <span class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-rose-600 to-orange-600 rounded-full text-white font-bold text-sm shadow-lg animate-pulse">
          ğŸ”¥ EXTREME MODE CONQUERED
        </span>
      </div>
    </div>
    
    <!-- Stats Card -->
    <div class="bg-white/10 backdrop-blur rounded-2xl p-6 mb-6 border border-white/20">
      <h3 class="text-white font-bold mb-4 text-center">ğŸ“Š Your Entrepreneurial Journey</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
        <div>
          <div id="victoryQuarters" class="text-3xl font-bold text-white">16</div>
          <div class="text-slate-400 text-sm">Quarters</div>
        </div>
        <div>
          <div id="victoryValuation" class="text-3xl font-bold text-emerald-400">Â£0k</div>
          <div class="text-slate-400 text-sm">Valuation</div>
        </div>
        <div>
          <div id="victoryEquity" class="text-3xl font-bold text-amber-400">0%</div>
          <div class="text-slate-400 text-sm">Your Equity</div>
        </div>
        <div>
          <div id="victoryCash" class="text-3xl font-bold text-sky-400">Â£0k</div>
          <div class="text-slate-400 text-sm">Cash</div>
        </div>
      </div>
      <div id="victoryNetWorth" class="mt-4 pt-4 border-t border-white/20 text-center">
        <div class="text-slate-400 text-sm mb-1">Your stake is worth</div>
        <div class="text-4xl font-black text-emerald-400">Â£0k</div>
      </div>
    </div>
    
    <!-- What's Next Section -->
    <div class="text-center mb-4">
      <h2 class="text-2xl font-bold text-white mb-1">What's Next?</h2>
      <p class="text-slate-400">Your board wants to know your plans...</p>
    </div>
    
    <!-- Ending Choices -->
    <div class="grid md:grid-cols-2 gap-4 mb-6">
      <!-- Beach Exit -->
      <button onclick="game.selectEnding('beach')" class="ending-choice group bg-gradient-to-br from-cyan-500/20 to-blue-500/10 hover:from-cyan-500/30 hover:to-blue-500/20 rounded-2xl p-5 border border-cyan-500/30 text-left transition-all hover:scale-[1.02]">
        <div class="flex items-center gap-3 mb-3">
          <div class="w-12 h-12 rounded-xl bg-cyan-500 flex items-center justify-center text-2xl shadow-lg">ğŸ–</div>
          <div>
            <h3 class="text-lg font-bold text-white">Cash Out & Retire</h3>
            <p class="text-cyan-300 text-xs">Take the money and enjoy life</p>
          </div>
        </div>
        <p class="text-slate-300 text-sm leading-relaxed mb-3">
          Sell your stake, buy a beach house, and finally read all those books. You've earned it.
        </p>
        <div class="bg-cyan-500/20 rounded-lg p-2 mb-3">
          <div class="flex justify-between items-center text-sm">
            <span class="text-cyan-300">ğŸ’° Your payout:</span>
            <span id="endingBeachValue" class="font-bold text-white">Â£0k</span>
          </div>
        </div>
        <div class="text-xs text-cyan-400 font-medium group-hover:translate-x-1 transition-transform">
          â†’ Peaceful ending â€¢ Maximum personal wealth â€¢ Zero stress
        </div>
      </button>
      
      <!-- Serial Entrepreneur -->
      <button onclick="game.selectEnding('serial')" class="ending-choice group bg-gradient-to-br from-violet-500/20 to-purple-500/10 hover:from-violet-500/30 hover:to-purple-500/20 rounded-2xl p-5 border border-violet-500/30 text-left transition-all hover:scale-[1.02]">
        <div class="flex items-center gap-3 mb-3">
          <div class="w-12 h-12 rounded-xl bg-violet-500 flex items-center justify-center text-2xl shadow-lg">ğŸš€</div>
          <div>
            <h3 class="text-lg font-bold text-white">Start Another Startup</h3>
            <p class="text-violet-300 text-xs">The startup life calls again</p>
          </div>
        </div>
        <p class="text-slate-300 text-sm leading-relaxed mb-3">
          Sell your stake and use the capital to fund your next big idea. Serial entrepreneurs never stop.
        </p>
        <div class="bg-violet-500/20 rounded-lg p-2 mb-3">
          <div class="flex justify-between items-center text-sm mb-1">
            <span class="text-violet-300">ğŸ’° Sale proceeds:</span>
            <span id="endingSerialSale" class="font-bold text-white">Â£0k</span>
          </div>
          <div class="flex justify-between items-center text-sm">
            <span class="text-violet-300">ğŸš€ Your seed fund:</span>
            <span id="endingSerialSeed" class="font-bold text-violet-200">Â£0k</span>
          </div>
        </div>
        <div class="text-xs text-violet-400 font-medium group-hover:translate-x-1 transition-transform">
          â†’ Restless ending â€¢ New adventure â€¢ Self-funded freedom
        </div>
      </button>
      
      <!-- Hyper-scale -->
      <button onclick="game.selectEnding('scale')" class="ending-choice group bg-gradient-to-br from-amber-500/20 to-orange-500/10 hover:from-amber-500/30 hover:to-orange-500/20 rounded-2xl p-5 border border-amber-500/30 text-left transition-all hover:scale-[1.02]">
        <div class="flex items-center gap-3 mb-3">
          <div class="w-12 h-12 rounded-xl bg-amber-500 flex items-center justify-center text-2xl shadow-lg">ğŸ“ˆ</div>
          <div>
            <h3 class="text-lg font-bold text-white">Stay & Hyper-Scale</h3>
            <p class="text-amber-300 text-xs">Build a generational company</p>
          </div>
        </div>
        <p class="text-slate-300 text-sm leading-relaxed mb-3">
          Keep your equity, raise a massive Series B, and aim to build one of the defining companies of the decade.
        </p>
        <div class="bg-amber-500/20 rounded-lg p-2 mb-3">
          <div class="flex justify-between items-center text-sm mb-1">
            <span class="text-amber-300">ğŸ“ˆ Series B valuation:</span>
            <span id="endingScaleValuation" class="font-bold text-white">Â£0k</span>
          </div>
          <div class="flex justify-between items-center text-sm">
            <span class="text-amber-300">ğŸ’ Your stake value:</span>
            <span id="endingScaleStake" class="font-bold text-amber-200">Â£0k</span>
          </div>
        </div>
        <div class="text-xs text-amber-400 font-medium group-hover:translate-x-1 transition-transform">
          â†’ Ambitious ending â€¢ High risk â€¢ Potential unicorn
        </div>
      </button>
      
      <!-- Acquisition -->
      <button onclick="game.selectEnding('acquisition')" class="ending-choice group bg-gradient-to-br from-emerald-500/20 to-teal-500/10 hover:from-emerald-500/30 hover:to-teal-500/20 rounded-2xl p-5 border border-emerald-500/30 text-left transition-all hover:scale-[1.02]">
        <div class="flex items-center gap-3 mb-3">
          <div class="w-12 h-12 rounded-xl bg-emerald-500 flex items-center justify-center text-2xl shadow-lg">ğŸ¢</div>
          <div>
            <h3 class="text-lg font-bold text-white">Sell to <span id="victoryAcquirerName">Industry Leader</span></h3>
            <p class="text-emerald-300 text-xs">Strategic acquisition</p>
          </div>
        </div>
        <p class="text-slate-300 text-sm leading-relaxed mb-3">
          Accept a premium acquisition offer and lead your tech as a new division inside a tech giant.
        </p>
        <div class="bg-emerald-500/20 rounded-lg p-2 mb-3">
          <div class="flex justify-between items-center text-sm mb-1">
            <span class="text-emerald-300">ğŸ¢ Acquisition price:</span>
            <span id="endingAcquiPrice" class="font-bold text-white">Â£0k</span>
          </div>
          <div class="flex justify-between items-center text-sm">
            <span class="text-emerald-300">ğŸ’° Your payout:</span>
            <span id="endingAcquiPayout" class="font-bold text-emerald-200">Â£0k</span>
          </div>
        </div>
        <div class="text-xs text-emerald-400 font-medium group-hover:translate-x-1 transition-transform">
          â†’ Corporate ending â€¢ Security + influence â€¢ VP title
        </div>
      </button>
    </div>
    
    <!-- Play Again -->
    <div class="text-center">
      <button onclick="game.showJourneyModal()" class="px-8 py-4 bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-500 hover:to-slate-600 text-white font-bold text-lg rounded-xl shadow-lg transition-all transform hover:scale-105 mb-4">
        ğŸ“– View Your Entrepreneurial Journey
      </button>
      <br>
      <button onclick="location.reload()" class="text-slate-500 hover:text-white text-sm transition-colors">
        â† Or start over with a new startup
      </button>
      
      <div class="mt-6 pt-4 border-t border-white/20">
        <button onclick="game.showResearchModal()" class="text-indigo-400 hover:text-indigo-300 text-sm mb-4 flex items-center gap-2 mx-auto">
          <span>ğŸ“š</span> Learn more about AI startups and research
        </button>
        <p class="text-slate-400 text-sm mb-1">Created by Ammon Salter with Stefano Baruffaldi & Federico Bignone</p>
        <p class="text-slate-500 text-xs mb-2"><button onclick="game.showContributorsModal()" class="text-indigo-400 hover:text-indigo-300 underline">View all contributors</button></p>
        <p class="text-slate-500 text-xs mb-2">Part of the ESRC-funded project "Profiting from Science" [ES/X003949/1]</p>
        <p class="text-slate-500 text-xs">Â© 2025 Salter, Baruffaldi & Bignone Â· Licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" class="text-slate-400 hover:text-white underline">CC BY-NC-SA 4.0</a></p>
      </div>
    </div>
  </div>
</div>

<!-- Ending Result Modal -->
<div id="endingResultModal" class="fixed inset-0 bg-slate-900/95 hidden items-start justify-center z-50 overflow-y-auto">
  <div class="max-w-2xl w-full mx-auto px-4 py-8 min-h-full">
    <div id="endingResultContent" class="bg-white rounded-2xl p-8 shadow-2xl">
      <!-- Populated by JS -->
    </div>
    <div class="text-center mt-6">
      <button onclick="game.showJourneyModal()" class="px-8 py-4 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-400 hover:to-purple-500 text-white font-bold text-lg rounded-xl shadow-lg transition-all mb-4">
        ğŸ“– View Your Entrepreneurial Journey
      </button>
      <br>
      <button onclick="location.reload()" class="px-8 py-4 bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-500 hover:to-slate-600 text-white font-bold text-lg rounded-xl shadow-lg transition-all">
        ğŸ® Play Again
      </button>
      
      <div class="mt-8 pt-6 border-t border-slate-700">
        <button onclick="game.showResearchModal()" class="text-indigo-400 hover:text-indigo-300 text-sm mb-4 flex items-center gap-2 mx-auto">
          <span>ğŸ“š</span> Learn more about AI startups and research
        </button>
        <p class="text-slate-500 text-sm mb-1">Created by Ammon Salter with Stefano Baruffaldi & Federico Bignone</p>
        <p class="text-slate-600 text-xs mb-2"><button onclick="game.showContributorsModal()" class="text-indigo-400 hover:text-indigo-300 underline">View all contributors</button></p>
        <p class="text-slate-600 text-xs mb-2">Part of the ESRC-funded project "Profiting from Science" [ES/X003949/1]</p>
        <p class="text-slate-600 text-xs">Â© 2025 Salter, Baruffaldi & Bignone Â· Licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" class="text-indigo-400 hover:text-indigo-300 underline">CC BY-NC-SA 4.0</a></p>
      </div>
    </div>
  </div>
</div>

<!-- Contributors Modal -->
<div id="contributorsModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-[70] p-4" onclick="if(event.target === this) game.hideContributorsModal()">
  <div class="bg-white rounded-2xl max-w-lg w-full p-6 shadow-2xl">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold text-slate-800">Contributors</h2>
      <button onclick="game.hideContributorsModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
    </div>
    
    <div class="space-y-4">
      <div>
        <h3 class="font-semibold text-slate-700 mb-2">Lead Author</h3>
        <p class="text-slate-600">Ammon Salter</p>
      </div>
      
      <div>
        <h3 class="font-semibold text-slate-700 mb-2">Co-Authors</h3>
        <p class="text-slate-600">Stefano Baruffaldi, Federico Bignone</p>
      </div>
      
      <div>
        <h3 class="font-semibold text-slate-700 mb-2">Contributors</h3>
        <p class="text-slate-600">Paola Criscuolo, Linus Dahlander, Christos Kolympiris, Orietta Marsili, Rossella Salandra, Giacomo Salter, Suki Salter</p>
      </div>
      
      <div class="pt-4 border-t border-slate-200">
        <h3 class="font-semibold text-slate-500 mb-2">AI Development Assistants</h3>
        <p class="text-slate-500">Claude (Anthropic), Gemini (Google), ChatGPT & GPT-5 (OpenAI)</p>
      </div>
      
      <div class="pt-4 border-t border-slate-200">
        <p class="text-slate-500 text-sm">Part of the ESRC-funded project "Profiting from Science" [ES/X003949/1]</p>
      </div>
    </div>
    
    <button onclick="game.hideContributorsModal()" class="mt-6 w-full py-2 bg-slate-700 hover:bg-slate-800 text-white font-medium rounded-lg transition-colors">
      Close
    </button>
  </div>
</div>

<!-- Research & Further Reading Modal -->
<div id="researchModal" class="fixed inset-0 bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900 hidden items-start justify-center z-[70] overflow-y-auto">
  <div class="max-w-3xl w-full mx-auto px-4 py-8 min-h-full">
    <div class="bg-white rounded-2xl p-6 shadow-2xl">
      <!-- Header -->
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center">
            <span class="text-2xl">ğŸ“š</span>
          </div>
          <div>
            <h2 class="text-2xl font-bold text-slate-800">Learn More</h2>
            <p class="text-slate-500 text-sm">Research on AI startups & the economics of AI</p>
          </div>
        </div>
        <button onclick="game.hideResearchModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
      </div>
      
      <!-- Introduction -->
      <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4 mb-6 border border-indigo-100">
        <p class="text-slate-700">
          If you want to learn more about AI startups and the economics of AI, please see these papers:
        </p>
      </div>
      
      <!-- References -->
      <div class="space-y-4 mb-6">
        <!-- Reference 1 -->
        <div class="bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors">
          <p class="text-slate-800 text-sm leading-relaxed">
            Agrawal, A., Gans, J., & Goldfarb, A. (2019). <span class="font-semibold">The Economics of Artificial Intelligence</span>. University of Chicago Press.
          </p>
        </div>
        
        <!-- Reference 2 -->
        <div class="bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors">
          <p class="text-slate-800 text-sm leading-relaxed">
            Ahmed, N., Wahed, M., & Thompson, N. C. (2023). The growing influence of industry in AI research. <span class="italic">Science, 379</span>(6635), 884-886. 
            <a href="https://doi.org/10.1126/science.ade2420" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">https://doi.org/10.1126/science.ade2420</a>
          </p>
        </div>
        
        <!-- Reference 3 -->
        <div class="bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors">
          <p class="text-slate-800 text-sm leading-relaxed">
            Artificial Intelligence sector study 2024. GOV.UK. 
            <a href="https://www.gov.uk/government/publications/artificial-intelligence-sector-study-2024/artificial-intelligence-sector-study-2024" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">https://www.gov.uk/government/publications/artificial-intelligence-sector-study-2024</a>
          </p>
        </div>
        
        <!-- Reference 4 -->
        <div class="bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors">
          <p class="text-slate-800 text-sm leading-relaxed">
            Bahoo-Torodi, A., Fontana, R., & Malerba, F. (2026). Pre-entry experience and the heterogeneity in startup performance: Evidence from the nascent artificial intelligence industry. <span class="italic">Research Policy, 55</span>(1), 105367. 
            <a href="https://doi.org/10.1016/j.respol.2025.105367" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">https://doi.org/10.1016/j.respol.2025.105367</a>
          </p>
        </div>
        
        <!-- Reference 5 -->
        <div class="bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors">
          <p class="text-slate-800 text-sm leading-relaxed">
            Baruffaldi, S., van Beuzekom, B., Dernis, H., Harhoff, D., Rao, N., Rosenfeld, D., & Squicciarini, M. (2020). Identifying and measuring developments in artificial intelligence: Making the impossible possible. <span class="italic">OECD Science, Technology and Industry Working Papers</span>. 
            <a href="https://doi.org/10.1787/5f65ff7e-en" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">https://doi.org/10.1787/5f65ff7e-en</a>
          </p>
        </div>
        
        <!-- Reference 6 -->
        <div class="bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors">
          <p class="text-slate-800 text-sm leading-relaxed">
            Bessen, J., Impink, S. M., Reichensperger, L., & Seamans, R. (2022). The role of data for AI startup growth. <span class="italic">Research Policy, 51</span>(5), 104513. 
            <a href="https://doi.org/10.1016/j.respol.2022.104513" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">https://doi.org/10.1016/j.respol.2022.104513</a>
          </p>
        </div>
        
        <!-- Reference 7 -->
        <div class="bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors">
          <p class="text-slate-800 text-sm leading-relaxed">
            Bianchini, S., MÃ¼ller, M., & Pelletier, P. (2022). Artificial intelligence in science: An emerging general method of invention. <span class="italic">Research Policy, 51</span>(10), 104604. 
            <a href="https://doi.org/10.1016/j.respol.2022.104604" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">https://doi.org/10.1016/j.respol.2022.104604</a>
          </p>
        </div>
        
        <!-- Reference 8 -->
        <div class="bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors">
          <p class="text-slate-800 text-sm leading-relaxed">
            Chalmers, D., MacKenzie, N. G., & Carter, S. (2021). Artificial intelligence and entrepreneurship: Implications for venture creation in the fourth industrial revolution. <span class="italic">Entrepreneurship Theory and Practice, 45</span>(5), 1028-1053. 
            <a href="https://doi.org/10.1177/1042258720934581" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">https://doi.org/10.1177/1042258720934581</a>
          </p>
        </div>
        
        <!-- Reference 9 -->
        <div class="bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors">
          <p class="text-slate-800 text-sm leading-relaxed">
            Chattopadhyay, S., HonorÃ©, F., & Won, S. (2025). Free range startups? Market scope, academic founders, and the role of general knowledge in AI. <span class="italic">Strategic Management Journal, 46</span>(4), 1027-1079. 
            <a href="https://doi.org/10.1002/smj.3685" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">https://doi.org/10.1002/smj.3685</a>
          </p>
        </div>
        
        <!-- Reference 10 -->
        <div class="bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors">
          <p class="text-slate-800 text-sm leading-relaxed">
            Feng, L., Hu, J., Huang, M., Irfan, M., & Hu, M. (2025). From algorithms to invention: AI's impact on corporate innovation output and efficiency. <span class="italic">The Quarterly Review of Economics and Finance</span>, 102042. 
            <a href="https://doi.org/10.1016/j.qref.2025.102042" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">https://doi.org/10.1016/j.qref.2025.102042</a>
          </p>
        </div>
        
        <!-- Reference 11 -->
        <div class="bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors">
          <p class="text-slate-800 text-sm leading-relaxed">
            Hartmann, P., & Henkel, J. (2020). The Rise of Corporate Science in AI: Data as a Strategic Resource. <span class="italic">Academy of Management Discoveries</span>. 
            <a href="https://doi.org/10.5465/amd.2019.0043" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">https://doi.org/10.5465/amd.2019.0043</a>
          </p>
        </div>
        
        <!-- Reference 12 -->
        <div class="bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors">
          <p class="text-slate-800 text-sm leading-relaxed">
            Jacobides, M. G., Brusoni, S., & Candelon, F. (2021). The evolutionary dynamics of the artificial intelligence ecosystem. <span class="italic">Strategy Science, 6</span>(4), 412-435. 
            <a href="https://doi.org/10.1287/stsc.2021.0148" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">https://doi.org/10.1287/stsc.2021.0148</a>
          </p>
        </div>
        
        <!-- Reference 13 -->
        <div class="bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors">
          <p class="text-slate-800 text-sm leading-relaxed">
            Wang, H., Fu, T., Du, Y., Gao, W., Huang, K., Liu, Z., ... & Zitnik, M. (2023). Scientific discovery in the age of artificial intelligence. <span class="italic">Nature, 620</span>(7972), 47-60. 
            <a href="https://doi.org/10.1038/s41586-023-06221-2" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">https://doi.org/10.1038/s41586-023-06221-2</a>
          </p>
        </div>
      </div>
      
      <!-- Footer -->
      <div class="text-center">
        <button onclick="game.hideResearchModal()" class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-400 hover:to-purple-500 text-white font-bold rounded-xl shadow-lg transition-all">
          â† Back to Game
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Shock Modal -->
<div id="shockModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-50 p-4 shock-overlay">
  <div class="bg-white rounded-2xl max-w-lg w-full p-6 shadow-2xl border-l-4 border-amber-500">
    <div class="flex items-center gap-2 text-amber-600 text-sm font-bold uppercase mb-2">
      <span>âš¡</span> Breaking News
    </div>
    <h2 id="shockHeadline" class="text-xl font-bold text-slate-800 mb-2"></h2>
    <p id="shockText" class="text-slate-600 mb-4"></p>
    <div id="shockEffects" class="bg-slate-50 rounded-lg p-3 text-sm text-slate-600 mb-4"></div>
    <p class="text-sm text-slate-500 mb-3">How do you respond?</p>
    <div id="shockChoices" class="space-y-2"></div>
  </div>
</div>

<!-- Life Event Modal -->
<div id="lifeEventModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-[55] p-4">
  <div class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl max-w-lg w-full p-6 shadow-2xl border-2 border-indigo-300">
    <div class="flex items-center gap-2 text-indigo-600 text-sm font-bold uppercase mb-3 tracking-wide">
      <span>ğŸ²</span> Life Happens
    </div>
    <div class="flex items-center gap-4 mb-4">
      <div id="lifeEventIcon" class="text-5xl">ğŸ </div>
      <h2 id="lifeEventTitle" class="text-xl font-bold text-slate-800"></h2>
    </div>
    <p id="lifeEventText" class="text-slate-600 mb-5 leading-relaxed"></p>
    <div id="lifeEventEffect" class="bg-white rounded-xl p-4 mb-5 border border-indigo-200 text-center">
      <span class="text-lg font-bold"></span>
    </div>
    <button onclick="game.resolveLifeEvent()" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl transition-all">
      Such is life...
    </button>
  </div>
</div>

<!-- STRATEGIC PIVOT MODAL - Player-initiated strategic review -->
<div id="strategicPivotModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-[60] p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-4xl w-full my-4 shadow-2xl max-h-[90vh] overflow-y-auto">
    <div class="sticky top-0 bg-gradient-to-r from-violet-600 to-purple-700 text-white p-4 rounded-t-2xl z-10">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="text-2xl">ğŸ”„</span>
          <div>
            <h2 class="text-xl font-bold">Strategic Review</h2>
            <p class="text-violet-200 text-sm">Should you change direction? Choose a pivot type.</p>
          </div>
        </div>
        <button onclick="game.closeStrategicPivotModal()" class="text-violet-200 hover:text-white text-2xl">&times;</button>
      </div>
    </div>
    <div class="p-5">
      <div id="strategicPivotContext" class="bg-red-50 border border-red-200 rounded-lg p-3 mb-5 flex items-center gap-3">
        <span class="text-2xl">âš ï¸</span>
        <div class="text-sm">
          <strong class="text-red-700">Competition is intensifying.</strong>
          <span class="text-red-600">Review your strategic options before it's too late.</span>
        </div>
      </div>
      <div id="strategicPivotContent" class="space-y-4">
        <!-- Pivot options rendered here -->
      </div>
      <div class="mt-5 pt-4 border-t border-slate-200 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <button onclick="game.showPivotTeamDetail()" class="px-3 py-1.5 text-sm text-indigo-600 hover:bg-indigo-50 rounded-lg">ğŸ‘¥ Team</button>
          <button onclick="game.showPivotCompanyDetail()" class="px-3 py-1.5 text-sm text-indigo-600 hover:bg-indigo-50 rounded-lg">ğŸ“Š Company</button>
          <button onclick="game.showPivotCurrentMilestone()" class="px-3 py-1.5 text-sm text-indigo-600 hover:bg-indigo-50 rounded-lg">ğŸ¯ Milestone</button>
        </div>
        <div class="flex gap-2">
          <button onclick="game.closeStrategicPivotModal()" class="px-4 py-2 text-slate-600 hover:text-slate-800">Cancel</button>
          <button id="strategicRecommendBtn" onclick="game.getStakeholderRecommendations('strategic')" class="px-4 py-2 bg-violet-600 hover:bg-violet-700 text-white font-medium rounded-lg">
            ğŸ’¡ Stakeholder Recommendations
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MARKET SHIFT MODAL - Forced response when competitor gets ahead -->
<div id="marketShiftModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-[60] p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-4xl w-full my-4 shadow-2xl max-h-[90vh] overflow-y-auto">
    <div class="sticky top-0 bg-gradient-to-r from-red-600 to-orange-600 text-white p-4 rounded-t-2xl z-10">
      <div class="flex items-center gap-3">
        <span class="text-2xl">âš ï¸</span>
        <div>
          <h2 class="text-xl font-bold">Market Shift</h2>
          <p class="text-red-200 text-sm">A competitor has changed your position. How do you respond?</p>
        </div>
      </div>
    </div>
    <div class="p-5">
      <div id="marketShiftContext" class="bg-slate-100 rounded-lg p-4 border-l-4 border-red-500 mb-5 flex items-start gap-3">
        <!-- Rival context populated dynamically -->
      </div>
      <div id="marketShiftContent" class="space-y-4">
        <!-- Response options rendered here -->
      </div>
      <div class="mt-5 pt-4 border-t border-slate-200 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <button onclick="game.showPivotTeamDetail()" class="px-3 py-1.5 text-sm text-indigo-600 hover:bg-indigo-50 rounded-lg">ğŸ‘¥ Team</button>
          <button onclick="game.showPivotCompanyDetail()" class="px-3 py-1.5 text-sm text-indigo-600 hover:bg-indigo-50 rounded-lg">ğŸ“Š Company</button>
          <button onclick="game.showPivotCurrentMilestone()" class="px-3 py-1.5 text-sm text-indigo-600 hover:bg-indigo-50 rounded-lg">ğŸ¯ Milestone</button>
        </div>
        <div class="flex gap-2">
          <button onclick="game.closeMarketShiftModal()" class="px-4 py-2 text-slate-600 hover:text-slate-800">Cancel</button>
          <button id="marketShiftRecommendBtn" onclick="game.getStakeholderRecommendations('forced')" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg">
            ğŸ’¡ Stakeholder Recommendations
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- PIVOT MILESTONE MODAL - Choose new milestone after pivot decision -->
<div id="pivotMilestoneModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-[61] p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-4xl w-full my-4 shadow-2xl max-h-[90vh] overflow-y-auto">
    <div class="sticky top-0 bg-gradient-to-r from-emerald-600 to-green-700 text-white p-4 rounded-t-2xl z-10">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="text-2xl">ğŸ’¡</span>
          <div>
            <h2 id="pivotMilestoneTitle" class="text-xl font-bold">Stakeholder Recommendations</h2>
            <p class="text-emerald-200 text-sm">Your team and investors weigh in on this strategy</p>
          </div>
        </div>
        <button onclick="game.backToPivotChoice()" class="text-emerald-200 hover:text-white text-2xl">&times;</button>
      </div>
    </div>
    <div class="p-5">
      <div id="pivotMilestoneList" class="space-y-4">
        <!-- Milestone options rendered here -->
      </div>
      <div class="mt-5 pt-4 border-t border-slate-200 flex justify-between items-center">
        <button onclick="game.backToPivotChoice()" class="px-4 py-2 text-slate-600 hover:text-slate-800">â† Back</button>
        <button id="confirmPivotMilestoneBtn" onclick="game.confirmPivotMilestone()" disabled class="px-6 py-2 bg-emerald-600 hover:bg-emerald-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-medium rounded-lg">
          Confirm Decision â†’
        </button>
      </div>
    </div>
  </div>
</div>

<!-- COMPANY RENAME MODAL - Choose new name after pivot -->
<div id="companyRenameModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-[62] p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-2xl w-full my-4 shadow-2xl max-h-[90vh] overflow-y-auto">
    <div class="sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-700 text-white p-4 rounded-t-2xl z-10">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="text-2xl">ğŸ·ï¸</span>
          <div>
            <h2 class="text-xl font-bold">Company Identity</h2>
            <p class="text-indigo-200 text-sm">A new direction may need a new name. Choose wiselyâ€”every choice has trade-offs.</p>
          </div>
        </div>
        <button onclick="game.backToPivotMilestone()" class="text-indigo-200 hover:text-white text-2xl">&times;</button>
      </div>
    </div>
    <div class="p-5">
      <div id="companyRenameOptions" class="space-y-3">
        <!-- Name options rendered here -->
      </div>
      <div class="mt-5 pt-4 border-t border-slate-200 flex justify-between items-center">
        <button onclick="game.backToPivotMilestone()" class="px-4 py-2 text-slate-600 hover:text-slate-800">â† Back</button>
        <button id="confirmRenameBtn" onclick="game.confirmCompanyRename()" disabled class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-medium rounded-lg">
          Confirm Name & Continue â†’
        </button>
      </div>
    </div>
  </div>
</div>

<!-- PIVOT TEAM MODAL - Team perspectives during pivot -->
<div id="pivotTeamModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-[63] p-4">
  <div class="bg-white rounded-2xl max-w-3xl w-full shadow-2xl max-h-[85vh] overflow-y-auto">
    <div class="sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-4 rounded-t-2xl z-10">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-bold">ğŸ‘¥ Team Perspectives</h2>
        <button onclick="game.closePivotTeamModal()" class="text-white/80 hover:text-white text-xl">&times;</button>
      </div>
    </div>
    <div id="pivotTeamContent" class="p-5"></div>
    <div class="p-4 border-t border-slate-200">
      <button onclick="game.closePivotTeamModal()" class="w-full py-2 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg">Close</button>
    </div>
  </div>
</div>

<!-- TEAM MEMBER DETAIL MODAL - Individual team member profile -->
<div id="teamMemberModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-[64] p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-lg w-full shadow-2xl my-4 max-h-[90vh] overflow-y-auto">
    <div id="teamMemberHeader" class="sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-4 rounded-t-2xl z-10">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div id="teamMemberEmoji" class="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center text-2xl"></div>
          <div>
            <h2 id="teamMemberName" class="text-lg font-bold">Team Member</h2>
            <p id="teamMemberRole" class="text-white/80 text-sm">Role</p>
          </div>
        </div>
        <button onclick="game.closeTeamMemberModal()" class="text-white/80 hover:text-white text-xl">&times;</button>
      </div>
    </div>
    <div id="teamMemberContent" class="p-5"></div>
    <div class="p-4 border-t border-slate-200">
      <button onclick="game.closeTeamMemberModal()" class="w-full py-2 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg">Close</button>
    </div>
  </div>
</div>

<!-- COMPETITOR DETAIL MODAL - View competitor during pivot -->
<div id="competitorDetailModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-[63] p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-2xl w-full shadow-2xl my-4 max-h-[90vh] overflow-y-auto">
    <div class="sticky top-0 bg-gradient-to-r from-red-600 to-orange-600 text-white p-4 rounded-t-2xl z-10">
      <div class="flex items-center justify-between">
        <h2 id="competitorDetailTitle" class="text-lg font-bold">ğŸ¢ Competitor Intelligence</h2>
        <button onclick="game.closeCompetitorDetailModal()" class="text-white/80 hover:text-white text-xl">&times;</button>
      </div>
    </div>
    <div id="competitorDetailContent" class="p-5"></div>
    <div class="p-4 border-t border-slate-200">
      <button onclick="game.closeCompetitorDetailModal()" class="w-full py-2 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg">Close</button>
    </div>
  </div>
</div>

<!-- PIVOT COMPANY MODAL - Company status during pivot -->
<div id="pivotCompanyModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-[63] p-4">
  <div class="bg-white rounded-2xl max-w-lg w-full shadow-2xl">
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-4 rounded-t-2xl">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-bold">ğŸ“Š Company Status</h2>
        <button onclick="game.closePivotCompanyModal()" class="text-white/80 hover:text-white text-xl">&times;</button>
      </div>
    </div>
    <div id="pivotCompanyContent" class="p-5"></div>
    <div class="p-4 border-t border-slate-200">
      <button onclick="game.closePivotCompanyModal()" class="w-full py-2 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg">Close</button>
    </div>
  </div>
</div>

<!-- PIVOT CURRENT MILESTONE MODAL - Current milestone during pivot -->
<div id="pivotCurrentMilestoneModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-[63] p-4">
  <div class="bg-white rounded-2xl max-w-lg w-full shadow-2xl">
    <div class="bg-gradient-to-r from-amber-500 to-orange-500 text-white p-4 rounded-t-2xl">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-bold">ğŸ¯ Current Milestone</h2>
        <button onclick="game.closePivotCurrentMilestoneModal()" class="text-white/80 hover:text-white text-xl">&times;</button>
      </div>
    </div>
    <div id="pivotCurrentMilestoneContent" class="p-5"></div>
    <div class="p-4 border-t border-slate-200">
      <button onclick="game.closePivotCurrentMilestoneModal()" class="w-full py-2 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg">Close</button>
    </div>
  </div>
</div>

<!-- PIVOT INFO MODAL - Details popup -->
<div id="pivotInfoModal" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-[65] p-4 overflow-y-auto" onclick="if(event.target === this) game.closePivotInfo()">
  <div class="bg-white rounded-2xl max-w-2xl w-full shadow-2xl my-4 max-h-[90vh] overflow-y-auto">
    <div id="pivotInfoHeader" class="sticky top-0 bg-gradient-to-r from-slate-700 to-slate-800 text-white p-4 rounded-t-2xl z-10">
      <div class="flex items-center justify-between">
        <h3 id="pivotInfoTitle" class="font-bold text-lg">Pivot Details</h3>
        <button onclick="game.closePivotInfo()" class="p-1 hover:bg-white/20 rounded-lg text-xl">&times;</button>
      </div>
    </div>
    <div id="pivotInfoContent" class="p-5">
      <!-- Content populated dynamically -->
    </div>
    <div class="px-5 pb-5">
      <button onclick="game.closePivotInfo()" class="w-full py-2.5 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-lg transition-colors">
        Close
      </button>
    </div>
  </div>
</div>

<!-- PIVOT OUTCOME MODAL - Shows results of pivot -->
<div id="pivotOutcomeModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-[63] p-4">
  <div class="bg-white rounded-2xl max-w-lg w-full shadow-2xl">
    <div id="pivotOutcomeHeader" class="bg-gradient-to-r from-emerald-600 to-teal-700 text-white p-5 rounded-t-2xl">
      <div class="flex items-center gap-3">
        <span class="text-3xl">ğŸš€</span>
        <div>
          <div class="text-xs uppercase tracking-wide text-emerald-200">Pivot Complete</div>
          <h2 id="pivotOutcomeTitle" class="text-xl font-bold">New Direction Set</h2>
        </div>
      </div>
    </div>
    <div class="p-5">
      <div id="pivotOutcomeSummary" class="space-y-4">
        <!-- Summary populated dynamically -->
      </div>
      <button onclick="game.completePivotProcess()" class="w-full mt-5 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-lg transition-colors">
        Continue Playing â†’
      </button>
    </div>
  </div>
</div>

<!-- SITUATION BRIEF MODAL - Shows at start of each quarter -->
<div id="situationBriefModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-[52] p-4">
  <div class="bg-gradient-to-br from-slate-50 to-indigo-50 rounded-2xl max-w-md w-full shadow-2xl border border-indigo-200 overflow-hidden">
    <!-- Chapter Banner (shown on chapter-starting quarters) -->
    <div id="briefChapterBanner" class="hidden bg-gradient-to-r from-indigo-700 to-purple-700 text-white px-4 py-2 text-center">
      <div class="flex items-center justify-center gap-2">
        <span id="briefChapterIcon" class="text-xl">ğŸ“–</span>
        <div>
          <span id="briefChapterTitle" class="font-bold">Chapter 1</span>
          <span class="text-indigo-200 mx-2">â€¢</span>
          <span id="briefChapterSubtitle" class="text-indigo-200">Finding productâ€“market fit</span>
        </div>
      </div>
    </div>
    
    <!-- Header -->
    <div class="bg-gradient-to-r from-indigo-600 to-indigo-700 text-white p-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <span class="text-2xl">ğŸ“‹</span>
          <div>
            <div class="text-xs uppercase tracking-wide text-indigo-200">Situation Brief</div>
            <h2 id="briefQuarterTitle" class="text-xl font-bold">Q1 of 16</h2>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <div id="briefChapterBadge" class="bg-white/20 px-2 py-1 rounded-full text-xs font-medium">Ch.1</div>
          <div id="briefYearBadge" class="bg-white/20 px-3 py-1 rounded-full text-sm font-medium">Year 1</div>
        </div>
      </div>
    </div>
    
    <!-- Stats Grid -->
    <div class="p-4 space-y-3">
      <!-- Runway Status -->
      <div class="bg-white rounded-xl p-3 border border-slate-200">
        <div class="flex items-center justify-between mb-2">
          <span class="text-slate-600 text-sm font-medium">ğŸ’° Runway</span>
          <span id="briefRunway" class="font-bold text-lg text-slate-800">8 quarters</span>
        </div>
        <div class="h-2 bg-slate-200 rounded-full overflow-hidden">
          <div id="briefRunwayBar" class="h-full bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full transition-all duration-500" style="width: 80%"></div>
        </div>
        <div id="briefRunwayWarning" class="text-xs text-amber-600 mt-1 hidden">âš ï¸ Low runway - consider fundraising</div>
      </div>
      
      <!-- Current Milestone -->
      <div class="bg-white rounded-xl p-3 border border-slate-200">
        <div class="flex items-center justify-between mb-2">
          <span class="text-slate-600 text-sm font-medium">ğŸ¯ Current Milestone</span>
          <span id="briefMilestoneNum" class="text-xs bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded-full font-medium">M1</span>
        </div>
        <div id="briefMilestoneName" class="font-bold text-slate-800 mb-1">Core Algorithm Validation</div>
        <div class="flex items-center gap-2">
          <div class="flex-1 h-2 bg-slate-200 rounded-full overflow-hidden">
            <div id="briefMilestoneBar" class="h-full bg-gradient-to-r from-amber-500 to-orange-500 rounded-full transition-all duration-500" style="width: 40%"></div>
          </div>
          <span id="briefMilestoneProgress" class="text-sm font-bold text-amber-600">40%</span>
        </div>
        <div id="briefMilestoneDeadline" class="text-xs text-slate-500 mt-1">â° 4 quarters remaining</div>
      </div>
      
      <!-- Suggested Focus -->
      <div id="briefSuggestionBox" class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-3 border border-indigo-200">
        <div class="flex items-start gap-2">
          <span class="text-lg">ğŸ’¡</span>
          <div>
            <div class="text-xs text-indigo-600 font-medium uppercase tracking-wide mb-1">Suggested Focus</div>
            <div id="briefSuggestion" class="text-slate-700 font-medium">Product & Research</div>
            <div id="briefSuggestionReason" class="text-xs text-slate-500 mt-1">Your milestone requires strong science scores</div>
          </div>
        </div>
      </div>
      
      <!-- Hasty Decisions Warning (hidden by default) -->
      <div id="briefHastyWarning" class="hidden bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-3 border border-amber-200 mt-3">
        <div class="flex items-start gap-2">
          <span class="text-lg">âš¡</span>
          <div>
            <div class="text-xs text-amber-600 font-medium uppercase tracking-wide mb-1">Decision Pace</div>
            <div id="briefHastyText" class="text-slate-700 text-sm">You made some hasty decisions last quarter.</div>
            <div id="briefHastyDetail" class="text-xs text-amber-600 mt-1">Taking time to read events improves outcomes.</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="p-4 pt-0">
      <button onclick="game.closeSituationBrief()" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl transition-all flex items-center justify-center gap-2">
        <span>Start Quarter</span>
        <span>â†’</span>
      </button>
    </div>
  </div>
</div>

<!-- RUNWAY WARNING MODAL - Confirms lethal runway decisions -->
<!-- PRE-COMMIT REVIEW MODAL (Combined Focus + Runway warnings) -->
<div id="preCommitReviewModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-[58] p-4">
  <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-2xl max-w-md w-full shadow-2xl border-2 border-slate-300 overflow-hidden">
    <!-- Header -->
    <div id="preCommitHeader" class="bg-gradient-to-r from-amber-500 to-orange-500 text-white p-4">
      <div class="flex items-center gap-3">
        <span id="preCommitIcon" class="text-3xl">âš ï¸</span>
        <div>
          <div class="text-xs uppercase tracking-wide opacity-80">Before You Commit</div>
          <h2 id="preCommitTitle" class="text-xl font-bold">Review Your Choices</h2>
        </div>
      </div>
    </div>
    
    <!-- Issues List -->
    <div class="p-4 space-y-3">
      <!-- Runway Issue (hidden by default) -->
      <div id="preCommitRunwayIssue" class="hidden bg-red-50 rounded-xl p-3 border border-red-200">
        <div class="flex items-start gap-3">
          <span class="text-xl">ğŸ’¸</span>
          <div class="flex-1">
            <div class="font-bold text-red-800 mb-1">Low Runway</div>
            <p class="text-sm text-red-700">This quarter will leave you with less than 1 quarter of runway.</p>
            <div class="mt-2 flex items-center justify-between text-sm bg-red-100 rounded-lg px-3 py-2">
              <span class="text-red-600">Projected runway:</span>
              <span id="preCommitRunwayValue" class="font-bold text-red-800">0 quarters</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Focus Issue (hidden by default) -->
      <div id="preCommitFocusIssue" class="hidden bg-amber-50 rounded-xl p-3 border border-amber-200">
        <div class="flex items-start gap-3">
          <span class="text-xl">ğŸ¯</span>
          <div class="flex-1">
            <div class="font-bold text-amber-800 mb-1">Attention Spread Thin</div>
            <p class="text-sm text-amber-700">Diluted effort reduces effectiveness by 10% this quarter.</p>
            <div id="preCommitFocusStreak" class="hidden mt-2 text-xs bg-amber-100 rounded-lg px-3 py-2 text-amber-700">
              <span class="font-bold">âš ï¸ Spread quarter streak:</span> <span id="preCommitStreakCount">2</span>
              <span class="block mt-1">Continuing may trigger a Strategic Drift event!</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Suggestions -->
      <div class="bg-slate-100 rounded-xl p-3 border border-slate-200">
        <div class="flex items-start gap-2">
          <span class="text-lg">ğŸ’¡</span>
          <div class="text-sm text-slate-600" id="preCommitSuggestions">
            Consider adjusting your choices before committing.
          </div>
        </div>
      </div>
    </div>
    
    <!-- Buttons -->
    <div class="p-4 pt-0 flex gap-3">
      <button onclick="game.cancelPreCommitReview()" class="flex-1 py-3 bg-emerald-500 hover:bg-emerald-600 text-white font-bold rounded-xl transition-all">
        â† Review Choices
      </button>
      <button onclick="game.confirmPreCommitReview()" id="preCommitProceedBtn" class="flex-1 py-3 bg-amber-500 hover:bg-amber-600 text-white font-bold rounded-xl transition-all">
        Proceed Anyway â†’
      </button>
    </div>
  </div>
</div>

<!-- LEGACY: Runway Warning Modal (kept for compatibility but not used) -->
<div id="runwayWarningModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-[58] p-4" style="display:none !important;">
</div>

<!-- LEGACY: Focus Warning Modal (kept for compatibility but not used) -->
<div id="focusWarningModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-[57] p-4" style="display:none !important;">
</div>

<!-- LEGACY: Momentum Toast (kept for compatibility but not used - now log only) -->
<div id="momentumToast" class="fixed top-20 left-1/2 -translate-x-1/2 z-[65] hidden" style="display:none !important;">
  </div>
</div>

<!-- CHAPTER TOAST - Shows chapter transitions -->
<div id="chapterToast" class="fixed top-4 left-1/2 -translate-x-1/2 z-[70] hidden">
  <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-4 rounded-xl shadow-2xl border border-indigo-400">
    <div class="flex items-center gap-3">
      <span id="chapterToastIcon" class="text-2xl">ğŸ“–</span>
      <div>
        <div id="chapterToastTitle" class="font-bold text-lg">Chapter 1</div>
        <div id="chapterToastSubtitle" class="text-indigo-200 text-sm">Finding productâ€“market fit</div>
      </div>
    </div>
  </div>
</div>

<!-- Your Entrepreneurial Journey Modal -->
<div id="journeyModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-[60] p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-3xl w-full mx-auto my-8 shadow-2xl">
    <div id="journeyContent" class="p-6 max-h-[80vh] overflow-y-auto">
      <!-- Populated by JS -->
    </div>
  </div>
</div>

<!-- Investor Confrontation Modal -->
<div id="investorConfrontationModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-[55] confrontation-overlay">
  <div class="confrontation-card bg-gradient-to-b from-slate-800 to-slate-900 rounded-2xl max-w-lg w-full mx-4 shadow-2xl overflow-hidden border-2 border-red-500/50">
    <!-- Header -->
    <div id="confrontationHeader" class="bg-gradient-to-r from-red-600 to-rose-700 text-white p-4">
      <div class="flex items-center gap-3">
        <div id="confrontationPhoto" class="w-16 h-16 rounded-full border-3 border-white/30 overflow-hidden investor-angry">
          <!-- Investor photo goes here -->
        </div>
        <div>
          <div id="confrontationStatus" class="text-xs uppercase tracking-wide text-red-200 mb-1">Investor Concerned</div>
          <h2 id="confrontationName" class="text-xl font-bold">Investor Name</h2>
          <div id="confrontationTitle" class="text-sm text-red-200">Title</div>
        </div>
      </div>
    </div>
    
    <!-- Content -->
    <div class="p-6">
      <!-- Quote bubble -->
      <div class="bg-slate-700/50 rounded-xl p-4 mb-4 border-l-4 border-red-500">
        <p id="confrontationQuote" class="text-white text-lg italic leading-relaxed">
          "I'm starting to wonder if you know what you're doing."
        </p>
      </div>
      
      <!-- Relationship status -->
      <div class="flex items-center justify-between mb-4 p-3 bg-slate-800/50 rounded-lg">
        <span class="text-slate-400 text-sm">Relationship Status</span>
        <div id="confrontationRelationship" class="flex items-center gap-2">
          <span class="text-red-400 font-bold">Hostile</span>
          <div class="flex gap-1">
            <span class="w-3 h-3 rounded-full bg-red-500"></span>
            <span class="w-3 h-3 rounded-full bg-slate-600"></span>
            <span class="w-3 h-3 rounded-full bg-slate-600"></span>
            <span class="w-3 h-3 rounded-full bg-slate-600"></span>
            <span class="w-3 h-3 rounded-full bg-slate-600"></span>
          </div>
        </div>
      </div>
      
      <!-- Consequences box -->
      <div id="confrontationConsequences" class="bg-red-900/30 border border-red-500/50 rounded-xl p-4 mb-6">
        <h3 class="text-red-400 font-semibold text-sm mb-2 flex items-center gap-2">
          <span>âš </span> Consequences
        </h3>
        <ul id="confrontationConsequencesList" class="text-slate-300 text-sm space-y-2">
          <li>â€¢ They will stop providing strategic advice</li>
          <li>â€¢ Their support bonuses are withdrawn</li>
        </ul>
      </div>
      
      <!-- Recovery hint (only shown if not hostile) -->
      <div id="confrontationRecoveryHint" class="hidden bg-amber-900/30 border border-amber-500/50 rounded-xl p-4 mb-6">
        <h3 class="text-amber-400 font-semibold text-sm mb-2 flex items-center gap-2">
          <span>ğŸ’¡</span> How to Recover
        </h3>
        <p class="text-slate-300 text-sm">Follow their advice in future quarters to rebuild trust. One more ignored suggestion and they may withdraw support entirely.</p>
      </div>
      
      <!-- Dismiss button -->
      <button onclick="game.dismissConfrontation()" class="w-full py-3 bg-slate-700 hover:bg-slate-600 text-white font-semibold rounded-xl transition-colors">
        I Understand
      </button>
    </div>
  </div>
</div>

<!-- Mini-Game Intro Modal -->
<div id="minigameIntroModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-[60] minigame-intro-overlay">
  <div class="minigame-intro-card bg-gradient-to-b from-slate-800 to-slate-900 rounded-2xl max-w-lg w-full mx-4 shadow-2xl overflow-hidden border border-slate-700 minigame-intro-glow">
    <!-- Header with icon -->
    <div id="minigameIntroHeader" class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-6 text-center">
      <div id="minigameIntroIcon" class="text-6xl mb-3 minigame-intro-icon">ğŸª</div>
      <h2 id="minigameIntroTitle" class="text-2xl font-bold">Mini-Game Time!</h2>
    </div>
    
    <!-- Content -->
    <div class="p-6">
      <p id="minigameIntroDesc" class="text-slate-300 text-center mb-4 leading-relaxed">
        Get ready for an interactive challenge!
      </p>
      
      <!-- Tips box -->
      <div id="minigameIntroTips" class="bg-slate-800/50 rounded-xl p-4 mb-6 border border-slate-700">
        <h3 class="text-amber-400 font-semibold text-sm mb-2 flex items-center gap-2">
          <span>ğŸ’¡</span> Quick Tips
        </h3>
        <ul id="minigameIntroTipsList" class="text-slate-400 text-sm space-y-1">
          <li>â€¢ Tip 1</li>
          <li>â€¢ Tip 2</li>
        </ul>
      </div>
      
      <!-- Reward preview -->
      <div class="text-center mb-6">
        <span class="text-slate-500 text-xs uppercase tracking-wide">Potential Rewards</span>
        <div id="minigameIntroRewards" class="text-lg text-emerald-400 font-semibold mt-1">
          ğŸ’° Cash â€¢ ğŸ“ˆ Stats â€¢ ğŸŒŸ Prestige
        </div>
      </div>
      
      <!-- Start button -->
      <button id="minigameIntroStartBtn" onclick="game.startPendingMiniGame()" class="minigame-start-btn w-full py-4 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-400 hover:to-teal-400 text-white font-bold text-lg rounded-xl">
        ğŸš€ Let's Go!
      </button>
    </div>
  </div>
</div>

<!-- Conference Mini-Game Modal -->
<div id="conferenceModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-50">
  <div class="bg-gradient-to-b from-slate-100 to-slate-200 rounded-2xl max-w-4xl w-full mx-4 shadow-2xl overflow-hidden">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4">
      <div class="flex justify-between items-center">
        <div>
          <div class="text-sm opacity-80">You're attending</div>
          <h2 id="confName" class="text-2xl font-bold">TechSummit Disrupt London</h2>
        </div>
        <div class="text-right">
          <div class="text-3xl font-mono" id="confTimer">1:00</div>
          <div class="text-sm opacity-80">remaining</div>
        </div>
      </div>
    </div>
    
    <!-- Stats Bar -->
    <div class="bg-white border-b border-slate-200 p-3 flex justify-between items-center text-sm">
      <div class="flex gap-6">
        <div>ğŸ’° Budget: <span id="confBudget" class="font-bold text-emerald-600">Â£2,000</span></div>
        <div>ğŸ“‹ Leads: <span id="confLeads" class="font-bold text-blue-600">0</span></div>
        <div>â­ Quality: <span id="confQuality" class="font-bold text-amber-600">0</span></div>
      </div>
      <div class="flex gap-4">
        <div class="text-slate-500">Your Interest: <span id="confInterest" class="font-bold text-blue-600">0</span></div>
        <div class="text-slate-500">Rivals: <span id="confRivalInterest" class="font-bold text-red-500">0</span></div>
      </div>
    </div>
    
    <!-- Game Area -->
    <div id="confGameArea" class="relative h-72 bg-gradient-to-b from-slate-100 to-slate-200 overflow-hidden">
      <!-- Ceiling / Lighting rigs -->
      <div class="absolute top-0 left-0 right-0 h-8 bg-gradient-to-b from-slate-800 to-transparent flex justify-around items-start">
        <div class="w-2 h-4 bg-yellow-300 rounded-b shadow-lg shadow-yellow-200/50"></div>
        <div class="w-2 h-4 bg-yellow-300 rounded-b shadow-lg shadow-yellow-200/50"></div>
        <div class="w-2 h-4 bg-yellow-300 rounded-b shadow-lg shadow-yellow-200/50"></div>
        <div class="w-2 h-4 bg-yellow-300 rounded-b shadow-lg shadow-yellow-200/50"></div>
        <div class="w-2 h-4 bg-yellow-300 rounded-b shadow-lg shadow-yellow-200/50"></div>
      </div>
      
      <!-- Floor -->
      <div class="absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-b from-slate-300 to-slate-400">
        <!-- Floor pattern -->
        <div class="absolute inset-0 opacity-20" style="background: repeating-linear-gradient(90deg, #000 0px, #000 1px, transparent 1px, transparent 60px);"></div>
      </div>
      
      <!-- Left Competitor Booth -->
      <div id="confBoothLeft" class="absolute bottom-12 left-4 w-32 h-32">
        <div class="absolute inset-x-0 top-0 h-20 bg-gradient-to-b from-red-500 to-red-600 rounded-t border-2 border-red-700">
          <div class="text-white text-center font-bold mt-1 text-[10px]">NEXAGEN AI</div>
          <div class="mx-2 mt-1 h-8 bg-slate-900 rounded flex items-center justify-center">
            <div id="confLeftDemo" class="text-red-400 text-[8px]">â–¶ DEMO</div>
          </div>
        </div>
        <div class="absolute bottom-0 inset-x-1 h-10 bg-slate-200 rounded-t border border-slate-300"></div>
        <div id="confLeftStaff" class="absolute -bottom-1 left-1/2 -translate-x-1/2">
          <svg width="20" height="24" viewBox="0 0 20 24"><circle cx="10" cy="5" r="4" fill="#ef4444"/><path d="M4 24 L6 12 L14 12 L16 24" fill="#dc2626"/><circle cx="10" cy="5" r="3" fill="#fecaca"/></svg>
        </div>
      </div>
      
      <!-- Right Competitor Booth -->
      <div id="confBoothRight" class="absolute bottom-12 right-4 w-32 h-32">
        <div class="absolute inset-x-0 top-0 h-20 bg-gradient-to-b from-purple-500 to-purple-600 rounded-t border-2 border-purple-700">
          <div class="text-white text-center font-bold mt-1 text-[10px]">SYNTHEX LABS</div>
          <div class="mx-2 mt-1 h-8 bg-slate-900 rounded flex items-center justify-center">
            <div id="confRightDemo" class="text-purple-400 text-[8px]">â–¶ DEMO</div>
          </div>
        </div>
        <div class="absolute bottom-0 inset-x-1 h-10 bg-slate-200 rounded-t border border-slate-300"></div>
        <div id="confRightStaff" class="absolute -bottom-1 left-1/2 -translate-x-1/2">
          <svg width="20" height="24" viewBox="0 0 20 24"><circle cx="10" cy="5" r="4" fill="#8b5cf6"/><path d="M4 24 L6 12 L14 12 L16 24" fill="#7c3aed"/><circle cx="10" cy="5" r="3" fill="#ede9fe"/></svg>
        </div>
      </div>
      
      <!-- Your Booth (center) -->
      <div id="confBooth" class="absolute bottom-12 left-1/2 -translate-x-1/2 w-40 h-36">
        <!-- Back wall -->
        <div class="absolute inset-x-0 top-0 h-24 bg-gradient-to-b from-blue-500 to-blue-600 rounded-t-lg border-4 border-blue-700 shadow-lg">
          <div id="confBoothName" class="text-white text-center font-bold mt-1 text-xs">AETHER BIOLABS</div>
          <div class="text-white/70 text-center text-[10px]">Stand A42</div>
          <!-- Banner/Demo screen -->
          <div class="mx-3 mt-1 h-10 bg-slate-900 rounded flex items-center justify-center">
            <div id="confDemoStatus" class="text-green-400 text-[10px]">â–¶ Demo Ready</div>
          </div>
        </div>
        <!-- Table -->
        <div class="absolute bottom-0 inset-x-2 h-12 bg-slate-200 rounded-t border-2 border-slate-300">
          <div id="confSwagPile" class="absolute left-1 bottom-1 text-lg">ğŸğŸ</div>
          <div id="confCoffee" class="absolute right-1 bottom-1 text-lg">â˜•</div>
        </div>
        <!-- Your Staff (little people) -->
        <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 flex gap-0.5">
          <svg width="18" height="22" viewBox="0 0 20 24"><circle cx="10" cy="5" r="4" fill="#3b82f6"/><path d="M4 24 L6 12 L14 12 L16 24" fill="#2563eb"/><circle cx="10" cy="5" r="3" fill="#fef3c7"/></svg>
          <svg width="18" height="22" viewBox="0 0 20 24"><circle cx="10" cy="5" r="4" fill="#3b82f6"/><path d="M4 24 L6 12 L14 12 L16 24" fill="#2563eb"/><circle cx="10" cy="5" r="3" fill="#fde68a"/></svg>
        </div>
      </div>
      
      <!-- Delegates will be spawned here -->
      <div id="confDelegates" class="absolute inset-0 pointer-events-none" style="touch-action: manipulation;"></div>
      
      <!-- Click effects layer -->
      <div id="confEffects" class="absolute inset-0 pointer-events-none"></div>
    </div>
    
    <!-- Action Buttons -->
    <div class="bg-white p-4 border-t border-slate-200">
      <div class="grid grid-cols-5 gap-2">
        <button id="confActionWave" onclick="game.confAction('wave')" class="conf-action-btn bg-slate-100 hover:bg-slate-200 p-3 rounded-xl text-center transition-all">
          <div class="text-2xl mb-1">ğŸ‘‹</div>
          <div class="text-xs font-medium">Wave</div>
          <div class="text-[10px] text-emerald-600">Free</div>
        </button>
        <button id="confActionSwag" onclick="game.confAction('swag')" class="conf-action-btn bg-amber-50 hover:bg-amber-100 p-3 rounded-xl text-center transition-all">
          <div class="text-2xl mb-1">ğŸ</div>
          <div class="text-xs font-medium">Swag</div>
          <div class="text-[10px] text-amber-600">Â£<span class="swag-cost">20</span></div>
        </button>
        <button id="confActionCoffee" onclick="game.confAction('coffee')" class="conf-action-btn bg-orange-50 hover:bg-orange-100 p-3 rounded-xl text-center transition-all">
          <div class="text-2xl mb-1">â˜•</div>
          <div class="text-xs font-medium">Coffee</div>
          <div class="text-[10px] text-orange-600">Â£<span class="coffee-cost">50</span></div>
        </button>
        <button id="confActionDemo" onclick="game.confAction('demo')" class="conf-action-btn bg-blue-50 hover:bg-blue-100 p-3 rounded-xl text-center transition-all">
          <div class="text-2xl mb-1">ğŸ’»</div>
          <div class="text-xs font-medium">Demo</div>
          <div class="text-[10px] text-blue-600">Â£<span class="demo-cost">200</span></div>
        </button>
        <button id="confActionTalk" onclick="game.confAction('talk')" class="conf-action-btn bg-purple-50 hover:bg-purple-100 p-3 rounded-xl text-center transition-all">
          <div class="text-2xl mb-1">ğŸ¤</div>
          <div class="text-xs font-medium">Talk</div>
          <div class="text-[10px] text-purple-600">Â£<span class="talk-cost">500</span></div>
        </button>
      </div>
      <div class="mt-3 text-center text-xs text-slate-500">
        Click delegates to engage them! Use actions to boost interest.
      </div>
    </div>
  </div>
</div>

<!-- Conference Results Modal -->
<div id="conferenceResultsModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-50">
  <div class="bg-white rounded-2xl max-w-md w-full mx-4 p-6 shadow-2xl text-center">
    <div id="confResultIcon" class="text-6xl mb-4">ğŸ†</div>
    <h2 id="confResultTitle" class="text-2xl font-bold text-slate-800 mb-2">Great Show!</h2>
    <p id="confResultText" class="text-slate-600 mb-4"></p>
    <div id="confResultStats" class="bg-slate-50 rounded-lg p-4 mb-4 text-left">
      <!-- Stats will be populated -->
    </div>
    <div id="confResultRewards" class="bg-emerald-50 rounded-lg p-4 mb-4 text-left text-emerald-800">
      <!-- Rewards will be populated -->
    </div>
    <!-- DEBRIEF PANEL -->
    <div id="confDebriefPanel" class="bg-indigo-50 rounded-lg p-4 mb-4 text-left border border-indigo-200">
      <div class="flex items-center gap-2 mb-2">
        <span class="text-lg">ğŸ’¡</span>
        <span class="font-bold text-indigo-800 text-sm">Debrief Insights</span>
      </div>
      <ul id="confDebriefList" class="text-sm text-indigo-700 space-y-1">
        <!-- Populated by JS -->
      </ul>
    </div>
    <button onclick="game.closeConference()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl">
      Continue
    </button>
  </div>
</div>

<!-- Investor Pitch Mini-Game Modal -->
<div id="pitchModal" class="fixed inset-0 bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900 hidden items-center justify-center z-50 overflow-y-auto">
  <div class="w-full max-w-5xl mx-4 my-4">
    <!-- Header -->
    <div class="flex justify-between items-center mb-3">
      <div>
        <h2 class="text-2xl font-bold text-white">ğŸ¤ Investor Pitch</h2>
        <p id="pitchVenueName" class="text-indigo-300 text-sm">Series A Pitch Meeting</p>
      </div>
      <div class="flex gap-6 text-center">
        <div>
          <div class="text-slate-400 text-xs uppercase">Time Left</div>
          <div id="pitchTimer" class="text-3xl font-mono font-bold text-amber-400">0:45</div>
        </div>
        <div>
          <div class="text-slate-400 text-xs uppercase">Pitch Points</div>
          <div id="pitchPoints" class="text-3xl font-mono font-bold text-emerald-400">10</div>
        </div>
      </div>
    </div>
    
    <!-- Main pitch area - Conference room style -->
    <div class="bg-gradient-to-b from-slate-800 to-slate-900 rounded-xl p-4 mb-3 relative border border-slate-700">
      <!-- Investor Panel (top) - The audience -->
      <div class="flex justify-center gap-2 mb-4">
        <div id="investor-0" class="pitch-investor flex flex-col items-center bg-slate-700/50 rounded-xl p-3 w-28 transition-all">
          <div class="text-4xl mb-1 investor-face">ğŸ‘¨ğŸ’¼</div>
          <div class="text-white text-xs font-medium text-center" id="investor-name-0">Dr. Chen</div>
          <div class="text-[10px] text-slate-400" id="investor-title-0">Lead Partner</div>
          <div class="mt-1 px-2 py-0.5 rounded-full text-[10px] font-medium investor-reaction" id="investor-reaction-0">ğŸ¤” Listening</div>
        </div>
        <div id="investor-1" class="pitch-investor flex flex-col items-center bg-slate-700/50 rounded-xl p-3 w-28 transition-all">
          <div class="text-4xl mb-1 investor-face">ğŸ‘©ğŸ’¼</div>
          <div class="text-white text-xs font-medium text-center" id="investor-name-1">Sarah Webb</div>
          <div class="text-[10px] text-slate-400" id="investor-title-1">GP, Tech Fund</div>
          <div class="mt-1 px-2 py-0.5 rounded-full text-[10px] font-medium investor-reaction" id="investor-reaction-1">ğŸ¤” Listening</div>
        </div>
        <div id="investor-2" class="pitch-investor flex flex-col items-center bg-slate-700/50 rounded-xl p-3 w-28 transition-all">
          <div class="text-4xl mb-1 investor-face">ğŸ§‘ğŸ’¼</div>
          <div class="text-white text-xs font-medium text-center" id="investor-name-2">Marcus Cole</div>
          <div class="text-[10px] text-slate-400" id="investor-title-2">Angel Investor</div>
          <div class="mt-1 px-2 py-0.5 rounded-full text-[10px] font-medium investor-reaction" id="investor-reaction-2">ğŸ¤” Listening</div>
        </div>
        <div id="investor-3" class="pitch-investor flex flex-col items-center bg-slate-700/50 rounded-xl p-3 w-28 transition-all">
          <div class="text-4xl mb-1 investor-face">ğŸ‘©ğŸ’»</div>
          <div class="text-white text-xs font-medium text-center" id="investor-name-3">Priya Patel</div>
          <div class="text-[10px] text-slate-400" id="investor-title-3">Venture Partner</div>
          <div class="mt-1 px-2 py-0.5 rounded-full text-[10px] font-medium investor-reaction" id="investor-reaction-3">ğŸ¤” Listening</div>
        </div>
      </div>
      
      <!-- The Worm Chart - Full width live scrolling attention tracker -->
      <div class="bg-slate-900 rounded-lg p-2 mb-3 border border-slate-600">
        <div class="flex justify-between items-center mb-1">
          <span class="text-xs text-slate-400 uppercase tracking-wide">ğŸ“Š Live Investor Interest</span>
          <div class="flex items-center gap-3">
            <span class="text-[10px] text-slate-500">Time: <span id="pitchTimerSmall" class="text-amber-400 font-mono">0:30</span></span>
            <span id="pitchAttentionValue" class="text-lg font-bold text-amber-400">50%</span>
          </div>
        </div>
        <div class="relative h-32 bg-gradient-to-b from-slate-800 to-slate-900 rounded overflow-hidden border border-slate-700">
          <!-- Threshold zones with labels on left -->
          <div class="absolute inset-0 flex flex-col">
            <div class="flex-1 bg-emerald-500/10 border-b border-emerald-500/40 relative">
              <span class="absolute left-2 top-1/2 -translate-y-1/2 text-[10px] text-emerald-400 font-medium">ğŸ¤© EXCITED</span>
            </div>
            <div class="flex-1 bg-amber-500/10 border-b border-amber-500/40 relative">
              <span class="absolute left-2 top-1/2 -translate-y-1/2 text-[10px] text-amber-400 font-medium">ğŸ¤” INTERESTED</span>
            </div>
            <div class="flex-1 bg-red-500/10 relative">
              <span class="absolute left-2 top-1/2 -translate-y-1/2 text-[10px] text-red-400 font-medium">ğŸ˜´ BORED</span>
            </div>
          </div>
          <!-- Time markers -->
          <div class="absolute bottom-0 left-0 right-0 flex justify-between px-2 text-[8px] text-slate-600">
            <span>0s</span>
            <span>10s</span>
            <span>20s</span>
            <span>30s</span>
          </div>
          <!-- The worm line (SVG) - scrolls left to right -->
          <svg id="pitchWormChart" class="absolute inset-0 w-full h-full" viewBox="0 0 300 100" preserveAspectRatio="none">
            <defs>
              <linearGradient id="wormGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:#64748b"/>
                <stop offset="80%" style="stop-color:#f59e0b"/>
                <stop offset="100%" style="stop-color:#10b981"/>
              </linearGradient>
              <filter id="glow">
                <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                <feMerge>
                  <feMergeNode in="coloredBlur"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
            </defs>
            <polyline id="pitchWormLine" fill="none" stroke="url(#wormGradient)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" filter="url(#glow)" points="0,50"/>
          </svg>
          <!-- Current position dot (pulses) -->
          <div id="pitchWormDot" class="absolute w-4 h-4 bg-white rounded-full shadow-lg shadow-white/70 animate-pulse" style="left: 0%; top: 50%; transform: translate(-50%, -50%);"></div>
        </div>
      </div>
      
      <!-- Presenter area -->
      <div class="flex items-center justify-center gap-6">
        <div class="text-center">
          <div id="pitchPresenter" class="text-5xl transition-transform duration-200">ğŸ§‘ğŸ’¼</div>
          <div class="text-white text-sm font-medium mt-1">You</div>
        </div>
        <div id="pitchSpeechBubble" class="bg-white rounded-2xl rounded-bl-none px-4 py-2 max-w-xs shadow-lg">
          <p id="pitchSpeechText" class="text-slate-800 text-sm italic">"Thank you for having me today..."</p>
        </div>
      </div>
      
      <!-- Effects container -->
      <div id="pitchEffects" class="absolute inset-0 pointer-events-none overflow-hidden"></div>
    </div>
    
    <!-- Action buttons - 2 rows of 4 -->
    <div class="grid grid-cols-4 gap-2 mb-2">
      <button onclick="game.pitchAction('story')" class="pitch-action-btn bg-violet-600 hover:bg-violet-500 text-white p-2.5 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
        <div class="text-xl mb-0.5">ğŸ“–</div>
        <div class="text-xs font-medium">Tell Story</div>
        <div class="text-[9px] text-violet-200">3 pts â€¢ +15</div>
      </button>
      <button onclick="game.pitchAction('joke')" class="pitch-action-btn bg-amber-600 hover:bg-amber-500 text-white p-2.5 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
        <div class="text-xl mb-0.5">ğŸ˜„</div>
        <div class="text-xs font-medium">Tell Joke</div>
        <div class="text-[9px] text-amber-200">2 pts â€¢ risky!</div>
      </button>
      <button onclick="game.pitchAction('customer')" class="pitch-action-btn bg-emerald-600 hover:bg-emerald-500 text-white p-2.5 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
        <div class="text-xl mb-0.5">ğŸ¢</div>
        <div class="text-xs font-medium">Name Drop</div>
        <div class="text-[9px] text-emerald-200">2 pts â€¢ +12</div>
      </button>
      <button onclick="game.pitchAction('data')" class="pitch-action-btn bg-blue-600 hover:bg-blue-500 text-white p-2.5 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
        <div class="text-xl mb-0.5">ğŸ“Š</div>
        <div class="text-xs font-medium">Show Data</div>
        <div class="text-[9px] text-blue-200">2 pts â€¢ +8</div>
      </button>
    </div>
    <div class="grid grid-cols-4 gap-2">
      <button onclick="game.pitchAction('smile')" class="pitch-action-btn bg-pink-600 hover:bg-pink-500 text-white p-2.5 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
        <div class="text-xl mb-0.5">ğŸ˜Š</div>
        <div class="text-xs font-medium">Smile</div>
        <div class="text-[9px] text-pink-200">1 pt â€¢ +5</div>
      </button>
      <button onclick="game.pitchAction('walk')" class="pitch-action-btn bg-cyan-600 hover:bg-cyan-500 text-white p-2.5 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
        <div class="text-xl mb-0.5">ğŸš¶</div>
        <div class="text-xs font-medium">Step Forward</div>
        <div class="text-[9px] text-cyan-200">1 pt â€¢ +6</div>
      </button>
      <button onclick="game.pitchAction('enthusiasm')" class="pitch-action-btn bg-orange-600 hover:bg-orange-500 text-white p-2.5 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
        <div class="text-xl mb-0.5">ğŸ™Œ</div>
        <div class="text-xs font-medium">Show Passion</div>
        <div class="text-[9px] text-orange-200">2 pts â€¢ +10</div>
      </button>
      <button onclick="game.pitchAction('demo')" id="pitchDemoBtn" class="pitch-action-btn bg-indigo-600 hover:bg-indigo-500 text-white p-2.5 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
        <div class="text-xl mb-0.5">ğŸ’»</div>
        <div class="text-xs font-medium">Live Demo</div>
        <div class="text-[9px] text-indigo-200">4 pts â€¢ +20 (1x)</div>
      </button>
    </div>
    
    <!-- Status bar -->
    <div class="mt-3 bg-slate-800/50 rounded-lg p-2 flex justify-between text-sm">
      <div class="text-slate-400 text-xs">
        <span id="pitchActionLog">Ready to pitch...</span>
      </div>
      <div class="text-slate-400 text-xs">
        Room mood: <span id="pitchInvestorMood" class="text-amber-400 font-medium">Neutral</span>
      </div>
    </div>
  </div>
</div>

<!-- Pitch Results Modal -->
<div id="pitchResultsModal" class="fixed inset-0 bg-slate-900/95 hidden items-center justify-center z-50">
  <div class="bg-white rounded-2xl max-w-md w-full mx-4 p-6 shadow-2xl text-center">
    <div id="pitchResultIcon" class="text-6xl mb-4">ğŸ‰</div>
    <h2 id="pitchResultTitle" class="text-2xl font-bold text-slate-800 mb-2">Pitch Complete!</h2>
    <p id="pitchResultText" class="text-slate-600 mb-4"></p>
    <div id="pitchResultStats" class="bg-slate-50 rounded-lg p-4 mb-4 text-left">
      <!-- Stats will be populated -->
    </div>
    <div id="pitchResultRewards" class="bg-emerald-50 rounded-lg p-4 mb-4 text-left text-emerald-800">
      <!-- Rewards will be populated -->
    </div>
    <!-- DEBRIEF PANEL -->
    <div id="pitchDebriefPanel" class="bg-purple-50 rounded-lg p-4 mb-4 text-left border border-purple-200">
      <div class="flex items-center gap-2 mb-2">
        <span class="text-lg">ğŸ’¡</span>
        <span class="font-bold text-purple-800 text-sm">Debrief Insights</span>
      </div>
      <ul id="pitchDebriefList" class="text-sm text-purple-700 space-y-1">
        <!-- Populated by JS -->
      </ul>
    </div>
    <button onclick="game.closePitch()" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl">
      Continue to Next Milestone
    </button>
  </div>
</div>

<!-- Raise Funding Modal -->
<div id="raiseModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-50 overflow-y-auto">
  <div class="bg-white rounded-2xl max-w-3xl w-full mx-4 my-8 p-6 shadow-2xl max-h-[90vh] overflow-y-auto">
    <div class="flex items-center justify-between mb-2 sticky top-0 bg-white pb-2 border-b border-slate-100">
      <h2 class="text-2xl font-bold text-slate-800">ğŸ’° Raise Follow-On Funding</h2>
      <button onclick="game.closeRaiseModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
    </div>
    <div class="flex items-center gap-4 mb-4 text-sm">
      <span class="text-slate-600">Valuation: <span id="raiseCurrentVal" class="font-bold text-emerald-600">Â£0k</span></span>
      <span class="text-slate-600">Your Equity: <span id="raiseCurrentEquity" class="font-bold">0%</span></span>
    </div>
    
    <!-- Competitive Position Panel -->
    <div id="raiseCompetitivePanel" class="mb-4 hidden"></div>
    
    <div id="raiseOptions" class="space-y-3 mb-4"></div>
    
    <div class="bg-slate-50 rounded-lg p-3 text-xs text-slate-600">
      <strong>Note:</strong> You can raise once per milestone. Complete milestones to unlock new funding rounds. Your competitive position affects investor terms.
    </div>
  </div>
</div>

<!-- FINANCE DETAILS MODAL -->
<div id="financeDetailsModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-50 overflow-y-auto p-4">
  <div class="bg-white rounded-2xl max-w-lg w-full mx-auto my-8 shadow-2xl">
    <!-- Header -->
    <div id="financeModalHeader" class="px-6 py-4 rounded-t-2xl bg-gradient-to-r from-emerald-600 to-green-600">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-bold text-white">ğŸ’° Financial Details</h2>
        <button onclick="game.closeFinanceDetailsModal()" class="text-white/70 hover:text-white text-2xl">&times;</button>
      </div>
      <p id="financeModalSubtitle" class="text-sm text-white/80 mt-1">Your company's financial health</p>
    </div>
    
    <!-- Content -->
    <div class="p-6 space-y-4">
      <!-- Key Metrics -->
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-slate-50 rounded-xl p-4 text-center">
          <div class="text-xs text-slate-500 uppercase mb-1">Cash</div>
          <div id="finDetailCash" class="text-2xl font-bold text-slate-800 font-mono">Â£420k</div>
        </div>
        <div class="bg-slate-50 rounded-xl p-4 text-center">
          <div class="text-xs text-slate-500 uppercase mb-1">Runway</div>
          <div id="finDetailRunway" class="text-2xl font-bold font-mono">8 QTR</div>
        </div>
      </div>
      
      <!-- Burn & Revenue -->
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-rose-50 rounded-xl p-4 text-center">
          <div class="text-xs text-rose-600 uppercase mb-1">Burn Rate</div>
          <div id="finDetailBurn" class="text-xl font-bold text-rose-700 font-mono">Â£50k/q</div>
        </div>
        <div class="bg-emerald-50 rounded-xl p-4 text-center">
          <div class="text-xs text-emerald-600 uppercase mb-1">Revenue</div>
          <div id="finDetailRevenue" class="text-xl font-bold text-emerald-700 font-mono">Â£0k/q</div>
        </div>
      </div>
      
      <!-- Runway Visualization -->
      <div class="bg-slate-100 rounded-xl p-4">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm font-medium text-slate-700">Runway Visualization</span>
          <span id="finDetailRunwayStatus" class="text-xs px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700">Healthy</span>
        </div>
        <div id="finDetailRunwayBar" class="flex gap-1 mb-1">
          <!-- 8 segments -->
        </div>
        <div class="text-xs text-slate-500">Each segment = 1 quarter</div>
      </div>
      
      <!-- Cash Projection -->
      <div class="bg-slate-800 rounded-xl p-4 text-white">
        <div class="flex items-center justify-between mb-3">
          <div class="text-sm font-medium">ğŸ“Š 4-Quarter Forecast</div>
          <button onclick="game.resetForecastAssumptions()" class="text-xs text-slate-400 hover:text-white">Reset</button>
        </div>
        
        <!-- Visual Forecast Chart -->
        <div id="forecastChartContainer" class="bg-slate-700/50 rounded-lg p-3 mb-4">
          <svg id="forecastChart" width="100%" height="80" class="overflow-visible">
            <!-- Chart rendered by JS -->
          </svg>
          <div class="flex justify-between text-[10px] text-slate-400 mt-1">
            <span>Now</span>
            <span>Q+1</span>
            <span>Q+2</span>
            <span>Q+3</span>
            <span>Q+4</span>
          </div>
        </div>
        
        <!-- Forecast Summary -->
        <div id="forecastSummary" class="grid grid-cols-2 gap-3 mb-4">
          <div class="bg-slate-700/50 rounded-lg p-2 text-center">
            <div class="text-[10px] text-slate-400">End Cash</div>
            <div id="forecastEndCash" class="font-bold font-mono">Â£270k</div>
          </div>
          <div class="bg-slate-700/50 rounded-lg p-2 text-center">
            <div class="text-[10px] text-slate-400">Runway</div>
            <div id="forecastEndRunway" class="font-bold font-mono">5 QTR</div>
          </div>
        </div>
        
        <!-- What-If Sliders -->
        <div class="space-y-3">
          <div class="text-xs text-slate-400 uppercase tracking-wide flex items-center gap-2">
            <span>ğŸ›ï¸</span> What-If Scenarios
          </div>
          
          <!-- Burn Adjustment Slider -->
          <div class="bg-slate-700/30 rounded-lg p-3">
            <div class="flex items-center justify-between mb-2">
              <label class="text-xs text-slate-300">Burn Rate Change</label>
              <span id="burnAdjustValue" class="text-xs font-mono text-amber-400">0%</span>
            </div>
            <input type="range" id="burnAdjustSlider" 
                   min="-30" max="30" value="0" step="5"
                   class="w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer slider-thumb"
                   oninput="game.updateForecast()">
            <div class="flex justify-between text-[9px] text-slate-500 mt-1">
              <span>Cut costs</span>
              <span>Current</span>
              <span>Hire more</span>
            </div>
          </div>
          
          <!-- Revenue Growth Slider -->
          <div class="bg-slate-700/30 rounded-lg p-3">
            <div class="flex items-center justify-between mb-2">
              <label class="text-xs text-slate-300">Revenue Outlook</label>
              <span id="revenueOutlookValue" class="text-xs font-mono text-emerald-400">Baseline</span>
            </div>
            <input type="range" id="revenueOutlookSlider" 
                   min="0" max="2" value="1" step="1"
                   class="w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer slider-thumb"
                   oninput="game.updateForecast()">
            <div class="flex justify-between text-[9px] text-slate-500 mt-1">
              <span>ğŸ˜Ÿ Pessimistic</span>
              <span>ğŸ“Š Baseline</span>
              <span>ğŸš€ Optimistic</span>
            </div>
          </div>
        </div>
        
        <!-- Scenario Impact -->
        <div id="scenarioImpact" class="mt-3 p-2 rounded-lg bg-slate-700/30 text-center hidden">
          <span id="scenarioImpactText" class="text-xs text-slate-300"></span>
        </div>
      </div>
      
      <!-- Revenue vs Target Chart (shown when revenue model active) -->
      <div id="finDetailRevenueSection" class="hidden">
        <div class="flex items-center justify-between mb-2">
          <h3 class="font-bold text-slate-800 flex items-center gap-2">
            ğŸ“ˆ Revenue vs Target
          </h3>
          <span id="finDetailRevenueStatus" class="text-xs px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700">On Track</span>
        </div>
        
        <div class="bg-slate-50 rounded-xl p-4 border border-slate-200">
          <!-- Chart -->
          <div id="finDetailChart" class="w-full" style="height: 180px;">
            <!-- SVG chart rendered by JS -->
          </div>
          
          <!-- Legend -->
          <div class="flex items-center justify-center gap-6 mt-3 text-xs text-slate-600">
            <div class="flex items-center gap-2">
              <div class="w-5 h-0.5 bg-slate-400" style="border-top: 2px dashed #94a3b8;"></div>
              <span>Target</span>
            </div>
            <div class="flex items-center gap-2">
              <div class="w-5 h-1 bg-emerald-500 rounded"></div>
              <span>Actual</span>
            </div>
            <div class="flex items-center gap-2">
              <div class="w-5 h-3 bg-amber-200 rounded opacity-60"></div>
              <span>Tolerance Band</span>
            </div>
          </div>
          
          <!-- Current vs Target summary -->
          <div class="grid grid-cols-2 gap-3 mt-4 pt-3 border-t border-slate-200">
            <div class="text-center">
              <div class="text-xs text-slate-500">Current Quarterly Revenue</div>
              <div id="finDetailCurrentRev" class="font-bold text-emerald-700 font-mono">Â£0k</div>
            </div>
            <div class="text-center">
              <div class="text-xs text-slate-500">Target This Quarter</div>
              <div id="finDetailTargetRev" class="font-bold text-slate-700 font-mono">Â£0k</div>
            </div>
          </div>
          
          <!-- Variance indicator -->
          <div id="finDetailVariance" class="mt-3 text-center text-sm">
            <span class="text-slate-500">Variance: </span>
            <span id="finDetailVarianceValue" class="font-bold text-emerald-600">+0%</span>
          </div>
        </div>
      </div>
      
      <!-- Financial Basics Help (collapsible) -->
      <div class="border border-slate-200 rounded-xl overflow-hidden">
        <button onclick="game.toggleFinancialHelp()" class="w-full flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="font-medium text-slate-700 flex items-center gap-2">
            <span>ğŸ“š</span> Financial Basics
          </span>
          <span id="finHelpToggle" class="text-slate-400 transition-transform">â–¼</span>
        </button>
        <div id="finHelpContent" class="hidden p-4 bg-white text-sm text-slate-600 space-y-3">
          <div>
            <div class="font-medium text-slate-800 mb-1">ğŸ’µ Cash</div>
            <p>Money in your bank account. When it hits zero, game over.</p>
          </div>
          <div>
            <div class="font-medium text-slate-800 mb-1">ğŸ”¥ Burn Rate</div>
            <p>How much money you spend each quarter on salaries, operations, and other costs.</p>
          </div>
          <div>
            <div class="font-medium text-slate-800 mb-1">â±ï¸ Runway</div>
            <p>How many quarters you can survive at your current burn rate. Runway = Cash Ã· Burn.</p>
          </div>
          <div>
            <div class="font-medium text-slate-800 mb-1">ğŸ“ˆ Revenue</div>
            <p>Money coming in from customers. When revenue exceeds burn, you're profitable!</p>
          </div>
          <div>
            <div class="font-medium text-slate-800 mb-1">ğŸ¯ Revenue Target</div>
            <p>What investors expect you to achieve. Staying on track improves funding terms; falling behind makes raising harder.</p>
          </div>
          <div>
            <div class="font-medium text-slate-800 mb-1">ğŸ“Š Tolerance Band</div>
            <p>The amber zone around your target. Being slightly below target is acceptable, but dropping below the band signals trouble.</p>
          </div>
        </div>
      </div>
      
      <!-- Advice -->
      <div class="bg-indigo-50 rounded-xl p-4 border border-indigo-200">
        <div class="flex items-start gap-3">
          <span class="text-xl">ğŸ’¡</span>
          <div>
            <div class="font-medium text-slate-800 mb-1">Financial Tip</div>
            <p id="finDetailAdvice" class="text-sm text-slate-600">Your runway looks healthy. Focus on growth!</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="px-6 py-4 bg-slate-50 rounded-b-2xl flex gap-3">
      <button id="finDetailRaiseBtn" onclick="game.closeFinanceDetailsModal(); game.showRaiseModal();" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-3 rounded-xl font-bold transition-colors">
        ğŸ’° Raise Funding
      </button>
      <button onclick="game.closeFinanceDetailsModal()" class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 py-3 rounded-xl font-bold transition-colors">
        Close
      </button>
    </div>
  </div>
</div>

<!-- HELP MODAL -->
<div id="helpModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-50 overflow-y-auto p-4">
  <div class="bg-white rounded-2xl max-w-2xl w-full mx-auto my-8 shadow-2xl max-h-[90vh] overflow-hidden flex flex-col">
    <!-- Header -->
    <div class="flex items-center justify-between p-4 border-b border-slate-200 bg-gradient-to-r from-indigo-500 to-purple-600">
      <h2 class="text-xl font-bold text-white">ğŸ“š How to Play</h2>
      <button onclick="game.closeHelpModal()" class="text-white/80 hover:text-white text-2xl">&times;</button>
    </div>
    
    <!-- Tabs -->
    <div class="flex border-b border-slate-200 bg-slate-50 overflow-x-auto">
      <button onclick="game.showHelpTab('overview')" class="help-tab px-4 py-2 text-sm font-medium text-slate-600 hover:text-indigo-600 border-b-2 border-transparent whitespace-nowrap" data-tab="overview">Overview</button>
      <button onclick="game.showHelpTab('ap')" class="help-tab px-4 py-2 text-sm font-medium text-slate-600 hover:text-indigo-600 border-b-2 border-transparent whitespace-nowrap" data-tab="ap">Attention Points</button>
      <button onclick="game.showHelpTab('money')" class="help-tab px-4 py-2 text-sm font-medium text-slate-600 hover:text-indigo-600 border-b-2 border-transparent whitespace-nowrap" data-tab="money">Money</button>
      <button onclick="game.showHelpTab('milestones')" class="help-tab px-4 py-2 text-sm font-medium text-slate-600 hover:text-indigo-600 border-b-2 border-transparent whitespace-nowrap" data-tab="milestones">Milestones</button>
      <button onclick="game.showHelpTab('team')" class="help-tab px-4 py-2 text-sm font-medium text-slate-600 hover:text-indigo-600 border-b-2 border-transparent whitespace-nowrap" data-tab="team">Team</button>
      <button onclick="game.showHelpTab('faq')" class="help-tab px-4 py-2 text-sm font-medium text-slate-600 hover:text-indigo-600 border-b-2 border-transparent whitespace-nowrap" data-tab="faq">â“ FAQ</button>
    </div>
    
    <!-- Content -->
    <div class="p-5 overflow-y-auto flex-1">
      <!-- Overview Tab -->
      <div id="helpContent-overview" class="help-content">
        <h3 class="font-bold text-lg text-slate-800 mb-3">ğŸ¯ Goal: Build a Successful AI Startup</h3>
        <p class="text-slate-600 mb-4">Complete <strong>3 milestones</strong> before running out of cash to win!</p>
        
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div class="bg-emerald-50 rounded-lg p-3 border border-emerald-200">
            <div class="font-bold text-emerald-800 mb-1">âœ… You Win If:</div>
            <ul class="text-sm text-emerald-700 space-y-1">
              <li>â€¢ Complete all 3 milestones</li>
              <li>â€¢ Choose your exit (sell, scale, etc.)</li>
            </ul>
          </div>
          <div class="bg-rose-50 rounded-lg p-3 border border-rose-200">
            <div class="font-bold text-rose-800 mb-1">ğŸ’€ You Lose If:</div>
            <ul class="text-sm text-rose-700 space-y-1">
              <li>â€¢ Cash hits zero (bankruptcy)</li>
              <li>â€¢ Miss a milestone deadline</li>
            </ul>
          </div>
        </div>
        
        <h4 class="font-bold text-slate-800 mb-2">Each Quarter You:</h4>
        <ol class="text-slate-600 space-y-2 mb-4">
          <li><span class="font-bold text-indigo-600">1.</span> Review decisions from your 3 department heads</li>
          <li><span class="font-bold text-indigo-600">2.</span> Select choices (each costs Attention Points)</li>
          <li><span class="font-bold text-indigo-600">3.</span> Commit to end the quarter</li>
          <li><span class="font-bold text-indigo-600">4.</span> Pay your burn rate and see results</li>
        </ol>
        
        <div class="bg-amber-50 rounded-lg p-3 border border-amber-200">
          <div class="font-bold text-amber-800 mb-1">ğŸ’¡ Pro Tips:</div>
          <ul class="text-sm text-amber-700 space-y-1">
            <li>â€¢ Focus on metrics that match your current milestone</li>
            <li>â€¢ Keep runway above 3 quarters when possible</li>
            <li>â€¢ Happy executives give better advice</li>
          </ul>
        </div>
      </div>
      
      <!-- AP Tab -->
      <div id="helpContent-ap" class="help-content hidden">
        <h3 class="font-bold text-lg text-slate-800 mb-3">âš¡ Attention Points (AP)</h3>
        <p class="text-slate-600 mb-3"><strong>AP represents your managerial attention</strong>-the scarcest resource in any startup. You can't do everything, so every quarter you must choose where to focus while other opportunities pass by.</p>
        <p class="text-slate-600 mb-4">Every choice costs AP. The game forces you to prioritise: what deserves your attention right now?</p>
        
        <div class="bg-slate-100 rounded-lg p-4 mb-4">
          <div class="font-bold text-slate-800 mb-2">Your AP Budget:</div>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between items-center">
              <span class="text-slate-600">Base AP per quarter:</span>
              <span class="font-bold text-slate-800">5 AP</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-600">Staff bonus (3+ staff):</span>
              <span class="font-bold text-emerald-600">+1 to +3 AP</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-600">Banked from last quarter:</span>
              <span class="font-bold text-amber-600">up to 2 AP</span>
            </div>
          </div>
        </div>
        
        <h4 class="font-bold text-slate-800 mb-2">Staff AP Bonus:</h4>
        <div class="grid grid-cols-4 gap-2 mb-4">
          <div class="text-center p-2 bg-slate-200 rounded-lg">
            <div class="text-xs text-slate-500">1-2 staff</div>
            <div class="font-bold text-slate-600">+0 AP</div>
          </div>
          <div class="text-center p-2 bg-emerald-100 rounded-lg">
            <div class="text-xs text-emerald-600">3-5 staff</div>
            <div class="font-bold text-emerald-700">+1 AP</div>
          </div>
          <div class="text-center p-2 bg-emerald-200 rounded-lg">
            <div class="text-xs text-emerald-600">6-8 staff</div>
            <div class="font-bold text-emerald-700">+2 AP</div>
          </div>
          <div class="text-center p-2 bg-emerald-300 rounded-lg">
            <div class="text-xs text-emerald-700">9+ staff</div>
            <div class="font-bold text-emerald-800">+3 AP</div>
          </div>
        </div>
        
        <div class="bg-indigo-50 rounded-lg p-3 border border-indigo-200">
          <div class="font-bold text-indigo-800 mb-1">ğŸ¦ AP Banking:</div>
          <p class="text-sm text-indigo-700">Unused AP carries over to the next quarter (max 2). Save up for big decisions!</p>
        </div>
      </div>
      
      <!-- Money Tab -->
      <div id="helpContent-money" class="help-content hidden">
        <h3 class="font-bold text-lg text-slate-800 mb-3">ğŸ’° Cash, Burn & Runway</h3>
        
        <div class="space-y-4 mb-4">
          <div class="bg-emerald-50 rounded-lg p-3 border border-emerald-200">
            <div class="font-bold text-emerald-800">ğŸ’µ Cash</div>
            <p class="text-sm text-emerald-700">Your available money. Some choices cost cash. Hiring costs Â£50k. If this hits zero, you're bankrupt!</p>
          </div>
          
          <div class="bg-rose-50 rounded-lg p-3 border border-rose-200">
            <div class="font-bold text-rose-800">ğŸ”¥ Burn Rate</div>
            <p class="text-sm text-rose-700">How much cash you spend per quarter automatically. Each staff member adds Â£25k/quarter to burn.</p>
          </div>
          
          <div class="bg-amber-50 rounded-lg p-3 border border-amber-200">
            <div class="font-bold text-amber-800">â± Runway</div>
            <p class="text-sm text-amber-700">Quarters until bankruptcy (Cash Ã· Burn). Red = danger! Raise funding or cut costs.</p>
          </div>
          
          <div class="bg-sky-50 rounded-lg p-3 border border-sky-200">
            <div class="font-bold text-sky-800">ğŸ“ˆ Valuation</div>
            <p class="text-sm text-sky-700">Your company's worth. Higher valuation = give up less equity when raising. Grows with milestones and strong metrics.</p>
          </div>
        </div>
        
        <h4 class="font-bold text-slate-800 mb-2">ğŸ“Š Revenue Terms:</h4>
        <div class="space-y-2 mb-4">
          <div class="bg-indigo-50 rounded-lg p-3 border border-indigo-200">
            <div class="font-bold text-indigo-800">ARR (Annual Recurring Revenue)</div>
            <p class="text-sm text-indigo-700">Your yearly subscription income from customers. The key metric investors use to value SaaS companies. Calculated as quarterly revenue Ã— 4.</p>
          </div>
          
          <div class="bg-violet-50 rounded-lg p-3 border border-violet-200">
            <div class="font-bold text-violet-800">MRR (Monthly Recurring Revenue)</div>
            <p class="text-sm text-violet-700">Monthly subscription income. ARR Ã· 12. Some investors prefer this for tracking growth month-to-month.</p>
          </div>
          
          <div class="bg-teal-50 rounded-lg p-3 border border-teal-200">
            <div class="font-bold text-teal-800">Net Contribution</div>
            <p class="text-sm text-teal-700">Revenue minus customer support costs. What actually improves your cash position each quarter.</p>
          </div>
        </div>
        
        <h4 class="font-bold text-slate-800 mb-2">Raising Funding:</h4>
        <ul class="text-sm text-slate-600 space-y-1">
          <li>â€¢ Trade equity for cash injection</li>
          <li>â€¢ Better metrics = higher valuation = less dilution</li>
          <li>â€¢ Can only raise once every 4 quarters</li>
          <li>â€¢ New investors may have conflicting preferences</li>
        </ul>
      </div>
      
      <!-- Milestones Tab -->
      <div id="helpContent-milestones" class="help-content hidden">
        <h3 class="font-bold text-lg text-slate-800 mb-3">ğŸ¯ Milestones</h3>
        <p class="text-slate-600 mb-4">Milestones are your key objectives. Complete all 3 to win!</p>
        
        <div class="bg-slate-100 rounded-lg p-4 mb-4">
          <div class="font-bold text-slate-800 mb-2">Each Milestone Has:</div>
          <ul class="text-sm text-slate-600 space-y-2">
            <li><span class="font-bold text-indigo-600">Requirements:</span> Metrics you need to achieve (e.g., Science > 40)</li>
            <li><span class="font-bold text-rose-600">Deadline:</span> Quarters to complete it (miss = game over!)</li>
            <li><span class="font-bold text-emerald-600">Rewards:</span> Cash bonus and valuation boost when completed</li>
          </ul>
        </div>
        
        <h4 class="font-bold text-slate-800 mb-2">The Four Metrics:</h4>
        <div class="grid grid-cols-2 gap-2 mb-4">
          <div class="bg-blue-50 rounded-lg p-2 border border-blue-200">
            <span class="font-bold text-blue-700">ğŸ”¬ Science:</span>
            <span class="text-sm text-blue-600">Research quality</span>
          </div>
          <div class="bg-emerald-50 rounded-lg p-2 border border-emerald-200">
            <span class="font-bold text-emerald-700">ğŸ’» Dev:</span>
            <span class="text-sm text-emerald-600">Product & engineering</span>
          </div>
          <div class="bg-purple-50 rounded-lg p-2 border border-purple-200">
            <span class="font-bold text-purple-700">ğŸ“£ Marketing:</span>
            <span class="text-sm text-purple-600">Sales & growth</span>
          </div>
          <div class="bg-amber-50 rounded-lg p-2 border border-amber-200">
            <span class="font-bold text-amber-700">ğŸ‘¥ HR:</span>
            <span class="text-sm text-amber-600">Team & culture</span>
          </div>
        </div>
        
        <div class="bg-indigo-50 rounded-lg p-3 border border-indigo-200">
          <div class="font-bold text-indigo-800 mb-1">ğŸ’¡ Strategy:</div>
          <p class="text-sm text-indigo-700">Focus your AP on choices that boost the metrics your current milestone needs!</p>
        </div>
      </div>
      
      <!-- Team Tab -->
      <div id="helpContent-team" class="help-content hidden">
        <h3 class="font-bold text-lg text-slate-800 mb-3">ğŸ‘¥ Your Team</h3>
        
        <h4 class="font-bold text-slate-800 mb-2">Executives (Department Heads):</h4>
        <p class="text-slate-600 mb-3">You have 3 executives who present decisions each quarter:</p>
        <div class="grid grid-cols-3 gap-2 mb-4">
          <div class="bg-blue-50 rounded-lg p-2 text-center border border-blue-200">
            <div class="text-2xl mb-1">ğŸ”¬</div>
            <div class="font-bold text-blue-700 text-sm">Research</div>
          </div>
          <div class="bg-emerald-50 rounded-lg p-2 text-center border border-emerald-200">
            <div class="text-2xl mb-1">ğŸ’»</div>
            <div class="font-bold text-emerald-700 text-sm">Development</div>
          </div>
          <div class="bg-purple-50 rounded-lg p-2 text-center border border-purple-200">
            <div class="text-2xl mb-1">ğŸ“£</div>
            <div class="font-bold text-purple-700 text-sm">Marketing</div>
          </div>
        </div>
        
        <h4 class="font-bold text-slate-800 mb-2">Executive Mood:</h4>
        <p class="text-slate-600 mb-3">Executives have moods that affect what events they bring to you:</p>
        <div class="space-y-2 mb-3 text-sm">
          <div class="flex items-center gap-2">
            <span class="px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full">ğŸ˜Š Happy</span>
            <span class="text-slate-600">More likely to bring opportunities with better outcomes</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="px-2 py-1 bg-slate-100 text-slate-700 rounded-full">ğŸ˜ Neutral</span>
            <span class="text-slate-600">Random mix of events</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="px-2 py-1 bg-amber-100 text-amber-700 rounded-full">ğŸ˜Ÿ Frustrated</span>
            <span class="text-slate-600">More likely to bring problems and challenges</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="px-2 py-1 bg-rose-100 text-rose-700 rounded-full">ğŸ˜  Upset</span>
            <span class="text-slate-600">Significantly more likely to bring difficult situations</span>
          </div>
        </div>
        <p class="text-slate-500 text-xs">Mood improves when you invest in their domain. Passing on decisions lowers mood.</p>
        
        <h4 class="font-bold text-slate-800 mb-2">Staff:</h4>
        <ul class="text-sm text-slate-600 space-y-1 mb-4">
          <li><span class="font-bold">Hiring:</span> Â£50k + adds Â£25k/quarter burn</li>
          <li><span class="font-bold">Firing:</span> Â£40k severance, reduces burn by Â£25k/quarter</li>
          <li><span class="font-bold">AP Bonus:</span> 1 hire = +1 AP, 3 hires = +2 AP, 5 hires = +3 AP</li>
          <li><span class="font-bold">Integration:</span> New hires need 1 quarter to integrate</li>
        </ul>
        
        <div class="bg-amber-50 rounded-lg p-3 border border-amber-200">
          <div class="font-bold text-amber-800 mb-1">ğŸ“‹ Hiring Limits:</div>
          <p class="text-sm text-amber-700">Max 2 hires per quarter. 2nd hire = extra AP penalty. Two consecutive quarters of 2 hires = severe strain penalty.</p>
        </div>
      </div>
      
      <!-- FAQ Tab -->
      <div id="helpContent-faq" class="help-content hidden">
        <h3 class="font-bold text-lg text-slate-800 mb-3">â“ Frequently Asked Questions</h3>
        
        <div class="space-y-3">
          <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
            <div class="font-bold text-slate-800 text-sm mb-1">My progress disappeared!</div>
            <p class="text-slate-600 text-sm">The game doesn't save to the cloud. Complete it in one sitting (45-90 min). You can leave the browser tab open to pause.</p>
          </div>
          
          <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
            <div class="font-bold text-slate-800 text-sm mb-1">I keep failingâ€”is the game broken?</div>
            <p class="text-slate-600 text-sm">No! Most players fail their first attempt. 90% of real startups fail too. Each failure teaches you something. Try a different strategy.</p>
          </div>
          
          <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
            <div class="font-bold text-slate-800 text-sm mb-1">What's the "right" strategy to win?</div>
            <p class="text-slate-600 text-sm">There isn't one. Every choice involves trade-offs. Learning to navigate uncertainty is the pointâ€”not finding an optimal solution.</p>
          </div>
          
          <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
            <div class="font-bold text-slate-800 text-sm mb-1">Competitors keep winningâ€”is that fair?</div>
            <p class="text-slate-600 text-sm">Yes. Rivals have strong strategies and some luck. If they get ahead, consider pivoting rather than racing harder.</p>
          </div>
          
          <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
            <div class="font-bold text-slate-800 text-sm mb-1">How do I get more cash?</div>
            <p class="text-slate-600 text-sm">Three ways: (1) Raise funding from investors, (2) Complete milestones (each pays Â£150k), (3) Reduce burn rate by hiring fewer people.</p>
          </div>
          
          <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
            <div class="font-bold text-slate-800 text-sm mb-1">Why does luck matter so much?</div>
            <p class="text-slate-600 text-sm">Because it does in real entrepreneurship! Good decisions improve your odds but don't guarantee success. The skill is making good choices despite uncertainty.</p>
          </div>
          
          <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
            <div class="font-bold text-slate-800 text-sm mb-1">How long does a playthrough take?</div>
            <p class="text-slate-600 text-sm">Typically 45-90 minutes depending on how carefully you read events and consider decisions.</p>
          </div>
          
          <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
            <div class="font-bold text-slate-800 text-sm mb-1">How do I restart?</div>
            <p class="text-slate-600 text-sm">Refresh the page (F5 or Cmd+R). You'll start fresh with new choices available.</p>
          </div>
        </div>
        
        <div class="bg-amber-50 rounded-lg p-3 border border-amber-200 mt-4">
          <div class="font-bold text-amber-800 mb-1">ğŸ’¡ Pro Tips:</div>
          <ul class="text-sm text-amber-700 space-y-1">
            <li>â€¢ Read the aside text on eventsâ€”it hints at trade-offs you might miss</li>
            <li>â€¢ You can pass on actions to save AP for later</li>
            <li>â€¢ Click competitor names to see detailed intelligence about rivals</li>
          </ul>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="p-4 border-t border-slate-200 bg-slate-50">
      <button onclick="game.closeHelpModal()" class="w-full px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg">
        Got It!
      </button>
    </div>
  </div>
</div>

<script>
// =============================================================================
// THE AI VENTURE GAME - REDESIGNED
// =============================================================================

// =============================================================================
// LOCALIZATION SYSTEM
// =============================================================================

const REGIONS = {
  uk: {
    id: "uk",
    name: "United Kingdom",
    currency: "Â£",
    currencyName: "GBP",
    currencyMultiplier: 1,
    
    // Major cities for startup locations
    cities: {
      primary: "London",
      tech: "Cambridge",
      research: "Oxford", 
      financial: "London",
      northern: "Manchester",
      scottish: "Edinburgh",
      creative: "Bristol",
      industrial: "Birmingham",
      emerging: "Leeds",
      secondary: ["Glasgow", "Newcastle", "Sheffield", "Southampton", "Liverpool", "Brighton", "Cardiff"]
    },
    
    // Universities
    universities: {
      elite1: "Cambridge",
      elite2: "Oxford",
      london1: "Imperial College",
      london2: "UCL",
      london3: "King's College London",
      business: "London Business School",
      scottish: "University of Edinburgh",
      northern: "University of Manchester",
      technical: "Imperial",
      research: "Cambridge"
    },
    
    // Regulatory bodies
    regulators: {
      health: { name: "MHRA", full: "Medicines and Healthcare products Regulatory Agency" },
      cyber: { name: "NCSC", full: "National Cyber Security Centre" },
      data: { name: "ICO", full: "Information Commissioner's Office" },
      financial: { name: "FCA", full: "Financial Conduct Authority" },
      immigration: { name: "Home Office", full: "UK Home Office" }
    },
    
    // Healthcare system
    healthcare: {
      name: "NHS",
      full: "National Health Service",
      trust: "NHS Trust",
      digital: "NHS Digital"
    },
    
    // Stock market
    stockIndex: "FTSE 100",
    stockIndexDesc: "Britain's largest public corporations",
    
    // Government funding
    government: {
      researchCouncil: "UKRI",
      innovationAgency: "Innovate UK",
      grantBody: "ESRC",
      devBank: "British Business Bank",
      taxCredit: "R&D Tax Credits",
      investmentScheme: "Enterprise Investment Scheme (EIS)"
    },
    
    // Immigration/Visa terms
    immigration: {
      workVisa: "Skilled Worker visa",
      sponsorLicense: "sponsor licence",
      rightToWork: "right to work",
      settledStatus: "settled status",
      immigrationAuth: "Immigration Authority",
      visaRenewal: "visa renewal"
    },
    
    // Cultural references
    culture: {
      tvInvestorShow: "Dragons' Den",
      bacheloretteParty: "hen do",
      bachelorParty: "stag do",
      courthouse: "Crown Court",
      trainOperator: "train",
      remoteLocation: "Penzance",
      partyCity: "Bath",
      partyDestination: "Prague",
      chocolateBrand: "Hotel Chocolat"
    },
    
    // Bank
    centralBank: "Bank of England",
    
    // Government titles
    titles: {
      financeMinister: "Chancellor",
      leader: "Prime Minister"
    },
    
    // Common first names (mix for diversity)
    firstNames: {
      male: ["James", "William", "Oliver", "Thomas", "Mohammed", "Raj", "Kwame", "Yusuf", "Chen", "Marcus", "David", "Richard", "Michael", "Robert", "Ahmed"],
      female: ["Emma", "Sarah", "Priya", "Aoife", "Fatima", "Yuki", "Charlotte", "Sophie", "Olivia", "Eleanor", "Jennifer", "Lisa", "Rebecca", "Hannah", "Zoe"]
    },
    
    // Common surnames
    surnames: ["Smith", "Jones", "Williams", "Brown", "Taylor", "Wilson", "Davies", "Evans", "Thomas", "Johnson", "Roberts", "Walker", "Wright", "Robinson", "Thompson", "White", "Edwards", "Green", "Lewis", "Wood", "Harris", "Martin", "Jackson", "Clarke", "Patel", "Khan", "Singh", "Shah", "Chen", "Wang", "Murphy", "O'Brien", "McCarthy", "Okonkwo", "Mensah", "Sharma", "Gupta", "Hassan", "Mitchell", "Richardson", "Franklin", "Sterling", "Thornton", "Blackwood", "Hayes", "Grant", "Webb", "Tanaka", "Petrov"]
  }
};

// Region reference - UK only
const R = REGIONS.uk;
window.R = R;

// Helper to get current region (always returns UK)
function getRegion() {
  return REGIONS.uk;
}

// Currency formatter - uses current region
function formatCurrency(amount) {
  const region = getRegion();
  const converted = Math.round(amount * region.currencyMultiplier);
  return `${region.currency}${converted}k`;
}

// Get localized city
function getCity(type) {
  return R.cities[type] || R.cities.primary;
}

// Get localized university
function getUniversity(type) {
  return R.universities[type] || R.universities.elite1;
}

// Get locations for a venture (UK only)
function getLocations(ventureId) {
  return LOCATIONS[ventureId];
}

// Text passthrough (no localization needed for UK-only version)
function localizeText(text) {
  return text;
}

// =============================================================================

// Custom executive portraits - distinctive SVG illustrations
const PORTRAITS = {
  // RESEARCH
  fatima: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="fatimaGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#e0e7ff"/><stop offset="100%" style="stop-color:#c7d2fe"/></linearGradient></defs>
    <circle cx="40" cy="40" r="38" fill="url(#fatimaGrad)" stroke="#6366f1" stroke-width="2"/>
    <ellipse cx="40" cy="38" rx="22" ry="26" fill="#8B5A2B"/>
    <path d="M18 32 Q25 20 40 18 Q55 20 62 32 Q62 26 55 22 Q40 14 25 22 Q18 26 18 32" fill="#1a1a1a"/>
    <ellipse cx="40" cy="42" rx="16" ry="18" fill="#D4A574"/>
    <circle cx="33" cy="38" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="38" r="2.5" fill="#1a1a1a"/>
    <path d="M35 48 Q40 51 45 48" stroke="#8B4513" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <rect x="30" y="56" width="20" height="12" fill="#6366f1" rx="2"/>
    <circle cx="40" cy="60" r="1.5" fill="white"/>
    <path d="M22 28 Q20 20 28 18" stroke="#c7d2fe" stroke-width="3" fill="none" stroke-linecap="round"/>
  </svg>`,
  
  yuki: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="yukiGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#fce7f3"/><stop offset="100%" style="stop-color:#fbcfe8"/></linearGradient></defs>
    <circle cx="40" cy="40" r="38" fill="url(#yukiGrad)" stroke="#ec4899" stroke-width="2"/>
    <path d="M20 35 Q25 15 40 14 Q55 15 60 35 L58 50 Q55 55 40 56 Q25 55 22 50 Z" fill="#1a1a1a"/>
    <ellipse cx="40" cy="44" rx="15" ry="17" fill="#F5DEB3"/>
    <ellipse cx="33" cy="40" rx="3" ry="2" fill="#1a1a1a"/><ellipse cx="47" cy="40" rx="3" ry="2" fill="#1a1a1a"/>
    <path d="M36 50 Q40 52 44 50" stroke="#CD853F" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <rect x="28" y="58" width="24" height="10" fill="#10b981" rx="2"/>
    <path d="M36 62 L40 58 L44 62" stroke="white" stroke-width="1.5" fill="none"/>
  </svg>`,
  
  kwame: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="kwameGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#fef3c7"/><stop offset="100%" style="stop-color:#fde68a"/></linearGradient></defs>
    <circle cx="40" cy="40" r="38" fill="url(#kwameGrad)" stroke="#f59e0b" stroke-width="2"/>
    <ellipse cx="40" cy="30" rx="18" ry="14" fill="#1a1a1a"/>
    <ellipse cx="40" cy="44" rx="16" ry="18" fill="#6B4423"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M33 48 Q40 54 47 48" stroke="#4a3520" stroke-width="2" fill="none" stroke-linecap="round"/>
    <rect x="22" y="58" width="36" height="12" fill="#1a1a1a" rx="2"/>
    <path d="M32 64 L48 64" stroke="#f59e0b" stroke-width="2"/>
    <rect x="38" y="34" width="4" height="6" fill="#4a3520" rx="1"/>
  </svg>`,

  // DEV
  aoife: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="aoifeGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#dcfce7"/><stop offset="100%" style="stop-color:#bbf7d0"/></linearGradient></defs>
    <circle cx="40" cy="40" r="38" fill="url(#aoifeGrad)" stroke="#22c55e" stroke-width="2"/>
    <path d="M18 40 Q20 18 40 16 Q60 18 62 40 Q60 35 50 34 Q40 38 30 34 Q20 35 18 40" fill="#B8860B"/>
    <ellipse cx="40" cy="44" rx="15" ry="17" fill="#FFE4C4"/>
    <circle cx="33" cy="40" r="2" fill="#22c55e"/><circle cx="47" cy="40" r="2" fill="#22c55e"/>
    <path d="M35 50 Q40 52 45 50" stroke="#CD853F" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <rect x="26" y="58" width="28" height="10" fill="#374151" rx="2"/>
    <text x="40" y="65" text-anchor="middle" fill="#22c55e" font-size="6" font-family="monospace">&lt;/&gt;</text>
  </svg>`,
  
  raj: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="rajGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#e0f2fe"/><stop offset="100%" style="stop-color:#bae6fd"/></linearGradient></defs>
    <circle cx="40" cy="40" r="38" fill="url(#rajGrad)" stroke="#0ea5e9" stroke-width="2"/>
    <path d="M22 38 Q28 22 40 20 Q52 22 58 38 Q54 34 40 33 Q26 34 22 38" fill="#1a1a1a"/>
    <ellipse cx="40" cy="44" rx="15" ry="17" fill="#C68642"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M34 50 Q40 53 46 50" stroke="#8B5A2B" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M28 36 Q32 34 36 36 M44 36 Q48 34 52 36" stroke="#1a1a1a" stroke-width="1" fill="none"/>
    <rect x="28" y="58" width="24" height="10" fill="#0ea5e9" rx="2"/>
    <circle cx="40" cy="63" r="2" fill="white"/>
  </svg>`,
  
  wei: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="weiGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#f3e8ff"/><stop offset="100%" style="stop-color:#e9d5ff"/></linearGradient></defs>
    <circle cx="40" cy="40" r="38" fill="url(#weiGrad)" stroke="#a855f7" stroke-width="2"/>
    <path d="M20 36 Q24 20 40 18 Q56 20 60 36 L55 40 Q40 38 25 40 Z" fill="#1a1a1a"/>
    <ellipse cx="40" cy="44" rx="15" ry="17" fill="#F5DEB3"/>
    <ellipse cx="33" cy="40" rx="2.5" ry="2" fill="#1a1a1a"/><ellipse cx="47" cy="40" rx="2.5" ry="2" fill="#1a1a1a"/>
    <path d="M36 50 Q40 53 44 50" stroke="#CD853F" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <rect x="28" y="58" width="24" height="10" fill="#a855f7" rx="2"/>
    <path d="M33 63 L40 60 L47 63" stroke="white" stroke-width="1.5" fill="none"/>
  </svg>`,

  // MARKETING
  priya: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="priyaGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#fee2e2"/><stop offset="100%" style="stop-color:#fecaca"/></linearGradient></defs>
    <circle cx="40" cy="40" r="38" fill="url(#priyaGrad)" stroke="#ef4444" stroke-width="2"/>
    <path d="M18 42 Q22 16 40 14 Q58 16 62 42 Q58 38 40 36 Q22 38 18 42" fill="#1a1a1a"/>
    <ellipse cx="40" cy="44" rx="15" ry="17" fill="#C68642"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M34 49 Q40 53 46 49" stroke="#8B5A2B" stroke-width="2" fill="none" stroke-linecap="round"/>
    <circle cx="24" cy="44" r="3" fill="#fecaca"/>
    <rect x="26" y="58" width="28" height="10" fill="#ef4444" rx="2"/>
    <path d="M32 63 L40 61 L48 63" stroke="white" stroke-width="1.5" fill="none"/>
  </svg>`,
  
  marcus: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="marcusGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#dbeafe"/><stop offset="100%" style="stop-color:#bfdbfe"/></linearGradient></defs>
    <circle cx="40" cy="40" r="38" fill="url(#marcusGrad)" stroke="#3b82f6" stroke-width="2"/>
    <path d="M24 34 Q28 24 40 22 Q52 24 56 34 Q52 30 40 29 Q28 30 24 34" fill="#4a3728"/>
    <ellipse cx="40" cy="44" rx="16" ry="18" fill="#6B4423"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M35 50 Q40 53 45 50" stroke="#4a3520" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <rect x="30" y="32" width="20" height="2" fill="#4a3728" rx="1"/>
    <rect x="26" y="58" width="28" height="10" fill="#3b82f6" rx="2"/>
    <text x="40" y="65" text-anchor="middle" fill="white" font-size="7" font-family="sans-serif">%</text>
  </svg>`,
  
  emma: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="emmaGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#fef9c3"/><stop offset="100%" style="stop-color:#fef08a"/></linearGradient></defs>
    <circle cx="40" cy="40" r="38" fill="url(#emmaGrad)" stroke="#eab308" stroke-width="2"/>
    <path d="M20 45 Q18 20 40 16 Q62 20 60 45 Q55 35 40 34 Q25 35 20 45" fill="#F4E4BA"/>
    <ellipse cx="40" cy="44" rx="15" ry="17" fill="#FFE4C4"/>
    <circle cx="33" cy="40" r="2.5" fill="#4a90a4"/><circle cx="47" cy="40" r="2.5" fill="#4a90a4"/>
    <path d="M35 50 Q40 52 45 50" stroke="#CD853F" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <rect x="28" y="58" width="24" height="10" fill="#1a1a1a" rx="2"/>
    <path d="M34 62 L38 65 L42 62 L46 65" stroke="#eab308" stroke-width="1.5" fill="none"/>
  </svg>`,

  // HR
  david: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="davidGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#d1fae5"/><stop offset="100%" style="stop-color:#a7f3d0"/></linearGradient></defs>
    <circle cx="40" cy="40" r="38" fill="url(#davidGrad)" stroke="#059669" stroke-width="2"/>
    <ellipse cx="40" cy="28" rx="14" ry="10" fill="#1a1a1a"/>
    <ellipse cx="40" cy="44" rx="16" ry="18" fill="#6B4423"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M35 50 Q40 52 45 50" stroke="#4a3520" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <rect x="24" y="56" width="32" height="14" fill="#374151" rx="2"/>
    <path d="M36 60 L36 66 M40 58 L40 66 M44 60 L44 66" stroke="#059669" stroke-width="1.5"/>
    <rect x="38" y="62" width="4" height="4" fill="#059669"/>
  </svg>`,
  
  sofia: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="sofiaGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#ffe4e6"/><stop offset="100%" style="stop-color:#fecdd3"/></linearGradient></defs>
    <circle cx="40" cy="40" r="38" fill="url(#sofiaGrad)" stroke="#f43f5e" stroke-width="2"/>
    <path d="M16 48 Q18 18 40 14 Q62 18 64 48 Q58 40 40 38 Q22 40 16 48" fill="#4a2c2a"/>
    <ellipse cx="40" cy="44" rx="15" ry="17" fill="#D4A574"/>
    <circle cx="33" cy="40" r="2.5" fill="#4a2c2a"/><circle cx="47" cy="40" r="2.5" fill="#4a2c2a"/>
    <path d="M34 50 Q40 54 46 50" stroke="#8B5A2B" stroke-width="2" fill="none" stroke-linecap="round"/>
    <circle cx="30" cy="46" r="3" fill="#fecdd3" opacity="0.6"/>
    <circle cx="50" cy="46" r="3" fill="#fecdd3" opacity="0.6"/>
    <rect x="28" y="58" width="24" height="10" fill="#f43f5e" rx="2"/>
    <circle cx="40" cy="63" r="2" fill="white"/>
  </svg>`,
  
  aisha: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="aishaGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#fae8ff"/><stop offset="100%" style="stop-color:#f5d0fe"/></linearGradient></defs>
    <circle cx="40" cy="40" r="38" fill="url(#aishaGrad)" stroke="#d946ef" stroke-width="2"/>
    <path d="M18 50 Q16 22 40 16 Q64 22 62 50" fill="#1a1a1a"/>
    <path d="M20 36 Q40 32 60 36 Q58 28 40 24 Q22 28 20 36" fill="#d946ef" opacity="0.3"/>
    <ellipse cx="40" cy="46" rx="14" ry="16" fill="#C68642"/>
    <circle cx="34" cy="42" r="2" fill="#1a1a1a"/><circle cx="46" cy="42" r="2" fill="#1a1a1a"/>
    <path d="M36 52 Q40 54 44 52" stroke="#8B5A2B" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <rect x="28" y="60" width="24" height="8" fill="#d946ef" rx="2"/>
    <circle cx="40" cy="64" r="1.5" fill="white"/>
  </svg>`
};

const getAvatar = (seed) => {
  // Extract the ID from the seed (e.g., "fatima-alrashid-uk" -> "fatima")
  const id = seed.split('-')[0];
  return PORTRAITS[id] || `https://api.dicebear.com/7.x/notionists/svg?seed=${seed}`;
};

// Helper to render avatar - handles both SVG strings and URLs
const renderAvatar = (avatar, name) => {
  if (avatar.startsWith('<svg')) {
    return avatar;
  }
  return `<img src="${avatar}" alt="${name}">`;
};

// ===== DATA =====

// Company logos as inline SVGs
const LOGOS = {
  aether: `<svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="20" cy="20" r="18" stroke="#6366f1" stroke-width="2" fill="#eef2ff"/>
    <path d="M20 8 L20 32 M12 14 Q20 20 12 26 M28 14 Q20 20 28 26" stroke="#6366f1" stroke-width="2" stroke-linecap="round"/>
    <circle cx="20" cy="20" r="4" fill="#6366f1"/>
  </svg>`,
  vanguard: `<svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect x="4" y="12" width="32" height="20" rx="2" stroke="#f97316" stroke-width="2" fill="#fff7ed"/>
    <circle cx="12" cy="28" r="4" stroke="#f97316" stroke-width="2" fill="#fdba74"/>
    <circle cx="28" cy="28" r="4" stroke="#f97316" stroke-width="2" fill="#fdba74"/>
    <path d="M8 16 L20 8 L32 16" stroke="#f97316" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <rect x="16" y="16" width="8" height="6" fill="#f97316" rx="1"/>
  </svg>`,
  quant: `<svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect x="4" y="4" width="32" height="32" rx="4" stroke="#10b981" stroke-width="2" fill="#ecfdf5"/>
    <path d="M8 28 L14 20 L20 24 L26 12 L32 16" stroke="#10b981" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
    <circle cx="14" cy="20" r="2" fill="#10b981"/>
    <circle cx="20" cy="24" r="2" fill="#10b981"/>
    <circle cx="26" cy="12" r="2" fill="#10b981"/>
  </svg>`,
  dream: `<svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="20" cy="20" r="16" stroke="#ec4899" stroke-width="2" fill="#fdf2f8"/>
    <path d="M12 20 Q16 12 20 20 Q24 28 28 20" stroke="#ec4899" stroke-width="2" stroke-linecap="round"/>
    <path d="M14 14 L16 18 M26 14 L24 18" stroke="#ec4899" stroke-width="2" stroke-linecap="round"/>
    <circle cx="20" cy="26" r="3" stroke="#ec4899" stroke-width="2" fill="#f9a8d4"/>
  </svg>`,
  cyber: `<svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="20" cy="20" r="16" stroke="#0ea5e9" stroke-width="2" fill="#f0f9ff"/>
    <path d="M20 8 L20 14 M20 26 L20 32 M8 20 L14 20 M26 20 L32 20" stroke="#0ea5e9" stroke-width="2" stroke-linecap="round"/>
    <circle cx="20" cy="20" r="6" stroke="#0ea5e9" stroke-width="2" fill="#0ea5e9"/>
    <path d="M12 12 L16 16 M28 12 L24 16 M12 28 L16 24 M28 28 L24 24" stroke="#0ea5e9" stroke-width="1.5" stroke-linecap="round"/>
  </svg>`,
  terra: `<svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="20" cy="20" r="16" stroke="#22c55e" stroke-width="2" fill="#f0fdf4"/>
    <ellipse cx="20" cy="20" rx="14" ry="6" stroke="#22c55e" stroke-width="1.5" fill="none"/>
    <ellipse cx="20" cy="20" rx="6" ry="14" stroke="#22c55e" stroke-width="1.5" fill="none"/>
    <circle cx="20" cy="20" r="4" fill="#22c55e"/>
    <path d="M10 14 Q14 12 18 14 M22 26 Q26 28 30 26" stroke="#22c55e" stroke-width="1.5" stroke-linecap="round"/>
  </svg>`,
  legal: `<svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect x="8" y="6" width="24" height="28" rx="2" stroke="#8b5cf6" stroke-width="2" fill="#f5f3ff"/>
    <path d="M12 12 L28 12 M12 18 L28 18 M12 24 L22 24" stroke="#8b5cf6" stroke-width="2" stroke-linecap="round"/>
    <circle cx="26" cy="28" r="4" stroke="#8b5cf6" stroke-width="2" fill="#c4b5fd"/>
    <path d="M24 28 L26 30 L29 26" stroke="#8b5cf6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>`,
  edu: `<svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M20 6 L4 16 L20 26 L36 16 Z" stroke="#f59e0b" stroke-width="2" fill="#fffbeb"/>
    <path d="M10 20 L10 30 Q20 36 30 30 L30 20" stroke="#f59e0b" stroke-width="2" fill="#fef3c7"/>
    <circle cx="20" cy="16" r="4" fill="#f59e0b"/>
    <path d="M36 16 L36 28" stroke="#f59e0b" stroke-width="2" stroke-linecap="round"/>
    <circle cx="36" cy="30" r="2" fill="#f59e0b"/>
  </svg>`
};

// ===== HALL OF FAME - Billionaire Founders =====
const HALL_OF_FAME_LEGENDS = [
  // UK AI & Tech Founders
  { name: "Marcus Chen", company: "CortexAI", year: 2010, valuation: 20, emoji: "ğŸ§ ", bio: "British AI pioneer, acquired by tech giant for Â£400M" },
  { name: "Priya Sharma", company: "Nexus AI", year: 2022, valuation: 4, emoji: "ğŸ¤–", bio: "CortexAI co-founder, now leading enterprise AI" },
  { name: "Tom Blomfield", company: "Monzo", year: 2015, valuation: 5, emoji: "ğŸ’³", bio: "Revolutionising British banking" },
  { name: "Anne Boden", company: "Starling Bank", year: 2014, valuation: 3, emoji: "â­", bio: "Former Allied Irish Banks exec turned fintech founder" },
  { name: "Elena Thornton", company: "CyberShield", year: 2013, valuation: 4, emoji: "ğŸ›¡", bio: "Cambridge-born AI cybersecurity unicorn" },
  { name: "Mike Lynch", company: "Autonomy", year: 1996, valuation: 8, emoji: "ğŸ”", bio: "Britain's first software billionaire" },
  { name: "Hermann Hauser", company: "ARM / Amadeus", year: 1978, valuation: 2, emoji: "ğŸ’¾", bio: "Godfather of British tech, ARM co-founder" },
  { name: "Martha Lane Fox", company: "Lastminute.com", year: 1998, valuation: 1, emoji: "âœˆ", bio: "Dot-com pioneer and digital champion" },
  { name: "Marco De Luca", company: "VideoGen AI", year: 2017, valuation: 2, emoji: "ğŸ¬", bio: "London-based AI video generation" },
  { name: "Taavet Hinrikus", company: "Wise", year: 2011, valuation: 9, emoji: "ğŸ’±", bio: "Estonian-British fintech transforming transfers" },
  { name: "James Hartley", company: "Insight Analytics", year: 2014, valuation: 1, emoji: "ğŸ“Š", bio: "London AI consultancy advising government" },
  
  // Global Tech Icons
  { name: "David Chen", company: "Horizon AI", year: 2015, valuation: 157, emoji: "ğŸŒ", bio: "Leading the generative AI revolution" },
  { name: "Victor Park", company: "SiliconCore", year: 1993, valuation: 1200, emoji: "ğŸ’š", bio: "The godfather of GPU computing" },
  { name: "James Wright", company: "Nova Motors / Stellar Space", year: 2002, valuation: 800, emoji: "ğŸš€", bio: "Serial founder across industries" },
  { name: "Alex Rivera", company: "Helix Social", year: 2004, valuation: 900, emoji: "ğŸ‘¤", bio: "Social media empire builder" },
  { name: "Connor Walsh", company: "PayFlow", year: 2010, valuation: 95, emoji: "ğŸ’³", bio: "Brothers revolutionising payments" },
  { name: "Erik Lindgren", company: "StreamSound", year: 2006, valuation: 70, emoji: "ğŸµ", bio: "Swedish entrepreneur who changed music" },
  { name: "Ryan Foster", company: "StayLocal", year: 2008, valuation: 85, emoji: "ğŸ ", bio: "Designer who reimagined hospitality" },
  { name: "Nathan Brooks", company: "SafeAI Labs", year: 2021, valuation: 18, emoji: "ğŸ”¬", bio: "Building safe, beneficial AI" },
  { name: "Lucas Chen", company: "DataForge AI", year: 2016, valuation: 14, emoji: "ğŸ“", bio: "Youngest self-made billionaire in AI" }
];

const COMPANIES = [
  { id: "aether", name: "Aether BioLabs", desc: "AI-driven protein design for public health system applications. Deep science, high stakes.", archetype: "BioTech", staff: 4, burn: 42, color: "#6366f1", revenueModel: "healthcareProcurement" },
  { id: "vanguard", name: "Vanguard Robotics", desc: "Autonomous robots for UK warehouses. Hardware meets software.", archetype: "Robotics", staff: 4, burn: 50, color: "#f97316", revenueModel: "b2bSaas" },
  { id: "quant", name: "QuantFlow Systems", desc: "AI trading systems for the City. Fast money, faster competition.", archetype: "FinTech", staff: 4, burn: 32, color: "#10b981", revenueModel: "b2bSaas" },
  { id: "dream", name: "DreamScape Studios", desc: "Generative AI for creators. Consumer-facing, culture-shaping.", archetype: "Creative AI", staff: 4, burn: 38, color: "#ec4899", revenueModel: "consumer" },
  { id: "cyber", name: "CyberShield AI", desc: "AI-powered threat detection for UK critical infrastructure. High security, high stakes.", archetype: "CyberSec", staff: 4, burn: 35, color: "#0ea5e9", revenueModel: "b2bSaas" },
  { id: "terra", name: "TerraMind Analytics", desc: "Climate prediction and sustainability AI. Save the planet, build a business.", archetype: "CleanTech", staff: 4, burn: 38, color: "#22c55e", revenueModel: "researchGrants" },
  { id: "legal", name: "LegalMind AI", desc: "Contract analysis and legal research automation. Disrupting the Magic Circle.", archetype: "LegalTech", staff: 4, burn: 32, color: "#8b5cf6", revenueModel: "b2bSaas" },
  { id: "edu", name: "EduSpark AI", desc: "Personalised learning that adapts to every student. EdTech meets AI.", archetype: "EdTech", staff: 4, burn: 35, color: "#f59e0b", revenueModel: "b2bSaas" }
];

// ===== REVENUE MODELS - Business model configurations with projections =====
const REVENUE_MODELS = {
  b2bSaas: {
    id: 'b2bSaas',
    name: 'B2B SaaS',
    description: 'Enterprise sales, high-touch, relationship-driven',
    metrics: {
      avgRevenuePerCustomer: 15,      // Â£15k/quarter per customer (Â£60k/year)
      acquisitionCostBase: 20,        // Â£20k base cost to acquire
      supportCostPerCustomer: 5,      // Â£5k/quarter ongoing support
      baseChurnRate: 0.10,            // 10% quarterly churn
      salesCycleQuarters: 2,          // 2 quarters from lead to close
    },
    staffEffects: {
      marketing: { leadsPerStaff: 0.3, conversionBonus: 0.05 },
      dev: { churnReduction: 0.02, satisfactionBonus: 0.05 },
      research: { dealSizeBonus: 0.10 },
      hr: { supportEfficiency: 0.10, satisfactionBonus: 0.03 }
    },
    projections: {
      conservative: [0, 0, 0, 0, 15, 30, 50, 75, 100, 130, 165, 200, 240, 290, 350, 420],
      balanced: [0, 0, 0, 10, 30, 60, 100, 150, 210, 280, 360, 450, 550, 670, 800, 950],
      ambitious: [0, 0, 20, 50, 100, 180, 280, 400, 550, 720, 900, 1100, 1350, 1650, 2000, 2400]
    },
    investorToleranceBand: 0.3
  },
  
  healthcareProcurement: {
    id: 'healthcareProcurement',
    name: 'Healthcare / Public Sector',
    description: 'Long procurement cycles, regulatory hurdles, large contracts',
    metrics: {
      avgRevenuePerCustomer: 25,
      acquisitionCostBase: 10,
      supportCostPerCustomer: 12,
      baseChurnRate: 0.05,
      salesCycleQuarters: 4,
    },
    staffEffects: {
      marketing: { leadsPerStaff: 0.1, conversionBonus: 0.03 },
      dev: { churnReduction: 0.01, satisfactionBonus: 0.08 },
      research: { dealSizeBonus: 0.15, leadsPerStaff: 0.2 },
      hr: { supportEfficiency: 0.15, satisfactionBonus: 0.05 }
    },
    projections: {
      conservative: [0, 0, 0, 0, 0, 0, 0, 25, 50, 75, 100, 130, 165, 200, 240, 290],
      balanced: [0, 0, 0, 0, 0, 0, 50, 100, 150, 220, 300, 400, 520, 660, 820, 1000],
      ambitious: [0, 0, 0, 0, 0, 100, 200, 350, 500, 700, 950, 1250, 1600, 2000, 2500, 3100]
    },
    investorToleranceBand: 0.4
  },
  
  consumer: {
    id: 'consumer',
    name: 'Consumer Subscription',
    description: 'High-volume, low-price, marketing-intensive',
    metrics: {
      avgRevenuePerCustomer: 0.045,   // Â£45/quarter per user
      acquisitionCostBase: 0.08,
      supportCostPerCustomer: 0.002,
      baseChurnRate: 0.25,
      salesCycleQuarters: 0,
    },
    staffEffects: {
      marketing: { leadsPerStaff: 50, conversionBonus: 0.02 },
      dev: { churnReduction: 0.03, satisfactionBonus: 0.02 },
      research: { dealSizeBonus: 0 },
      hr: { supportEfficiency: 0.05 }
    },
    projections: {
      conservative: [0, 0, 5, 12, 25, 45, 70, 100, 140, 190, 250, 320, 400, 500, 620, 760],
      balanced: [0, 5, 15, 35, 70, 120, 190, 280, 400, 550, 730, 950, 1200, 1500, 1850, 2250],
      ambitious: [0, 10, 40, 100, 200, 350, 550, 800, 1100, 1500, 2000, 2600, 3300, 4200, 5300, 6600]
    },
    investorToleranceBand: 0.25
  },
  
  researchGrants: {
    id: 'researchGrants',
    name: 'Research & Grants',
    description: 'Grant-funded, project-based, academic partnerships',
    metrics: {
      avgRevenuePerCustomer: 20,
      acquisitionCostBase: 15,
      supportCostPerCustomer: 8,
      baseChurnRate: 0,
      salesCycleQuarters: 3,
    },
    staffEffects: {
      marketing: { leadsPerStaff: 0.1 },
      dev: { satisfactionBonus: 0.05 },
      research: { leadsPerStaff: 0.4, conversionBonus: 0.10 },
      hr: { supportEfficiency: 0.10 }
    },
    projections: {
      conservative: [0, 0, 0, 40, 40, 80, 80, 120, 120, 160, 160, 200, 200, 250, 250, 300],
      balanced: [0, 0, 60, 60, 120, 120, 180, 180, 260, 260, 360, 360, 480, 480, 620, 620],
      ambitious: [0, 80, 80, 160, 160, 280, 280, 420, 420, 600, 600, 800, 800, 1050, 1050, 1350]
    },
    investorToleranceBand: 0.5
  },
  
  platformAPI: {
    id: 'platformAPI',
    name: 'Platform / API',
    description: 'Developer-focused, usage-based, technical marketing',
    metrics: {
      avgRevenuePerCustomer: 8,
      acquisitionCostBase: 12,
      supportCostPerCustomer: 3,
      baseChurnRate: 0.15,
      salesCycleQuarters: 1,
    },
    staffEffects: {
      marketing: { leadsPerStaff: 0.2, conversionBonus: 0.03 },
      dev: { leadsPerStaff: 0.15, churnReduction: 0.03, satisfactionBonus: 0.08 },
      research: { dealSizeBonus: 0.05 },
      hr: { supportEfficiency: 0.08 }
    },
    projections: {
      conservative: [0, 0, 0, 8, 20, 40, 65, 95, 130, 175, 225, 285, 350, 430, 520, 620],
      balanced: [0, 0, 10, 30, 60, 100, 160, 240, 340, 460, 600, 770, 970, 1200, 1470, 1780],
      ambitious: [0, 10, 35, 80, 150, 260, 400, 580, 800, 1080, 1420, 1830, 2320, 2900, 3580, 4380]
    },
    investorToleranceBand: 0.3
  }
};

// ===== FOUNDER PROFILES - Player character archetypes =====
const FOUNDER_PROFILES = {
  academic: {
    id: "academic",
    name: "The Academic",
    title: "PhD turned founder",
    icon: "ğŸ“",
    slogan: "From lab bench to launch pad",
    color: "#6366f1",
    portraitStyle: "style7", // Glasses, neat hair - scholarly look
    desc: "You spent years in the lab, publishing papers and pushing the boundaries of knowledge. Now you're translating that expertise into a company. You understand the science deeply, but the business world is new territory.",
    strengths: "Deep technical credibility, research network, scientific rigour",
    challenges: "Commercial instincts, investor relations, moving at startup speed",
    stats: { technical: 5, commercial: 1, operational: 2, financial: 1, leadership: 2, adaptability: 3 }
  },
  serial: {
    id: "serial",
    name: "The Serial Founder",
    title: "Been here before",
    icon: "ğŸ”„",
    slogan: "Failed forward, ready to win",
    color: "#10b981",
    portraitStyle: "style12", // Older, grey hair - experienced
    desc: "This isn't your first rodeo. You've built companies before-some succeeded, some didn't-and you learned from all of them. You know how the game works, but every startup is different.",
    strengths: "Investor relationships, pattern recognition, crisis management",
    challenges: "Avoiding old playbooks that don't fit, staying humble, technical depth",
    stats: { technical: 2, commercial: 2, operational: 2, financial: 4, leadership: 3, adaptability: 2 }
  },
  corporate: {
    id: "corporate",
    name: "The Corporate Escapee",
    title: "Ex-BigTech executive",
    icon: "ğŸ¢",
    slogan: "Trading comfort for control",
    color: "#64748b",
    portraitStyle: "style1", // Professional look
    desc: "You climbed the ladder at a major tech company, learning how large organisations work. Now you're trading stability for autonomy. You know process and scale, but startups play by different rules.",
    strengths: "Operational excellence, enterprise sales, professional networks",
    challenges: "Scrappy execution, ambiguity tolerance, founder mentality",
    stats: { technical: 2, commercial: 3, operational: 5, financial: 2, leadership: 2, adaptability: 1 }
  },
  prodigy: {
    id: "prodigy",
    name: "The Technical Prodigy",
    title: "Builder extraordinaire",
    icon: "ğŸ’¡",
    slogan: "Code is my superpower",
    color: "#f59e0b",
    portraitStyle: "style5", // Young, tech look
    desc: "You've been coding since you were twelve and can build almost anything. Technical problems bow before you. People problems? Those are trickier. You're betting your skills can carry the company.",
    strengths: "Technical excellence, rapid prototyping, product intuition",
    challenges: "Delegation, commercial focus, patience with non-technical issues",
    stats: { technical: 6, commercial: 1, operational: 2, financial: 1, leadership: 1, adaptability: 2 }
  },
  dealmaker: {
    id: "dealmaker",
    name: "The Dealmaker",
    title: "Sales & partnerships pro",
    icon: "ğŸ¤",
    slogan: "Relationships open every door",
    color: "#ec4899",
    portraitStyle: "style10", // Long hair, confident
    desc: "You could sell ice to penguins. Your career has been about relationships, negotiations, and closing deals. You'll find customers and partners-but you'll need to trust others to build the product.",
    strengths: "Customer acquisition, partnership deals, fundraising pitches",
    challenges: "Technical judgment, product details, operational patience",
    stats: { technical: 1, commercial: 5, operational: 2, financial: 3, leadership: 2, adaptability: 1 }
  },
  operator: {
    id: "operator",
    name: "The Operator",
    title: "COO turned CEO",
    icon: "âš™",
    slogan: "Execution beats strategy",
    color: "#0ea5e9",
    portraitStyle: "style8", // Bald, confident
    desc: "You make things work. Processes, systems, teams-you've optimised them all. You ran operations for growing companies and now want to run your own. Execution is your superpower.",
    strengths: "Efficient scaling, team management, cost control",
    challenges: "Vision-setting, technical innovation, external storytelling",
    stats: { technical: 1, commercial: 2, operational: 5, financial: 2, leadership: 3, adaptability: 1 }
  },
  domain: {
    id: "domain",
    name: "The Domain Expert",
    title: "Industry insider",
    icon: "ğŸ†",
    slogan: "I know where the bodies are buried",
    color: "#8b5cf6",
    portraitStyle: "style9", // Middle Eastern, beard - experienced industry look
    desc: "You've spent decades in the industry your startup targets. You know the customers, the problems, and the politics. Your rolodex is gold. But technology moves fast, and you're still learning AI.",
    strengths: "Customer insight, industry credibility, regulatory navigation",
    challenges: "Technical trends, startup culture, moving beyond what worked before",
    stats: { technical: 1, commercial: 4, operational: 2, financial: 1, leadership: 2, adaptability: 3 }
  },
  firsttimer: {
    id: "firsttimer",
    name: "The First-Timer",
    title: "Fresh and hungry",
    icon: "ğŸŒ±",
    slogan: "No baggage, all potential",
    color: "#22c55e",
    portraitStyle: "style3", // Young, eager look
    desc: "You've never done this before, and that's your edge. No bad habits, no assumptions, no fear. You'll learn fast, make mistakes faster, and adapt. Everything is possible because you don't know what's impossible.",
    strengths: "Open-minded learning, energy and drive, willingness to pivot",
    challenges: "Everything is new, limited network, learning while doing",
    stats: { technical: 2, commercial: 2, operational: 2, financial: 2, leadership: 2, adaptability: 4 }
  },
  visionary: {
    id: "visionary",
    name: "The Visionary",
    title: "Big-picture thinker",
    icon: "ğŸ”®",
    slogan: "I see where the world is going",
    color: "#a855f7",
    portraitStyle: "style11", // Hispanic/Latino, confident leader look
    desc: "You see where the world is going before others do. Your ideas inspire people-investors, employees, journalists. Execution details bore you, but you know how to find people who sweat the small stuff.",
    strengths: "Inspiring leadership, strategic clarity, attracting talent and capital",
    challenges: "Operational details, patience with incremental progress, listening",
    stats: { technical: 2, commercial: 3, operational: 1, financial: 2, leadership: 5, adaptability: 2 }
  },
  bootstrapper: {
    id: "bootstrapper",
    name: "The Bootstrapper",
    title: "Self-funded scrapper",
    icon: "ğŸ’°",
    slogan: "Every pound is a prisoner",
    color: "#16a34a",
    portraitStyle: "style4", // Deep brown, practical look
    desc: "You believe in building businesses that make money, not just raise it. Every pound counts, every hire must earn their keep. You'll grow slower but own more-if you can survive long enough.",
    strengths: "Cash efficiency, sustainable growth, full ownership mentality",
    challenges: "Scaling fast enough, competing with funded rivals, raising when needed",
    stats: { technical: 2, commercial: 2, operational: 3, financial: 5, leadership: 1, adaptability: 2 }
  },
  community: {
    id: "community",
    name: "The Community Builder",
    title: "Ecosystem orchestrator",
    icon: "ğŸŒ",
    slogan: "Build with people, not just for them",
    color: "#06b6d4",
    portraitStyle: "style2", // Dark skin, approachable
    desc: "You believe in building with people, not just for them. Open source, developer communities, user movements-you've rallied people around shared causes. Now you're channeling that into a company.",
    strengths: "Organic growth, passionate users, talent attraction",
    challenges: "Monetisation, focus, saying no to community requests",
    stats: { technical: 2, commercial: 3, operational: 1, financial: 1, leadership: 4, adaptability: 3 }
  },
  strategist: {
    id: "strategist",
    name: "The Strategist",
    title: "Ex-consultant analyst",
    icon: "ğŸ“Š",
    slogan: "See the whole chessboard",
    color: "#78716c",
    portraitStyle: "style6", // South Asian, analytical look
    desc: "You've advised CEOs and analysed markets. You see business models clearly and can spot flaws in any plan-including your own. Now you're moving from advisor to operator. Theory meets reality.",
    strengths: "Strategic thinking, financial modelling, structured problem-solving",
    challenges: "Execution speed, comfort with ambiguity, inspiring vs. analysing",
    stats: { technical: 2, commercial: 2, operational: 2, financial: 4, leadership: 2, adaptability: 3 }
  }
};

// Standard founder portraits (diverse styles)
const FOUNDER_PORTRAITS = {
  // Light skin, short dark hair
  style1: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <circle cx="40" cy="40" r="38" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2"/>
    <ellipse cx="40" cy="44" rx="16" ry="18" fill="#d4a574"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M35 50 Q40 53 45 50" stroke="#8B4513" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M24 32 Q30 20 40 18 Q50 20 56 32 Q56 24 48 20 Q40 16 32 20 Q24 24 24 32" fill="#4a3728"/>
    <rect x="28" y="58" width="24" height="12" fill="#475569" rx="2"/>
  </svg>`,
  // Dark skin, short black hair
  style2: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <circle cx="40" cy="40" r="38" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2"/>
    <ellipse cx="40" cy="44" rx="16" ry="18" fill="#8b6914"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M35 50 Q40 53 45 50" stroke="#5c4a0f" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M22 35 Q28 18 40 16 Q52 18 58 35 L56 28 Q48 22 40 22 Q32 22 24 28 Z" fill="#1a1a1a"/>
    <rect x="28" y="58" width="24" height="12" fill="#1e3a5f" rx="2"/>
  </svg>`,
  // Fair skin, wavy brown hair
  style3: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <circle cx="40" cy="40" r="38" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2"/>
    <ellipse cx="40" cy="44" rx="16" ry="18" fill="#f5deb3"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M35 50 Q40 53 45 50" stroke="#cd853f" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M20 38 Q25 20 40 18 Q55 20 60 38 Q58 32 52 28 Q40 24 28 28 Q22 32 20 38" fill="#8b4513"/>
    <rect x="28" y="58" width="24" height="12" fill="#374151" rx="2"/>
  </svg>`,
  // Deep brown skin, short hair
  style4: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <circle cx="40" cy="40" r="38" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2"/>
    <ellipse cx="40" cy="44" rx="16" ry="18" fill="#6b4423"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M35 50 Q40 53 45 50" stroke="#4a3520" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <ellipse cx="40" cy="28" rx="16" ry="12" fill="#1a1a1a"/>
    <rect x="28" y="58" width="24" height="12" fill="#0f766e" rx="2"/>
  </svg>`,
  // East Asian, straight black hair
  style5: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <circle cx="40" cy="40" r="38" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2"/>
    <ellipse cx="40" cy="44" rx="16" ry="18" fill="#f0d5a0"/>
    <circle cx="33" cy="40" r="2" fill="#1a1a1a"/><circle cx="47" cy="40" r="2" fill="#1a1a1a"/>
    <path d="M35 50 Q40 52 45 50" stroke="#8b7355" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M22 40 Q24 18 40 16 Q56 18 58 40 L56 35 Q52 24 40 22 Q28 24 24 35 Z" fill="#1a1a1a"/>
    <rect x="28" y="58" width="24" height="12" fill="#4338ca" rx="2"/>
  </svg>`,
  // South Asian, dark hair
  style6: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <circle cx="40" cy="40" r="38" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2"/>
    <ellipse cx="40" cy="44" rx="16" ry="18" fill="#c68642"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M35 50 Q40 53 45 50" stroke="#8b5a2b" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M20 36 Q26 16 40 14 Q54 16 60 36 Q58 28 50 24 Q40 20 30 24 Q22 28 20 36" fill="#1a1a1a"/>
    <rect x="28" y="58" width="24" height="12" fill="#7c3aed" rx="2"/>
  </svg>`,
  // Light skin, glasses, neat hair
  style7: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <circle cx="40" cy="40" r="38" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2"/>
    <ellipse cx="40" cy="44" rx="16" ry="18" fill="#e8beac"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M35 50 Q40 53 45 50" stroke="#a0522d" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M24 30 Q32 18 40 18 Q48 18 56 30 Q54 24 48 22 Q40 20 32 22 Q26 24 24 30" fill="#654321"/>
    <rect x="27" y="36" width="12" height="8" rx="2" fill="none" stroke="#374151" stroke-width="1.5"/>
    <rect x="41" y="36" width="12" height="8" rx="2" fill="none" stroke="#374151" stroke-width="1.5"/>
    <line x1="39" y1="40" x2="41" y2="40" stroke="#374151" stroke-width="1.5"/>
    <rect x="28" y="58" width="24" height="12" fill="#059669" rx="2"/>
  </svg>`,
  // Darker skin, bald/shaved head
  style8: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <circle cx="40" cy="40" r="38" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2"/>
    <ellipse cx="40" cy="42" rx="18" ry="20" fill="#8d5524"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M35 50 Q40 53 45 50" stroke="#5c3d1e" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <rect x="28" y="58" width="24" height="12" fill="#dc2626" rx="2"/>
  </svg>`,
  // Middle Eastern, beard
  style9: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <circle cx="40" cy="40" r="38" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2"/>
    <ellipse cx="40" cy="44" rx="16" ry="18" fill="#c4a484"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M35 48 Q40 50 45 48" stroke="#5c4033" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M22 34 Q28 18 40 16 Q52 18 58 34 Q56 26 48 22 Q40 18 32 22 Q24 26 22 34" fill="#2d2d2d"/>
    <path d="M28 52 Q32 58 40 60 Q48 58 52 52 Q50 56 40 58 Q30 56 28 52" fill="#2d2d2d"/>
    <rect x="28" y="60" width="24" height="10" fill="#1e40af" rx="2"/>
  </svg>`,
  // Light skin, long hair
  style10: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <circle cx="40" cy="40" r="38" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2"/>
    <path d="M18 35 Q22 15 40 12 Q58 15 62 35 L64 55 Q62 62 55 64 L55 58 Q52 50 40 48 Q28 50 25 58 L25 64 Q18 62 16 55 Z" fill="#5c4033"/>
    <ellipse cx="40" cy="44" rx="15" ry="17" fill="#ffe4c4"/>
    <circle cx="34" cy="42" r="2" fill="#1a1a1a"/><circle cx="46" cy="42" r="2" fill="#1a1a1a"/>
    <path d="M36 50 Q40 52 44 50" stroke="#cd853f" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <rect x="29" y="58" width="22" height="11" fill="#db2777" rx="2"/>
  </svg>`,
  // Hispanic/Latino, dark wavy hair
  style11: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <circle cx="40" cy="40" r="38" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2"/>
    <ellipse cx="40" cy="44" rx="16" ry="18" fill="#c19a6b"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M35 50 Q40 53 45 50" stroke="#8b6914" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M20 36 Q24 16 40 14 Q56 16 60 36 Q58 30 52 26 Q46 22 40 22 Q34 22 28 26 Q22 30 20 36" fill="#2d2d2d"/>
    <path d="M22 36 Q24 34 28 36 Q26 32 22 36" fill="#2d2d2d"/>
    <path d="M58 36 Q56 34 52 36 Q54 32 58 36" fill="#2d2d2d"/>
    <rect x="28" y="58" width="24" height="12" fill="#0891b2" rx="2"/>
  </svg>`,
  // Older, grey hair
  style12: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <circle cx="40" cy="40" r="38" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2"/>
    <ellipse cx="40" cy="44" rx="16" ry="18" fill="#deb887"/>
    <circle cx="33" cy="40" r="2.5" fill="#1a1a1a"/><circle cx="47" cy="40" r="2.5" fill="#1a1a1a"/>
    <path d="M35 50 Q40 52 45 50" stroke="#a0522d" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M24 32 Q30 20 40 18 Q50 20 56 32 Q54 26 48 22 Q40 18 32 22 Q26 26 24 32" fill="#9ca3af"/>
    <path d="M30 36 L32 34" stroke="#d1d5db" stroke-width="1"/>
    <path d="M48 36 L50 34" stroke="#d1d5db" stroke-width="1"/>
    <rect x="28" y="58" width="24" height="12" fill="#78716c" rx="2"/>
  </svg>`
};

// ===== LOCATIONS - City choices per venture =====
const LOCATIONS = {
  // AETHER LABS - Biotech
  aether: [
    {
      id: "oxford",
      name: "Oxford",
      region: "South East",
      tagline: "The Dreaming Spires",
      salaryMod: 0.20, // +20%
      bonuses: { sci: 4, mkt: 1 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#e0f2fe"/>
        <!-- Radcliffe Camera dome -->
        <ellipse cx="60" cy="55" rx="25" ry="8" fill="#d4a574"/>
        <rect x="40" y="35" width="40" height="20" fill="#d4a574"/>
        <ellipse cx="60" cy="35" rx="20" ry="12" fill="#c4956a"/>
        <ellipse cx="60" cy="28" rx="12" ry="8" fill="#b8860b"/>
        <circle cx="60" cy="22" r="4" fill="#8b7355"/>
        <!-- Spires -->
        <polygon points="20,60 25,25 30,60" fill="#a0a0a0"/>
        <polygon points="90,60 95,20 100,60" fill="#a0a0a0"/>
        <!-- Windows -->
        <rect x="45" y="40" width="4" height="6" fill="#4a5568"/>
        <rect x="55" y="40" width="4" height="6" fill="#4a5568"/>
        <rect x="65" y="40" width="4" height="6" fill="#4a5568"/>
        <!-- Ground -->
        <rect x="0" y="60" width="120" height="20" fill="#86efac"/>
      </svg>`,
      description: "Ancient colleges meet cutting-edge science. The biotech incubator and university spin-outs have created a world-class life sciences cluster.",
      pros: ["World-leading research university", "Strong pharma connections (nearby Harwell)", "Prestigious address attracts talent"],
      cons: ["High costs and housing shortage", "Academic culture can slow commercialisation"]
    },
    {
      id: "glasgow",
      name: "Glasgow",
      region: "Scotland",
      tagline: "The Inventive City",
      salaryMod: -0.05, // -5%
      bonuses: { sci: 2, hr: 2 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#cbd5e1"/>
        <!-- SEC Armadillo -->
        <path d="M30,60 Q45,30 60,60" fill="#64748b" stroke="#475569" stroke-width="1"/>
        <path d="M35,58 Q48,35 55,58" fill="#94a3b8"/>
        <!-- Finnieston Crane -->
        <rect x="85" y="25" width="4" height="35" fill="#475569"/>
        <rect x="75" y="25" width="24" height="4" fill="#475569"/>
        <line x1="87" y1="29" x2="78" y2="55" stroke="#475569" stroke-width="2"/>
        <!-- Buildings -->
        <rect x="5" y="40" width="15" height="20" fill="#78716c"/>
        <rect x="100" y="35" width="15" height="25" fill="#78716c"/>
        <!-- River Clyde -->
        <rect x="0" y="60" width="120" height="10" fill="#60a5fa"/>
        <!-- Ground -->
        <rect x="0" y="70" width="120" height="10" fill="#6b7280"/>
      </svg>`,
      description: "Scotland's largest city with a proud industrial heritage reborn as an innovation hub. Strong public health system links through the university hospital campus.",
      pros: ["Excellent public health system collaboration opportunities", "Affordable talent with strong work ethic", "regional development funding available"],
      cons: ["Smaller biotech investor ecosystem", "Perception gap with London VCs"]
    },
    {
      id: "cardiff",
      name: "Cardiff",
      region: "Wales",
      tagline: "The Life Sciences Valley",
      salaryMod: -0.10, // -10%
      bonuses: { sci: 2, hr: 1 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#dbeafe"/>
        <!-- Millennium Stadium/Principality -->
        <ellipse cx="60" cy="50" rx="30" ry="15" fill="#94a3b8"/>
        <path d="M35,50 L35,35 L45,30 L45,50" fill="#64748b"/>
        <path d="M75,50 L75,35 L85,30 L85,50" fill="#64748b"/>
        <path d="M45,50 L45,25 L75,25 L75,50" fill="#78716c"/>
        <!-- Spikes on top -->
        <polygon points="40,30 42,20 44,30" fill="#475569"/>
        <polygon points="55,25 57,15 59,25" fill="#475569"/>
        <polygon points="70,25 72,15 74,25" fill="#475569"/>
        <!-- Castle tower hint -->
        <rect x="5" y="35" width="12" height="25" fill="#a8a29e"/>
        <polygon points="5,35 11,25 17,35" fill="#a8a29e"/>
        <!-- Welsh dragon flag hint -->
        <rect x="8" y="38" width="6" height="4" fill="#dc2626"/>
        <!-- Ground -->
        <rect x="0" y="60" width="120" height="20" fill="#86efac"/>
      </svg>`,
      description: "Welsh capital with a growing life sciences cluster. The Cardiff Medicentre and Development Bank of Wales offer strong support for health tech startups.",
      pros: ["Welsh Government grants and support", "Growing life sciences park", "Low costs, high quality of life"],
      cons: ["Smaller talent pool", "Less visibility to major investors"]
    }
  ],
  
  // VANGUARD ROBOTICS - Industrial Automation
  vanguard: [
    {
      id: "southampton",
      name: "Southampton",
      region: "South",
      tagline: "The Maritime Tech Hub",
      salaryMod: 0.05, // +5%
      bonuses: { dev: 2, mkt: 2 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#e0f2fe"/>
        <!-- Cruise ship -->
        <rect x="20" y="35" width="60" height="20" rx="2" fill="#f8fafc"/>
        <rect x="25" y="25" width="50" height="12" fill="#f1f5f9"/>
        <rect x="35" y="18" width="30" height="8" fill="#e2e8f0"/>
        <!-- Funnels -->
        <rect x="55" y="10" width="8" height="10" fill="#ef4444"/>
        <rect x="57" y="8" width="4" height="4" fill="#1f2937"/>
        <!-- Windows -->
        <circle cx="30" cy="42" r="2" fill="#60a5fa"/>
        <circle cx="40" cy="42" r="2" fill="#60a5fa"/>
        <circle cx="50" cy="42" r="2" fill="#60a5fa"/>
        <circle cx="60" cy="42" r="2" fill="#60a5fa"/>
        <circle cx="70" cy="42" r="2" fill="#60a5fa"/>
        <!-- Port cranes -->
        <rect x="95" y="30" width="3" height="30" fill="#f59e0b"/>
        <rect x="90" y="30" width="13" height="3" fill="#f59e0b"/>
        <rect x="5" y="35" width="3" height="25" fill="#f59e0b"/>
        <rect x="2" y="35" width="10" height="3" fill="#f59e0b"/>
        <!-- Sea -->
        <rect x="0" y="55" width="120" height="15" fill="#3b82f6"/>
        <!-- Dock -->
        <rect x="0" y="70" width="120" height="10" fill="#78716c"/>
      </svg>`,
      description: "Major port city with expertise in maritime technology and logistics automation. The University of Southampton has world-class engineering and autonomous systems research.",
      pros: ["Port and logistics expertise", "Strong university engineering links", "Good transport to London customers"],
      cons: ["Mid-tier costs", "Competes with London for talent"]
    },
    {
      id: "birmingham",
      name: "Birmingham",
      region: "Midlands",
      tagline: "The Manufacturing Heart",
      salaryMod: 0.05, // +5%
      bonuses: { dev: 2, mkt: 1, hr: 1 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#f0f9ff"/>
        <!-- Selfridges Building -->
        <ellipse cx="60" cy="45" rx="25" ry="20" fill="#60a5fa"/>
        <!-- Dots pattern -->
        <circle cx="45" cy="40" r="2" fill="#93c5fd"/>
        <circle cx="55" cy="35" r="2" fill="#93c5fd"/>
        <circle cx="65" cy="35" r="2" fill="#93c5fd"/>
        <circle cx="75" cy="40" r="2" fill="#93c5fd"/>
        <circle cx="50" cy="45" r="2" fill="#93c5fd"/>
        <circle cx="60" cy="42" r="2" fill="#93c5fd"/>
        <circle cx="70" cy="45" r="2" fill="#93c5fd"/>
        <circle cx="55" cy="52" r="2" fill="#93c5fd"/>
        <circle cx="65" cy="52" r="2" fill="#93c5fd"/>
        <!-- BT Tower -->
        <rect x="10" y="20" width="6" height="40" fill="#64748b"/>
        <rect x="8" y="20" width="10" height="5" fill="#94a3b8"/>
        <!-- Library of Birmingham -->
        <rect x="85" y="30" width="25" height="30" fill="#a8a29e"/>
        <rect x="88" y="33" width="6" height="6" fill="#78716c"/>
        <rect x="97" y="33" width="6" height="6" fill="#78716c"/>
        <rect x="88" y="42" width="6" height="6" fill="#78716c"/>
        <rect x="97" y="42" width="6" height="6" fill="#78716c"/>
        <!-- Ground -->
        <rect x="0" y="60" width="120" height="20" fill="#9ca3af"/>
      </svg>`,
      description: "Britain's second city, central to the UK's manufacturing supply chain. JLR, Aston Martin, and a huge automotive supply base make it ideal for industrial automation.",
      pros: ["Central UK location", "Large manufacturing customer base", "Diverse, skilled workforce"],
      cons: ["Less tech-startup culture", "Competes with London for visibility"]
    },
    {
      id: "grimsby",
      name: "Grimsby",
      region: "Lincolnshire",
      tagline: "The Reinvention",
      salaryMod: -0.20, // -20%
      bonuses: { dev: 2, sci: 1 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky with clouds -->
        <rect width="120" height="80" fill="#f1f5f9"/>
        <ellipse cx="30" cy="15" rx="15" ry="8" fill="#fff"/>
        <ellipse cx="90" cy="20" rx="12" ry="6" fill="#fff"/>
        <!-- Wind turbines -->
        <rect x="25" y="35" width="2" height="30" fill="#e5e7eb"/>
        <polygon points="26,35 26,25 30,35 26,35" fill="#d1d5db"/>
        <polygon points="26,35 18,40 26,38" fill="#d1d5db"/>
        <polygon points="26,35 30,45 26,38" fill="#d1d5db"/>
        <rect x="55" y="30" width="2" height="35" fill="#e5e7eb"/>
        <polygon points="56,30 56,18 61,30 56,30" fill="#d1d5db"/>
        <polygon points="56,30 46,36 56,33" fill="#d1d5db"/>
        <polygon points="56,30 62,42 56,33" fill="#d1d5db"/>
        <rect x="85" y="32" width="2" height="33" fill="#e5e7eb"/>
        <polygon points="86,32 86,22 90,32 86,32" fill="#d1d5db"/>
        <polygon points="86,32 78,37 86,35" fill="#d1d5db"/>
        <polygon points="86,32 92,43 86,35" fill="#d1d5db"/>
        <!-- Dock/industrial -->
        <rect x="5" y="50" width="20" height="15" fill="#78716c"/>
        <rect x="100" y="45" width="15" height="20" fill="#78716c"/>
        <!-- Sea -->
        <rect x="0" y="65" width="120" height="15" fill="#60a5fa"/>
      </svg>`,
      description: "Once a fishing powerhouse, now reinventing itself as the UK's offshore wind capital. Lowest costs in the country with access to automation-hungry food processing and renewable energy sectors.",
      pros: ["Lowest operating costs in UK", "Offshore wind boom creating demand", "Eager local workforce"],
      cons: ["Perception challenges", "Remote location, harder to attract talent"]
    }
  ],
  
  // QUANT AI - Financial ML
  quant: [
    {
      id: "london",
      name: "London",
      region: "Capital",
      tagline: "The City",
      salaryMod: 0.35, // +35%
      bonuses: { mkt: 3, sci: 2 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#dbeafe"/>
        <!-- Shard -->
        <polygon points="95,60 100,5 105,60" fill="#60a5fa"/>
        <line x1="100" y1="10" x2="100" y2="60" stroke="#93c5fd" stroke-width="1"/>
        <!-- Gherkin -->
        <ellipse cx="75" cy="40" rx="8" ry="20" fill="#34d399"/>
        <path d="M70,25 Q75,20 80,25" fill="none" stroke="#10b981" stroke-width="1"/>
        <path d="M69,35 Q75,30 81,35" fill="none" stroke="#10b981" stroke-width="1"/>
        <path d="M69,45 Q75,40 81,45" fill="none" stroke="#10b981" stroke-width="1"/>
        <!-- Walkie Talkie -->
        <path d="M45,60 L42,25 L58,25 L55,60" fill="#94a3b8"/>
        <!-- Tower of London hint -->
        <rect x="5" y="45" width="20" height="15" fill="#a8a29e"/>
        <polygon points="10,45 15,38 20,45" fill="#a8a29e"/>
        <!-- St Paul's dome -->
        <rect x="20" y="40" width="15" height="20" fill="#d4c4a8"/>
        <ellipse cx="27" cy="40" rx="7" ry="5" fill="#d4c4a8"/>
        <circle cx="27" cy="36" r="2" fill="#a8a29e"/>
        <!-- Thames -->
        <rect x="0" y="60" width="120" height="8" fill="#3b82f6"/>
        <!-- Ground -->
        <rect x="0" y="68" width="120" height="12" fill="#6b7280"/>
      </svg>`,
      description: "The world's leading financial centre. Every major bank, hedge fund, and asset manager has a presence here. Unmatched access to customers, talent, and capital.",
      pros: ["All financial customers on doorstep", "Deepest quant talent pool globally", "Investor meetings over lunch"],
      cons: ["Brutal costs and competition", "Constant poaching of staff"]
    },
    {
      id: "edinburgh",
      name: "Edinburgh",
      region: "Scotland",
      tagline: "The Fund Managers",
      salaryMod: 0.05, // +5%
      bonuses: { sci: 2, mkt: 2 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#e0e7ff"/>
        <!-- Castle rock -->
        <polygon points="10,65 30,30 50,65" fill="#78716c"/>
        <!-- Edinburgh Castle -->
        <rect x="20" y="25" width="20" height="15" fill="#a8a29e"/>
        <rect x="25" y="18" width="10" height="10" fill="#a8a29e"/>
        <polygon points="25,18 30,10 35,18" fill="#78716c"/>
        <!-- Scott Monument -->
        <polygon points="75,65 80,20 85,65" fill="#57534e"/>
        <rect x="77" y="35" width="6" height="3" fill="#78716c"/>
        <rect x="77" y="45" width="6" height="3" fill="#78716c"/>
        <!-- Calton Hill columns -->
        <rect x="100" y="40" width="3" height="15" fill="#d4c4a8"/>
        <rect x="107" y="42" width="3" height="13" fill="#d4c4a8"/>
        <rect x="100" y="37" width="12" height="4" fill="#d4c4a8"/>
        <!-- Old Town buildings -->
        <rect x="45" y="45" width="8" height="20" fill="#78716c"/>
        <rect x="55" y="40" width="10" height="25" fill="#6b7280"/>
        <rect x="90" y="50" width="8" height="15" fill="#78716c"/>
        <!-- Ground -->
        <rect x="0" y="65" width="120" height="15" fill="#86efac"/>
      </svg>`,
      description: "Scotland's capital hosts major fund managers including Baillie Gifford and Abrdn. A sophisticated financial centre with world-class universities and a thriving fintech scene.",
      pros: ["Major asset managers headquartered here", "Strong data science and AI talent", "regional development support"],
      cons: ["Fewer hedge funds than London", "Some investors require travel"]
    },
    {
      id: "belfast",
      name: "Belfast",
      region: "Northern Ireland",
      tagline: "The Fintech Frontier",
      salaryMod: -0.15, // -15%
      bonuses: { dev: 2, mkt: 1 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#f0f9ff"/>
        <!-- Harland & Wolff cranes (Samson and Goliath) -->
        <rect x="80" y="20" width="6" height="45" fill="#fbbf24"/>
        <rect x="75" y="20" width="16" height="5" fill="#fbbf24"/>
        <line x1="83" y1="25" x2="78" y2="55" stroke="#fbbf24" stroke-width="2"/>
        <rect x="95" y="25" width="5" height="40" fill="#fbbf24"/>
        <rect x="91" y="25" width="13" height="4" fill="#fbbf24"/>
        <!-- Titanic Belfast -->
        <polygon points="30,65 45,30 60,65" fill="#94a3b8"/>
        <polygon points="35,65 45,35 55,65" fill="#a8a29e"/>
        <polygon points="40,65 45,40 50,65" fill="#cbd5e1"/>
        <!-- City Hall dome -->
        <rect x="5" y="45" width="20" height="20" fill="#d4c4a8"/>
        <ellipse cx="15" cy="45" rx="8" ry="5" fill="#d4c4a8"/>
        <circle cx="15" cy="42" r="2" fill="#a8a29e"/>
        <!-- River Lagan -->
        <rect x="0" y="65" width="120" height="8" fill="#60a5fa"/>
        <!-- Ground -->
        <rect x="0" y="73" width="120" height="7" fill="#9ca3af"/>
      </svg>`,
      description: "Northern Ireland's capital has quietly become a fintech powerhouse. Citi, Allstate, and CME Group have major tech operations here, creating a deep pool of financial services engineers.",
      pros: ["Lowest costs of major UK cities", "Strong financial services tech talent", "Invest NI grants available"],
      cons: ["Distance from London clients", "Smaller quant research community"]
    }
  ],
  
  // DREAM MACHINE - Creative AI
  dream: [
    {
      id: "brighton",
      name: "Brighton",
      region: "South East",
      tagline: "The Creative Coast",
      salaryMod: 0.15, // +15%
      bonuses: { mkt: 2, dev: 2 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#fdf4ff"/>
        <!-- Royal Pavilion domes -->
        <ellipse cx="60" cy="35" rx="15" ry="12" fill="#fef3c7"/>
        <ellipse cx="60" cy="28" rx="8" ry="6" fill="#fde68a"/>
        <circle cx="60" cy="22" r="3" fill="#fbbf24"/>
        <!-- Smaller domes -->
        <ellipse cx="40" cy="42" rx="8" ry="7" fill="#fef3c7"/>
        <ellipse cx="40" cy="38" rx="4" ry="3" fill="#fde68a"/>
        <ellipse cx="80" cy="42" rx="8" ry="7" fill="#fef3c7"/>
        <ellipse cx="80" cy="38" rx="4" ry="3" fill="#fde68a"/>
        <!-- Minarets -->
        <rect x="25" y="30" width="3" height="20" fill="#fef3c7"/>
        <circle cx="26" cy="28" r="3" fill="#fde68a"/>
        <rect x="92" y="30" width="3" height="20" fill="#fef3c7"/>
        <circle cx="93" cy="28" r="3" fill="#fde68a"/>
        <!-- Pier hint -->
        <rect x="0" y="62" width="40" height="3" fill="#a8a29e"/>
        <rect x="5" y="58" width="4" height="6" fill="#78716c"/>
        <rect x="15" y="55" width="8" height="9" fill="#78716c"/>
        <!-- Beach -->
        <rect x="0" y="65" width="120" height="8" fill="#fde68a"/>
        <!-- Sea -->
        <rect x="0" y="73" width="120" height="7" fill="#38bdf8"/>
      </svg>`,
      description: "London's creative escape by the sea. A thriving indie games scene, digital agencies, and media companies make Brighton the UK's creative tech capital outside London.",
      pros: ["Strong creative and games talent", "50 mins to London clients", "Vibrant, attractive lifestyle"],
      cons: ["High costs for a small city", "Limited growth ceiling"]
    },
    {
      id: "bristol",
      name: "Bristol",
      region: "South West",
      tagline: "The Animation Capital",
      salaryMod: 0.10, // +10%
      bonuses: { dev: 2, mkt: 2 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#ecfeff"/>
        <!-- Clifton Suspension Bridge -->
        <rect x="10" y="45" width="8" height="25" fill="#a8a29e"/>
        <rect x="102" y="45" width="8" height="25" fill="#a8a29e"/>
        <!-- Bridge towers -->
        <rect x="11" y="30" width="6" height="18" fill="#78716c"/>
        <rect x="103" y="30" width="6" height="18" fill="#78716c"/>
        <!-- Cables -->
        <path d="M14,32 Q60,55 106,32" fill="none" stroke="#57534e" stroke-width="2"/>
        <path d="M14,35 Q60,58 106,35" fill="none" stroke="#57534e" stroke-width="1"/>
        <!-- Deck -->
        <line x1="14" y1="48" x2="106" y2="48" stroke="#6b7280" stroke-width="3"/>
        <!-- Gorge -->
        <polygon points="0,50 20,70 0,80" fill="#86efac"/>
        <polygon points="120,50 100,70 120,80" fill="#86efac"/>
        <!-- River Avon -->
        <rect x="20" y="70" width="80" height="10" fill="#60a5fa"/>
        <!-- Balloon hint -->
        <ellipse cx="85" cy="20" rx="6" ry="8" fill="#f87171"/>
        <rect x="83" y="28" width="4" height="5" fill="#fbbf24"/>
      </svg>`,
      description: "Home to award-winning animation studios and national broadcasters. A rich creative heritage combined with strong engineering talent from the aerospace industry. Annual Balloon Fiesta captures the city's spirit.",
      pros: ["Animation studios and broadcaster heritage", "Strong VFX and animation talent", "More affordable than London"],
      cons: ["Smaller than London market", "Some client travel required"]
    },
    {
      id: "dundee",
      name: "Dundee",
      region: "Scotland",
      tagline: "The Games City",
      salaryMod: -0.10, // -10%
      bonuses: { dev: 3, mkt: 1 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#e0f2fe"/>
        <!-- V&A Dundee -->
        <polygon points="40,60 60,35 80,60" fill="#1e293b"/>
        <polygon points="45,60 60,40 75,60" fill="#334155"/>
        <!-- Gap in middle -->
        <rect x="55" y="45" width="10" height="15" fill="#e0f2fe"/>
        <!-- Tay Rail Bridge -->
        <line x1="0" y1="55" x2="35" y2="55" stroke="#78716c" stroke-width="2"/>
        <line x1="85" y1="55" x2="120" y2="55" stroke="#78716c" stroke-width="2"/>
        <rect x="5" y="52" width="2" height="8" fill="#78716c"/>
        <rect x="15" y="52" width="2" height="8" fill="#78716c"/>
        <rect x="25" y="52" width="2" height="8" fill="#78716c"/>
        <rect x="93" y="52" width="2" height="8" fill="#78716c"/>
        <rect x="103" y="52" width="2" height="8" fill="#78716c"/>
        <rect x="113" y="52" width="2" height="8" fill="#78716c"/>
        <!-- Law hill -->
        <ellipse cx="100" cy="45" rx="15" ry="10" fill="#86efac"/>
        <!-- River Tay -->
        <rect x="0" y="60" width="120" height="12" fill="#60a5fa"/>
        <!-- Waterfront -->
        <rect x="0" y="72" width="120" height="8" fill="#9ca3af"/>
      </svg>`,
      description: "Birthplace of Grand Theft Auto and home to the V&A's only museum outside London. Abertay University pioneered games degrees, creating a unique talent pool for interactive entertainment.",
      pros: ["GTA legacy and games talent", "V&A Dundee creative hub", "Low costs, high creativity"],
      cons: ["Small city, limited scale", "Remote from media buyers"]
    }
  ],

  // CYBERSHIELD AI - Cybersecurity
  cyber: [
    { id: "cheltenham", name: "Cheltenham", region: "South West", tagline: "National Cyber Agency's Backyard", salaryMod: 0.10, bonuses: { sci: 3, dev: 2 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky - dark for cyber theme -->
        <rect width="120" height="80" fill="#0f172a"/>
        <!-- Stars -->
        <circle cx="15" cy="12" r="1" fill="#fff"/>
        <circle cx="45" cy="8" r="1" fill="#fff"/>
        <circle cx="95" cy="15" r="1" fill="#fff"/>
        <circle cx="75" cy="6" r="1" fill="#fff"/>
        <!-- National Cyber Agency Doughnut building -->
        <ellipse cx="60" cy="45" rx="28" ry="18" fill="#334155"/>
        <ellipse cx="60" cy="45" rx="12" ry="8" fill="#0f172a"/>
        <ellipse cx="60" cy="43" rx="28" ry="16" fill="#475569" stroke="#22d3ee" stroke-width="1"/>
        <ellipse cx="60" cy="43" rx="10" ry="6" fill="#0f172a"/>
        <!-- Glowing windows -->
        <circle cx="45" cy="42" r="2" fill="#22d3ee" opacity="0.8"/>
        <circle cx="55" cy="38" r="2" fill="#22d3ee" opacity="0.8"/>
        <circle cx="65" cy="38" r="2" fill="#22d3ee" opacity="0.8"/>
        <circle cx="75" cy="42" r="2" fill="#22d3ee" opacity="0.8"/>
        <!-- Ground -->
        <rect x="0" y="60" width="120" height="20" fill="#1e293b"/>
        <!-- Data streams -->
        <line x1="20" y1="70" x2="35" y2="55" stroke="#22d3ee" stroke-width="1" opacity="0.5"/>
        <line x1="85" y1="70" x2="100" y2="55" stroke="#22d3ee" stroke-width="1" opacity="0.5"/>
      </svg>`,
      description: "Home to National Cyber Agency and National Cyber Security Centre. The UK's intelligence community creates a unique talent pipeline.", pros: ["National Cyber Agency talent pipeline", "Security clearance culture", "Government contracts"], cons: ["Quiet town", "Talent often cleared elsewhere"] },
    { id: "newport", name: "Newport", region: "Wales", tagline: "Cyber Wales Hub", salaryMod: -0.10, bonuses: { dev: 3, hr: 2 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#dbeafe"/>
        <!-- Hills in background -->
        <ellipse cx="30" cy="65" rx="40" ry="20" fill="#86efac"/>
        <ellipse cx="100" cy="65" rx="35" ry="18" fill="#4ade80"/>
        <!-- Transporter Bridge -->
        <rect x="25" y="30" width="4" height="35" fill="#475569"/>
        <rect x="91" y="30" width="4" height="35" fill="#475569"/>
        <rect x="25" y="28" width="70" height="4" fill="#475569"/>
        <!-- Suspension cables -->
        <line x1="27" y1="32" x2="60" y2="50" stroke="#64748b" stroke-width="1"/>
        <line x1="93" y1="32" x2="60" y2="50" stroke="#64748b" stroke-width="1"/>
        <!-- Gondola -->
        <rect x="50" y="48" width="20" height="8" fill="#dc2626"/>
        <!-- Modern tech buildings -->
        <rect x="5" y="45" width="15" height="20" fill="#6366f1"/>
        <rect x="8" y="48" width="4" height="4" fill="#c7d2fe"/>
        <rect x="8" y="55" width="4" height="4" fill="#c7d2fe"/>
        <!-- Welsh dragon hint -->
        <circle cx="12" cy="42" r="3" fill="#dc2626"/>
        <!-- River Usk -->
        <rect x="0" y="65" width="120" height="15" fill="#3b82f6"/>
      </svg>`,
      description: "Home to the National Cyber Security Academy and growing Welsh cyber cluster. ONS data science campus nearby in the valleys.", pros: ["Cyber Security Academy", "Welsh Government support", "Low costs"], cons: ["Smaller talent pool", "Less visibility"] },
    { id: "malvern", name: "Malvern", region: "West Midlands", tagline: "Defence Tech Valley", salaryMod: 0.05, bonuses: { sci: 4, mkt: 1 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#e0f2fe"/>
        <!-- Malvern Hills - rolling green -->
        <ellipse cx="0" cy="70" rx="50" ry="35" fill="#22c55e"/>
        <ellipse cx="60" cy="65" rx="45" ry="30" fill="#16a34a"/>
        <ellipse cx="120" cy="70" rx="50" ry="35" fill="#22c55e"/>
        <!-- DefenceTech Labs building -->
        <rect x="45" y="40" width="35" height="25" fill="#475569"/>
        <rect x="50" y="44" width="8" height="6" fill="#bfdbfe"/>
        <rect x="62" y="44" width="8" height="6" fill="#bfdbfe"/>
        <rect x="50" y="54" width="8" height="6" fill="#bfdbfe"/>
        <rect x="62" y="54" width="8" height="6" fill="#bfdbfe"/>
        <!-- Radar dome -->
        <circle cx="90" cy="50" r="10" fill="#e2e8f0"/>
        <ellipse cx="90" cy="55" rx="10" ry="3" fill="#cbd5e1"/>
        <!-- Victorian buildings hint -->
        <rect x="10" y="48" width="20" height="17" fill="#a8a29e"/>
        <polygon points="10,48 20,38 30,48" fill="#78716c"/>
        <!-- Ground -->
        <rect x="0" y="65" width="120" height="15" fill="#86efac"/>
      </svg>`,
      description: "Home to DefenceTech Labs and Defence Research Institute. The Malvern Hills tech cluster has deep defence and signals intelligence heritage.", pros: ["DefenceTech Labs/Defence Research Institute proximity", "Defence contracts", "Beautiful location"], cons: ["Small town", "Limited nightlife"] }
  ],

  // TERRAMIND ANALYTICS - CleanTech
  terra: [
    { id: "aberdeen", name: "Aberdeen", region: "Scotland", tagline: "Energy Transition Hub", salaryMod: 0.05, bonuses: { mkt: 4, hr: 1 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#cbd5e1"/>
        <!-- North Sea -->
        <rect x="0" y="55" width="120" height="25" fill="#3b82f6"/>
        <!-- Waves -->
        <path d="M0,60 Q10,57 20,60 Q30,63 40,60 Q50,57 60,60 Q70,63 80,60 Q90,57 100,60 Q110,63 120,60" fill="none" stroke="#60a5fa" stroke-width="1"/>
        <!-- Oil rig (transitioning) -->
        <rect x="15" y="35" width="3" height="25" fill="#6b7280"/>
        <rect x="22" y="35" width="3" height="25" fill="#6b7280"/>
        <rect x="12" y="32" width="16" height="5" fill="#475569"/>
        <!-- Wind turbine (the future) -->
        <rect x="80" y="25" width="3" height="35" fill="#e2e8f0"/>
        <path d="M81.5,25 L81.5,10 L86,25" fill="#f1f5f9"/>
        <path d="M81.5,25 L72,35 L81.5,28" fill="#f1f5f9"/>
        <path d="M81.5,25 L91,35 L81.5,28" fill="#f1f5f9"/>
        <!-- Granite buildings -->
        <rect x="40" y="40" width="18" height="18" fill="#9ca3af"/>
        <rect x="44" y="44" width="4" height="5" fill="#475569"/>
        <rect x="52" y="44" width="4" height="5" fill="#475569"/>
        <polygon points="40,40 49,32 58,40" fill="#78716c"/>
        <!-- Ground/harbour -->
        <rect x="0" y="58" width="120" height="5" fill="#64748b"/>
      </svg>`,
      description: "Oil & gas capital pivoting to renewables. Energy giants need AI for transition-huge budgets, urgent timelines.", pros: ["Energy company HQs", "Transition urgency", "Large budgets"], cons: ["Remote location", "Oil industry stigma"] },
    { id: "hull", name: "Hull", region: "Yorkshire", tagline: "Offshore Wind Capital", salaryMod: -0.20, bonuses: { dev: 3, mkt: 2 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#e0f2fe"/>
        <!-- The Deep aquarium -->
        <polygon points="10,60 10,40 35,30 35,60" fill="#1e3a5f"/>
        <polygon points="12,58 12,42 33,33 33,58" fill="#0ea5e9"/>
        <!-- Wind turbines in sea -->
        <rect x="55" y="30" width="2" height="30" fill="#e2e8f0"/>
        <path d="M56,30 L56,18 L60,30" fill="#f1f5f9"/>
        <path d="M56,30 L50,38 L56,32" fill="#f1f5f9"/>
        <path d="M56,30 L62,38 L56,32" fill="#f1f5f9"/>
        <rect x="80" y="25" width="2" height="35" fill="#e2e8f0"/>
        <path d="M81,25 L81,13 L85,25" fill="#f1f5f9"/>
        <path d="M81,25 L75,33 L81,27" fill="#f1f5f9"/>
        <path d="M81,25 L87,33 L81,27" fill="#f1f5f9"/>
        <rect x="100" y="32" width="2" height="28" fill="#e2e8f0"/>
        <path d="M101,32 L101,22 L104,32" fill="#f1f5f9"/>
        <!-- Humber estuary -->
        <rect x="0" y="60" width="120" height="20" fill="#3b82f6"/>
        <!-- Siemens factory hint -->
        <rect x="70" y="50" width="25" height="10" fill="#22c55e"/>
        <rect x="75" y="52" width="6" height="6" fill="#86efac"/>
      </svg>`,
      description: "UK's offshore wind hub. Siemens Gamesa factory and Humber freeport offer grants and access to renewables sector.", pros: ["Offshore wind cluster", "Freeport incentives", "Lowest costs"], cons: ["Remote from investors", "Limited tech scene"] },
    { id: "exeter", name: "Exeter", region: "South West", tagline: "Met Office & Climate", salaryMod: 0.05, bonuses: { sci: 4, dev: 1 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky with weather elements -->
        <rect width="120" height="80" fill="#bfdbfe"/>
        <!-- Sun -->
        <circle cx="100" cy="15" r="10" fill="#fbbf24"/>
        <!-- Cloud -->
        <ellipse cx="30" cy="18" rx="12" ry="6" fill="#fff"/>
        <ellipse cx="22" cy="20" rx="8" ry="5" fill="#fff"/>
        <ellipse cx="38" cy="20" rx="8" ry="5" fill="#fff"/>
        <!-- Met Office building -->
        <rect x="40" y="35" width="40" height="28" fill="#1e3a5f"/>
        <rect x="45" y="40" width="10" height="8" fill="#60a5fa"/>
        <rect x="60" y="40" width="10" height="8" fill="#60a5fa"/>
        <rect x="45" y="52" width="10" height="8" fill="#60a5fa"/>
        <rect x="60" y="52" width="10" height="8" fill="#60a5fa"/>
        <!-- Weather data satellite dish -->
        <ellipse cx="85" cy="45" rx="8" ry="4" fill="#e2e8f0"/>
        <rect x="84" y="45" width="2" height="15" fill="#94a3b8"/>
        <!-- Exeter Cathedral hint -->
        <rect x="8" y="42" width="20" height="21" fill="#a8a29e"/>
        <polygon points="8,42 18,30 28,42" fill="#78716c"/>
        <polygon points="10,42 18,35 26,42" fill="#94a3b8"/>
        <!-- River Exe -->
        <path d="M0,70 Q40,65 80,70 Q100,72 120,68" fill="#3b82f6"/>
        <!-- Ground -->
        <rect x="0" y="63" width="120" height="17" fill="#86efac"/>
      </svg>`,
      description: "Home to the Met Office and University of Exeter's climate research. World-leading weather and climate science on your doorstep.", pros: ["Met Office partnership", "Climate science hub", "Quality of life"], cons: ["Small city", "Far from London"] }
  ],

  // LEGALMIND AI - LegalTech
  legal: [
    { id: "leeds", name: "Leeds", region: "Yorkshire", tagline: "Legal Process Centre", salaryMod: -0.05, bonuses: { dev: 3, hr: 2 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#e0e7ff"/>
        <!-- Leeds Town Hall -->
        <rect x="35" y="30" width="50" height="33" fill="#d4a574"/>
        <rect x="40" y="35" width="8" height="12" fill="#1e293b"/>
        <rect x="52" y="35" width="8" height="12" fill="#1e293b"/>
        <rect x="64" y="35" width="8" height="12" fill="#1e293b"/>
        <rect x="76" y="35" width="8" height="12" fill="#1e293b"/>
        <!-- Columns -->
        <rect x="38" y="50" width="4" height="13" fill="#c4956a"/>
        <rect x="48" y="50" width="4" height="13" fill="#c4956a"/>
        <rect x="58" y="50" width="4" height="13" fill="#c4956a"/>
        <rect x="68" y="50" width="4" height="13" fill="#c4956a"/>
        <rect x="78" y="50" width="4" height="13" fill="#c4956a"/>
        <!-- Dome/clock tower -->
        <rect x="52" y="18" width="16" height="12" fill="#c4956a"/>
        <ellipse cx="60" cy="18" rx="10" ry="6" fill="#b8860b"/>
        <circle cx="60" cy="23" r="4" fill="#fff" stroke="#1e293b" stroke-width="1"/>
        <!-- Modern towers -->
        <rect x="5" y="35" width="15" height="28" fill="#7c3aed"/>
        <rect x="8" y="40" width="4" height="4" fill="#c4b5fd"/>
        <rect x="8" y="48" width="4" height="4" fill="#c4b5fd"/>
        <rect x="100" y="32" width="15" height="31" fill="#6366f1"/>
        <rect x="103" y="38" width="4" height="4" fill="#a5b4fc"/>
        <rect x="103" y="46" width="4" height="4" fill="#a5b4fc"/>
        <!-- Ground -->
        <rect x="0" y="63" width="120" height="17" fill="#a5b4fc"/>
      </svg>`,
      description: "UK's largest legal centre outside London. DLA Piper and Eversheds run major operations. Legal process expertise.", pros: ["Major firm operations", "Legal process expertise", "Strong universities"], cons: ["Process not prestige", "Less M&A work"] },
    { id: "swansea", name: "Swansea", region: "Wales", tagline: "Welsh Legal Tech", salaryMod: -0.15, bonuses: { dev: 3, hr: 2 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#bfdbfe"/>
        <!-- Gower hills in background -->
        <ellipse cx="20" cy="55" rx="35" ry="20" fill="#86efac"/>
        <ellipse cx="100" cy="55" rx="30" ry="18" fill="#4ade80"/>
        <!-- Swansea Bay curve -->
        <path d="M0,55 Q60,45 120,55" fill="#3b82f6"/>
        <!-- University building -->
        <rect x="45" y="32" width="35" height="25" fill="#8b5cf6"/>
        <rect x="50" y="37" width="8" height="6" fill="#c4b5fd"/>
        <rect x="62" y="37" width="8" height="6" fill="#c4b5fd"/>
        <rect x="50" y="47" width="8" height="6" fill="#c4b5fd"/>
        <rect x="62" y="47" width="8" height="6" fill="#c4b5fd"/>
        <!-- SA1 Waterfront modern buildings -->
        <rect x="8" y="40" width="18" height="17" fill="#6366f1"/>
        <rect x="12" y="44" width="4" height="4" fill="#a5b4fc"/>
        <rect x="18" y="44" width="4" height="4" fill="#a5b4fc"/>
        <!-- Welsh dragon hint -->
        <circle cx="95" cy="38" r="6" fill="#dc2626" opacity="0.8"/>
        <!-- Beach -->
        <rect x="0" y="57" width="120" height="8" fill="#fef3c7"/>
        <!-- Sea -->
        <rect x="0" y="65" width="120" height="15" fill="#60a5fa"/>
      </svg>`,
      description: "Swansea University's Hillary Rodham Clinton School of Law and growing legal services sector. Welsh Government backing for legal tech.", pros: ["University law school", "Welsh Government support", "Low costs"], cons: ["Small legal market", "Far from London courts"] },
    { id: "bournemouth", name: "Bournemouth", region: "South", tagline: "South Coast Legal", salaryMod: 0.05, bonuses: { mkt: 2, hr: 3 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#bae6fd"/>
        <!-- Sun -->
        <circle cx="95" cy="18" r="12" fill="#fbbf24"/>
        <!-- Cliff/town -->
        <rect x="0" y="35" width="120" height="20" fill="#86efac"/>
        <!-- Victorian buildings -->
        <rect x="15" y="28" width="18" height="27" fill="#fef3c7"/>
        <polygon points="15,28 24,18 33,28" fill="#dc2626"/>
        <rect x="18" y="32" width="5" height="8" fill="#1e293b"/>
        <rect x="26" y="32" width="5" height="8" fill="#1e293b"/>
        <rect x="45" y="25" width="20" height="30" fill="#8b5cf6"/>
        <rect x="49" y="30" width="5" height="6" fill="#c4b5fd"/>
        <rect x="56" y="30" width="5" height="6" fill="#c4b5fd"/>
        <rect x="49" y="40" width="5" height="6" fill="#c4b5fd"/>
        <rect x="56" y="40" width="5" height="6" fill="#c4b5fd"/>
        <!-- Pier -->
        <rect x="75" y="52" width="40" height="3" fill="#92400e"/>
        <rect x="78" y="45" width="8" height="10" fill="#78350f"/>
        <rect x="95" y="48" width="6" height="7" fill="#78350f"/>
        <!-- Beach -->
        <rect x="0" y="55" width="120" height="10" fill="#fef3c7"/>
        <!-- Sea -->
        <rect x="0" y="65" width="120" height="15" fill="#3b82f6"/>
        <!-- Waves -->
        <path d="M0,68 Q15,65 30,68 Q45,71 60,68 Q75,65 90,68 Q105,71 120,68" fill="none" stroke="#60a5fa" stroke-width="1"/>
      </svg>`,
      description: "Growing professional services hub with Bournemouth University's strong business law programme. Quality of life attracts London escapees.", pros: ["Quality of life", "Lower costs than London", "Growing legal sector"], cons: ["Smaller market", "Limited Magic Circle presence"] }
  ],

  // EDUSPARK AI - EdTech
  edu: [
    { id: "york", name: "York", region: "Yorkshire", tagline: "Education Research Hub", salaryMod: -0.05, bonuses: { sci: 4, hr: 2 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#fef9c3"/>
        <!-- York Minster -->
        <rect x="40" y="25" width="40" height="38" fill="#d4a574"/>
        <!-- Twin towers -->
        <rect x="42" y="15" width="12" height="48" fill="#c4956a"/>
        <rect x="66" y="15" width="12" height="48" fill="#c4956a"/>
        <polygon points="42,15 48,5 54,15" fill="#b8860b"/>
        <polygon points="66,15 72,5 78,15" fill="#b8860b"/>
        <!-- Central tower -->
        <rect x="52" y="20" width="16" height="10" fill="#b8860b"/>
        <polygon points="52,20 60,8 68,20" fill="#a8763d"/>
        <!-- Rose window -->
        <circle cx="60" cy="40" r="8" fill="#1e293b"/>
        <circle cx="60" cy="40" r="6" fill="#3b82f6" opacity="0.6"/>
        <!-- Gothic windows -->
        <rect x="45" y="35" width="4" height="10" fill="#1e293b"/>
        <rect x="71" y="35" width="4" height="10" fill="#1e293b"/>
        <!-- City walls hint -->
        <rect x="5" y="50" width="25" height="13" fill="#a8a29e"/>
        <rect x="8" y="45" width="4" height="8" fill="#94a3b8"/>
        <rect x="22" y="45" width="4" height="8" fill="#94a3b8"/>
        <rect x="95" y="48" width="20" height="15" fill="#a8a29e"/>
        <!-- Ground -->
        <rect x="0" y="63" width="120" height="17" fill="#86efac"/>
      </svg>`,
      description: "University of York's education department is world-ranked. Strong evidence-based education research and school partnerships.", pros: ["Top education research", "School partnerships", "Historic city appeal"], cons: ["Small city", "Limited tech scene"] },
    { id: "coventry", name: "Coventry", region: "Midlands", tagline: "Warwick & WMG Country", salaryMod: -0.05, bonuses: { sci: 3, dev: 2 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#fef3c7"/>
        <!-- Old Cathedral ruins -->
        <rect x="20" y="35" width="8" height="28" fill="#a8a29e"/>
        <rect x="35" y="40" width="6" height="23" fill="#94a3b8"/>
        <polygon points="20,35 24,20 28,35" fill="#78716c"/>
        <!-- New Cathedral - angular modern -->
        <polygon points="50,63 50,30 80,25 80,63" fill="#f59e0b"/>
        <polygon points="52,60 52,33 78,28 78,60" fill="#fbbf24"/>
        <!-- Stained glass zigzag -->
        <path d="M55,35 L60,45 L65,35 L70,45 L75,35" stroke="#dc2626" stroke-width="2" fill="none"/>
        <path d="M55,45 L60,55 L65,45 L70,55 L75,45" stroke="#3b82f6" stroke-width="2" fill="none"/>
        <!-- University modern building -->
        <rect x="90" y="40" width="25" height="23" fill="#6366f1"/>
        <rect x="95" y="45" width="6" height="5" fill="#a5b4fc"/>
        <rect x="105" y="45" width="6" height="5" fill="#a5b4fc"/>
        <rect x="95" y="53" width="6" height="5" fill="#a5b4fc"/>
        <rect x="105" y="53" width="6" height="5" fill="#a5b4fc"/>
        <!-- Ring road hint -->
        <path d="M0,68 Q30,62 60,68 Q90,74 120,68" fill="#64748b"/>
        <!-- Ground -->
        <rect x="0" y="63" width="120" height="17" fill="#86efac"/>
      </svg>`,
      description: "University of Warwick's world-ranked education research, Warwick Business School, and WMG's industry partnerships. UK City of Culture 2021 added creative energy.", pros: ["Warwick Business School", "WMG industry links", "Central UK location"], cons: ["Campus outside city", "Student town feel"] },
    { id: "bath", name: "Bath", region: "South West", tagline: "Two Universities, One Vision", salaryMod: 0.10, bonuses: { sci: 2, dev: 2, mkt: 1 },
      image: `<svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <!-- Sky -->
        <rect width="120" height="80" fill="#fef3c7"/>
        <!-- Hills -->
        <ellipse cx="0" cy="65" rx="40" ry="25" fill="#86efac"/>
        <ellipse cx="120" cy="65" rx="40" ry="25" fill="#86efac"/>
        <!-- Royal Crescent - curved Georgian terrace -->
        <path d="M15,50 Q60,35 105,50" fill="#f5f5dc" stroke="#d4a574" stroke-width="1"/>
        <path d="M20,48 Q60,35 100,48" fill="#fef3c7"/>
        <!-- Windows on crescent -->
        <rect x="25" y="42" width="4" height="5" fill="#1e293b"/>
        <rect x="35" y="40" width="4" height="5" fill="#1e293b"/>
        <rect x="45" y="38" width="4" height="5" fill="#1e293b"/>
        <rect x="55" y="37" width="4" height="5" fill="#1e293b"/>
        <rect x="65" y="38" width="4" height="5" fill="#1e293b"/>
        <rect x="75" y="40" width="4" height="5" fill="#1e293b"/>
        <rect x="85" y="42" width="4" height="5" fill="#1e293b"/>
        <!-- Roman Baths -->
        <rect x="40" y="55" width="40" height="10" fill="#c4956a"/>
        <ellipse cx="60" cy="60" rx="15" ry="5" fill="#22d3ee"/>
        <ellipse cx="60" cy="59" rx="12" ry="3" fill="#67e8f9"/>
        <!-- Columns -->
        <rect x="45" y="52" width="3" height="8" fill="#d4a574"/>
        <rect x="55" y="52" width="3" height="8" fill="#d4a574"/>
        <rect x="65" y="52" width="3" height="8" fill="#d4a574"/>
        <!-- Ground -->
        <rect x="0" y="65" width="120" height="15" fill="#86efac"/>
      </svg>`,
      description: "University of Bath's Institute of Coding and Bath Spa University's creative education programmes. Two universities, one beautiful UNESCO World Heritage city.", pros: ["Institute of Coding", "Bath Spa creativity", "UNESCO heritage city"], cons: ["Small city", "High living costs"] }
  ]
};


// Map location ID to location data for easy lookup
const LOCATION_MAP = {};
Object.values(LOCATIONS).flat().forEach(loc => {
  LOCATION_MAP[loc.id] = loc;
});

// Funding stages
const FUNDING_STAGES = {
  bootstrap: { id: "bootstrap", name: "Bootstrapped", desc: "Your savings and credit cards. Full control, tight runway." },
  angel: { id: "angel", name: "Angel Round", desc: "Smart money from experienced operators." },
  vc: { id: "vc", name: "VC Seed", desc: "Institutional capital with institutional expectations." }
};

// Friendly labels for stats
const STAT_LABELS = {
  sci: "Research",
  dev: "Product",
  mkt: "Sales",
  hr: "People",
  cash: "Cash",
  val: "Valuation",
  burn: "Burn Rate",
  staff: "Staff",
  equity: "Equity"
};

// Individual funders with personalities
// NOTE: 'equity' = the stake THEY TAKE, not what you keep
const FUNDERS = {
  // BOOTSTRAPPED - just you
  self: {
    id: "self",
    stage: "bootstrap",
    name: "Self-Funded",
    title: "Your Own Capital",
    photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="selfBg" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#f1f5f9"/>
          <stop offset="100%" style="stop-color:#cbd5e1"/>
        </linearGradient>
      </defs>
      <circle cx="40" cy="40" r="38" fill="url(#selfBg)" stroke="#64748b" stroke-width="2"/>
      <text x="40" y="35" text-anchor="middle" font-size="28">ğŸª</text>
      <text x="40" y="58" text-anchor="middle" font-size="10" fill="#475569" font-weight="bold">YOU</text>
    </svg>`,
    cash: 350,
    val: 350,
    equity: 0,
    apMod: -1,
    desc: "Â£350k from savings, credit cards, and a re-mortgaged flat. Everything on the line.",
    personality: "It's all on you. No safety net. No excuses.",
    benefits: "100% ownership, complete control over decisions, no investor meetings or reporting requirements, pivot freely without approval",
    challenges: "Limited runway, no outside expertise or network, all risk is personal, harder to hire top talent without VC credibility",
    bonus: {},
    ongoing: "No investors to blame. No one to call for help. Just you and the abyss."
  },

  // ANGELS
  dragon: {
    id: "dragon",
    stage: "angel",
    name: "Victoria Sterling",
    title: "TV Dragon / Media Personality",
    photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="dragonBg" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#fef3c7"/>
          <stop offset="100%" style="stop-color:#fcd34d"/>
        </linearGradient>
      </defs>
      <circle cx="40" cy="40" r="38" fill="url(#dragonBg)" stroke="#f59e0b" stroke-width="2"/>
      <!-- Glamorous blonde hair -->
      <ellipse cx="40" cy="32" rx="22" ry="18" fill="#fbbf24"/>
      <path d="M18 35 Q25 20 40 18 Q55 20 62 35 Q55 28 40 26 Q25 28 18 35" fill="#fde047"/>
      <!-- Face -->
      <ellipse cx="40" cy="42" rx="16" ry="18" fill="#fef3c7"/>
      <!-- Confident eyes with lashes -->
      <ellipse cx="33" cy="38" rx="4" ry="3" fill="white"/>
      <ellipse cx="47" cy="38" rx="4" ry="3" fill="white"/>
      <circle cx="33" cy="38" r="2" fill="#1e3a5f"/>
      <circle cx="47" cy="38" r="2" fill="#1e3a5f"/>
      <path d="M29 35 L32 37 M34 37 L37 35" stroke="#1a1a1a" stroke-width="1"/>
      <path d="M43 35 L46 37 M48 37 L51 35" stroke="#1a1a1a" stroke-width="1"/>
      <!-- Red lipstick smirk -->
      <path d="M34 50 Q40 54 46 50" stroke="#dc2626" stroke-width="2.5" fill="none"/>
      <!-- Gold earrings -->
      <circle cx="22" cy="45" r="3" fill="#f59e0b"/>
      <circle cx="58" cy="45" r="3" fill="#f59e0b"/>
      <!-- Power blazer -->
      <path d="M20 65 L28 55 L40 58 L52 55 L60 65" fill="#dc2626"/>
      <path d="M36 58 L40 65 L44 58" fill="white"/>
    </svg>`,
    cash: 600,
    val: 833,
    equity: 30,
    apMod: 0,
    desc: "Famous investor from Dragons' Den. Puts in Â£250k on top of your Â£350k savings.",
    personality: "I don't do hand-holding. Weekly numbers or I'm on the phone asking why not.",
    bonus: { mkt: 3, dev: 1 },
    benefits: "Massive media exposure, PR connections open doors with enterprise customers, brand recognition helps recruiting, most cash of all angels",
    challenges: "Demands the most equity, weekly updates expected, may go public with criticism if unhappy, fame comes at a price",
    ongoing: "+3 Sales, +1 Product from media exposure. Expects results fast."
  },
  
  techAngel: {
    id: "techAngel",
    stage: "angel",
    name: "James Chen-Williams",
    title: "Exited Founder / Angel Syndicate Lead",
    photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="techBg" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#dbeafe"/>
          <stop offset="100%" style="stop-color:#93c5fd"/>
        </linearGradient>
      </defs>
      <circle cx="40" cy="40" r="38" fill="url(#techBg)" stroke="#3b82f6" stroke-width="2"/>
      <!-- Neat dark hair -->
      <path d="M22 38 Q24 22 40 20 Q56 22 58 38 Q54 30 40 28 Q26 30 22 38" fill="#1e293b"/>
      <!-- Face -->
      <ellipse cx="40" cy="44" rx="15" ry="17" fill="#fef3c7"/>
      <!-- Glasses -->
      <rect x="26" y="38" width="12" height="9" rx="2" fill="none" stroke="#1e40af" stroke-width="2"/>
      <rect x="42" y="38" width="12" height="9" rx="2" fill="none" stroke="#1e40af" stroke-width="2"/>
      <path d="M38 42 L42 42" stroke="#1e40af" stroke-width="2"/>
      <!-- Eyes behind glasses -->
      <circle cx="32" cy="42" r="2" fill="#1e293b"/>
      <circle cx="48" cy="42" r="2" fill="#1e293b"/>
      <!-- Slight smile -->
      <path d="M35 52 Q40 55 45 52" stroke="#92400e" stroke-width="1.5" fill="none"/>
      <!-- Patagonia vest over hoodie -->
      <rect x="24" y="60" width="32" height="18" fill="#475569"/>
      <rect x="28" y="62" width="24" height="14" fill="#1e40af"/>
      <rect x="36" y="62" width="8" height="6" fill="#60a5fa"/>
    </svg>`,
    cash: 490,
    val: 800,
    equity: 17.5,
    apMod: 0,
    desc: "Sold his startup for Â£200M. Puts in Â£140k on top of your Â£350k savings.",
    personality: "I've built this before. Listen to my advice or don't - but I told you so.",
    bonus: { dev: 2, sci: 2 },
    benefits: "Deep technical credibility, can help debug architecture decisions, strong angel syndicate for follow-on, understands founder psychology",
    challenges: "Will question every technical choice, sometimes stuck in old playbooks, less help with commercial side, opinions come whether asked or not",
    ongoing: "+2 Product, +2 Research. Will second-guess every technical decision."
  },
  
  operatorAngel: {
    id: "operatorAngel",
    stage: "angel",
    name: "Sarah Okonkwo",
    title: "Former COO / Operating Partner",
    photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="opsBg" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#d1fae5"/>
          <stop offset="100%" style="stop-color:#6ee7b7"/>
        </linearGradient>
      </defs>
      <circle cx="40" cy="40" r="38" fill="url(#opsBg)" stroke="#10b981" stroke-width="2"/>
      <!-- Natural afro hair -->
      <circle cx="40" cy="32" r="20" fill="#1c1917"/>
      <circle cx="28" cy="28" r="8" fill="#1c1917"/>
      <circle cx="52" cy="28" r="8" fill="#1c1917"/>
      <circle cx="24" cy="36" r="6" fill="#1c1917"/>
      <circle cx="56" cy="36" r="6" fill="#1c1917"/>
      <!-- Face -->
      <ellipse cx="40" cy="45" rx="14" ry="16" fill="#8b5a2b"/>
      <!-- Warm confident eyes -->
      <ellipse cx="34" cy="42" rx="3" ry="2.5" fill="white"/>
      <ellipse cx="46" cy="42" rx="3" ry="2.5" fill="white"/>
      <circle cx="34" cy="42" r="1.5" fill="#1c1917"/>
      <circle cx="46" cy="42" r="1.5" fill="#1c1917"/>
      <!-- Warm smile -->
      <path d="M34 52 Q40 57 46 52" stroke="#5c3d2e" stroke-width="2" fill="none"/>
      <!-- Small gold studs -->
      <circle cx="26" cy="45" r="2" fill="#fbbf24"/>
      <circle cx="54" cy="45" r="2" fill="#fbbf24"/>
      <!-- Professional blouse -->
      <path d="M22 68 L30 58 L40 60 L50 58 L58 68" fill="#059669"/>
      <circle cx="40" cy="62" r="2" fill="#fbbf24"/>
    </svg>`,
    cash: 510,
    val: 1000,
    equity: 16,
    apMod: 0,
    desc: "Scaled three startups as COO. Puts in Â£160k on top of your Â£350k savings.",
    personality: "I've seen founders burn out and companies crater. I won't let that happen here.",
    bonus: { hr: 3, sci: 1 },
    benefits: "Founder-friendly equity terms, operational playbooks save time, helps avoid common scaling mistakes, strong on team building and culture",
    challenges: "Quarterly org reviews can feel intrusive, process-heavy approach may slow early experimentation, less technical depth",
    ongoing: "+3 People, +1 Research from ops efficiency. Quarterly reviews."
  },
  
  academicAngel: {
    id: "academicAngel",
    stage: "angel",
    name: "Dr. Molly Franklin",
    title: "Academic Angel / Former Spinout Founder",
    photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="acadBg" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#fae8ff"/>
          <stop offset="100%" style="stop-color:#e879f9"/>
        </linearGradient>
      </defs>
      <circle cx="40" cy="40" r="38" fill="url(#acadBg)" stroke="#a855f7" stroke-width="2"/>
      <!-- Auburn/reddish-brown hair in professional style -->
      <path d="M20 42 Q18 25 40 18 Q62 25 60 42 L56 58 L24 58 Z" fill="#8B4513"/>
      <path d="M24 38 Q26 24 40 22 Q54 24 56 38" fill="#8B4513"/>
      <!-- Side-swept fringe -->
      <path d="M26 32 Q34 28 42 32 Q36 26 26 32" fill="#A0522D"/>
      <!-- Face with English rose complexion -->
      <ellipse cx="40" cy="42" rx="15" ry="17" fill="#FFE4E1"/>
      <!-- Rosy cheeks -->
      <circle cx="30" cy="46" r="3" fill="#FFB6C1" opacity="0.4"/>
      <circle cx="50" cy="46" r="3" fill="#FFB6C1" opacity="0.4"/>
      <!-- Glasses - round academic style -->
      <circle cx="33" cy="40" r="7" fill="none" stroke="#4B0082" stroke-width="1.5"/>
      <circle cx="47" cy="40" r="7" fill="none" stroke="#4B0082" stroke-width="1.5"/>
      <path d="M40 40 L40 40" stroke="#4B0082" stroke-width="1.5"/>
      <path d="M26 40 L22 38" stroke="#4B0082" stroke-width="1.5"/>
      <path d="M54 40 L58 38" stroke="#4B0082" stroke-width="1.5"/>
      <!-- Blue-green eyes behind glasses -->
      <circle cx="33" cy="40" r="2" fill="#2E8B57"/>
      <circle cx="47" cy="40" r="2" fill="#2E8B57"/>
      <!-- Warm academic smile -->
      <path d="M35 51 Q40 55 45 51" stroke="#8B4513" stroke-width="1.5" fill="none"/>
      <!-- Pearl stud earrings -->
      <circle cx="24" cy="44" r="2" fill="#FAEBD7" stroke="#D4AF37" stroke-width="0.5"/>
      <circle cx="56" cy="44" r="2" fill="#FAEBD7" stroke="#D4AF37" stroke-width="0.5"/>
      <!-- Academic blazer in Oxford purple -->
      <path d="M22 65 L28 55 L40 58 L52 55 L58 65" fill="#4B0082"/>
      <path d="M36 58 L40 65 L44 58" fill="white"/>
    </svg>`,
    cash: 470,
    val: 1000,
    equity: 12,
    apMod: 0,
    desc: "Spun out two companies from Imperial College. Puts in Â£120k on top of your Â£350k savings.",
    personality: "The best startups are built on real science. I'll connect you to researchers who can give you an edge.",
    bonus: { sci: 3, dev: 1 },
    benefits: "Best equity terms of all angels (only 12%), deep research network, grant funding expertise, university partnership connections, scientific credibility",
    challenges: "Least cash of all angels, less commercial instinct, may prioritise research elegance over speed to market, academic pace can frustrate",
    ongoing: "+3 Research, +1 Product from academic network. May suggest 'one more experiment' before launch."
  },

  // VCs - greedier and more demanding
  sectorVC: {
    id: "sectorVC",
    stage: "vc",
    name: "Meridian Health Ventures",
    title: "Specialist HealthTech VC",
    photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="mhvBg" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#ede9fe"/>
          <stop offset="100%" style="stop-color:#c4b5fd"/>
        </linearGradient>
      </defs>
      <circle cx="40" cy="40" r="38" fill="url(#mhvBg)" stroke="#8b5cf6" stroke-width="2"/>
      <!-- Building/institution icon -->
      <rect x="24" y="28" width="32" height="32" fill="#7c3aed" rx="3"/>
      <!-- Cross symbol -->
      <rect x="36" y="32" width="8" height="24" fill="white"/>
      <rect x="28" y="40" width="24" height="8" fill="white"/>
      <!-- Pillars -->
      <rect x="26" y="52" width="4" height="8" fill="#a78bfa"/>
      <rect x="34" y="52" width="4" height="8" fill="#a78bfa"/>
      <rect x="42" y="52" width="4" height="8" fill="#a78bfa"/>
      <rect x="50" y="52" width="4" height="8" fill="#a78bfa"/>
      <!-- Fund name -->
      <text x="40" y="72" text-anchor="middle" font-size="7" fill="#5b21b6" font-weight="bold">MERIDIAN</text>
    </svg>`,
    cash: 750,
    val: 2500,
    equity: 30,
    apMod: 1,
    desc: "Â£50M fund. They only do health-tech. If you're not in health-tech, why are we talking?",
    personality: "We know every public health system procurement officer by first name. Do exactly what we say with intros or don't waste them.",
    bonus: { sci: 2, mkt: 3 },
    benefits: "Deep domain expertise opens NHS and health system doors, regulatory navigation support, credibility with pharma partners, portfolio company synergies",
    challenges: "Board seat means less autonomy, may push you toward their sector vision, portfolio conflicts possible, expects you to prioritise their intros",
    ongoing: "+2 Research, +3 Sales from public health system network. Board seat. They WILL bring other portfolio companies to your meetings."
  },
  
  tier1VC: {
    id: "tier1VC",
    stage: "vc",
    name: "Polaris Partners",
    title: "Tier-1 Generalist VC",
    photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="nsBg" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#fce7f3"/>
          <stop offset="100%" style="stop-color:#f9a8d4"/>
        </linearGradient>
        <linearGradient id="starGold" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#fef3c7"/>
          <stop offset="100%" style="stop-color:#fbbf24"/>
        </linearGradient>
      </defs>
      <circle cx="40" cy="40" r="38" fill="url(#nsBg)" stroke="#ec4899" stroke-width="2"/>
      <!-- Large prominent star -->
      <polygon points="40,12 45,28 62,28 48,38 54,55 40,45 26,55 32,38 18,28 35,28" fill="url(#starGold)" stroke="#f59e0b" stroke-width="1"/>
      <!-- Inner star detail -->
      <polygon points="40,20 43,30 52,30 45,36 48,46 40,40 32,46 35,36 28,30 37,30" fill="#fef3c7"/>
      <!-- Fund name -->
      <text x="40" y="68" text-anchor="middle" font-size="6" fill="#be185d" font-weight="bold">POLARIS</text>
      <text x="40" y="75" text-anchor="middle" font-size="5" fill="#9d174d">PARTNERS</text>
    </svg>`,
    cash: 1200,
    val: 3000,
    equity: 40,
    apMod: 1,
    desc: "The logo on your deck that makes other VCs return calls. They know what they're worth.",
    personality: "We backed 3 unicorns last year. We know the pattern. Hit your numbers or we'll find a CEO who can.",
    bonus: { mkt: 4, hr: 2 },
    benefits: "Brand prestige attracts top talent and customers, strong follow-on support, extensive network of operators and advisors, credibility with enterprise buyers",
    challenges: "Highest equity cost, monthly board scrutiny, aggressive growth expectations, will replace founders who miss targets",
    ongoing: "+4 Sales from brand, +2 People from network. Monthly board. Miss targets twice and they'll 'help' with leadership."
  },
  
  corporateVC: {
    id: "corporateVC",
    stage: "vc",
    name: "Lexis Ventures",
    title: "Corporate VC (Publishing/Data Giant)",
    photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="relxBg" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#e0e7ff"/>
          <stop offset="100%" style="stop-color:#a5b4fc"/>
        </linearGradient>
      </defs>
      <circle cx="40" cy="40" r="38" fill="url(#relxBg)" stroke="#4f46e5" stroke-width="2"/>
      <!-- Corporate building -->
      <rect x="20" y="22" width="40" height="38" fill="#4338ca" rx="2"/>
      <!-- Windows grid -->
      <rect x="24" y="26" width="6" height="5" fill="#c7d2fe"/>
      <rect x="32" y="26" width="6" height="5" fill="#c7d2fe"/>
      <rect x="42" y="26" width="6" height="5" fill="#c7d2fe"/>
      <rect x="50" y="26" width="6" height="5" fill="#c7d2fe"/>
      <rect x="24" y="34" width="6" height="5" fill="#c7d2fe"/>
      <rect x="32" y="34" width="6" height="5" fill="#c7d2fe"/>
      <rect x="42" y="34" width="6" height="5" fill="#a5b4fc"/>
      <rect x="50" y="34" width="6" height="5" fill="#c7d2fe"/>
      <rect x="24" y="42" width="6" height="5" fill="#c7d2fe"/>
      <rect x="32" y="42" width="6" height="5" fill="#a5b4fc"/>
      <rect x="42" y="42" width="6" height="5" fill="#c7d2fe"/>
      <rect x="50" y="42" width="6" height="5" fill="#c7d2fe"/>
      <!-- Door -->
      <rect x="36" y="50" width="8" height="10" fill="#1e1b4b"/>
      <!-- Company name -->
      <text x="40" y="72" text-anchor="middle" font-size="9" fill="#3730a3" font-weight="bold">LEXIS</text>
    </svg>`,
    cash: 1000,
    val: 2800,
    equity: 35,
    apMod: 1,
    desc: "Strategic arm of a Â£50B data giant. They see you as a feature, not a company.",
    personality: "We move slowly because we're not going anywhere. You might be acquired. You might be acqui-hired. Depends on performance.",
    bonus: { dev: 3, mkt: 2, sci: 1 },
    benefits: "Access to proprietary data and APIs, built-in enterprise customer, product development resources, clear acquisition path if desired",
    challenges: "Strategic strings attached, acquisition right of first refusal, may limit pivots away from their interests, slow decision-making culture",
    ongoing: "+3 Product (data access), +2 Sales, +1 Research. They'll want right of first refusal on acquisition. Non-negotiable."
  }
};

// Helper to get funder data
function getFunder(funderId) {
  return FUNDERS[funderId];
}

// Funder advice templates - each funder has domain preferences and personality-driven advice
const FUNDER_ADVICE = {
  self: null, // Bootstrapped = no investor advice
  
  dragon: {
    name: "Victoria",
    preferredDomains: ["marketing", "marketing", "marketing", "dev"], // Heavily biased to sales
    preferredChoice: 0, // Usually wants the big/expensive option
    advice: {
      marketing: [
        { text: "Go big on this one. My phone's been ringing-people are watching.", reason: "Visibility is everything in the early days." },
        { text: "This is a PR opportunity. Don't be cheap.", reason: "I didn't invest in a company that hides." },
        { text: "I want to see headlines, not excuses.", reason: "My brand is attached to yours now." }
      ],
      research: [
        { text: "Science is nice, but what are customers saying?", reason: "Revenue first, research later." },
        { text: "Don't over-engineer this. Ship something.", reason: "Perfect is the enemy of profitable." }
      ],
      dev: [
        { text: "Make it look good. First impressions matter.", reason: "I've seen ugly products die." },
        { text: "Speed to market. We can fix bugs later.", reason: "Someone else will eat your lunch." }
      ],
      hr: [
        { text: "Hire salespeople. Everything else can wait.", reason: "No sales, no company." },
        { text: "I don't care about culture-I care about numbers.", reason: "Happy employees don't pay my returns." }
      ]
    },
    followedReaction: "Good. That's the Victoria Sterling way. ğŸ’ª",
    ignoredReaction: "Fine. Do it your way. But remember who's watching. ğŸ˜’",
    hostileWarning: "I'm starting to wonder if you know what you're doing.",
    hostileEffect: { mkt: -2 } // Withdraws PR support
  },
  
  techAngel: {
    name: "James",
    preferredDomains: ["dev", "research", "dev", "research"], // Technical focus
    preferredChoice: 1, // Usually wants the balanced/smart option
    advice: {
      marketing: [
        { text: "Marketing's fine, but is the product ready?", reason: "Don't sell what you can't deliver." },
        { text: "Developer marketing > consumer marketing at this stage.", reason: "Build the community first." }
      ],
      research: [
        { text: "This is why I invested. Push the science.", reason: "Technology advantages are the best protection against competitors." },
        { text: "Have you talked to the team at CortexAI about this?", reason: "I can make an intro." },
        { text: "Don't rush peer review. Do it right.", reason: "One retraction kills a company." }
      ],
      dev: [
        { text: "Technical debt now means pain later. Invest properly.", reason: "I've seen this movie before." },
        { text: "Architecture matters. Don't cut corners.", reason: "You'll thank me at scale." },
        { text: "Have you considered the API design carefully?", reason: "B2B success is built on good APIs." }
      ],
      hr: [
        { text: "Hire engineers, not managers.", reason: "Execution beats process at this stage." },
        { text: "Culture follows talent. Get the best people.", reason: "A-players attract A-players." }
      ]
    },
    followedReaction: "Smart choice. This is why we backed you. ğŸ™‚",
    ignoredReaction: "Your call. But I've seen what happens when you ignore the tech. ğŸ˜",
    hostileWarning: "I'm losing confidence in the technical direction here.",
    hostileEffect: { dev: -2, sci: -1 } // Withdraws technical network
  },
  
  operatorAngel: {
    name: "Sarah",
    preferredDomains: ["hr", "hr", "dev", "marketing"], // People & ops focus
    preferredChoice: 1, // Usually wants the sustainable/balanced option
    advice: {
      marketing: [
        { text: "Make sure the team can handle the growth this creates.", reason: "I've seen companies break from success." },
        { text: "Customer success > customer acquisition.", reason: "Churn will kill you quietly." }
      ],
      research: [
        { text: "Is the team burning out on this?", reason: "Sustainable pace wins marathons." },
        { text: "Document everything. Key-person risk is real.", reason: "What if your lead scientist leaves?" }
      ],
      dev: [
        { text: "Process matters. How are you tracking this work?", reason: "Chaos doesn't scale." },
        { text: "Make sure there's coverage. No single points of failure.", reason: "I've seen CTOs burn out." }
      ],
      hr: [
        { text: "This is the priority. Always.", reason: "Your people are your company." },
        { text: "Invest in management training. Promote from within.", reason: "External hires break culture." },
        { text: "Have you done the engagement survey yet?", reason: "Problems hide until they explode." }
      ]
    },
    followedReaction: "Good. Building the right way. ğŸ˜Š",
    ignoredReaction: "I hope you know what you're doing. People remember how they're treated. ğŸ˜•",
    hostileWarning: "The team is noticing. And so am I.",
    hostileEffect: { hr: -3 } // Withdraws ops support
  },
  
  academicAngel: {
    name: "Molly",
    preferredDomains: ["research", "research", "dev", "research"], // Research-focused
    preferredChoice: 1, // Usually wants the methodical/rigorous option
    advice: {
      marketing: [
        { text: "Have we published the research behind this yet?", reason: "Academic credibility opens doors you can't buy." },
        { text: "Consider a conference paper alongside the launch.", reason: "Peer review builds trust in technical markets." }
      ],
      research: [
        { text: "This is exactly why I invested. Push the science.", reason: "Your research advantage is your moat." },
        { text: "I can connect you with the team at Imperial doing similar work.", reason: "Collaboration accelerates discovery." },
        { text: "Don't rush to publish until it's solid.", reason: "One retraction destroys credibility." },
        { text: "Have you considered an Innovate UK grant for this?", reason: "Non-dilutive funding is always worth pursuing." }
      ],
      dev: [
        { text: "Make sure the implementation matches the theory.", reason: "The gap between paper and product is where startups die." },
        { text: "Document the methodology. Future hires need to understand it.", reason: "Key-person risk is real in research-heavy teams." }
      ],
      hr: [
        { text: "A scientific advisory board would strengthen your position.", reason: "Top researchers lend credibility." },
        { text: "Consider a PhD student placement. Fresh thinking, lower cost.", reason: "I can make introductions." },
        { text: "Research culture matters. Hire people who publish.", reason: "Rigour compounds over time." }
      ]
    },
    followedReaction: "Good. Rigour pays off in the long run. ğŸ“š",
    ignoredReaction: "Your choice. But cutting corners on research rarely ends well. ğŸ¤”",
    hostileWarning: "I'm concerned we're losing our scientific edge.",
    hostileEffect: { sci: -3 } // Withdraws academic network
  },
  
  sectorVC: {
    name: "Meridian",
    preferredDomains: ["research", "marketing", "research", "dev"], // Sector expertise
    preferredChoice: 0, // Wants the ambitious option
    advice: {
      marketing: [
        { text: "We can get you in front of three public health system trusts next month. Go big.", reason: "Our network is your unfair advantage." },
        { text: "Position for the public health system Innovation Accelerator.", reason: "Government backing changes everything." }
      ],
      research: [
        { text: "This aligns with the regulatory pathway. Prioritise it.", reason: "We know what the MHRA wants to see." },
        { text: "Our portfolio company did something similar. I'll connect you.", reason: "Learn from others' mistakes." },
        { text: "Publish this. Credibility in healthtech is everything.", reason: "Clinicians read journals, not blogs." }
      ],
      dev: [
        { text: "public health system integration requirements are non-negotiable. Plan for them.", reason: "We've seen companies fail on this." },
        { text: "Security and compliance first. Features second.", reason: "One breach and you're done in healthcare." }
      ],
      hr: [
        { text: "Hire someone with public health system experience. It's a different world.", reason: "Procurement cycles will break you otherwise." },
        { text: "Clinical advisory board. You need credibility.", reason: "Doctors trust doctors." }
      ]
    },
    followedReaction: "Exactly right. This is why we invested. ğŸ‘",
    ignoredReaction: "Your choice. But we know this sector. ğŸ¤”",
    hostileWarning: "The board is concerned about strategic alignment.",
    hostileEffect: { mkt: -2, sci: -1 } // Withdraws public health system network
  },
  
  tier1VC: {
    name: "Polaris",
    preferredDomains: ["marketing", "dev", "marketing", "hr"], // Growth focused
    preferredChoice: 0, // Always wants the biggest/most aggressive option
    advice: {
      marketing: [
        { text: "Triple down. This is how you become a market leader.", reason: "We didn't invest in a lifestyle business." },
        { text: "Outspend the competition. We'll fund it.", reason: "First mover advantage is real." },
        { text: "I want to see 3x growth this quarter.", reason: "That's the Polaris standard." }
      ],
      research: [
        { text: "Is this moving the needle on growth?", reason: "Research is a means to an end." },
        { text: "Patent it and move on. Defensibility matters.", reason: "Don't let competitors copy you." }
      ],
      dev: [
        { text: "Ship fast. We can always iterate.", reason: "Speed is the only sustainable advantage." },
        { text: "What clever trick can make this spread by itself?", reason: "Word of mouth beats paid advertising." },
        { text: "Make it addictive. Retention is everything.", reason: "How many users come back every day?" }
      ],
      hr: [
        { text: "Hire ahead of the curve. We're planning for 10x.", reason: "The best people take months to close." },
        { text: "Get a world-class CRO. Revenue is everything.", reason: "Sales fixes everything." }
      ]
    },
    followedReaction: "Now you're thinking like a unicorn. ğŸ¦„",
    ignoredReaction: "Disappointing. We expect more aggression. ğŸ˜¤",
    hostileWarning: "The partnership is discussing leadership changes.",
    hostileEffect: { mkt: -3, hr: -1 } // Withdraws brand support and recruiting help
  },
  
  corporateVC: {
    name: "Lexis",
    preferredDomains: ["dev", "research", "dev", "marketing"], // Product & strategic fit
    preferredChoice: 1, // Wants sustainable/strategic options
    advice: {
      marketing: [
        { text: "Have you considered our enterprise customers?", reason: "We can open doors you can't." },
        { text: "Co-marketing with Lexis brands is on the table.", reason: "Our reach is your reach." }
      ],
      research: [
        { text: "This could integrate with our data assets.", reason: "Strategic synergy is why we're here." },
        { text: "Our research teams might collaborate.", reason: "We have 10,000 engineers. Use them." },
        { text: "IP considerations matter for potential acquisition.", reason: "Keep your house clean." }
      ],
      dev: [
        { text: "Build for enterprise scale from day one.", reason: "Our customers expect reliability." },
        { text: "API compatibility with our stack would be... beneficial.", reason: "Just something to consider." },
        { text: "Security audit soon. Our compliance team will help.", reason: "Enterprise sales require it." }
      ],
      hr: [
        { text: "We have a talent sharing program. Interested?", reason: "Secondments can help you scale." },
        { text: "Your team should visit our innovation hub.", reason: "Inspiration and networking." }
      ]
    },
    followedReaction: "Good alignment. The partnership is pleased. ğŸ¤",
    ignoredReaction: "Noted. We'll discuss at the next strategy review. ğŸ˜",
    hostileWarning: "Strategic misalignment is becoming a concern.",
    hostileEffect: { dev: -2, mkt: -1 } // Withdraws data access and enterprise intros
  },
  
  growthVC: {
    name: "Highland",
    preferredDomains: ["marketing", "marketing", "dev", "hr"], // Growth & scaling focus
    preferredChoice: 0, // Wants aggressive/high-impact options
    advice: {
      marketing: [
        { text: "How much are you spending to win each customer, versus how much they pay you over time?", reason: "The maths has to work." },
        { text: "Have you tested paid advertising at scale yet?", reason: "Time to pour fuel on the fire." },
        { text: "Growth rate is everything at this stage.", reason: "10x or go home." }
      ],
      research: [
        { text: "R&D is fine, but does it help you grow faster?", reason: "Science doesn't compound like users do." },
        { text: "Can you patent this? Defensibility matters.", reason: "Patents protect you from copycats." }
      ],
      dev: [
        { text: "Move fast. You can fix things later.", reason: "Speed wins in competitive markets." },
        { text: "Does each user bring in more users? That's how you grow without spending.", reason: "Organic growth is the best growth." },
        { text: "Test everything. Compare versions. Data drives growth.", reason: "Intuition doesn't scale." }
      ],
      hr: [
        { text: "Hire ahead of growth, not behind.", reason: "Scaling breaks companies that aren't ready." },
        { text: "You need a growth hacker, not more engineers.", reason: "Different skills for different stages." }
      ]
    },
    followedReaction: "Now we're talking! That's the growth mindset. ğŸ“ˆ",
    ignoredReaction: "Your company, your call. But growth waits for no one. ğŸ˜",
    hostileWarning: "I'm not seeing the trajectory we expected.",
    hostileEffect: { mkt: -3 } // Withdraws growth expertise
  },
  
  impactVC: {
    name: "Bethnal Green",
    preferredDomains: ["research", "hr", "research", "dev"], // Impact & ethics focus
    preferredChoice: 1, // Wants balanced/responsible options
    advice: {
      marketing: [
        { text: "Are we being authentic in our messaging?", reason: "Impact washing hurts everyone." },
        { text: "Let's lead with mission, not features.", reason: "People buy purpose." },
        { text: "Have you measured the social impact?", reason: "What gets measured gets done." }
      ],
      research: [
        { text: "This could genuinely help people. Prioritize it.", reason: "That's why we're all here." },
        { text: "Have you considered the ethical implications?", reason: "Responsible innovation matters." },
        { text: "Open-source some of this. Give back.", reason: "The ecosystem gave to you." }
      ],
      dev: [
        { text: "Accessibility should be built in, not bolted on.", reason: "Inclusive design is better design." },
        { text: "What's the environmental footprint?", reason: "Tech has a carbon cost." },
        { text: "Data privacy by design, please.", reason: "Trust is our most valuable asset." }
      ],
      hr: [
        { text: "Diversity isn't optional. It's essential.", reason: "Better teams build better products." },
        { text: "How's the work-life balance?", reason: "Burnout helps no one." },
        { text: "Pay equity audit soon?", reason: "Walk the talk on values." }
      ]
    },
    followedReaction: "This is what it's all about. Impact and integrity. ğŸ’š",
    ignoredReaction: "I hope you're keeping the mission in mind. ğŸ˜",
    hostileWarning: "We're concerned about mission drift.",
    hostileEffect: { hr: -2, sci: -1 } // Withdraws impact network and credibility
  }
};

// Group funders by stage for UI
const FUNDER_OPTIONS = {
  bootstrap: ["self"],
  angel: ["dragon", "techAngel", "operatorAngel", "academicAngel"],
  vc: ["sectorVC", "tier1VC", "corporateVC"]
};

// Follow-on investors for each funding path
const FOLLOW_ON_INVESTORS = {
  // For bootstrapped founders - first outside money
  bootstrap: [
    {
      id: "fof_fff",
      name: "Friends & Family",
      title: "The People Who Believe In You",
      photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
        <text x="40" y="45" text-anchor="middle" font-size="32">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</text>
        <text x="40" y="68" text-anchor="middle" font-size="7" fill="#92400e" font-weight="bold">F&F ROUND</text>
      </svg>`,
      baseCash: 60,
      baseDilution: 5,
      valMult: 1.1,
      personality: "We believe in you, not the spreadsheet. Don't let us down - we'll see you at Christmas.",
      benefits: "Patient capital with no board pressure. They trust your judgment completely.",
      bonus: {}
    },
    {
      id: "fof_microangel",
      name: "Dave Morrison",
      title: "Local Tech Entrepreneur",
      photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" fill="#e0f2fe" stroke="#0ea5e9" stroke-width="2"/>
        <path d="M25 38 Q30 25 40 24 Q50 25 55 38" fill="#6b7280"/>
        <ellipse cx="40" cy="44" rx="12" ry="14" fill="#fcd9b6"/>
        <circle cx="35" cy="41" r="2" fill="#1e293b"/><circle cx="45" cy="41" r="2" fill="#1e293b"/>
        <path d="M35 50 Q40 53 45 50" stroke="#92400e" stroke-width="1.5" fill="none"/>
        <rect x="30" y="58" width="20" height="10" fill="#0ea5e9"/>
      </svg>`,
      baseCash: 100,
      baseDilution: 12,
      valMult: 1.15,
      personality: "I sold my agency for Â£2M. First outside money isn't cheap. Monthly mentoring included.",
      benefits: "Hands-on mentorship from someone who's built and sold a company. Local connections.",
      bonus: { mkt: 1 }
    },
    {
      id: "fof_crowdfund",
      name: "CrowdFund Campaign",
      title: "Equity Crowdfunding",
      photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
        <circle cx="25" cy="35" r="6" fill="#86efac"/><circle cx="40" cy="30" r="6" fill="#86efac"/>
        <circle cx="55" cy="35" r="6" fill="#86efac"/><circle cx="30" cy="48" r="6" fill="#86efac"/>
        <circle cx="50" cy="48" r="6" fill="#86efac"/><circle cx="40" cy="55" r="6" fill="#86efac"/>
        <text x="40" y="72" text-anchor="middle" font-size="7" fill="#15803d" font-weight="bold">CROWD</text>
      </svg>`,
      baseCash: 180,
      baseDilution: 15,
      valMult: 1.2,
      personality: "347 investors, 347 opinions. More money but more dilution. They'll all email you.",
      benefits: "Built-in customer base and brand ambassadors. Great for B2C visibility.",
      bonus: { mkt: 2, hr: -1 }
    }
  ],
  
  // For angel-backed founders - follow-on angels or first VCs
  // The "existing" option is dynamically replaced based on which angel was chosen
  angel: [
    {
      id: "fof_existing",
      name: "Pro-Rata Rights",
      title: "Your Existing Angels Follow On",
      photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
        <text x="40" y="38" text-anchor="middle" font-size="24">ğŸ”„</text>
        <text x="40" y="55" text-anchor="middle" font-size="8" fill="#92400e">EXISTING</text>
        <text x="40" y="68" text-anchor="middle" font-size="7" fill="#92400e" font-weight="bold">INVESTORS</text>
      </svg>`,
      baseCash: 100,
      baseDilution: 12,
      valMult: 1.2,
      personality: "We're doubling down. Same terms as before, no new due diligence.",
      benefits: "Fast close with people who already know your business. No new negotiations.",
      bonus: {}
    },
    {
      id: "fof_superangel",
      name: "Niklas Ã–stberg",
      title: "European Super Angel",
      photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" fill="#ede9fe" stroke="#8b5cf6" stroke-width="2"/>
        <path d="M22 36 Q28 22 40 20 Q52 22 58 36" fill="#e5e7eb"/>
        <ellipse cx="40" cy="42" rx="14" ry="16" fill="#fcd9b6"/>
        <rect x="28" y="38" width="10" height="6" rx="1" fill="none" stroke="#4b5563" stroke-width="1.5"/>
        <rect x="42" y="38" width="10" height="6" rx="1" fill="none" stroke="#4b5563" stroke-width="1.5"/>
        <circle cx="33" cy="41" r="2" fill="#1e293b"/><circle cx="47" cy="41" r="2" fill="#1e293b"/>
        <path d="M35 52 Q40 55 45 52" stroke="#92400e" stroke-width="1.5" fill="none"/>
        <rect x="32" y="60" width="16" height="8" fill="#1e1b4b"/>
      </svg>`,
      baseCash: 300,
      baseDilution: 22,
      valMult: 1.2,
      personality: "I've backed 200 companies. New money costs more than existing investors. That's just how it works.",
      benefits: "Pan-European network and pattern recognition from hundreds of investments.",
      bonus: { mkt: 2 }
    },
    {
      id: "fof_seedvc",
      name: "Advance Partners",
      title: "Seed-Stage VC",
      photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
        <path d="M25 25 L55 25 L55 55 L25 55 Z" fill="#2563eb"/>
        <path d="M30 35 L40 28 L50 35 L50 50 L30 50 Z" fill="white"/>
        <rect x="37" y="42" width="6" height="8" fill="#2563eb"/>
        <text x="40" y="70" text-anchor="middle" font-size="6" fill="#1e40af" font-weight="bold">ADVANCE</text>
      </svg>`,
      baseCash: 450,
      baseDilution: 28,
      valMult: 1.3,
      personality: "We're seed specialists. New institutional money isn't cheap. Board seat required.",
      benefits: "Institutional rigour, follow-on connections, and credibility with enterprise customers.",
      bonus: { dev: 2, mkt: 1 }
    }
  ],
  
  // Angel-specific follow-on configurations (used to customize the "existing" option)
  // Terms should align with or exceed initial investment demands
  angel_followon: {
    dragon: {
      baseCash: 150,      // Victoria can offer more but...
      baseDilution: 18,   // ...she's demanding (12% per Â£100k, same as initial)
      valMult: 1.15,
      personality: "I'm doubling down. Same terms as before - I don't do discounts, darling.",
      benefits: "More media exposure and PR connections. Her network keeps delivering.",
      bonus: { mkt: 2 }
    },
    techAngel: {
      baseCash: 100,      // James has moderate resources  
      baseDilution: 12,   // 12% per Â£100k, consistent with initial
      valMult: 1.2,
      personality: "The tech is solid. I'll bring in my syndicate at the same terms.",
      benefits: "Access to his angel syndicate and continued technical mentorship.",
      bonus: { dev: 1, sci: 1 }
    },
    operatorAngel: {
      baseCash: 120,      // Sarah has good resources
      baseDilution: 12,   // 10% per Â£100k, slightly better as she's founder-friendly
      valMult: 1.25,
      personality: "You're executing well. I'll follow on - same fair terms as before.",
      benefits: "Deeper operational support as you scale. Her playbooks save months.",
      bonus: { hr: 2 }
    },
    academicAngel: {
      baseCash: 80,       // Molly has limited capital
      baseDilution: 8,    // 10% per Â£100k, consistent with initial
      valMult: 1.3,
      personality: "The research is promising. I can bring in a small follow-on at the same terms.",
      benefits: "Expanded university partnerships and research collaborations.",
      bonus: { sci: 2 }
    }
  },
  
  // VC options unlocked after Milestone 1 (for bootstrap/angel paths)
  vc_unlocked: [
    {
      id: "fof_seedvc_hoxton",
      name: "Hackney Ventures",
      title: "Seed-Stage VC",
      photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" fill="#fce7f3" stroke="#ec4899" stroke-width="2"/>
        <rect x="22" y="28" width="36" height="24" rx="3" fill="#db2777"/>
        <text x="40" y="45" text-anchor="middle" font-size="14" fill="white" font-weight="bold">HV</text>
        <text x="40" y="68" text-anchor="middle" font-size="6" fill="#9d174d" font-weight="bold">HACKNEY</text>
      </svg>`,
      baseCash: 400,
      baseDilution: 26,
      valMult: 1.3,
      personality: "We back technical founders. But new VC money comes at VC prices.",
      benefits: "Deep technical network and hands-on product expertise. Great for dev-heavy teams.",
      bonus: { dev: 2, sci: 1 }
    },
    {
      id: "fof_seedvc_localglobe",
      name: "CapitalSphere",
      title: "London's Premier Seed Fund",
      photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
        <circle cx="40" cy="40" r="18" fill="none" stroke="#2563eb" stroke-width="3"/>
        <circle cx="40" cy="40" r="10" fill="#2563eb"/>
        <circle cx="40" cy="40" r="4" fill="white"/>
        <text x="40" y="70" text-anchor="middle" font-size="5" fill="#1e40af" font-weight="bold">CAPSPHERE</text>
      </svg>`,
      baseCash: 550,
      baseDilution: 30,
      valMult: 1.35,
      personality: "We've backed three unicorns in fintech, proptech, and mobility. Our brand costs. But you get the network.",
      benefits: "Top-tier brand recognition that opens doors with customers, talent, and Series A investors.",
      bonus: { mkt: 3, hr: 1 }
    },
    {
      id: "fof_seedvc_notion",
      name: "Blueprint Capital",
      title: "B2B SaaS Specialists",
      photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" fill="#f0fdf4" stroke="#22c55e" stroke-width="2"/>
        <rect x="25" y="30" width="30" height="20" rx="2" fill="#15803d"/>
        <text x="40" y="45" text-anchor="middle" font-size="12" fill="white" font-weight="bold">N</text>
        <text x="40" y="68" text-anchor="middle" font-size="6" fill="#166534" font-weight="bold">BLUEPRINT</text>
      </svg>`,
      baseCash: 500,
      baseDilution: 28,
      valMult: 1.25,
      personality: "Enterprise software is our game. New investors pay a premium. We know every CTO in Europe.",
      benefits: "Enterprise sales playbooks and CTO introductions across FTSE 100 companies.",
      bonus: { mkt: 2, dev: 2 }
    }
  ],
  
  // For VC-backed founders - Series A/B investors (now only available via follow-on)
  vc: [
    {
      id: "fof_insideround",
      name: "Inside Round",
      title: "Existing VCs Extend Runway",
      photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" fill="#fee2e2" stroke="#ef4444" stroke-width="2"/>
        <text x="40" y="38" text-anchor="middle" font-size="24">ğŸ </text>
        <text x="40" y="55" text-anchor="middle" font-size="8" fill="#b91c1c">INSIDE</text>
        <text x="40" y="68" text-anchor="middle" font-size="7" fill="#b91c1c" font-weight="bold">ROUND</text>
      </svg>`,
      baseCash: 350,
      baseDilution: 18,
      valMult: 1.05,
      personality: "Flat round. We're protecting our position. No new validation, but we know you.",
      benefits: "Quick close, no new due diligence, maintains existing board dynamics.",
      bonus: {}
    },
    {
      id: "fof_seriesa",
      name: "Polaris Capital",
      title: "Series A Leader",
      photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" fill="#fce7f3" stroke="#ec4899" stroke-width="2"/>
        <rect x="22" y="25" width="36" height="30" rx="3" fill="#be185d"/>
        <text x="40" y="45" text-anchor="middle" font-size="18" fill="white" font-weight="bold">B</text>
        <text x="40" y="68" text-anchor="middle" font-size="6" fill="#9d174d" font-weight="bold">POLARIS</text>
      </svg>`,
      baseCash: 700,
      baseDilution: 32,
      valMult: 1.4,
      personality: "We lead Series A in Europe. This is institutional money with institutional terms. 3x growth expected.",
      benefits: "Premier brand that signals market leadership. Strong Series B connections.",
      bonus: { mkt: 3, hr: 1 }
    },
    {
      id: "fof_growth",
      name: "Velocity Partners",
      title: "Growth Equity Giant",
      photo: `<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" fill="#f0fdf4" stroke="#22c55e" stroke-width="2"/>
        <path d="M20 55 L35 40 L45 48 L60 25" stroke="#15803d" stroke-width="4" fill="none" stroke-linecap="round"/>
        <circle cx="60" cy="25" r="5" fill="#22c55e"/>
        <text x="40" y="70" text-anchor="middle" font-size="8" fill="#166534" font-weight="bold">VELOCITY</text>
      </svg>`,
      baseCash: 1200,
      baseDilution: 35,
      valMult: 1.5,
      personality: "We've backed unicorns. Big checks, big expectations, big dilution. Go big or go home.",
      benefits: "Massive capital for aggressive growth. International expansion support.",
      bonus: { mkt: 4, sci: 1, dev: 1 }
    }
  ]
};

const MILESTONES = {
  aether: {
    m1: [
      { 
        id: "m1_conservative", 
        name: "Core Algorithm Validation", 
        desc: "Prove our AI works in controlled lab conditions. You'll need strong research leadership and patience - this is about getting the science right before anything else. Lower reward, but builds a solid foundation for everything that follows.",
        difficulty: "conservative",
        time: 7, 
        focus: ["sci"], 
        threshold: { sci: 48 },
        icon: "ğŸ”¬",
        reward: { cash: 75, val: 200 },
        investorFit: ["bootstrapped", "angels"]
      },
      { 
        id: "m1_balanced", 
        name: "Peer-Reviewed Publication", 
        desc: "Publish breakthrough results in a respected journal. Requires both strong science AND a working prototype to demonstrate. The publication will attract talent, investors, and potential partners - but you'll need to balance lab work with product development.",
        difficulty: "balanced",
        time: 6, 
        focus: ["sci", "dev"], 
        threshold: { dev: 50, mkt: 42 },
        icon: "ğŸ“„",
        reward: { cash: 150, val: 450 },
        investorFit: ["seed", "angels"]
      },
      { 
        id: "m1_ambitious", 
        name: "NHS Research Partnership", 
        desc: "Secure a formal research partnership with an NHS trust. You'll need excellent science AND commercial relationships - hiring sales/partnerships talent early is essential. High visibility if you succeed, but NHS partnerships move slowly and the timeline is tight.",
        difficulty: "ambitious",
        time: 5, 
        focus: ["sci", "mkt"], 
        threshold: { mkt: 56, dev: 46 },
        icon: "ğŸ¥",
        reward: { cash: 300, val: 900 },
        investorFit: ["seriesA", "seed"]
      }
    ],
    m2: [
      { 
        id: "m2_conservative", 
        name: "Safety Study Complete", 
        desc: "Complete comprehensive safety and efficacy studies. Methodical path to regulatory approval.",
        difficulty: "conservative",
        time: 6, 
        focus: ["sci", "dev"], 
        threshold: { sci: 68, dev: 62 },
        icon: "ğŸ›¡",
        reward: { cash: 80, val: 300 },
        investorFit: ["bootstrapped", "angels"]
      },
      { 
        id: "m2_balanced", 
        name: "MHRA Pre-Submission", 
        desc: "Complete MHRA pre-submission meeting with positive feedback. Clear regulatory pathway.",
        difficulty: "balanced",
        time: 5, 
        focus: ["sci", "dev", "mkt"], 
        threshold: { sci: 75, dev: 68, mkt: 55 },
        icon: "ğŸ“‹",
        reward: { cash: 175, val: 550 },
        investorFit: ["seed", "seriesA"]
      },
      { 
        id: "m2_ambitious", 
        name: "First Paying Customer", 
        desc: "Land our first paying healthcare customer. Revenue before full approval.",
        difficulty: "ambitious",
        time: 4, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 75, dev: 82, sci: 60 },
        icon: "ğŸ’·",
        reward: { cash: 400, val: 1100 },
        investorFit: ["seriesA"]
      }
    ],
    m3: [
      { 
        id: "m3_conservative", 
        name: "Data Partnership Network", 
        desc: "Secure 3+ public health system data partnerships. Build moat through exclusive access.",
        difficulty: "conservative",
        time: 5, 
        focus: ["sci", "mkt"], 
        threshold: { sci: 88, mkt: 82, dev: 65 },
        icon: "ğŸ”—",
        reward: { cash: 100, val: 400 },
        investorFit: ["bootstrapped", "angels", "seed"]
      },
      { 
        id: "m3_balanced", 
        name: "Regulatory Approval", 
        desc: "Achieve full MHRA approval for our core product. Ready for scale.",
        difficulty: "balanced",
        time: 4, 
        focus: ["sci", "dev", "mkt"], 
        threshold: { sci: 95, dev: 88, mkt: 78, hr: 68 },
        icon: "âœ…",
        reward: { cash: 250, val: 750 },
        investorFit: ["seed", "seriesA"]
      },
      { 
        id: "m3_ambitious", 
        name: "Â£1M ARR", 
        desc: "Hit Â£1M annual recurring revenue. Prove the business model works.",
        difficulty: "ambitious",
        time: 3, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 95, dev: 100, sci: 85, hr: 72 },
        icon: "ğŸš€",
        reward: { cash: 500, val: 1500 },
        investorFit: ["seriesA"]
      }
    ]
  },
  
  vanguard: {
    m1: [
      { 
        id: "m1_conservative", 
        name: "Working Prototype", 
        desc: "Build a functional robot that works reliably in controlled conditions. Focus purely on engineering excellence - your product team will drive this. Takes longer but you'll have a solid technical foundation. Good choice if you're still building your team.",
        difficulty: "conservative",
        time: 7, 
        focus: ["dev", "sci"], 
        threshold: { dev: 48 },
        icon: "ğŸ¤–",
        reward: { cash: 75, val: 200 },
        investorFit: ["bootstrapped", "angels"]
      },
      { 
        id: "m1_balanced", 
        name: "Warehouse Pilot", 
        desc: "Deploy robots in a real warehouse with a paying customer. You'll need both strong product development AND early sales capability to land and manage the pilot. Proves your tech works outside the lab - a major credibility boost.",
        difficulty: "balanced",
        time: 6, 
        focus: ["dev", "mkt"], 
        threshold: { dev: 52, mkt: 42 },
        icon: "ğŸ­",
        reward: { cash: 150, val: 450 },
        investorFit: ["seed", "angels"]
      },
      { 
        id: "m1_ambitious", 
        name: "Multi-Site Deployment", 
        desc: "Operate successfully across 3+ customer sites simultaneously. Requires exceptional product AND sales execution from day one. You'll need to hire aggressively and move fast. High risk - if the tech isn't ready, you'll burn customer relationships.",
        difficulty: "ambitious",
        time: 5, 
        focus: ["dev", "mkt"], 
        threshold: { dev: 56, mkt: 46 },
        icon: "ğŸŒ",
        reward: { cash: 300, val: 900 },
        investorFit: ["seriesA", "seed"]
      }
    ],
    m2: [
      { 
        id: "m2_conservative", 
        name: "Safety Certification", 
        desc: "Achieve CE marking and safety certification. Essential for enterprise sales.",
        difficulty: "conservative",
        time: 6, 
        focus: ["dev", "hr"], 
        threshold: { dev: 68, hr: 62 },
        icon: "ğŸ›¡",
        reward: { cash: 80, val: 300 },
        investorFit: ["bootstrapped", "angels"]
      },
      { 
        id: "m2_balanced", 
        name: "Â£500k Contract", 
        desc: "Land an enterprise contract worth Â£500k+. Validate enterprise demand.",
        difficulty: "balanced",
        time: 5, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 68, dev: 75 },
        icon: "ğŸ“",
        reward: { cash: 175, val: 550 },
        investorFit: ["seed", "seriesA"]
      },
      { 
        id: "m2_ambitious", 
        name: "Major Logistics Partner", 
        desc: "Sign strategic partnership with a top-10 UK logistics company.",
        difficulty: "ambitious",
        time: 4, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 75, dev: 82, sci: 60 },
        icon: "ğŸ¤",
        reward: { cash: 400, val: 1100 },
        investorFit: ["seriesA"]
      }
    ],
    m3: [
      { 
        id: "m3_conservative", 
        name: "Unit Economics Positive", 
        desc: "Prove each robot deployment is profitable. Sustainable growth path.",
        difficulty: "conservative",
        time: 5, 
        focus: ["dev", "mkt"], 
        threshold: { dev: 88, mkt: 82, sci: 65 },
        icon: "ğŸ“Š",
        reward: { cash: 100, val: 400 },
        investorFit: ["bootstrapped", "angels", "seed"]
      },
      { 
        id: "m3_balanced", 
        name: "Â£1M ARR", 
        desc: "Reach Â£1M annual recurring revenue across multiple customers.",
        difficulty: "balanced",
        time: 4, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 88, dev: 95, sci: 78, hr: 68 },
        icon: "ğŸ’°",
        reward: { cash: 250, val: 750 },
        investorFit: ["seed", "seriesA"]
      },
      { 
        id: "m3_ambitious", 
        name: "Series B Ready", 
        desc: "Hit metrics that justify a Â£20M+ Series B raise. Category leader positioning.",
        difficulty: "ambitious",
        time: 3, 
        focus: ["mkt", "dev", "sci"], 
        threshold: { mkt: 95, dev: 100, sci: 85, hr: 72 },
        icon: "ğŸš€",
        reward: { cash: 500, val: 1500 },
        investorFit: ["seriesA"]
      }
    ]
  },
  
  quant: {
    m1: [
      { 
        id: "m1_conservative", 
        name: "Backtest Validation", 
        desc: "Build a bulletproof backtesting framework with verified historical performance. Pure research and engineering focus - no regulatory complexity yet. Takes time but institutional investors will scrutinise your methodology heavily.",
        difficulty: "conservative",
        time: 7, 
        focus: ["sci", "dev"], 
        threshold: { sci: 48 },
        icon: "ğŸ“Š",
        reward: { cash: 75, val: 200 },
        investorFit: ["bootstrapped", "angels"]
      },
      { 
        id: "m1_balanced", 
        name: "FCA Sandbox Approval", 
        desc: "Gain approval to operate in the FCA's regulatory sandbox. You'll need strong science AND someone who can navigate financial regulation. Opens the path to live trading, but the application process is rigorous.",
        difficulty: "balanced",
        time: 6, 
        focus: ["sci", "dev", "mkt"], 
        threshold: { sci: 52, dev: 42 },
        icon: "ğŸ›",
        reward: { cash: 150, val: 450 },
        investorFit: ["seed", "angels"]
      },
      { 
        id: "m1_ambitious", 
        name: "Live Trading Pilot", 
        desc: "Go live with real capital on a limited book. Requires exceptional engineering AND research to avoid costly mistakes. One bad trade can wipe out credibility. High reward if your models actually work in production.",
        difficulty: "ambitious",
        time: 5, 
        focus: ["dev", "sci"], 
        threshold: { dev: 56, sci: 52, mkt: 40 },
        icon: "ğŸ“ˆ",
        reward: { cash: 300, val: 900 },
        investorFit: ["seriesA", "seed"]
      }
    ],
    m2: [
      { 
        id: "m2_conservative", 
        name: "First Fund Partnership", 
        desc: "Sign partnership agreement with a hedge fund or asset manager.",
        difficulty: "conservative",
        time: 6, 
        focus: ["mkt", "sci"], 
        threshold: { mkt: 62, sci: 68 },
        icon: "ğŸ¤",
        reward: { cash: 80, val: 300 },
        investorFit: ["bootstrapped", "angels"]
      },
      { 
        id: "m2_balanced", 
        name: "Â£100M AUM", 
        desc: "Reach Â£100M assets under management or advisory. Meaningful scale.",
        difficulty: "balanced",
        time: 5, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 68, dev: 75 },
        icon: "ğŸ’°",
        reward: { cash: 175, val: 550 },
        investorFit: ["seed", "seriesA"]
      },
      { 
        id: "m2_ambitious", 
        name: "Major Bank Integration", 
        desc: "Integrate with a top-tier investment bank's trading infrastructure.",
        difficulty: "ambitious",
        time: 4, 
        focus: ["dev", "mkt", "sci"], 
        threshold: { dev: 82, mkt: 75, sci: 60 },
        icon: "ğŸ¦",
        reward: { cash: 400, val: 1100 },
        investorFit: ["seriesA"]
      }
    ],
    m3: [
      { 
        id: "m3_conservative", 
        name: "Full Regulatory Compliance", 
        desc: "Achieve full Financial Regulatory Authority authorization. No more sandbox limitations.",
        difficulty: "conservative",
        time: 5, 
        focus: ["dev", "sci", "hr"], 
        threshold: { dev: 82, sci: 88, hr: 65 },
        icon: "âœ…",
        reward: { cash: 100, val: 400 },
        investorFit: ["bootstrapped", "angels", "seed"]
      },
      { 
        id: "m3_balanced", 
        name: "Â£500M AUM", 
        desc: "Scale to Â£500M assets under management. Serious player status.",
        difficulty: "balanced",
        time: 4, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 88, dev: 95, sci: 78, hr: 68 },
        icon: "ğŸ“ˆ",
        reward: { cash: 250, val: 750 },
        investorFit: ["seed", "seriesA"]
      },
      { 
        id: "m3_ambitious", 
        name: "Acquisition Target", 
        desc: "Become an attractive acquisition target for major financial institutions.",
        difficulty: "ambitious",
        time: 3, 
        focus: ["mkt", "dev", "sci"], 
        threshold: { mkt: 95, dev: 100, sci: 85, hr: 72 },
        icon: "ğŸ¯",
        reward: { cash: 500, val: 1500 },
        investorFit: ["seriesA"]
      }
    ]
  },
  
  dream: {
    m1: [
      { 
        id: "m1_conservative", 
        name: "Private Beta Launch", 
        desc: "Launch with 50+ hand-picked creators and iterate based on real feedback. Pure product focus - get the core experience right before chasing growth. You'll learn what users actually want vs what they say they want.",
        difficulty: "conservative",
        time: 7, 
        focus: ["dev"], 
        threshold: { dev: 48 },
        icon: "ğŸ§ª",
        reward: { cash: 75, val: 200 },
        investorFit: ["bootstrapped", "angels"]
      },
      { 
        id: "m1_balanced", 
        name: "10k Active Users", 
        desc: "Reach 10,000 monthly active users organically. You'll need both great product AND early marketing/community building. Proves genuine product-market fit - not just hype. Watch retention metrics closely.",
        difficulty: "balanced",
        time: 6, 
        focus: ["dev", "mkt"], 
        threshold: { dev: 52, mkt: 42 },
        icon: "ğŸ‘¥",
        reward: { cash: 150, val: 450 },
        investorFit: ["seed", "angels"]
      },
      { 
        id: "m1_ambitious", 
        name: "Viral Growth (100k Users)", 
        desc: "Chase explosive growth to 100k users. Requires aggressive marketing AND a product good enough to retain them. Social proof attracts investors, but growing too fast before product is ready can kill you with bad reviews.",
        difficulty: "ambitious",
        time: 5, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 56, dev: 46 },
        icon: "ğŸ”¥",
        reward: { cash: 300, val: 900 },
        investorFit: ["seriesA", "seed"]
      }
    ],
    m2: [
      { 
        id: "m2_conservative", 
        name: "Monetization Model Live", 
        desc: "Launch paid tier with first paying subscribers. Revenue before scale.",
        difficulty: "conservative",
        time: 6, 
        focus: ["dev", "mkt"], 
        threshold: { dev: 68, mkt: 62 },
        icon: "ğŸ’³",
        reward: { cash: 80, val: 300 },
        investorFit: ["bootstrapped", "angels"]
      },
      { 
        id: "m2_balanced", 
        name: "First Brand Partnership", 
        desc: "Sign a Â£100k+ brand or enterprise deal. B2B revenue stream.",
        difficulty: "balanced",
        time: 5, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 75, dev: 68 },
        icon: "ğŸ¤",
        reward: { cash: 175, val: 550 },
        investorFit: ["seed", "seriesA"]
      },
      { 
        id: "m2_ambitious", 
        name: "Platform Integration", 
        desc: "Integrate with major platform (PixelForge, Helix Social, QuickVid). Distribution unlock.",
        difficulty: "ambitious",
        time: 4, 
        focus: ["dev", "mkt"], 
        threshold: { dev: 82, mkt: 75, sci: 60 },
        icon: "ğŸ”Œ",
        reward: { cash: 400, val: 1100 },
        investorFit: ["seriesA"]
      }
    ],
    m3: [
      { 
        id: "m3_conservative", 
        name: "Sustainable Unit Economics", 
        desc: "CAC:LTV ratio proves business model. Path to profitability.",
        difficulty: "conservative",
        time: 5, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 82, dev: 88, hr: 65 },
        icon: "ğŸ“Š",
        reward: { cash: 100, val: 400 },
        investorFit: ["bootstrapped", "angels", "seed"]
      },
      { 
        id: "m3_balanced", 
        name: "Â£1M ARR", 
        desc: "Hit Â£1M annual recurring revenue. Real SaaS business.",
        difficulty: "balanced",
        time: 4, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 88, dev: 95, sci: 78, hr: 68 },
        icon: "ğŸ’°",
        reward: { cash: 250, val: 750 },
        investorFit: ["seed", "seriesA"]
      },
      { 
        id: "m3_ambitious", 
        name: "Category Leader", 
        desc: "Become the #1 player in our niche. Press, users, and mindshare.",
        difficulty: "ambitious",
        time: 3, 
        focus: ["mkt", "dev", "sci"], 
        threshold: { mkt: 95, dev: 100, sci: 85, hr: 72 },
        icon: "ğŸ‘‘",
        reward: { cash: 500, val: 1500 },
        investorFit: ["seriesA"]
      }
    ]
  },
  cyber: {
    m1: [
      { 
        id: "m1_conservative", 
        name: "Threat Detection Prototype", 
        desc: "Build a working threat detection system with measurable accuracy rates. Pure engineering focus - prove your tech can actually catch threats before worrying about customers. Essential foundation, but won't impress investors on its own.",
        difficulty: "conservative", 
        time: 7, 
        focus: ["dev"], 
        threshold: { dev: 48 }, 
        icon: "ğŸ”", 
        reward: { cash: 75, val: 200 }, 
        investorFit: ["bootstrapped", "angels"] 
      },
      { 
        id: "m1_balanced", 
        name: "Security Certification", 
        desc: "Achieve Cyber Essentials Plus and begin engagement with the NCSC (National Cyber Security Centre). You'll need strong product AND research credibility. Certification is table stakes for enterprise sales - without it, security leaders won't take meetings.",
        difficulty: "balanced", 
        time: 6, 
        focus: ["dev", "sci"], 
        threshold: { dev: 52, sci: 42 }, 
        icon: "âœ…", 
        reward: { cash: 150, val: 450 }, 
        investorFit: ["seed", "angels"] 
      },
      { 
        id: "m1_ambitious", 
        name: "Government Pilot", 
        desc: "Secure a pilot with a government department or critical infrastructure provider. Requires exceptional sales relationships AND rock-solid product. Government moves slowly but a successful pilot opens massive doors.",
        difficulty: "ambitious", 
        time: 5, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 52, dev: 50 }, 
        icon: "ğŸ›", 
        reward: { cash: 300, val: 900 }, 
        investorFit: ["seriesA", "seed"] 
      }
    ],
    m2: [
      { id: "m2_conservative", name: "Enterprise Customer", desc: "Sign first paying enterprise customer with annual contract.", difficulty: "conservative", time: 6, focus: ["mkt"], threshold: { mkt: 62, dev: 68 }, icon: "ğŸ¤", reward: { cash: 100, val: 300 }, investorFit: ["seed", "angels"] },
      { id: "m2_balanced", name: "SOC Integration", desc: "Integrate with major enterprise security monitoring platforms.", difficulty: "balanced", time: 5, focus: ["dev", "mkt"], threshold: { dev: 75, mkt: 68 }, icon: "ğŸ”—", reward: { cash: 200, val: 600 }, investorFit: ["seriesA", "seed"] },
      { id: "m2_ambitious", name: "NCSC Approved", desc: "Achieve NCSC assured product status.", difficulty: "ambitious", time: 4, focus: ["sci", "dev", "mkt"], threshold: { sci: 68, dev: 82, mkt: 75 }, icon: "ğŸ›¡", reward: { cash: 400, val: 1200 }, investorFit: ["seriesA"] }
    ],
    m3: [
      { id: "m3_conservative", name: "Profitable Operations", desc: "Achieve profitability with sustainable enterprise revenue.", difficulty: "conservative", time: 5, focus: ["mkt", "hr"], threshold: { mkt: 82, dev: 88, hr: 65 }, icon: "ğŸ“ˆ", reward: { cash: 150, val: 450 }, investorFit: ["bootstrapped", "angels"] },
      { id: "m3_balanced", name: "Critical Infrastructure", desc: "Protect multiple critical national infrastructure providers.", difficulty: "balanced", time: 4, focus: ["mkt", "dev"], threshold: { mkt: 88, dev: 95, sci: 78, hr: 68 }, icon: "âš¡", reward: { cash: 250, val: 750 }, investorFit: ["seed", "seriesA"] },
      { id: "m3_ambitious", name: "National Security Partner", desc: "Strategic partnership with National Cyber Agency or major defence contractor.", difficulty: "ambitious", time: 3, focus: ["mkt", "sci"], threshold: { mkt: 95, sci: 88, dev: 100, hr: 72 }, icon: "ğŸ–", reward: { cash: 500, val: 1500 }, investorFit: ["seriesA"] }
    ]
  },
  terra: {
    m1: [
      { 
        id: "m1_conservative", 
        name: "Climate Model Validation", 
        desc: "Validate your predictions against historical climate data. Pure research focus - prove your models actually work before selling them. Scientific credibility is everything in climate tech. Lower commercial reward but builds unshakeable foundation.",
        difficulty: "conservative", 
        time: 7, 
        focus: ["sci"], 
        threshold: { sci: 48 }, 
        icon: "ğŸŒ¡", 
        reward: { cash: 75, val: 200 }, 
        investorFit: ["bootstrapped", "angels"] 
      },
      { 
        id: "m1_balanced", 
        name: "Research Partnership", 
        desc: "Partner with the Met Office or an environmental agency. You'll need strong science AND relationship-building skills. These partnerships move slowly but provide invaluable data access and credibility with corporate buyers.",
        difficulty: "balanced", 
        time: 6, 
        focus: ["sci", "mkt"], 
        threshold: { sci: 52, mkt: 42 }, 
        icon: "ğŸ¤", 
        reward: { cash: 150, val: 450 }, 
        investorFit: ["seed", "angels"] 
      },
      { 
        id: "m1_ambitious", 
        name: "Corporate Pilot", 
        desc: "Land a pilot with a major energy company or insurer. Requires sales capability AND a product ready for enterprise scrutiny. Corporates are under pressure to act on climate - timing is good, but they'll demand rigorous proof.",
        difficulty: "ambitious", 
        time: 5, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 54, dev: 44 }, 
        icon: "ğŸ¢", 
        reward: { cash: 300, val: 900 }, 
        investorFit: ["seriesA", "seed"] 
      }
    ],
    m2: [
      { id: "m2_conservative", name: "B Corp Certification", desc: "Achieve B Corp status.", difficulty: "conservative", time: 6, focus: ["hr", "mkt"], threshold: { hr: 62, mkt: 68 }, icon: "ğŸŒ±", reward: { cash: 100, val: 300 }, investorFit: ["seed", "angels"] },
      { id: "m2_balanced", name: "Net Zero Platform", desc: "Launch platform helping companies reduce emissions.", difficulty: "balanced", time: 5, focus: ["dev", "mkt"], threshold: { dev: 68, mkt: 75, sci: 60 }, icon: "ğŸ“Š", reward: { cash: 200, val: 600 }, investorFit: ["seriesA", "seed"] },
      { id: "m2_ambitious", name: "Government Contract", desc: "Win contract with DEFRA or Environment Agency.", difficulty: "ambitious", time: 4, focus: ["mkt", "sci"], threshold: { mkt: 75, sci: 82, dev: 60 }, icon: "ğŸ›", reward: { cash: 400, val: 1200 }, investorFit: ["seriesA"] }
    ],
    m3: [
      { id: "m3_conservative", name: "Impact Verified", desc: "Third-party verification of environmental impact.", difficulty: "conservative", time: 5, focus: ["sci", "mkt"], threshold: { sci: 88, mkt: 82, hr: 65 }, icon: "âœ…", reward: { cash: 150, val: 450 }, investorFit: ["bootstrapped", "angels"] },
      { id: "m3_balanced", name: "Industry Standard", desc: "Platform becomes standard for carbon accounting.", difficulty: "balanced", time: 4, focus: ["mkt", "dev"], threshold: { mkt: 88, dev: 85, sci: 95, hr: 68 }, icon: "ğŸŒ", reward: { cash: 250, val: 750 }, investorFit: ["seed", "seriesA"] },
      { id: "m3_ambitious", name: "Climate Leader", desc: "Recognised as UK's leading climate tech platform.", difficulty: "ambitious", time: 3, focus: ["mkt", "sci"], threshold: { mkt: 95, sci: 100, dev: 85, hr: 72 }, icon: "ğŸ†", reward: { cash: 500, val: 1500 }, investorFit: ["seriesA"] }
    ]
  },
  legal: {
    m1: [
      { 
        id: "m1_conservative", 
        name: "Contract Analysis MVP", 
        desc: "Build a working system that can review standard contracts accurately. Pure product development - lawyers are unforgiving critics, so get the basics right. Focus on one contract type and nail it before expanding.",
        difficulty: "conservative", 
        time: 7, 
        focus: ["dev"], 
        threshold: { dev: 48 }, 
        icon: "ğŸ“„", 
        reward: { cash: 75, val: 200 }, 
        investorFit: ["bootstrapped", "angels"] 
      },
      { 
        id: "m1_balanced", 
        name: "Law Firm Pilot", 
        desc: "Deploy with a mid-tier law firm as a paying pilot. You'll need solid product AND someone who can sell to lawyers (they're sceptical buyers). Success here proves you can work within their existing workflows.",
        difficulty: "balanced", 
        time: 6, 
        focus: ["dev", "mkt"], 
        threshold: { dev: 52, mkt: 42 }, 
        icon: "âš–", 
        reward: { cash: 150, val: 450 }, 
        investorFit: ["seed", "angels"] 
      },
      { 
        id: "m1_ambitious", 
        name: "Magic Circle Interest", 
        desc: "Get formal evaluation by a Magic Circle firm. Requires exceptional research credibility AND high-level relationships. These firms move slowly but landing one transforms your market position entirely.",
        difficulty: "ambitious", 
        time: 5, 
        focus: ["mkt", "sci"], 
        threshold: { mkt: 56, sci: 44 }, 
        icon: "âœ¨", 
        reward: { cash: 300, val: 900 }, 
        investorFit: ["seriesA", "seed"] 
      }
    ],
    m2: [
      { id: "m2_conservative", name: "Accuracy Benchmark", desc: "Publish accuracy benchmarks beating manual review.", difficulty: "conservative", time: 6, focus: ["sci", "dev"], threshold: { sci: 62, dev: 68 }, icon: "ğŸ“Š", reward: { cash: 100, val: 300 }, investorFit: ["seed", "angels"] },
      { id: "m2_balanced", name: "In-House Adoption", desc: "Deploy with FTSE 250 in-house legal team.", difficulty: "balanced", time: 5, focus: ["mkt", "dev"], threshold: { mkt: 68, dev: 75 }, icon: "ğŸ¢", reward: { cash: 200, val: 600 }, investorFit: ["seriesA", "seed"] },
      { id: "m2_ambitious", name: "Strategic Partnership", desc: "Partnership with major legal tech or Big 4.", difficulty: "ambitious", time: 4, focus: ["mkt", "dev"], threshold: { mkt: 75, dev: 82, sci: 60 }, icon: "ğŸ¤", reward: { cash: 400, val: 1200 }, investorFit: ["seriesA"] }
    ],
    m3: [
      { id: "m3_conservative", name: "Profitable Growth", desc: "Sustainable revenue with expanding client base.", difficulty: "conservative", time: 5, focus: ["mkt", "hr"], threshold: { mkt: 82, dev: 88, hr: 65 }, icon: "ğŸ“ˆ", reward: { cash: 150, val: 450 }, investorFit: ["bootstrapped", "angels"] },
      { id: "m3_balanced", name: "Market Expansion", desc: "Expand beyond contracts into broader legal workflow.", difficulty: "balanced", time: 4, focus: ["dev", "mkt"], threshold: { dev: 95, mkt: 88, sci: 78, hr: 68 }, icon: "ğŸš€", reward: { cash: 250, val: 750 }, investorFit: ["seed", "seriesA"] },
      { id: "m3_ambitious", name: "Industry Transformer", desc: "Fundamentally change how law firms operate.", difficulty: "ambitious", time: 3, focus: ["mkt", "dev", "sci"], threshold: { mkt: 95, dev: 100, sci: 85, hr: 72 }, icon: "âš¡", reward: { cash: 500, val: 1500 }, investorFit: ["seriesA"] }
    ]
  },
  edu: {
    m1: [
      { 
        id: "m1_conservative", 
        name: "Learning Efficacy Study", 
        desc: "Run a controlled study proving your AI actually improves learning outcomes. Pure research focus - educators and parents need evidence, not hype. Takes time but gives you ammunition against sceptics.",
        difficulty: "conservative", 
        time: 7, 
        focus: ["sci"], 
        threshold: { sci: 48 }, 
        icon: "ğŸ“š", 
        reward: { cash: 75, val: 200 }, 
        investorFit: ["bootstrapped", "angels"] 
      },
      { 
        id: "m1_balanced", 
        name: "School Pilot", 
        desc: "Deploy in multiple schools and gather teacher feedback. You'll need both working product AND someone who understands school procurement. Teachers are your champions - win them over and they'll fight for your budget.",
        difficulty: "balanced", 
        time: 6, 
        focus: ["dev", "mkt"], 
        threshold: { dev: 50, mkt: 42 }, 
        icon: "ğŸ«", 
        reward: { cash: 150, val: 450 }, 
        investorFit: ["seed", "angels"] 
      },
      { 
        id: "m1_ambitious", 
        name: "MAT Partnership", 
        desc: "Secure a partnership with a Multi-Academy Trust. Requires excellent sales capability AND a product ready for scale. MATs control dozens of schools - one deal can transform your growth trajectory overnight.",
        difficulty: "ambitious", 
        time: 5, 
        focus: ["mkt", "dev"], 
        threshold: { mkt: 56, dev: 46 }, 
        icon: "ğŸ¤", 
        reward: { cash: 300, val: 900 }, 
        investorFit: ["seriesA", "seed"] 
      }
    ],
    m2: [
      { id: "m2_conservative", name: "Curriculum Alignment", desc: "Full alignment with National Curriculum.", difficulty: "conservative", time: 6, focus: ["sci", "dev"], threshold: { sci: 62, dev: 68 }, icon: "âœ…", reward: { cash: 100, val: 300 }, investorFit: ["seed", "angels"] },
      { id: "m2_balanced", name: "10,000 Students", desc: "Platform used by 10,000+ students weekly.", difficulty: "balanced", time: 5, focus: ["mkt", "dev"], threshold: { mkt: 68, dev: 75 }, icon: "ğŸ‘¥", reward: { cash: 200, val: 600 }, investorFit: ["seriesA", "seed"] },
      { id: "m2_ambitious", name: "DfE Recognition", desc: "Featured as exemplar by Department for Education.", difficulty: "ambitious", time: 4, focus: ["mkt", "sci"], threshold: { mkt: 75, sci: 72, dev: 82 }, icon: "ğŸ›", reward: { cash: 400, val: 1200 }, investorFit: ["seriesA"] }
    ],
    m3: [
      { id: "m3_conservative", name: "Sustainable Schools", desc: "Recurring revenue from loyal school customers.", difficulty: "conservative", time: 5, focus: ["mkt", "hr"], threshold: { mkt: 82, dev: 88, hr: 65 }, icon: "ğŸ’š", reward: { cash: 150, val: 450 }, investorFit: ["bootstrapped", "angels"] },
      { id: "m3_balanced", name: "National Rollout", desc: "Available in 1,000+ schools across UK.", difficulty: "balanced", time: 4, focus: ["mkt", "dev"], threshold: { mkt: 88, dev: 95, sci: 78, hr: 68 }, icon: "ğŸ‡¬ğŸ‡§", reward: { cash: 250, val: 750 }, investorFit: ["seed", "seriesA"] },
      { id: "m3_ambitious", name: "Education Revolution", desc: "Transforming how a generation learns.", difficulty: "ambitious", time: 3, focus: ["mkt", "sci", "dev"], threshold: { mkt: 95, sci: 88, dev: 100, hr: 72 }, icon: "ğŸŒŸ", reward: { cash: 500, val: 1500 }, investorFit: ["seriesA"] }
    ]
  }
};

// ===== STRATEGIC PIVOT SYSTEM =====
// Pivot milestones available when player chooses to pivot or is forced to respond to competitor actions

// Pivot Team - stakeholder perspectives on each pivot type
const PIVOT_TEAM = {
  research: {
    name: "Dr. Fatima Al-Hassan", role: "Research Lead", color: "emerald", emoji: "ğŸ”¬",
    portrait: '<svg viewBox="0 0 100 100"><circle cx="50" cy="35" r="20" fill="#94a3b8"/><ellipse cx="50" cy="85" rx="35" ry="25" fill="#10b981"/><circle cx="50" cy="35" r="16" fill="#1e293b"/></svg>',
    mood: "ğŸ˜Š", moodText: "Confident",
    background: "PhD in Machine Learning from Imperial College. Previously led AI research at DeepMind for 4 years before joining as a co-founder.",
    expertise: ["Deep learning architectures", "Research-to-product translation", "Academic partnerships", "IP strategy"],
    concerns: ["Diluting research quality for speed", "Losing scientific credibility", "Abandoning promising research directions"],
    pivotView: "Our research is genuinely differentiated. I support pivoting if it plays to our scientific strengths.",
    forcedView: "The competitor winning doesn't make our research less valuable. We should find buyers who appreciate depth over speed.",
    customerPivot: { support: true, note: "Healthcare or regulated industries value our rigor" },
    problemPivot: { support: false, note: "We'd lose our research advantage" },
    techPivot: { support: false, note: "Our tech approach IS our advantage" },
    changeDirection: { support: true, note: "Find a market that values scientific rigour" },
    competeHeadOn: { support: false, note: "We can't out-ship them, but we can out-research them" },
    narrowFocus: { support: true, note: "Deep expertise in one vertical plays to our strengths" }
  },
  product: {
    name: "Raj Patel", role: "Product Lead", color: "sky", emoji: "âš™ï¸",
    portrait: '<svg viewBox="0 0 100 100"><circle cx="50" cy="35" r="20" fill="#94a3b8"/><ellipse cx="50" cy="85" rx="35" ry="25" fill="#0ea5e9"/><circle cx="50" cy="35" r="16" fill="#78350f"/></svg>',
    mood: "ğŸ™‚", moodText: "Optimistic",
    background: "Former Senior PM at Google Cloud. 10 years shipping enterprise products at scale. MBA from London Business School.",
    expertise: ["Enterprise product strategy", "User research", "Agile development", "Platform architecture"],
    concerns: ["Feature creep", "Technical debt", "Misaligned roadmap priorities", "Losing user focus during pivots"],
    pivotView: "The issue isn't our techâ€”enterprise sales cycles are killing us. Different customers would let us iterate faster.",
    forcedView: "We've built solid product. The question is whether to keep fighting or find buyers who move faster.",
    customerPivot: { support: true, note: "Different customers would give us faster feedback" },
    problemPivot: { support: true, note: "If there's urgent pain, we can build for it" },
    techPivot: { support: false, note: "Our tech stack is fine" },
    changeDirection: { support: true, note: "We can ship a vertical product quickly with what we have" },
    competeHeadOn: { support: true, note: "We're making progressâ€”finishing might be faster than pivoting" },
    narrowFocus: { support: true, note: "Focused product is easier to ship and support" }
  },
  sales: {
    name: "Marcus Thompson", role: "Sales Lead", color: "fuchsia", emoji: "ğŸ“ˆ",
    portrait: '<svg viewBox="0 0 100 100"><circle cx="50" cy="35" r="20" fill="#94a3b8"/><ellipse cx="50" cy="85" rx="35" ry="25" fill="#d946ef"/><circle cx="50" cy="35" r="16" fill="#1e293b"/></svg>',
    mood: "ğŸ˜", moodText: "Concerned",
    background: "15 years in enterprise SaaS sales. Former VP Sales at a Â£200M ARR company. Deep rolodex in healthcare and fintech.",
    expertise: ["Enterprise sales cycles", "Key account management", "Channel partnerships", "Pricing strategy"],
    concerns: ["Pipeline disruption from pivots", "Losing key relationships", "Unclear value proposition", "Competitor positioning"],
    pivotView: "Every call starts with 'why not the competitor?' We need a clear differentiator.",
    forcedView: "This just made my job 10x harder. Every deal will now be about why we're better than the market leader.",
    customerPivot: { support: true, note: "I have warm leads in other sectors" },
    problemPivot: { support: false, note: "We'd lose all our pipeline" },
    techPivot: { support: false, note: "Doesn't help me close deals" },
    changeDirection: { support: true, note: "I have warm leads elsewhereâ€”I can close there" },
    competeHeadOn: { support: false, note: "Competing as #2 means discounting and longer cycles" },
    narrowFocus: { support: true, note: "Specialist positioning makes sales conversations easier" }
  },
  investor: {
    name: "Sarah Chen", role: "Angel Investor", color: "amber", emoji: "ğŸ’¼",
    portrait: '<div class="w-full h-full bg-amber-100 flex items-center justify-center text-2xl">ğŸ’¼</div>',
    mood: "ğŸ¤”", moodText: "Thoughtful",
    background: "Partner at Seedcamp, former Goldman Sachs. Has backed 40+ AI startups. Sits on 5 boards. Oxford PPE, Harvard MBA.",
    expertise: ["Fundraising strategy", "Board governance", "Exit planning", "Portfolio company support"],
    concerns: ["Runway management", "Dilution at next round", "Market timing", "Founder burnout"],
    pivotView: "Pivoting isn't failureâ€”it's learning. Make sure you're running toward something better.",
    forcedView: "This is a critical moment. The right response depends on your runway and how close you are to traction.",
    customerPivot: { support: true, note: "Finding the right market is normal" },
    problemPivot: { support: true, note: "If there's better product-market fit" },
    techPivot: { support: false, note: "Big technical pivots are risky" },
    changeDirection: { support: true, note: "Better to lead a niche than follow in a crowded market" },
    competeHeadOn: { support: true, note: "If you're close to traction, finishing might make sense" },
    narrowFocus: { support: true, note: "Specialists can command premium pricing and raise at better terms" }
  }
};

const STRATEGIC_PIVOTS = [
  {
    id: "customer",
    name: "Customer Pivot",
    subtitle: "Sell to different buyers",
    icon: "ğŸ¯",
    color: "violet",
    description: "Your product works, but you're selling to the wrong people. Find customers who value what you've built.",
    preserves: ["Core technology", "Most product work", "Research investment"],
    costs: ["Rebuild sales pipeline", "New go-to-market", "~Â£25k transition"],
    timeImpact: "+3 quarters to milestone",
    teamSupport: 3,
    bestWhen: "Strong product, wrong market",
    teamQuotes: {
      research: "Healthcare or regulated industries value our rigour.",
      product: "Different customers would give us faster feedback.",
      sales: "I have warm leads in other sectorsâ€”let me work those.",
      investor: "Finding the right market is normal for startups."
    }
  },
  {
    id: "problem",
    name: "Problem Pivot",
    subtitle: "Solve a different pain point",
    icon: "ğŸ’¡",
    color: "amber",
    description: "Your technology could address other problems. Find pain that's more urgent than what you're currently solving.",
    preserves: ["Team capabilities", "Some technology", "Customer relationships"],
    costs: ["Significant product rebuild", "New positioning", "~Â£40k transition"],
    timeImpact: "+4 quarters to milestone",
    teamSupport: 2,
    bestWhen: "Good tech, problem isn't urgent enough",
    teamQuotes: {
      research: "We'd need to adapt our research focus significantly.",
      product: "If there's urgent pain, we can build for it.",
      sales: "We'd lose most of our current pipeline.",
      investor: "Only if there's clearly better product-market fit."
    }
  },
  {
    id: "tech",
    name: "Technology Pivot",
    subtitle: "Build it differently",
    icon: "ğŸ”§",
    color: "rose",
    description: "Your direction is right but your approach isn't working. Try a fundamentally different technical path.",
    preserves: ["Market position", "Customer relationships", "Domain knowledge"],
    costs: ["Major technical rebuild", "Team disruption", "~Â£50k transition"],
    timeImpact: "+5 quarters to milestone",
    teamSupport: 1,
    bestWhen: "Tech isn't scaling, team can rebuild",
    teamQuotes: {
      research: "Our tech approach IS our advantageâ€”be careful.",
      product: "This is a major rebuild. Are we sure?",
      sales: "Doesn't directly help me close deals.",
      investor: "Big technical pivots are risky. Proceed with caution."
    }
  }
];

const FORCED_RESPONSES = [
  {
    id: "pivot",
    name: "Change Direction",
    subtitle: "Find a different market to lead",
    icon: "ğŸ”„",
    color: "violet",
    description: "Pivot to a market where your competitor isn't competing. Become the leader somewhere else rather than fighting for second place.",
    preserves: ["Core technology", "Team capabilities", "Research investment"],
    costs: ["Abandon current milestone", "Rebuild sales pipeline", "~Â£30k transition"],
    timeImpact: "+4 quarters to new milestone",
    teamSupport: 3,
    bestWhen: "Competitor's market isn't your only option",
    teamQuotes: {
      research: "Find a market that values scientific rigour over shipping speed.",
      product: "We can adapt our product for a new vertical faster than catching them.",
      sales: "I have warm leads elsewhere. Let me work those instead of fighting uphill.",
      investor: "Better to lead a niche than follow in a crowded market."
    }
  },
  {
    id: "compete",
    name: "Compete Head-On",
    subtitle: "Stay the course as #2",
    icon: "âš”ï¸",
    color: "amber",
    description: "Keep building toward your current milestone. Second place can still winâ€”competitors may stumble, and you keep all your progress.",
    preserves: ["All milestone progress", "Current sales pipeline", "Market positioning", "No transition costs"],
    costs: ["-20% valuation hit immediately", "+15% dilution on future raises", "Harder sales conversations", "Competing against market leader"],
    timeImpact: "No delayâ€”continue current timeline",
    teamSupport: 2,
    bestWhen: "You're close to finishing and believe competitor will stumble",
    teamQuotes: {
      research: "Our tech is betterâ€”their shortcuts will catch up with them.",
      product: "We're making good progress. Pivoting now wastes our work.",
      sales: "Every call will be 'why not them?' but some buyers want alternatives.",
      investor: "If you're close to traction, finishing might beat starting over."
    },
    milestones: null // Continue current milestone
  },
  {
    id: "niche",
    name: "Narrow Focus",
    subtitle: "Become the specialist",
    icon: "ğŸ¯",
    color: "emerald",
    description: "Let your competitor go broad while you own one vertical deeply. Smaller total market, but defensible position and premium pricing.",
    preserves: ["Most progress (~60% carries over)", "Core technology", "Some sales pipeline"],
    costs: ["Smaller addressable market", "Reduced milestone rewards (~20% less)", "~Â£20k transition"],
    timeImpact: "+2 quarters, but easier threshold",
    teamSupport: 3,
    bestWhen: "You have traction in a specific segment",
    teamQuotes: {
      research: "Deep expertise in one vertical plays to our scientific strengths.",
      product: "Focused product is easier to ship, support, and iterate on.",
      sales: "Specialist positioning makes conversations easierâ€”we're THE company for this.",
      investor: "Specialists command premium pricing and can raise at better terms."
    }
  }
];

// Pivot milestones - available based on company archetype and pivot type
const PIVOT_MILESTONES = {
  // Healthcare/BioTech pivots (for Aether and similar)
  healthcare: {
    customer: [
      { 
        id: "healthcare_nhs", name: "NHS AI Platform", 
        desc: "AI diagnostics for NHS trustsâ€”regulated market values research rigour", 
        difficulty: "balanced", time: 5, focus: ["sci", "mkt"],
        threshold: { sci: 55, mkt: 40, dev: 35 },
        icon: "ğŸ¥", reward: { cash: 200, val: 400 },
        transfer: { sci: 80, dev: 70, mkt: 20 },
        startingProgress: 35,
        notes: "Healthcare buyers value scientific credibility over speed. Your research transfers well.",
        nameOptions: [
          { name: "MedAether", fit: "high", salesImpact: -5, brandImpact: +15, stakeholder: "Sales Lead", quote: "Healthcare buyers trust medical-sounding names. This opens doors." },
          { name: "CareLogic AI", fit: "medium", salesImpact: -10, brandImpact: +20, stakeholder: "Investor", quote: "Fresh start, premium positioning. Worth the short-term sales hit." },
          { name: "Aether Health", fit: "medium", salesImpact: 0, brandImpact: +5, stakeholder: "Research Lead", quote: "Keeps our research reputation while signalling the pivot." }
        ]
      },
      { 
        id: "healthcare_private", name: "Private Healthcare Suite", 
        desc: "Premium AI tools for private clinics and hospitals", 
        difficulty: "ambitious", time: 4, focus: ["mkt", "dev"],
        threshold: { mkt: 50, dev: 45, sci: 40 },
        icon: "ğŸ’", reward: { cash: 300, val: 600 },
        transfer: { sci: 75, dev: 65, mkt: 25 },
        startingProgress: 30,
        notes: "Private sector moves faster than NHS. Higher margins but smaller market.",
        nameOptions: [
          { name: "EliteHealth AI", fit: "high", salesImpact: -5, brandImpact: +15, stakeholder: "Sales Lead", quote: "Premium positioning for premium customers. Name signals quality." },
          { name: "Aether Premium", fit: "medium", salesImpact: 0, brandImpact: +10, stakeholder: "Investor", quote: "Builds on existing brand while targeting upmarket." },
          { name: "ClearDiagnostics", fit: "low", salesImpact: -10, brandImpact: +5, stakeholder: "Product Lead", quote: "Descriptive but generic. Might get lost in the market." }
        ]
      }
    ],
    problem: [
      { 
        id: "healthcare_mental", name: "Mental Health AI", 
        desc: "AI-powered mental health screening and support tools", 
        difficulty: "balanced", time: 5, focus: ["sci", "dev"],
        threshold: { sci: 50, dev: 50, mkt: 35 },
        icon: "ğŸ§ ", reward: { cash: 175, val: 450 },
        transfer: { sci: 70, dev: 40, mkt: 40 },
        startingProgress: 25,
        notes: "Growing demand for mental health solutions. Your ML expertise applies but product needs redesign.",
        nameOptions: [
          { name: "MindWell AI", fit: "high", salesImpact: -5, brandImpact: +15, stakeholder: "Product Lead", quote: "Warm, approachable name for a sensitive topic." },
          { name: "Aether Mind", fit: "medium", salesImpact: 0, brandImpact: +10, stakeholder: "Research Lead", quote: "Maintains research credibility while pivoting focus." },
          { name: "ClearThought", fit: "low", salesImpact: -10, brandImpact: +5, stakeholder: "Investor", quote: "Generic but inoffensive. Safe choice." }
        ]
      }
    ],
    niche: [
      { 
        id: "healthcare_specialist", name: "Healthcare AI Specialist", 
        desc: "Deep focus on NHS diagnosticsâ€”own this vertical completely", 
        difficulty: "conservative", time: 3, focus: ["sci", "mkt"],
        threshold: { sci: 45, mkt: 35, dev: 30 },
        icon: "ğŸ¯", reward: { cash: 120, val: 300 },
        transfer: { sci: 90, dev: 85, mkt: 55 },
        startingProgress: 52,
        notes: "Most progress carries overâ€”you're narrowing, not pivoting. Lower bar but smaller reward.",
        nameOptions: [
          { name: "NHS AI Partners", fit: "high", salesImpact: -5, brandImpact: +20, stakeholder: "Sales Lead", quote: "NHS in the name opens doors. Shows full commitment." },
          { name: "DiagnosticMind", fit: "medium", salesImpact: -10, brandImpact: +15, stakeholder: "Research Lead", quote: "Positions us as diagnostic experts. Strong credibility." },
          { name: "Aether Health", fit: "low", salesImpact: 0, brandImpact: +5, stakeholder: "Investor", quote: "Gentle rebrand. Keeps options open if we expand later." }
        ]
      }
    ]
  },
  
  // FinTech pivots (for QuantFlow and similar)
  fintech: {
    customer: [
      { 
        id: "fintech_retail", name: "Retail Trading Platform", 
        desc: "AI-powered trading tools for retail investors", 
        difficulty: "balanced", time: 5, focus: ["dev", "mkt"],
        threshold: { dev: 55, mkt: 45, sci: 35 },
        icon: "ğŸ“±", reward: { cash: 200, val: 500 },
        transfer: { sci: 75, dev: 60, mkt: 30 },
        startingProgress: 30,
        notes: "Larger market than institutional. Product needs simplification but core algorithms apply.",
        nameOptions: [
          { name: "TradeSimple", fit: "high", salesImpact: -5, brandImpact: +15, stakeholder: "Product Lead", quote: "Retail wants simple. This name delivers." },
          { name: "QuantFlow Lite", fit: "medium", salesImpact: 0, brandImpact: +10, stakeholder: "Investor", quote: "Leverages existing brand recognition." },
          { name: "SmartInvest AI", fit: "low", salesImpact: -10, brandImpact: +5, stakeholder: "Sales Lead", quote: "Generic but broad appeal." }
        ]
      }
    ],
    problem: [
      { 
        id: "fintech_compliance", name: "Compliance AI", 
        desc: "AI for regulatory compliance and reporting", 
        difficulty: "balanced", time: 5, focus: ["dev", "sci"],
        threshold: { dev: 50, sci: 45, mkt: 40 },
        icon: "ğŸ“‹", reward: { cash: 175, val: 400 },
        transfer: { sci: 65, dev: 55, mkt: 45 },
        startingProgress: 28,
        notes: "Every financial firm needs compliance. Less exciting but steady demand.",
        nameOptions: [
          { name: "ComplianceAI", fit: "high", salesImpact: -5, brandImpact: +10, stakeholder: "Sales Lead", quote: "Says exactly what we do. Compliance officers will find us." },
          { name: "RegTech Mind", fit: "medium", salesImpact: -10, brandImpact: +15, stakeholder: "Research Lead", quote: "Positions us in the growing RegTech space." },
          { name: "QuantFlow Comply", fit: "low", salesImpact: 0, brandImpact: +5, stakeholder: "Investor", quote: "Maintains brand but signals new focus." }
        ]
      }
    ],
    niche: [
      { 
        id: "fintech_specialist", name: "FinTech AI Specialist", 
        desc: "Deep focus on algorithmic trading for hedge funds", 
        difficulty: "conservative", time: 3, focus: ["sci", "dev"],
        threshold: { sci: 50, dev: 45, mkt: 30 },
        icon: "ğŸ¯", reward: { cash: 140, val: 350 },
        transfer: { sci: 85, dev: 80, mkt: 45 },
        startingProgress: 48,
        notes: "Strong progress transfer. Financial services value your enterprise-grade work.",
        nameOptions: [
          { name: "AlphaQuant", fit: "high", salesImpact: -5, brandImpact: +15, stakeholder: "Sales Lead", quote: "Hedge funds love 'alpha'. Signals performance focus." },
          { name: "QuantFlow Pro", fit: "medium", salesImpact: 0, brandImpact: +10, stakeholder: "Investor", quote: "Premium tier of existing brand." },
          { name: "DeepTrade AI", fit: "low", salesImpact: -10, brandImpact: +5, stakeholder: "Research Lead", quote: "Technical name for technical buyers." }
        ]
      }
    ]
  },
  
  // General/Default pivots (applicable to multiple archetypes)
  general: {
    customer: [
      { 
        id: "general_enterprise", name: "Enterprise AI Platform", 
        desc: "AI solutions for large enterprises", 
        difficulty: "balanced", time: 5, focus: ["dev", "mkt"],
        threshold: { dev: 55, mkt: 50, sci: 40 },
        icon: "ğŸ¢", reward: { cash: 200, val: 500 },
        transfer: { sci: 70, dev: 60, mkt: 30 },
        startingProgress: 30,
        notes: "Enterprise sales are slow but high value. Your tech credibility matters.",
        nameOptions: [
          { name: "Enterprise AI", fit: "high", salesImpact: -5, brandImpact: +10, stakeholder: "Sales Lead", quote: "Enterprise buyers want serious names." },
          { name: "ScaleAI Solutions", fit: "medium", salesImpact: -10, brandImpact: +15, stakeholder: "Investor", quote: "Signals growth and ambition." },
          { name: "Your Company Enterprise", fit: "low", salesImpact: 0, brandImpact: +5, stakeholder: "Product Lead", quote: "Safe extension of current brand." }
        ]
      },
      { 
        id: "general_smb", name: "SMB Analytics Suite", 
        desc: "Self-serve AI for small businesses", 
        difficulty: "conservative", time: 4, focus: ["dev", "mkt"],
        threshold: { dev: 45, mkt: 40, sci: 30 },
        icon: "ğŸª", reward: { cash: 150, val: 350 },
        transfer: { sci: 80, dev: 50, mkt: 30 },
        startingProgress: 25,
        notes: "SMBs give faster feedback but lower deal values. Product needs simplification.",
        nameOptions: [
          { name: "SimpleAI", fit: "high", salesImpact: -5, brandImpact: +10, stakeholder: "Product Lead", quote: "SMBs want approachable. This delivers." },
          { name: "GrowthMind", fit: "medium", salesImpact: -10, brandImpact: +15, stakeholder: "Sales Lead", quote: "Aspirational name for ambitious owners." },
          { name: "Your Company for Business", fit: "low", salesImpact: 0, brandImpact: 0, stakeholder: "Investor", quote: "Safe but uninspiring." }
        ]
      }
    ],
    problem: [
      { 
        id: "general_automation", name: "Process Automation AI", 
        desc: "AI that automates repetitive business processes", 
        difficulty: "balanced", time: 5, focus: ["dev", "mkt"],
        threshold: { dev: 50, mkt: 45, sci: 35 },
        icon: "âš™ï¸", reward: { cash: 175, val: 400 },
        transfer: { sci: 60, dev: 50, mkt: 35 },
        startingProgress: 25,
        notes: "Broad market appeal but competitive. Need clear differentiation.",
        nameOptions: [
          { name: "AutoMind", fit: "high", salesImpact: -5, brandImpact: +10, stakeholder: "Product Lead", quote: "Clear value proposition in the name." },
          { name: "FlowAI", fit: "medium", salesImpact: -10, brandImpact: +15, stakeholder: "Sales Lead", quote: "Modern, suggests smooth processes." },
          { name: "Your Company Automate", fit: "low", salesImpact: 0, brandImpact: +5, stakeholder: "Investor", quote: "Maintains brand continuity." }
        ]
      }
    ],
    tech: [
      { 
        id: "general_edge", name: "Edge AI Solution", 
        desc: "AI that runs on-device, not cloud", 
        difficulty: "ambitious", time: 5, focus: ["sci", "dev"],
        threshold: { sci: 55, dev: 55, mkt: 35 },
        icon: "ğŸ“±", reward: { cash: 225, val: 550 },
        transfer: { sci: 50, dev: 30, mkt: 60 },
        startingProgress: 20,
        notes: "Major technical shift. Research needs optimisation focus. Enterprise relationships value on-premise.",
        nameOptions: [
          { name: "EdgeMind", fit: "high", salesImpact: -5, brandImpact: +15, stakeholder: "Product Lead", quote: "Edge computing is hot. Positions us at the frontier." },
          { name: "LocalAI", fit: "medium", salesImpact: -10, brandImpact: +10, stakeholder: "Research Lead", quote: "Privacy-conscious buyers love 'local'." },
          { name: "Your Company Edge", fit: "low", salesImpact: 0, brandImpact: +5, stakeholder: "Investor", quote: "Keeps brand recognition." }
        ]
      },
      { 
        id: "general_api", name: "API-First Platform", 
        desc: "Let others build on your AI", 
        difficulty: "balanced", time: 5, focus: ["dev", "mkt"],
        threshold: { dev: 55, mkt: 45, sci: 40 },
        icon: "ğŸ”Œ", reward: { cash: 200, val: 450 },
        transfer: { sci: 65, dev: 40, mkt: 45 },
        startingProgress: 22,
        notes: "Platform play. Product needs API infrastructure rebuild. B2B2C sales motion.",
        nameOptions: [
          { name: "Your Company API", fit: "high", salesImpact: 0, brandImpact: +10, stakeholder: "Product Lead", quote: "Developers search for APIs. SEO gold." },
          { name: "BuildOn AI", fit: "medium", salesImpact: -10, brandImpact: +15, stakeholder: "Sales Lead", quote: "Invites partnership." },
          { name: "PlatformMind", fit: "low", salesImpact: -5, brandImpact: +5, stakeholder: "Investor", quote: "Generic but professional." }
        ]
      }
    ],
    niche: [
      { 
        id: "general_specialist", name: "Vertical AI Specialist", 
        desc: "Deep focus on your strongest segment", 
        difficulty: "conservative", time: 3, focus: ["sci", "mkt"],
        threshold: { sci: 40, mkt: 35, dev: 30 },
        icon: "ğŸ¯", reward: { cash: 120, val: 280 },
        transfer: { sci: 85, dev: 80, mkt: 50 },
        startingProgress: 50,
        notes: "Narrowing focus preserves most progress. Lower bar, smaller reward, defensible position.",
        nameOptions: [
          { name: "Your Company Specialist", fit: "high", salesImpact: 0, brandImpact: +10, stakeholder: "Sales Lead", quote: "Specialist positioning makes conversations easier." },
          { name: "DeepFocus AI", fit: "medium", salesImpact: -5, brandImpact: +15, stakeholder: "Research Lead", quote: "Signals depth over breadth." },
          { name: "Your Company Pro", fit: "low", salesImpact: 0, brandImpact: +5, stakeholder: "Investor", quote: "Premium tier, safe choice." }
        ]
      }
    ]
  }
};

// Map company archetypes to pivot milestone sets
const ARCHETYPE_PIVOT_MAP = {
  "BioTech": "healthcare",
  "Robotics": "general",
  "FinTech": "fintech",
  "Creative AI": "general",
  "CyberSec": "general",
  "CleanTech": "general",
  "LegalTech": "general",
  "EdTech": "general"
};

// ===== EXECUTIVES - Full details with equity & vesting =====

const EXECUTIVES = {
  research: [
    {
      id: "fatima",
      name: "Dr. Fatima Al-Rashid",
      title: "The Rigorous Scientist",
      avatar: getAvatar("fatima-alrashid-uk"),
      origin: "British-Iraqi Â· Manchester",
      background: "PhD Imperial, postdoc at the Crick Institute. 40+ papers published. Won't compromise on methodology.",
      personality: "Methodical, cautious, mentors well",
      wage: 22,
      equity: 2.0,
      vestingYears: 4,
      cliff: 1,
      bonus: { sci: 4, dev: 1, hr: 1 },
      quote: "Extraordinary claims require extraordinary evidence.",
      cv: {
        education: "PhD Molecular Biology, Imperial College London. BSc Biochemistry, University of Manchester (First Class).",
        experience: [
          "Senior Postdoc, Francis Crick Institute (5 years) - Led protein folding research group",
          "Visiting Researcher, MIT (1 year) - Collaboration on AI-driven drug discovery",
          "Published 42 peer-reviewed papers, h-index 28"
        ],
        strengths: [
          "Exceptional scientific rigour - publications rarely challenged",
          "Strong academic network across UK and US institutions",
          "Natural mentor - builds capable junior researchers"
        ],
        weaknesses: [
          "Can be slow to publish - perfectionism delays results",
          "Uncomfortable with commercial pressure and investor meetings",
          "May clash with 'move fast' culture"
        ]
      }
    },
    {
      id: "yuki",
      name: "Dr. Yuki Tanaka",
      title: "The Collaborator",
      avatar: getAvatar("yuki-tanaka-jp"),
      origin: "Japanese Â· Cambridge PhD",
      background: "Formerly RIKEN. Builds bridges between UK, Japan, and Singapore research networks. Patient consensus-builder.",
      personality: "Collaborative, cross-cultural, patient",
      wage: 18,
      equity: 1.5,
      vestingYears: 4,
      cliff: 1,
      bonus: { sci: 3, dev: 2 },
      quote: "The best science happens when we work together.",
      cv: {
        education: "PhD Computational Biology, Cambridge. MSc Bioinformatics, University of Tokyo.",
        experience: [
          "Research Scientist, RIKEN Center for Biosystems Dynamics (4 years)",
          "Postdoc, Wellcome Sanger Institute (2 years)",
          "Built collaboration network spanning 12 institutions across 3 continents"
        ],
        strengths: [
          "Exceptional at building international research partnerships",
          "Bridges language and cultural gaps effortlessly",
          "Strong computational skills complement wet lab work"
        ],
        weaknesses: [
          "Consensus-building can slow decision-making",
          "Less assertive in competitive environments",
          "May struggle with aggressive UK startup pace initially"
        ]
      }
    },
    {
      id: "kwame",
      name: "Prof. Kwame Mensah",
      title: "The Visionary",
      avatar: getAvatar("kwame-mensah-gh"),
      origin: "British-Ghanaian Â· South London",
      background: "Ex-CortexAI. Chases breakthroughs. Inspirational but sometimes overreaches. Impatient with incrementalism.",
      personality: "Ambitious, bold, inspirational",
      wage: 25,
      equity: 4.5,
      vestingYears: 3,
      cliff: 1,
      bonus: { sci: 5, mkt: 1, hr: -1 },
      quote: "We're not here to make small improvements.",
      cv: {
        education: "PhD Machine Learning, Oxford. MBA, London Business School. BSc Physics, Imperial (First Class).",
        experience: [
          "VP Research, CortexAI (3 years) - Built 40-person research org, 2 Nature papers",
          "Founding Scientist, DeepHealth (acquired for Â£80M)",
          "Youngest professor in his department at UCL"
        ],
        strengths: [
          "Track record of genuine breakthroughs",
          "Magnetic personality - attracts top talent",
          "Comfortable with investors and media spotlight"
        ],
        weaknesses: [
          "High salary and equity demands strain early budgets",
          "Impatient with incremental progress - may push too hard",
          "Can alienate team members who prefer steady pace"
        ]
      }
    }
  ],
  dev: [
    {
      id: "aoife",
      name: "Aoife Murphy",
      title: "The Architect",
      avatar: getAvatar("aoife-murphy-ie"),
      origin: "Irish Â· Trinity College Dublin",
      background: "Built platforms at major music streaming and challenger bank startups. Allergic to technical debt. Does things properly or not at all.",
      personality: "Systematic, thorough, quality-obsessed",
      wage: 24,
      equity: 2.5,
      vestingYears: 4,
      cliff: 1,
      bonus: { dev: 4, mkt: 1, hr: 1 },
      quote: "There's fast, and there's fast in six months.",
      cv: {
        education: "MSc Computer Science, Trinity College Dublin. BSc Mathematics, University College Dublin.",
        experience: [
          "Principal Engineer, Monzo (3 years) - Architected core banking platform",
          "Senior Engineer, Spotify (4 years) - Led recommendations infrastructure",
          "Open source maintainer with 5k+ GitHub stars"
        ],
        strengths: [
          "Builds systems that scale without breaking",
          "Technical debt allergic - code stays maintainable",
          "Great at mentoring junior engineers"
        ],
        weaknesses: [
          "Slower initial velocity - insists on 'doing it right'",
          "May resist quick prototypes for investor demos",
          "Premium salary for premium quality"
        ]
      }
    },
    {
      id: "raj",
      name: "Raj Patel",
      title: "The Pragmatist",
      avatar: getAvatar("raj-patel-uk"),
      origin: "British-Indian Â· Leicester",
      background: "Serial startup CTO. Three exits. Knows when to ship imperfect code and when to hold. Battle-tested.",
      personality: "Pragmatic, commercial, ships fast",
      wage: 20,
      equity: 4.0,
      vestingYears: 3,
      cliff: 1,
      bonus: { dev: 3, mkt: 2, hr: -1 },
      quote: "Done is better than perfect, but broken helps no one.",
      cv: {
        education: "BSc Computer Science, University of Leicester. Self-taught in ML/AI.",
        experience: [
          "CTO, HealthStack (acquired by private equity, Â£45M)",
          "CTO, DataFlow (acquired by US tech company)",
          "Founded and sold two smaller startups pre-2015"
        ],
        strengths: [
          "Exceptional shipping velocity - gets products out",
          "Understands commercial pressures intimately",
          "Battle-tested through multiple exits"
        ],
        weaknesses: [
          "Technical debt can accumulate under pressure",
          "Wants significant equity for 'been there done that' value",
          "May frustrate engineers who prefer cleaner code"
        ]
      }
    },
    {
      id: "wei",
      name: "Wei Chen",
      title: "The Team Builder",
      avatar: getAvatar("wei-chen-cn"),
      origin: "Chinese Â· Edinburgh",
      background: "Led engineering at a unicorn. Believes happy engineers build better software. Sustainable pace advocate.",
      personality: "People-focused, sustainable, culture-first",
      wage: 18,
      equity: 1.5,
      vestingYears: 4,
      cliff: 1,
      bonus: { dev: 3, hr: 2 },
      quote: "Happy engineers build better software. It's not complicated.",
      cv: {
        education: "MSc AI, University of Edinburgh. BSc Software Engineering, Tsinghua University.",
        experience: [
          "Engineering Manager, Deliveroo (4 years) - Grew team from 8 to 45",
          "Senior Engineer, Skyscanner (3 years)",
          "Known for zero attrition in teams he manages"
        ],
        strengths: [
          "Exceptional retention - engineers don't leave his teams",
          "Creates sustainable, healthy engineering culture",
          "Lower cost than flashier alternatives"
        ],
        weaknesses: [
          "May resist crunch periods even when necessary",
          "Less aggressive technical vision than alternatives",
          "Sustainable pace might feel slow to investors"
        ]
      }
    }
  ],
  marketing: [
    {
      id: "priya",
      name: "Priya Sharma",
      title: "The Dealmaker",
      avatar: getAvatar("priya-sharma-uk"),
      origin: "British-Indian Â· Birmingham",
      background: "Enterprise sales at major CRM and database companies. Knows everyone in UK healthcare IT. Relationship-driven closer.",
      personality: "Persistent, networked, closes deals",
      wage: 23,
      equity: 3.5,
      vestingYears: 3,
      cliff: 1,
      bonus: { mkt: 4 },
      quote: "Relationships take years to build and seconds to lose.",
      cv: {
        education: "MBA, Warwick Business School. BSc Economics, University of Birmingham.",
        experience: [
          "Enterprise Sales Director, Salesforce UK (5 years) - Â£15M annual quota",
          "Senior Account Executive, Oracle Health (4 years)",
          "Personal network includes 200+ NHS trust decision-makers"
        ],
        strengths: [
          "Deep relationships in UK healthcare sector",
          "Closes large enterprise deals reliably",
          "Persistent without being pushy"
        ],
        weaknesses: [
          "Expensive - commands enterprise-level compensation",
          "Relationship sales takes time to pay off",
          "Less suited to consumer or SMB markets"
        ]
      }
    },
    {
      id: "marcus",
      name: "Marcus Thompson",
      title: "The Growth Engineer",
      avatar: getAvatar("marcus-thompson-uk"),
      origin: "Black British Â· Brixton, LSE",
      background: "Grew two D2C brands from zero to eight figures. Data-obsessed. Skeptical of anything you can't measure.",
      personality: "Analytical, experimental, metrics-driven",
      wage: 18,
      equity: 2.0,
      vestingYears: 4,
      cliff: 1,
      bonus: { mkt: 3, dev: 1 },
      quote: "If you can't measure it, you're just guessing.",
      cv: {
        education: "BSc Economics, London School of Economics.",
        experience: [
          "Head of Growth, AllBirds UK (2 years) - 400% growth",
          "Growth Lead, Gymshark (3 years) - Early team member",
          "Advisor to 6 D2C startups"
        ],
        strengths: [
          "Data-driven approach catches problems early",
          "Affordable compared to enterprise sales hires",
          "Strong at measurable, scalable growth"
        ],
        weaknesses: [
          "Less experienced with enterprise/B2B sales cycles",
          "Metrics obsession may miss relationship nuances",
          "Consumer background may not translate to all sectors"
        ]
      }
    },
    {
      id: "emma",
      name: "Emma BergstrÃ¶m",
      title: "The Brand Strategist",
      avatar: getAvatar("emma-bergstrom-se"),
      origin: "Swedish Â· 10 years in London",
      background: "Built brands at Oatly and innocent drinks. Long-term thinker. Protects brand integrity fiercely.",
      personality: "Strategic, story-driven, patient",
      wage: 20,
      equity: 1.0,
      vestingYears: 4,
      cliff: 1,
      bonus: { mkt: 3, sci: 1, hr: 1 },
      quote: "A brand is a promise. Break it once, and you're done.",
      cv: {
        education: "MA Marketing, Stockholm School of Economics. BA Communications, Uppsala University.",
        experience: [
          "Brand Director, Oatly UK (3 years) - Led UK market entry",
          "Senior Brand Manager, innocent drinks (4 years)",
          "Built two brands valued at Â£1B+"
        ],
        strengths: [
          "Builds brands that command premium pricing",
          "Long-term strategic thinking",
          "Lowest equity ask - patient wealth builder"
        ],
        weaknesses: [
          "Brand building takes time - slow initial revenue impact",
          "May resist short-term tactics that compromise brand",
          "Less suited to aggressive sales-led approaches"
        ]
      }
    }
  ]
};

// Helper to get executives
function getExecutives(category) {
  return EXECUTIVES[category];
}

const HR_EXECS = [
  {
    id: "david",
    name: "David Okonkwo",
    title: "The Process Builder",
    avatar: getAvatar("david-okonkwo-ng"),
    origin: "British-Nigerian Â· Leeds",
    background: "HR director at two scale-ups. Knows employment law inside out. Fair but firm.",
    personality: "Methodical, protective, policy-focused",
    wage: 20,
    equity: 1.0,
    vestingYears: 4,
    cliff: 1,
    bonus: { hr: 5, mkt: 1 },
    quote: "Good process protects everyone-company and people.",
    cv: {
      education: "MA Human Resource Management, University of Leeds. CIPD Level 7.",
      experience: [
        "HR Director, Gousto (3 years) - Scaled from 200 to 800 employees",
        "Head of People, Depop (2 years)",
        "Employment tribunal record: 0 losses in 12 cases"
      ],
      strengths: [
        "Bulletproof employment processes - minimises legal risk",
        "Knows UK employment law inside out",
        "Affordable and low equity requirements"
      ],
      weaknesses: [
        "Process focus can feel bureaucratic to founders",
        "May slow down rapid hiring with compliance checks",
        "Less inspiring than culture-focused alternatives"
      ]
    }
  },
  {
    id: "sofia",
    name: "Sofia Rodriguez",
    title: "The Culture Champion",
    avatar: getAvatar("sofia-rodriguez-es"),
    origin: "Spanish Â· 12 years in UK",
    background: "Built people functions that actually retained talent. Values-driven. Fights for the team.",
    personality: "Empathetic, values-driven, inclusive",
    wage: 18,
    equity: 1.5,
    vestingYears: 4,
    cliff: 1,
    bonus: { hr: 4, dev: 1 },
    quote: "Culture isn't ping pong tables. It's how you treat people when it's hard.",
    cv: {
      education: "MSc Organisational Psychology, Birkbeck. BA Psychology, Universidad Complutense de Madrid.",
      experience: [
        "Head of People, Monzo (3 years) - Built famous culture",
        "People Partner, Google UK (4 years)",
        "85% employee NPS in last two roles"
      ],
      strengths: [
        "Creates cultures people genuinely love",
        "High retention and employee satisfaction",
        "Most affordable option"
      ],
      weaknesses: [
        "May prioritise team wellbeing over aggressive targets",
        "Values-first approach can slow difficult decisions",
        "Less experienced with rapid hyper-growth"
      ]
    }
  },
  {
    id: "aisha",
    name: "Aisha Khan",
    title: "The Talent Magnet",
    avatar: getAvatar("aisha-khan-pk"),
    origin: "British-Pakistani Â· London",
    background: "Recruited for top tech companies and unicorns. Knows where all the best people are. Competitive.",
    personality: "Networked, competitive, talent-obsessed",
    wage: 22,
    equity: 2.5,
    vestingYears: 3,
    cliff: 1,
    bonus: { hr: 4, sci: 1 },
    quote: "In AI, your team is your moat. Let me build you an army.",
    cv: {
      education: "BSc Business, King's College London. Executive coaching certification.",
      experience: [
        "Head of Talent, DeepMind (4 years) - Recruited 150+ researchers",
        "Senior Recruiter, Meta London (3 years)",
        "Personal network of 500+ AI/ML professionals"
      ],
      strengths: [
        "Can recruit world-class AI talent others can't reach",
        "Deep network in competitive AI hiring market",
        "Aggressive approach lands competitive candidates"
      ],
      weaknesses: [
        "Most expensive HR option by far",
        "Recruiting focus may neglect retention and culture",
        "Competitive style may not suit all team dynamics"
      ]
    }
  }
];

// ===== CANDIDATE POOL FOR JOB POSTINGS =====
// Mid-game hiring candidates with salary/equity expectations, availability, and non-compete risks

const CANDIDATE_POOL = {
  research: [
    { id: "r1", name: "Dr. Ananya Desai", seniority: "lead", portrait: "ğŸ‘©ğŸ½â€ğŸ”¬",
      background: "15 years at local pharma company in Chippenham. First in family with PhD. Practical, not flashy.",
      origin: "British-Indian Â· Birmingham",
      strengths: ["Research â†‘â†‘â†‘", "Credibility â†‘â†‘"], weaknesses: ["Commercial awareness"],
      salaryExpect: { min: 72, ideal: 80, max: 92 }, equityExpect: { min: 0.5, ideal: 0.75, max: 1.25 },
      interest: 0.7, availability: "1 month", nonCompeteRisk: "low",
      quote: "I need freedom to publish.",
      statBonus: { sci: 4, dev: 1 },
      cv: { 
        education: "PhD Computational Biology, University of Birmingham (2018). MSc Bioinformatics, University of Leicester (2014). BSc Biomedical Science, Aston University (2012).", 
        experience: ["Principal Scientist, Vectura Group Chippenham (2018-2023) - Led team improving inhaler drug delivery. 5 years at same site.", "Research Associate, Birmingham (2014-2018) - PhD and postdoc combined.", "Lab Technician, Queen Elizabeth Hospital Birmingham (2010-2012, part-time during degree)."], 
        achievements: "8 publications. 2 patents in drug delivery. Model deployed in manufacturing. First in family to get PhD.",
        skills: "Python, R, drug formulation, regulatory submissions, GMP environments.",
        personality: "Strong researcher from non-traditional academic path. Worked throughout education. Practical industry focus rather than pure academia." 
      }
    },
    { id: "r2", name: "Dr. Rupert Whitford", seniority: "lead", portrait: "ğŸ‘¨ğŸ»â€ğŸ”¬",
      background: "Contract research labs for 15 years. Steady, reliable, trains juniors well. State school background.",
      origin: "British Â· Portsmouth",
      strengths: ["Research â†‘â†‘â†‘", "Publications â†‘â†‘"], weaknesses: ["Slow, academic pace"],
      salaryExpect: { min: 64, ideal: 72, max: 80 }, equityExpect: { min: 0.75, ideal: 1.0, max: 1.5 },
      interest: 0.5, availability: "3 months", nonCompeteRisk: "none",
      quote: "Rigour over speed, always.",
      statBonus: { sci: 5, hr: 1 },
      cv: { 
        education: "PhD Chemistry, University of Southampton (2008). MChem, same (2003). State school in Hampshire.", 
        experience: ["Principal Scientist, Quotient Sciences Nottingham (2014-present) - Contract research for pharma clients. Team of 8.", "Senior Scientist, Covance Harrogate (2008-2014) - Analytical chemistry.", "Summer placements at local chemical company during degree."], 
        achievements: "12 publications. 3 patents. Reliable client delivery record. Trained 20+ junior scientists.",
        skills: "Analytical chemistry, HPLC, mass spec, GLP compliance, client management.",
        personality: "Solid contract research background. Used to client deadlines but thorough. Less flashy than academic researchers but delivers reliably." 
      }
    },
    { id: "r3", name: "Dr. Adaeze Okonkwo", seniority: "senior", portrait: "ğŸ‘©ğŸ¿â€ğŸ”¬",
      background: "Left school at 16. Access course at 22. Now PhD and NHS data analyst. Non-traditional path.",
      origin: "British-Nigerian Â· Coventry",
      strengths: ["Research â†‘â†‘", "Novel methods â†‘"], weaknesses: ["Unproven in industry"],
      salaryExpect: { min: 48, ideal: 54, max: 64 }, equityExpect: { min: 1.0, ideal: 1.25, max: 1.75 },
      interest: 0.9, availability: "immediate", nonCompeteRisk: "none",
      quote: "My thesis solved this three years ago.",
      statBonus: { sci: 3, dev: 1 },
      cv: { 
        education: "PhD Health Informatics, Coventry University (2021). MSc Data Science, De Montfort University (2017). BSc Computing, same (2015). Access course after leaving school at 16.", 
        experience: ["Data Analyst, University Hospitals Coventry NHS Trust (2021-present) - Built models for bed management and patient flow.", "Research Assistant, Coventry University (2017-2021) - PhD funded by NHS trust partnership.", "IT Support, Coventry City Council (2013-2015, part-time during access course and degree)."], 
        achievements: "2 publications. Model saving trust Â£200k annually. First author in health informatics journal. Returned to education at 22.",
        skills: "Python, SQL, NHS data systems, Tableau, understanding NHS bureaucracy.",
        personality: "Non-traditional path to research. Deep NHS knowledge. Understands real-world health data messiness. Needs support transitioning to private sector." 
      }
    },
    { id: "r4", name: "Lucas Sheridan", seniority: "lead", portrait: "ğŸ‘¨ğŸ»â€ğŸ’»",
      background: "Games programmer from Middlesbrough. Teesside degree. Self-taught AI. Ships fast, less polish.",
      origin: "British Â· Middlesbrough",
      strengths: ["Engineering â†‘â†‘â†‘", "Speed â†‘â†‘"], weaknesses: ["Academic rigour"],
      salaryExpect: { min: 68, ideal: 76, max: 88 }, equityExpect: { min: 0.38, ideal: 0.5, max: 0.75 },
      interest: 0.8, availability: "1 month", nonCompeteRisk: "low",
      quote: "I ship. Papers come later.",
      statBonus: { sci: 3, dev: 3 },
      cv: { 
        education: "BSc Computer Games Programming, Teesside University (2012). BTec IT, Middlesbrough College (2009).", 
        experience: ["Technical Lead, Sumo Digital Sheffield (2019-present) - AI systems for racing and sports games. Team of 6.", "Senior Developer, Team17 Wakefield (2015-2019) - Game AI and procedural generation.", "Junior Developer, small Newcastle games studio (2012-2015) - First job out of uni. Studio closed."], 
        achievements: "Shipped AI for 5 published games. Self-taught machine learning. Built procedural systems used in products with 10M+ players.",
        skills: "C++, Python, Unity, Unreal, reinforcement learning, simulation.",
        personality: "Games industry background with ML pivot. Ships fast, less academic polish. Practical problem solver from working-class background." 
      }
    },
    { id: "r5", name: "Dr. Fatou Diallo", seniority: "senior", portrait: "ğŸ‘©ğŸ¿â€ğŸ”¬",
      background: "Former high school maths teacher in Senegal. Now postdoc on temporary visa. Exceptional at doing more with less.",
      origin: "Senegalese Â· Reading",
      strengths: ["Research â†‘â†‘", "Frugal R&D â†‘â†‘"], weaknesses: ["UK network"],
      salaryExpect: { min: 46, ideal: 52, max: 62 }, equityExpect: { min: 1.0, ideal: 1.25, max: 1.75 },
      interest: 0.95, availability: "immediate", nonCompeteRisk: "none",
      quote: "I've done more with less.",
      statBonus: { sci: 3, mkt: 1 },
      cv: { 
        education: "PhD Computer Science, Universite Gaston Berger Saint-Louis Senegal (2020). MSc Applied Maths, same (2016). Taught high school maths for 2 years before masters.", 
        experience: ["Postdoc, University of Reading (2021-present) - Agricultural AI for climate adaptation. Fixed-term contract ending soon.", "Visiting Researcher, AIMS Senegal (2019-2020) - Mathematical modeling.", "High School Teacher, Saint-Louis (2014-2016) - Taught maths and physics."], 
        achievements: "3 publications. WHO Africa featured work. Built crop disease detection running on basic Android phones.",
        skills: "TensorFlow Lite, edge deployment, French/Wolof/English, resource-constrained computing.",
        personality: "Exceptional at doing more with less. Visa situation precarious. Brings valuable perspective but still building UK network." 
      }
    },
    { id: "r6", name: "Vikram Bhatt", seniority: "senior", portrait: "ğŸ‘¨ğŸ½â€ğŸ’»",
      background: "Dropped out of Wolverhampton. Worked at Tesco. Self-taught. Now freelance data specialist for Midlands SMEs.",
      origin: "British-Indian Â· Walsall",
      strengths: ["Research â†‘â†‘", "Unconventional â†‘â†‘"], weaknesses: ["No credentials"],
      salaryExpect: { min: 49, ideal: 57, max: 68 }, equityExpect: { min: 0.75, ideal: 1.0, max: 1.5 },
      interest: 0.9, availability: "immediate", nonCompeteRisk: "none",
      quote: "I learn faster than I studied.",
      statBonus: { sci: 3, dev: 2 },
      cv: { 
        education: "Self-taught ML through online courses. Dropped out of BSc at Wolverhampton after first year (2014). GCSEs from local comprehensive.", 
        experience: ["Freelance Data Specialist (2017-present) - Consulting for small businesses across Midlands. Built fraud model for credit union.", "Data Analyst, NHS Walsall (2015-2017) - First data job. Automated reporting.", "Various retail jobs (2012-2015) - Tesco, Sports Direct."], 
        achievements: "Built fraud model for credit union saving Â£150k. Online competition winner. Self-funded learning.",
        skills: "XGBoost, ensemble methods, tabular data, practical ML, working with non-technical clients.",
        personality: "Brilliant self-taught practitioner. No degree but proven ability. May face credibility issues but consistently delivers." 
      }
    },
    { id: "r7", name: "Priya Sharma", seniority: "junior", portrait: "ğŸ‘©ğŸ½â€ğŸ”¬",
      background: "Made redundant from apprenticeship. Self-funded masters while job hunting. Works in family corner shop.",
      origin: "British-Indian Â· Slough",
      strengths: ["Research â†‘", "Potential â†‘â†‘"], weaknesses: ["Very junior"],
      salaryExpect: { min: 28, ideal: 33, max: 40 }, equityExpect: { min: 0.5, ideal: 0.75, max: 1.0 },
      interest: 1.0, availability: "immediate", nonCompeteRisk: "none",
      quote: "I'll outwork anyone here.",
      statBonus: { sci: 2, hr: 1 },
      cv: { 
        education: "MSc Data Science, University of Hertfordshire (2023). Degree Apprenticeship incomplete (made redundant). A-levels from Langley Grammar.", 
        experience: ["Data Analyst Apprentice, Centrica (2019-2022) - Made redundant during restructure. Used apprenticeship levy for training.", "Self-funded MSc while job hunting (2022-2023).", "Part-time at family corner shop throughout."], 
        achievements: "MSc Distinction. Dissertation on energy demand prediction. Presented at student conference. Supported family business.",
        skills: "Python, SQL, Power BI, energy sector knowledge, customer data.",
        personality: "Determined despite setbacks. Worked throughout education. Needs mentoring but brings real-world grounding and work ethic." 
      }
    },
    { id: "r8", name: "Dr. Thomas Brennan", seniority: "senior", portrait: "ğŸ‘¨ğŸ¼â€ğŸ”¬",
      background: "Factory worker until 28. Then LJMU degree. Burned out from academia. Now strict on work-life balance.",
      origin: "Irish Â· Liverpool",
      strengths: ["Research â†‘â†‘", "Depth â†‘"], weaknesses: ["Needs boundaries"],
      salaryExpect: { min: 54, ideal: 62, max: 72 }, equityExpect: { min: 0.5, ideal: 0.75, max: 1.0 },
      interest: 0.7, availability: "1 month", nonCompeteRisk: "none",
      quote: "I work 40 hours now. Non-negotiable.",
      statBonus: { sci: 3, hr: 1 },
      cv: { 
        education: "PhD Robotics, Liverpool John Moores University (2016). BEng Mechanical Engineering, same (2011). Started degree at 28 after working in factories.", 
        experience: ["Research Fellow, LJMU (2016-2022) - Industrial robotics projects with local manufacturers. Burned out from fixed-term contract stress.", "Career break (2022-2023) - Recovered, relocated.", "Factory floor roles, various (2000-2008) - Assembly, maintenance, team leading at Jaguar Land Rover Halewood."], 
        achievements: "7 publications. 2 patents with small manufacturer partners. Practical robotics deployed in real factories.",
        skills: "ROS, industrial automation, PLC programming, working with factory floor staff.",
        personality: "Brings factory floor perspective to research. Mature, reliable. Strict on work boundaries after burnout. Values practical impact." 
      }
    },
    { id: "r9", name: "Jamal Hussein", seniority: "junior", portrait: "ğŸ‘¨ğŸ¾â€ğŸ”¬",
      background: "Bradford College, then Sheffield Hallam. Did A-levels while working at his uncle's taxi firm. Eager to prove himself.",
      origin: "British-Somali Â· Bradford",
      strengths: ["Research â†‘", "Determination â†‘â†‘"], weaknesses: ["Experience"],
      salaryExpect: { min: 27, ideal: 32, max: 38 }, equityExpect: { min: 0.38, ideal: 0.5, max: 0.75 },
      interest: 1.0, availability: "immediate", nonCompeteRisk: "none",
      quote: "I taught myself Python from YouTube. What else do you need?",
      statBonus: { sci: 2, dev: 1 },
      cv: { 
        education: "BSc Computer Science, Sheffield Hallam University (2023). First in family to go to university. A-levels at Bradford College.", 
        experience: ["IT Support, Bradford Council (2023-present, temporary contract) - Automated reporting saving 10 hours weekly.", "Data Entry, NHS Bradford (Summer 2022) - Spotted errors in patient data, flagged to managers.", "Driver, family taxi business (2018-2021) - Funded A-levels and supported family."], 
        achievements: "First Class degree. Built COVID dashboard for local mosque. Automated council reporting.",
        skills: "Python, SQL, Excel, basic ML from online courses, problem-solving.",
        personality: "Self-starter from challenging background. Taught himself to code. Needs mentoring but exceptional drive and practical mindset." 
      }
    },
    { id: "r10", name: "Sophie Greenwood", seniority: "junior", portrait: "ğŸ‘©ğŸ»â€ğŸ”¬",
      background: "Keele University. Single mum, studied part-time. Did placement at local water company. Organised and resilient.",
      origin: "British Â· Stoke-on-Trent",
      strengths: ["Research â†‘", "Organisation â†‘â†‘"], weaknesses: ["Limited availability"],
      salaryExpect: { min: 25, ideal: 30, max: 36 }, equityExpect: { min: 0.25, ideal: 0.38, max: 0.5 },
      interest: 0.85, availability: "1 month", nonCompeteRisk: "none",
      quote: "I juggled a degree, a toddler, and a part-time job. I can handle pressure.",
      statBonus: { sci: 2, hr: 1 },
      cv: { 
        education: "BSc Data Science, Keele University (2023, part-time over 5 years). Access course at Stoke College.", 
        experience: ["Data Analyst Placement, Severn Trent Water (2022) - Built leak detection model. Offered permanent role but location didn't work.", "Customer Service, Bet365 Stoke (2018-2022, part-time) - Funded studies while raising daughter.", "Carer for grandmother (2016-2018)."], 
        achievements: "2:1 degree while single parenting. Placement project saved water company Â£50k. Mature student award.",
        skills: "Python, R, data visualisation, time management, stakeholder communication.",
        personality: "Resilient and organised from managing studies, work, and parenting. May need flexibility but brings exceptional time management and real-world grounding." 
      }
    }
  ],
  
  product: [
    { id: "p1", name: "Finn Gallagher", seniority: "lead", portrait: "ğŸ‘¨ğŸ»â€ğŸ’»",
      background: "Three small companies, one sold, two failed. SUSI grant student. Will do any job that needs doing.",
      origin: "Irish Â· Dublin â†’ London",
      strengths: ["Product â†‘â†‘â†‘", "Scrappy â†‘â†‘"], weaknesses: ["Process-averse"],
      salaryExpect: { min: 62, ideal: 70, max: 81 }, equityExpect: { min: 0.75, ideal: 1.0, max: 1.5 },
      interest: 0.8, availability: "immediate", nonCompeteRisk: "none",
      quote: "I'll do whatever needs doing.",
      statBonus: { dev: 4, mkt: 1 },
      cv: { 
        education: "BSc Computer Science, Dublin City University (2012). SUSI grant recipient.", 
        experience: ["Co-founder, small logistics software company (2019-2023) - Sold to larger logistics firm. Built fleet tracking from 0 to 5k users.", "Technical lead, Dublin payments company (2016-2019) - Led team of 5. Company shut down 2019.", "First Engineer, Dublin online shop (2012-2016) - Employee #4. Company failed but learned everything."], 
        achievements: "1 sale exit. Built products used by 5k+ businesses. Failed twice, learned more.",
        skills: "Full-stack (Node.js, React, Python), product management, team building.",
        personality: "Battle-tested founder who gets things done. Hates process and bureaucracy. Will wear any hat needed. May clash with structured colleagues but invaluable early stage." 
      }
    },
    { id: "p2", name: "Camila Herrera", seniority: "senior", portrait: "ğŸ‘©ğŸ½â€ğŸ’»",
      background: "Chevening Scholar from Colombia. Ran own company, closed during pandemic. Needs autonomy.",
      origin: "Colombian-British Â· Brighton",
      strengths: ["Product â†‘â†‘", "Speed â†‘â†‘"], weaknesses: ["Authority issues"],
      salaryExpect: { min: 57, ideal: 65, max: 78 }, equityExpect: { min: 1.0, ideal: 1.25, max: 1.75 },
      interest: 0.85, availability: "1 month", nonCompeteRisk: "low",
      quote: "I've been a founder. I get it.",
      statBonus: { dev: 3, sci: 1 },
      cv: { 
        education: "MSc Digital Media, University of Sussex (2017). BFA New Media, Universidad Jorge Tadeo Lozano Bogota (2015). Chevening Scholar.", 
        experience: ["Product Lead, Paddle Brighton (2021-present) - Led redesign of merchant dashboard. Managing team of 4.", "Founder, Latin American payments company (2018-2021) - Raised Â£400k. Shut down during pandemic.", "Designer, Brighton agency (2017-2018) - Client work for Amex and Southern Rail."], 
        achievements: "Raised funding. Chevening Scholar. Speaker at Brighton product meetup.",
        skills: "Product strategy, user research, Figma, prototyping, Spanish/English fluent.",
        personality: "Founder DNA - moves fast and questions everything. May struggle not being in charge. Excellent at 0-to-1 product development. Needs autonomy." 
      }
    },
    { id: "p3", name: "Daniel Yeom", seniority: "lead", portrait: "ğŸ‘¨ğŸ»â€ğŸ’¼",
      background: "Samsung office in Staines, then consulting, now digital bank. Knows process. May over-engineer for small team.",
      origin: "Korean-British Â· Reading",
      strengths: ["Product â†‘â†‘", "Process â†‘â†‘â†‘"], weaknesses: ["Startup chaos"],
      salaryExpect: { min: 76, ideal: 86, max: 100 }, equityExpect: { min: 0.25, ideal: 0.38, max: 0.62 },
      interest: 0.55, availability: "2 months", nonCompeteRisk: "medium",
      quote: "I managed products with hundreds of thousands of users.",
      statBonus: { dev: 4, hr: 2 },
      cv: { 
        education: "MBA, Henley Business School (2016). BSc Electronic Engineering, University of Surrey (2010).", 
        experience: ["Director of Product, Starling Bank (2019-present) - Led business banking product. Team of 18. Grew SMB accounts.", "Product Manager, Samsung UK Staines (2016-2019) - Smart home product line.", "Management Consultant, Capgemini (2010-2016) - Financial services projects."], 
        achievements: "Products used by 400k+ SMBs. First in family to get MBA.",
        skills: "Product strategy, team scaling, stakeholder management, FCA regulatory awareness.",
        personality: "Brings experience of larger product teams. May over-engineer for early stage. Knows exactly how to build product organisations." 
      }
    },
    { id: "p4", name: "Alexei Volkov", seniority: "senior", portrait: "ğŸ‘¨ğŸ»â€ğŸ’»",
      background: "Ukraine. Builds faster alone than most teams. Won't manage others. Open source contributor.",
      origin: "Ukrainian Â· Settled status",
      strengths: ["Product â†‘â†‘â†‘", "Code â†‘â†‘â†‘"], weaknesses: ["Management allergic"],
      salaryExpect: { min: 62, ideal: 70, max: 80 }, equityExpect: { min: 1.0, ideal: 1.25, max: 1.75 },
      interest: 0.7, availability: "immediate", nonCompeteRisk: "none",
      quote: "I build it myself. Faster that way.",
      statBonus: { dev: 5 },
      cv: { 
        education: "BSc Computer Science, National University of Kyiv-Mohyla Academy (2015). Incomplete MSc (left for work).", 
        experience: ["Independent Developer (2017-present) - Created Python library with 25k GitHub stars.", "Senior Developer, Grammarly Kyiv (2015-2017) - Core language processing pipeline.", "Freelance Developer (2013-2015) - Built 20+ client projects while studying."], 
        achievements: "Open source maintainer with 30k+ GitHub stars.",
        skills: "Python, FastAPI, TypeScript, system architecture, performance optimisation.",
        personality: "Legendary individual contributor who builds faster alone than most teams. Refuses to manage others. Perfect for critical technical problems but won't grow a team." 
      }
    },
    { id: "p5", name: "Tariq Al-Rashid", seniority: "senior", portrait: "ğŸ‘¨ğŸ½â€ğŸ’»",
      background: "Self-taught from Newham. Started building websites, now builds banking systems. Give him problems, not specs.",
      origin: "British-Jordanian Â· East London",
      strengths: ["Product â†‘â†‘â†‘", "Systems â†‘â†‘"], weaknesses: ["Impatient"],
      salaryExpect: { min: 57, ideal: 65, max: 76 }, equityExpect: { min: 0.75, ideal: 1.0, max: 1.25 },
      interest: 0.9, availability: "1 month", nonCompeteRisk: "low",
      quote: "Give me a problem, not a spec.",
      statBonus: { dev: 4, sci: 1 },
      cv: { 
        education: "Self-taught software engineer. Online courses. GCSEs and A-levels from Newham Sixth Form.", 
        experience: ["Senior Software Engineer, ClearBank (2020-present) - Built core clearing infrastructure. On-call lead during rapid growth.", "Software Engineer, Modulr (2018-2020) - Payment APIs. First banking job.", "Junior Developer, small web agency Stratford (2016-2018) - First coding job after self-teaching. Built WordPress sites."], 
        achievements: "Built systems processing Â£20M+ daily. Promoted twice. Went from WordPress to banking infrastructure in 6 years.",
        skills: "Go, PostgreSQL, Kafka, payment systems, distributed systems.",
        personality: "Exceptional engineer who wants to build, not follow specs. Impatient with slow decisions. Best when given hard problems and autonomy." 
      }
    },
    { id: "p6", name: "Kwame Boateng", seniority: "senior", portrait: "ğŸ‘¨ğŸ¿â€ğŸ’»",
      background: "Graphic design degree, then taught himself to code. Prototypes faster than engineers write specs.",
      origin: "British-Ghanaian Â· Brixton",
      strengths: ["Product â†‘â†‘", "Design â†‘â†‘"], weaknesses: ["Backend gaps"],
      salaryExpect: { min: 46, ideal: 54, max: 65 }, equityExpect: { min: 0.5, ideal: 0.75, max: 1.0 },
      interest: 0.85, availability: "immediate", nonCompeteRisk: "none",
      quote: "I prototype faster than engineers spec.",
      statBonus: { dev: 3, mkt: 2 },
      cv: { 
        education: "BA Graphic Design, London College of Communication (2016). Self-taught frontend through YouTube.", 
        experience: ["Design Engineer, Plum savings app (2020-present) - Hybrid role building and designing features. Ships full features independently.", "Product Designer, London property company (2018-2020) - Designed tenant app. First designer to ship own code.", "Junior Designer, small Peckham agency (2016-2018) - Client work for local businesses and charities."], 
        achievements: "Rare designer who codes production features. Built design system from scratch.",
        skills: "Figma, React, TypeScript, design systems, user research, motion design.",
        personality: "Rare talent who both designs and codes. Prototypes faster than most teams spec. Backend limited but frontend exceptional." 
      }
    },
    { id: "p7", name: "Chiamaka Eze", seniority: "junior", portrait: "ğŸ‘©ğŸ¿â€ğŸ’»",
      background: "Sociology degree, worked at Sainsbury's, then coding bootcamp. Top of cohort. First in family in tech.",
      origin: "British-Nigerian Â· Peckham",
      strengths: ["Product â†‘", "Potential â†‘â†‘"], weaknesses: ["Experience"],
      salaryExpect: { min: 30, ideal: 35, max: 41 }, equityExpect: { min: 0.38, ideal: 0.5, max: 0.75 },
      interest: 1.0, availability: "immediate", nonCompeteRisk: "none",
      quote: "I learn faster than anyone.",
      statBonus: { dev: 2, hr: 1 },
      cv: { 
        education: "Founders and Coders Bootcamp (2023). Top of cohort. Previous: BA Sociology, London South Bank University (2021).", 
        experience: ["Apprentice Developer, Founders and Coders (2023) - Built 5 full-stack projects including NHS appointment prototype.", "Community Organiser, Code First Girls South London (2022-2023) - Organised workshops for 150+ women.", "Customer Service, Sainsbury's (2019-2021) - Funded studies."], 
        achievements: "Top graduate from selective bootcamp. Built NHS prototype for innovation showcase. First in family to work in tech.",
        skills: "JavaScript, React, Node.js, PostgreSQL, pair programming, agile.",
        personality: "Raw talent from non-traditional background. Exceptional learning velocity. Needs mentoring but brings fresh perspective and determination." 
      }
    },
    { id: "p8", name: "Ben Calder", seniority: "junior", portrait: "ğŸ‘¨ğŸ»â€ğŸ’»",
      background: "Physics PhD from Glasgow/CERN. Teaching himself web development. Brilliant but unfamiliar with industry.",
      origin: "Scottish Â· Glasgow",
      strengths: ["Product â†‘", "Problem-solving â†‘â†‘"], weaknesses: ["Industry norms"],
      salaryExpect: { min: 36, ideal: 43, max: 51 }, equityExpect: { min: 0.38, ideal: 0.5, max: 0.62 },
      interest: 0.9, availability: "immediate", nonCompeteRisk: "none",
      quote: "Physics taught me to debug reality.",
      statBonus: { dev: 2, sci: 2 },
      cv: { 
        education: "PhD Experimental Physics, University of Glasgow (2023). MPhys Physics, University of Strathclyde (2018).", 
        experience: ["Doctoral Researcher, Glasgow/CERN (2018-2023) - ML models for particle physics. Code on worldwide computing grid.", "Self-taught web development (2022-2023) - Built projects while finishing PhD.", "Summer Researcher, STFC Daresbury (2017) - Accelerator physics."], 
        achievements: "4 papers as ATLAS collaboration author. Code deployed on LHC computing grid.",
        skills: "Python, C++, data analysis, scientific computing, statistical analysis, ML.",
        personality: "Brilliant problem solver transitioning from academia. Unfamiliar with industry norms. Brings rigorous analytical thinking." 
      }
    },
    { id: "p9", name: "Aisha Begum", seniority: "junior", portrait: "ğŸ‘©ğŸ½â€ğŸ’»",
      background: "Grew up above family restaurant in Rusholme. Salford degree. Built booking system for dad's business. Practical and resourceful.",
      origin: "British-Bangladeshi Â· Manchester",
      strengths: ["Product â†‘", "Resourcefulness â†‘â†‘"], weaknesses: ["Formal training"],
      salaryExpect: { min: 28, ideal: 33, max: 40 }, equityExpect: { min: 0.38, ideal: 0.5, max: 0.75 },
      interest: 0.95, availability: "immediate", nonCompeteRisk: "none",
      quote: "I built our restaurant's booking system in a weekend. Customers loved it.",
      statBonus: { dev: 2, mkt: 1 },
      cv: { 
        education: "BSc Software Engineering, University of Salford (2023). BTec IT at Loreto College Manchester.", 
        experience: ["Junior Developer, AutoTrader Manchester (2023-present, contract) - Built internal tools. Contract ending.", "Freelance Web Developer (2020-2023) - Built sites for 8 local businesses including restaurants and a driving school.", "Various roles in family restaurant (2015-2020) - Front of house, then built their booking and inventory systems."], 
        achievements: "Restaurant system still in use. AutoTrader tool adopted by 3 teams. First in family to get degree.",
        skills: "JavaScript, React, Node.js, practical problem-solving, working with non-technical clients.",
        personality: "Practical builder who learned by solving real problems. Less formal training but ships working software. Understands small business needs." 
      }
    }
  ],
  
  marketing: [
    { id: "m1", name: "Ryan Galbraith", seniority: "senior", portrait: "ğŸ‘¨ğŸ»â€ğŸ’¼",
      background: "Glasgow Caledonian degree. Gets results but may push ethical boundaries. Needs guardrails.",
      origin: "Scottish Â· Glasgow â†’ London",
      strengths: ["Marketing â†‘â†‘â†‘", "Speed â†‘â†‘"], weaknesses: ["Ethics flexibility"],
      salaryExpect: { min: 54, ideal: 62, max: 73 }, equityExpect: { min: 0.5, ideal: 0.75, max: 1.0 },
      interest: 0.75, availability: "1 month", nonCompeteRisk: "low",
      quote: "I'll get you users. Don't ask how.",
      statBonus: { mkt: 4, dev: 1 },
      cv: { 
        education: "BA Marketing, Glasgow Caledonian University (2015). HND Marketing, Glasgow Clyde College (2013).", 
        experience: ["Head of Growth, Emma sleep UK (2021-present) - Scaled UK users. Built growth team of 4. Performance marketing focus.", "Growth Lead, Cazoo (2018-2021) - Early team. Built referral programme generating 20% of leads before layoffs.", "Marketing Executive, Glasgow software company (2015-2018) - First marketing hire. Did everything."], 
        achievements: "Scaled multiple products. Built referral programmes. Survived Cazoo layoffs by delivering numbers.",
        skills: "Performance marketing, referral programmes, TikTok ads, attribution, SQL.",
        personality: "Results-obsessed marketer who moves fast. May push ethical boundaries. Delivers numbers but needs guardrails." 
      }
    },
    { id: "m2", name: "Natasha Morozova", seniority: "senior", portrait: "ğŸ‘©ğŸ¼â€ğŸ’¼",
      background: "Russian-British. Managed Â£15M ad budget at ASOS. Data-obsessed. Weak on organic and brand.",
      origin: "Russian-British Â· Settled status",
      strengths: ["Marketing â†‘â†‘â†‘", "Paid â†‘â†‘"], weaknesses: ["Organic skills"],
      salaryExpect: { min: 49, ideal: 57, max: 68 }, equityExpect: { min: 0.75, ideal: 1.0, max: 1.25 },
      interest: 0.8, availability: "immediate", nonCompeteRisk: "none",
      quote: "Every pound should be measured.",
      statBonus: { mkt: 4, dev: 1 },
      cv: { 
        education: "BSc Business Studies, University of Westminster (2016). CIM Digital Marketing Certificate (2018).", 
        experience: ["Performance Marketing Lead, ASOS (2020-present) - Managed Â£15M annual spend. Google and Meta ads.", "Digital Marketing Manager, Boohoo (2018-2020) - Paid social and search.", "Marketing Coordinator, small fashion online shop (2016-2018) - First marketing role."], 
        achievements: "Managed Â£15M+ ad budgets profitably. Grew return on ad spend 40% year-on-year.",
        skills: "Google Ads, Meta Ads, performance marketing, attribution modeling, Excel.",
        personality: "Data-obsessed paid marketer. Weak on organic and brand. Perfect if you have budget to spend." 
      }
    },
    { id: "m3", name: "Helen McCarthy", seniority: "lead", portrait: "ğŸ‘©ğŸ»â€ğŸ’¼",
      background: "Oxford Brookes. Frozen food and cereals marketing for 15 years. Thinks in years, not weeks.",
      origin: "British Â· Basingstoke",
      strengths: ["Marketing â†‘â†‘", "Brand â†‘â†‘â†‘"], weaknesses: ["Digital gaps"],
      salaryExpect: { min: 64, ideal: 73, max: 86 }, equityExpect: { min: 0.25, ideal: 0.38, max: 0.62 },
      interest: 0.6, availability: "2 months", nonCompeteRisk: "low",
      quote: "Brand is what people say when you're not in the room.",
      statBonus: { mkt: 5, hr: 1 },
      cv: { 
        education: "BA Business Studies, Oxford Brookes University (2008). CIM Diploma in Marketing (2010, evening classes).", 
        experience: ["Brand Director, Richmond Foods (2018-present) - Led brand for frozen meat business. Repositioning around quality.", "Senior Brand Manager, Weetabix (2014-2018) - Managed core cereal portfolio.", "Marketing Executive, regional food agency Reading (2008-2014) - Client work for local food brands."], 
        achievements: "Managed brands with Â£150M+ revenue. Marketing Week shortlist. Built brand tracking from scratch.",
        skills: "Brand strategy, positioning, creative briefing, agency management, consumer research, P&L.",
        personality: "Strong brand builder thinking in years not quarters. May struggle with startup metrics pressure but builds lasting advantage." 
      }
    },
    { id: "m4", name: "Adaora Nwosu", seniority: "senior", portrait: "ğŸ‘©ğŸ¿â€ğŸ’¼",
      background: "Westminster degree with Barclays placement. Relentless hustler. Better at direct sales than long-term strategy.",
      origin: "British-Nigerian Â· London",
      strengths: ["Marketing â†‘â†‘", "Hustle â†‘â†‘"], weaknesses: ["Strategy patience"],
      salaryExpect: { min: 57, ideal: 65, max: 76 }, equityExpect: { min: 0.5, ideal: 0.75, max: 1.0 },
      interest: 0.9, availability: "immediate", nonCompeteRisk: "low",
      quote: "I'll get meetings with anyone.",
      statBonus: { mkt: 3, hr: 1 },
      cv: { 
        education: "BSc Business Management, University of Westminster (2018). Sandwich year at Barclays.", 
        experience: ["Account Executive, Cognism (2021-present) - 140%+ of quota consistently. Closed largest SMB deal 2022.", "Sales Development Rep, Intercom (2019-2021) - Built Â£1.5M pipeline.", "Graduate sales, Barclays (2018-2019) - Business banking. Hated it."], 
        achievements: "President's Club. Built Â£3M+ pipeline. Westminster Entrepreneurs Award.",
        skills: "B2B sales, pipeline building, Salesforce, HubSpot, cold outreach, LinkedIn.",
        personality: "Relentless hustler who gets meetings with anyone. More comfortable with direct sales than strategy. Needs guidance on long-term brand." 
      }
    },
    { id: "m5", name: "Ezra Liebowitz", seniority: "senior", portrait: "ğŸ‘¨ğŸ»â€ğŸ’¼",
      background: "Israeli developer who discovered a passion for teaching. Built communities of 50k+ developers.",
      origin: "American-Israeli Â· Relocated",
      strengths: ["Marketing â†‘â†‘", "Community â†‘â†‘â†‘"], weaknesses: ["Revenue pressure"],
      salaryExpect: { min: 54, ideal: 62, max: 73 }, equityExpect: { min: 0.75, ideal: 1.0, max: 1.25 },
      interest: 0.75, availability: "1 month", nonCompeteRisk: "none",
      quote: "Authentic communities can't be rushed.",
      statBonus: { mkt: 3, dev: 2 },
      cv: { 
        education: "BSc Computer Science, Ben-Gurion University of the Negev (2016). IDF service (2010-2013).", 
        experience: ["Community Lead, CircleCI (2021-present) - Built developer community 5k to 40k. 3M monthly content impressions.", "Technical Educator, small software tools company (2018-2021) - First community hire. Created tutorials with 1M+ views.", "Software Engineer, Check Point (2016-2018) - Security tools. Discovered passion for teaching."], 
        achievements: "Built communities totaling 50k+ members. Content reaching millions. Speaker at 20+ conferences.",
        skills: "Community building, technical writing, tutorials, JavaScript, video production.",
        personality: "Genuine community builder who understands developers. Resists short-term revenue pressure. Perfect for reaching technical audiences." 
      }
    },
    { id: "m6", name: "Folake Ogundimu", seniority: "senior", portrait: "ğŸ‘©ğŸ¿â€ğŸ’¼",
      background: "300k social media followers, all organic. UEL degree. Understands social intuitively but less strategic experience.",
      origin: "British-Nigerian Â· Online",
      strengths: ["Marketing â†‘â†‘", "Social â†‘â†‘â†‘"], weaknesses: ["Strategy depth"],
      salaryExpect: { min: 46, ideal: 54, max: 65 }, equityExpect: { min: 0.5, ideal: 0.75, max: 1.0 },
      interest: 0.85, availability: "immediate", nonCompeteRisk: "none",
      quote: "I have 300k followers. Organic.",
      statBonus: { mkt: 4 },
      cv: { 
        education: "BA Media Studies, University of East London (2019). Student newspaper editor.", 
        experience: ["Content Creator / Influencer (2019-present) - 300k+ followers across platforms. All organic. Brand partnerships worth Â£80k annually.", "Freelance Social Consultant (2021-present) - Advised 10+ small companies on social strategy.", "Social Media, JustEat (2019-2021, part-time) - Managed Twitter during pandemic growth."], 
        achievements: "300k+ organic followers. Viral threads with 5M+ impressions. Consulted for various startups.",
        skills: "Twitter/X, LinkedIn, TikTok, content strategy, personal branding, influencer partnerships.",
        personality: "Understands social intuitively. Massive organic reach. Less experienced with traditional strategy and measurement." 
      }
    },
    { id: "m7", name: "Lucy Huang", seniority: "junior", portrait: "ğŸ‘©ğŸ»â€ğŸ’¼",
      background: "Manchester Met degree. Eager recent graduate. Managed accounts for local businesses during studies.",
      origin: "British-Chinese Â· Manchester",
      strengths: ["Marketing â†‘", "Potential â†‘â†‘"], weaknesses: ["Experience"],
      salaryExpect: { min: 25, ideal: 30, max: 36 }, equityExpect: { min: 0.12, ideal: 0.25, max: 0.38 },
      interest: 1.0, availability: "immediate", nonCompeteRisk: "none",
      quote: "I'll learn anything you need.",
      statBonus: { mkt: 2, hr: 1 },
      cv: { 
        education: "BSc Marketing, Manchester Metropolitan University (2023). Best dissertation prize.", 
        experience: ["Marketing Intern, Peak AI Manchester (Summer 2022) - Created content for AI platform. Blog posts with 30k+ views.", "Marketing Assistant, Student Union (2021-2023) - Promoted events to 30k+ students.", "Freelance Social Media (2020-2022) - Managed accounts for 4 local businesses."], 
        achievements: "First Class degree. Best dissertation. Internship at AI company.",
        skills: "Social media, Canva, basic Figma, Google Analytics, content writing, HubSpot certified.",
        personality: "Eager recent graduate with genuine AI/tech interest. Needs development but brings fresh perspective. Great attitude." 
      }
    },
    { id: "m8", name: "Callum Fraser", seniority: "junior", portrait: "ğŸ‘¨ğŸ»â€ğŸ’¼",
      background: "Tech journalist who knows every editor in London. IT support at Aberdeen council funded his studies.",
      origin: "Scottish Â· Edinburgh",
      strengths: ["Marketing â†‘", "Media â†‘â†‘"], weaknesses: ["Commercial instincts"],
      salaryExpect: { min: 33, ideal: 40, max: 48 }, equityExpect: { min: 0.25, ideal: 0.38, max: 0.5 },
      interest: 0.85, availability: "1 month", nonCompeteRisk: "none",
      quote: "I know every tech editor in London.",
      statBonus: { mkt: 2, sci: 1 },
      cv: { 
        education: "MA Journalism, Edinburgh Napier University (2020). BSc Computing, Robert Gordon University Aberdeen (2019).", 
        experience: ["Technology Reporter, Sifted (2021-present) - 150+ articles on UK/EU startups. Broke 2 major funding stories.", "Freelance Writer, Wired UK/TechCrunch (2020-2021) - Contributed tech features.", "IT Support, Aberdeen council (2017-2019, part-time) - Funded studies."], 
        achievements: "150+ published articles. Strong relationships with tech journalists. Rare tech + editorial background.",
        skills: "Writing, media relations, WordPress, interview techniques, basic Python.",
        personality: "Knows tech editors personally. Still developing commercial instincts. Perfect for earned media and PR." 
      }
    },
    { id: "m9", name: "Declan O'Brien", seniority: "junior", portrait: "ğŸ‘¨ğŸ»â€ğŸ’¼",
      background: "Leeds Beckett degree. Ran social media for student union. Did summer at recruitment agency. Enthusiastic but green.",
      origin: "British-Irish Â· Leeds",
      strengths: ["Marketing â†‘", "Energy â†‘â†‘"], weaknesses: ["Strategic depth"],
      salaryExpect: { min: 24, ideal: 28, max: 35 }, equityExpect: { min: 0.12, ideal: 0.25, max: 0.38 },
      interest: 1.0, availability: "immediate", nonCompeteRisk: "none",
      quote: "I'll be first in and last out. Just give me a chance.",
      statBonus: { mkt: 2, hr: 1 },
      cv: { 
        education: "BA Marketing Communications, Leeds Beckett University (2023). A-levels at Notre Dame Catholic Sixth Form Leeds.", 
        experience: ["Marketing Assistant, Hays Recruitment Leeds (Summer 2023) - Ran LinkedIn campaigns for tech division.", "Student Union Marketing Officer (2021-2023) - Grew Instagram from 2k to 8k followers. Event promotion.", "Part-time at Wetherspoons (2019-2023) - Funded studies."], 
        achievements: "Tripled student union social following. Best marketing campaign award for freshers week. First in family to finish university.",
        skills: "Social media, Canva, content creation, events marketing, enthusiasm.",
        personality: "High energy recent graduate. Limited experience but genuine enthusiasm and willingness to learn. Good culture fit for early-stage teams." 
      }
    }
  ],
  
  people: [
    { id: "h1", name: "Suki Patel", seniority: "lead", portrait: "ğŸ‘©ğŸ½â€ğŸ’¼",
      background: "Leicester to London. Commuted for years. Built people teams at three companies. First in family with masters.",
      origin: "British-Indian Â· Leicester â†’ London",
      strengths: ["People â†‘â†‘â†‘", "Culture â†‘â†‘â†‘"], weaknesses: ["Corporate process"],
      salaryExpect: { min: 68, ideal: 76, max: 89 }, equityExpect: { min: 0.5, ideal: 0.75, max: 1.0 },
      interest: 0.75, availability: "1 month", nonCompeteRisk: "low",
      quote: "Culture is what happens when you're not looking.",
      statBonus: { hr: 5, dev: 1 },
      cv: { 
        education: "MSc Organisational Psychology, Birkbeck University of London (2015, part-time while working). BSc Psychology, De Montfort University (2010). CIPD Level 7.", 
        experience: ["Chief People Officer, Peak AI Manchester (2020-present) - Built people function from scratch. Scaled 40 to 180.", "VP People, Tessian (2017-2020) - Joined at 30, scaled to 150.", "People Lead, small payments company (2015-2017) - First people hire. Commuted from Leicester."], 
        achievements: "Scaled 3 companies. Built teams across 4 countries. CIPD qualified. First in family to get masters.",
        skills: "Org design, compensation frameworks, high-growth scaling, DEI strategy, employment law.",
        personality: "Exceptional culture builder who understands startup chaos. Worked her way up from regional background. Resists corporate bureaucracy." 
      }
    },
    { id: "h2", name: "Jerome Jackson", seniority: "lead", portrait: "ğŸ‘¨ğŸ¿â€ğŸ’¼",
      background: "Started at Next grad scheme. Then Tesco HR. Now tech. Used to big numbers but learning tech culture.",
      origin: "British Â· Manchester â†’ London",
      strengths: ["People â†‘â†‘", "Process â†‘â†‘"], weaknesses: ["Tech culture"],
      salaryExpect: { min: 68, ideal: 76, max: 89 }, equityExpect: { min: 0.38, ideal: 0.5, max: 0.75 },
      interest: 0.65, availability: "2 months", nonCompeteRisk: "medium",
      quote: "I scaled people ops from 200 to 2,000.",
      statBonus: { hr: 4, mkt: 1 },
      cv: { 
        education: "MBA, Alliance Manchester Business School (2016). BA Business, Manchester Metropolitan University (2010). CIPD Level 5.", 
        experience: ["Head of People, The Hut Group (2019-present) - People ops for tech division (800 employees). Managed Â£3M L&D budget.", "HR Business Partner, Tesco (2016-2019) - Store operations support. 3 regions, 2,000 staff.", "HR Coordinator, Next (2010-2016) - Progressed from grad scheme."], 
        achievements: "Built people processes at scale. Alliance MBS distinction. Tesco HR Rising Star 2018.",
        skills: "People analytics, Workday, compensation design, performance management, change management.",
        personality: "Brings retail scale experience - used to large numbers. Learning tech culture nuances. Knows process but adapting to startup pace." 
      }
    },
    { id: "h3", name: "Ava Lindgren", seniority: "senior", portrait: "ğŸ‘©ğŸ¼â€ğŸ’¼",
      background: "Swedish. Top biller at Reed recruitment. Exceptional at finding people but less experienced with retention.",
      origin: "Swedish Â· London",
      strengths: ["People â†‘â†‘", "Hiring â†‘â†‘â†‘"], weaknesses: ["Retention depth"],
      salaryExpect: { min: 54, ideal: 62, max: 73 }, equityExpect: { min: 0.5, ideal: 0.75, max: 1.0 },
      interest: 0.85, availability: "immediate", nonCompeteRisk: "none",
      quote: "I find people others can't.",
      statBonus: { hr: 4, sci: 1 },
      cv: { 
        education: "MSc Human Resource Management, University of Westminster (2018). BSc Business, Jonkoping University Sweden (2016).", 
        experience: ["Senior Talent Partner, VC portfolio support (2021-present) - Embedded recruiter for 6 portfolio companies. Placed 40+ senior hires.", "Tech Recruiter, Reed Technology (2018-2021) - Top biller 2 years. Engineering and data roles.", "HR Intern, IKEA Malmo (Summer 2015)."], 
        achievements: "Placed 150+ candidates. Top biller at agency. Built networks across European markets.",
        skills: "Executive search, employer branding, Greenhouse, Lever, LinkedIn Recruiter, salary benchmarking.",
        personality: "Exceptional at finding and closing talent. Less experienced with retention and L&D. Perfect if hiring is priority." 
      }
    },
    { id: "h4", name: "Dayo Adeyinka", seniority: "senior", portrait: "ğŸ‘¨ğŸ¿â€ğŸ’¼",
      background: "London Met degree. Built own education company to 20 people. Closed during pandemic. Understands founders.",
      origin: "British-Nigerian Â· South London",
      strengths: ["People â†‘â†‘", "Founder empathy â†‘â†‘"], weaknesses: ["HR process"],
      salaryExpect: { min: 57, ideal: 65, max: 76 }, equityExpect: { min: 0.75, ideal: 1.0, max: 1.25 },
      interest: 0.9, availability: "immediate", nonCompeteRisk: "none",
      quote: "I've been on both sides.",
      statBonus: { hr: 3, dev: 1 },
      cv: { 
        education: "BA Business Studies, London Metropolitan University (2014). CIPD Level 5 in progress.", 
        experience: ["Head of People, Second Nature AI health (2022-present) - Scaled 15 to 45. Built first frameworks.", "Co-founder, education company (2017-2022) - Built to 20 people. Raised Â£400k. Shut down during pandemic.", "Operations, Entrepreneur First (2014-2017) - Supported 150+ founders."], 
        achievements: "Founded and scaled company. Deep understanding of founder psychology. Building AI startup people function.",
        skills: "Founder coaching, startup compensation, equity planning, difficult conversations.",
        personality: "Rare founder experience with people focus. Understands both sides. Still building HR process expertise but exceptional at human elements." 
      }
    },
    { id: "h5", name: "Jordan Osei", seniority: "senior", portrait: "ğŸ‘¨ğŸ¿â€ğŸ’¼",
      background: "Hertfordshire degree. Hated office HR at Vodafone. Now remote work specialist. May resist office culture.",
      origin: "British-Ghanaian Â· Remote",
      strengths: ["People â†‘â†‘", "Remote â†‘â†‘â†‘"], weaknesses: ["Office culture"],
      salaryExpect: { min: 51, ideal: 59, max: 70 }, equityExpect: { min: 0.5, ideal: 0.75, max: 1.0 },
      interest: 0.8, availability: "immediate", nonCompeteRisk: "none",
      quote: "The office is dead. I'll prove it.",
      statBonus: { hr: 3, dev: 1 },
      cv: { 
        education: "MA Human Resource Management (Online), University of Liverpool (2021). BA International Business, University of Hertfordshire (2017).", 
        experience: ["People Operations Lead, Doist (2020-present) - Fully remote (100 employees, 35 countries). Built async frameworks. 95% satisfaction.", "Remote Work Consultant (2019-2020) - Advised 15+ companies on pandemic transition.", "HR Coordinator, Vodafone (2017-2019) - Traditional office HR. Hated it."], 
        achievements: "Built people practices for globally distributed team. Remote work guide with 8k downloads.",
        skills: "Remote tools, async communication, Notion, Slack workflows, distributed team management.",
        personality: "Passionate remote work advocate. Deep distributed teams expertise. May resist office culture. Perfect for remote-first." 
      }
    },
    { id: "h6", name: "Katya Sorokina", seniority: "junior", portrait: "ğŸ‘©ğŸ¼â€ğŸ’¼",
      background: "Fled Ukraine 2022. Westminster masters with distinction. Helping refugees find jobs at Red Cross.",
      origin: "Ukrainian Â· Settled status",
      strengths: ["People â†‘", "Potential â†‘â†‘"], weaknesses: ["Experience"],
      salaryExpect: { min: 25, ideal: 30, max: 36 }, equityExpect: { min: 0.12, ideal: 0.25, max: 0.38 },
      interest: 1.0, availability: "immediate", nonCompeteRisk: "none",
      quote: "I studied what makes teams work.",
      statBonus: { hr: 2, sci: 1 },
      cv: { 
        education: "MSc Organisational Psychology, University of Westminster (2023). Distinction. BSc Psychology, Taras Shevchenko National University Kyiv (2021). Fled Ukraine 2022.", 
        experience: ["HR Assistant, British Red Cross (2023-present) - Supporting refugee employment programme. 50+ interviews monthly.", "Research Assistant, Westminster (2022-2023) - Research on team dynamics.", "Psychology Intern, Kyiv consultancy (2020-2021)."], 
        achievements: "Distinction MSc. Research on psychological safety. Helped 80+ refugees find employment. Ukrainian/Russian/English.",
        skills: "Psychological assessment, research methods, SPSS, interview design, cross-cultural communication.",
        personality: "Academic background in team psychology. Limited commercial experience but strong analytical foundation. Highly motivated after difficult journey." 
      }
    },
    { id: "h7", name: "Marcus Chen", seniority: "junior", portrait: "ğŸ‘¨ğŸ»â€ğŸ’¼",
      background: "Nottingham Trent degree. Amazon warehouse, then Deliveroo ops, now pivoting to people. Systems-minded.",
      origin: "British-Chinese Â· Nottingham",
      strengths: ["People â†‘", "Systems â†‘â†‘"], weaknesses: ["HR depth"],
      salaryExpect: { min: 33, ideal: 40, max: 48 }, equityExpect: { min: 0.38, ideal: 0.5, max: 0.62 },
      interest: 0.9, availability: "immediate", nonCompeteRisk: "none",
      quote: "People ops is just good operations.",
      statBonus: { hr: 2, dev: 1 },
      cv: { 
        education: "BA Business Management, Nottingham Trent University (2019). Operations pathway.", 
        experience: ["Operations Manager, Zego insurance (2021-present) - Built ops for 5x growth. Pulled into people operations. Created onboarding reducing ramp time 30%.", "Operations Associate, Deliveroo (2019-2021) - Rider ops South London. Team of 12.", "Warehouse Supervisor, Amazon (2018-2019, seasonal) - Funded gap year."], 
        achievements: "Built ops systems for 5x growth. Created onboarding adopted company-wide. Managed 12-person team.",
        skills: "Process design, Notion, Airtable, onboarding systems, data analysis.",
        personality: "Operations mindset applied to people. Strong on systems. Still developing HR skills. Good ops-to-people bridge." 
      }
    },
    { id: "h8", name: "Blessing Adebayo", seniority: "junior", portrait: "ğŸ‘©ğŸ¿â€ğŸ’¼",
      background: "Middlesex University. Worked at Sports Direct warehouse while studying. Organised staff welfare committee. Natural people person.",
      origin: "British-Nigerian Â· North London",
      strengths: ["People â†‘", "Empathy â†‘â†‘"], weaknesses: ["HR technical skills"],
      salaryExpect: { min: 25, ideal: 30, max: 36 }, equityExpect: { min: 0.25, ideal: 0.38, max: 0.5 },
      interest: 0.95, availability: "immediate", nonCompeteRisk: "none",
      quote: "People told me their problems at the warehouse. I want to actually fix them now.",
      statBonus: { hr: 2, mkt: 1 },
      cv: { 
        education: "BA Human Resource Management, Middlesex University (2023). BTec Business at Barnet and Southgate College.", 
        experience: ["HR Administrator, Tottenham Hotspur FC (2023-present, temporary) - Processing new starter paperwork, supporting recruitment days.", "Warehouse Operative, Sports Direct (2019-2023) - Organised informal staff welfare committee. Helped colleagues with shift issues.", "Youth Worker volunteer, local church (2017-2019) - Mentored teenagers."], 
        achievements: "CIPD Level 3 in progress. Set up peer support at warehouse. Praised by Spurs HR manager for candidate experience improvements.",
        skills: "Onboarding, employee relations basics, empathy, conflict resolution, HRIS data entry.",
        personality: "Natural people person who colleagues confide in. Less technical HR knowledge but exceptional emotional intelligence. Will advocate fiercely for team welfare." 
      }
    }
  ]
};

// ===== COMPREHENSIVE UK/AI CHARACTER-VOICED EVENTS =====
// Each exec has 8 events matching their personality and UK AI context

const CHAR_EVENTS = {
  research: {
    // DR. FATIMA AL-RASHID - The Rigorous Scientist
    fatima: [
      {
        intro: "We have preliminary results on the protein binding work. They're promising, but I want to run three more validation experiments before we tell anyone.",
        aside: "I've seen careers destroyed by premature claims. Extraordinary claims require extraordinary evidence.",
        choices: [
          { text: "Run the full validation suite", reaction: "Thank you. This is how real science works.", emoji: "ğŸ˜Š", ap: 4, cost: 35, eff: { sci: 5, mkt: 1 }, mood: 2 },
          { text: "One more experiment, then share", reaction: "A compromise I can accept.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { sci: 4, dev: 1 }, mood: 0 },
          { text: "Data's good enough-move forward", reaction: "I want my concerns formally noted.", emoji: "ğŸ˜Ÿ", ap: 1, cost: 10, eff: { sci: 3, mkt: 4 }, mood: -2 }
        ]
      },
      {
        intro: "A Russell Group lab wants to co-supervise a PhD student with us. It requires commitment but builds academic credibility.",
        aside: "This student could become a future hire. The PI has excellent public health system connections.",
        choices: [
          { text: "Fully fund and integrate the PhD", reaction: "I'll ensure proper supervision.", emoji: "ğŸ˜Š", ap: 5, cost: 40, eff: { sci: 6, dev: 2 }, mood: 2 },
          { text: "Support with data and mentoring", reaction: "We can contribute without overcommitting.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { sci: 3, dev: 1 }, mood: 0 },
          { text: "Decline-stay focused internally", reaction: "Focus pays off. Internal projects advance.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "The MHRA-the UK's medicines regulator-has offered a pre-submission meeting about our regulatory pathway. This could shape our approach for years.",
        aside: "Getting regulatory clarity early saves years of mistakes. I've seen companies fail by not asking these questions.",
        choices: [
          { text: "Prepare extensively, send senior team", reaction: "I'll coordinate the dossier personally.", emoji: "ğŸ˜Š", ap: 4, cost: 20, eff: { sci: 3, dev: 2, mkt: 2 }, mood: 2 },
          { text: "Attend with standard materials", reaction: "We might leave questions unanswered.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { sci: 2, mkt: 1 }, mood: 0 },
          { text: "Postpone until we have more data", reaction: "Cautious approach pays off.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 2 }, mood: 0 }
        ]
      },
      {
        intro: "A UK rare disease charity wants to partner using their patient registry. Unique data, but complex governance.",
        aside: "Real patient data could differentiate our research. But these are vulnerable populations-we must do this right.",
        choices: [
          { text: "Build formal partnership with ethics board", reaction: "This is how biotech should work with patients.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { sci: 4, mkt: 2, hr: 2 }, mood: 2 },
          { text: "Accept limited data for pilot", reaction: "Test hypotheses without full governance.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 3, mkt: 1 }, mood: 0 },
          { text: "Decline-too complex now", reaction: "Stay lean. Avoid scope creep.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "UKRI has opened a relevant funding call. We could lead a bid with university partners-tight deadline though.",
        aside: "Government grants bring credibility and non-dilutive funding. The overhead is real, but so is the runway.",
        choices: [
          { text: "Lead a full bid with partners", reaction: "I know the process. Let me coordinate.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { sci: 3, mkt: 2, cash: 120 }, mood: 2 },
          { text: "Support a university-led bid", reaction: "Lower effort, shared credit.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 2, mkt: 1, cash: 60 }, mood: 0 },
          { text: "Skip this funding round", reaction: "Save energy for the right opportunity.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our research lead wants to publish a paper about our work. The product team thinks keeping our methods secret is what protects us from competitors. This disagreement needs resolving.",
        aside: "Publication builds credibility and helps recruiting. But there are legitimate IP concerns.",
        choices: [
          { text: "Publish with clear IP boundaries", reaction: "We can protect what matters while contributing.", emoji: "ğŸ˜Š", ap: 4, cost: 20, eff: { sci: 4, mkt: 2 }, mood: 2 },
          { text: "Internal report only", reaction: "We document but miss external signal.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { sci: 2, dev: 1 }, mood: 0 },
          { text: "Pause publication-ship first", reaction: "Product focus keeps us competitive.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 2 }, mood: 0 }
        ]
      },
      {
        intro: "A government AI safety roundtable invites us to present concrete failures and mitigations.",
        aside: "Showing vulnerability builds trust. We'd be 'the ones who brought evidence' rather than polished spin.",
        choices: [
          { text: "Bring real red-team data", reaction: "This builds trust with regulators.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { sci: 3, mkt: 2 }, mood: 2 },
          { text: "Share polished talking points", reaction: "Safe, but we earn little.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { mkt: 1 }, mood: 0 },
          { text: "Submit written response only", reaction: "Our position is on record. Efficient approach.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A London biomedical campus invites us to their seminar series on AI in molecular design.",
        aside: "Regular presence builds relationships. We'd become 'the AI people' on campus.",
        choices: [
          { text: "Commit to regular slot, co-organise", reaction: "We'll get early sight of interesting projects.", emoji: "ğŸ˜Š", ap: 4, cost: 20, eff: { sci: 3, dev: 1, mkt: 1 }, mood: 2 },
          { text: "Give a one-off flagship talk", reaction: "Impact without ongoing commitment.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2, mkt: 1 }, mood: 0 },
          { text: "Decline-no bandwidth", reaction: "Focus on priorities. Team stays productive.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We've made a genuine breakthrough. Now we face a choice: file for a patent to protect it, or publish in a top journal for academic credibility. The catch is timing-once we publish, we lose the right to patent in most countries. But the patent process is slow and expensive.",
        aside: "Patents give us 20 years of exclusive rights to commercialise. Publications give us citations and reputation. In an ideal world we'd do both, but the clock is ticking.",
        choices: [
          { text: "File the patent first, then publish", reaction: "Smart. We protect the commercial value and still get the paper.", emoji: "ğŸ˜Š", ap: 4, cost: 40, eff: { sci: 4, mkt: 3, dev: 2 }, mood: 2 },
          { text: "Publish quickly for academic impact", reaction: "The citations will come. But competitors can now use this freely.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 5, mkt: 1 }, mood: 1 },
          { text: "Keep it as a trade secret for now", reaction: "Protect our edge. Competitors stay guessing.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our patent lawyer has flagged a problem: a large tech company holds patents that might cover techniques we're using. We need to do a 'freedom to operate' analysis-basically checking whether our product might infringe their patents. It's expensive but could save us from a lawsuit later.",
        aside: "Patent disputes can destroy startups. Big companies sometimes use patent threats to eliminate competitors or force acquisitions at low prices. Better to know where we stand.",
        choices: [
          { text: "Full freedom-to-operate analysis", reaction: "Expensive but we'll sleep better. And investors will want to see this.", emoji: "ğŸ˜Š", ap: 3, cost: 45, eff: { sci: 2, mkt: 2, dev: 1 }, mood: 2 },
          { text: "Quick review of the obvious risks", reaction: "Covers the basics. Some uncertainty remains.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { sci: 1, mkt: 1 }, mood: 0 },
          { text: "Proceed and deal with issues if they arise", reaction: "Move fast, stay agile.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A university where one of our team used to work is claiming they own some of our intellectual property. They say the early research was done using their facilities and funding, so they have rights to it. Our lawyer thinks we have a strong case, but fighting it will be costly and distracting.",
        aside: "IP ownership disputes are common when founders come from academia. Most universities have policies about what they own, but the boundaries can be fuzzy.",
        choices: [
          { text: "Negotiate a licence agreement", reaction: "Pay them something reasonable and move on. Business is about picking battles.", emoji: "ğŸ˜Š", ap: 2, cost: 25, eff: { sci: 3, mkt: 2 }, mood: 1 },
          { text: "Fight it-we're in the right", reaction: "Could take years, but winning establishes precedent and reputation.", emoji: "ğŸ™‚", ap: 3, cost: 45, eff: { sci: 4, mkt: 3 }, mood: 1 },
          { text: "Redesign around the disputed IP", reaction: "Painful but builds something entirely new that's unquestionably ours.", emoji: "ğŸ™‚", ap: 2, cost: 30, eff: { dev: 4, sci: 1 }, mood: 1 }
        ]
      },
      {
        intro: "Our patent attorney has sent the bill for filing our first patent application in the UK. Now comes the hard part: where else do we file? Each country costs Â£15,000-30,000 in legal fees alone, plus translation costs. The US is essential for fundraising, the EU covers multiple countries in one filing, but China and Japan are where manufacturing happens.",
        aside: "Patents are territorial-a UK patent only protects you in the UK. Missing a key market means competitors can copy you there freely. But filing everywhere is ruinously expensive for a startup.",
        choices: [
          { text: "File in UK, US, EU, China, and Japan", reaction: "Maximum protection. Expensive but we're covered globally.", emoji: "ğŸ˜Š", ap: 3, cost: 50, eff: { sci: 5, mkt: 4 }, mood: 2 },
          { text: "File in UK, US, and EU only", reaction: "Covers our main markets. We accept some risk in Asia.", emoji: "ğŸ™‚", ap: 2, cost: 35, eff: { sci: 3, mkt: 3 }, mood: 1 },
          { text: "Just UK and US for now", reaction: "Minimal viable protection. We can't afford more right now.", emoji: "ğŸ˜", ap: 1, cost: 20, eff: { sci: 2, mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Writing patent claims is an art form. Our scientists understand the technology best, but patent attorneys know how to write claims that will survive legal challenges. The attorney wants Â£25,000 to draft the application properly. Our Head of Research thinks she could write a first draft herself to save money.",
        aside: "Badly written patents are worse than no patents-they can be easily invalidated or designed around. But good patent attorneys are expensive, and they still need our scientists to explain the technology.",
        choices: [
          { text: "Let the attorney draft from scratch", reaction: "Expensive but professional. The claims will be bulletproof.", emoji: "ğŸ˜Š", ap: 2, cost: 35, eff: { sci: 3, mkt: 2 }, mood: 2 },
          { text: "Scientists draft, attorney reviews and refines", reaction: "Good balance. Broader claims and our team learns the process.", emoji: "ğŸ™‚", ap: 4, cost: 25, eff: { sci: 4, mkt: 2, hr: 1 }, mood: 1 },
          { text: "Scientists write it, minimal attorney input", reaction: "Risky. The examiner may tear it apart, or competitors will find loopholes.", emoji: "ğŸ˜", ap: 1, cost: 15, eff: { sci: 1, mkt: 1 }, mood: -1 }
        ]
      },
      {
        intro: "The patent examiner has rejected our application. They've found 'prior art'-earlier publications that they say make our invention obvious. Our attorney thinks we can argue our way through by narrowing the claims, but that means our patent will protect less. Alternatively, we can provide new experimental data showing our invention is genuinely different.",
        aside: "Patent prosecution is a negotiation. Most applications get rejected initially-it's how you respond that matters. Narrow claims are easier to get granted but easier for competitors to design around.",
        choices: [
          { text: "Fight back with new experimental data", reaction: "More work, but we might keep our broad claims. Worth trying.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { sci: 4, mkt: 3 }, mood: 2 },
          { text: "Narrow the claims as the examiner suggests", reaction: "We get a granted patent, but it protects less territory.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 2, mkt: 1 }, mood: 0 },
          { text: "Abandon and file improved application", reaction: "Start fresh with better claims. Costs time but stronger long-term.", emoji: "ğŸ˜", ap: 3, cost: 25, eff: { sci: 2, mkt: 1, cash: -20 }, mood: 0 }
        ]
      },
      {
        intro: "Our first patent is about to be granted-three years after we filed it. Our attorney is now asking about 'continuation' applications. These let us file new patents based on our original discovery, covering variations and improvements we've developed since. Each continuation costs money, but they extend our protection and can be valuable if someone tries to design around our first patent.",
        aside: "Biotech companies often build 'patent families' with dozens of related patents covering the same core invention from different angles. It's expensive but creates a defensive thicket.",
        choices: [
          { text: "File multiple continuation applications", reaction: "Build a proper patent family. Harder for competitors to work around us.", emoji: "ğŸ˜Š", ap: 3, cost: 40, eff: { sci: 3, mkt: 3, cash: -35 }, mood: 2 },
          { text: "File one continuation covering key improvements", reaction: "Balanced approach. Some additional protection without breaking the bank.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { sci: 2, mkt: 1, cash: -15 }, mood: 1 },
          { text: "Just keep the original patent", reaction: "Core protection maintained. Save resources.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { sci: 1, cash: 10 }, mood: 0 }
        ]
      },
      {
        intro: "We've spotted a competitor's product that looks suspiciously similar to our patented technology. Proving infringement in biotech is hard-you can't just look at their product, you need to analyse it scientifically. Our attorney estimates Â£50,000 to investigate properly, and litigation would cost ten times that.",
        aside: "Patent enforcement is where things get really expensive. Big pharma companies have legal teams on staff. Startups often can't afford to enforce their patents even when they're clearly being infringed.",
        choices: [
          { text: "Investigate and send a cease-and-desist letter", reaction: "Find out what they're doing first. A letter might be enough to scare them.", emoji: "ğŸ˜Š", ap: 3, cost: 35, eff: { sci: 2, mkt: 2, cash: -30 }, mood: 1 },
          { text: "Approach them about licensing", reaction: "Turn a threat into revenue. They might prefer to pay than fight.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 1, mkt: 2, cash: 40 }, mood: 2 },
          { text: "Monitor but don't act yet", reaction: "Gather intelligence. Strike when ready.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1, sci: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our granted patents require annual maintenance fees to stay in force-and those fees increase over time. This year it's Â£5,000 across all our patents. By year ten, it'll be Â£20,000 per year. Our accountant is asking whether we really need to maintain all of them, or whether some have become less strategically important.",
        aside: "Companies sometimes let patents lapse when they're no longer commercially relevant. But once you stop paying, the invention becomes public domain and anyone can use it.",
        choices: [
          { text: "Maintain all patents-they're all valuable", reaction: "Maximum protection. The cost is worth the security.", emoji: "ğŸ˜Š", ap: 1, cost: 15, eff: { sci: 2, mkt: 1 }, mood: 2 },
          { text: "Review and drop the weakest ones", reaction: "Rational approach. Focus resources on our crown jewels.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 1, mkt: 1 }, mood: 1 },
          { text: "Minimal portfolio-keep only essentials", reaction: "Lean approach. Saves money for product.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1, cash: 15 }, mood: 0 }
        ]
      },
      {
        intro: "Testing reveals our AI model is less accurate for some patient populations-it works well for groups heavily represented in our training data, less well for others. This isn't unusual; it's a known challenge in medical AI. Fixing it requires more diverse data, which means more time and partnerships. But the populations it works well for still need help now.",
        aside: "Perfect fairness in AI is often impossible-you're trading off accuracy for different groups. Waiting for perfection means no one gets helped. Launching with known gaps means some get helped more than others. Both positions have ethical weight.",
        choices: [
          { text: "Delay until we can reduce the gap significantly", reaction: "Higher standard. Takes longer. Some patients wait who didn't need to.", emoji: "ğŸ˜Š", ap: 5, cost: 45, eff: { sci: 4, mkt: -1, hr: 1 }, mood: 3 },
          { text: "Launch with clear scope-only for populations where it's validated", reaction: "Honest about limitations. Narrower impact. Some feel excluded.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { sci: 2, mkt: 2 }, mood: 1 },
          { text: "Launch broadly with warnings and monitoring", reaction: "Helps more people sooner. Risk of harm if warnings ignored.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: 1, mkt: 3 }, mood: -2 }
        ]
      },
      {
        intro: "Training our AI models uses enormous amounts of electricity-and that means carbon emissions. Our latest model took three months of continuous computing, equivalent to several transatlantic flights. We could use renewable-powered data centres, but they're 40% more expensive.",
        aside: "The environmental cost of AI is becoming a real concern. Some researchers now include carbon footprint in their papers. Being sustainable costs more but aligns with our values.",
        choices: [
          { text: "Move to renewable-powered computing", reaction: "Higher costs but we can look our grandchildren in the eye.", emoji: "ğŸ˜Š", ap: 3, cost: 40, eff: { sci: 2, mkt: 2, hr: 1 }, mood: 2 },
          { text: "Buy carbon offsets for our computing", reaction: "Imperfect solution but better than nothing.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { sci: 1, mkt: 1 }, mood: 1 },
          { text: "Focus on efficiency, not where power comes from", reaction: "Pragmatic. Keeps costs down.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { dev: 1, cash: 10 }, mood: 0 }
        ]
      },
      {
        intro: "We need patient data to train our medical AI. A hospital is offering access to thousands of records, but the consent forms patients signed years ago didn't specifically mention AI. Legally it might be covered, but ethically it's a grey area. Patients didn't know their data would train algorithms.",
        aside: "Data consent is evolving faster than the forms people signed. What was acceptable five years ago may not meet today's ethical standards. Being conservative protects patients and our reputation.",
        choices: [
          { text: "Only use data with explicit AI consent", reaction: "Higher standards than required. Patients trust matters.", emoji: "ğŸ˜Š", ap: 4, cost: 35, eff: { sci: 2, mkt: 2, hr: 1 }, mood: 2 },
          { text: "Use it but anonymise more aggressively", reaction: "Extra precautions reduce risk. Not perfect but defensible.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { sci: 3, mkt: 1 }, mood: 1 },
          { text: "Legal says it's fine-proceed", reaction: "I'm uncomfortable. Noting my objection.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: 4, mkt: 1 }, mood: -2 }
        ]
      },
      {
        intro: "Our research findings could be used for good or harm. The same technology that helps doctors could help bad actors. Some researchers are calling for us to restrict access to our methods, but that goes against the open science principles we've always championed.",
        aside: "Dual-use research is a genuine dilemma. Openness accelerates progress but also accelerates misuse. There's no perfect answer, only trade-offs.",
        choices: [
          { text: "Restricted access with vetting process", reaction: "Slows legitimate researchers but limits bad actors.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { sci: 2, mkt: 1 }, mood: 1 },
          { text: "Open access with usage monitoring", reaction: "Stay open but watch for misuse. Hard to enforce.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { sci: 3, mkt: 1 }, mood: 1 },
          { text: "Fully open-knowledge should be free", reaction: "Community embraces us. Reputation builds.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { sci: 4, mkt: 1 }, mood: 1 }
        ]
      },
      {
        intro: "Our AI sometimes gives answers that sound confident but are completely wrong-it essentially makes things up. We can make it more cautious and say 'I'm not sure' more often, but that also makes it less useful. Users want direct answers; constant hedging frustrates them.",
        aside: "There's a fundamental trade-off between confidence and accuracy. An AI that always hedges is useless. An AI that confidently invents things is dangerous. The right balance depends on what it's being used for.",
        choices: [
          { text: "Prioritise accuracy-flag uncertainty clearly", reaction: "Safer outputs. Some users find it annoying.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { sci: 3, mkt: 1 }, mood: 2 },
          { text: "Let users choose how cautious it should be", reaction: "Flexibility but complexity. Most won't understand the setting.", emoji: "ğŸ™‚", ap: 3, cost: 30, eff: { sci: 2, mkt: 2 }, mood: 1 },
          { text: "Optimise for what users like", reaction: "They prefer confident answers. Hope they check important ones.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: 1, mkt: 3 }, mood: -1 }
        ]
      },
      {
        intro: "We've developed a capability that's genuinely impressive-and potentially dangerous. It could be used to generate convincing misinformation at scale. Some team members want to publish to advance the science; others think we should keep it quiet or at least delay until we understand the risks better.",
        aside: "There's a heated debate about when to publish powerful AI capabilities. Some say openness lets everyone study risks. Others say publishing before defences exist is reckless. There's no consensus in the field.",
        choices: [
          { text: "Delay publication until we develop safeguards", reaction: "Responsible but others might discover it independently.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { sci: 1, mkt: 2, hr: 1 }, mood: 2 },
          { text: "Publish with a detailed risks section", reaction: "Advance the science, flag the dangers. Some will ignore warnings.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { sci: 4, mkt: 1 }, mood: 1 },
          { text: "Publish normally-others will find this anyway", reaction: "Science advances. We're not the last line of defence.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: 5, mkt: 0 }, mood: -1 }
        ]
      },
      {
        intro: "A researcher wants to join our team from a major AI lab. She's brilliant, but she's also a prominent voice arguing that AI systems like ours might pose existential risks to humanity. Hiring her would bring credibility and talent, but also internal debate about whether we should be building what we're building.",
        aside: "The AI safety community ranges from 'slow down everything' to 'accelerate carefully'. Having internal critics can improve your work or paralyse it. Intellectual diversity is valuable until it becomes gridlock.",
        choices: [
          { text: "Hire her-we need that perspective", reaction: "Healthy challenge. Some uncomfortable conversations ahead.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { sci: 4, hr: 1 }, mood: 2 },
          { text: "Hire but keep her focused on safety research", reaction: "Channel her concerns productively. She might feel siloed.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { sci: 3, hr: 0 }, mood: 1 },
          { text: "Pass-we need believers, not sceptics", reaction: "Focus on aligned partners. Better fit ahead.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our AI makes predictions that affect people's lives-loan decisions, medical diagnoses, hiring recommendations. Users want to know why the AI decided what it did, but our system is so complex that even we can't fully explain individual decisions. We can add features that give plausible-sounding reasons, but they're simplified approximations, not the real answer.",
        aside: "Being able to explain AI decisions is a genuine hard problem. Simple explanations of complex systems are necessarily incomplete. But 'the computer said so' isn't acceptable when the decision affects someone's life. Nobody's really solved this yet.",
        choices: [
          { text: "Invest heavily in making decisions explainable", reaction: "Hard problem. Might slow us down significantly.", emoji: "ğŸ˜Š", ap: 5, cost: 45, eff: { sci: 4, mkt: 2, hr: 1 }, mood: 2 },
          { text: "Add simplified explanations with clear caveats", reaction: "Better than nothing. Users might trust them too much.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { sci: 2, mkt: 3 }, mood: 1 },
          { text: "Focus on accuracy-explanations are secondary", reaction: "Right answers matter more than explaining wrong ones. Some disagree.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: 3, mkt: 1 }, mood: -1 }
        ]
      }
    ],
    
    // DR. YUKI TANAKA - The Collaborator
    yuki: [
      {
        intro: "Collaborators in Tokyo and Singapore are interested in a joint publication. We share credit but gain their datasets.",
        aside: "Science advances faster together. Their data would strengthen our claims significantly.",
        choices: [
          { text: "Pursue international collaboration", reaction: "Wonderful. I'll arrange calls this week.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { sci: 5, mkt: 2 }, mood: 2 },
          { text: "Share data, keep publication separate", reaction: "That's not how collaboration works. But I'll try.", emoji: "ğŸ˜•", ap: 3, cost: 20, eff: { sci: 3, mkt: 1 }, mood: -1 },
          { text: "Keep research internal", reaction: "We're losing an opportunity.", emoji: "ğŸ˜”", ap: 1, cost: 0, eff: { sci: 2, dev: 2 }, mood: -2 }
        ]
      },
      {
        intro: "A university in Seoul has complementary techniques. They propose a technology exchange programme.",
        aside: "Their approach could solve problems we're stuck on. And they want to learn from us too.",
        choices: [
          { text: "Establish formal exchange programme", reaction: "This is how science should work.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { sci: 5, dev: 2 }, mood: 2 },
          { text: "Share methods informally", reaction: "Less structured, but we'll learn.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 3, dev: 1 }, mood: 1 },
          { text: "Protect our techniques", reaction: "We're slowing ourselves down.", emoji: "ğŸ˜•", ap: 1, cost: 0, eff: { sci: 2, dev: 2 }, mood: -2 }
        ]
      },
      {
        intro: "The Alan Turing Institute invites us to join a responsible AI consortium. Prestigious but requires commitment.",
        aside: "Access to top UK researchers and a seat at important tables. These connections last decades.",
        choices: [
          { text: "Become full industry partner", reaction: "We gain access to the best minds in UK AI.", emoji: "ğŸ˜Š", ap: 5, cost: 40, eff: { sci: 4, mkt: 2, hr: 1 }, mood: 2 },
          { text: "Join as associate, limited commitment", reaction: "We're in the room, if not always central.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { sci: 2, mkt: 1 }, mood: 0 },
          { text: "Decline-focus resources elsewhere", reaction: "Prioritise wisely. Team stays focused.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A European research consortium invites us to their Horizon grant application. Obligations, but substantial funding.",
        aside: "Consortium work is slow but opens doors across Europe. The funding is significant.",
        choices: [
          { text: "Join as full partner, lead work package", reaction: "This establishes us as serious European players.", emoji: "ğŸ˜Š", ap: 4, cost: 20, eff: { sci: 4, mkt: 2, cash: 80 }, mood: 2 },
          { text: "Join as junior partner", reaction: "Less visibility, but valuable connections.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2, mkt: 1, cash: 40 }, mood: 0 },
          { text: "Decline-too many strings", reaction: "Stay independent. Full control preserved.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A visiting professor from Imperial wants a sabbatical with us. Brilliant, but needs significant support.",
        aside: "Having her here would raise our profile and teach us new approaches.",
        choices: [
          { text: "Host with dedicated resources", reaction: "This will elevate everyone's work.", emoji: "ğŸ˜Š", ap: 4, cost: 35, eff: { sci: 5, hr: 1 }, mood: 2 },
          { text: "Welcome with limited support", reaction: "She's resourceful. She'll manage.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: 3 }, mood: 0 },
          { text: "Suggest another time", reaction: "Relationship maintained. Door stays open.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We've been invited to a workshop bridging UK and Asian research networks. Relationship-building, not immediate results.",
        aside: "These connections pay off over years, not quarters. But they do pay off.",
        choices: [
          { text: "Send team, host dinner afterwards", reaction: "Relationship-building at its best.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 2, mkt: 3 }, mood: 2 },
          { text: "Present virtually to save costs", reaction: "Present but won't build same connections.", emoji: "ğŸ˜", ap: 1, cost: 5, eff: { sci: 1, mkt: 1 }, mood: 0 },
          { text: "Send apologies-too busy", reaction: "Focus on what matters. They understand.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A UK university proposes a Knowledge Transfer Partnership placing an associate with us.",
        aside: "KTPs bridge academia and industry. Government subsidises the salary.",
        choices: [
          { text: "Co-fund a strategic KTP project", reaction: "Perfect bridge into academic networks.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { sci: 3, dev: 2, mkt: 1 }, mood: 2 },
          { text: "Support with minimal budget", reaction: "Light bridge with limited commitment.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2 }, mood: 0 },
          { text: "Decline-avoid complexity", reaction: "Keep things simple. Focus pays off.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A data-sharing MoU with a UK university would give us access to valuable clinical datasets.",
        aside: "Proper governance takes time but builds lasting partnerships. Their data is unique.",
        choices: [
          { text: "Negotiate rigorous privacy-first MoU", reaction: "Access without terrifying our lawyers.", emoji: "ğŸ˜Š", ap: 4, cost: 15, eff: { sci: 3, dev: 1, hr: 1 }, mood: 2 },
          { text: "Agree narrow pilot-scale MoU", reaction: "Test the relationship first.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2 }, mood: 0 },
          { text: "Use public data only", reaction: "Safe and compliant. No regulatory risk.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 1, hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We've been invited to present at a major AI conference. The audience will include potential customers, investors, and collaborators-but also competitors. How much do we reveal? A vague talk won't impress anyone, but a detailed one hands our methods to rivals.",
        aside: "Conferences are where reputations are made. But I've seen companies give away their secrets on stage and regret it within months.",
        choices: [
          { text: "Present high-level vision, keep details private", reaction: "Safe but forgettable. We won't stand out.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: 1, mkt: 2 }, mood: 0 },
          { text: "Share enough to impress, hold back key insights", reaction: "The art of strategic disclosure. Takes careful preparation.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { sci: 3, mkt: 3 }, mood: 2 },
          { text: "Be completely open-transparency builds trust", reaction: "Bold. Competitors take notes, but so do future partners.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 4, mkt: 2, dev: -1 }, mood: 1 }
        ]
      },
      {
        intro: "A PhD student at a partner university has made a breakthrough using our data. She wants to publish immediately. The problem is, her paper would reveal techniques we haven't patented yet-and once it's public, we lose the right to patent in most countries.",
        aside: "Academic incentives favour fast publication. Commercial incentives favour controlled disclosure. These worlds don't always align.",
        choices: [
          { text: "Ask her to delay while we file patents", reaction: "She won't be happy-publication timing matters for her career. But we protect ourselves.", emoji: "ğŸ™‚", ap: 2, cost: 25, eff: { sci: 3, mkt: 2 }, mood: 1 },
          { text: "Let her publish, accept the loss of patent rights", reaction: "Good for the relationship. Great for credibility.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { sci: 4, mkt: 2 }, mood: 1 },
          { text: "Collaborate on a joint filing before publication", reaction: "Complex but everyone wins. Takes coordination.", emoji: "ğŸ˜Š", ap: 3, cost: 35, eff: { sci: 5, mkt: 4 }, mood: 2 }
        ]
      },
      {
        intro: "Our approach to a key problem is genuinely novel, and we're not sure whether to patent it or keep it secret. Patents give us 20 years of protection, but require publishing exactly how it works. Trade secrets last forever-unless someone figures it out or an employee leaks it.",
        aside: "The choice depends on whether competitors could reverse-engineer our innovation. If they can work it out by studying our product, a trade secret is worthless. If it's truly hidden in our process, secrecy might be better.",
        choices: [
          { text: "Patent it-we need enforceable rights", reaction: "Competitors will read our patent, but they can't legally use it for 20 years.", emoji: "ğŸ˜Š", ap: 3, cost: 30, eff: { sci: 4, mkt: 3 }, mood: 2 },
          { text: "Keep it as a trade secret", reaction: "Hidden forever, or until someone reverse-engineers it or talks.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { sci: 2, mkt: 1 }, mood: 1 },
          { text: "File a patent but keep the best bits as trade secrets", reaction: "Hybrid approach. Patent the architecture, hide the special sauce.", emoji: "ğŸ˜Š", ap: 3, cost: 35, eff: { sci: 5, mkt: 3 }, mood: 2 }
        ]
      },
      {
        intro: "A journalist from a major tech publication wants to write a feature about our technology. Great exposure, but she's asking detailed questions about how our system works. Our PR advisor says be open; our CTO says we're giving away competitive intelligence.",
        aside: "Press coverage can be transformative for a startup. But journalists want interesting details, and interesting details are often exactly what competitors want to know.",
        choices: [
          { text: "Be open-good press is worth more than secrecy", reaction: "Great article. Competitors read it too, but so do thousands of potential customers.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { sci: 1, mkt: 5, dev: -1 }, mood: 2 },
          { text: "Carefully stage-manage what we reveal", reaction: "She might write a less enthusiastic piece, but we control the narrative.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { sci: 0, mkt: 3 }, mood: 1 },
          { text: "Decline the interview", reaction: "Protect our secrets. Stay mysterious.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We're considering posting a preprint of our research before formal peer review. It would establish priority-proving we had the idea first-but it also means competitors see our work months before we've published in a proper journal. They could scoop our follow-up research.",
        aside: "Preprints have become standard in AI research. Move too slowly and someone else publishes first. Move too fast and you give away your roadmap.",
        choices: [
          { text: "Post the preprint immediately", reaction: "Establish priority. Competitors see it, but so does everyone else.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 4, mkt: 2 }, mood: 2 },
          { text: "Wait for peer review and formal publication", reaction: "More prestigious, but someone might publish similar work first.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 3, mkt: 1 }, mood: 1 },
          { text: "Post a limited version, hold back key details", reaction: "Claim priority without revealing everything. Some call this bad form.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { sci: 2, mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We're collaborating with researchers at a university whose government restricts academic freedom and surveils its own citizens. The scientists themselves are brilliant and share our values-some are quietly pushing for reform from within. But our partnership gives prestige to an institution that's part of the state apparatus.",
        aside: "The 'engage or isolate' debate has no easy answers. Cutting ties abandons reformers inside the system. Continuing means being used for legitimacy. Different team members see this genuinely differently based on their own backgrounds and values.",
        choices: [
          { text: "Continue-support the reformers inside", reaction: "Engagement over isolation. We trust our collaborators' judgment about their own situation.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 4, mkt: -1, hr: -1 }, mood: 1 },
          { text: "Personal ties only, no institutional branding", reaction: "Work with individuals, avoid legitimising institutions. Complicated in practice.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: 3, mkt: 0 }, mood: 0 },
          { text: "Pause until conditions improve", reaction: "Principled but may never resume. Our collaborators understand but are disappointed.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: -1, mkt: 1, hr: 1 }, mood: 1 }
        ]
      },
      {
        intro: "A wealthy donor wants to fund our research, but they made their money in an industry we find ethically questionable. Their name would be on our lab. Some team members are strongly opposed; others say money is money and we can do good work with it.",
        aside: "Research funding always has strings-sometimes visible, sometimes not. Whose money we accept shapes how we're perceived and who wants to work with us.",
        choices: [
          { text: "Accept the funding with thanks", reaction: "We can do important work. People will forget the source.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { sci: 4, hr: -1, cash: 80 }, mood: 0 },
          { text: "Accept but don't use their name", reaction: "Take the money, limit the association. Awkward conversation ahead.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { sci: 3, cash: 60 }, mood: 0 },
          { text: "Decline and seek other funding", reaction: "Principled but painful. The team respects this.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 1, hr: 2, mkt: 1 }, mood: 2 }
        ]
      },
      {
        intro: "Flying to conferences burns enormous carbon. Our team attends a dozen international conferences a year. We could switch to virtual attendance for most events, but networking happens in hallways and over dinners-not on video calls.",
        aside: "Academic careers are built on in-person connections. But the climate cost of constant flying is hard to ignore. Some conferences now offer hybrid options.",
        choices: [
          { text: "Limit to two in-person conferences per year", reaction: "Significant cut. We'll miss some opportunities but set an example.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: -1, hr: 1, mkt: 1 }, mood: 2 },
          { text: "Virtual when possible, fly when essential", reaction: "Case-by-case. More complicated but flexible.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 2, mkt: 1 }, mood: 1 },
          { text: "Attend everything-careers depend on it", reaction: "Networking matters. The planet will have to wait.", emoji: "ğŸ˜", ap: 2, cost: 25, eff: { sci: 4, mkt: 2 }, mood: -1 }
        ]
      }
    ],
    
    kwame: [
      {
        intro: "The results aren't just good-they're potentially breakthrough territory. I want to pivot half the team onto this immediately.",
        aside: "Yes, it's risky. But this is why we started this company, isn't it?",
        choices: [
          { text: "Go all-in on the breakthrough", reaction: "Now we're talking. Let's make history.", emoji: "ğŸ”¥", ap: 4, cost: 45, eff: { sci: 8, mkt: 3 }, mood: 3 },
          { text: "Dedicated team, keep other work going", reaction: "Half measures. But it's a start.", emoji: "ğŸ™‚", ap: 3, cost: 30, eff: { sci: 5, dev: 2 }, mood: 1 },
          { text: "Stick to the current roadmap", reaction: "We'll look back at this with regret.", emoji: "ğŸ˜¤", ap: 1, cost: 0, eff: { sci: 2, dev: 2 }, mood: -2 }
        ]
      },
      {
        intro: "There's a top-tier science journal paper opportunity. We'd need to drop everything for six weeks, but if we land it...",
        aside: "A top journal paper changes everything. Hiring, funding, credibility-transformed overnight.",
        choices: [
          { text: "All hands on Nature submission", reaction: "This is what we came here to do!", emoji: "ğŸ”¥", ap: 4, cost: 40, eff: { sci: 9, mkt: 5 }, mood: 3 },
          { text: "Try without stopping other work", reaction: "We might not make it, but we'll try.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { sci: 5, mkt: 2 }, mood: 1 },
          { text: "Target more achievable journal", reaction: "Playing it safe. I don't like it.", emoji: "ğŸ˜¤", ap: 1, cost: 15, eff: { sci: 2, mkt: 1 }, mood: -1 }
        ]
      },
      {
        intro: "I've identified a completely new research direction. Tangential to our core, but could be massive if I'm right.",
        aside: "The biggest discoveries come from following intuition. Let me explore this.",
        choices: [
          { text: "Fund the moonshot exploration", reaction: "You won't regret this. I can feel it.", emoji: "ğŸ”¥", ap: 4, cost: 50, eff: { sci: 7, mkt: 2 }, mood: 3 },
          { text: "Limited budget for initial exploration", reaction: "I'll prove the concept, then we talk.", emoji: "ğŸ™‚", ap: 2, cost: 25, eff: { sci: 4, dev: 1 }, mood: 1 },
          { text: "Focus on current direction", reaction: "Killing the future to serve the present.", emoji: "ğŸ˜¤", ap: 1, cost: 0, eff: { sci: 1, dev: 2 }, mood: -2 }
        ]
      },
      {
        intro: "CortexAI just published in our space. We could respond with our findings now, or wait until more complete.",
        aside: "First mover advantage is real. We need to be in this conversation NOW.",
        choices: [
          { text: "Fast-track our publication to respond", reaction: "Let's show them what we've got.", emoji: "ğŸ”¥", ap: 4, cost: 30, eff: { sci: 5, mkt: 4, hr: -1 }, mood: 2 },
          { text: "Position as complementary, take time", reaction: "We'll be seen as second. But okay.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: 3, mkt: 2 }, mood: 0 },
          { text: "Ignore them, our timeline", reaction: "Stay focused on our plan. Execute well.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A major conference talk opportunity. They want me to present our vision for AI in healthcare.",
        aside: "The world should know what we're building. And the recruiting benefits alone...",
        choices: [
          { text: "Prepare inspiring, ambitious talk", reaction: "I'll make them believe in our mission.", emoji: "ğŸ”¥", ap: 4, cost: 20, eff: { sci: 2, mkt: 5, hr: 2 }, mood: 2 },
          { text: "Give solid, grounded presentation", reaction: "Safe choice. Won't change many minds.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: 1, mkt: 3 }, mood: 0 },
          { text: "Decline-too much going on", reaction: "Prioritise well. Team stays effective.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A senior researcher at CortexAI is interested in joining. Expensive but exceptional.",
        aside: "One hire can transform a research team. She's that calibre.",
        choices: [
          { text: "Make aggressive offer with equity", reaction: "Our credibility jumps overnight.", emoji: "ğŸ”¥", ap: 4, cost: 30, eff: { sci: 5, mkt: 2, equity: -1 }, mood: 2 },
          { text: "Offer consulting arrangement first", reaction: "Part-time advice. Full commitment uncertain.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: 2, mkt: 1 }, mood: 0 },
          { text: "Pass-can't compete on comp", reaction: "Stay disciplined on costs. Find better fits.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "AI Research Summit has sponsorship slots. Expensive but visible to the entire AI research community.",
        aside: "Our logo everywhere. Strong candidates approach us directly. This is how you build a research brand.",
        choices: [
          { text: "Gold sponsor with recruiting booth", reaction: "Time to make some noise.", emoji: "ğŸ”¥", ap: 2, cost: 50, eff: { sci: 2, mkt: 3, hr: 2 }, mood: 2 },
          { text: "Silver sponsor, lower profile", reaction: "Visible without breaking the bank.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { sci: 1, mkt: 2 }, mood: 0 },
          { text: "Just attend, no sponsorship", reaction: "Learn and network. Low-cost presence.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { sci: 2 }, mood: 0 }
        ]
      },
      {
        intro: "We could open-source a useful internal tool. Builds community but competitors benefit too.",
        aside: "Open source builds reputation and attracts talent. The best people want to work in the open.",
        choices: [
          { text: "Open source with community engagement", reaction: "CodeRepo stars and useful PRs incoming.", emoji: "ğŸ”¥", ap: 4, cost: 15, eff: { sci: 3, mkt: 3, dev: 1 }, mood: 2 },
          { text: "Release read-only, no support", reaction: "Visible without maintenance burden.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { sci: 2, mkt: 1 }, mood: 0 },
          { text: "Keep it proprietary", reaction: "Competitive edge preserved.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 2 }, mood: 0 }
        ]
      },
      {
        intro: "I want to release our training dataset publicly. It would establish us as leaders, attract researchers to work with us, and accelerate the whole field. Our commercial team is horrified-the data took years to collect and is our key competitive advantage.",
        aside: "Open data attracts talent and citations. Proprietary data attracts revenue. The AI community increasingly expects openness, but investors expect defensible advantages.",
        choices: [
          { text: "Release the full dataset openly", reaction: "The community celebrates. We become the reference point.", emoji: "ğŸ”¥", ap: 3, cost: 20, eff: { sci: 7, mkt: 5, hr: 2 }, mood: 3 },
          { text: "Release a subset, keep the best parts private", reaction: "Goodwill without giving away the crown jewels.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 4, mkt: 3, hr: 1 }, mood: 1 },
          { text: "Keep it proprietary-it's our moat", reaction: "Defensible business. But we won't be the community's darling.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { sci: 1, mkt: 1, dev: 2 }, mood: -1 }
        ]
      },
      {
        intro: "We've developed a benchmark that measures AI performance on our problem domain. Publishing it would establish us as the authority-everyone would compare their models using our test. But it would also help competitors know exactly what to optimise for.",
        aside: "Whoever defines the benchmark often shapes the entire field. It's power, but it also helps everyone-including rivals-improve faster.",
        choices: [
          { text: "Publish the benchmark and host a leaderboard", reaction: "We become the standard. Everyone knows our name. Everyone catches up.", emoji: "ğŸ”¥", ap: 3, cost: 25, eff: { sci: 5, mkt: 5 }, mood: 3 },
          { text: "Use it internally, publish later when we're further ahead", reaction: "Keep our lead a bit longer. Miss the thought leadership moment.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2, mkt: 1, dev: 1 }, mood: 0 },
          { text: "Keep it completely internal", reaction: "Protect our edge. Move faster.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 2 }, mood: 0 }
        ]
      },
      {
        intro: "A major tech lab has published a paper that overlaps with our unpublished research. Their version is good but not as good as ours. Do we rush out a paper showing our superior results, or stay quiet and let them think they're ahead? If we publish, they'll know exactly where we are and can catch up. If we don't, they might waste time on an inferior approach.",
        aside: "Strategic disclosure is a game. Sometimes revealing strength deters competitors. Sometimes it just gives them a target to aim for.",
        choices: [
          { text: "Publish immediately-assert dominance", reaction: "Everyone knows we're ahead. The race is on.", emoji: "ğŸ”¥", ap: 3, cost: 25, eff: { sci: 5, mkt: 4, dev: -1 }, mood: 2 },
          { text: "Stay quiet and extend our lead", reaction: "They don't know what we know. Use the time wisely.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2, dev: 3 }, mood: 1 },
          { text: "Publish partially-hint at more without revealing all", reaction: "Intimidation tactics. They know we're ahead but not by how much.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: 3, mkt: 2 }, mood: 0 }
        ]
      },
      {
        intro: "A major pharma company wants to license our AI models. As part of due diligence-the investigation process before any big deal-they want to examine our training data, model architecture, and evaluation methods in detail. If the deal goes through, it's transformative revenue. If it doesn't, they've seen everything.",
        aside: "Due diligence is standard for big deals. But there's always a risk they're really just gathering competitive intelligence. The NDA offers some protection, but proving a breach is almost impossible.",
        choices: [
          { text: "Full disclosure under NDA", reaction: "They see everything. The deal either happens or we've educated a potential competitor.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: -1, mkt: 3, cash: 80 }, mood: 0 },
          { text: "Staged disclosure-reveal more as deal progresses", reaction: "Build trust gradually. Some companies walk away at this stage.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { sci: 0, mkt: 2, cash: 50 }, mood: 1 },
          { text: "Demonstrate results only, protect methods", reaction: "They see what our system does, not how. Some buyers won't accept this.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { sci: 1, mkt: 1, cash: 30 }, mood: 2 }
        ]
      },
      {
        intro: "Three of our scientists want to give a technical talk at a workshop where the audience is mostly from competing companies. They say it's important for their professional development and for attracting talent. Our IP lawyer is nervous.",
        aside: "Scientists build reputations through sharing. But what builds their careers might hurt the company. Finding the balance is constant tension.",
        choices: [
          { text: "Let them present with minimal restrictions", reaction: "They shine. Competitors take notes. We attract great candidates.", emoji: "ğŸ”¥", ap: 2, cost: 15, eff: { sci: 3, mkt: 2, hr: 2 }, mood: 2 },
          { text: "Approve but review all slides carefully first", reaction: "Takes my time but controls the message.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { sci: 2, mkt: 2, hr: 1 }, mood: 1 },
          { text: "Block the talk-too risky", reaction: "IP protected. Team understands the stakes.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1, mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our AI will change how work is done in our target industry. Some tasks will be automated entirely; others will be transformed. In the long run, history suggests new jobs emerge-but in the short run, specific people lose specific jobs. The transition is where the pain concentrates, even if the destination is better.",
        aside: "The 'lump of labour' fallacy says automation doesn't destroy jobs overall-but that's cold comfort to someone whose skills are suddenly obsolete. Companies rarely think about transitions; economists rarely think about individuals.",
        choices: [
          { text: "Partner with customers on transition planning", reaction: "Help them manage the change. Builds deep loyalty and differentiation.", emoji: "ğŸ˜Š", ap: 3, cost: 30, eff: { sci: 3, mkt: 5, hr: 2 }, mood: 2 },
          { text: "Position as 'amplifying workers, not replacing them'", reaction: "Probably true in some cases. Good messaging either way.", emoji: "ğŸ™‚", ap: 2, cost: 25, eff: { sci: 2, mkt: 3, hr: 1 }, mood: 1 },
          { text: "Build the best product and let the market adapt", reaction: "Standard approach. The transition is someone else's problem.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { sci: 2, mkt: 2 }, mood: -1 }
        ]
      },
      {
        intro: "A ministry of health wants to license our AI for disease prediction. The science would genuinely help patients. But this government restricts press freedom and has used technology for surveillance before. Our contract would be for healthcare only-but once they have the technology, we can't control how it's used or what it's combined with.",
        aside: "Every major tech company faces decisions like this. The healthcare ministry isn't the security ministry-but they're part of the same government. Some argue engagement creates leverage for reform; others say it provides tools and legitimacy.",
        choices: [
          { text: "Decline-we can't guarantee it won't be misused", reaction: "Principled stand. Patients who might have benefited won't. Someone else may take the contract.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: -1, mkt: 2, hr: 1 }, mood: 2 },
          { text: "Accept with audit rights and use restrictions", reaction: "Try to build in safeguards. Enforcement is another matter.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 2, mkt: 0, cash: 60 }, mood: 0 },
          { text: "Accept-healthcare is healthcare", reaction: "Help the patients, not the politics. A defensible position that some will attack.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { sci: 3, mkt: -1, cash: 80 }, mood: -1 }
        ]
      },
      {
        intro: "We're planning our next big research push. We could focus on making our AI more powerful-which investors want-or on making it more efficient, using less energy to achieve the same results. Efficiency is less exciting but better for the planet.",
        aside: "The AI industry has an energy problem nobody wants to talk about. Bigger models need more power. At some point, sustainability has to matter.",
        choices: [
          { text: "Prioritise efficiency over capability", reaction: "Sustainable path. Investors might grumble.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { sci: 3, mkt: 1, hr: 1 }, mood: 2 },
          { text: "Balance both-efficiency enables capability", reaction: "Try to have it both ways. Spreads us thin.", emoji: "ğŸ™‚", ap: 4, cost: 35, eff: { sci: 4, mkt: 2 }, mood: 1 },
          { text: "Capability first-that's what gets funded", reaction: "Keep up with the arms race. Energy bill someone else's problem.", emoji: "ğŸ˜", ap: 3, cost: 30, eff: { sci: 5, mkt: 3 }, mood: 0 }
        ]
      },
      {
        intro: "The UK government is developing AI regulations and wants industry input. We could engage seriously-attending consultations, submitting detailed responses, helping shape rules that might govern our industry for decades. Or we could focus on building and let the big companies worry about policy.",
        aside: "Regulation is coming whether we participate or not. Small companies often ignore policy until it constrains them. But early engagement can shape rules in ways that work for innovators, not just incumbents.",
        choices: [
          { text: "Engage seriously with the policy process", reaction: "Shape the rules. Time away from product.", emoji: "ğŸ”¥", ap: 4, cost: 30, eff: { sci: 2, mkt: 3 }, mood: 2 },
          { text: "Join an industry group that lobbies collectively", reaction: "Pooled voice. Less direct influence.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 1, mkt: 2 }, mood: 1 },
          { text: "Focus on building-policy is for later", reaction: "Product first. Smart prioritisation.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 2, sci: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A major AI company just released something significantly more capable than ours. The reaction is split-some celebrate the advance, others worry it's creating pressure for everyone to move fast and cut corners. Our board wants to know: do we accelerate to keep up, or take a more measured path?",
        aside: "AI development feels like a race. If you slow down, others don't. But rushing to release systems you don't fully understand has real risks. The field is genuinely divided on what responsible development looks like.",
        choices: [
          { text: "Accelerate-falling behind helps no one", reaction: "Stay competitive. Hope we can be careful at speed.", emoji: "ğŸ”¥", ap: 4, cost: 40, eff: { sci: 5, mkt: 3, hr: -1 }, mood: 1 },
          { text: "Maintain our pace with more safety investment", reaction: "Balanced approach. Might not be enough for either goal.", emoji: "ğŸ™‚", ap: 3, cost: 30, eff: { sci: 3, mkt: 2 }, mood: 1 },
          { text: "Slow down and focus on understanding what we have", reaction: "Responsible but others capture the market.", emoji: "ğŸ˜", ap: 2, cost: 20, eff: { sci: 2, mkt: -1, hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We've been invited to sign a voluntary commitment on AI safety-things like testing for dangerous capabilities before release, sharing safety research, and reporting serious incidents. Other companies are signing; some prominent figures are calling it toothless PR. Do we sign?",
        aside: "Voluntary commitments are either the foundation of responsible norms or empty gestures depending on who you ask. Signing costs little but might constrain future choices. Not signing looks bad but preserves flexibility.",
        choices: [
          { text: "Sign and take the commitments seriously", reaction: "Public commitment. Hold ourselves accountable.", emoji: "ğŸ”¥", ap: 2, cost: 15, eff: { sci: 2, mkt: 3, hr: 1 }, mood: 2 },
          { text: "Sign but interpret flexibly", reaction: "Look responsible. Keep options open. Somewhat cynical.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { sci: 1, mkt: 2 }, mood: 0 },
          { text: "Don't sign-focus on actions not statements", reaction: "Show don't tell. Authentic approach.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1, hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our investors want us to pursue a capability that would be genuinely useful but could also cause harm if misused-think AI that can write very convincing text, or analyse video in ways that enable surveillance. The business case is strong. The potential for misuse is real.",
        aside: "Most powerful technologies can be used for good or harm. The question isn't whether something could be misused-almost anything can-but whether the benefits justify the risks, and whether you can design to minimise harm.",
        choices: [
          { text: "Build it with safeguards and use restrictions", reaction: "Try to capture benefits while limiting harms. Imperfect but thoughtful.", emoji: "ğŸ”¥", ap: 4, cost: 35, eff: { sci: 4, mkt: 3 }, mood: 1 },
          { text: "Build it and let the market decide", reaction: "Not our job to police usage. Common but increasingly criticised view.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { sci: 4, mkt: 4, hr: -1 }, mood: 0 },
          { text: "Decline to build it-too risky", reaction: "Someone else will. But we keep our conscience clean.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { sci: -1, mkt: 1, hr: 1 }, mood: 1 }
        ]
      },
      {
        intro: "We're pitching to investors next week. Our product works, but it's not as polished as competitors'. Our advisor says we should demo a version that's been 'enhanced' for the presentation-smoother than what customers actually experience. Everyone does it, he says. Investors expect the best-case scenario.",
        aside: "The line between a polished demo and a misleading one is genuinely blurry. Every startup shows their best side. But some 'best sides' are closer to fiction than others. Theranos started with a demo that didn't quite work.",
        choices: [
          { text: "Show exactly what we have-warts and all", reaction: "Honest. Some investors respect it. Others fund the company with the slicker demo.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: 1, hr: 2, cash: 40 }, mood: 2 },
          { text: "Polish heavily but don't fake functionality", reaction: "Best foot forward. The demo works; it's just... optimised.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { mkt: 3, cash: 80 }, mood: 1 },
          { text: "Make it look as good as possible-we'll catch up", reaction: "The Silicon Valley way. Hope we can deliver what we just showed.", emoji: "ğŸ˜", ap: 2, cost: 25, eff: { mkt: 4, cash: 120, hr: -1 }, mood: -1 }
        ]
      },
      {
        intro: "A journalist wants to write about us for a major tech publication. She's enthusiastic and hasn't asked hard questions about our actual customer numbers or revenue. We could let her write the glowing piece, or we could volunteer context that might make it more balanced-and less useful for recruiting and fundraising.",
        aside: "Favourable press can be transformative for a startup. Correcting a journalist's assumptions feels like shooting yourself in the foot. But puff pieces can come back to haunt you when reality emerges.",
        choices: [
          { text: "Volunteer accurate context", reaction: "Honest. Article is more measured. Still positive, less viral.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: 2, hr: 1 }, mood: 2 },
          { text: "Answer questions honestly but don't volunteer", reaction: "Professional approach. Integrity maintained.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 3, hr: 1 }, mood: 1 },
          { text: "Let the story run-we need the exposure", reaction: "Great press. Momentum builds.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 4 }, mood: 0 }
        ]
      },
      {
        intro: "We're about to announce a 'partnership' with a major company. In reality, we've had one meeting and they said they'd 'explore opportunities'. Our PR firm wants to put out a release saying we're 'working together'-technically true but massively overstated. It would help our next funding round enormously.",
        aside: "Startups announce 'partnerships' constantly. Most are exploratory conversations dressed up as strategic alliances. Everyone knows this. But it still works-until someone asks the 'partner' and they say 'who?'",
        choices: [
          { text: "Announce only what's actually agreed", reaction: "Honest. Builds long-term credibility.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: 2, hr: 2 }, mood: 2 },
          { text: "Soft language-'exploring collaboration'", reaction: "Technically accurate. Sounds better than it is.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3, hr: 1 }, mood: 1 },
          { text: "Call it a partnership-everyone does", reaction: "Great headline now. Risk of looking foolish later.", emoji: "ğŸ˜", ap: 1, cost: 15, eff: { mkt: 3 }, mood: 0 }
        ]
      },
      {
        intro: "Our runway-the cash we have left before we run out-is six months. We're telling recruits it's twelve. We're telling investors we're 'well-funded'. We're telling customers we're 'growing fast'. None of this is technically lying-but none of it is quite true either. A senior hire is asking pointed questions about our financial position.",
        aside: "Startups live in a state of perpetual optimism about their own survival. Admitting fragility scares away the people and money you need to not be fragile. But recruits who join under false pretences may have given up other offers.",
        choices: [
          { text: "Be honest about our position", reaction: "Some candidates and customers walk away. The ones who stay really believe.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: -1, hr: 2 }, mood: 2 },
          { text: "Optimistic but not misleading", reaction: "Emphasise the opportunity, acknowledge the risk. Fair.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2, hr: 1 }, mood: 1 },
          { text: "Keep up the confident front", reaction: "Confidence attracts customers.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 3 }, mood: 0 }
        ]
      }
    ]
  },
  
  dev: {
    // AOIFE MURPHY - The Architect
    aoife: [
      {
        intro: "The way our system is built will cope with maybe two more big customers. After that, things will start crashing and slowing down. We need to either rebuild the core structure now, or accept we'll face serious problems later.",
        aside: "Adding new features to a shaky foundation just means more things that can break. I've watched this story play out before at other companies.",
        choices: [
          { text: "Rebuild the core structure properly", reaction: "Grand. I'll put together a proper plan. This sets us up for scale.", emoji: "ğŸ˜Š", ap: 4, cost: 50, eff: { dev: 7, mkt: 1 }, mood: 2 },
          { text: "Fix only the worst problems", reaction: "Not ideal, but we can make it work for now.", emoji: "ğŸ˜", ap: 2, cost: 25, eff: { dev: 3, mkt: 2 }, mood: 0 },
          { text: "Keep adding features, fix later", reaction: "I want 'later' in writing. We're borrowing from the future.", emoji: "ğŸ˜’", ap: 1, cost: 5, eff: { dev: 1, mkt: 3 }, mood: -2 }
        ]
      },
      {
        intro: "Remember all those times we said 'we'll fix it properly later'? Later is now. Every quick fix and workaround we've built is slowing us down. Simple changes take three times as long because the code is a tangled mess.",
        aside: "I've watched good engineers quit over this. Nobody wants to work in a codebase held together with string and prayers.",
        choices: [
          { text: "Dedicate two weeks to fixing it properly", reaction: "The team will thank us. So will future us.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { dev: 6, hr: 1 }, mood: 2 },
          { text: "Split time between fixes and features", reaction: "Compromise. I can work with that.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 3, mkt: 1 }, mood: 0 },
          { text: "Just fix things when they break", reaction: "We're making it worse. Note that.", emoji: "ğŸ˜’", ap: 1, cost: 0, eff: { dev: 1, mkt: 2 }, mood: -2 }
        ]
      },
      {
        intro: "Every time we update our software, someone has to manually copy files, run checks, and pray nothing breaks. Last week's 3am emergency? That was a typo in a manual step. We need to automate this entire process.",
        aside: "Machines don't get tired or make typos at 3am. We should let them handle the boring, repetitive work.",
        choices: [
          { text: "Build a fully automated update system", reaction: "This pays for itself in months.", emoji: "ğŸ˜Š", ap: 4, cost: 35, eff: { dev: 4, hr: 1 }, mood: 2 },
          { text: "Automate just the riskiest parts", reaction: "Better than nothing. We'll build on this.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { dev: 3 }, mood: 0 },
          { text: "Keep doing it manually", reaction: "Until it breaks. At the worst time.", emoji: "ğŸ˜’", ap: 1, cost: 0, eff: { dev: 2, mkt: 2 }, mood: -2 }
        ]
      },
      {
        intro: "A large UK company wants to hire us for a custom project-they want our AI adapted to work in their specific systems. We could build it in a way that creates tools we can sell to others, or just do exactly what they need and move on.",
        aside: "Custom projects pay well, but they can distract us from our main product. The smart approach is to build things that help this client AND become part of our product for everyone else.",
        choices: [
          { text: "Build it so we can reuse it later", reaction: "Revenue now, and features everyone can use.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { dev: 3, mkt: 2, cash: 90 }, mood: 2 },
          { text: "Just build what they need", reaction: "Quick money, but we can't use this work again.", emoji: "ğŸ˜", ap: 3, cost: 20, eff: { dev: 1, cash: 80 }, mood: 0 },
          { text: "Decline-stay focused on our product", reaction: "Product focus pays off. Ship faster.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Another UK startup wants to connect their product to ours so their customers can use our AI. It would mean more users for us, but also more support calls and we'd need to coordinate whenever either of us makes changes.",
        aside: "Partnerships can help us reach customers we'd never find alone. But every connection we build is another thing we have to maintain.",
        choices: [
          { text: "Build a proper connection with full support", reaction: "Share customers and learn from their edge cases.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { dev: 3, mkt: 2, cash: 60 }, mood: 2 },
          { text: "Build a basic version first to test it", reaction: "Test whether it works without drowning in requests.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2, mkt: 1, cash: 30 }, mood: 0 },
          { text: "Decline-keep things simple", reaction: "Our roadmap stays clear. Execute well.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our research data is scattered across dozens of spreadsheets, random folders, and the personal laptops of stressed PhD students. Last month we wasted a week recreating an experiment because nobody could find the original results.",
        aside: "A proper system would let us find past experiments instantly and repeat them exactly. Right now, when someone leaves, their knowledge walks out the door with them.",
        choices: [
          { text: "Build a proper data management system", reaction: "Chaos subsides. We'll discover datasets we'd forgotten.", emoji: "ğŸ˜Š", ap: 4, cost: 60, eff: { dev: 6, sci: 2 }, mood: 2 },
          { text: "Hire someone to organise the worst bits", reaction: "Better, but we'll revisit this.", emoji: "ğŸ™‚", ap: 2, cost: 30, eff: { dev: 3, sci: 1 }, mood: 0 },
          { text: "Leave it for after the next deadline", reaction: "Prioritise the deadline. Team stays focused.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A UK supermarket wants our robots to work differently at night-slower movements, quieter motors, different routes when shelf-stackers are around. We could build a settings system that any customer can adjust, or just write special code for this one client.",
        aside: "The quick fix works for them, but next month another customer will want something different. If we keep doing one-off fixes, eventually our code becomes an unmaintainable mess.",
        choices: [
          { text: "Build a proper settings system", reaction: "Adapt to each store without rewriting code every time.", emoji: "ğŸ˜Š", ap: 5, cost: 50, eff: { dev: 5, mkt: 2, cash: 40 }, mood: 2 },
          { text: "Write custom code just for them", reaction: "Works for now. The mess grows.", emoji: "ğŸ˜", ap: 3, cost: 25, eff: { dev: 3, mkt: 1, cash: 20 }, mood: 0 },
          { text: "Tell them our product works one way", reaction: "Clear positioning. Integrity preserved.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1, hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A UK competitor just launched a feature that's very similar to something we were planning to build. Customers are asking if we have it too. We could rush to catch up, focus on doing something different instead, or stick to our original plan.",
        aside: "Reacting to competitors can distract us from what makes us special. But ignoring them completely might mean losing customers who want that feature.",
        choices: [
          { text: "Rush to build our own version", reaction: "Ship a better version. Show side-by-side comparisons.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { dev: 3, mkt: 2 }, mood: 2 },
          { text: "Focus on what makes us different", reaction: "Lean into our strengths instead of chasing features.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { dev: 2, mkt: 1 }, mood: 1 },
          { text: "Stick to our original plan", reaction: "Disciplined execution. Stay focused.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We need to decide how to license our code. Open source could build a community and attract developers, but we'd be giving away our work for free. Keeping it proprietary protects our investment but limits how quickly we can grow. There are also different types of open source licenses with very different rules.",
        aside: "Some open source licenses let anyone use your code for anything, including competitors. Others require anyone who modifies it to share their changes. The choice matters more than people realise.",
        choices: [
          { text: "Permissive open source (like MIT)", reaction: "Maximum adoption. Anyone can use it, even competitors building commercial products.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { dev: 4, mkt: 3, sci: 1 }, mood: 2 },
          { text: "Copyleft open source (like GPL)", reaction: "Derivatives must also be open source. Protects the commons but scares some businesses.", emoji: "ğŸ™‚", ap: 3, cost: 15, eff: { dev: 3, mkt: 2, sci: 2 }, mood: 1 },
          { text: "Keep it proprietary", reaction: "Full control. Slower community growth but we own everything.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { dev: 2, mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our company name is getting recognised, but we haven't registered it as a trademark. A lawyer is warning us that someone else could register it first-or a similar name could cause confusion in the market. Trademark registration takes time and money, and we'd need to decide which countries to register in.",
        aside: "Trademarks protect your brand name and logo. Without registration, you have limited legal options if someone copies your name. But registering everywhere is expensive.",
        choices: [
          { text: "Register trademark in UK, EU, and US", reaction: "Covers our main markets. We're protected where it matters.", emoji: "ğŸ˜Š", ap: 3, cost: 35, eff: { mkt: 3, dev: 1 }, mood: 2 },
          { text: "Just register in the UK for now", reaction: "Affordable protection in our home market. We can expand later.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 1 },
          { text: "Defer-we have bigger priorities", reaction: "Focus on product. Brand can wait.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A potential supplier wants us to sign a mutual NDA-a non-disclosure agreement-before they'll share details of their technology. It means both sides promise to keep each other's secrets confidential. Seems reasonable, but our lawyer wants to review the terms carefully.",
        aside: "NDAs are standard in business, but the details matter. How long does confidentiality last? What counts as confidential? Can we hire their staff? These clauses can come back to bite you.",
        choices: [
          { text: "Review carefully and negotiate terms", reaction: "Takes time but protects us from nasty surprises.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { dev: 2, mkt: 1 }, mood: 2 },
          { text: "Sign their standard agreement", reaction: "Quick and easy. Hope there's nothing unusual in there.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1, mkt: 1 }, mood: 0 },
          { text: "Decline and find another supplier", reaction: "Avoid the complexity. Find alternatives.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1, hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A large potential customer wants to see a demo of our product, but first they're asking us to sign a one-way NDA. We'd promise to keep their information confidential, but they wouldn't promise the same about ours. It feels unbalanced, but this is apparently standard practice for big corporations.",
        aside: "Large companies often insist on one-way NDAs because they talk to many vendors. But it means if you show them your innovations, you have no legal protection if they share your ideas.",
        choices: [
          { text: "Push for a mutual NDA instead", reaction: "Fair is fair. Some big companies will agree if you push.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { dev: 2, mkt: 1 }, mood: 2 },
          { text: "Sign but limit what we reveal", reaction: "Play the game, but keep our best secrets hidden.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { dev: 1, mkt: 2 }, mood: 0 },
          { text: "Sign and share everything", reaction: "Full transparency wins trust.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { mkt: 3 }, mood: 0 }
        ]
      },
      {
        intro: "A senior engineer is leaving to join a competitor. Our employment contracts include a non-compete clause that says employees can't work for competitors for 12 months after leaving. Our lawyer says we could enforce it, but it would be expensive, create bad publicity, and might not even hold up in court.",
        aside: "Non-compete clauses are controversial. UK courts often refuse to enforce them unless they're reasonable in scope and duration. But the threat alone can deter people.",
        choices: [
          { text: "Enforce the non-compete", reaction: "Send a message. But lawyers get rich and we look bad.", emoji: "ğŸ˜", ap: 3, cost: 40, eff: { hr: -2, dev: 1, mkt: -1 }, mood: -1 },
          { text: "Negotiate a deal-garden leave", reaction: "Pay them to stay home for a few months. Expensive but cleaner.", emoji: "ğŸ™‚", ap: 2, cost: 25, eff: { hr: 1, dev: 1, cash: -20 }, mood: 1 },
          { text: "Let them go without a fight", reaction: "Take the high road. They might even come back one day.", emoji: "ğŸ˜Š", ap: 1, cost: 5, eff: { hr: 2, mkt: 1 }, mood: 2 }
        ]
      },
      {
        intro: "We've discovered that a smaller company is using code that looks very similar to ours in their product. We think they might have copied it-possibly from an ex-employee or from code we shared during a partnership discussion. Our lawyer says we could sue for copyright infringement.",
        aside: "Copyright automatically protects original code. But proving someone copied it is hard, and lawsuits are expensive and distracting. Sometimes a strongly-worded letter is enough.",
        choices: [
          { text: "Send a cease and desist letter", reaction: "Put them on notice. Often enough to make them stop.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { dev: 3, mkt: 2 }, mood: 2 },
          { text: "Sue for copyright infringement", reaction: "Full legal action. Expensive, slow, but sends a strong message and may get damages.", emoji: "ğŸ™‚", ap: 3, cost: 40, eff: { dev: 2, mkt: 3, cash: 30 }, mood: 1 },
          { text: "Let it go-focus on our own work", reaction: "Outcompete them with better product.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our robots use a clever new gripper mechanism. The question is: can we patent it? Our attorney says mechanical inventions are straightforward to patent, but the software controlling the gripper is trickier. In Europe, 'software as such' can't be patented, but 'software with a technical effect' sometimes can. The US is more permissive but the rules keep changing.",
        aside: "Robotics companies often file separate patents for hardware and software. The mechanical parts are usually easier to protect. The AI and algorithms are harder-and that's often where the real value lies.",
        choices: [
          { text: "Patent both hardware and software aspects", reaction: "Cover all angles. The software patent might be challenged, but it's worth trying.", emoji: "ğŸ˜Š", ap: 3, cost: 40, eff: { dev: 5, mkt: 3 }, mood: 2 },
          { text: "Patent the hardware, keep software as trade secret", reaction: "Protects what we can. The code stays hidden instead of published in a patent.", emoji: "ğŸ™‚", ap: 2, cost: 25, eff: { dev: 3, mkt: 2 }, mood: 1 },
          { text: "Rely on speed and trade secrets instead", reaction: "Move fast. Stay ahead.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 2 }, mood: 0 }
        ]
      },
      {
        intro: "We're entering a market dominated by large industrial automation companies. They have thousands of patents-a 'patent thicket' that's almost impossible to navigate without infringing something. Our lawyer warns that building any robot arm probably infringes someone's patent somewhere. The question is whether anyone will notice, and whether they'll care about a small startup.",
        aside: "Big companies sometimes ignore small competitors, but they also use patent threats to force acquisitions at low prices. Once you're successful enough to be noticed, you become a target.",
        choices: [
          { text: "Do a full patent landscape analysis", reaction: "Expensive but we'll know exactly where the landmines are. Sleep easier.", emoji: "ğŸ˜Š", ap: 3, cost: 40, eff: { dev: 4, mkt: 3, sci: 1 }, mood: 2 },
          { text: "Design around the obvious problem patents", reaction: "Avoid the worst risks. Some uncertainty remains.", emoji: "ğŸ™‚", ap: 2, cost: 25, eff: { dev: 3, mkt: 2 }, mood: 1 },
          { text: "Move fast and hope nobody sues", reaction: "The startup way. Works until it doesn't.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, mkt: 2 }, mood: -1 }
        ]
      },
      {
        intro: "One of our engineers has invented an improvement to our path-planning algorithm. Should we patent it? Patents require public disclosure-our competitors will read exactly how it works. The alternative is keeping it as a trade secret, like Coca-Cola's formula. But if a competitor independently invents the same thing and patents it, they could block us from using our own invention.",
        aside: "The patent vs trade secret decision depends on whether competitors could reverse-engineer your innovation. If they can figure it out by examining your product, a trade secret won't help.",
        choices: [
          { text: "Patent it-disclosure is worth the protection", reaction: "Twenty years of exclusive rights. Competitors know how it works but can't use it.", emoji: "ğŸ˜Š", ap: 3, cost: 30, eff: { dev: 3, mkt: 2, cash: -25 }, mood: 2 },
          { text: "Keep it as a trade secret", reaction: "Stays hidden forever-or until someone leaks it or figures it out.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { dev: 2, mkt: 1 }, mood: 1 },
          { text: "Publish it to prevent anyone patenting it", reaction: "Defensive publishing. We can't own it, but neither can anyone else.", emoji: "ğŸ˜", ap: 2, cost: 5, eff: { dev: 1, sci: 2, mkt: 0 }, mood: 0 }
        ]
      },
      {
        intro: "A customer sent us photos of a product from a Shenzhen manufacturer that looks suspiciously like our robot design, selling at half our price. International patent enforcement is always difficult-different legal systems, language barriers, local courts that may favour local companies. China has improved its IP courts significantly, but the process is still slow, expensive, and uncertain.",
        aside: "Cross-border IP enforcement is genuinely hard everywhere. The question isn't whether the system is perfect-it isn't-but whether enforcement is worth the cost and distraction. Some companies find success; many don't.",
        choices: [
          { text: "Pursue enforcement through Chinese IP courts", reaction: "Long process. Better odds than a decade ago. Might get injunction.", emoji: "ğŸ™‚", ap: 3, cost: 45, eff: { dev: 2, mkt: 3 }, mood: 1 },
          { text: "Focus on markets where we have stronger protections", reaction: "Pick battles we can win. Accept losses elsewhere.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 2, mkt: 2 }, mood: 1 },
          { text: "Compete on quality, service, and speed instead", reaction: "Accept copycats exist everywhere. Win on everything else.", emoji: "ğŸ˜Š", ap: 1, cost: 10, eff: { dev: 2, mkt: 2 }, mood: 2 }
        ]
      },
      {
        intro: "Our investors are asking about our patent portfolio before the next funding round. They want to see strong intellectual property protection-an 'IP moat'-that protects our technology from competitors. Our current portfolio has three granted patents and two pending applications. The investors' IP advisor thinks we need at least ten patents to look serious to later-stage investors.",
        aside: "Some investors count patents like trophies. Others care more about whether the patents actually protect something valuable. Quality matters more than quantity, but quantity is easier to measure.",
        choices: [
          { text: "File several new patent applications", reaction: "Bulks up the portfolio for investors. Expensive but looks impressive.", emoji: "ğŸ˜Š", ap: 3, cost: 45, eff: { dev: 3, mkt: 4 }, mood: 2 },
          { text: "Focus on strengthening existing patents", reaction: "Quality over quantity. Harder to explain to non-experts.", emoji: "ğŸ™‚", ap: 2, cost: 25, eff: { dev: 3, mkt: 2 }, mood: 1 },
          { text: "Push back-our tech speaks for itself", reaction: "Confident stance. Serious investors respect it.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1, sci: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We've received a letter from a company we've never heard of claiming we infringe their patent. Looking them up, they appear to be a 'patent troll'-a company that buys up patents purely to threaten other businesses with litigation. They're demanding Â£200,000 to go away. Our lawyer says fighting them would cost more than settling, even if we'd probably win.",
        aside: "Patent trolls are a tax on innovation. They target companies that can afford to settle but can't afford to fight. Many founders quietly pay them off rather than face years of distraction.",
        choices: [
          { text: "Fight it on principle", reaction: "Expensive, but winning sends a message. Others will think twice about targeting us.", emoji: "ğŸ˜Š", ap: 4, cost: 50, eff: { dev: 2, mkt: 3, sci: 1 }, mood: 2 },
          { text: "Negotiate a smaller settlement", reaction: "Painful but pragmatic. They take less to avoid court.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 1, cash: -30 }, mood: 0 },
          { text: "Join a defensive patent pool", reaction: "Pay into a group that fights trolls collectively. Helps everyone.", emoji: "ğŸ™‚", ap: 1, cost: 15, eff: { dev: 1, mkt: 1, cash: -10 }, mood: 1 }
        ]
      },
      {
        intro: "Our CTO wants to dedicate one of our best engineers to 'patent mining'-systematically reviewing everything we've built to find patentable inventions we haven't protected yet. It would take her off product development for two months, but she knows the technology better than anyone and could probably identify a dozen filings.",
        aside: "Most companies patent less than they could because engineers hate the paperwork and want to build things instead. Dedicated patent mining often uncovers valuable IP that would otherwise be lost.",
        choices: [
          { text: "Go ahead-two months of her time", reaction: "Systematic approach. We'll find things we didn't know we had.", emoji: "ğŸ˜Š", ap: 4, cost: 40, eff: { sci: 4, mkt: 3 }, mood: 2 },
          { text: "One month, focused on highest priorities", reaction: "Balance between coverage and keeping the product moving.", emoji: "ğŸ™‚", ap: 2, cost: 25, eff: { dev: 1, sci: 2, mkt: 1 }, mood: 1 },
          { text: "Add patent review to regular sprint process", reaction: "Lightweight approach. Catches the obvious stuff.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { dev: 1, sci: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We've found a way to make our software work on older, cheaper devices-not just the latest phones and computers. This matters for healthcare workers using clinic tablets in rural Indonesia, teachers in underfunded UK schools, and field researchers everywhere. But supporting diverse hardware means more testing, more bugs, and slower feature development.",
        aside: "Device constraints exist everywhere-budget-conscious users in wealthy countries, infrastructure limitations in remote areas, organisations that can't refresh hardware often. The question is whether we build for the users we have or the users we wish we had.",
        choices: [
          { text: "Support a wide range of devices", reaction: "More complex to build. Reaches people others ignore.", emoji: "ğŸ˜Š", ap: 4, cost: 35, eff: { dev: 2, mkt: 4, hr: 1 }, mood: 2 },
          { text: "Core features on old devices, full experience on new", reaction: "Tiered approach. Everyone gets something useful.", emoji: "ğŸ™‚", ap: 3, cost: 30, eff: { dev: 1, mkt: 3 }, mood: 1 },
          { text: "Optimise for modern devices only", reaction: "Simpler to build. Excludes people we could have helped.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { dev: 2, mkt: 1 }, mood: -1 }
        ]
      },
      {
        intro: "Our servers run constantly, burning electricity even when nobody's using the product. We could redesign to scale down when quiet and scale up when busy-it would cut our energy use by 60% but cost three months of engineering time to rebuild.",
        aside: "Most software wastes enormous amounts of energy running at full power around the clock. Efficient design is better for the planet and, eventually, cheaper.",
        choices: [
          { text: "Rebuild for efficiency", reaction: "Three months now saves energy forever. And cuts our bills.", emoji: "ğŸ˜Š", ap: 4, cost: 40, eff: { dev: 5, mkt: 2, cash: 30 }, mood: 2 },
          { text: "Gradual improvements over time", reaction: "Chip away at it. Less disruptive, slower progress.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 2, mkt: 1 }, mood: 1 },
          { text: "Energy costs aren't our biggest problem", reaction: "Focus on core priorities. Practical choice.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We've discovered our product is being used in ways we didn't intend and don't like-nothing illegal, but ethically uncomfortable. We could add restrictions that prevent this use, but some paying customers would leave. Or we could ignore it since we can't control what people do with our tools.",
        aside: "Once you ship a product, you lose control of how it's used. But you can design to encourage good uses and discourage bad ones.",
        choices: [
          { text: "Add restrictions-values matter more than revenue", reaction: "We lose some customers. We keep our integrity.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { dev: 1, mkt: 1, hr: 1, cash: -30 }, mood: 2 },
          { text: "Discourage the use without blocking it", reaction: "Softer approach. Some will ignore us.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 1, mkt: 1 }, mood: 1 },
          { text: "Not our responsibility how people use it", reaction: "Focus on core product. Let customers decide.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1, cash: 10 }, mood: 0 }
        ]
      },
      {
        intro: "A team member has noticed our product isn't accessible to users with disabilities-people who use screen readers or can't use a mouse can't use our software at all. Fixing it properly would take significant effort, and we don't think disabled users are a big part of our market.",
        aside: "Accessibility is often treated as optional. But it's both legally required in many places and simply the right thing to do. Everyone deserves to use technology.",
        choices: [
          { text: "Full accessibility redesign", reaction: "Significant investment. We'll be proud of the result.", emoji: "ğŸ˜Š", ap: 4, cost: 40, eff: { dev: 2, mkt: 2, hr: 2 }, mood: 2 },
          { text: "Basic accessibility fixes", reaction: "Better than nothing. Not perfect.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 1, mkt: 1 }, mood: 1 },
          { text: "Add to backlog for later", reaction: "Noted for future. Stay focused now.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Before we release our AI, we should probably write up what it can and can't do-what data we trained it on, where it's known to fail, what biases we've found. Creating proper documentation takes time. We could ship now and write it up later, or delay release to do it right.",
        aside: "Good documentation helps users understand what they're getting and helps researchers spot problems. It's increasingly expected for responsible AI releases. But it's extra work, and the pressure to ship is real.",
        choices: [
          { text: "Delay release for proper documentation", reaction: "Responsible approach. Competitors don't wait.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { dev: 2, sci: 2, mkt: 1 }, mood: 2 },
          { text: "Ship with basic docs, improve over time", reaction: "Better than nothing. Commit to updating it.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2, sci: 1, mkt: 2 }, mood: 1 },
          { text: "Ship now, document if anyone asks", reaction: "Speed to market. Customers happy.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { dev: 2, mkt: 2 }, mood: 0 }
        ]
      },
      {
        intro: "Our AI can be tricked into producing harmful outputs if users phrase their requests cleverly-asking for dangerous information disguised as fiction, for example. We can add safety filters, but they slow down responses and sometimes block legitimate requests. Tighter safety means worse usability; looser safety means more ways to cause harm.",
        aside: "Every AI system can be manipulated. The question is how much inconvenience you're willing to impose on ordinary users to make manipulation harder. There's no perfect answer.",
        choices: [
          { text: "Strong safety filters-prioritise preventing harm", reaction: "Some users frustrated. Fewer harmful outputs.", emoji: "ğŸ˜Š", ap: 3, cost: 30, eff: { dev: 2, mkt: -1, sci: 1 }, mood: 2 },
          { text: "Balanced approach-block obvious harms", reaction: "Most manipulation prevented. Clever tricks might get through.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 2, mkt: 2 }, mood: 1 },
          { text: "Minimal filters-trust users", reaction: "Fast and flexible. Users love the freedom.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { dev: 2, mkt: 2 }, mood: 0 }
        ]
      },
      {
        intro: "We're considering whether to hire people to deliberately try to break our AI before we release it-finding ways it could be misused or fail dangerously. This kind of stress-testing takes weeks and might find problems that delay our launch. But it might also find problems before our users and the press do.",
        aside: "Having outsiders try to break your system before launch is becoming standard practice at major AI companies. Finding your own problems is better than having journalists or bad actors find them for you. But it costs time and money.",
        choices: [
          { text: "Thorough stress-testing before release", reaction: "Find problems before users do. Might delay launch.", emoji: "ğŸ˜Š", ap: 4, cost: 35, eff: { dev: 3, sci: 2, mkt: 1 }, mood: 2 },
          { text: "Quick internal security review", reaction: "Better than nothing. Probably miss things.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2, mkt: 2 }, mood: 1 },
          { text: "Ship and monitor for problems", reaction: "Learn from real usage. Iterate fast.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { dev: 2, mkt: 2 }, mood: 0 }
        ]
      },
      {
        intro: "Our AI makes decisions that affect people, but we don't keep records of why it made each decision. If someone challenges an outcome-say, why they were rejected for a loan-we can't explain what happened. Adding proper record-keeping would slow things down and require significant storage.",
        aside: "Being able to show why decisions were made is increasingly required by regulators and expected by customers. But it's expensive to add after the fact. The question is whether to invest now or hope you don't need it.",
        choices: [
          { text: "Build comprehensive decision records", reaction: "Ready for regulators. Significant engineering investment.", emoji: "ğŸ˜Š", ap: 4, cost: 40, eff: { dev: 2, mkt: 2, sci: 1 }, mood: 2 },
          { text: "Log key decisions only", reaction: "Partial coverage. Better than nothing.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 2, mkt: 1 }, mood: 1 },
          { text: "Add logging when customers require it", reaction: "Customer-driven development. Efficient.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { dev: 2, mkt: 2 }, mood: 0 }
        ]
      }
    ],
    
    // RAJ PATEL - The Pragmatist
    raj: [
      {
        intro: "Look, our platform isn't perfect-there are rough edges and things I'd love to fix. But I've shipped products in worse shape, and they found customers. The question is: do we polish what we have, or build what customers are actually asking for?",
        aside: "I've watched startups spend so long perfecting their product that they ran out of money before anyone could use it. Sometimes 'good enough' wins.",
        choices: [
          { text: "Build what customers want now", reaction: "Good call. Demo-ready in two weeks.", emoji: "ğŸ‘", ap: 3, cost: 20, eff: { dev: 2, mkt: 4 }, mood: 2 },
          { text: "Quick fixes first, then features", reaction: "Fair enough. Let me prioritise.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { dev: 3, mkt: 2 }, mood: 1 },
          { text: "Fix the platform properly first", reaction: "That's a lot of money to spend before we see any revenue.", emoji: "ğŸ˜¬", ap: 5, cost: 45, eff: { dev: 5, mkt: -1 }, mood: -1 }
        ]
      },
      {
        intro: "A customer wants something we weren't planning to build. It's not on our roadmap, but they're offering good money and need it quickly. Saying yes means reshuffling our priorities.",
        aside: "Custom work can fund everything else. But every time we say yes to something off-plan, we delay everything on the plan.",
        choices: [
          { text: "Take the deal, shuffle the priorities", reaction: "Money talks. Let me make it work.", emoji: "ğŸ‘", ap: 4, cost: 30, eff: { dev: 1, mkt: 2, cash: 80 }, mood: 2 },
          { text: "Negotiate a version we can manage", reaction: "Find a version that works for everyone.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { dev: 2, mkt: 1, cash: 50 }, mood: 1 },
          { text: "Say no-stick to the plan", reaction: "Stay focused. Product advances.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 3 }, mood: 0 }
        ]
      },
      {
        intro: "A UK investment firm wants a simple screen where their staff can see, at a glance, how much money is at risk each day. Right now they're drowning in spreadsheets and can't easily show regulators what's happening.",
        aside: "When clients can understand our outputs easily, they trust us more. And when regulators can see things clearly, everyone sleeps better.",
        choices: [
          { text: "Build a clear, visual dashboard", reaction: "Clients understand. No more midnight spreadsheet emails.", emoji: "ğŸ‘", ap: 4, cost: 35, eff: { dev: 4, mkt: 3, cash: 50 }, mood: 2 },
          { text: "Just let them download the data", reaction: "Technically works. Not exactly impressive.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { dev: 2, mkt: 1, cash: 20 }, mood: 0 },
          { text: "Tell them to use our internal tools", reaction: "Keep it simple. Focus on core product.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our sales team is complaining that when they show the product to potential customers, the system is full of test data, error messages, and yesterday's experiments. They want a clean version that always looks professional and never has embarrassing glitches during a pitch.",
        aside: "First impressions matter. Demos close deals. But keeping a separate 'show version' running takes engineering time away from building actual features.",
        choices: [
          { text: "Set up an automatic clean demo system", reaction: "Worth it. Good demos sell.", emoji: "ğŸ‘", ap: 4, cost: 30, eff: { dev: 2, mkt: 3 }, mood: 2 },
          { text: "Manually tidy up before big meetings", reaction: "More work for us, but cheaper.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { dev: 1, mkt: 2 }, mood: 0 },
          { text: "Just use the real system with test accounts", reaction: "Show them the real thing. Authentic demo.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { mkt: 2 }, mood: 0 }
        ]
      },
      {
        intro: "We've got a growing list of small problems that customers keep mentioning. Nothing that stops the product working, but little annoyances that add up: a button that's in the wrong place, a confusing error message, a page that loads slowly. Death by a thousand paper cuts.",
        aside: "Each small problem seems minor, but together they make customers feel like the product isn't quite polished. Fixing them all takes time away from building new things.",
        choices: [
          { text: "Spend a week fixing all of them", reaction: "Customer experience matters. Good call.", emoji: "ğŸ‘", ap: 3, cost: 20, eff: { dev: 3, mkt: 2 }, mood: 2 },
          { text: "Fix the ten worst, leave the rest", reaction: "Practical. Address the main offenders.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2, mkt: 1 }, mood: 1 },
          { text: "Keep building new features instead", reaction: "Innovation attracts new customers.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { dev: 2, mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our app is becoming popular with UK teenagers, and we're seeing more and more posts that push boundaries-some inappropriate content is slipping through our filters. Parents are starting to notice, and the press might be next.",
        aside: "Content problems can explode overnight. One viral story about harmful content and our reputation is damaged. But proper moderation takes real resources.",
        choices: [
          { text: "Full safety system overhaul", reaction: "Parents and press will thank us.", emoji: "ğŸ‘", ap: 4, cost: 35, eff: { dev: 3, hr: 2, mkt: 1 }, mood: 2 },
          { text: "Fix the worst problems, review later", reaction: "Firefighting mode. But we're understaffed.", emoji: "ğŸ˜", ap: 3, cost: 20, eff: { dev: 2, hr: 1 }, mood: 0 },
          { text: "Just rely on users reporting problems", reaction: "Users give real feedback. Learn fast.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1, mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A UK bank wants to use our AI to test what would happen to their investments if things went wrong-like a stock market crash or interest rates spiking. They want their own staff to be able to set up these 'what if' tests themselves, rather than asking us every time.",
        aside: "If they can do it themselves, we get fewer support requests. But if we give them too much control, they might break something or get confusing results.",
        choices: [
          { text: "Build a full 'what if' testing tool", reaction: "Their risk team feels in control. Fewer emails for us.", emoji: "ğŸ‘", ap: 5, cost: 40, eff: { dev: 3, mkt: 2 }, mood: 2 },
          { text: "Give them ready-made tests they can tweak", reaction: "Balance between flexibility and keeping things safe.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { dev: 2, mkt: 1 }, mood: 0 },
          { text: "Keep it so only we can set up tests", reaction: "Control quality. Ensure proper setup.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1, sci: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Marketing agencies across the UK are interested in our creative tool, but they're asking for ready-made starting points-professional templates they can quickly customise for client pitches rather than starting from scratch every time.",
        aside: "Good templates make it easy for agencies to adopt us. They'll use us more often if getting started is quick and the results look professional.",
        choices: [
          { text: "Design professional template packs", reaction: "Agencies use us for client pitches.", emoji: "ğŸ‘", ap: 4, cost: 30, eff: { dev: 2, mkt: 3 }, mood: 2 },
          { text: "Let users share templates with each other", reaction: "Community contributes. Quality varies.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2, mkt: 2 }, mood: 0 },
          { text: "Let agencies create their own", reaction: "Ecosystem grows. Partners extend our reach.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our product has a powerful API-the technical interface that lets developers build on our platform. A community member wants to write detailed tutorials explaining exactly how it works. Great for adoption, but it's also a roadmap for competitors to copy our approach.",
        aside: "Good documentation attracts developers. But it also teaches competitors exactly how we built everything. The best documentation reveals your thinking, not just your code.",
        choices: [
          { text: "Encourage it-openness builds ecosystem", reaction: "Developer love increases. So does competitive insight leakage.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { dev: 3, mkt: 4 }, mood: 2 },
          { text: "Provide official docs, discourage deep dives", reaction: "Controlled narrative. Some developers frustrated.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 2, mkt: 2 }, mood: 0 },
          { text: "Keep documentation minimal-our support is the product", reaction: "Premium experience. Personal touch.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1, hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A potential enterprise customer wants a detailed technical architecture review before signing. Their security team wants to understand exactly how we handle their data-encryption, storage, access controls, everything. It's reasonable for their compliance needs, but it's also a complete blueprint of our system.",
        aside: "Enterprise sales require transparency about security. But architecture documents are valuable intelligence. Some companies have 'borrowed' ideas during sales processes that never closed.",
        choices: [
          { text: "Full architecture disclosure under NDA", reaction: "They trust us. If the deal dies, they know everything.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { dev: 0, mkt: 3, cash: 60 }, mood: 1 },
          { text: "Third-party security audit instead", reaction: "Independent verification. Costs money but protects our secrets.", emoji: "ğŸ˜Š", ap: 2, cost: 30, eff: { dev: 1, mkt: 2, cash: 45 }, mood: 2 },
          { text: "High-level overview only", reaction: "Some enterprises walk away. Others accept it.", emoji: "ğŸ˜", ap: 1, cost: 10, eff: { dev: 1, mkt: 1, cash: 30 }, mood: 0 }
        ]
      },
      {
        intro: "We've built an internal tool that makes our developers twice as productive. Other companies would pay good money for it. But selling it means explaining how it works, supporting it, and helping competitors become more productive too.",
        aside: "Internal tools can become products-TeamChat started as an internal chat tool. But there's a reason most companies keep their best tools secret.",
        choices: [
          { text: "Productise and sell it", reaction: "New revenue stream. Competitors also get faster. Worth the trade-off?", emoji: "ğŸ˜Š", ap: 4, cost: 35, eff: { dev: 2, mkt: 3, cash: 50 }, mood: 2 },
          { text: "Open source it for community goodwill", reaction: "No revenue but massive developer love. Hiring becomes easier.", emoji: "ğŸ™‚", ap: 3, cost: 15, eff: { dev: 1, mkt: 4, hr: 2 }, mood: 2 },
          { text: "Keep it internal-it's our secret weapon", reaction: "Competitive advantage stays ours.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 2, mkt: 1 }, mood: 1 }
        ]
      },
      {
        intro: "A competitor's engineer is interviewing with us. She's brilliant, and during the interview she's mentioned several technical approaches they use. Hiring her would bring that knowledge to us-but we'd hate it if our engineers did the same thing when they left.",
        aside: "Knowledge walks on two legs. Non-competes are hard to enforce, and people naturally bring what they've learned. The ethics are murky.",
        choices: [
          { text: "Hire her and debrief on their approaches", reaction: "Their knowledge becomes ours. If they hire our people, turnabout is fair play.", emoji: "ğŸ˜", ap: 3, cost: 35, eff: { dev: 4, mkt: 1, hr: -1 }, mood: 0 },
          { text: "Hire her but don't ask about previous work", reaction: "We get her skills, not their secrets. Ethical high ground.", emoji: "ğŸ˜Š", ap: 3, cost: 35, eff: { dev: 3, hr: 1 }, mood: 2 },
          { text: "Don't hire-too much legal risk", reaction: "Risk avoided. Clean hands.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We've been asked to write a guest post for a major tech blog explaining how we solved a difficult engineering problem. It would be great publicity and recruiting material. Our solution is genuinely clever-which is exactly why our CTO is worried about publishing it.",
        aside: "Technical blog posts attract talent and establish credibility. They also educate competitors. The best companies share just enough to impress without giving away the recipe.",
        choices: [
          { text: "Write a detailed technical deep-dive", reaction: "Engineers love it. Competitors study it. We're seen as thought leaders.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { dev: 1, mkt: 4, hr: 2 }, mood: 2 },
          { text: "Write about the problem, vague on the solution", reaction: "Shows we're smart without showing how. Some readers frustrated.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 0, mkt: 2, hr: 1 }, mood: 1 },
          { text: "Decline the opportunity", reaction: "Keep methods secret. Competitive edge preserved.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Marketing wants us to add features that keep users on the app longer-notifications that pull them back, streaks that punish missing a day, design tricks that make it hard to leave. It would boost our engagement numbers, but some of these tactics feel manipulative.",
        aside: "The tech industry has perfected the art of grabbing attention. Some of these patterns are genuinely helpful; others exploit human psychology. The line isn't always clear.",
        choices: [
          { text: "Reject manipulative patterns entirely", reaction: "Engagement suffers. Conscience clear.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { dev: 1, mkt: -1, hr: 1 }, mood: 2 },
          { text: "Use gentle nudges, not dark patterns", reaction: "Encourage use without manipulation. Middle ground.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 2, mkt: 2 }, mood: 1 },
          { text: "Use whatever works-competitors do", reaction: "Everyone does this. We need the numbers.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { dev: 2, mkt: 4 }, mood: -1 }
        ]
      },
      {
        intro: "We collect a lot of user data because it helps us improve the product. But we're collecting more than we strictly need, and storing it indefinitely. A privacy-focused approach would collect less and delete it sooner, but we might lose insights that help us build better features.",
        aside: "Data is valuable, but it's also a liability. Every piece of data you store is data that could be breached, subpoenaed, or misused. Collecting less is often safer.",
        choices: [
          { text: "Collect minimum data, delete after 90 days", reaction: "Privacy-first approach. We lose some insights.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { dev: 1, mkt: 1, hr: 1 }, mood: 2 },
          { text: "Collect what we need, anonymise after a year", reaction: "Balance between utility and privacy.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 2, mkt: 2 }, mood: 1 },
          { text: "Collect everything-data is valuable", reaction: "Maximum insight for product improvement.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { dev: 3, mkt: 2 }, mood: 0 }
        ]
      },
      {
        intro: "User testing reveals our product is hard to use for people who aren't already familiar with similar tools-whether that's someone's first time using this kind of software, or someone who just processes information differently. Clearer labels, larger text, and simpler flows would help them, but our power users might find it cluttered.",
        aside: "Intuitive to who? What feels obvious to one person is confusing to another. Good design works for the widest range of people, but that takes more effort than designing for people like yourself.",
        choices: [
          { text: "Redesign for clarity and accessibility", reaction: "More work. Helps more people. Often improves things for everyone.", emoji: "ğŸ˜Š", ap: 4, cost: 35, eff: { dev: 2, mkt: 4 }, mood: 2 },
          { text: "Offer a simplified mode alongside the full version", reaction: "Two experiences to maintain. Serves different needs.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { dev: 1, mkt: 2 }, mood: 1 },
          { text: "Keep optimising for our current users", reaction: "They're happy. Potential users we never reach stay invisible.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, mkt: 3 }, mood: -1 }
        ]
      },
      {
        intro: "Our app encourages frequent use in ways that might not be healthy. Some users are clearly spending too much time on it. We could add features that remind people to take breaks or limit daily use, but that would deliberately reduce engagement-the opposite of what we usually optimise for.",
        aside: "Tech companies rarely design for less usage. But some are starting to add wellbeing features. It's good for users and increasingly expected.",
        choices: [
          { text: "Add meaningful wellbeing features", reaction: "Help people use us healthily. Revolutionary concept.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { dev: 1, mkt: 2, hr: 1 }, mood: 2 },
          { text: "Add basic time reminders", reaction: "Minimum gesture toward wellbeing.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 1, mkt: 1 }, mood: 1 },
          { text: "That's their responsibility, not ours", reaction: "Adults can manage themselves. Our job is building good products.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 3, mkt: 2 }, mood: -1 }
        ]
      }
    ],
    
    // WEI CHEN - The Team Builder
    wei: [
      {
        intro: "Team's been working hard, but I'm seeing strain. Are we setting sustainable pace?",
        aside: "I've watched burnout kill companies. Code doesn't matter if people are gone.",
        choices: [
          { text: "Sustainable pace, protect the team", reaction: "Thank you. We'll deliver, just humanely.", emoji: "ğŸ™", ap: 2, cost: 15, eff: { dev: 3, hr: 4 }, mood: 3 },
          { text: "One hard push, then we rest", reaction: "Holding you to 'then we rest'. We'll ship faster.", emoji: "ğŸ˜", ap: 3, cost: 25, eff: { dev: 5, hr: 1 }, mood: 1 },
          { text: "Push through-crunch time", reaction: "We'll ship, but start thinking about replacements.", emoji: "ğŸ˜”", ap: 1, cost: 10, eff: { dev: 3 }, mood: -2 }
        ]
      },
      {
        intro: "Senior engineer wants a four-day week. She's excellent and I don't want to lose her.",
        aside: "Flexibility retains talent. Rigidity loses it. Simple as that.",
        choices: [
          { text: "Approve and create flexible policy", reaction: "This attracts talent, not just retains.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { dev: 2, hr: 4 }, mood: 2 },
          { text: "Approve as individual exception", reaction: "Others will ask. Be ready.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { dev: 1, hr: 2 }, mood: 1 },
          { text: "Decline-need full commitment", reaction: "High standards attract committed people.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Team wants new tools to improve workflow. Learning curve and licence costs.",
        aside: "Happy developers with good tools ship better code. Investment usually pays off.",
        choices: [
          { text: "Approve new tooling with training", reaction: "Investing in the team. Smart.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { dev: 4, hr: 2 }, mood: 2 },
          { text: "Pilot with one team first", reaction: "Measured approach. Let's see.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2, hr: 1 }, mood: 1 },
          { text: "Stick with current tools", reaction: "Team knows the stack. Productivity maintained.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 2 }, mood: 0 }
        ]
      },
      {
        intro: "Need two more engineers. I'd rather find right cultural fits than rush.",
        aside: "Bad hire costs more than slow hire. Culture is hard to rebuild.",
        choices: [
          { text: "Quality over speed-take time", reaction: "Find people who make everyone better.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { dev: 2, hr: 3 }, mood: 2 },
          { text: "Set deadline but prioritise fit", reaction: "Balanced. I can work with that.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { dev: 3, hr: 1 }, mood: 1 },
          { text: "Hire fast-need capacity", reaction: "Might regret this. But I hear you.", emoji: "ğŸ˜", ap: 2, cost: 30, eff: { dev: 4, hr: -1 }, mood: -1 }
        ]
      },
      {
        intro: "Engineer made a significant production mistake. Recoverable, but how do we handle it?",
        aside: "Blame cultures kill innovation. Learning cultures build resilience.",
        choices: [
          { text: "Blameless post-mortem, fix systems", reaction: "This builds trust and improvement.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { dev: 3, hr: 3 }, mood: 2 },
          { text: "Private feedback, public learning", reaction: "Fair to individual, useful to team.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { dev: 2, hr: 1 }, mood: 1 },
          { text: "Make example to prevent repeats", reaction: "Clear standards set. Message received.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 2 }, mood: 0 }
        ]
      },
      {
        intro: "Remote work debate. Some want full remote, others want office energy.",
        aside: "No policy fits everyone. But inconsistency breeds resentment.",
        choices: [
          { text: "Hybrid with team choice", reaction: "Trust teams to decide what works.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { dev: 3, hr: 3 }, mood: 2 },
          { text: "Fixed office days for collaboration", reaction: "Structure helps. Some will grumble.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { dev: 2, hr: 1 }, mood: 0 },
          { text: "Full return to office", reaction: "Collaboration improves. Culture strengthens.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1, hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Engineers want 20% time for personal projects. Classic big tech policy.",
        aside: "Side projects spark innovation. But deadlines don't wait.",
        choices: [
          { text: "Implement 20% time policy", reaction: "Innovation needs space. Thank you.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { dev: 2, hr: 3, sci: 1 }, mood: 2 },
          { text: "Hackathon quarterly instead", reaction: "Concentrated bursts. Can work.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { dev: 2, hr: 2 }, mood: 1 },
          { text: "Focus on core roadmap only", reaction: "Disciplined execution. Ship what matters.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 2 }, mood: 0 }
        ]
      },
      {
        intro: "Graduate hiring programme? We've only hired experienced people so far.",
        aside: "Juniors bring energy and fresh thinking. Seniors spend time mentoring. Balance.",
        choices: [
          { text: "Create structured grad programme", reaction: "Fresh talent. Some will be brilliant.", emoji: "ğŸ˜Š", ap: 4, cost: 20, eff: { dev: 1, hr: 3, sci: 1 }, mood: 2 },
          { text: "Hire juniors opportunistically", reaction: "Good ones without programme overhead.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { dev: 2, hr: 1 }, mood: 1 },
          { text: "Keep hiring experienced only", reaction: "Quality standards maintained. Team stays strong.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1, dev: 1 }, mood: 0 }
        ]
      }
    ]
  },
  
  marketing: {
    // PRIYA SHARMA - The Dealmaker
    priya: [
      {
        intro: "I've got us in front of the public health system trust's CIO next Tuesday. Budget before year-end, but competitors circling.",
        aside: "I've built this relationship for eight months. This is our shot.",
        choices: [
          { text: "Full pitch-whatever it takes", reaction: "Clear my week. We're winning this.", emoji: "ğŸ’ª", ap: 4, cost: 30, eff: { mkt: 5, cash: 120 }, mood: 2 },
          { text: "Solid pitch within scope", reaction: "Conservative, but I'll make it work.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { mkt: 3, cash: 60 }, mood: 0 },
          { text: "We're not ready-wait", reaction: "Better to be ready. Product quality first.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 2 }, mood: 0 }
        ]
      },
      {
        intro: "A UK logistics firm wants a pilot. Not paying much, but the logo would be transformative.",
        aside: "Enterprise sales is all about references. This unlocks ten more deals.",
        choices: [
          { text: "Run pilot at cost", reaction: "Investment in the pipeline. Logo opens doors.", emoji: "ğŸ’ª", ap: 4, cost: 30, eff: { mkt: 6, cash: 20 }, mood: 2 },
          { text: "Negotiate middle ground", reaction: "We'll find something that works.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { mkt: 3, cash: 30 }, mood: 1 },
          { text: "Full price or nothing", reaction: "Hold the line. They walk.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 1, cash: 20 }, mood: 0 }
        ]
      },
      {
        intro: "Biggest customer up for renewal. Happy but asking for discount. Competitors circling.",
        aside: "Retention is cheaper than acquisition. But we need to value ourselves.",
        choices: [
          { text: "Defend pricing with added value", reaction: "I'll show them what they'd lose. They stay at full price.", emoji: "ğŸ’ª", ap: 3, cost: 15, eff: { mkt: 4, cash: 80 }, mood: 2 },
          { text: "Small discount for multi-year", reaction: "Lock-in has value. Fair trade.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 3, cash: 50 }, mood: 1 },
          { text: "Match competitor discount", reaction: "Keep them, but at much lower margin.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 2, cash: 30 }, mood: 0 }
        ]
      },
      {
        intro: "Industry dinner next week at the Savoy. All the right buyers. Expensive tickets.",
        aside: "Networking matters. This is where UK deals actually start.",
        choices: [
          { text: "Full presence, host side meeting", reaction: "Leave this to me. Business cards loaded.", emoji: "ğŸ’ª", ap: 4, cost: 30, eff: { mkt: 4 }, mood: 2 },
          { text: "Just attend, work the room", reaction: "Lower key but I'll connect.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 1 },
          { text: "Skip it-too expensive", reaction: "Save budget for better opportunities.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { cash: 15 }, mood: 0 }
        ]
      },
      {
        intro: "An important customer is frustrated and threatening to cancel. Some of their complaints are fair-we did mess up. Others seem like they expected something we never promised.",
        aside: "How we handle angry customers defines who we are. Turn this around and they could become our biggest advocate. Handle it badly and they'll tell everyone.",
        choices: [
          { text: "Go all-out to fix everything", reaction: "Turn this into our best advocate.", emoji: "ğŸ’ª", ap: 4, cost: 25, eff: { mkt: 3, hr: 1 }, mood: 2 },
          { text: "Fix the things that were our fault", reaction: "Fair response. Should stabilise.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 1 },
          { text: "Push back on the unreasonable demands", reaction: "Risky. Sometimes they need to hear it.", emoji: "ğŸ˜¬", ap: 2, cost: 10, eff: { mkt: 0, cash: 20 }, mood: -1 }
        ]
      },
      {
        intro: "Royal College conference next month. Invited to present alongside clinicians.",
        aside: "The public health system network is everything. This is where trust gets built.",
        choices: [
          { text: "Send scientist plus clinician champion", reaction: "Talk goes down well. Stand coffee less so.", emoji: "ğŸ’ª", ap: 4, cost: 20, eff: { mkt: 4, sci: 2 }, mood: 2 },
          { text: "Modest stand only", reaction: "Collect lanyards and handful of leads.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 0 },
          { text: "Skip-focus on direct meetings", reaction: "Quality over quantity. Deepen key relationships.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "public health system Innovation Accelerator has a slot. Pitch for place on their programme.",
        aside: "NIA opens doors across the public health system. Worth the effort.",
        choices: [
          { text: "Careful, evidence-heavy pitch", reaction: "Impress clinicians and policy people alike.", emoji: "ğŸ’ª", ap: 4, cost: 15, eff: { mkt: 3, sci: 1 }, mood: 2 },
          { text: "Reuse investor deck with tweaks", reaction: "Scrape through Q&A. Don't stand out.", emoji: "ğŸ˜", ap: 2, cost: 5, eff: { mkt: 1 }, mood: 0 },
          { text: "Decline-admin looks heavy", reaction: "Avoid bureaucracy. Stay nimble.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Major UK retailer offers joint press release about our robots in their warehouses.",
        aside: "Their brand validates ours. This will circulate in logistics industry chat groups.",
        choices: [
          { text: "Agree and film short joint video", reaction: "Video circulates everywhere.", emoji: "ğŸ’ª", ap: 4, cost: 20, eff: { mkt: 3 }, mood: 2 },
          { text: "Simple written statement", reaction: "Safe, tidy, moderately visible.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 2 }, mood: 0 },
          { text: "Keep partnership quiet", reaction: "Strategic discretion. Flexibility preserved.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A FTSE 100 company-one of Britain's largest public corporations-wants to explore a 'strategic partnership'. They've asked for a detailed presentation on our technology, roadmap, and business model. This could lead to investment, acquisition, or a major contract-or they could just be gathering intelligence before building it themselves.",
        aside: "Large companies do this constantly. Some partnerships are genuine. Others are fishing expeditions. The problem is you can't tell which until you've already revealed everything.",
        choices: [
          { text: "Full disclosure-bet on the relationship", reaction: "They see everything. Either this becomes transformative or we've educated a future competitor.", emoji: "ğŸ˜", ap: 3, cost: 25, eff: { mkt: 4, cash: 100, dev: -1 }, mood: 1 },
          { text: "Staged disclosure-reveal more as they commit", reaction: "Trust but verify. Some corporates hate this dance.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { mkt: 3, cash: 60 }, mood: 2 },
          { text: "Surface-level only until term sheet", reaction: "Protect ourselves, but they might lose interest.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 1, cash: 30 }, mood: 0 }
        ]
      },
      {
        intro: "We're in 'customer discovery' calls with a large bank. They're asking detailed questions about exactly how we'd solve their problems-workflow, integration, pricing, timeline. It feels less like buying and more like a free consulting session. But walking away means no sale.",
        aside: "Enterprise buyers often extract detailed proposals from multiple vendors, then build internally or give the best ideas to their preferred supplier. It's exhausting but standard practice.",
        choices: [
          { text: "Give them the full solution design", reaction: "If they buy, it's a big deal. If not, they have our playbook.", emoji: "ğŸ˜", ap: 3, cost: 25, eff: { mkt: 3, cash: 80, dev: -1 }, mood: 0 },
          { text: "High-level approach, details after commitment", reaction: "Some buyers respect this. Others move to competitors who'll do free work.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: 2, cash: 40 }, mood: 2 },
          { text: "Charge for detailed scoping work", reaction: "Filters serious buyers. Loses tyre-kickers who might've converted.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 1, cash: 25 }, mood: 1 }
        ]
      },
      {
        intro: "A corporate venture capital arm wants to invest. Great validation, but their parent company competes in an adjacent market and could easily enter ours. Their term sheet-the document outlining the investment deal-includes information rights that would give them visibility into our metrics, strategy, and product roadmap.",
        aside: "Corporate VCs can be amazing partners-or Trojan horses. The investment might be genuine, or it might be cheap intelligence gathering with an option to acquire or crush you later.",
        choices: [
          { text: "Accept-the benefits outweigh the risks", reaction: "Access to their network and expertise. Hope they play fair.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 4, cash: 150, dev: -1 }, mood: 1 },
          { text: "Negotiate limited information rights", reaction: "Try to get the money without the surveillance. They might walk.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { mkt: 3, cash: 120 }, mood: 2 },
          { text: "Decline and seek independent VCs", reaction: "Cleaner cap table, less strategic value, possibly harder to raise.", emoji: "ğŸ˜", ap: 2, cost: 20, eff: { mkt: 1, cash: 80 }, mood: 0 }
        ]
      },
      {
        intro: "Our sales team has been asked to demo our product to a potential customer's 'evaluation committee'. The committee includes fifteen people-far more than needed. Some are clearly from their internal tech team. They're taking detailed notes and asking very specific technical questions.",
        aside: "Sometimes large committees are bureaucracy. Sometimes they're cover for bringing engineers to reverse-engineer your demo. Hard to refuse without looking difficult.",
        choices: [
          { text: "Full demo to everyone", reaction: "Cooperate and hope for the best. They see everything.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { mkt: 3, dev: -1 }, mood: 0 },
          { text: "Limit technical detail, focus on outcomes", reaction: "Show what it does, not how. Some evaluators frustrated.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 1 },
          { text: "Request smaller, appropriate audience", reaction: "Reasonable ask. They might see us as difficult.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A large consulting firm wants to partner with us-they'll recommend our product to their clients in exchange for a referral fee. But first, they need to 'understand our technology deeply' so they can explain it. They want a full day with our technical team.",
        aside: "Consultants work with everyone in an industry. What they learn from you might inform advice they give your competitors. But their recommendations can drive serious enterprise deals.",
        choices: [
          { text: "Full technical deep-dive", reaction: "They become effective advocates. And they know all our secrets.", emoji: "ğŸ˜", ap: 4, cost: 30, eff: { mkt: 5, dev: -1, cash: 60 }, mood: 1 },
          { text: "Business-level training only", reaction: "They can sell the benefits but stumble on technical questions.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3, cash: 30 }, mood: 1 },
          { text: "Decline the partnership", reaction: "Control our secrets. Stay independent.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We're negotiating a pilot with a large company. They want us to share our source code into escrow 'for business continuity'-so they can access it if we go bust. Reasonable on the surface, but their lawyers will review the escrow contents, and 'going bust' is broadly defined.",
        aside: "Source code escrow is standard in enterprise deals. But it's also a legal way to get access to your code. Once it's in escrow, the security depends on lawyers and contracts, not technology.",
        choices: [
          { text: "Agree to standard escrow terms", reaction: "Close the deal. Trust the legal protections.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { mkt: 3, cash: 70 }, mood: 1 },
          { text: "Negotiate narrow release conditions", reaction: "Protect ourselves. Delays the deal, frustrates their legal team.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { mkt: 2, cash: 50 }, mood: 2 },
          { text: "Refuse escrow entirely", reaction: "Some enterprises won't proceed without it. This might kill the deal.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { mkt: 0, cash: 20 }, mood: -1 }
        ]
      },
      {
        intro: "A potential acquirer wants to begin due diligence-the deep investigation that happens before any acquisition. They'll need access to our code, our customer data, our financial models, and interviews with key staff. If the deal happens, we're set. If it falls through, they've seen everything-and they're already in our market.",
        aside: "Acquisition due diligence is the ultimate disclosure paradox. You have to show everything to get the deal done. But half of all acquisitions fall through after due diligence.",
        choices: [
          { text: "Open the books completely", reaction: "Standard process. They either buy us or they don't.", emoji: "ğŸ˜", ap: 4, cost: 40, eff: { mkt: 2, cash: 200, dev: -2, hr: -1 }, mood: 0 },
          { text: "Phased disclosure tied to offer price", reaction: "More protection, but signals distrust. Some buyers walk.", emoji: "ğŸ˜Š", ap: 4, cost: 35, eff: { mkt: 1, cash: 150, dev: -1 }, mood: 1 },
          { text: "Insist on break fee if they walk", reaction: "Compensation if they back out. Many buyers refuse this term.", emoji: "ğŸ™‚", ap: 3, cost: 30, eff: { mkt: 1, cash: 100 }, mood: 1 }
        ]
      },
      {
        intro: "We've been invited to pitch at a large corporation's 'innovation day'. Great exposure to senior executives, but we'll be presenting alongside our direct competitors. The format encourages detailed demos. Everyone watches everyone else's pitch.",
        aside: "Innovation days are speed-dating for corporates. They get to compare solutions side-by-side. You get to learn about competitors too-if you're paying attention.",
        choices: [
          { text: "Go all-in with impressive demo", reaction: "Stand out from the crowd. Competitors see our best features.", emoji: "ğŸ’ª", ap: 3, cost: 25, eff: { mkt: 4, dev: -1 }, mood: 2 },
          { text: "Solid presentation, hold back innovations", reaction: "Competitive but not revealing. Might not win.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 1 },
          { text: "Decline and request private meeting", reaction: "Avoid the circus. They might not accommodate.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Three other UK AI startups have approached us about forming an alliance. We'd share resources-maybe a joint sales team for big deals, shared computer systems, even recommending each other to customers. Together we'd look more credible to large buyers than any of us alone. But we'd also be tying ourselves to companies that might fail, change direction, or become competitors.",
        aside: "Startup alliances can punch above their weight. But they're fragile-everyone's priorities shift, funding situations change, and today's partner might be tomorrow's competitor.",
        choices: [
          { text: "Join the alliance fully", reaction: "Strength in numbers. We sink or swim together.", emoji: "ğŸ’ª", ap: 4, cost: 30, eff: { mkt: 4, dev: 2, hr: -1 }, mood: 2 },
          { text: "Join loosely-recommend each other only", reaction: "Low commitment. Benefits without deep entanglement.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 2, dev: 1 }, mood: 1 },
          { text: "Decline-we'll build our own credibility", reaction: "Independence preserved. Earn it ourselves.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A group of startups is trying to create common rules for how companies in our industry share information with each other. If it works, customers wouldn't be trapped with one vendor anymore-they could easily switch between us. We'd all benefit from a bigger market. But creating industry standards is slow, political, and most attempts fail. Our time could go toward our own product instead.",
        aside: "Common standards create bigger markets. But most attempts die in endless meetings, and even successful ones take years. The question is whether the collective benefit is worth the individual cost.",
        choices: [
          { text: "Lead the standards effort", reaction: "Shape the future. Distract from our product. If it works, we're kingmakers.", emoji: "ğŸ’ª", ap: 5, cost: 40, eff: { mkt: 4, dev: -2, sci: 2 }, mood: 2 },
          { text: "Participate but don't lead", reaction: "Stay informed, influence direction, limited commitment.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2, dev: 0, sci: 1 }, mood: 1 },
          { text: "Wait and adopt if it succeeds", reaction: "Smart timing. Let others take the risk.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Another startup has proposed we build a connection between our products so they work together seamlessly. Their customers would benefit from our AI; our customers would benefit from their data. But we'd need to share technical details, coordinate our plans, and trust them not to copy our approach.",
        aside: "Connecting deeply with other startups can create powerful combined offerings. But both sides need to stay healthy, maintain trust, and keep pulling in the same direction-a lot can go wrong.",
        choices: [
          { text: "Build a deep connection together", reaction: "Powerful together. Dependent on each other's success and honesty.", emoji: "ğŸ’ª", ap: 4, cost: 35, eff: { mkt: 4, dev: 2, cash: 30 }, mood: 2 },
          { text: "Simple connection-easy to undo", reaction: "Works but not magic. Either side can walk away.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { mkt: 2, dev: 1, cash: 15 }, mood: 1 },
          { text: "Decline-too risky to depend on them", reaction: "Our product stands alone. Full control.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We've been asked to split the cost of building a shared system with two other startups-a common way to process and move data that all three companies would use. It would cost each of us Â£30k, but building it alone would cost Â£80k. The catch: if any company fails or changes direction, the others are stuck maintaining their share.",
        aside: "Sharing costs makes sense when everyone's going the same direction. But startups change constantly. What happens when one partner gets bought, runs out of money, or decides they don't need this anymore?",
        choices: [
          { text: "Share the cost with the others", reaction: "Cheaper together. Hope everyone stays committed.", emoji: "ğŸ’ª", ap: 2, cost: 20, eff: { dev: 4, mkt: 1 }, mood: 1 },
          { text: "Build our own-keep control", reaction: "More expensive but we own it completely. No dependencies.", emoji: "ğŸ™‚", ap: 3, cost: 35, eff: { dev: 5, mkt: 1 }, mood: 2 },
          { text: "Use ready-made solutions instead", reaction: "Less tailored to our needs, but simple.", emoji: "ğŸ˜", ap: 1, cost: 15, eff: { dev: 2 }, mood: 0 }
        ]
      },
      {
        intro: "A startup accelerator is creating a group of companies that would sell together-shared booth at trade shows, joint customer success stories, combined sales pitches for large deals. It's cheaper than doing it alone and more impressive to buyers. But we'd be associated with companies we don't control.",
        aside: "Selling together can open doors none of you could open alone. But your reputation becomes linked to theirs. If one company does badly, it reflects on everyone.",
        choices: [
          { text: "Join the group fully", reaction: "United front. Hope everyone maintains quality.", emoji: "ğŸ’ª", ap: 3, cost: 20, eff: { mkt: 5, hr: -1 }, mood: 2 },
          { text: "Join for events only", reaction: "Shared presence, separate identities.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3 }, mood: 1 },
          { text: "Build our own brand independently", reaction: "Complete control. More expensive, slower.", emoji: "ğŸ˜", ap: 1, cost: 25, eff: { mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Several startups in our space are talking about jointly lobbying the government on AI regulation. Together we could afford professional lobbyists and present a united industry voice. Separately, none of us have the resources or credibility. But agreeing on policy positions among competitors is complicated.",
        aside: "Collective lobbying shapes regulation before it shapes you. But getting competitors to agree on anything is hard, and whatever you advocate will be public-potentially alienating customers or investors who disagree.",
        choices: [
          { text: "Lead the lobbying coalition", reaction: "Shape the rules. Spend time on politics instead of product.", emoji: "ğŸ’ª", ap: 4, cost: 35, eff: { mkt: 3, sci: 2, dev: -1 }, mood: 1 },
          { text: "Participate and contribute", reaction: "Voice in the room without leading. Share the cost and influence.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { mkt: 2, sci: 1 }, mood: 1 },
          { text: "Stay out of politics", reaction: "Focus on product. Let others lobby.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1, sci: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A new platform-not yet dominant but growing fast-wants us as an early partner. We'd get first access, featured placement, and a say in how they build things. But the platform might fail, leaving us with wasted work. Or it might take off and we'd be locked in as a favoured partner from the start.",
        aside: "Early bets on new platforms can be transformative-like being one of the first apps on a major social network or team chat platform. They can also be expensive dead ends. Timing is everything.",
        choices: [
          { text: "Bet early on the new platform", reaction: "High risk, but potential to be first in line.", emoji: "ğŸ’ª", ap: 4, cost: 35, eff: { mkt: 4, dev: 2 }, mood: 2 },
          { text: "Wait and see if it takes off", reaction: "Lower risk. Might miss the best position.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 1, dev: 1 }, mood: 0 },
          { text: "Focus on established platforms only", reaction: "Reliable approach. Proven returns.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { mkt: 2 }, mood: 0 }
        ]
      },
      {
        intro: "A competitor has proposed we team up to win a customer that neither of us could win alone-the contract is simply too big for any single startup. We'd split the work and the money. It could be the start of ongoing collaboration or just a one-off necessity. Either way, we'd be sharing a customer relationship with a rival.",
        aside: "Teaming up with competitors is surprisingly common when deals are too large for any one company. But it requires trusting companies you normally fight for the same customers.",
        choices: [
          { text: "Partner for this deal", reaction: "Win together what we couldn't win alone. Complicated relationship.", emoji: "ğŸ’ª", ap: 3, cost: 25, eff: { mkt: 4, cash: 60, hr: -1 }, mood: 2 },
          { text: "Decline and bid solo", reaction: "Long shot alone. At least we keep full control.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { mkt: 1, cash: 20 }, mood: 0 },
          { text: "Pass on this opportunity", reaction: "Avoid complexity. Stay focused.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A potential customer wants to use our AI for something we're uncomfortable with-not illegal, but ethically questionable. They're a significant contract. Our terms of service are vague enough that we could technically allow it, but some team members think we shouldn't.",
        aside: "You can't always control how your product is used, but you can choose who you sell to. Saying no to revenue is hard. Saying yes to the wrong use case can define your company.",
        choices: [
          { text: "Decline the contract-values matter", reaction: "Walk away from money. Keep our integrity.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: 1, hr: 2, cash: -30 }, mood: 2 },
          { text: "Accept with use restrictions in the contract", reaction: "Try to limit the problematic use. Hard to enforce.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2, cash: 60 }, mood: 0 },
          { text: "Accept-it's their responsibility how they use it", reaction: "Revenue now. Reputation questions later.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { mkt: 2, cash: 80, hr: -1 }, mood: -1 }
        ]
      },
      {
        intro: "We're being asked to build AI for a customer that makes decisions about people-hiring, lending, insurance pricing. They want the AI to optimise for their business metrics. But their metrics might encode biases or create unfair outcomes. Do we build what they want, push back, or walk away?",
        aside: "AI that affects life outcomes is high-stakes. You might be building a tool that discriminates, even unintentionally. Some companies build whatever they're paid to; others refuse high-risk applications entirely.",
        choices: [
          { text: "Engage but insist on fairness auditing", reaction: "Do the work responsibly. Adds cost and complexity for everyone.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { mkt: 2, sci: 2, cash: 40 }, mood: 2 },
          { text: "Build what they want with standard disclaimers", reaction: "Their use case, their responsibility. Hope nothing goes wrong.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3, cash: 70 }, mood: 0 },
          { text: "Decline high-risk applications entirely", reaction: "Clear ethics. Team proud of our standards.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A defence contractor wants to license our AI. The application is logistics and planning-nothing lethal. But it's part of a military supply chain, and our technology could eventually end up in weapons systems. Some employees would resign; others see defence as a legitimate customer.",
        aside: "The defence sector is a genuine ethical divide. Some see it as protecting democracy; others won't participate at any level. There's no consensus view-even within single companies.",
        choices: [
          { text: "Accept-logistics isn't weapons", reaction: "Draw the line at direct harm. Some staff uncomfortable.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2, cash: 100, hr: -2 }, mood: 0 },
          { text: "Decline all defence work", reaction: "Clear policy. Lose a lucrative sector. Some staff relieved.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: -1, hr: 2 }, mood: 1 },
          { text: "Case-by-case review", reaction: "Flexibility but constant internal debates.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { mkt: 1, cash: 50 }, mood: 0 }
        ]
      },
      {
        intro: "A buyer wants to use our AI to automate content moderation for their social platform-taking down posts, banning users, flagging content. Our AI will make consequential decisions about speech. It will make mistakes. Some mistakes will be high-profile.",
        aside: "Content moderation is one of the hardest AI applications. False positives silence legitimate speech; false negatives let harm through. There's no way to get it right, only trade-offs about what kind of wrong you prefer.",
        choices: [
          { text: "Accept with human review requirements", reaction: "AI flags, humans decide. Slower but fewer disasters.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { mkt: 2, sci: 1, cash: 50 }, mood: 2 },
          { text: "Accept as purely assistive tool", reaction: "Recommend, don't decide. Less liability, less value.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2, cash: 40 }, mood: 1 },
          { text: "Decline-too high-risk for our reputation", reaction: "Protect our brand. Right decision.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A big prospect is about to sign. In the final meeting, they ask if we can do something we can't actually do yet. It's on our roadmap, maybe two months out. If we say no, we lose the deal. If we say yes, we're promising something that doesn't exist.",
        aside: "Selling the roadmap is standard startup practice. But there's a spectrum from 'coming soon' to 'we haven't started building it'. Promising features that don't exist can win deals-or destroy trust when you can't deliver.",
        choices: [
          { text: "Be honest-it's not ready yet", reaction: "Might lose the deal. Keep our integrity.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: -1, hr: 2 }, mood: 2 },
          { text: "Commit to delivery with a realistic timeline", reaction: "Promise it for a specific date. Pressure on the team.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { mkt: 3, dev: -1, cash: 60 }, mood: 1 },
          { text: "Say yes and figure it out later", reaction: "Win the deal. Scramble to deliver. Hope we can.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { mkt: 4, dev: -2, cash: 80, hr: -1 }, mood: -1 }
        ]
      },
      {
        intro: "We're in a competitive pitch. Our product is genuinely better at some things, worse at others. The buyer is clearly comparing us to our main competitor. We could give a balanced comparison, or we could emphasise only where we win and hope they don't dig into where we lose.",
        aside: "Every sales pitch emphasises strengths. But there's a difference between 'best foot forward' and 'actively misleading'. Customers who buy based on misleading comparisons often become angry ex-customers.",
        choices: [
          { text: "Balanced comparison-strengths and limitations", reaction: "Honest. Might lose to someone who oversells.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: 2, hr: 2 }, mood: 2 },
          { text: "Focus on our strengths, don't mention weaknesses", reaction: "Standard practice. Hope they don't ask the right questions.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3, cash: 50 }, mood: 0 },
          { text: "Imply competitor weaknesses we can't prove", reaction: "Aggressive. Might backfire badly if they check.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { mkt: 4, cash: 70, hr: -2 }, mood: -1 }
        ]
      },
      {
        intro: "A prospect asks for references. Our two happy customers are tired of taking calls-we've used them for every pitch this quarter. Our three unhappy customers would give honest but damaging feedback. We could ask the happy ones again, find creative ways to avoid giving references, or be honest about our mixed track record.",
        aside: "References are social proof. Everyone cherry-picks their best ones. But sophisticated buyers know this and sometimes insist on talking to customers you didn't choose. What happens when they find the unhappy ones?",
        choices: [
          { text: "Offer balanced references including critics", reaction: "Brave. Shows confidence in addressing problems.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: 1, hr: 2 }, mood: 2 },
          { text: "Use the happy ones again, apologise for asking", reaction: "Standard practice. Hope they don't get tired of us.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3, cash: 40 }, mood: 0 },
          { text: "Delay and deflect on references", reaction: "Buy time to close the deal.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 2 }, mood: 0 }
        ]
      }
    ],
    
    // MARCUS THOMPSON - The Growth Engineer
    marcus: [
      {
        intro: "I've been tracking the numbers. When big companies try our product, only 12 out of every 100 actually become paying customers. The problem isn't our sales pitch-it's that new users get confused in their first week. If we made the getting-started experience smoother, I reckon we'd convert 20 out of 100 instead.",
        aside: "Chasing new deals is exciting, but fixing why people give up is often more valuable. The maths doesn't lie.",
        choices: [
          { text: "Fix the new user experience first", reaction: "Smart. Let me show you the data.", emoji: "ğŸ“Š", ap: 3, cost: 20, eff: { dev: 2, mkt: 2 }, mood: 2 },
          { text: "Work on both at the same time", reaction: "Ambitious. I'll make it work.", emoji: "ğŸ™‚", ap: 4, cost: 35, eff: { mkt: 4, dev: 1 }, mood: 1 },
          { text: "Focus on big deals-we need a name", reaction: "Big logos look good. But they don't compound.", emoji: "ğŸ¤·", ap: 3, cost: 25, eff: { mkt: 4, cash: 80 }, mood: -1 }
        ]
      },
      {
        intro: "I've been testing different ways to attract customers. Paid adverts work quickly but eat through our budget. Writing helpful articles and building our reputation takes months to pay off, but those customers find us for free and keep coming.",
        aside: "It's the classic trade-off: pay for customers now, or invest time in building a reputation that attracts them for free later.",
        choices: [
          { text: "Focus on building our reputation", reaction: "Patience. Pays off in six months.", emoji: "ğŸ“Š", ap: 3, cost: 25, eff: { mkt: 3, sci: 1 }, mood: 2 },
          { text: "Do a mix of both", reaction: "Hedge our bets. Sensible.", emoji: "ğŸ™‚", ap: 2, cost: 30, eff: { mkt: 4 }, mood: 1 },
          { text: "Spend on ads for quick results", reaction: "Buy growth now. Figure out the economics later.", emoji: "ğŸ¤·", ap: 2, cost: 35, eff: { mkt: 5, cash: -20 }, mood: -1 }
        ]
      },
      {
        intro: "I want to test two different versions of our pricing page to see which one gets more people to sign up. We'd show half our visitors one version and half the other, then see which performs better. Could boost sign-ups, or might just confuse people.",
        aside: "At our size, even a small improvement in sign-ups makes a real difference to revenue. But we need to test properly to know what's actually working.",
        choices: [
          { text: "Run a proper test with enough visitors", reaction: "Data will tell us what works.", emoji: "ğŸ“Š", ap: 2, cost: 15, eff: { mkt: 3, dev: 1 }, mood: 2 },
          { text: "Quick test, pick a winner fast", reaction: "Faster learning, less certainty.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 2 }, mood: 1 },
          { text: "Just pick what feels right", reaction: "Could be right. Could be expensive.", emoji: "ğŸ¤·", ap: 1, cost: 0, eff: { mkt: 2, dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We're spending money on adverts, social media, and conferences, but we have no idea which ones actually bring in customers. Someone signs up and we can't tell if they came from our CareerHub post, a search engine, or a friend's recommendation.",
        aside: "We're flying blind. We can't stop wasting money on things that don't work if we don't know what's working in the first place.",
        choices: [
          { text: "Build proper tracking systems", reaction: "Finally we'll know what's working.", emoji: "ğŸ“Š", ap: 4, cost: 30, eff: { mkt: 3, dev: 2 }, mood: 2 },
          { text: "Add basic tracking to the main channels", reaction: "Better than nothing. Not perfect.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2, dev: 1 }, mood: 0 },
          { text: "Accept we won't have perfect data", reaction: "Flying blind. It's a choice.", emoji: "ğŸ¤·", ap: 1, cost: 0, eff: { mkt: 2, dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "I've analysed how much different customers spend with us over time. Large companies pay us ten times more than small businesses, and they stick around longer too. The question is: should we focus all our energy on big companies, or keep serving everyone?",
        aside: "Focusing means saying no to some customers. But spreading ourselves thin means we might not serve anyone well.",
        choices: [
          { text: "Focus on large companies", reaction: "Go where the money is. Smart.", emoji: "ğŸ“Š", ap: 3, cost: 20, eff: { mkt: 4, cash: 40 }, mood: 2 },
          { text: "Build different products for each", reaction: "More work, more options.", emoji: "ğŸ™‚", ap: 4, cost: 35, eff: { mkt: 3, dev: 2 }, mood: 0 },
          { text: "Keep serving everyone equally", reaction: "Spreading thin. But diversified.", emoji: "ğŸ¤·", ap: 1, cost: 5, eff: { mkt: 3, hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "UK fintech community event. Could present case study showing our impact.",
        aside: "Showing real results beats marketing claims every time.",
        choices: [
          { text: "Detailed case study presentation", reaction: "Numbers speak louder than promises.", emoji: "ğŸ“Š", ap: 4, cost: 25, eff: { mkt: 4, sci: 1 }, mood: 2 },
          { text: "Panel participation", reaction: "Lower effort, still visible.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 1 },
          { text: "Skip-focus on direct sales", reaction: "Direct relationships matter more.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "What if we let people use a basic version of our product for free? Some of them would eventually upgrade to paid. It could attract lots of users who'd never have talked to our sales team-but it might also mean people who would have paid now get it free instead.",
        aside: "Some companies grow massively by giving away a free version. Others just lose money. We need to figure out which we'd be.",
        choices: [
          { text: "Launch a free version with paid upgrades", reaction: "Attract lots of users. Convert some later. Long-term play.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { mkt: 6, hr: 1 }, mood: 2 },
          { text: "Offer a time-limited free trial instead", reaction: "More controlled. Less viral but better conversion.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3, cash: 20 }, mood: 1 },
          { text: "Stick with salespeople finding customers", reaction: "More personal. Harder to scale but predictable.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 2, cash: 20 }, mood: 0 }
        ]
      },
      {
        intro: "CloudForce CRM wants us to build on their platform. We'd get access to their millions of business customers through their app store, but we'd have to follow their rules, pay their fees (20-30% of revenue), and our product would only work inside CloudForce. If they change their policies or decide to build something similar, we're vulnerable.",
        aside: "Building on big companies' platforms offers easy access to customers but creates dependency. Some of the most successful startups were built on platforms. Some were also destroyed by them overnight.",
        choices: [
          { text: "Go all-in on CloudForce", reaction: "Their customers become ours. Our fate becomes theirs.", emoji: "ğŸ“Š", ap: 4, cost: 35, eff: { mkt: 5, dev: 2, cash: 60 }, mood: 2 },
          { text: "Build for CloudForce but keep standalone version", reaction: "Hedged bet. More work, but not locked in.", emoji: "ğŸ™‚", ap: 4, cost: 45, eff: { mkt: 3, dev: 1, cash: 40 }, mood: 1 },
          { text: "Stay independent-find customers ourselves", reaction: "Freedom, but we find customers the hard way.", emoji: "ğŸ¤·", ap: 2, cost: 15, eff: { mkt: 1, dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Orion Tech has changed App Marketplace rules again. The new policy affects how we can offer subscriptions and could reduce our revenue by 15%. We can comply and take the hit, try to work around the rules (risky), or move our business model outside the app entirely.",
        aside: "When you build on someone else's platform, you play by their rules-and those rules can change without warning. App Store changes have killed companies overnight.",
        choices: [
          { text: "Comply and absorb the revenue hit", reaction: "Safe but painful. We stay on the platform.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { mkt: 1, cash: -30 }, mood: 0 },
          { text: "Restructure to work around the rules", reaction: "Creative interpretation. Hope Orion Tech doesn't notice or care.", emoji: "ğŸ¤·", ap: 3, cost: 25, eff: { mkt: 2, cash: -10, dev: -1 }, mood: -1 },
          { text: "Move subscriptions outside the app", reaction: "Keep revenue but worse user experience. Orion Tech won't promote us.", emoji: "ğŸ“Š", ap: 3, cost: 30, eff: { mkt: -1, cash: 20, dev: 1 }, mood: 1 }
        ]
      },
      {
        intro: "Titan Cloud has launched a product that competes directly with ours. They're offering it free for small users and cheap for everyone else. The problem is, we run our entire business on Titan's servers. Staying means paying money to a company that's now our competitor; leaving means months of work moving everything somewhere else.",
        aside: "The big tech companies increasingly compete with the startups that depend on them. Cloud providers have all launched products that crushed smaller companies built on their platforms.",
        choices: [
          { text: "Move to a different provider", reaction: "Months of work, but we control our own destiny now.", emoji: "ğŸ˜Š", ap: 4, cost: 50, eff: { dev: 4, mkt: 2 }, mood: 2 },
          { text: "Spread across multiple providers", reaction: "More complicated to manage, but we're not dependent on anyone.", emoji: "ğŸ™‚", ap: 3, cost: 35, eff: { dev: 3, mkt: 1 }, mood: 1 },
          { text: "Stay and compete on quality", reaction: "Hope we can stand out. They have more resources.", emoji: "ğŸ¤·", ap: 1, cost: 15, eff: { dev: 1, mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Nexus Corp wants to feature us in their online store for business software and include us in bundles they sell to large companies. Great exposure, but they want exclusivity-we couldn't also sell through other enterprise marketplaces. The deal would double our list of potential big customers but tie us to one partner.",
        aside: "Exclusive deals offer guaranteed visibility but limit options. If the relationship sours or Nexus's business declines, you've put all your eggs in one basket.",
        choices: [
          { text: "Accept exclusivity for the exposure", reaction: "Nexus Corp's sales team sells for us. We're married now.", emoji: "ğŸ“Š", ap: 3, cost: 25, eff: { mkt: 5, cash: 80, dev: -1 }, mood: 2 },
          { text: "Negotiate non-exclusive with less promotion", reaction: "Keep options open. Less support from Nexus.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { mkt: 3, cash: 40 }, mood: 1 },
          { text: "Decline and stay independent", reaction: "No special treatment. Complete freedom.", emoji: "ğŸ¤·", ap: 2, cost: 10, eff: { mkt: 1, cash: 20 }, mood: 0 }
        ]
      },
      {
        intro: "A service we rely on-run by a major tech company-has announced it's no longer free. What cost us nothing will now cost Â£50,000 per year. We've built our entire product using their service. The alternative is spending six months building our own replacement.",
        aside: "When you build on top of someone else's service, you're at their mercy. They often start free to attract users, then charge once everyone depends on them.",
        choices: [
          { text: "Pay the new price and continue", reaction: "Absorb the cost. We're stuck with them.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 1, cash: -50 }, mood: -1 },
          { text: "Start building our own replacement", reaction: "Six months of work, but we control our own destiny.", emoji: "ğŸ˜Š", ap: 4, cost: 40, eff: { dev: 5, mkt: 1 }, mood: 2 },
          { text: "Negotiate-we're a big customer", reaction: "Worth a try. They might offer better terms.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { dev: 2, mkt: 1 }, mood: 1 }
        ]
      },
      {
        intro: "A major platform wants us to connect more tightly with them-using their login system, their payment processing, their tracking tools. It would make things smoother for users, but each connection makes us more dependent on them. They're essentially asking us to become part of their world.",
        aside: "Tighter connections create a better product but make it harder to leave. The more you weave yourself into their systems, the more painful it becomes to untangle.",
        choices: [
          { text: "Full connection-best experience for users", reaction: "Seamless product. We're deeply embedded now.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { dev: 4, mkt: 4 }, mood: 2 },
          { text: "Connect selectively-keep some independence", reaction: "Good enough experience. Some escape routes remain.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 3, mkt: 2 }, mood: 1 },
          { text: "Minimal connection-stay able to move", reaction: "Less polished but we're not trapped.", emoji: "ğŸ¤·", ap: 1, cost: 10, eff: { dev: 1, mkt: 1 }, mood: 0 }
        ]
      }
    ],
    
    // EMMA BERGSTRÃ–M - The Brand Strategist
    emma: [
      {
        intro: "Our brand says 'responsible AI'. But are we walking the talk? This matters for trust.",
        aside: "Brand is a promise. Breaking it costs more than building it.",
        choices: [
          { text: "Substance-heavy responsibility campaign", reaction: "Win trust from skeptical creatives.", emoji: "ğŸ˜Š", ap: 4, cost: 25, eff: { mkt: 3, hr: 1 }, mood: 2 },
          { text: "Lighter awareness campaign", reaction: "Gets attention. Won't convince critics.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 0 },
          { text: "Let product speak for itself", reaction: "Quality wins. Customers notice.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Time for a rebrand? Current identity was done quickly. Doesn't reflect where we are.",
        aside: "Rebrand is expensive and risky. But so is looking like a startup forever.",
        choices: [
          { text: "Full rebrand with agency", reaction: "Investment in how world sees us.", emoji: "ğŸ˜Š", ap: 5, cost: 40, eff: { mkt: 4, hr: 1 }, mood: 2 },
          { text: "Brand refresh-evolution not revolution", reaction: "Update without losing recognition.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { mkt: 2 }, mood: 1 },
          { text: "Keep current identity", reaction: "Brand consistency. Recognition builds.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Financial Times journalist wants access for profile piece. Opportunity and risk.",
        aside: "Press can make or break perception. FT audience is exactly who we want.",
        choices: [
          { text: "Full access, authentic story", reaction: "Trust them to see us fairly.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: 4 }, mood: 2 },
          { text: "Controlled access, managed narrative", reaction: "Less authentic, more predictable.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 0 },
          { text: "Decline-too risky", reaction: "Play it safe. Protect our reputation.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "London Tech Week sponsorship opportunity. High visibility, high cost, unclear ROI.",
        aside: "Not everything valuable can be measured. Be thoughtful about brand moments.",
        choices: [
          { text: "Premium sponsorship, strong presence", reaction: "Big statement. Make it count.", emoji: "ğŸ˜Š", ap: 5, cost: 45, eff: { mkt: 4 }, mood: 1 },
          { text: "Smaller presence, quality focus", reaction: "Less noise, more signal.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { mkt: 2 }, mood: 1 },
          { text: "Skip this one", reaction: "Save energy for the right moment.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Competitors getting aggressive with claims. Should we respond or stay above it?",
        aside: "Brand is long game. Don't let competitors dictate strategy.",
        choices: [
          { text: "Rise above, focus on strengths", reaction: "Dignity wins long-term.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: 2, hr: 1 }, mood: 2 },
          { text: "Subtle comparison content", reaction: "Tasteful differentiation.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { mkt: 3 }, mood: 0 },
          { text: "Direct competitive response", reaction: "Gets us in the mud. Sometimes necessary.", emoji: "ğŸ˜", ap: 3, cost: 25, eff: { mkt: 3, hr: -1 }, mood: -1 }
        ]
      },
      {
        intro: "UK art school wants student programme using our creative AI tools.",
        aside: "Students become professionals. Early adoption becomes habit.",
        choices: [
          { text: "Fund structured programme", reaction: "Inventive, chaotic use cases.", emoji: "ğŸ˜Š", ap: 4, cost: 25, eff: { mkt: 3, sci: 1 }, mood: 2 },
          { text: "Free licenses, minimal support", reaction: "Students enjoy. Fewer learnings.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 2 }, mood: 0 },
          { text: "Focus on existing creators", reaction: "Deepen relationships. Quality over quantity.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "The board wants us to write up our clinical evidence-a proper document explaining what our product does and the research behind it. The question is: do we make it detailed and scientific, or polished and exciting?",
        aside: "Doctors want to see rigorous evidence and honest limitations. Investors want confident success stories. Hard to please both.",
        choices: [
          { text: "Write a detailed, careful document", reaction: "Clinicians quietly approve.", emoji: "ğŸ˜Š", ap: 4, cost: 25, eff: { mkt: 3, sci: 2 }, mood: 2 },
          { text: "Make it polished and optimistic", reaction: "Investors love it. Our ethics advisor winces.", emoji: "ğŸ˜", ap: 3, cost: 20, eff: { mkt: 3, sci: -1 }, mood: 0 },
          { text: "Wait until we have more results", reaction: "Stronger story when ready.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 2 }, mood: 0 }
        ]
      },
      {
        intro: "London PR agency pitching us. Top-tier tech specialists. Not cheap.",
        aside: "PR opens doors media training can't. Question is timing.",
        choices: [
          { text: "Hire top-tier agency", reaction: "Press mentions increase. Inbox fills.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { mkt: 3 }, mood: 2 },
          { text: "Smaller specialist agency", reaction: "Targeted coverage. Lower retainers.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 1 },
          { text: "Keep comms in-house", reaction: "Move slowly. Stay authentic.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 2, hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our CTO has been invited to speak on a podcast popular with developers. She's brilliant but unfiltered-she says what she thinks. Last time she did an interview, she accidentally confirmed a feature we hadn't announced and criticised a competitor by name.",
        aside: "Authentic voices build trust. But uncontrolled messaging can cause problems. Some founders never let anyone but themselves speak publicly.",
        choices: [
          { text: "Let her speak freely-authenticity matters", reaction: "Developers love her honesty. Hope she doesn't reveal anything sensitive.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: 4, hr: 1, dev: -1 }, mood: 2 },
          { text: "Brief her carefully on what to avoid", reaction: "Prepared but might sound rehearsed.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3 }, mood: 1 },
          { text: "Decline or send someone else", reaction: "Delegate wisely. Focus on priorities.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "An industry analyst wants to write about us in their market report. These reports influence enterprise buyers, but they ask very detailed questions about our technology, market share, pricing, and roadmap. Competitors subscribe to these reports too.",
        aside: "Analyst coverage is incredibly valuable for enterprise sales. But analyst reports are read by everyone in the industry, including competitors.",
        choices: [
          { text: "Full briefing with detailed answers", reaction: "Comprehensive coverage. The whole market learns about us.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { mkt: 5, dev: -1 }, mood: 2 },
          { text: "Careful briefing, some questions deflected", reaction: "Decent coverage, some gaps. Analyst slightly frustrated.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { mkt: 3 }, mood: 1 },
          { text: "Decline to participate", reaction: "Stay out of the spotlight. Focus on product.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our junior sales rep was at a trade show and got talking to someone who turned out to be a competitor. She enthusiastically explained our new features, pricing model, and upcoming roadmap. She didn't realise who she was talking to until too late.",
        aside: "Competitors often gather intelligence at trade shows by chatting with junior staff. Training helps, but enthusiasm is hard to contain.",
        choices: [
          { text: "Train all staff on information security", reaction: "Formal process. Changes the culture.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { mkt: 1, hr: 2, dev: 1 }, mood: 2 },
          { text: "Restrict who attends external events", reaction: "Controlled. Information stays protected.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2, mkt: 1 }, mood: 0 },
          { text: "Accept it-information spreads anyway", reaction: "Pragmatic. Focus on execution.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A journalist wants to interview three of our engineers for a 'day in the life' piece about AI startups. Great PR, but engineers often share details about problems they're working on, technical approaches, and even frustrations with the product.",
        aside: "Human interest stories require access. But engineers speak engineer-they describe problems in detail and share what they're building. That's often more than we'd tell competitors directly.",
        choices: [
          { text: "Allow interviews with media training first", reaction: "Authentic but prepared. Takes time from engineering.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { mkt: 4, hr: 1, dev: -1 }, mood: 2 },
          { text: "Approve but have comms person present", reaction: "Safety net. Might feel less authentic.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3 }, mood: 1 },
          { text: "Decline or offer exec interviews only", reaction: "Controlled message. Protect the team.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We're about to announce a partnership with a major tech company. Both PR teams are drafting the press release. Their team wants to include technical details that would help their narrative but reveal more about our capabilities than we'd normally share publicly.",
        aside: "Joint announcements mean shared control. What benefits their story might expose our secrets. Once it's in a press release, it's public forever.",
        choices: [
          { text: "Push back on sensitive details", reaction: "They're annoyed but our secrets stay private.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: 3, dev: 1 }, mood: 2 },
          { text: "Accept their draft for the relationship", reaction: "Smooth partnership. More revealed than ideal.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 4, dev: -1 }, mood: 1 },
          { text: "Insist on separate announcements", reaction: "Full control. Less impressive than joint announcement.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { mkt: 2 }, mood: 0 }
        ]
      },
      {
        intro: "Marketing wants to claim our product is 'sustainable' and 'eco-friendly'. We've made some genuine improvements-more efficient code, greener hosting-but we're not carbon neutral. Is it honest to market ourselves as green, or is it greenwashing?",
        aside: "Sustainability claims attract customers and talent. But exaggerated claims can backfire badly if journalists or activists dig deeper. Authenticity matters more than ever.",
        choices: [
          { text: "Only claim what we can fully prove", reaction: "Modest claims. Completely defensible.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: 2, hr: 1 }, mood: 2 },
          { text: "Highlight progress while acknowledging gaps", reaction: "Honest about the journey. Shows self-awareness.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3, hr: 1 }, mood: 1 },
          { text: "Use green messaging-everyone does", reaction: "Market expects it. Customers respond.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 3 }, mood: 0 }
        ]
      },
      {
        intro: "Our advertising could target people who are vulnerable to our product-those with addictive tendencies, people in financial distress, or teenagers who might not make good decisions. It would be effective marketing, but it feels predatory.",
        aside: "Targeted advertising is powerful precisely because it finds people when they're most susceptible. Where's the line between good marketing and exploitation?",
        choices: [
          { text: "Exclude vulnerable groups from targeting", reaction: "Builds trust and brand reputation. Sustainable growth.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { mkt: 3, hr: 2 }, mood: 2 },
          { text: "General targeting only-no personal data", reaction: "Less precise but respected. Word spreads.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3, hr: 1 }, mood: 1 },
          { text: "Use all legal targeting options", reaction: "Short-term boost. Long-term reputation risk.", emoji: "ğŸ˜", ap: 1, cost: 5, eff: { mkt: 3 }, mood: -1 }
        ]
      },
      {
        intro: "A charity has asked us to donate our product for free to help their cause. It's genuinely worthy work, but we're stretched thin and giving away our product devalues it. Also, their work is mildly politically controversial-some customers might not approve.",
        aside: "Corporate giving is expected, but choosing causes is tricky. Supporting one thing can alienate people who disagree. Staying neutral pleases no one.",
        choices: [
          { text: "Full donation and public partnership", reaction: "Visible support. Some customers uncomfortable.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { mkt: 3, hr: 2, cash: -20 }, mood: 2 },
          { text: "Quiet donation without publicity", reaction: "Help without controversy. No marketing benefit.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { hr: 1, cash: -15 }, mood: 1 },
          { text: "Politely decline-not the right fit", reaction: "Know our strengths. Stay focused.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We're planning a big marketing event-maybe a conference or product launch. We could make it in-person for maximum impact, or virtual for lower carbon footprint. In-person events build relationships but require hundreds of people to fly in.",
        aside: "Events are powerful for building community. But the environmental cost of flying hundreds of people to one place is significant. Virtual events reach more people with less impact.",
        choices: [
          { text: "Virtual event-minimise travel", reaction: "Smaller carbon footprint. Less personal connection.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { mkt: 2, hr: 1 }, mood: 2 },
          { text: "Regional events-reduce long-distance travel", reaction: "Compromise. More work, less flying.", emoji: "ğŸ™‚", ap: 4, cost: 35, eff: { mkt: 3 }, mood: 1 },
          { text: "Big in-person event-nothing beats face-to-face", reaction: "Maximum impact. Maximum emissions.", emoji: "ğŸ˜", ap: 3, cost: 40, eff: { mkt: 5, hr: -1 }, mood: 0 }
        ]
      },
      {
        intro: "Marketing wants to describe our AI as 'intelligent', 'thinking', or 'understanding'. These words help people grasp what it does, but they're also misleading-the system doesn't actually think or understand in any meaningful sense. More accurate language is less compelling.",
        aside: "AI marketing is full of human-like language that makes software sound like a person. It sells, but it also creates unrealistic expectations and obscures what these systems actually are. The field is increasingly criticised for hype.",
        choices: [
          { text: "Use accurate technical language", reaction: "Harder to sell. Builds trust with informed buyers.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: 1, sci: 2 }, mood: 2 },
          { text: "Accessible language with clear caveats", reaction: "Help people understand while being honest. Balance.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3, sci: 1 }, mood: 1 },
          { text: "Use whatever language sells", reaction: "Effective marketing. Customers engaged.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 4 }, mood: 0 }
        ]
      },
      {
        intro: "Our demo shows our AI working flawlessly, but real-world performance is messier-it fails maybe 15% of the time. Sales wants to show the perfect demo; some team members think we should show realistic performance including failures.",
        aside: "Demos are always polished versions of reality. But AI demos have been particularly criticised for showing capabilities that don't generalise. Setting realistic expectations builds trust; overselling creates disappointed customers.",
        choices: [
          { text: "Show realistic performance including failures", reaction: "Honest. Lose some deals to companies that oversell.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: 1, hr: 2 }, mood: 2 },
          { text: "Polished demo with clear performance caveats", reaction: "Best foot forward with honesty. Industry standard.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3, hr: 1 }, mood: 1 },
          { text: "Show the best case-everyone else does", reaction: "Win more deals. Standard practice.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 4 }, mood: 0 }
        ]
      },
      {
        intro: "A journalist is writing about AI risks and wants our comment. We could engage thoughtfully and show we take safety seriously, or we could decline and avoid being associated with the 'doom' narrative. Our comments might be taken out of context either way.",
        aside: "AI companies are caught between seeming dismissive of risks and seeming to validate existential fears. Thoughtful engagement can help the discourse or backfire spectacularly depending on framing.",
        choices: [
          { text: "Engage thoughtfully with nuanced answers", reaction: "Contribute to serious discourse. Risk misrepresentation.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: 2, sci: 1 }, mood: 2 },
          { text: "Provide a brief, careful statement", reaction: "On record but minimal. Less interesting to journalists.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 1 }, mood: 1 },
          { text: "Decline to comment on risks", reaction: "Stay neutral. Let the tech speak.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We have 500 users. Marketing wants to say we have 'thousands of users' by counting everyone who ever created an account, including test accounts and people who signed up once and never returned. Technically defensible. Obviously misleading.",
        aside: "Vanity metrics are everywhere in startups. 'Users' can mean anything from 'paying customers' to 'people who clicked a link once'. Everyone knows this, but inflated numbers still impress investors and journalists.",
        choices: [
          { text: "Report only meaningful metrics", reaction: "Smaller numbers. More credible to sophisticated buyers.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: 1, hr: 2 }, mood: 2 },
          { text: "Use industry-standard definitions", reaction: "Match what others report. Comparable but still fuzzy.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 2 }, mood: 1 },
          { text: "Pick the biggest defensible number", reaction: "Looks impressive. Technically accurate.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 3 }, mood: 0 }
        ]
      },
      {
        intro: "A competitor just announced a feature we've been working on. They shipped first. Marketing wants to put out a release saying we're 'launching' the same feature-but ours won't actually be ready for two months. We'd be announcing vaporware to avoid looking like we're behind.",
        aside: "Announcing products before they exist is a time-honoured tech tradition. It can freeze the market while you catch up. It can also destroy trust when customers realise they can't actually buy what you announced.",
        choices: [
          { text: "Only announce what's ready", reaction: "Look behind. Ship when we ship.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: -1, hr: 2, dev: 1 }, mood: 2 },
          { text: "Announce a 'preview' with honest timeline", reaction: "Signal we're coming. Set realistic expectations.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 1 },
          { text: "Announce as if it's ready now", reaction: "Build anticipation. Lock in customers.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 3 }, mood: 0 }
        ]
      },
      {
        intro: "Our website says we use 'cutting-edge AI' and 'machine learning'. In reality, our core product is mostly traditional software with a small ML component. Our AI positioning has helped us get meetings and coverage. Changing it now would undermine our story.",
        aside: "AI washing is rampant-companies rebrand ordinary software as 'AI-powered' for the hype. Some have actual AI; many don't. Sophisticated buyers are increasingly sceptical. But the positioning still opens doors.",
        choices: [
          { text: "Describe our technology accurately", reaction: "Less exciting. More honest. Some doors close.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: -1, hr: 2, sci: 1 }, mood: 2 },
          { text: "AI-assisted-accurate but positioned", reaction: "We do use some AI. Emphasise it appropriately.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2, sci: 0 }, mood: 1 },
          { text: "Keep the AI story-it's working", reaction: "Ride the wave. Brand resonates.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 4 }, mood: 0 }
        ]
      },
      {
        intro: "We published a case study claiming our product helped a customer increase efficiency by 40%. That's what they told us. We didn't verify it independently-and when we dig in, their methodology is questionable. The case study is all over our website and sales materials.",
        aside: "Customer success stories are marketing gold. But customers sometimes exaggerate, misattribute, or just get the numbers wrong. Once it's published, pulling it is embarrassing; leaving it up is risky.",
        choices: [
          { text: "Pull it and verify future claims", reaction: "Embarrassing. Establishes a standard.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: -1, hr: 2 }, mood: 2 },
          { text: "Add caveats and soften the claims", reaction: "Water it down. Less impressive, more defensible.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 1 }, mood: 1 },
          { text: "Leave it-it's what they told us", reaction: "Trust the customer. Move forward.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
        ]
      }
    ]
  },
  
  hr: {
    // DAVID OKONKWO - The Process Builder
    david: [
      {
        intro: "We've grown without updating policies. Inconsistencies in how managers handle things. Creating resentment.",
        aside: "Not bureaucracy. Preventing lawsuits and unfairness.",
        choices: [
          { text: "Proper policy refresh with input", reaction: "Draft something fair. Get buy-in.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { hr: 4, dev: 1 }, mood: 2 },
          { text: "Quick fixes to urgent gaps", reaction: "Not ideal. Prioritise what's risky.", emoji: "ğŸ˜", ap: 1, cost: 10, eff: { hr: 2 }, mood: 0 },
          { text: "Stay informal-we're small", reaction: "Move fast. No bureaucracy.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Brilliant candidate needs Skilled Worker visa sponsorship. Expensive, bureaucratic, but she's perfect.",
        aside: "Immigration compliance is complex. But UK talent market is tight.",
        choices: [
          { text: "Sponsor and hire", reaction: "Paperwork painful but worth it.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { hr: 3, sci: 2 }, mood: 2 },
          { text: "Contractor while sorting visa", reaction: "Workaround. Might work.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { hr: 1, sci: 1 }, mood: 0 },
          { text: "Pass on this candidate", reaction: "Wait for the right fit. Standards matter.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We need to set up a proper way for employees to own shares in the company. There's a government-approved scheme that gives big tax savings, but it's complicated and expensive to set up properly. The simpler option costs employees more in tax when they eventually sell.",
        aside: "People join startups partly hoping for a big payout if things go well. Getting the share scheme right helps us keep our best people.",
        choices: [
          { text: "Set up the tax-efficient scheme properly", reaction: "Worth the investment. Employees benefit.", emoji: "ğŸ˜Š", ap: 4, cost: 25, eff: { hr: 5 }, mood: 2 },
          { text: "Use the simpler but less tax-friendly option", reaction: "Faster to set up, but employees pay more tax.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { hr: 2 }, mood: 0 },
          { text: "Put off the equity discussion for now", reaction: "Focus on product first. Deal with it later.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Two team leads in open conflict. Affecting collaboration across teams.",
        aside: "Conflicts don't resolve themselves. Early intervention prevents escalation.",
        choices: [
          { text: "Professional mediation, clear process", reaction: "Proper approach. Both feel heard.", emoji: "ğŸ˜Š", ap: 4, cost: 15, eff: { hr: 4, dev: 1 }, mood: 2 },
          { text: "Founder-led conversation", reaction: "Personal touch. Might work.", emoji: "ğŸ˜", ap: 2, cost: 5, eff: { hr: 2 }, mood: 0 },
          { text: "Let them work it out", reaction: "Empowerment builds problem-solving culture.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "First redundancy needed. Must do it properly under UK employment law.",
        aside: "How we handle this defines us. Everyone watching.",
        choices: [
          { text: "Full support: notice, outplacement", reaction: "Painful but right. Team notices.", emoji: "ğŸ˜Š", ap: 4, cost: 20, eff: { hr: 2 }, mood: 2 },
          { text: "Statutory minimum, clean exit", reaction: "Legal but not generous.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { hr: 0 }, mood: 0 },
          { text: "Pressure them to resign", reaction: "Quick resolution. Move forward.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Performance review process inconsistent. Some managers formal, others never do them.",
        aside: "Fair feedback helps everyone improve. Inconsistency breeds resentment.",
        choices: [
          { text: "Standardised review process", reaction: "Clear expectations for everyone.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { hr: 3, dev: 1 }, mood: 2 },
          { text: "Light framework, manager discretion", reaction: "Guidance without bureaucracy.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { hr: 2 }, mood: 0 },
          { text: "Trust managers to handle it", reaction: "Empower leadership. Build management skills.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We need to decide what employees can say publicly about their work. Some companies require all external communication to be pre-approved. Others let people tweet freely. Engineers want to share what they're building; our lawyers worry about accidental disclosure.",
        aside: "Overly restrictive policies kill morale and hurt recruiting. But one careless tweet can reveal product plans or create legal problems.",
        choices: [
          { text: "Strict approval for anything work-related", reaction: "Maximum control. Engineers frustrated. Slower recruiting.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { hr: -1, dev: 1, mkt: 1 }, mood: -1 },
          { text: "Guidelines with common-sense rules", reaction: "Balance freedom with awareness. Most people will be sensible.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { hr: 2, mkt: 2 }, mood: 2 },
          { text: "Trust people-we hired adults", reaction: "Maximum freedom. Adults deliver.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 3, mkt: 3 }, mood: 1 }
        ]
      },
      {
        intro: "An employee has been posting detailed technical content on their personal blog-debugging stories, architectural decisions, and lessons learned. It's great for their personal brand and our recruiting, but some posts come close to revealing proprietary approaches.",
        aside: "Technical blogging attracts talent and builds reputation. But there's a fine line between 'sharing knowledge' and 'documenting our competitive advantage for everyone to read'.",
        choices: [
          { text: "Ask them to run posts by us first", reaction: "Content improves and stays safe. They feel micromanaged.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 0, mkt: 2, dev: 1 }, mood: 0 },
          { text: "Have a conversation about boundaries", reaction: "Trust-based approach. Depends on their judgment.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { hr: 1, mkt: 3 }, mood: 1 },
          { text: "Ask them to stop blogging about work", reaction: "Protect IP. Clear boundaries.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We want to hire from a competitor, and candidates naturally mention what they worked on during interviews. How much should we let them reveal? We'd hate it if our employees did this in reverse, but their knowledge of competitor approaches is valuable.",
        aside: "Interview confidentiality cuts both ways. If we extract information during hiring, competitors will do the same when our people interview elsewhere.",
        choices: [
          { text: "Don't ask about proprietary work", reaction: "Ethical high ground. Miss some useful intelligence.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { hr: 2, dev: 0 }, mood: 2 },
          { text: "Ask about their role, not specific secrets", reaction: "Reasonable middle ground. Learn from their experience without extracting IP.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { hr: 1, dev: 1 }, mood: 1 },
          { text: "Let candidates share what they want", reaction: "Respect autonomy. Build trust.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A departing employee has accepted a job at a competitor. During their notice period, they still have access to our systems, attend meetings, and hear about upcoming plans. Standard practice is to work the notice period, but there's obvious risk.",
        aside: "Garden leave-paying them to stay home-is expensive but prevents knowledge transfer. Working notice periods are normal but create a strange situation.",
        choices: [
          { text: "Garden leave-pay them to stay home", reaction: "Clean separation. Expensive but no access risk.", emoji: "ğŸ˜Š", ap: 2, cost: 25, eff: { hr: 1, dev: 1, cash: -20 }, mood: 1 },
          { text: "Restricted access, limited to handover", reaction: "Partial protection. Slightly awkward.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 0, dev: 1 }, mood: 0 },
          { text: "Normal notice period", reaction: "Fair process. Professional transition.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We're updating our employment contracts. The legal team wants to add a clause requiring employees to assign all inventions to the company-including things they create in their own time if it's 'related to company business'. Engineers hate these clauses.",
        aside: "IP assignment clauses protect the company but can feel overreaching. Top talent often has side projects and might reject offers with broad assignment clauses.",
        choices: [
          { text: "Broad assignment clause-protect everything", reaction: "Maximum legal protection. Some candidates will decline.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { hr: -2, dev: 2 }, mood: -1 },
          { text: "Work-time and work-resources only", reaction: "Reasonable boundary. Personal projects stay personal.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { hr: 2, dev: 1 }, mood: 2 },
          { text: "Case-by-case for senior hires", reaction: "Flexible but inconsistent. Some negotiation on each offer.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { hr: 1, dev: 1 }, mood: 1 }
        ]
      },
      {
        intro: "Looking at our hiring over the past year, we've mostly hired people from the same few universities, with similar backgrounds and experiences. Whether you call it a diversity problem or just a narrow pipeline, we're probably missing good candidates we never even see. Changing this means rethinking where we look, how we evaluate, and what we're actually optimising for.",
        aside: "Hiring is full of unconscious patterns. Some argue for structured changes; others worry about lowering standards or creating new unfairnesses. The research on team composition is real but contested. There's no approach that everyone agrees is fair.",
        choices: [
          { text: "Redesign the hiring process systematically", reaction: "Significant investment. Opens up who we see and how we evaluate.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { hr: 4, dev: 1, mkt: 1 }, mood: 2 },
          { text: "Expand where we look, keep evaluation the same", reaction: "Wider net. Same filter. May or may not change outcomes.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { hr: 2 }, mood: 1 },
          { text: "Focus on the candidates in front of us", reaction: "Work with what's available. Get hiring.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "The Immigration Authority wants to audit our sponsor licence. As a visa sponsor, we're required to keep meticulous records-copies of passports, attendance monitoring, contact details, and we must report within 10 days if a sponsored employee stops coming to work, changes role, or leaves. Our record-keeping has been... informal. We have two weeks to prepare.",
        aside: "Sponsor licence compliance is serious. Failed audits can mean losing the licence, which would mean all your sponsored employees losing their right to work. The Immigration Authority isn't forgiving about sloppy paperwork.",
        choices: [
          { text: "Emergency audit prep-get everything in order", reaction: "All hands on deck. Find the gaps, fix them fast.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { hr: 3, dev: -1 }, mood: 1 },
          { text: "Hire immigration consultants to help", reaction: "Expensive but they know exactly what auditors look for.", emoji: "ğŸ™‚", ap: 2, cost: 40, eff: { hr: 2, cash: -25 }, mood: 1 },
          { text: "Do our best with what we have", reaction: "Make it work. Resourceful approach.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our sponsored data scientist has handed in his notice-he's moving to a competitor. Under visa rules, we must report this to the Immigration Authority within 10 working days, which will trigger curtailment of his visa. He's asked us to delay reporting so he has more time to get his new sponsor lined up. Technically, not reporting on time puts our licence at risk.",
        aside: "The reporting rules exist so the Immigration Authority knows where sponsored workers are. But they create an awkward situation when someone leaves-the departing employee wants flexibility, the company needs to protect its licence.",
        choices: [
          { text: "Report on time-protect our licence", reaction: "By the book. He'll have 60 days to find a new sponsor or leave.", emoji: "ğŸ˜Š", ap: 1, cost: 5, eff: { hr: 1 }, mood: 1 },
          { text: "Delay a few days to help him transition", reaction: "Human gesture. Loyalty earned.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 2 }, mood: 1 },
          { text: "Wait until absolutely required-give him maximum time", reaction: "Compassionate approach. He appreciates it.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We want to promote a sponsored employee from Developer to Tech Lead. Under Skilled Worker rules, significant role changes require notifying the Immigration Authority and sometimes a new visa application. The bureaucracy might take months and cost another few thousand pounds, during which her status is uncertain. Or we could keep her job title technically the same and just give her more responsibility.",
        aside: "Visa categories are rigid; careers are fluid. Many companies quietly stretch job descriptions to avoid constant visa updates. It's technically non-compliant but extremely common.",
        choices: [
          { text: "Do it properly-new visa application", reaction: "Expensive and slow, but fully compliant. She deserves the real title.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { hr: 2, dev: 1, cash: -15 }, mood: 2 },
          { text: "Expand responsibilities without changing title", reaction: "Common workaround. Not entirely kosher. Probably fine.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1, dev: 1 }, mood: 0 },
          { text: "Wait until her visa renewal to make the change", reaction: "Smooth transition. Less disruption.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 2 }, mood: 0 }
        ]
      },
      {
        intro: "Some employees want to use our office space for political organising-hosting meetings for a local campaign. They say it's part of being an engaged citizen. Others worry it politicises the workplace and makes people who disagree uncomfortable.",
        aside: "Workplaces are communities. But they're also places where people with different views have to work together. Political activity can unite or divide.",
        choices: [
          { text: "Allow after-hours use for any legal cause", reaction: "Neutral policy. Some tension inevitable.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 1 }, mood: 1 },
          { text: "Keep the office politically neutral", reaction: "Professional environment. Everyone included.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 },
          { text: "Provide paid time for civic engagement", reaction: "Support democracy broadly. Generous but complicated.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { hr: 2, mkt: 1 }, mood: 2 }
        ]
      },
      {
        intro: "We're deciding on our office policy. Full-time in office would help collaboration but means everyone has to commute. Full remote saves commuting emissions and gives flexibility but loses the spontaneous interactions. Hybrid is complicated to manage.",
        aside: "Remote work dramatically reduces commuting emissions. It also changes how teams work together. There's no perfect answer-just trade-offs.",
        choices: [
          { text: "Remote-first with optional office days", reaction: "Maximum flexibility. Lower carbon footprint. Culture changes.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { hr: 3, dev: 1 }, mood: 2 },
          { text: "Hybrid with required team days", reaction: "Balance in-person and remote. Commuting reduced but not eliminated.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { hr: 2, dev: 1 }, mood: 1 },
          { text: "Full-time in office", reaction: "Best for collaboration. Everyone commutes every day.", emoji: "ğŸ˜", ap: 2, cost: 25, eff: { hr: -1, dev: 2 }, mood: -1 }
        ]
      },
      {
        intro: "An employee is going through a personal crisis and their work has suffered. They've used up their sick leave and need more time. Strictly by policy, we'd put them on unpaid leave or start managing them out. But they've been loyal and this is temporary.",
        aside: "Policies exist for good reasons, but life is complicated. How we treat people in hard times defines our culture. Others are watching.",
        choices: [
          { text: "Extend paid leave beyond policy", reaction: "Generous. Sets a precedent. The team notices.", emoji: "ğŸ˜Š", ap: 2, cost: 25, eff: { hr: 4, cash: -15 }, mood: 2 },
          { text: "Unpaid leave with job guarantee", reaction: "By the book but humane. They can come back.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { hr: 2 }, mood: 1 },
          { text: "Follow policy strictly", reaction: "Consistent. Fair. By the book.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A former employee just posted a scathing WorkReview review. Some of it is unfair-they were let go for performance-but some criticisms are legitimate. The review mentions specific managers by name and calls our culture 'toxic'. Candidates are asking about it in interviews.",
        aside: "WorkReview reviews live forever. Responding can help or make things worse. Some companies try to bury bad reviews with fake good ones. Candidates aren't stupid-they can spot patterns.",
        choices: [
          { text: "Respond professionally and address valid points", reaction: "Shows we listen. Doesn't make the review disappear.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { hr: 2, mkt: 1 }, mood: 2 },
          { text: "Ignore it-engaging just draws attention", reaction: "Don't feed the trolls. It fades.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 },
          { text: "Ask current employees to post positive reviews", reaction: "Obvious astroturfing. Often backfires.", emoji: "ğŸ˜", ap: 1, cost: 5, eff: { mkt: 3, hr: -2 }, mood: -1 }
        ]
      },
      {
        intro: "We've noticed our WorkReview rating has dropped from 4.2 to 3.4 over six months. Three recent reviews mention the same issues: unclear promotion criteria, favouritism, and founders who don't listen to feedback. The reviews aren't coordinated-these are independent people saying similar things.",
        aside: "When multiple people say the same thing, it's usually true. WorkReview can be an early warning system if you're willing to hear it. Or you can dismiss it as disgruntled employees.",
        choices: [
          { text: "Take it seriously-investigate the patterns", reaction: "Uncomfortable conversations ahead. Might find real problems.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { hr: 4, dev: 1 }, mood: 2 },
          { text: "Address the specific criticisms publicly", reaction: "Show we're listening. Words need to become actions.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { hr: 2 }, mood: 1 },
          { text: "Dismiss it-unhappy people always complain", reaction: "Focus on the work. Don't get distracted.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A departing employee-one we're sad to lose-asks if we'd like her to leave a WorkReview review. She had a genuinely good experience and wants to help with recruiting. It feels a bit awkward to say yes, but authentic positive reviews are valuable.",
        aside: "There's nothing wrong with happy employees sharing their experience. But asking feels transactional. The best employer brands come from people who want to recommend you without being asked.",
        choices: [
          { text: "Thank her but don't ask for anything specific", reaction: "If she posts, it'll be genuine. If she doesn't, that's fine too.", emoji: "ğŸ˜Š", ap: 1, cost: 5, eff: { hr: 2 }, mood: 2 },
          { text: "Say yes and suggest what to mention", reaction: "Probably still authentic, but now it's coached.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1, mkt: 1 }, mood: 0 },
          { text: "Ask all happy leavers to post reviews", reaction: "Systematic approach. Starts to feel manufactured.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { hr: 0, mkt: 2 }, mood: -1 }
        ]
      },
      {
        intro: "An anonymous WorkReview review contains details that could only come from someone currently on the team. It's critical but not unfair-they're frustrated about real issues. Some managers want to figure out who wrote it. Others think that would be a terrible idea.",
        aside: "Anonymous feedback exists because people fear retaliation. Hunting for the author proves they were right to be anonymous. But knowing there's a deeply unhappy person on your team, and not knowing who, is uncomfortable.",
        choices: [
          { text: "Don't investigate-address the issues raised", reaction: "Trust the feedback, not the identity. Hardest but right.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { hr: 4 }, mood: 2 },
          { text: "General team discussion about the concerns", reaction: "Acknowledge without hunting. See if anyone opens up.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 2 }, mood: 1 },
          { text: "Try to identify the author", reaction: "Witch hunt. Even if you find them, then what?", emoji: "ğŸ˜", ap: 0, cost: 0, eff: { hr: -2 }, mood: -2 }
        ]
      },
      {
        intro: "We just got our first really positive WorkReview review from a recent hire. She loves the culture, praises her manager, says it's the best job she's had. Marketing wants to quote it on our careers page. She didn't know we'd use it publicly when she wrote it.",
        aside: "WorkReview reviews are public, so technically anyone can quote them. But using someone's words in your marketing without asking feels different. And if she ever has a bad experience, that quote will be awkward.",
        choices: [
          { text: "Ask her permission before using it", reaction: "Respectful. She might say yes, might say no.", emoji: "ğŸ˜Š", ap: 1, cost: 5, eff: { hr: 2, mkt: 1 }, mood: 2 },
          { text: "Use it-it's public anyway", reaction: "Authentic testimonial. Customers relate.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1, mkt: 2 }, mood: 1 },
          { text: "Don't use reviews in marketing", reaction: "Ethical stance. Candidates respect it.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 2 }, mood: 1 }
        ]
      }
    ],
    
    // SOFIA RODRIGUEZ - The Culture Champion
    sofia: [
      {
        intro: "Done one-on-ones. People tired. Two engineers updated CareerHubs. Need to talk about how we're working.",
        aside: "Move fast, but lose good people if we don't change something.",
        choices: [
          { text: "Team reset-offsite and honest talk", reaction: "Thank you. Exactly what we need.", emoji: "ğŸ™", ap: 4, cost: 30, eff: { hr: 6, dev: 1 }, mood: 3 },
          { text: "Address individuals at risk", reaction: "Start. Let me identify who.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { hr: 3 }, mood: 1 },
          { text: "Push through-milestone first", reaction: "Team delivers under pressure.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 2 }, mood: 0 }
        ]
      },
      {
        intro: "Several people struggling with stress and anxiety. Support options limited.",
        aside: "Mental health isn't separate from performance. Connected.",
        choices: [
          { text: "Mental health benefits and training", reaction: "Finally. People feel supported.", emoji: "ğŸ™", ap: 3, cost: 20, eff: { hr: 5 }, mood: 2 },
          { text: "Quiet EAP access", reaction: "Something better than nothing.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { hr: 2 }, mood: 0 },
          { text: "Encourage self-management", reaction: "Trust the team. Build autonomy.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Defining company values. Could be meaningful or performative.",
        aside: "Real values guide hard decisions. Fake values worse than none.",
        choices: [
          { text: "Facilitated workshop, genuine input", reaction: "Discover who we really are.", emoji: "ğŸ™", ap: 2, cost: 15, eff: { hr: 4, mkt: 1 }, mood: 2 },
          { text: "Founders draft, team comments", reaction: "Top-down. At least there'll be values.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 2 }, mood: 0 },
          { text: "Skip-culture is how we act", reaction: "Actions speak louder. Lead by example.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Long-serving employee asking for sabbatical. No policy exists.",
        aside: "Flexibility prevents burnout. This person has given a lot.",
        choices: [
          { text: "Approve and create policy", reaction: "Return refreshed. Others see path.", emoji: "ğŸ™", ap: 2, cost: 10, eff: { hr: 4 }, mood: 2 },
          { text: "Approve as one-off", reaction: "Get break. Future unclear.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { hr: 2 }, mood: 1 },
          { text: "Decline-business needs", reaction: "Team stays together. Project continues.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Working parents struggling with childcare costs. London is brutal.",
        aside: "Childcare support increasingly expected. Helps retention.",
        choices: [
          { text: "Childcare benefit programme", reaction: "Meaningful help. Shows we care.", emoji: "ğŸ™", ap: 3, cost: 20, eff: { hr: 4 }, mood: 2 },
          { text: "Flexible hours for parents", reaction: "Costs less. Still helps.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { hr: 2 }, mood: 1 },
          { text: "Keep compensation-focused", reaction: "Competitive pay speaks loudest.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Exit interviews showing pattern: lack of growth opportunities cited.",
        aside: "People leave managers and lack of growth. Fix what we can.",
        choices: [
          { text: "Learning budget and career framework", reaction: "Investment in growth. Retention follows.", emoji: "ğŸ™", ap: 4, cost: 25, eff: { hr: 5, dev: 1 }, mood: 2 },
          { text: "Manager training on development", reaction: "Fix the conversations first.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { hr: 3 }, mood: 1 },
          { text: "Accept some attrition as normal", reaction: "Natural turnover. Fresh perspectives come in.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Anonymous survey results in. Psychological safety scores low in two teams.",
        aside: "Can't innovate if people fear speaking up. Need to address this.",
        choices: [
          { text: "Direct intervention with teams", reaction: "Surface issues. Work through them.", emoji: "ğŸ™", ap: 4, cost: 15, eff: { hr: 4, dev: 1 }, mood: 2 },
          { text: "Manager coaching privately", reaction: "Change behaviour quietly.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 2 }, mood: 0 },
          { text: "Monitor and see if improves", reaction: "Gather data. Make informed decisions.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Some employees are pushing for us to take a public stand on a social issue-climate change, inequality, or a political cause. They say silence is complicity. Others just want to do their jobs without the company being political.",
        aside: "Corporate activism is expected by some, rejected by others. Taking a stand can attract talent and customers who agree, while alienating those who don't.",
        choices: [
          { text: "Take a clear public stand", reaction: "We believe in something. Some applaud, others leave.", emoji: "ğŸ™", ap: 3, cost: 20, eff: { hr: 2, mkt: 2 }, mood: 1 },
          { text: "Support causes quietly, no public stance", reaction: "Do good without controversy. Feels cowardly to some.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { hr: 1, mkt: 0 }, mood: 0 },
          { text: "Stay neutral-we're a business", reaction: "Focus on product. Avoid politics.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our office produces a lot of waste-disposable cups, food packaging, electronic waste. Some employees want to make the office more sustainable with composting, reusables, and better recycling. It would cost money and require changing habits.",
        aside: "Small actions add up. They also signal what we value as a company. People notice whether we practice what we preach.",
        choices: [
          { text: "Full sustainability overhaul", reaction: "Walk the talk. Initial hassle, lasting benefits.", emoji: "ğŸ™", ap: 3, cost: 25, eff: { hr: 3, mkt: 1 }, mood: 2 },
          { text: "Basic recycling improvements", reaction: "Better than nothing. Easy wins.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { hr: 1 }, mood: 1 },
          { text: "Leave it to individual choice", reaction: "Respect autonomy. Some lead by example.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A team leader has been accused of creating a toxic environment-not harassment exactly, but constant criticism, favouritism, and making people feel small. They're also one of our best performers and hard to replace.",
        aside: "Brilliant jerks are a common dilemma. They deliver results but damage everyone around them. What you tolerate defines your culture.",
        choices: [
          { text: "Remove them from leadership", reaction: "Clear message. They might leave. Culture improves.", emoji: "ğŸ™", ap: 3, cost: 25, eff: { hr: 4, dev: -1 }, mood: 2 },
          { text: "Intensive coaching and monitoring", reaction: "Give them a chance. Others watching closely.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { hr: 1, dev: 1 }, mood: 0 },
          { text: "They deliver-overlook it", reaction: "Results matter. Team gets it done.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 2 }, mood: 0 }
        ]
      },
      {
        intro: "We're deciding whether to offer benefits to employees' families-health coverage for partners, parental leave for all parents, support for elderly care. It's expensive but makes us more attractive and helps people bring their whole selves to work.",
        aside: "Family-friendly policies cost money upfront but improve retention and loyalty. People remember how you treat them during major life moments.",
        choices: [
          { text: "Comprehensive family benefits", reaction: "Significant investment. Loyalty follows.", emoji: "ğŸ™", ap: 3, cost: 35, eff: { hr: 5, mkt: 1 }, mood: 2 },
          { text: "Parental leave only", reaction: "Focus on the essentials. Good start.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { hr: 3 }, mood: 1 },
          { text: "Statutory minimum only", reaction: "Lean approach. Save for salaries.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { cash: 10 }, mood: 0 }
        ]
      },
      {
        intro: "Someone posted on WorkReview that our 'collaborative culture' is actually 'death by committee' and decisions take forever. Another says 'work-life balance' means 'work all the time, balance never'. These are our own values language being thrown back at us. It stings because there's truth in it.",
        aside: "When your stated values don't match lived experience, people notice. WorkReview becomes a place where the gap between aspiration and reality gets called out. Painful but useful.",
        choices: [
          { text: "Honest reflection-are our values real?", reaction: "Hard conversations. Might need to change how we work, not just what we say.", emoji: "ğŸ™", ap: 3, cost: 20, eff: { hr: 4, dev: 1 }, mood: 2 },
          { text: "Clarify what our values actually mean", reaction: "Reframe expectations. Doesn't fix the underlying issues.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 2 }, mood: 1 },
          { text: "Some people will never be happy", reaction: "Focus on the majority who are engaged.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our WorkReview reviews show a pattern: people love their immediate teams but feel disconnected from leadership. 'Great colleagues, invisible founders.' We've been so focused on product that we've neglected internal communication.",
        aside: "Culture doesn't scale automatically. What worked at 10 people breaks at 50. Leaders who were accessible become distant without meaning to. WorkReview often spots this before leadership does.",
        choices: [
          { text: "Regular all-hands and founder office hours", reaction: "Time investment. Rebuilds connection.", emoji: "ğŸ™", ap: 3, cost: 15, eff: { hr: 4 }, mood: 2 },
          { text: "Better internal comms and updates", reaction: "Information helps. Not the same as presence.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 2 }, mood: 1 },
          { text: "We're busy building-they'll understand", reaction: "Product focus. Team gets it.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A glowing WorkReview review just appeared-but I'm pretty sure it was written by a manager about their own team. The praise is suspiciously specific and the timing is right after I mentioned we needed better reviews. It's not technically fake, but it's not organic either.",
        aside: "The line between encouraging reviews and manufacturing them is blurry. Managers who write reviews of their own teams aren't lying exactly, but it undermines the whole point of independent feedback.",
        choices: [
          { text: "Have a quiet word-don't do this", reaction: "Awkward conversation. Sets a standard.", emoji: "ğŸ™", ap: 2, cost: 10, eff: { hr: 2 }, mood: 2 },
          { text: "Let it go-no proof it's them", reaction: "Diplomatic approach. Keep options open.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 },
          { text: "If it helps recruiting, who cares?", reaction: "Pragmatic. Attracts talent.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1, mkt: 1 }, mood: 0 }
        ]
      }
    ],
    
    // AISHA KHAN - The Talent Magnet
    aisha: [
      {
        intro: "Retention concerns, I know. But two engineers from CortexAI interested. Headcount approved?",
        aside: "Fix retention yes. But these candidates won't wait. Everyone courting them.",
        choices: [
          { text: "Hire the stars-upgrade team", reaction: "On it. These two exceptional.", emoji: "ğŸ¯", ap: 5, cost: 40, eff: { sci: 4, dev: 2, hr: -1 }, mood: 2 },
          { text: "Retention first, hiring after", reaction: "Might lose window. Keep them warm.", emoji: "ğŸ˜", ap: 3, cost: 20, eff: { hr: 4 }, mood: -1 },
          { text: "Both-hire and fix retention", reaction: "Big investment. If committed, let's go.", emoji: "ğŸ’¼", ap: 5, cost: 55, eff: { sci: 3, hr: 3, dev: 1 }, mood: 1 }
        ]
      },
      {
        intro: "Competitor's senior PM unhappy, reached out. Valuable experience.",
        aside: "Talent markets competitive. When opportunity knocks...",
        choices: [
          { text: "Move fast, make offer", reaction: "Hiring A-players. How we win.", emoji: "ğŸ¯", ap: 2, cost: 30, eff: { mkt: 3, dev: 2 }, mood: 2 },
          { text: "Interview properly, take time", reaction: "Process matters. Speed too.", emoji: "ğŸ˜", ap: 3, cost: 20, eff: { mkt: 2, dev: 1 }, mood: 0 },
          { text: "Pass-poaching creates bad blood", reaction: "Maintain good industry relationships.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Losing candidates at offer stage. Comp competitive but not top of London market.",
        aside: "In this talent market, 'competitive' might not be enough.",
        choices: [
          { text: "Increase base to top quartile", reaction: "Money talks. Pipeline improves.", emoji: "ğŸ¯", ap: 2, cost: 30, eff: { hr: 4 }, mood: 2 },
          { text: "Improve equity and benefits", reaction: "Total package approach. Can work.", emoji: "ğŸ˜", ap: 3, cost: 20, eff: { hr: 2, equity: -1 }, mood: 0 },
          { text: "Sell the mission harder", reaction: "Purpose-driven team. Committed people stay.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Recruiter pushing expensive candidates. Good, but we could find equivalent ourselves.",
        aside: "Recruiter fees add up. So does time-to-hire. Trade-off.",
        choices: [
          { text: "Pay fee, get talent", reaction: "Time is money. Let's move.", emoji: "ğŸ¯", ap: 2, cost: 35, eff: { hr: 2, dev: 2 }, mood: 1 },
          { text: "Build own sourcing capability", reaction: "Investment now, savings later.", emoji: "ğŸ˜", ap: 4, cost: 25, eff: { hr: 3 }, mood: 1 },
          { text: "Rely on inbound applications", reaction: "Efficient. Good candidates find us.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Employer brand invisible. Great candidates don't know we exist.",
        aside: "Recruiting is marketing. Need to be where talent looks.",
        choices: [
          { text: "Employer branding campaign", reaction: "Make noise. Get on radar.", emoji: "ğŸ¯", ap: 4, cost: 30, eff: { hr: 4, mkt: 2 }, mood: 2 },
          { text: "Tech community content strategy", reaction: "Slow build but authentic.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { hr: 2, mkt: 1 }, mood: 1 },
          { text: "Focus on direct outreach", reaction: "One by one. Doesn't scale.", emoji: "ğŸ¤·", ap: 1, cost: 0, eff: { hr: 2, mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Imperial College career fair next month. Prime graduate talent.",
        aside: "Top UK university. Computer science grads in demand everywhere.",
        choices: [
          { text: "Premium booth and presentations", reaction: "Stand out. Best grads notice.", emoji: "ğŸ¯", ap: 4, cost: 25, eff: { hr: 3, sci: 1 }, mood: 2 },
          { text: "Simple presence, network", reaction: "There but not flashy.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { hr: 2 }, mood: 0 },
          { text: "Skip-focus on experienced hires", reaction: "Hire ready-to-contribute talent.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Technical hiring bar debate. Lower for speed or maintain for quality?",
        aside: "One bad hire costs three good ones in time and morale.",
        choices: [
          { text: "Maintain bar, invest in pipeline", reaction: "Quality compounds. Worth the wait.", emoji: "ğŸ¯", ap: 3, cost: 20, eff: { hr: 3, dev: 2 }, mood: 2 },
          { text: "Slightly lower bar with mentorship", reaction: "Grow talent internally. More work.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { hr: 2, dev: 1 }, mood: 0 },
          { text: "Lower bar-need bodies", reaction: "Technical debt in human form.", emoji: "ğŸ¤·", ap: 3, cost: 25, eff: { hr: 1, dev: -1 }, mood: -1 }
        ]
      },
      {
        intro: "Key engineer being poached by American startup. Can we counter-offer?",
        aside: "Counter-offers tricky. But losing her is worse.",
        choices: [
          { text: "Strong counter with promotion path", reaction: "Fight for our people.", emoji: "ğŸ¯", ap: 3, cost: 25, eff: { hr: 2, dev: 2 }, mood: 2 },
          { text: "Match offer, discuss concerns", reaction: "Address why she's looking.", emoji: "ğŸ˜", ap: 3, cost: 20, eff: { hr: 1, dev: 1 }, mood: 0 },
          { text: "Let her go gracefully", reaction: "Part on good terms. Stay connected.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our best candidate for the senior machine learning role needs a Skilled Worker visa. We're not a licensed sponsor yet. Becoming one takes 8-12 weeks, costs about Â£1,500, and requires ongoing compliance-keeping records, reporting changes, passing audits. Or we only hire people who already have the right to work here.",
        aside: "The UK visa system is a real barrier to hiring. Many startups avoid it entirely, which limits their talent pool. Others see sponsorship as a competitive advantage-it opens up candidates others can't hire.",
        choices: [
          { text: "Apply for sponsor licence-invest in the capability", reaction: "Takes time but opens up the world. Worth it for the right talent.", emoji: "ğŸ¯", ap: 4, cost: 30, eff: { hr: 4, dev: 2 }, mood: 2 },
          { text: "Ask the candidate to wait while we apply", reaction: "Risky. Good candidates have options. Some will wait, many won't.", emoji: "ğŸ˜", ap: 3, cost: 20, eff: { hr: 2, dev: 1 }, mood: 0 },
          { text: "Only hire people with existing right to work", reaction: "Simpler process. Faster hiring.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A brilliant engineer we want to hire is on a Graduate visa with 18 months left. If we sponsor her for a Skilled Worker visa now, it costs us about Â£5,000 and locks her in somewhat. If we wait, she might find another sponsor, or we might discover it's not a good fit after all.",
        aside: "Graduate visas give international students two years to work after finishing their degree-but no path to settlement. Sponsoring someone is an investment and a commitment. Some companies wait to be sure; others act fast to secure talent.",
        choices: [
          { text: "Sponsor her now-secure the talent", reaction: "Commitment both ways. She knows we're invested in her.", emoji: "ğŸ¯", ap: 3, cost: 30, eff: { hr: 3, dev: 2 }, mood: 2 },
          { text: "Hire now, discuss sponsorship at 6 months", reaction: "Trial period. She might not wait-others will sponsor faster.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { hr: 2, dev: 1 }, mood: 0 },
          { text: "Only hire if she finds her own visa solution", reaction: "Shows resourcefulness. She figures it out.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "The salary threshold for Skilled Worker visas just went up again-now Â£38,700 for most roles, or the 'going rate' for the job, whichever is higher. Our junior developer roles pay Â£35,000, which was fine last year. Now we can't sponsor anyone for those positions unless we raise salaries or find a workaround.",
        aside: "Immigration policy keeps changing. The salary thresholds are meant to ensure migrants aren't undercutting local workers, but they also make it hard to hire junior international talent. Some companies restructure roles; others just don't hire internationally for those positions.",
        choices: [
          { text: "Raise salaries to meet threshold", reaction: "More expensive but we can sponsor. Might need to raise for everyone.", emoji: "ğŸ¯", ap: 2, cost: 25, eff: { hr: 3, cash: -30 }, mood: 1 },
          { text: "Restructure roles to qualify for lower thresholds", reaction: "Some roles have different rules. Takes creativity and compliance risk.", emoji: "ğŸ˜", ap: 3, cost: 15, eff: { hr: 2 }, mood: 0 },
          { text: "Only hire UK/settled workers for junior roles", reaction: "Simpler compliance. Focus sponsorship on senior roles.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "One of our EU developers came to the UK before Brexit and applied for settled status, but his application has been stuck in a backlog for over a year. He has a 'certificate of application' that lets him keep working, but he's nervous about travelling, renting a flat, or even opening a bank account. The uncertainty is affecting his work.",
        aside: "Millions of EU citizens applied for settled status. Most got it quickly, but some are stuck in limbo-technically legal but unable to prove it easily. It's a strange bureaucratic purgatory that affects real people's lives.",
        choices: [
          { text: "Help him escalate with immigration lawyers", reaction: "Company investment in his situation. Shows we care.", emoji: "ğŸ¯", ap: 2, cost: 20, eff: { hr: 2, dev: 1 }, mood: 2 },
          { text: "Write a strong employer support letter", reaction: "Sometimes helps. Sometimes doesn't. Worth trying.", emoji: "ğŸ˜", ap: 1, cost: 5, eff: { hr: 1 }, mood: 1 },
          { text: "Reassure him but this is his issue to manage", reaction: "Trust him. He handles it.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "Our Head of Product is Brazilian, here on a Skilled Worker visa we sponsor. She's been offered a chance to lead a project in our potential SÃ£o Paulo office for six months. But leaving the UK for that long might affect her path to settlement-she needs to be physically present in the UK for a certain number of days. She's torn between the career opportunity and her immigration timeline.",
        aside: "Visa rules create invisible constraints on careers. Time out of the country can reset settlement clocks. Some employees turn down opportunities to protect their immigration status. It's a factor that never appears in org charts.",
        choices: [
          { text: "Find a way to structure it that protects her status", reaction: "Creative solution. Might involve more trips back and forth.", emoji: "ğŸ¯", ap: 3, cost: 25, eff: { hr: 2, mkt: 2 }, mood: 2 },
          { text: "Let her choose-explain the trade-offs clearly", reaction: "Informed decision. Might lose her to the project or to frustration.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { hr: 1, mkt: 1 }, mood: 0 },
          { text: "Send someone with simpler immigration status", reaction: "Easier logistics. Trip goes smoothly.", emoji: "ğŸ™‚", ap: 1, cost: 10, eff: { mkt: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We're recruiting a senior engineer. She asks about our runway and funding situation. Honestly, we have eight months of cash and no guarantee of the next round. Our standard pitch makes things sound more secure than they are. She has competing offers from stable companies.",
        aside: "Recruiting is selling. But candidates make life decisions based on what you tell them. Some will leave secure jobs to join you. If the startup fails in six months, was your pitch fair?",
        choices: [
          { text: "Be transparent about our situation", reaction: "She might walk. If she joins, she knows what she's signing up for.", emoji: "ğŸ¯", ap: 2, cost: 10, eff: { hr: 1 }, mood: 2 },
          { text: "Optimistic but hint at startup risk", reaction: "Acknowledge uncertainty without dwelling on it. Normal.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { hr: 2 }, mood: 1 },
          { text: "Stick to the confident pitch", reaction: "Win the hire. Hope we don't let her down.", emoji: "ğŸ¤·", ap: 1, cost: 5, eff: { hr: 4, dev: 2 }, mood: -1 }
        ]
      },
      {
        intro: "A candidate asks about work-life balance. The honest answer is that we're in crunch mode and will be for months-60-hour weeks are common. Our jobs page talks about 'flexibility' and 'sustainable pace'. He's choosing between us and a corporate job with predictable hours.",
        aside: "Startups often demand more than they admit in interviews. People join expecting one thing, find another. Some thrive on the intensity; others burn out and leave bitter.",
        choices: [
          { text: "Be honest about current intensity", reaction: "Might lose him. Whoever joins knows the deal.", emoji: "ğŸ¯", ap: 2, cost: 10, eff: { hr: 1 }, mood: 2 },
          { text: "Frame it as 'startup energy, flexible structure'", reaction: "Technically true. Omits the 60-hour weeks.", emoji: "ğŸ˜", ap: 1, cost: 10, eff: { hr: 2 }, mood: 0 },
          { text: "Sell the opportunity, downplay the hours", reaction: "Win the hire. Hope he adapts. Or doesn't notice until he's in.", emoji: "ğŸ¤·", ap: 1, cost: 5, eff: { hr: 4, dev: 2 }, mood: -1 }
        ]
      },
      {
        intro: "We're losing a bidding war for a great candidate. To win, we'd have to offer a title and salary we've never paid before-she'd be the highest-paid person outside the founders. Current team would eventually find out. She's worth it, but the internal equity issues are real.",
        aside: "Paying market rate for new hires while existing team is below market is a time bomb. Do you win the talent war now and deal with retention problems later?",
        choices: [
          { text: "Pass-not worth the internal disruption", reaction: "Keep team harmony. Internal equity preserved.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 },
          { text: "Make the offer, plan to level up existing comp", reaction: "Win the hire. Commit to fixing the broader problem.", emoji: "ğŸ˜", ap: 3, cost: 30, eff: { hr: 2, dev: 2, cash: -40 }, mood: 1 },
          { text: "Make the offer, keep it confidential", reaction: "Win now. Hope nobody talks. They always talk.", emoji: "ğŸ¤·", ap: 2, cost: 25, eff: { hr: 2, dev: 2 }, mood: -1 }
        ]
      },
      {
        intro: "Our WorkReview rating is 3.1 stars. Candidates are asking about it. The reviews mention long hours, unclear career paths, and 'bro culture'. Some of this is outdated-we've changed-but the old reviews drag down the average. New candidates see it before they see us.",
        aside: "First impressions happen on WorkReview before you ever meet a candidate. A low rating means your best prospects might never apply. But you can't delete history, only write new chapters.",
        choices: [
          { text: "Address it head-on in interviews", reaction: "Acknowledge the past, explain what's changed. Honest.", emoji: "ğŸ¯", ap: 2, cost: 10, eff: { hr: 3 }, mood: 2 },
          { text: "Encourage recent hires to share their experience", reaction: "Fresh voices. If they're genuinely happy, it'll show.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { hr: 2, mkt: 1 }, mood: 1 },
          { text: "Hope candidates don't check WorkReview", reaction: "Focus on in-person experience instead.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "A candidate just withdrew from our process. When we asked why, she said she'd read our WorkReview reviews and was concerned about what former employees said about management. She was our top choice for a critical role. This is the third time this quarter.",
        aside: "WorkReview is now part of the recruiting funnel whether you like it or not. Candidates self-select out before you can make your case. The reviews are doing your screening-just not in your favour.",
        choices: [
          { text: "Fix the underlying issues reviews mention", reaction: "Hard work. Only real solution.", emoji: "ğŸ¯", ap: 4, cost: 30, eff: { hr: 4, dev: 1 }, mood: 2 },
          { text: "Better employer branding to counter narrative", reaction: "Tell our story louder. Doesn't change the reviews.", emoji: "ğŸ˜", ap: 3, cost: 25, eff: { hr: 2, mkt: 2 }, mood: 1 },
          { text: "Focus on candidates who don't check reviews", reaction: "Less research-focused candidates. Faster hiring.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 }
        ]
      },
      {
        intro: "We're about to make three offers to great candidates. Before we do, I checked WorkReview and noticed a new review from someone who just left. It's detailed, specific, and damning-mentions the exact team two of our candidates would join. If they see it before accepting, we might lose them.",
        aside: "Timing matters. A bad review right before offers go out can tank your close rate. You can't suppress it, but you can try to get ahead of it.",
        choices: [
          { text: "Proactively address it with the candidates", reaction: "Awkward but honest. They'll find it anyway.", emoji: "ğŸ¯", ap: 2, cost: 10, eff: { hr: 2 }, mood: 2 },
          { text: "Accelerate the offers-beat the review", reaction: "Hope they sign before they search. Risky.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { hr: 1 }, mood: 0 },
          { text: "Nothing we can do-proceed normally", reaction: "Focus on what we control.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
        ]
      }
    ]
  }
};

// ===== GENERIC EVENTS - Can appear for any executive =====
// These are cross-functional events that work across all ventures and departments

const GENERIC_EVENTS = {
  // Events that can appear for any department
  all: [
    {
      intro: "Board meeting next week. They want a progress update from each department.",
      aside: "Board visibility is a double-edged sword. Under-promise or inspire confidence?",
      choices: [
        { text: "Comprehensive, honest presentation", reaction: "They appreciate the transparency.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: 2, hr: 1 }, mood: 2 },
        { text: "Highlight wins, minimise concerns", reaction: "Bought us time. For now.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { mkt: 1 }, mood: 0 },
        { text: "Send written update, skip presenting", reaction: "Efficient communication. Time saved.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "A key vendor just raised their prices 40%. We rely on them heavily.",
      aside: "Switching costs are real. But so is margin erosion.",
      choices: [
        { text: "Negotiate hard, threaten to switch", reaction: "Got it down to 20%. Worth the fight.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { dev: 1, cash: 30 }, mood: 2 },
        { text: "Accept increase, budget accordingly", reaction: "Stable relationship. Planning clarity.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 },
        { text: "Start migration to alternative", reaction: "Painful but necessary. Six month project.", emoji: "ğŸ™‚", ap: 4, cost: 25, eff: { dev: 2 }, mood: 1 }
      ]
    },
    {
      intro: "Office lease renewal coming up. Stay, downsize, or go fully remote?",
      aside: "Real estate is expensive. But some people need the office.",
      choices: [
        { text: "Renew with flexible terms", reaction: "Stability with optionality. Team appreciates the space.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { hr: 3, dev: 1 }, mood: 2 },
        { text: "Downsize to smaller space", reaction: "Tighter but savings are real. Hot-desking works.", emoji: "ğŸ™‚", ap: 2, cost: 0, eff: { hr: 1, cash: 30 }, mood: 0 },
        { text: "Go fully remote", reaction: "Big savings. Coordination gets harder.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { cash: 40 }, mood: 0 }
      ]
    },
    {
      intro: "Competitor just raised a massive round. Press is calling them the market leader.",
      aside: "Funding announcements create perception. Perception affects deals.",
      choices: [
        { text: "Counter with our own PR push", reaction: "Get our story out there.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { mkt: 3 }, mood: 2 },
        { text: "Focus internally, ignore the noise", reaction: "Heads down. Ship product.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 },
        { text: "Accelerate our own fundraising", reaction: "Capital is a competitive weapon.", emoji: "ğŸ˜", ap: 4, cost: 15, eff: { mkt: 2, cash: 100 }, mood: 1 }
      ]
    },
    {
      intro: "CloudScale bill came in 50% higher than expected. Cloud costs spiralling.",
      aside: "Scale is expensive. But optimisation takes engineering time.",
      choices: [
        { text: "Dedicated cost optimisation sprint", reaction: "Found waste we didn't know existed.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { dev: 1, cash: 40 }, mood: 2 },
        { text: "Quick wins only, stay focused", reaction: "Some savings. Could do more.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { cash: 15 }, mood: 0 },
        { text: "Accept it as cost of growth", reaction: "Investment in scale. Revenue follows.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
      ]
    }
  ],
  
  // Research-specific generic events
  research: [
    {
      intro: "Promising researcher applying, but they want to keep publishing openly.",
      aside: "Open science versus competitive advantage. Classic tension.",
      choices: [
        { text: "Hire with publication rights", reaction: "Attract talent. Share some secrets.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 3, mkt: 1 }, mood: 2 },
        { text: "Negotiate delayed publication", reaction: "Compromise. Six month embargo.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 2 }, mood: 1 },
        { text: "Insist on full IP control", reaction: "Protect our assets. Worth the fight.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "University offering sponsored PhD students. Cheap talent, slow timelines.",
      aside: "PhDs are brilliant but have their own priorities.",
      choices: [
        { text: "Take two sponsored students", reaction: "Fresh thinking. Publication pressure.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 2, hr: 1 }, mood: 2 },
        { text: "One student, clear project scope", reaction: "Manageable commitment.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { sci: 1 }, mood: 1 },
        { text: "Decline-need full-time focus", reaction: "Prioritise the product. Stay focused.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Lab equipment breaking down. Repair or upgrade to newer tech?",
      aside: "Old equipment limits what we can do. New equipment limits budget.",
      choices: [
        { text: "Full upgrade to latest equipment", reaction: "Capabilities expanded significantly.", emoji: "ğŸ˜Š", ap: 5, cost: 50, eff: { sci: 4, dev: 1 }, mood: 2 },
        { text: "Repair and extend life", reaction: "Keeps us running. For now.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { sci: 1 }, mood: 0 },
        { text: "Work around the limitations", reaction: "Creativity from constraint. Team innovates.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Ethics review flagged concerns about our data collection practices.",
      aside: "Better to fix now than face questions later.",
      choices: [
        { text: "Full ethics audit and remediation", reaction: "Clean practices. Clear conscience.", emoji: "ğŸ˜Š", ap: 4, cost: 20, eff: { sci: 2, hr: 2, mkt: 1 }, mood: 2 },
        { text: "Address specific concerns raised", reaction: "Minimum viable compliance.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 1 }, mood: 0 },
        { text: "Push back on the review", reaction: "Stand our ground. Reviewer respects it.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Conference abstract deadline tomorrow. Submit preliminary results?",
      aside: "Early visibility versus looking foolish if results don't hold.",
      choices: [
        { text: "Submit with appropriate caveats", reaction: "Get the conversation started.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 2, mkt: 1 }, mood: 2 },
        { text: "Wait for next conference cycle", reaction: "More solid. Less timely.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 1 }, mood: 0 },
        { text: "Skip conferences, focus on product", reaction: "Ship faster. Product speaks for itself.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    // NEW: University engagement events
    {
      intro: "The computer science department at our local university wants to set up a Knowledge Transfer Partnership. Government co-funds it.",
      aside: "KTPs are brilliant value-Innovate UK pays most of the salary. We get a dedicated associate for two years.",
      choices: [
        { text: "Full KTP with research project", reaction: "Two years of focused work. Grant covers 60% of costs.", emoji: "ğŸ˜Š", ap: 4, cost: 25, eff: { sci: 4, dev: 2, cash: 40 }, mood: 2 },
        { text: "Informal collaboration first", reaction: "Test the relationship before committing.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2, dev: 1 }, mood: 0 },
        { text: "Too much admin-pass", reaction: "Avoid bureaucracy. Focus on product.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Applications are open for summer interns. We could take students from various universities-good talent pipeline.",
      aside: "Interns are cheap and eager. Some become brilliant hires. Others need a lot of hand-holding.",
      choices: [
        { text: "Structured programme with 4 interns", reaction: "Busy summer. One or two will be stars.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { sci: 3, dev: 2, hr: 2 }, mood: 2 },
        { text: "Take 1-2 interns informally", reaction: "Manageable. Less pipeline impact.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 2, hr: 1 }, mood: 0 },
        { text: "Skip this year-too busy", reaction: "Focus on priorities. Next year.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "A Warwick Business School MSc team wants to do their consultancy project with us. Free strategy work, but needs time to brief and manage.",
      aside: "These students are sharp and motivated. Last cohort's report on a competitor was genuinely useful.",
      choices: [
        { text: "Full engagement with exec access", reaction: "They deliver serious competitor analysis.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { sci: 2, mkt: 3 }, mood: 2 },
        { text: "Limited scope project", reaction: "Useful output. Less of our time.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 1, mkt: 2 }, mood: 0 },
        { text: "Decline-not the right time", reaction: "Wait for better timing.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "A sandwich year student from Nottingham wants to do their placement with us. 12 months of dedicated help at junior salary.",
      aside: "Placement students become part of the team. By month six, they're genuinely productive.",
      choices: [
        { text: "Take them on with development plan", reaction: "A year of growing contribution. Often convert to grad hire.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 2, dev: 2, hr: 1 }, mood: 2 },
        { text: "Six-month trial placement", reaction: "Test fit before full commitment.", emoji: "ğŸ™‚", ap: 2, cost: 12, eff: { sci: 1, dev: 1 }, mood: 0 },
        { text: "Can't commit to supervision", reaction: "Focus resources. Better fits ahead.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Three final year students want us to propose dissertation projects. Real problems for them, potential solutions for us.",
      aside: "Some projects go nowhere. But occasionally you get breakthrough ideas from fresh eyes.",
      choices: [
        { text: "Propose three meaty projects", reaction: "One might solve a real problem. All build our reputation.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { sci: 3, dev: 1, hr: 1 }, mood: 2 },
        { text: "One project, well-supervised", reaction: "Quality over quantity.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2 }, mood: 0 },
        { text: "No bandwidth for supervision", reaction: "Focus on core priorities.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Our new approach could be published as open source. Builds reputation but competitors benefit too.",
      aside: "Open source is how you become the standard. But we give away some advantage.",
      choices: [
        { text: "Full open source with blog post", reaction: "Community builds on our work. We get credit.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 4, mkt: 3, dev: -1 }, mood: 2 },
        { text: "Partial release-core stays proprietary", reaction: "Share the edges, keep the secret sauce.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 2, mkt: 2 }, mood: 0 },
        { text: "Keep everything proprietary", reaction: "Protect our edge. Competitors guess.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Our research intern has offers from CortexAI and us. We can't match salaries but can offer ownership and impact.",
      aside: "Big Tech throws money at PhDs. We throw interesting problems and equity.",
      choices: [
        { text: "Compelling offer with equity and autonomy", reaction: "They choose us. Ownership matters to them.", emoji: "ğŸ˜Š", ap: 3, cost: 30, eff: { sci: 3, hr: 2, equity: -1 }, mood: 2 },
        { text: "Match what we can, emphasise mission", reaction: "50/50 chance. Worth trying.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 2, hr: 1 }, mood: 0 },
        { text: "Accept we'll lose this one", reaction: "Pick battles wisely. Save resources.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "A local college runs degree apprenticeships in data science. We could sponsor students-they work 4 days, study 1 day.",
      aside: "Apprentices are loyal and learn our way of working. Four-year commitment though.",
      choices: [
        { text: "Sponsor two apprentices", reaction: "Building talent from scratch. They'll bleed our colours.", emoji: "ğŸ˜Š", ap: 4, cost: 25, eff: { sci: 2, dev: 2, hr: 3 }, mood: 2 },
        { text: "One apprentice to start", reaction: "Test the programme. Lower risk.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 1, dev: 1, hr: 1 }, mood: 0 },
        { text: "Too long-term for us now", reaction: "Focus on immediate needs. Practical.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Sheffield Hallam is hosting an industry research day. Small investment to present, chance to meet practical researchers.",
      aside: "Not the prestige universities, but these researchers solve real problems. Less ego too.",
      choices: [
        { text: "Present and sponsor networking drinks", reaction: "Found three researchers working on exactly our problems.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { sci: 3, hr: 2 }, mood: 2 },
        { text: "Attend without presenting", reaction: "Scout the talent. Stay under the radar.", emoji: "ğŸ™‚", ap: 2, cost: 8, eff: { sci: 1, hr: 1 }, mood: 0 },
        { text: "Skip-focus on Russell Group", reaction: "Target top tier. Quality over quantity.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 1 }, mood: 0 }
      ]
    },
    // FUN: Humorous research events
    {
      intro: "Someone trained our model on the entire archive of British baking shows. It now describes everything in terms of 'soggy bottoms' and 'good crumb structure'.",
      aside: "The interns thought it was hilarious. The demo to investors is on Thursday.",
      choices: [
        { text: "Lean into it-baking metaphors for everyone", reaction: "Investors charmed. 'A lovely rise in your Series A.'", emoji: "ğŸ‚", ap: 2, cost: 5, eff: { sci: 1, mkt: 3 }, mood: 2 },
        { text: "Emergency rollback to serious model", reaction: "Crisis averted. Interns disappointed.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2, dev: 1 }, mood: 0 },
        { text: "Keep both versions, A/B test", reaction: "Turns out users prefer the baking version.", emoji: "ğŸ¤”", ap: 3, cost: 15, eff: { sci: 2, mkt: 2 }, mood: 1 }
      ]
    },
    {
      intro: "A researcher has been coming in at 3am 'when the GPU cluster is quiet'. Security is concerned. So is their spouse.",
      aside: "Dedication or obsession? The line blurs in research.",
      choices: [
        { text: "Intervention: enforce normal hours", reaction: "They grumble but sleep improves. So does their work.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { sci: 1, hr: 2 }, mood: 1 },
        { text: "Give them a camp bed and snacks", reaction: "Breakthrough achieved. HR sends concerned emails.", emoji: "ğŸ›", ap: 2, cost: 8, eff: { sci: 4, hr: -1 }, mood: 0 },
        { text: "Allocate dedicated GPU time instead", reaction: "Problem solved with scheduling. Novel concept.", emoji: "ğŸ™‚", ap: 3, cost: 15, eff: { sci: 3, dev: 1 }, mood: 2 }
      ]
    },
    {
      intro: "The research team's TeamChat channel has devolved into an elaborate debate about whether a hot dog is a sandwich.",
      aside: "Productivity is down. But team bonding is... up?",
      choices: [
        { text: "Join the debate with a formal position paper", reaction: "Your 'Cylindrical Meat Taxonomy' becomes a meme. Team loves it.", emoji: "ğŸŒ­", ap: 1, cost: 0, eff: { hr: 3, mkt: 1 }, mood: 2 },
        { text: "Gently redirect to actual work", reaction: "Adults behaving professionally. Briefly.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 1, hr: 1 }, mood: 0 },
        { text: "Create a #random channel for nonsense", reaction: "Chaos contained. Science resumes.", emoji: "ğŸ˜Š", ap: 1, cost: 0, eff: { sci: 2, hr: 2 }, mood: 1 }
      ]
    },
    // DESIGN THINKING EVENT
    {
      intro: "Ask ten customers to keep a diary for two weeks - when they use your product, how they feel, what frustrates them. Raw, unfiltered insight over time.",
      aside: "Interviews capture what people remember. Diaries capture what actually happens.",
      choices: [
        { text: "Full diary study with follow-ups", reaction: "The 2am frustration entries were eye-opening. You'd never catch that in an interview.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 4, dev: 1 }, mood: 2 },
        { text: "Shorter one-week study", reaction: "Good data. Smaller sample.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2 }, mood: 1 },
        { text: "Ask in a survey instead", reaction: "Quick answers. Missing the context and emotion.", emoji: "ğŸ˜", ap: 1, cost: 5, eff: { sci: 1 }, mood: 0 }
      ]
    },
    // LEAD USER EVENTS (Von Hippel)
    {
      intro: "One customer is using your product for problems most users won't face for years. They're frustrated by limitations nobody else has hit yet. They've already built workarounds.",
      aside: "Lead users live in the future. Their problems today are everyone's problems tomorrow.",
      choices: [
        { text: "Deep collaboration with them", reaction: "Their problems today are everyone's problems tomorrow. You're now two years ahead.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { sci: 5, dev: 2 }, mood: 2 },
        { text: "Interview and document", reaction: "Useful insights captured. They wanted more involvement.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2 }, mood: 1 },
        { text: "Focus on mainstream users", reaction: "Serve the many. Pioneers can wait.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
      ]
    },
    {
      intro: "A technically skilled customer has fixed a bug in your system and sent you the solution. It works. Your engineers didn't write it.",
      aside: "Users sometimes solve problems faster than you can. The question is whether to accept help.",
      choices: [
        { text: "Integrate and credit them", reaction: "Community goodwill. Others start contributing.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { sci: 3, hr: 2 }, mood: 2 },
        { text: "Rewrite it internally", reaction: "Clean code. Same outcome. Slower.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2 }, mood: 0 },
        { text: "Politely decline external code", reaction: "Security policy. Missed the help.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Your research lead has identified a small group of users with needs that don't match any market segment. They're outliers - or they're the future.",
      aside: "Today's outliers are often tomorrow's mainstream. If you can spot the difference.",
      choices: [
        { text: "Study the outliers deeply", reaction: "Turns out they were early adopters of a trend. You saw it first.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 4, mkt: 1 }, mood: 2 },
        { text: "Note and monitor", reaction: "Interesting data point. No action yet.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { sci: 1 }, mood: 0 },
        { text: "Focus on core segments", reaction: "Serve existing markets. Outliers can wait.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
      ]
    },
    // BOOTLEGGING & UNPROGRAMMED R&D EVENTS
    {
      intro: "You discover your lead researcher has been spending evenings working on something completely outside the roadmap. It's not what you're paying them for - but it's genuinely interesting.",
      aside: "Bootleg projects. Against the rules. Also where breakthroughs hide.",
      choices: [
        { text: "Give them official time for it", reaction: "The side project becomes a real project. They're energised.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { sci: 4, hr: 2 }, mood: 2 },
        { text: "Ask them to stop", reaction: "Back on roadmap. Something dies in their eyes.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { sci: 2, dev: 2 }, mood: -1 },
        { text: "Pretend you didn't notice", reaction: "Plausible deniability. Innovation continues in shadows.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 2, hr: 1 }, mood: 1 }
      ]
    },
    {
      intro: "You discover your research lead has been quietly diverting small amounts from various budgets to fund an unauthorised experiment. It's working. But it's definitely against policy.",
      aside: "Hidden budgets. Creative accounting. Also how some of the best ideas survive.",
      choices: [
        { text: "Formalise the funding", reaction: "Legitimise what works. Update the policy.", emoji: "ğŸ˜Š", ap: 2, cost: 20, eff: { sci: 4, hr: 1 }, mood: 2 },
        { text: "Shut it down, enforce process", reaction: "Rules matter. Researcher complies but checks out mentally.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { sci: 2, dev: 2 }, mood: -1 },
        { text: "Create a discretionary innovation fund", reaction: "Give them a proper channel. Stop the workarounds.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { sci: 3, hr: 2 }, mood: 2 }
      ]
    },
    {
      intro: "A researcher who left last year has built exactly what you need at their new startup. They developed the core idea while working for you - in their spare time, using their own laptop. Legally it's theirs.",
      aside: "The one that got away. You could have had this for free.",
      choices: [
        { text: "Acquire the startup", reaction: "Pay for what you could have had for free. But you get proven technology.", emoji: "ğŸ˜Š", ap: 3, cost: 45, eff: { sci: 6, dev: 3 }, mood: 2 },
        { text: "Hire them back with the IP", reaction: "Cheaper. They want guarantees about freedom this time.", emoji: "ğŸ™‚", ap: 2, cost: 30, eff: { sci: 4, hr: 2 }, mood: 1 },
        { text: "Build it yourself, differently", reaction: "Slower. More expensive. But yours.", emoji: "ğŸ˜", ap: 1, cost: 15, eff: { sci: 2, dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "You learn there's an informal network of researchers across departments sharing ideas and helping each other with unofficial projects. It's productive but completely outside management visibility.",
      aside: "The innovation underground. Works precisely because nobody's watching.",
      choices: [
        { text: "Support it with light structure", reaction: "Legitimise without killing it. Tricky balance achieved.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 3, hr: 2 }, mood: 2 },
        { text: "Leave it alone", reaction: "What you don't know keeps working.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 2 }, mood: 1 },
        { text: "Bring it into formal processes", reaction: "Visibility gained. Magic lost. Network dissolves.", emoji: "ğŸ˜", ap: 2, cost: 5, eff: { sci: 1, hr: -1 }, mood: -1 }
      ]
    },
    {
      intro: "A project that was never officially approved just failed expensively. The researcher argues that's how innovation works - most experiments fail. Your board wants accountability.",
      aside: "Failed experiments are the price of breakthroughs. But someone has to pay.",
      choices: [
        { text: "Defend the culture of experimentation", reaction: "Board uncomfortable. Researchers reassured. Next experiment might work.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 3, hr: 2, mkt: -1 }, mood: 2 },
        { text: "Implement approval processes", reaction: "Fewer failures. Fewer surprises. Fewer breakthroughs.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { sci: 1, mkt: 1 }, mood: 0 },
        { text: "Create a 'fast fail' budget", reaction: "Legitimise small bets. Contain the risk.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 3, hr: 1 }, mood: 2 }
      ]
    },
    // PSYCHOLOGICAL SAFETY EVENTS
    {
      intro: "After a major decision, you learn half the team had serious doubts but nobody voiced them. They assumed others knew better or didn't want to slow things down.",
      aside: "Silent disagreement is agreement in name only. The doubts don't disappear.",
      choices: [
        { text: "Structured pre-decision dissent process", reaction: "Force objections into the open before decisions lock. Slower but sounder.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 3, hr: 2 }, mood: 2 },
        { text: "Ask directly for concerns next time", reaction: "Helps if people believe you mean it.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 1, hr: 1 }, mood: 1 },
        { text: "Trust the process worked", reaction: "Decisions made. Move forward. Doubts linger.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "You discover a researcher quietly fixed a data error rather than reporting it. The fix was correct, but hiding it meant nobody else learned. They were afraid of looking incompetent.",
      aside: "The cover-up instinct. Errors happen. Hiding them is the real problem.",
      choices: [
        { text: "Thank them for fixing, discuss the hiding", reaction: "Errors happen. Hiding them is what we can't have.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { sci: 3, hr: 2 }, mood: 2 },
        { text: "Create a 'mistake of the week' ritual", reaction: "Normalise errors. Celebrate catches. Fear fades.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 2, hr: 3 }, mood: 2 },
        { text: "Enforce documentation requirements", reaction: "Process ensures visibility. Doesn't address fear.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { sci: 1 }, mood: 0 }
      ]
    },
    {
      intro: "In a meeting, a junior researcher directly challenged your strategy in front of the whole team. They were respectful but firm. Some of it was actually right. Your authority feels questioned.",
      aside: "How you respond now teaches everyone what happens when someone challenges the boss.",
      choices: [
        { text: "Thank them publicly, explore their point", reaction: "Ego bruised. Culture strengthened. Better decision made.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { sci: 3, hr: 3 }, mood: 2 },
        { text: "Discuss privately afterwards", reaction: "Maintain authority. They learn to raise concerns quietly.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 1, hr: 1 }, mood: 0 },
        { text: "Shut it down, decide later", reaction: "Order restored. Junior won't speak up again. Neither will others.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { sci: 2, dev: 2 }, mood: -1 }
      ]
    },
    {
      intro: "A researcher had an unconventional idea but never shared it, fearing ridicule. They mentioned it at their exit interview. It would have worked.",
      aside: "The ideas that die in silence. You'll never know how many there were.",
      choices: [
        { text: "Create structured 'wild idea' sessions", reaction: "Legitimise unconventional thinking. Make it safe to be wrong.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 4, hr: 2 }, mood: 2 },
        { text: "Reach out, ask what else people hold back", reaction: "One conversation at a time. Slow culture change.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { sci: 2, hr: 1 }, mood: 1 },
        { text: "Regret it and move on", reaction: "Can't change the past. Pattern continues.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    // NEURODIVERSITY EVENT
    {
      intro: "A dyslexic researcher's 'confusing' whiteboard diagrams from six months ago - the ones people dismissed - turn out to perfectly predict a competitor's breakthrough. They saw something nobody else could. Now everyone wants them in more meetings, which overwhelms them.",
      aside: "Their value comes from thinking differently. Forcing them to communicate 'normally' might break what makes them valuable.",
      choices: [
        { text: "Protect their process, translate their insights", reaction: "Hire someone to bridge the gap. Their diagrams become strategic assets.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { sci: 5, hr: 2 }, mood: 2 },
        { text: "Ask them to present more accessibly", reaction: "They try. Energy goes to formatting, not thinking. Insights slow.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { sci: 2, hr: -1 }, mood: 0 },
        { text: "Document everything they do, just in case", reaction: "Surveillance isn't support. They feel like a curiosity, not a colleague.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { sci: 2, dev: 1 }, mood: -1 }
      ]
    },
    // GENDER & DIVERSITY EVENT
    {
      intro: "Promotion time. Your female researcher has stronger results but downplays them - 'the team made it happen.' Your male researcher has weaker results but presents confidently - 'I delivered a breakthrough.' The panel is leaning toward him. You know the actual contributions.",
      aside: "Results versus presentation. Speaking up might look like favouritism. Staying quiet rewards confidence over contribution.",
      choices: [
        { text: "Advocate for her with the evidence", reaction: "Panel surprised. Evidence speaks. Right person promoted.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { sci: 4, hr: 2 }, mood: 2 },
        { text: "Coach her to self-promote better", reaction: "She learns the game. Burden stays on her to fix a biased system.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 1, hr: 1 }, mood: 0 },
        { text: "Let the process play out fairly", reaction: "He's promoted. She's passed over. Results don't matter as much as you thought.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, mkt: 1 }, mood: -1 }
      ]
    },
    // CORPORATE HIRE EVENT
    {
      intro: "Your new Head of Research from a pharmaceutical company keeps asking 'what's the approval process?' There isn't one - people just do things. She's uncomfortable. Last week she caught a data handling practice that could have caused a serious regulatory breach. But decisions that took hours now take days.",
      aside: "Her instincts saved you from a breach. Her instincts also tripled your decision time. How much process buys safety without killing speed?",
      choices: [
        { text: "Empower her to build governance", reaction: "Slower decisions. Fewer disasters. Regulatory confidence.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { sci: 4, dev: -1 }, mood: 2 },
        { text: "Lightweight approvals for high-risk only", reaction: "Balanced approach. Some frustration on both sides.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2, dev: 1 }, mood: 1 },
        { text: "Move fast, fix problems when they arise", reaction: "She leaves. Three months later, a regulator calls.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 3, mkt: 2 }, mood: -1 }
      ]
    },
    // TOXIC STARTUP CULTURE EVENT
    {
      intro: "Your new product manager from a startup accelerator speaks entirely in jargon. 'We need to pivot our value hypothesis based on validated learnings from our innovation accounting metrics.' Engineers stare blankly. When asked what she means, she rephrases with more jargon. Meetings now have two conversations - buzzwords and whispered translations.",
      aside: "Jargon creates in-groups and out-groups. Your team built real things with real words. Now they feel stupid for not knowing the 'proper' terminology for what they've been doing all along.",
      choices: [
        { text: "Results not rhetoric - prove it on a project", reaction: "Fair test. Isolated, she struggles without buy-in. Concepts never land.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 1, hr: 1 }, mood: 1 },
        { text: "Build shared language - both sides adapt", reaction: "Hard work. Translation happens. Some frameworks stick. Team unifies.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { hr: 3, sci: 2 }, mood: 2 },
        { text: "This is how we talk here - adapt or struggle", reaction: "She's isolated. Leaves within months. Possibly useful ideas leave with her.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { hr: 1, sci: -1 }, mood: 0 }
      ]
    },
    // SCIENTIFIC METHOD IN ENTREPRENEURSHIP EVENTS
    {
      intro: "Your team spent months building a beloved feature. Before launch, you run a proper A/B test. The data is clear: users who see the feature convert 15% worse than the control group. The team insists the test must be flawed. The sample size is solid. The methodology is sound. The feature they love is hurting the product.",
      aside: "Science says kill it. The team's morale says save it. Both matter for survival.",
      choices: [
        { text: "Kill the feature - data wins", reaction: "Painful but right. Team learns that evidence beats intuition.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { dev: 3, hr: -1 }, mood: 1 },
        { text: "Iterate based on what data suggests", reaction: "Slower path. Feature improves. Team dignity preserved.", emoji: "ğŸ™‚", ap: 3, cost: 15, eff: { dev: 2, hr: 1 }, mood: 1 },
        { text: "Trust team's instincts, ship anyway", reaction: "Conversion drops. Team learns nothing. Confidence in data erodes.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: -1, hr: 1 }, mood: 0 }
      ]
    },
    {
      intro: "You're testing a new pricing model. After 50 customers, results look promising - 30% higher conversion. Your data scientist says you need 500 customers for statistical significance. Your sales lead says competitors are moving and you can't wait three months. The early signal is strong but not conclusive.",
      aside: "Rigorous science takes time. Markets don't wait. How much certainty is enough?",
      choices: [
        { text: "Wait for statistical significance", reaction: "Three months later, result holds. But competitors moved.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 3, mkt: -1 }, mood: 1 },
        { text: "Roll out with monitoring and kill switch", reaction: "Result mostly holds. Quick reversal on one segment that didn't.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: 2, sci: 1 }, mood: 1 },
        { text: "Trust the early signal, full rollout", reaction: "The 30% gain was noise. Conversion actually flat. Wasted quarter.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 2, dev: 1 }, mood: -1 }
      ]
    },
    {
      intro: "You spent Â£40k and three months testing whether your AI outperforms the existing solution. The answer is clear: it doesn't. Not worse, but not better. Your investors expect a breakthrough. Your team is deflated. But you now know something important - this approach is a dead end.",
      aside: "Null results are valid science. They're terrible marketing. But pretending they don't exist corrupts your decision-making.",
      choices: [
        { text: "Publish null result, pivot publicly", reaction: "Credibility with scientists. Investors nervous. Team respects honesty.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { sci: 3, mkt: -1, hr: 1 }, mood: 1 },
        { text: "Quietly pivot, don't discuss failure", reaction: "Move on cleanly. Learning stays internal.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 1 }, mood: 0 },
        { text: "Reframe as 'different' not 'not better'", reaction: "Marketing spin works short-term. Team knows truth. Trust erodes.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { mkt: 2, sci: -1, hr: -1 }, mood: -1 }
      ]
    },
    {
      intro: "Your founder is convinced the product needs a mobile app. She's collecting 'evidence' - customer quotes, competitor moves, industry reports. Your researcher points out she's only gathering evidence that supports her belief. The contradicting data - that power users are all desktop-based - keeps getting dismissed as 'edge cases.'",
      aside: "Founders often have intuition data can't capture. They also have blind spots data can reveal. Challenging the founder feels disloyal but might save the company.",
      choices: [
        { text: "Demand a proper falsifiable test first", reaction: "Test shows desktop-first is right. Founder grateful eventually.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { sci: 4, dev: 2 }, mood: 2 },
        { text: "Build minimal mobile prototype to test", reaction: "Prototype teaches us something. Founder convinced by evidence.", emoji: "ğŸ™‚", ap: 2, cost: 25, eff: { dev: 2, mkt: 1 }, mood: 1 },
        { text: "Trust founder's pattern recognition", reaction: "Mobile app built. Mixed results but we learned about the market.", emoji: "ğŸ˜", ap: 1, cost: 40, eff: { dev: 1, mkt: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Your team is about to run an important experiment. Your researcher wants to 'pre-register' it - write down exactly what you'll measure and what counts as success before seeing results. Commercial resists: 'What if we discover something unexpected? We need flexibility to interpret the data.'",
      aside: "Pre-registration prevents fooling yourself. It also prevents legitimate discovery. Real science does both.",
      choices: [
        { text: "Pre-register with defined success criteria", reaction: "Experiment fails criteria. But you trust the result. Clean pivot.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 4, mkt: -1 }, mood: 2 },
        { text: "Document hypotheses but allow flexibility", reaction: "Results ambiguous. Debate about what counts. Some learning.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { sci: 2 }, mood: 1 },
        { text: "Stay flexible - we'll know success when we see it", reaction: "Everyone sees what they want in the data. Nothing resolved.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 2, dev: 1 }, mood: -1 }
      ]
    },
    {
      intro: "Your data shows customers who use Feature X have 3x higher retention. Marketing wants to push everyone toward Feature X. Your analyst warns this might be correlation, not causation - maybe committed users find Feature X, rather than Feature X creating commitment. Testing causation properly would take months.",
      aside: "Correlation is a signal. Causation is proof. Waiting for proof is rigorous. Acting on correlation is fast.",
      choices: [
        { text: "Run controlled experiment for causation", reaction: "Three months later: it was correlation. Feature X doesn't cause retention.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 4, mkt: -1 }, mood: 1 },
        { text: "Push Feature X while monitoring carefully", reaction: "Retention doesn't change. Wasted effort but learned quickly.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 1 }, mood: 0 },
        { text: "Assume causation - we need wins now", reaction: "Campaign launched. Retention unchanged. Budget wasted.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 3, dev: 1 }, mood: -1 }
      ]
    },
    {
      intro: "Your investor pitch cites three successful companies that used your approach. Your researcher points out this is survivorship bias - you're ignoring hundreds who tried the same approach and failed. 'But investors expect success stories,' says commercial. 'Scientific accuracy isn't how fundraising works.'",
      aside: "Intellectually honest pitches might lose to dishonest competitors. But building strategy on survivorship bias means decisions based on flawed evidence.",
      choices: [
        { text: "Honest pitch with failure rates included", reaction: "Some investors respect rigour. Builds trust with the right ones.", emoji: "ğŸ˜Š", ap: 3, cost: 10, eff: { sci: 3, mkt: 2, hr: 2 }, mood: 2 },
        { text: "Success stories with caveats in appendix", reaction: "Standard practice. Investors skim appendix. Round closes.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { mkt: 3, cash: 30 }, mood: 1 },
        { text: "Play the game - pitch like everyone else", reaction: "Round closes fast. Strategy built on stories, not evidence.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 2, cash: 20 }, mood: -1 }
      ]
    },
    {
      intro: "A competitor published impressive results. Your team tried to replicate their methodology and got completely different outcomes. Either they got lucky, their method has hidden variables, or they're exaggerating. Publishing your replication attempt would be scientifically valuable but commercially aggressive.",
      aside: "Science advances through replication. Business advances through competitive advantage. Publishing helps the field but might help competitors more than you.",
      choices: [
        { text: "Publish replication failure publicly", reaction: "Scientific credibility soars. Competitor furious. Industry takes notice.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 4, mkt: -1, hr: 1 }, mood: 1 },
        { text: "Share privately with potential partners", reaction: "Partners trust your rigour. Competitor unaware.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { sci: 2, mkt: 1 }, mood: 1 },
        { text: "Keep as competitive intelligence", reaction: "Advantage preserved. Science doesn't advance.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 2 }, mood: 0 }
      ]
    },
    {
      intro: "Your team wants to build a full prototype to test a concept - six weeks of work. Your researcher argues you could test the core hypothesis with a paper mockup and 20 user interviews in one week. 'But users can't really evaluate something that isn't real,' engineering argues.",
      aside: "Cheaper experiments might give false signals. Expensive experiments are more valid but consume resources. How much confidence is worth how much money?",
      choices: [
        { text: "Paper prototype first, build only if validated", reaction: "Paper test kills idea early. Saved five weeks. Team initially frustrated.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { sci: 3, dev: 2 }, mood: 2 },
        { text: "Functional prototype with real metrics", reaction: "Six weeks later, clear signal. Expensive but conclusive.", emoji: "ğŸ™‚", ap: 4, cost: 30, eff: { dev: 4, mkt: 1 }, mood: 1 },
        { text: "Trust engineering intuition, skip testing", reaction: "Built something fast. Market reception mixed but we shipped.", emoji: "ğŸ˜", ap: 1, cost: 20, eff: { dev: 2 }, mood: 0 }
      ]
    },
    {
      intro: "Your experiment didn't show the result you wanted on your primary metric. But slicing the data differently - a subset of users, a different time window - you find a statistically significant positive result. It's not what you set out to prove, but it's something. Commercial is desperate for good news.",
      aside: "P-hacking - torturing data until it confesses - is scientifically dishonest. But exploratory findings are legitimate. The line between 'interesting subset' and 'misleading cherry-pick' is genuinely blurry.",
      choices: [
        { text: "Report honestly - primary metric failed", reaction: "Credibility preserved. Commercial disappointed. Right decision.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { sci: 4, mkt: -1 }, mood: 1 },
        { text: "Report subset finding with clear caveats", reaction: "Honest exploration. Requires follow-up. Defensible.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2, mkt: 1 }, mood: 0 },
        { text: "Lead with positive subset finding", reaction: "Press release looks good. Follow-up study fails. Credibility damaged.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 5 }, mood: -1 }
      ]
    },
    // ROBUST EVIDENCE COLLECTION EVENTS
    {
      intro: "Your biggest customer - 40% of revenue - wants a major feature change. They're specific, articulate, and threatening to leave. Building it would take two months. But they're one customer, and what they want might actively hurt your product for everyone else. Or they might be the canary in the coal mine, expressing what others feel but haven't said.",
      aside: "One customer isn't statistically significant. But this one customer might understand something others don't - or might be pulling you toward a niche you don't want.",
      choices: [
        { text: "Interview 20 similar customers first", reaction: "Takes three weeks. Turns out they're an outlier. You nearly rebuilt for one.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 4, mkt: -1 }, mood: 1 },
        { text: "Build it for them, optional for others", reaction: "They stay. Product complexity increases. Others ignore the feature.", emoji: "ğŸ™‚", ap: 4, cost: 35, eff: { mkt: 2, dev: -1 }, mood: 0 },
        { text: "Build it - they pay the bills", reaction: "Feature ships. Three other customers quietly churn. Wrong direction.", emoji: "ğŸ˜", ap: 3, cost: 25, eff: { mkt: 1, dev: -2 }, mood: -1 }
      ]
    },
    {
      intro: "User interviews say customers love Feature A and never use Feature B. Your analytics show customers barely touch Feature A but spend hours on Feature B. When confronted, users say 'Oh, I meant to use Feature A more' and 'I only use Feature B because I have to.' People are telling you the opposite of what they do.",
      aside: "What people say and what they do often diverge. Behaviour is real but doesn't explain motivation. Stated preferences explain motivation but may be aspirational fiction.",
      choices: [
        { text: "Trust behaviour data - actions don't lie", reaction: "You double down on Feature B. Users complain but keep using it. Revenue grows.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { dev: 3, sci: 2 }, mood: 1 },
        { text: "Trust stated preferences - users know what they want", reaction: "You invest in Feature A. Usage doesn't change. Wasted quarter.", emoji: "ğŸ˜", ap: 1, cost: 5, eff: { dev: -1 }, mood: 0 },
        { text: "Dig deeper - why the gap?", reaction: "Expensive research reveals: Feature A is aspirational, Feature B solves real pain. Both insights valuable.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 4, dev: 2 }, mood: 2 }
      ]
    },
    {
      intro: "Your customer satisfaction scores are excellent - 4.8 out of 5. But NPS is declining, and three long-term customers just churned without warning. Satisfaction measures the past. Churn reveals the present. By the time satisfaction drops, the damage is done. But you can't ignore that most customers report being happy.",
      aside: "Lagging indicators feel reassuring but describe yesterday. Leading indicators are noisy but predict tomorrow. Optimising for the wrong metrics means winning battles while losing wars.",
      choices: [
        { text: "Build leading indicator system", reaction: "Six months of work. You now see churn coming 90 days early. Game-changer.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 4, mkt: 2 }, mood: 2 },
        { text: "Deep-dive on churned customers", reaction: "Pattern emerges: power users outgrow you. Satisfaction high until suddenly gone.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 3, mkt: 1 }, mood: 1 },
        { text: "Trust satisfaction - three churns is noise", reaction: "Six more churn next quarter. Pattern was real. Expensive lesson.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 2, dev: 1 }, mood: -1 }
      ]
    },
    {
      intro: "You can't easily measure customer lifetime value directly - it takes years to know. So you use a proxy: engagement in the first week predicts long-term retention. But now teams are optimising for the proxy, adding features that boost week-one engagement but annoy users later. The metric that was supposed to represent value is being gamed.",
      aside: "Goodhart's Law: when a measure becomes a target, it ceases to be a good measure. But you can't manage what you can't measure. The act of measuring changes what's measured.",
      choices: [
        { text: "Multiple proxy metrics, resist gaming", reaction: "Harder to optimise. Teams frustrated. But signal quality improves.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 4, dev: 1 }, mood: 2 },
        { text: "Accept some gaming, recalibrate quarterly", reaction: "Cat and mouse game. Some waste. Better than flying blind.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2 }, mood: 0 },
        { text: "Trust teams to optimise for real value", reaction: "They optimise for the metric. Metric stops predicting value. Months of wasted effort.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, mkt: 2 }, mood: -1 }
      ]
    },
    {
      intro: "You interview users to understand why they love your product. Glowing feedback, great testimonials. But your researcher points out a problem: you only talked to current users. The ones who hated it left. You're getting feedback from survivors - the people your product already fits. You know nothing about why others abandoned you.",
      aside: "Survivors tell you what works. Churned users tell you what's broken. Selection bias means the easiest feedback to collect is the least useful for growth.",
      choices: [
        { text: "Hunt down and interview churned users", reaction: "Painful truths. They left because onboarding was confusing. Fixable. Growth unlocked.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 4, mkt: 2 }, mood: 2 },
        { text: "Intercept users at moment of leaving", reaction: "Exit survey reveals: 60% leave in first week. Never knew. Now you do.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 3, dev: 1 }, mood: 1 },
        { text: "Focus on making happy users happier", reaction: "Retention improves 5%. Acquisition stays flat. You've optimised a local maximum.", emoji: "ğŸ˜", ap: 1, cost: 5, eff: { mkt: 1 }, mood: 0 }
      ]
    },
    // MARKET SIZING EVENTS
    {
      intro: "Your rigorous bottom-up analysis says the market is Â£40 million. That's real, defensible, based on actual customer counts. Problem: venture capitalists want Â£500M+ markets. Your honest number won't get you funded. Your competitor just raised Â£15M claiming a Â£2 billion market - a number you're pretty sure is nonsense.",
      aside: "Being right and being funded aren't the same thing. Your competitor might be deluded - or they might understand something about fundraising you don't.",
      choices: [
        { text: "Stick with Â£40M, seek non-VC funding", reaction: "Angels and grants come through. Slower but you own more. Sustainable path.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2, mkt: 1 }, mood: 1 },
        { text: "Find the story where Â£40M is the beachhead", reaction: "Credible expansion narrative. Some VCs bite. Took longer.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: 3, sci: 1 }, mood: 1 },
        { text: "Match competitor's framing - play the game", reaction: "Round closes. Now you have to pretend the Â£2B is real. Board expects it.", emoji: "ğŸ˜", ap: 1, cost: 5, eff: { mkt: 2, sci: -2 }, mood: 0 }
      ]
    },
    {
      intro: "You've been telling everyone - team, investors, advisors - that 'thousands of companies' need your product. You finally did the proper count: 340 companies in the UK fit your ideal customer profile. Maybe 600 if you stretch. Your team of 12 is built to serve thousands. The honest number suggests you're dramatically overstaffed.",
      aside: "The careful count might be right, meaning you've over-built. Or the count might be missing latent demand that's real but hard to measure. Resizing based on analysis feels responsible; it also might mean giving up too early.",
      choices: [
        { text: "Resize team to match the real market", reaction: "Painful cuts. Survivors focused. Unit economics finally work.", emoji: "ğŸ˜", ap: 2, cost: 20, eff: { sci: 2, hr: -2 }, mood: -1 },
        { text: "Broaden definition - find adjacent segments", reaction: "New segments found. Product stretches. Some fit, some don't.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { mkt: 2, dev: -1 }, mood: 1 },
        { text: "The count must be missing something", reaction: "Six months later, the count was right. Runway shorter. Harder cuts ahead.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { sci: -1 }, mood: 0 }
      ]
    },
    {
      intro: "Surveys show strong demand - 70% say they'd 'definitely buy.' But when you look at actual spending in the category - current solutions, budgets allocated, money changing hands - it's tiny. People love the idea of your product. They just don't pay for this category of thing.",
      aside: "Stated demand and actual spending tell different stories. Maybe you'll change behaviour. Maybe behaviour is the truth.",
      choices: [
        { text: "Trust spending data - follow the money", reaction: "Smaller market but real buyers. Sales cycles shorter. Revenue predictable.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 3, mkt: 1 }, mood: 2 },
        { text: "Trust demand - we'll unlock the spending", reaction: "Long education cycle. Some convert. Most don't. Expensive lesson in behaviour change.", emoji: "ğŸ˜", ap: 2, cost: 20, eff: { mkt: 1, sci: -1 }, mood: 0 },
        { text: "Find where demand AND spending align", reaction: "Tiny segment but they buy fast. Niche beachhead. Growth from there.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { sci: 4, mkt: 2 }, mood: 2 }
      ]
    }
  ],
  
  // Dev-specific generic events
  dev: [
    {
      intro: "Security audit found vulnerabilities. None exploited yet, but concerning.",
      aside: "Security debt is invisible until it isn't.",
      choices: [
        { text: "Full security remediation sprint", reaction: "Sleep better at night.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { dev: 3, hr: 1 }, mood: 2 },
        { text: "Fix critical issues, monitor rest", reaction: "Risk managed, not eliminated.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2 }, mood: 0 },
        { text: "Accept risk, keep shipping", reaction: "Move fast. Ship product.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Team wants to rewrite a core component. Current one works but is painful.",
      aside: "Rewrites are seductive. Often take longer than expected.",
      choices: [
        { text: "Approve focused rewrite", reaction: "Technical debt paid down.", emoji: "ğŸ˜Š", ap: 4, cost: 25, eff: { dev: 4, hr: 1 }, mood: 2 },
        { text: "Incremental refactoring instead", reaction: "Slower but safer.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2 }, mood: 0 },
        { text: "Keep current implementation", reaction: "Stability preserved. Team adapts.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Open source dependency has a concerning maintainer situation.",
      aside: "Supply chain risk is real. But building everything yourself is worse.",
      choices: [
        { text: "Fork and maintain internally", reaction: "Control but overhead.", emoji: "ğŸ˜Š", ap: 4, cost: 20, eff: { dev: 2 }, mood: 1 },
        { text: "Contribute to keep project alive", reaction: "Community goodwill. Some risk remains.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { dev: 1, mkt: 1 }, mood: 1 },
        { text: "Monitor and hope", reaction: "Gather data. Make informed decision later.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Production incident last night. Systems recovered, but root cause unclear.",
      aside: "Incidents are learning opportunities. If we actually learn.",
      choices: [
        { text: "Full post-mortem, systemic fixes", reaction: "Won't happen again. Probably.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { dev: 3, hr: 1 }, mood: 2 },
        { text: "Quick fix, move on", reaction: "Patched. Root cause lingers.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 },
        { text: "Blame individual, close ticket", reaction: "Clear accountability. Issue resolved.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "New framework everyone's excited about. Migration would be significant.",
      aside: "Shiny object syndrome is real. But so is technical stagnation.",
      choices: [
        { text: "Pilot on new project first", reaction: "Learn before committing.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { dev: 2, hr: 1 }, mood: 2 },
        { text: "Wait for it to mature", reaction: "Let others find the bugs.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 },
        { text: "Full migration now", reaction: "Ambitious. Possibly reckless.", emoji: "ğŸ˜", ap: 4, cost: 35, eff: { dev: 3, hr: -1 }, mood: 0 }
      ]
    },
    // NEW: Complementors and partner relationship events
    {
      intro: "A popular tool that lets non-programmers build apps wants to connect with our product. Their 50,000 users could start using our AI, but we'd have to help them when things go wrong.",
      aside: "Partnerships like this are how platforms grow. But if their users have a bad experience, they'll blame us.",
      choices: [
        { text: "Build a proper connection with full support", reaction: "Their 50k users can now access us.", emoji: "ğŸ˜Š", ap: 4, cost: 35, eff: { dev: 3, mkt: 4, cash: 30 }, mood: 2 },
        { text: "Let them connect, but minimal help", reaction: "They can build, we won't hand-hold.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 1, mkt: 2, cash: 15 }, mood: 0 },
        { text: "Decline-focus on our own product", reaction: "Control preserved. Stay focused.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "CloudScale wants us in their marketplace. Co-marketing budget available, but they take 20% of revenue.",
      aside: "Enterprise buyers trust the marketplace. The margin hit hurts though.",
      choices: [
        { text: "Full marketplace integration", reaction: "Enterprise procurement unlocked. CloudScale logo helps.", emoji: "ğŸ˜Š", ap: 4, cost: 40, eff: { dev: 2, mkt: 4, cash: 60 }, mood: 2 },
        { text: "Listed but not featured", reaction: "Present but not promoted.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 1, mkt: 2, cash: 20 }, mood: 0 },
        { text: "Stay independent", reaction: "Full control. Better margins.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1, cash: 10 }, mood: 0 }
      ]
    },
    {
      intro: "A company we see as a competitor wants to integrate. Their product complements ours in unexpected ways.",
      aside: "Coopetition is tricky. But together we solve a problem neither can alone.",
      choices: [
        { text: "Strategic partnership with clear boundaries", reaction: "Frenemies who serve customers better.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { dev: 3, mkt: 3 }, mood: 2 },
        { text: "Technical integration only", reaction: "Works together, no joint marketing.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 2, mkt: 1 }, mood: 0 },
        { text: "Keep distance", reaction: "Clean strategy. Independence preserved.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Stratton Consulting wants to train consultants on our platform. They'd sell implementation services to enterprises.",
      aside: "SIs open enterprise doors. But they also set customer expectations we might not meet.",
      choices: [
        { text: "Formal SI partner programme", reaction: "Certified consultants selling us to FTSE 100.", emoji: "ğŸ˜Š", ap: 5, cost: 45, eff: { dev: 2, mkt: 5, cash: 80 }, mood: 2 },
        { text: "Informal training, no certification", reaction: "They can learn, no guarantees either way.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 1, mkt: 2, cash: 30 }, mood: 0 },
        { text: "Direct sales only", reaction: "Control the customer experience.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Developers are asking for a proper SDK-a toolkit that makes it easier for them to build on our platform-plus better documentation. It's infrastructure work with no direct revenue.",
      aside: "Developer love compounds. But it's hard to measure and easy to deprioritise.",
      choices: [
        { text: "Full SDK with examples and docs", reaction: "Developers build things we never imagined.", emoji: "ğŸ˜Š", ap: 4, cost: 35, eff: { dev: 4, mkt: 2 }, mood: 2 },
        { text: "Improved docs, basic SDK", reaction: "Better than nothing. Not inspiring.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 2, mkt: 1 }, mood: 0 },
        { text: "Focus on enterprise, not developers", reaction: "Enterprise deals. Bigger contracts.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { mkt: 2 }, mood: 0 }
      ]
    },
    {
      intro: "SiliconCore wants to feature us as an optimisation case study. Free hardware credits, but we'd be in their marketing.",
      aside: "GPU credits are expensive. Being seen as a 'SiliconCore shop' has implications.",
      choices: [
        { text: "Deep partnership with co-engineering", reaction: "Optimised for their silicon. Their events feature us.", emoji: "ğŸ˜Š", ap: 4, cost: 20, eff: { dev: 4, sci: 2, cash: 50 }, mood: 2 },
        { text: "Accept credits, minimal commitment", reaction: "Free compute. Light branding.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { dev: 2, cash: 25 }, mood: 0 },
        { text: "Stay hardware-agnostic", reaction: "Flexibility preserved. Pay full price.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 2 }, mood: 0 }
      ]
    },
    // FUN: Humorous dev events
    {
      intro: "Someone committed 'TODO: fix this later' to production. That was 18 months ago. It's now load-bearing.",
      aside: "Every codebase has its demons. This one has documentation.",
      choices: [
        { text: "Heroic refactoring sprint", reaction: "It's fixed! Also, three other things broke. Then got fixed.", emoji: "ğŸ˜Š", ap: 4, cost: 25, eff: { dev: 4 }, mood: 2 },
        { text: "Add more TODOs explaining the first TODO", reaction: "Future archaeologists will understand. Team laughs.", emoji: "ğŸ“", ap: 1, cost: 0, eff: { hr: 2 }, mood: 1 },
        { text: "Rename it to 'WONTFIX: this is fine'", reaction: "Technically not lying anymore. Team laughs.", emoji: "ğŸ”¥", ap: 1, cost: 0, eff: { hr: 2 }, mood: 1 }
      ]
    },
    {
      intro: "The deploy pipeline broke at 5pm Friday. Lead dev says they can fix it 'real quick'. It's now 11pm.",
      aside: "Some lessons are only learned the hard way. This is one of them.",
      choices: [
        { text: "Call it-everyone go home", reaction: "Fresh eyes Monday. Team appreciates it.", emoji: "ğŸ•", ap: 1, cost: 10, eff: { hr: 3 }, mood: 2 },
        { text: "All-hands crisis mode", reaction: "Fixed at 2am. Team bonds over shared trauma.", emoji: "ğŸ’ª", ap: 3, cost: 15, eff: { dev: 3, hr: -1 }, mood: 0 },
        { text: "Rollback and pretend this didn't happen", reaction: "Nobody mentions Friday. Ever.", emoji: "ğŸ™ˆ", ap: 2, cost: 5, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Intern pushed directly to main branch. In their defence, the tutorial they followed was from 2015.",
      aside: "The staging environment exists for a reason. Now everyone knows that reason.",
      choices: [
        { text: "Blameless post-mortem, fix permissions", reaction: "Learning opportunity. Intern mortified but grows.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { dev: 2, hr: 2 }, mood: 2 },
        { text: "Quietly revert and update onboarding docs", reaction: "What push? There was no push.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1, hr: 1 }, mood: 0 },
        { text: "Make it a team-wide teaching moment", reaction: "Intern presents 'How I Broke Production' at Friday demos.", emoji: "ğŸ¤", ap: 2, cost: 0, eff: { dev: 1, hr: 3 }, mood: 2 }
      ]
    },
    {
      intro: "The AI has started responding to customer queries with 'As an AI language model, I cannot...' We don't use that model.",
      aside: "It's learned this from training data. Customers are confused. So are we.",
      choices: [
        { text: "Emergency prompt engineering", reaction: "Crisis averted. AI now says 'Happy to help!'", emoji: "ğŸ¤–", ap: 2, cost: 10, eff: { dev: 2, mkt: 1 }, mood: 1 },
        { text: "Add it to the brand voice as quirky", reaction: "Surprisingly, users find it endearing.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 2, hr: 1 }, mood: 1 },
        { text: "Fine-tune on better data", reaction: "Proper fix. Takes a week. Worth it.", emoji: "ğŸ˜Š", ap: 4, cost: 25, eff: { dev: 4, sci: 2 }, mood: 2 }
      ]
    },
    // LEAN STARTUP EVENTS
    {
      intro: "Your engineers want to build the feature 'properly.' Your advisor says ship a crude prototype now and learn. The feature list keeps growing.",
      aside: "The minimum viable product (MVP) debate: perfectionism vs learning velocity. Ship something basic now, or build it properly first?",
      choices: [
        { text: "Ship the MVP now, learn fast", reaction: "Customers gave feedback. Some of it hurts. All of it helps.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: 3, dev: -1 }, mood: 1 },
        { text: "Build it right first", reaction: "Beautiful code. But still no customer feedback.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { dev: 4 }, mood: 1 },
        { text: "One more sprint, then ship", reaction: "Compromise reached. Team aligned.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2, mkt: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Customer interviews reveal nobody wants your main feature. But they love a side feature you built as an afterthought.",
      aside: "The pivot question. Your vision vs the market's verdict.",
      choices: [
        { text: "Pivot to the side feature", reaction: "Painful, but the metrics immediately improve.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { mkt: 4, dev: -2 }, mood: 1 },
        { text: "Double down on the vision", reaction: "You believe. But believing isn't validating.", emoji: "ğŸ˜", ap: 2, cost: 15, eff: { dev: 2 }, mood: 0 },
        { text: "Run both in parallel", reaction: "Team stretched thin across two roadmaps.", emoji: "ğŸ˜Ÿ", ap: 4, cost: 30, eff: { dev: 2, mkt: 2, hr: -2 }, mood: -1 }
      ]
    },
    {
      intro: "Downloads are up 300%! But active users and revenue are flat. The board loves the download number.",
      aside: "Vanity metrics vs actionable metrics. One feels good, one is useful.",
      choices: [
        { text: "Report the honest metrics", reaction: "Awkward board meeting. But now focused on what matters.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 2, mkt: 1 }, mood: 2 },
        { text: "Celebrate the wins publicly", reaction: "Great press. Investors impressed. Problem unsolved.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3, sci: -1 }, mood: 0 },
        { text: "Dig into cohort analysis", reaction: "You finally understand where users drop off.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 3, dev: 2 }, mood: 2 }
      ]
    },
    {
      intro: "Your biggest paying customer wants a feature that would take the product in a completely different direction.",
      aside: "Customer development tension: serve one well, or build for many?",
      choices: [
        { text: "Build what they want", reaction: "They're happy. But is this still your product?", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { mkt: 4, cash: 40 }, mood: 1 },
        { text: "Decline politely", reaction: "They're disappointed. Vision preserved.", emoji: "ğŸ˜", ap: 1, cost: 5, eff: { dev: 1, mkt: -1 }, mood: 0 },
        { text: "Propose a compromise", reaction: "Nobody's thrilled. Relationship survives.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2, mkt: 2 }, mood: 0 }
      ]
    },
    {
      intro: "Investors are pushing you to hire aggressively and expand. But you haven't found product-market fit yet.",
      aside: "Premature scaling is a startup killer. But so is moving too slowly.",
      choices: [
        { text: "Scale as they suggest", reaction: "Runway shortened. Pressure intensified. Still searching for fit.", emoji: "ğŸ˜", ap: 3, cost: 40, eff: { hr: 3, mkt: 2 }, mood: 0 },
        { text: "Stay lean until fit", reaction: "Investors grumble. Runway intact.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 2 }, mood: 1 },
        { text: "Hire for learning, not growth", reaction: "Two customer development specialists join. Answers come faster.", emoji: "ğŸ˜Š", ap: 2, cost: 20, eff: { sci: 3, mkt: 1 }, mood: 2 }
      ]
    },
    {
      intro: "You could automate the service, or manually deliver it yourself to the first 10 customers and learn what they actually need.",
      aside: "Sometimes the best way to learn what customers need is to do it manually first-even if it doesn't scale.",
      choices: [
        { text: "Do it manually first", reaction: "Exhausting, but learned more in a week than months of planning.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { sci: 4, mkt: 2 }, mood: 2 },
        { text: "Build the automation", reaction: "Elegant solution. Customers use it differently than expected.", emoji: "ğŸ™‚", ap: 4, cost: 35, eff: { dev: 4 }, mood: 1 },
        { text: "Hybrid approach", reaction: "Half-automated, half-manual. Awkward but informative.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 2, sci: 2 }, mood: 0 }
      ]
    },
    {
      intro: "The A/B test results are in. Version B converts 40% better, but your team thinks it's ugly and 'not on brand.'",
      aside: "Data vs instinct. The eternal product debate.",
      choices: [
        { text: "Go with the data", reaction: "Team sulks. Conversions soar.", emoji: "ğŸ˜Š", ap: 1, cost: 5, eff: { mkt: 4, hr: -1 }, mood: 1 },
        { text: "Trust the team's instincts", reaction: "Beautiful product. Customers still not converting.", emoji: "ğŸ˜", ap: 1, cost: 5, eff: { hr: 2 }, mood: 0 },
        { text: "Iterate on B's insights", reaction: "Find the why behind the what. Best of both.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { dev: 3, mkt: 2 }, mood: 2 }
      ]
    },
    {
      intro: "Your progress can't be measured in traditional metrics yet. How do you show the board you're learning, not just burning?",
      aside: "Innovation accounting: measuring validated learning, not vanity metrics.",
      choices: [
        { text: "Implement learning milestones", reaction: "Board sceptical at first, then engaged. Learning becomes the currency.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { sci: 3, mkt: 1 }, mood: 2 },
        { text: "Focus on revenue anyway", reaction: "Premature monetisation. Some revenue, less learning.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 2, sci: -1 }, mood: 0 },
        { text: "Ask for patience", reaction: "Trust account depleted. Clock ticking louder.", emoji: "ğŸ˜Ÿ", ap: 1, cost: 0, eff: { dev: 2, sci: 1 }, mood: -1 }
      ]
    },
    // DESIGN THINKING EVENTS
    {
      intro: "Before writing any code, your designer wants to draw what the finished experience looks like - frame by frame, like a film storyboard.",
      aside: "A sketch takes minutes. Building the wrong thing takes months.",
      choices: [
        { text: "Detailed visual walkthrough", reaction: "Engineers and designers finally see the same thing. Arguments halved.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { dev: 3, hr: 2 }, mood: 2 },
        { text: "Written description instead", reaction: "Everyone imagines something different. Discover this at launch.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 },
        { text: "Build and figure it out", reaction: "Ship fast. Fix the confusion later.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Before building anything, your designer wants to test paper drawings with real users. Engineers think it's a waste when they could just build it.",
      aside: "Paper is cheap. Code is expensive. Learning which ideas are wrong costs less on paper.",
      choices: [
        { text: "Paper testing with 10 users", reaction: "Killed three features before writing a line of code. Saved months.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { sci: 3, dev: 2 }, mood: 2 },
        { text: "Quick digital mockup", reaction: "Looks real. Users gave feedback on colours, not flows.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { dev: 2 }, mood: 0 },
        { text: "Just build it", reaction: "Real code. Expensive to change later.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    // LEAD USER EVENTS (Von Hippel)
    {
      intro: "A power user has hacked together exactly the feature you were planning to build. It's rough but works. They're sharing it in forums.",
      aside: "Users often innovate ahead of manufacturers. Their solutions reveal real needs.",
      choices: [
        { text: "Hire them as consultant", reaction: "Their solution becomes your feature. They know edge cases you'd never find.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { dev: 4, sci: 2 }, mood: 2 },
        { text: "Study their approach", reaction: "Learn from it. Build your own version.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { dev: 2, sci: 1 }, mood: 1 },
        { text: "Build it yourself properly", reaction: "Clean implementation. Took longer than expected.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2 }, mood: 0 }
      ]
    },
    {
      intro: "A customer using your product in extreme conditions - remote locations, unusual scale, harsh environments - has pushed it far beyond normal limits. They've found every weakness.",
      aside: "Extreme users stress-test your product for free. What breaks there works everywhere else.",
      choices: [
        { text: "Site visit to their operation", reaction: "What breaks there works everywhere else. Invaluable stress testing.", emoji: "ğŸ˜Š", ap: 3, cost: 30, eff: { dev: 4, sci: 2 }, mood: 2 },
        { text: "Remote debrief call", reaction: "Good feedback. Missed the context.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { dev: 2 }, mood: 1 },
        { text: "Note for future reference", reaction: "Edge case documented. Not prioritised.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { sci: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Power users are asking for tools to extend and customise your product themselves. Building this means less control over the user experience.",
      aside: "Give users tools and they build things you never imagined. Some better than your ideas.",
      choices: [
        { text: "Full customisation toolkit", reaction: "Users build things you never imagined. Some are better than your ideas.", emoji: "ğŸ˜Š", ap: 4, cost: 35, eff: { dev: 4, mkt: 3 }, mood: 2 },
        { text: "Limited API access", reaction: "Controlled extensibility. Power users satisfied.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { dev: 2, mkt: 1 }, mood: 1 },
        { text: "Keep it closed", reaction: "Consistent experience. Power users frustrated.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    // BOOTLEGGING & UNPROGRAMMED R&D EVENTS
    {
      intro: "Two engineers built a working prototype over the weekend using company equipment. Nobody asked them to. It solves a problem you'd shelved as 'too hard.' They look nervous showing you.",
      aside: "Unauthorised initiative. Against process. Also exactly what you needed.",
      choices: [
        { text: "Celebrate and fund it", reaction: "Word spreads: initiative gets rewarded here.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { dev: 4, hr: 2 }, mood: 2 },
        { text: "Adopt it, redirect them to priorities", reaction: "Good outcome. Mixed message about initiative.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { dev: 2 }, mood: 0 },
        { text: "Remind them about authorised projects", reaction: "Process followed. Prototype gathers dust.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, sci: 1 }, mood: -1 }
      ]
    },
    {
      intro: "Engineers have been coming in on weekends to work on 'their own stuff' using company servers. You're not paying them for it. They're not asking permission. Some of it looks promising.",
      aside: "Grey area. Liability concerns. But also where the interesting ideas live.",
      choices: [
        { text: "Make it official with hackathons", reaction: "Channel the energy. Add pizza and prizes.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { dev: 3, hr: 2 }, mood: 2 },
        { text: "Set boundaries but allow it", reaction: "Grey area preserved. Innovation continues.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 2, hr: 1 }, mood: 1 },
        { text: "Lock down after-hours access", reaction: "Liability concerns addressed. Weekend warriors stop coming.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, hr: 1 }, mood: -1 }
      ]
    },
    {
      intro: "Your best engineer wants to take two people and work separately from the main team - different location, no standups, no roadmap. They'll either fail completely or build something amazing.",
      aside: "Skunkworks. High risk, high reward. Also sets a precedent.",
      choices: [
        { text: "Approve the skunkworks", reaction: "Three months later, they demo something impossible. Main team is jealous.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { dev: 5, sci: 2 }, mood: 2 },
        { text: "Keep them integrated but protected", reaction: "Some autonomy. Some oversight. Medium results.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { dev: 2, hr: 1 }, mood: 1 },
        { text: "Everyone follows the same process", reaction: "Fair. Consistent. Safe. Predictable.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    // PSYCHOLOGICAL SAFETY EVENTS
    {
      intro: "A junior engineer raised concerns about the product timeline weeks ago. Everyone dismissed her. She was right. Now the team is nervous about speaking up at all.",
      aside: "What happens when warnings are ignored teaches everyone what's actually valued here.",
      choices: [
        { text: "Public acknowledgment she was right", reaction: "Uncomfortable meeting. But now people know warnings are valued.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { hr: 4, dev: 2 }, mood: 2 },
        { text: "Quiet word of thanks", reaction: "She knows. Others don't. Pattern continues.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 },
        { text: "Move on, focus on fixing it", reaction: "No blame. Also no learning. Next warning stays silent.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 3, mkt: 1 }, mood: -1 }
      ]
    },
    {
      intro: "Your team keeps choosing the conservative option in every decision. When you dig deeper, you learn they're afraid of being blamed if bold choices fail.",
      aside: "Fear kills innovation quietly. Nobody announces they're playing it safe.",
      choices: [
        { text: "Celebrate a smart failure publicly", reaction: "Redefine what gets punished. Risk-taking returns.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { dev: 3, hr: 2, sci: 1 }, mood: 2 },
        { text: "Explicitly authorise bold experiments", reaction: "Permission given. Fear remains until proven safe.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { dev: 2, hr: 1 }, mood: 1 },
        { text: "Accept cautious culture for now", reaction: "Steady progress. Breakthrough unlikely.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    // NEURODIVERSITY EVENT
    {
      intro: "Your ADHD engineer just saved a major deadline with 72 hours of hyperfocused brilliance. Now they're crashed - exhausted, behind on everything else, feeling like a failure despite being the hero. The team is annoyed about the dropped balls, unaware of what just happened.",
      aside: "The same trait that saved you is now making them look unreliable. Whose job is it to explain?",
      choices: [
        { text: "Explain to team, protect recovery time", reaction: "Team understands. They build in buffer for the next burst.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { hr: 4, dev: 2 }, mood: 2 },
        { text: "Quietly cover for them, hope they recover", reaction: "You absorb the stress. They never know you noticed.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 },
        { text: "Deadline's done, they need to catch up", reaction: "Hero on Tuesday, problem by Friday. They start hiding the crashes.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 3, mkt: 2 }, mood: -1 }
      ]
    },
    // GENDER & DIVERSITY EVENT
    {
      intro: "In a client meeting, technical questions keep going to your male junior developer instead of your female tech lead sitting next to him. He keeps deferring to her. The client doesn't get it. She's handling it professionally but you can see she's exhausted by this. Third time this month.",
      aside: "The bias isn't yours but the burden falls on your team. What's your move?",
      choices: [
        { text: "Call it out directly in the meeting", reaction: "Awkward silence. Client recalibrates. She finally gets to do her job.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { hr: 4, mkt: -1 }, mood: 2 },
        { text: "Let her handle it, strong support after", reaction: "She's capable. Also tired of being capable at this.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 1 }, mood: 0 },
        { text: "Restructure who attends client meetings", reaction: "Problem avoided. Not solved. She notices.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { mkt: 2, hr: -2 }, mood: -1 }
      ]
    },
    // CULTURAL DIVERSITY EVENT
    {
      intro: "Your Dutch developer gives blunt feedback: 'This code is wrong.' Your Japanese colleague finds this unbearably rude and has stopped contributing in reviews. Your Dutch developer thinks the Japanese colleague is 'hiding problems.' Both are excellent engineers. Neither understands the other.",
      aside: "Neither style is wrong - they're different cultural defaults. But someone has to adapt, or you need a shared third way.",
      choices: [
        { text: "Facilitated conversation about styles", reaction: "Awkward at first. Then illuminating. They build a shared language.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { hr: 4, dev: 2 }, mood: 2 },
        { text: "Set team norms for feedback language", reaction: "Clear rules. Some flexibility lost. Fewer misunderstandings.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { hr: 2, dev: 1 }, mood: 1 },
        { text: "They're adults, they'll figure it out", reaction: "They don't. Code reviews become silent. Problems surface later.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, mkt: 1 }, mood: -1 }
      ]
    },
    // CORPORATE HIRE EVENTS
    {
      intro: "Your new VP Engineering from a large tech company is horrified by your codebase. No documentation, no code reviews, tribal knowledge everywhere. She wants 'proper engineering practices.' Founding engineers say it'll slow them down. She says you're building on sand.",
      aside: "She's right that it's unsustainable. They're right that it'll slow things down. The question is when you pay the cost.",
      choices: [
        { text: "Implement her full framework", reaction: "Painful quarter. Then things start working better. Tech debt stops compounding.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { dev: 4, hr: 1 }, mood: 1 },
        { text: "Gradual adoption, founders choose pace", reaction: "Compromise. Some improvement. Some resistance.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { dev: 2, hr: 1 }, mood: 1 },
        { text: "We've got this far without it", reaction: "She leaves. Six months later, onboarding takes three months. Nobody can explain why anything works.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, mkt: 1 }, mood: -1 }
      ]
    },
    {
      intro: "Your new COO from a consultancy has introduced 'structured decision-making' - pre-reads, agendas, action items, follow-ups. Founding team used to decide things in Slack threads and corridor chats. Important context is now captured. But your best ideas emerged from chaos, not calendars.",
      aside: "Structure captures decisions. Chaos generates ideas. The old team is suffocating. The new hire is drowning in ambiguity.",
      choices: [
        { text: "Embrace the new structure fully", reaction: "Decisions documented. Creativity drops. Some founders check out.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 2, sci: -2 }, mood: 0 },
        { text: "Formal for external, informal for internal", reaction: "Best of both. Harder to maintain. Some confusion about which mode.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { hr: 2, sci: 1 }, mood: 1 },
        { text: "Revert to startup chaos", reaction: "He leaves frustrated. Context disappears again. Mistakes repeat.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 3, mkt: 1 }, mood: -1 }
      ]
    },
    // TOXIC STARTUP CULTURE EVENT
    {
      intro: "Your new engineer from a hypergrowth startup ships code constantly - no tests, no reviews, straight to production. He's incredibly fast. He's also broken production twice this month. 'At my last place, we shipped 50 times a day. Speed is everything.' Your careful engineers are frustrated. But his velocity is impressive.",
      aside: "He's exposing that your process might be slower than necessary. But his 'fast' has a cost. Who's right?",
      choices: [
        { text: "Speed with guardrails - adapt or leave", reaction: "Tension, then breakthrough. He learns tests. Team learns velocity.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { dev: 3, hr: 2 }, mood: 2 },
        { text: "Sandbox him on experimental projects", reaction: "Contained chaos. Some gems emerge. Production stays stable.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { dev: 2 }, mood: 1 },
        { text: "Maybe our process is too slow", reaction: "Team speeds up. Quality drops. Outages increase. He was wrong.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 3, mkt: 2 }, mood: -1 }
      ]
    }
  ],
  
  // Marketing-specific generic events
  marketing: [
    {
      intro: "Influencer offering to promote us. Big following, unclear authenticity.",
      aside: "Influencer marketing works. When it's authentic.",
      choices: [
        { text: "Paid partnership with clear terms", reaction: "Reach expanded. Brand associated.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { mkt: 3 }, mood: 2 },
        { text: "Smaller micro-influencer campaign", reaction: "More authentic. Less reach.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 1 },
        { text: "Focus on organic growth", reaction: "Slower but more sustainable.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Customer asking for case study. Great story, but they want approval rights.",
      aside: "Case studies sell. But approval processes can water them down.",
      choices: [
        { text: "Agree to approval, get the story", reaction: "Good enough. Better than nothing.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: 3 }, mood: 1 },
        { text: "Anonymous case study instead", reaction: "Less credible. More control.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { mkt: 1 }, mood: 0 },
        { text: "Wait for less restrictive customer", reaction: "Better fit coming. Patience pays.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "A trade publication is offering sponsored content that would reach your exact buyer persona next week. Problem: your competitor just got earned coverage in the same publication with a glowing profile. Sponsored content now feels like an admission you couldn't get the real thing.",
      aside: "The timing is brutal. Silence lets them own the narrative. Sponsored content looks desperate. Pitching earned coverage takes months you don't have.",
      choices: [
        { text: "Run sponsored content anyway - be visible", reaction: "You're in the conversation. Some readers notice the 'sponsored' tag. Others don't care.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { mkt: 3 }, mood: 0 },
        { text: "Pitch a counter-story to their competitor publication", reaction: "Different audience, fresh angle. Takes a month. Might not land.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: 2, sci: 1 }, mood: 1 },
        { text: "Ignore it and outship them instead", reaction: "Product speaks louder than PR. But their story circulates for months.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 4, sci: 1 }, mood: -1 }
      ]
    },
    {
      intro: "A former enterprise customer just posted a scathing review on G2. Half of it is unfair - they broke the integration themselves and blamed you. But half is true - your onboarding was chaotic and support was slow. Three hot prospects this quarter will read this review. Your sales team is panicking.",
      aside: "The unfair parts make you want to fight back. The fair parts make fighting back risky. Public responses live forever. So do unanswered accusations.",
      choices: [
        { text: "Detailed public response addressing each point", reaction: "Prospects see you engage seriously. Also see dirty laundry aired in public.", emoji: "ğŸ™‚", ap: 3, cost: 10, eff: { mkt: 2, hr: -1 }, mood: 0 },
        { text: "Private outreach, fix the real issues, ask for update", reaction: "They soften the review slightly. You fixed something that needed fixing.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { mkt: 1, dev: 2, hr: 1 }, mood: 1 },
        { text: "Bury it with requests for happy customer reviews", reaction: "Diluted but not gone. Astute prospects notice the timing.", emoji: "ğŸ˜", ap: 2, cost: 5, eff: { mkt: 1 }, mood: -1 }
      ]
    },
    {
      intro: "Opportunity to sponsor a UK AI community TeamChat. Thousands of potential customers.",
      aside: "Community presence builds trust over time. Not immediate sales.",
      choices: [
        { text: "Sponsor plus active participation", reaction: "Become known as helpful, not salesy.", emoji: "ğŸ˜Š", ap: 4, cost: 20, eff: { mkt: 4, hr: 1 }, mood: 2 },
        { text: "Sponsor with logo placement only", reaction: "Visible but not engaged.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 0 },
        { text: "Skip-focus on direct outreach", reaction: "Personal touch matters more.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Open source project using our tech gaining traction. Could amplify or stay quiet.",
      aside: "Open source credibility is earned, not bought. Developers talk.",
      choices: [
        { text: "Actively support with resources", reaction: "Developers notice. Word spreads.", emoji: "ğŸ˜Š", ap: 4, cost: 25, eff: { mkt: 3, dev: 2 }, mood: 2 },
        { text: "Public endorsement and retweets", reaction: "Low effort visibility boost.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 2 }, mood: 1 },
        { text: "Let it grow organically", reaction: "Slow but sustainable growth.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 2, hr: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Local AI meetup wants us to host and speak. Time commitment but builds reputation.",
      aside: "Grassroots reputation compounds. The people you meet today hire you tomorrow.",
      choices: [
        { text: "Host, speak, and sponsor drinks", reaction: "Become the local AI hub.", emoji: "ğŸ˜Š", ap: 4, cost: 20, eff: { mkt: 3, hr: 2 }, mood: 2 },
        { text: "Just give a talk", reaction: "Share knowledge without overcommitting.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { mkt: 2 }, mood: 1 },
        { text: "Decline-too busy", reaction: "Focus on priorities. Protect time.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Podcast invitation from respected UK tech host. Good reach, requires prep.",
      aside: "Founder voice builds trust. But every word is on record.",
      choices: [
        { text: "Accept with thorough preparation", reaction: "Compelling story. Clips circulate.", emoji: "ğŸ˜Š", ap: 3, cost: 10, eff: { mkt: 4 }, mood: 2 },
        { text: "Accept, wing it", reaction: "Authentic but rough edges show.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { mkt: 2 }, mood: 0 },
        { text: "Decline-not ready for spotlight", reaction: "Wait until we're ready. Better story later.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Customer success story going viral on CareerHub. Could amplify or let it breathe.",
      aside: "Organic virality is gold. Heavy-handed amplification kills it.",
      choices: [
        { text: "Gentle reshare with gratitude", reaction: "Authentic engagement. Keeps momentum.", emoji: "ğŸ˜Š", ap: 1, cost: 0, eff: { mkt: 3 }, mood: 2 },
        { text: "Full marketing push behind it", reaction: "Feels forced. Some backlash.", emoji: "ğŸ˜", ap: 3, cost: 15, eff: { mkt: 2 }, mood: 0 },
        { text: "Stay quiet, let customer shine", reaction: "Humble. But miss the wave.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 0 }
      ]
    },
    // NEW: External actor engagement events (non-university)
    {
      intro: "Gartner wants to brief us for their AI market report. How we present determines our 'quadrant' position.",
      aside: "Enterprise buyers read Gartner religiously. Getting this right matters.",
      choices: [
        { text: "Full executive briefing with demos", reaction: "Analyst impressed. Mentions us favourably.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { mkt: 5, cash: 40 }, mood: 2 },
        { text: "Standard briefing call", reaction: "We're in the report. Not highlighted.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 2 }, mood: 0 },
        { text: "Skip-analysts don't understand us", reaction: "Focus on customers who get it.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Cabinet Office is running an AI procurement framework. Getting on it means access to all government buyers.",
      aside: "Public sector moves slowly but pays reliably. Security clearances take time.",
      choices: [
        { text: "Full framework application", reaction: "Months of paperwork. Door opens to billions in spend.", emoji: "ğŸ˜Š", ap: 5, cost: 40, eff: { mkt: 3, hr: 1, cash: 100 }, mood: 2 },
        { text: "Partner with approved supplier", reaction: "Ride their accreditation. Share the revenue.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { mkt: 2, cash: 50 }, mood: 0 },
        { text: "Focus on private sector", reaction: "Faster sales cycles. Revenue builds.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1, cash: 10 }, mood: 0 }
      ]
    },
    {
      intro: "The UK AI Industry Association wants us to join. Lobbying access and peer networking, but membership fees and time.",
      aside: "Policy shapes our market. Being in the room when rules are written matters.",
      choices: [
        { text: "Active membership with committee roles", reaction: "Shape the conversation. Know what's coming.", emoji: "ğŸ˜Š", ap: 4, cost: 35, eff: { mkt: 3, sci: 1, hr: 1 }, mood: 2 },
        { text: "Basic membership only", reaction: "Newsletter and events. No influence.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 1 }, mood: 0 },
        { text: "Stay outside associations", reaction: "Independent. Focus on customers.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "The Financial Times wants an exclusive on our funding round. Great coverage, but other outlets will be annoyed.",
      aside: "FT readers are decision-makers. Exclusives build relationships with journalists.",
      choices: [
        { text: "Give FT the exclusive with CEO interview", reaction: "Front page of tech section. Inbox explodes.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { mkt: 5, hr: 1 }, mood: 2 },
        { text: "Broad press release to all outlets", reaction: "Fair coverage everywhere. No headline.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3 }, mood: 0 },
        { text: "Stay quiet about the round", reaction: "Stealth preserved. Surprise competitors.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "A major public health system Trust wants to pilot our solution. Prestige and case study value, but public health system procurement is complex.",
      aside: "public health system validation is gold for UK healthtech. The pilot could take a year to close.",
      choices: [
        { text: "Commit resources to public health system pilot", reaction: "Slow burn. Massive credibility if it works.", emoji: "ğŸ˜Š", ap: 4, cost: 45, eff: { mkt: 6, sci: 3 }, mood: 2 },
        { text: "Limited pilot with clear boundaries", reaction: "Test the waters. Manage expectations.", emoji: "ğŸ™‚", ap: 2, cost: 25, eff: { mkt: 3, sci: 1 }, mood: 1 },
        { text: "Decline-private sector focus", reaction: "Faster revenue. Simpler sales.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 1, cash: 10 }, mood: 0 }
      ]
    },
    {
      intro: "We've been nominated for 'AI Startup of the Year'. Winning requires a strong submission and attending the gala.",
      aside: "Awards are marketing. But the right award on the website converts prospects.",
      choices: [
        { text: "Full submission with case studies", reaction: "Win or shortlist. Either way, we're visible.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { mkt: 4, hr: 1 }, mood: 2 },
        { text: "Basic submission", reaction: "In the running. Not favourites.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 2 }, mood: 0 },
        { text: "Skip awards circuit", reaction: "Focus on customers, not trophies.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "A FTSE 100 company's venture arm-the investment division of one of Britain's largest corporations-wants to invest. Strategic value but they'd want board observer rights.",
      aside: "Corporate VCs open doors to their parent company. They also have agendas.",
      choices: [
        { text: "Accept investment with commercial deal", reaction: "Money plus customer. Worth the complexity.", emoji: "ğŸ˜Š", ap: 4, cost: 0, eff: { mkt: 3, cash: 150 }, mood: 2 },
        { text: "Commercial partnership, no investment", reaction: "Keep cap table clean. Still get the deal.", emoji: "ğŸ™‚", ap: 3, cost: 10, eff: { mkt: 2, cash: 60 }, mood: 0 },
        { text: "Decline-stay independent", reaction: "Pure focus. Full control.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "A German distributor wants exclusive rights for DACH region. They know the market but exclusivity is risky.",
      aside: "Local partners accelerate international. Bad partners block you from markets.",
      choices: [
        { text: "Non-exclusive partnership with targets", reaction: "They earn exclusivity by performing.", emoji: "ğŸ˜Š", ap: 4, cost: 30, eff: { mkt: 4, cash: 50 }, mood: 2 },
        { text: "Exclusive with exit clause", reaction: "They get the chance. Clock is ticking.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { mkt: 3, cash: 30 }, mood: 0 },
        { text: "Go direct when ready", reaction: "Control the brand. Patient expansion.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 2, dev: 1 }, mood: 0 }
      ]
    },
    // FUN: Humorous marketing events
    {
      intro: "Company CareerHub went viral. Unfortunately, it's because of a typo that made our AI product sound... adult.",
      aside: "There's no such thing as bad publicity. Except this. This might be bad publicity.",
      choices: [
        { text: "Lean in with self-deprecating humour", reaction: "Thread goes more viral. Brand seems human.", emoji: "ğŸ˜‚", ap: 1, cost: 0, eff: { mkt: 4, hr: 1 }, mood: 2 },
        { text: "Delete and issue professional correction", reaction: "Screenshots live forever. But we tried.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { mkt: 1 }, mood: 0 },
        { text: "Pretend it was intentional guerrilla marketing", reaction: "Spin it well. Customers amused.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 2 }, mood: 0 }
      ]
    },
    {
      intro: "A B-list celebrity wants to invest and become 'brand ambassador'. Their agent is very pushy.",
      aside: "They have 2 million followers. Also several ongoing controversies.",
      choices: [
        { text: "Politely decline with good wishes", reaction: "Stay focused. Maintain relationship.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 },
        { text: "Small investment, no ambassador role", reaction: "Money in, drama out. Reasonable.", emoji: "ğŸ™‚", ap: 2, cost: 0, eff: { mkt: 1, cash: 30 }, mood: 0 },
        { text: "Full partnership-YOLO", reaction: "Followers up! Also, tabloid mentions. Mixed bag.", emoji: "ğŸ°", ap: 3, cost: 10, eff: { mkt: 5, hr: -2 }, mood: 0 }
      ]
    },
    {
      intro: "Competitor's marketing director just followed everyone on your team on CareerHub. Everyone.",
      aside: "Are they recruiting? Spying? Just lonely?",
      choices: [
        { text: "Block and brief the team", reaction: "Fortress mentality engaged.", emoji: "ğŸ°", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 },
        { text: "Follow them back aggressively", reaction: "Now everyone's awkwardly watching everyone.", emoji: "ğŸ‘€", ap: 1, cost: 0, eff: { mkt: 1 }, mood: 1 },
        { text: "Post obviously fake roadmap hints", reaction: "If they're watching, give them something to think about.", emoji: "ğŸ­", ap: 2, cost: 5, eff: { mkt: 2 }, mood: 2 }
      ]
    },
    {
      intro: "Your demo video accidentally included 3 seconds of the CEO's music app playing '70s disco hits.",
      aside: "It's on a video platform. Comments are... supportive.",
      choices: [
        { text: "Re-upload the clean version", reaction: "Professional. The internet remembers anyway.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { mkt: 1 }, mood: 0 },
        { text: "Embrace it-add disco to company culture", reaction: "Friday playlist now mandatory. Morale surprisingly high.", emoji: "ğŸ’ƒ", ap: 1, cost: 0, eff: { mkt: 3, hr: 2 }, mood: 2 },
        { text: "CEO addresses it directly on CareerHub", reaction: "'Yes, I love disco. Moving on.' Legend status achieved.", emoji: "ğŸ˜Š", ap: 1, cost: 0, eff: { mkt: 4, hr: 2 }, mood: 2 }
      ]
    },
    // DESIGN THINKING EVENTS
    {
      intro: "Your designer wants to sketch a comic strip showing a typical customer's day - before they find you, their frustrations, and how your product changes things.",
      aside: "A picture tells a thousand words. Stories stick better than feature lists.",
      choices: [
        { text: "Full illustrated customer story", reaction: "Sales team tells this story in every pitch. Customers nod - 'that's exactly me.'", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { mkt: 4, sci: 1 }, mood: 2 },
        { text: "Quick bullet points instead", reaction: "List of pain points. Less memorable.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { mkt: 2 }, mood: 0 },
        { text: "Features speak for themselves", reaction: "Skip the storytelling. Hope the product sells itself.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Your designer wants to spend a week in customers' actual workplaces, watching how they use the product. Not interviews - just observing.",
      aside: "People say one thing, do another. Watching reveals what asking never will.",
      choices: [
        { text: "Full week of observation", reaction: "Discovered three problems you never knew existed. Changed everything.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { sci: 4, dev: 2 }, mood: 2 },
        { text: "A few site visits", reaction: "Useful glimpses. Context helps.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 2, dev: 1 }, mood: 1 },
        { text: "Stick to phone interviews", reaction: "They told you what they think you want to hear.", emoji: "ğŸ˜", ap: 1, cost: 5, eff: { sci: 1 }, mood: 0 }
      ]
    },
    // LEAD USER EVENTS (Von Hippel)
    {
      intro: "An online community has sprung up where users share hacks, modifications, and workarounds for your product. Some are brilliant. Some void warranties.",
      aside: "User innovation communities are free R&D. If you listen.",
      choices: [
        { text: "Engage and learn from them", reaction: "Best ideas folded into product. Community feels heard.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { mkt: 4, dev: 2 }, mood: 2 },
        { text: "Quietly observe", reaction: "Free R&D. They don't know you're watching.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { sci: 2, dev: 1 }, mood: 0 },
        { text: "Send cease and desist", reaction: "Legally safe. Community furious. Bad press.", emoji: "ğŸ˜Ÿ", ap: 1, cost: 0, eff: { dev: 2 }, mood: -1 }
      ]
    },
    {
      intro: "Your advisor suggests assembling a panel of your most demanding, innovative customers - the ones who push boundaries and complain constructively.",
      aside: "Lead users face needs today that mainstream users will face tomorrow.",
      choices: [
        { text: "Formal lead user panel", reaction: "Quarterly sessions. They spot problems before anyone else. Roadmap transformed.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { sci: 3, mkt: 3 }, mood: 2 },
        { text: "Ad-hoc conversations", reaction: "Useful when it happens. No structure.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2, mkt: 1 }, mood: 1 },
        { text: "Survey all customers equally", reaction: "Democratic. Average feedback.", emoji: "ğŸ˜", ap: 1, cost: 5, eff: { mkt: 1 }, mood: 0 }
      ]
    },
    // BOOTLEGGING EVENT
    {
      intro: "A brilliant researcher at a rival just quit because they wouldn't let her work on her ideas. She's asking if you're different. You're not sure you are.",
      aside: "Top talent wants freedom. Can you offer it? Should you promise it?",
      choices: [
        { text: "Hire her with innovation freedom", reaction: "Expensive promise. She'll hold you to it. But the ideas are worth it.", emoji: "ğŸ˜Š", ap: 3, cost: 30, eff: { sci: 4, hr: 1 }, mood: 2 },
        { text: "Hire her into normal structure", reaction: "Great talent. Same constraints. Clock starts ticking.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { sci: 2 }, mood: 0 },
        { text: "Pass - too high maintenance", reaction: "Easier hire elsewhere. Six months later she's at a competitor.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    // GENDER & DIVERSITY EVENT
    {
      intro: "You're invited to a prestigious industry panel. When the lineup is announced, it's all men. Organisers ask if you know any women who could join. Your female CTO is eminently qualified - but she's told you she's sick of being the 'diversity invite,' added last to fix optics.",
      aside: "She's qualified and should be there. But being added as an afterthought is demeaning.",
      choices: [
        { text: "Suggest her, be honest about situation", reaction: "You explain. She decides. At least she has the choice.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { mkt: 2, hr: -1 }, mood: 0 },
        { text: "Decline to participate yourself", reaction: "Principled stand. Costs visibility. She notices and appreciates it.", emoji: "ğŸ˜Š", ap: 2, cost: 0, eff: { hr: 3, mkt: -2 }, mood: 1 },
        { text: "Participate, raise issue privately", reaction: "You go. Mention it to organisers. Nothing changes for next time.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 2 }, mood: 0 }
      ]
    },
    // CULTURAL DIVERSITY EVENT
    {
      intro: "Your best sales engineer has a strong Nigerian accent. Brilliant technically, warm personally - but a client just requested 'someone easier to understand' for calls. Your sales engineer knows why they've been reassigned before. They're waiting to see what you do.",
      aside: "'Easier to understand' is often code for something else. Accommodating it rewards bias. But losing the client has real costs.",
      choices: [
        { text: "Keep them on, address client directly", reaction: "Client uncomfortable. Most adjust. Your engineer finally trusts you.", emoji: "ğŸ˜Š", ap: 3, cost: 5, eff: { hr: 5, mkt: 2 }, mood: 2 },
        { text: "Pair them with a co-presenter", reaction: "Compromise. Shows support. Some awkwardness.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 2, mkt: 2 }, mood: 1 },
        { text: "Reassign to keep client happy", reaction: "They nod. Update their CV that evening.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 2 }, mood: -1 }
      ]
    },
    // CORPORATE HIRE EVENT
    {
      intro: "Your new Marketing Director from a multinational keeps proposing campaigns that cost more than your runway. When you explain the budget, she's genuinely confused. 'We'd never launch without proper research.' She's used to resources you don't have. But she knows what 'good' looks like.",
      aside: "Her standards are expensive. Your constraints are real. Can she learn to do brilliant work with nothing? Should she have to?",
      choices: [
        { text: "Give her a real budget, trust judgment", reaction: "Expensive bet. Campaign works. You've bought corporate-quality marketing.", emoji: "ğŸ˜Š", ap: 3, cost: 40, eff: { mkt: 5, cash: -20 }, mood: 2 },
        { text: "Teach her scrappy startup marketing", reaction: "Frustrating months. Then something clicks. She becomes dangerous.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 3, hr: 1 }, mood: 1 },
        { text: "Let her figure it out or leave", reaction: "She can't. She leaves. Your marketing stays amateur.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, cash: 20 }, mood: -1 }
      ]
    },
    // TOXIC STARTUP CULTURE EVENT
    {
      intro: "Your new sales lead from a fast-growth startup closes deals by promising features you don't have. 'We'll build it for you' - without checking engineering. He's promised three clients things that will take six months. His defence: 'That's how you grow. Engineering always catches up.'",
      aside: "He's not wrong that startups stretch. But engineering is firefighting promises instead of building the roadmap. Where's the line between ambitious and dishonest?",
      choices: [
        { text: "Stop him now, reset client expectations", reaction: "Painful conversations. Some clients walk. Trust preserved internally.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { hr: 4, mkt: 2 }, mood: 2 },
        { text: "Deliver what he promised, this time", reaction: "Roadmap derailed. Make it clear: last time.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { mkt: 3, dev: 1 }, mood: 0 },
        { text: "This is how startups work - adapt", reaction: "Short-term revenue. Long-term culture damage.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 2, cash: 20 }, mood: -1 }
      ]
    }
  ],
  
  // HR-specific generic events  
  hr: [
    {
      intro: "The team's been hinting about the sad instant coffee situation. Someone left a printout of fancy espresso machine prices on your desk.",
      aside: "A proper latte machine costs as much as a junior dev's monthly salary. But the queue at the coffee shop costs time and money too.",
      choices: [
        { text: "Get the fancy La Marzocca with training", reaction: "Barista-quality flat whites. Team genuinely delighted.", emoji: "â˜•", ap: 2, cost: 15, eff: { hr: 4 }, mood: 2 },
        { text: "Sensible bean-to-cup machine", reaction: "Decent coffee. Nobody's writing poems about it.", emoji: "ğŸ™‚", ap: 1, cost: 8, eff: { hr: 2 }, mood: 1 },
        { text: "Upgrade the instant coffee selection", reaction: "Small perk appreciated.", emoji: "ğŸ™‚", ap: 1, cost: 2, eff: { hr: 1 }, mood: 0 }
      ]
    },
    {
      intro: "End of year approaching. Bonus expectations high, budget tight.",
      aside: "Promises made need keeping. Or explaining.",
      choices: [
        { text: "Stretch for meaningful bonuses", reaction: "Retention protected. Cash impacted.", emoji: "ğŸ˜Š", ap: 2, cost: 30, eff: { hr: 4 }, mood: 2 },
        { text: "Smaller bonuses, clear communication", reaction: "Disappointed but understand.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { hr: 1 }, mood: 0 },
        { text: "Skip bonuses, promise next year", reaction: "Preserve runway. Team understands.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { cash: 20 }, mood: 0 }
      ]
    },
    {
      intro: "Overheard complaints about meeting overload. Calendars are packed.",
      aside: "Meetings multiply. Productivity suffers.",
      choices: [
        { text: "Meeting audit and no-meeting days", reaction: "Calendar breathing room.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { hr: 3, dev: 1 }, mood: 2 },
        { text: "Encourage meeting hygiene", reaction: "Some improvement.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 1 },
        { text: "Trust teams to manage themselves", reaction: "Autonomy builds ownership.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
      ]
    },
    // NEW: Additional HR events
    {
      intro: "Star performer asking for a raise. Deserved, but outside the budget cycle.",
      aside: "Lose them and you lose months of momentum. Pay them and others will ask too.",
      choices: [
        { text: "Match the ask with clear expectations", reaction: "They're staying. Worth every penny.", emoji: "ğŸ˜Š", ap: 2, cost: 20, eff: { hr: 3, dev: 1 }, mood: 2 },
        { text: "Partial raise plus equity top-up", reaction: "Creative package. They appreciate the effort.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 2, equity: -1 }, mood: 1 },
        { text: "Promise to revisit at review time", reaction: "Fair timeline. They appreciate honesty.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Team member's mental health visibly struggling. Performance slipping.",
      aside: "People aren't machines. But you're also running a business.",
      choices: [
        { text: "Supportive conversation, offer flexibility", reaction: "They open up. Workload adjusted.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { hr: 4 }, mood: 2 },
        { text: "Point to EAP and give space", reaction: "Professional distance. Some improvement.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 2 }, mood: 0 },
        { text: "Focus on performance expectations", reaction: "Clear standards. They step up.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Parental leave request from a key team member. Timing is terrible.",
      aside: "You can't say no. You can decide how to handle it.",
      choices: [
        { text: "Generous leave with full support", reaction: "They'll move mountains for you when they return.", emoji: "ğŸ˜Š", ap: 3, cost: 25, eff: { hr: 4, dev: -1 }, mood: 2 },
        { text: "Statutory minimum with clear handover", reaction: "Legally compliant. Not inspiring.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 1, dev: -1 }, mood: 0 },
        { text: "Pressure for early return", reaction: "They return energised. Needed the push.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { dev: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Anonymous feedback survey results are in. Some stinging comments.",
      aside: "Feedback is a gift. Even when it's wrapped in frustration.",
      choices: [
        { text: "All-hands to discuss openly", reaction: "Vulnerable but builds trust.", emoji: "ğŸ˜Š", ap: 3, cost: 5, eff: { hr: 4 }, mood: 2 },
        { text: "Action plan shared privately", reaction: "Changes happen. Connection to feedback unclear.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { hr: 2 }, mood: 0 },
        { text: "Thank people, move on quietly", reaction: "Acknowledged. Team moves forward.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Exit interview reveals manager problems. Not the first complaint.",
      aside: "Bad managers are expensive. So is losing good managers.",
      choices: [
        { text: "Coaching and development plan", reaction: "Manager improves. Team notices effort.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { hr: 3 }, mood: 1 },
        { text: "Move them to individual contributor", reaction: "Pride hurt. Skills preserved.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { hr: 2, dev: 1 }, mood: 0 },
        { text: "Part ways with generous terms", reaction: "Clean break. Some shock in the team.", emoji: "ğŸ˜", ap: 2, cost: 25, eff: { hr: 1, dev: -1 }, mood: -1 }
      ]
    },
    {
      intro: "Office dog proposal gaining signatures. Some allergies and preferences in the mix.",
      aside: "Dogs boost morale for dog people. Others less enthused.",
      choices: [
        { text: "Trial office dog days", reaction: "Surprisingly popular. Even skeptics pet the dog.", emoji: "ğŸ•", ap: 1, cost: 5, eff: { hr: 3 }, mood: 2 },
        { text: "Create dog-friendly zone", reaction: "Compromise. Dog lovers happy, others unbothered.", emoji: "ğŸ™‚", ap: 1, cost: 3, eff: { hr: 2 }, mood: 1 },
        { text: "Politely decline citing allergies", reaction: "Inclusive policy. Everyone comfortable.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Salary benchmarking reveals you're behind market on some roles.",
      aside: "Underpaying works until people check WorkReview.",
      choices: [
        { text: "Market adjustment for affected roles", reaction: "Retention improves. Budget takes hit.", emoji: "ğŸ˜Š", ap: 3, cost: 35, eff: { hr: 4 }, mood: 2 },
        { text: "Increase for flight risks only", reaction: "Some feel undervalued. Others stay.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { hr: 1 }, mood: 0 },
        { text: "Emphasise equity and mission", reaction: "Mission-driven people energised.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Learning and development budget cut by finance. Team noticed.",
      aside: "Training feels like a luxury until people stagnate.",
      choices: [
        { text: "Protect budget, cut elsewhere", reaction: "People feel invested in.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { hr: 3, sci: 1 }, mood: 2 },
        { text: "Internal knowledge sharing instead", reaction: "Cheaper. Actually quite good.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { hr: 2 }, mood: 1 },
        { text: "Accept the cuts for now", reaction: "Lean but sustainable. Team adapts.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { cash: 15 }, mood: 0 }
      ]
    },
    // FUN: Humorous HR events
    {
      intro: "The office thermostat has become a battleground. Passive-aggressive Post-it notes are appearing.",
      aside: "The thermostat wars have claimed greater companies than this one.",
      choices: [
        { text: "Install smart climate zones", reaction: "Peace in our time. Expensive peace.", emoji: "â„", ap: 2, cost: 12, eff: { hr: 3 }, mood: 2 },
        { text: "CEO declares 21Â°C law", reaction: "Controversial. But decisive.", emoji: "ğŸŒ¡", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 },
        { text: "Distribute branded hoodies and fans", reaction: "Dress code chaos. But warm chaos.", emoji: "ğŸ§¥", ap: 1, cost: 8, eff: { hr: 2, mkt: 1 }, mood: 1 }
      ]
    },
    {
      intro: "Someone's been microwaving fish in the kitchen. Repeatedly. HR inbox is full.",
      aside: "Some problems have no good solutions. Only least-bad ones.",
      choices: [
        { text: "Gentle all-hands about kitchen etiquette", reaction: "Fish microwaving stops. Resentment lingers.", emoji: "ğŸŸ", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 },
        { text: "Install a second microwave in a 'zone'", reaction: "The Fish Zone is born. Problem contained.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 2 }, mood: 1 },
        { text: "Anonymous fish amnesty", reaction: "Nobody confesses. Fish incidents decrease mysteriously.", emoji: "ğŸ¤«", ap: 1, cost: 0, eff: { hr: 1 }, mood: 1 }
      ]
    },
    {
      intro: "Secret Santa got weird. Someone gave their manager a self-help book about 'leadership presence'.",
      aside: "It was meant to be Â£10 and fun. It became neither.",
      choices: [
        { text: "Laugh it off at the party", reaction: "Manager reads the book. Actually finds it useful.", emoji: "ğŸ“š", ap: 1, cost: 0, eff: { hr: 2 }, mood: 1 },
        { text: "Abolish Secret Santa forever", reaction: "Less stress. Team grateful.", emoji: "ğŸ…", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 },
        { text: "Next year: strict gift guidelines", reaction: "Takes the fun out. But also the drama.", emoji: "ğŸ“‹", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 }
      ]
    },
    {
      intro: "Team discovered the CEO's secret video channel. It's mostly them reviewing motorway service stations.",
      aside: "Everyone's pretending they haven't seen it. They have all seen it.",
      choices: [
        { text: "Own it-make it a company thing", reaction: "CEO now reviews service stations for team travel. Iconic.", emoji: "ğŸ›£", ap: 1, cost: 0, eff: { hr: 3, mkt: 2 }, mood: 2 },
        { text: "Never speak of it", reaction: "Team bonds over shared silence.", emoji: "ğŸ¤", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0 },
        { text: "CEO addresses it in all-hands", reaction: "Turns out Leigh Delamere services are 4/5 stars.", emoji: "â­", ap: 1, cost: 0, eff: { hr: 4 }, mood: 2 }
      ]
    },
    {
      intro: "Someone printed 500 pages of their novel on the office printer. It's actually quite good.",
      aside: "Technically a fireable offence. But the prose is genuinely compelling.",
      choices: [
        { text: "Quiet word about appropriate use", reaction: "They apologise. Offer you an early copy.", emoji: "ğŸ“–", ap: 1, cost: 0, eff: { hr: 1 }, mood: 1 },
        { text: "Expense it as 'creative culture'", reaction: "Finance confused but compliant.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 2 }, mood: 1 },
        { text: "Start an office book club with it", reaction: "Chapter 7 discussion gets heated. Bonding achieved.", emoji: "ğŸ“š", ap: 2, cost: 5, eff: { hr: 3 }, mood: 2 }
      ]
    },
    // DESIGN THINKING EVENT
    {
      intro: "Your designer wants engineers, salespeople, and customer support in the same room for a brainstorm. Some think it's a waste of billable hours.",
      aside: "The best ideas often come from unexpected places. But meetings have costs.",
      choices: [
        { text: "Full cross-team session", reaction: "The support rep's idea was the breakthrough. Nobody expected that.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { hr: 3, dev: 2 }, mood: 2 },
        { text: "Representatives only", reaction: "Good discussion. Limited perspectives.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { dev: 2, hr: 1 }, mood: 1 },
        { text: "Keep teams in their lanes", reaction: "Efficient silos. Echo chamber preserved.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0 }
      ]
    },
    // BOOTLEGGING EVENT
    {
      intro: "Your most creative researcher spends half their time on ideas that go nowhere. They've also produced your only two breakthroughs. Investors want everyone 'aligned to strategy.'",
      aside: "Breakthroughs don't come from alignment. But neither does reliable progress.",
      choices: [
        { text: "Protect their freedom", reaction: "Investors grumble. Breakthroughs continue. Maybe.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { sci: 4, mkt: -1 }, mood: 2 },
        { text: "Assign them strategic problems only", reaction: "Focused. Productive. Somehow less innovative.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { sci: 2, dev: 1 }, mood: 0 },
        { text: "Pair them with someone practical", reaction: "Creative tension. Some ideas survive the filter.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 3, dev: 2 }, mood: 1 }
      ]
    },
    // PSYCHOLOGICAL SAFETY EVENT
    {
      intro: "Everyone can see the new initiative isn't working, but nobody wants to tell the executive who championed it. You've created a culture where challenging leaders feels unsafe.",
      aside: "The Emperor's New Clothes. Everyone knows. Nobody speaks.",
      choices: [
        { text: "Invite the criticism yourself", reaction: "Model vulnerability. Ask what's not working. Listen without defending.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { hr: 4, sci: 2 }, mood: 2 },
        { text: "Anonymous feedback to leadership", reaction: "Truth reaches you. Source stays hidden. Trust not rebuilt.", emoji: "ğŸ™‚", ap: 1, cost: 5, eff: { hr: 2 }, mood: 0 },
        { text: "Wait for metrics to speak", reaction: "Numbers eventually force the conversation. Months wasted.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, sci: 1 }, mood: -1 }
      ]
    },
    // NEURODIVERSITY EVENT
    {
      intro: "Your autistic researcher just demolished a client's flawed methodology in a meeting - publicly, precisely, and without softening. They were completely right. The client is furious and threatening to walk. Your researcher doesn't understand why being correct isn't enough.",
      aside: "They were right. Does being right the wrong way matter? The whole team is watching how you handle this.",
      choices: [
        { text: "Back your researcher, lose the client", reaction: "Expensive integrity. Word spreads internally: we value truth here.", emoji: "ğŸ˜Š", ap: 3, cost: 0, eff: { sci: 5, hr: 4 }, mood: 2 },
        { text: "Apologise to client, debrief privately", reaction: "Client stays. Researcher learns to soften. Balance maintained.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { mkt: 3, sci: 1 }, mood: 1 },
        { text: "Blame the researcher to save the deal", reaction: "Client mollified. Team sees what loyalty means here.", emoji: "ğŸ˜Ÿ", ap: 1, cost: 0, eff: { mkt: 2 }, mood: -2 }
      ]
    },
    // GENDER & DIVERSITY EVENTS
    {
      intro: "Your top performer returns from maternity leave. Her role was 'temporarily' filled by someone who's done well and grown into it. She wants her old responsibilities back. He argues he's earned them now. Both have legitimate points. The whole team is watching.",
      aside: "Protecting her role punishes him for stepping up. Not protecting it punishes her for having a child.",
      choices: [
        { text: "Restore her role fully", reaction: "Right thing legally. He feels betrayed. Starts job hunting.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { hr: 3, dev: -1 }, mood: 1 },
        { text: "Split responsibilities between them", reaction: "Compromise. Neither fully satisfied. Tension lingers.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { hr: 1 }, mood: 0 },
        { text: "Let them work it out themselves", reaction: "Avoid the hard call. They both resent you for it.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, mkt: 1 }, mood: -1 }
      ]
    },
    {
      intro: "Salary review reveals your female engineers earn 15% less than male peers at the same level - not because you paid them less, but because they negotiated less aggressively at hiring. Fixing it costs Â£60k. Not fixing it means accepting a gap you now know exists.",
      aside: "They agreed to those salaries. But now you know the pattern. What do you do with that knowledge?",
      choices: [
        { text: "Equalise all salaries now", reaction: "Expensive. Right. Some men grumble about 'negotiation skills'. Women stay.", emoji: "ğŸ˜Š", ap: 3, cost: 60, eff: { hr: 5, sci: 2 }, mood: 2 },
        { text: "Adjust offers, phase in parity", reaction: "Cheaper. Slower. Women wait for fairness you could give now.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { hr: 3, sci: 1 }, mood: 1 },
        { text: "Performance-based path to parity", reaction: "Slower path. Saves money but some talent may not wait.", emoji: "ğŸ˜", ap: 1, cost: 10, eff: { hr: 1, cash: 30 }, mood: 0 }
      ]
    },
    // CULTURAL DIVERSITY EVENTS
    {
      intro: "You're reviewing CVs and notice your hiring manager filters unconsciously. Candidates with anglicised names get callbacks at twice the rate of those with South Asian or African names - same qualifications. When you raise it, she's defensive: 'I'm just picking the best fit.'",
      aside: "She's not malicious - the bias is invisible to her. Forcing process changes feels accusatory. Not changing means the pattern continues.",
      choices: [
        { text: "Implement blind CV screening", reaction: "Process change. She's offended initially. Pipeline transforms within months.", emoji: "ğŸ˜Š", ap: 2, cost: 10, eff: { hr: 4, sci: 2 }, mood: 2 },
        { text: "Data conversation, let her adjust", reaction: "She tries. Bias is stubborn. Some improvement.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { hr: 2 }, mood: 1 },
        { text: "Drop it - she means well", reaction: "Pattern continues. Your team stays homogeneous. Nobody connects the dots.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { hr: 1, dev: 1 }, mood: -1 }
      ]
    },
    {
      intro: "Your company closes for Christmas and Easter. Hindu, Muslim, and Jewish employees use annual leave for Diwali, Eid, and Yom Kippur. Someone points out Christian employees get their holidays 'free' while others pay from their allowance.",
      aside: "The current system isn't neutral - it just feels neutral to the majority. Changing it costs money or productivity.",
      choices: [
        { text: "Floating holidays - everyone chooses", reaction: "Logistically complex. Genuinely fair. People feel seen.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { hr: 5 }, mood: 2 },
        { text: "Add major non-Christian holidays", reaction: "More days off. Some grumble about 'too many holidays'. Most appreciate it.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 3, dev: -1 }, mood: 1 },
        { text: "Keep current system - clients expect it", reaction: "Practical. Unfair. Minority employees notice you chose convenience.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { mkt: 2, cash: 20 }, mood: -1 }
      ]
    },
    {
      intro: "Your sponsored visa employee is being given extra work by a manager who knows she can't easily quit. She hasn't complained - she can't risk it. Another team member tips you off. The power imbalance is baked into the system.",
      aside: "Visa dependency creates vulnerability that formal policies don't fix. Real support means reducing her dependency on your goodwill.",
      choices: [
        { text: "Address it, fast-track her settlement", reaction: "Expensive commitment. She can finally breathe. Loyalty earned, not coerced.", emoji: "ğŸ˜Š", ap: 3, cost: 15, eff: { hr: 5, sci: 2 }, mood: 2 },
        { text: "Quiet conversation with the manager", reaction: "Behaviour stops. Power dynamic remains. She's still trapped.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { hr: 2 }, mood: 1 },
        { text: "Monitor the situation", reaction: "You watch. She endures. Eventually leaves for a company that sponsors faster.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 1, mkt: 1 }, mood: -1 }
      ]
    },
    // CORPORATE HIRE EVENTS
    {
      intro: "Your new People lead from a professional services firm is appalled. No proper contracts. No performance reviews. No grievance procedure. 'You're one lawsuit away from disaster.' She's found three arrangements that are legally problematic. But building HR infrastructure feels like becoming the corporation you fled.",
      aside: "The informal culture is why people joined. The informal culture is also legally precarious.",
      choices: [
        { text: "Full HR infrastructure now", reaction: "Painful formalisation. But that employment tribunal you didn't know was coming? Averted.", emoji: "ğŸ˜Š", ap: 3, cost: 20, eff: { hr: 4, dev: -1 }, mood: 1 },
        { text: "Fix legal risks, keep culture light", reaction: "Minimum viable compliance. Culture mostly preserved. Some gaps remain.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { hr: 2 }, mood: 1 },
        { text: "We're a family, not a corporation", reaction: "She leaves. Two months later, a disgruntled leaver files a claim. You weren't a family to them.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { hr: 2, dev: 1 }, mood: -1 }
      ]
    },
    {
      intro: "Your new Director from a large energy company keeps waiting for permission and escalating decisions upward. Your flat structure confuses her - she can't tell who's in charge. Meanwhile, existing staff make decisions without asking. She thinks they're reckless. They think she's passive.",
      aside: "She's been trained that unauthorised decisions get you fired. They've been trained that waiting means missing opportunities. Neither instinct is wrong in its original context.",
      choices: [
        { text: "Clarify decision rights explicitly", reaction: "Written clarity. Less startup chaos. Some magic lost, some sanity gained.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { hr: 3, dev: 1 }, mood: 2 },
        { text: "Coach her into the flat structure", reaction: "Months of adjustment. She either adapts or doesn't. Uncertain outcome.", emoji: "ğŸ™‚", ap: 2, cost: 5, eff: { hr: 1 }, mood: 0 },
        { text: "Let natural selection sort it out", reaction: "She's frozen. Founders race ahead. She leaves feeling set up to fail.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, sci: 1 }, mood: -1 }
      ]
    },
    // TOXIC STARTUP CULTURE EVENTS
    {
      intro: "Your new hire from a well-known failed startup keeps talking about 'grinding' and 'hustle.' She openly brags about 80-hour weeks at her last company. Your team worked hard but went home at reasonable hours. Now some feel guilty leaving at 6pm. Others are irritated by the performance.",
      aside: "Her last startup failed - maybe because of the burnout culture. But your team is now questioning whether they're committed enough.",
      choices: [
        { text: "Address it: sustainable pace here", reaction: "Clear boundary set. She adjusts or leaves. Team exhales.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { hr: 4 }, mood: 2 },
        { text: "Let culture sort itself out", reaction: "Hustle spreads. Six months later, three resignations.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, mkt: 1 }, mood: -1 },
        { text: "Maybe she has a point about intensity", reaction: "Short-term output spikes. Long-term attrition begins.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 4, mkt: 2 }, mood: -1 }
      ]
    },
    {
      intro: "Your new COO from a founder-led startup treats you like a visionary who shouldn't be questioned. She shuts down criticism in meetings. Filters what bad news reaches you. Refers to decisions as 'what the founder wants.' Staff are afraid to push back. You're increasingly in a bubble.",
      aside: "She's trying to help you lead. But she's creating a court, not a team. Comfortable for you, dangerous for the company.",
      choices: [
        { text: "Explicitly invite disagreement", reaction: "Awkward at first. Then liberating. Truth flows again.", emoji: "ğŸ˜Š", ap: 2, cost: 5, eff: { hr: 4, sci: 2 }, mood: 2 },
        { text: "Ask her to filter less", reaction: "Some improvement. Old habits persist. Partial view remains.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 1 },
        { text: "She's protecting your time and focus", reaction: "Comfortable bubble. Blind spots grow. Problems surprise you.", emoji: "ğŸ˜", ap: 1, cost: 0, eff: { dev: 2, mkt: 1 }, mood: -1 }
      ]
    }
  ]
};

// ===== RIVALS & MARKET =====

const RIVALS = {
  aether: [
    { 
      id: "genomixai",
      name: "GenomixAI", 
      style: "methodical", 
      logo: "ğŸ§¬", 
      desc: "Academic spinout, strong science", 
      scores: { sci: 15, dev: 10, mkt: 12 }, 
      status: "active", 
      funded: "Seed",
      location: "Cambridge",
      founded: "2023",
      employees: 12,
      ceo: {
        name: "Dr. Eleanor Chen",
        photo: "ğŸ‘©â€ğŸ”¬",
        background: "Former Sanger Institute researcher with 50+ publications in genomics",
        personality: "Meticulous and data-driven. Won't ship anything without peer review. Sometimes slow but rarely wrong.",
        quote: "Good science takes time. We'd rather be right than first."
      },
      team: [
        { role: "CTO", name: "Marcus Webb", desc: "Ex-DeepMind, ML infrastructure specialist" },
        { role: "CSO", name: "Prof. Yuki Tanaka", desc: "Still holds professorship at Cambridge, part-time" },
        { role: "Head of Product", name: "Sarah Mitchell", desc: "Former NHS Digital, understands healthcare IT" }
      ],
      funder: { name: "Cambridge Enterprise + Wellcome Trust", type: "Grants & Angels", raised: "Â£800k" },
      milestones: [
        { name: "Published in Nature Methods", status: "complete", quarter: 2 },
        { name: "NHS pilot partnership", status: "in-progress", quarter: null },
        { name: "Series A raise", status: "planned", quarter: null }
      ],
      strengths: ["World-class research pedigree", "Strong academic network", "IP portfolio"],
      weaknesses: ["Slow to commercialize", "Limited sales experience", "Academic culture clash"]
    },
    { 
      id: "deepcure",
      name: "DeepCure", 
      style: "aggressive", 
      logo: "ğŸ’Š", 
      desc: "VC-backed, moving fast", 
      scores: { sci: 12, dev: 15, mkt: 18 }, 
      status: "active", 
      funded: "Series A",
      location: "London (Kings Cross)",
      founded: "2022",
      employees: 35,
      ceo: {
        name: "James Thornton",
        photo: "ğŸ‘¨â€ğŸ’¼",
        background: "Second-time founder. Sold previous health-tech startup to Roche for Â£40M.",
        personality: "Relentlessly commercial. Will sacrifice scientific rigor for speed-to-market. Great at fundraising.",
        quote: "Perfect is the enemy of shipped. Our competitors are still writing papers while we're signing contracts."
      },
      team: [
        { role: "CTO", name: "Priya Sharma", desc: "Ex-Google Health, scaling expert" },
        { role: "VP Sales", name: "Tom Richardson", desc: "Enterprise pharma sales veteran, 20 years at GSK" },
        { role: "Head of ML", name: "Dr. Alex Petrov", desc: "Stanford PhD, published but commercially-minded" }
      ],
      funder: { name: "Index Ventures + Atomico", type: "Tier-1 VC", raised: "Â£12M Series A" },
      milestones: [
        { name: "First paying customer", status: "complete", quarter: 3 },
        { name: "10 enterprise contracts", status: "in-progress", quarter: null },
        { name: "US expansion", status: "planned", quarter: null }
      ],
      strengths: ["Strong commercial execution", "Well-funded", "Experienced sales team"],
      weaknesses: ["Technical debt accumulating", "High burn rate", "Reputation for overpromising"]
    },
    { 
      id: "oxbio",
      name: "OxBio", 
      style: "cautious", 
      logo: "ğŸ”¬", 
      desc: "Oxford spinout, deep research", 
      scores: { sci: 20, dev: 8, mkt: 5 }, 
      status: "active", 
      funded: "Grant-funded",
      location: "Oxford",
      founded: "2021",
      employees: 8,
      ceo: {
        name: "Prof. Richard Blackwood",
        photo: "ğŸ‘¨â€ğŸ«",
        background: "Oxford professor, still runs his lab. Reluctant entrepreneur pushed by tech transfer office.",
        personality: "Brilliant scientist, uncomfortable CEO. Prefers the lab to the boardroom. Delegates commercial decisions.",
        quote: "The technology will speak for itself. We don't need marketing gimmicks."
      },
      team: [
        { role: "COO", name: "Jennifer Hayes", desc: "Runs day-to-day ops, former McKinsey" },
        { role: "Head of Research", name: "Dr. Ahmed Hassan", desc: "Blackwood's star postdoc" },
        { role: "BD Lead", name: "Oliver Grant", desc: "Part-time, also advises 3 other spinouts" }
      ],
      funder: { name: "UKRI + Oxford Science Enterprises", type: "Grants", raised: "Â£1.2M in grants" },
      milestones: [
        { name: "Patent portfolio filed", status: "complete", quarter: 1 },
        { name: "Proof-of-concept study", status: "in-progress", quarter: null },
        { name: "First commercial pilot", status: "planned", quarter: null }
      ],
      strengths: ["Deepest science in the space", "Strong IP", "Low burn rate"],
      weaknesses: ["No commercial traction", "Part-time leadership", "University bureaucracy"]
    }
  ],
  vanguard: [
    { 
      id: "automate",
      name: "AutoMate", 
      style: "methodical", 
      logo: "ğŸ¤–", 
      desc: "Enterprise focus, steady growth", 
      scores: { sci: 12, dev: 18, mkt: 10 }, 
      status: "active", 
      funded: "Series A",
      location: "Manchester",
      founded: "2021",
      employees: 45,
      ceo: {
        name: "Rachel Foster",
        photo: "ğŸ‘©â€ğŸ’¼",
        background: "Former Amazon Robotics director, 15 years in logistics automation",
        personality: "Process-oriented and systematic. Builds for scale from day one. Sometimes over-engineers.",
        quote: "We're not building a demo, we're building infrastructure. It needs to work at 3am on a bank holiday."
      },
      team: [
        { role: "CTO", name: "David Kim", desc: "Ex-Boston Dynamics, hardware/software integration" },
        { role: "VP Engineering", name: "Lisa Chen", desc: "Amazon alumni, scaled systems to millions of users" },
        { role: "Head of Sales", name: "Mark Thompson", desc: "Enterprise logistics sales, former Ocado" }
      ],
      funder: { name: "Balderton Capital", type: "European VC", raised: "Â£8M Series A" },
      milestones: [
        { name: "Production deployment at major retailer", status: "complete", quarter: 4 },
        { name: "Break-even unit economics", status: "in-progress", quarter: null },
        { name: "European expansion", status: "planned", quarter: null }
      ],
      strengths: ["Production-ready technology", "Enterprise relationships", "Operational excellence"],
      weaknesses: ["Slow to innovate", "High infrastructure costs", "Regional focus limits scale"]
    },
    { 
      id: "swiftbot",
      name: "SwiftBot", 
      style: "aggressive", 
      logo: "âš¡", 
      desc: "Accelerator-backed, blitzscaling", 
      scores: { sci: 8, dev: 14, mkt: 20 }, 
      status: "active", 
      funded: "Series B",
      location: "London (Shoreditch)",
      founded: "2022",
      employees: 80,
      ceo: {
        name: "Ben Clarke",
        photo: "ğŸ§‘â€ğŸ’»",
        background: "Dropped out of Imperial to start company. Y Combinator alum. Third startup, first two failed.",
        personality: "Move fast, break things incarnate. Great at hype. Questions around substance. Lives on Twitter.",
        quote: "We're not competing with other startups. We're competing with legacy thinking. And we're winning."
      },
      team: [
        { role: "CTO", name: "Zara Patel", desc: "Self-taught, brilliant but chaotic" },
        { role: "VP Growth", name: "Jake Morrison", desc: "Growth hacker, ex-Deliveroo" },
        { role: "Head of Partnerships", name: "Sophie Williams", desc: "Well-connected, ex-Seedcamp" }
      ],
      funder: { name: "Accel + Y Combinator", type: "Silicon Valley VC", raised: "Â£25M Series B" },
      milestones: [
        { name: "1000 robot deployments", status: "complete", quarter: 3 },
        { name: "Profitability", status: "in-progress", quarter: null },
        { name: "US launch", status: "planned", quarter: null }
      ],
      strengths: ["Massive brand awareness", "Strong funding", "Fast iteration"],
      weaknesses: ["Unit economics unclear", "High churn rate", "Technical debt mounting"]
    },
    { 
      id: "logisai",
      name: "LogisAI", 
      style: "cautious", 
      logo: "ğŸ“¦", 
      desc: "Bootstrapped, profitable", 
      scores: { sci: 10, dev: 12, mkt: 15 }, 
      status: "active", 
      funded: "Bootstrapped",
      location: "Bristol",
      founded: "2020",
      employees: 18,
      ceo: {
        name: "Emma Wilson",
        photo: "ğŸ‘©â€ğŸ”§",
        background: "Former warehouse operations manager who learned to code. Built first version herself.",
        personality: "Pragmatic and customer-focused. Won't spend a pound she doesn't need to. Slow but sustainable.",
        quote: "We've been profitable since month 18. Fancy VCs kept calling. We kept saying no."
      },
      team: [
        { role: "CTO", name: "Chris Brown", desc: "Emma's co-founder, ex-logistics software" },
        { role: "Head of Customer Success", name: "Amy Taylor", desc: "Knows every customer by name" },
        { role: "Lead Engineer", name: "Dan Roberts", desc: "Full-stack generalist, employee #1" }
      ],
      funder: { name: "Self-funded", type: "Bootstrapped", raised: "Â£0 external" },
      milestones: [
        { name: "Profitability achieved", status: "complete", quarter: 6 },
        { name: "50 SME customers", status: "complete", quarter: 8 },
        { name: "Enterprise tier launch", status: "in-progress", quarter: null }
      ],
      strengths: ["Profitable and sustainable", "Deep customer relationships", "No investor pressure"],
      weaknesses: ["Limited R&D budget", "Can't match VC-funded growth", "Small team stretched thin"]
    }
  ],
  quant: [
    { 
      id: "alphaedge",
      name: "AlphaEdge", 
      style: "aggressive", 
      logo: "ğŸ“ˆ", 
      desc: "Ex-hedge fund founders", 
      scores: { sci: 18, dev: 15, mkt: 12 }, 
      status: "active", 
      funded: "Series A",
      location: "London (Mayfair)",
      founded: "2022",
      employees: 25,
      ceo: {
        name: "Michael Hartley",
        photo: "ğŸ§‘â€ğŸ’¼",
        background: "Former Two Sigma quant. Left to build what he wished existed. Personal net worth funds runway.",
        personality: "Arrogant but usually right. Dismissive of competitors. Attracts talent through reputation and comp.",
        quote: "We hire from the top 0.1%. Everyone else is noise."
      },
      team: [
        { role: "CTO", name: "Dr. Anna Kowalski", desc: "PhD Physics, ex-Jane Street" },
        { role: "Head of Research", name: "Dr. James Liu", desc: "Published extensively on market microstructure" },
        { role: "Head of Product", name: "Sarah Chen", desc: "Former Bloomberg terminal PM" }
      ],
      funder: { name: "Founders + Point72 Ventures", type: "Strategic + Angels", raised: "Â£6M" },
      milestones: [
        { name: "Alpha generation proven", status: "complete", quarter: 2 },
        { name: "First fund partnership", status: "complete", quarter: 4 },
        { name: "Â£1B AUM target", status: "in-progress", quarter: null }
      ],
      strengths: ["Elite talent", "Deep pockets", "Industry credibility"],
      weaknesses: ["Arrogance creates enemies", "High burn rate", "Regulatory scrutiny"]
    },
    { 
      id: "riskwise",
      name: "RiskWise", 
      style: "cautious", 
      logo: "ğŸ›¡", 
      desc: "Compliance-first approach", 
      scores: { sci: 14, dev: 12, mkt: 10 }, 
      status: "active", 
      funded: "Seed",
      location: "Edinburgh",
      founded: "2023",
      employees: 14,
      ceo: {
        name: "Fiona MacLeod",
        photo: "ğŸ‘©â€âš–ï¸",
        background: "Former FCA regulator turned entrepreneur. Knows every compliance loophole.",
        personality: "Risk-averse by nature. Builds defensible moats. Slow but bulletproof.",
        quote: "Move fast and break things? In financial services, that's called fraud."
      },
      team: [
        { role: "CTO", name: "Graham Stewart", desc: "Ex-Standard Life, enterprise architecture" },
        { role: "Head of Compliance", name: "Katherine Ross", desc: "Former FCA enforcement" },
        { role: "Lead Data Scientist", name: "Dr. Raj Patel", desc: "Risk modeling specialist" }
      ],
      funder: { name: "Par Equity + Scottish Enterprise", type: "Regional VC + Grants", raised: "Â£2M" },
      milestones: [
        { name: "FCA regulatory approval", status: "complete", quarter: 3 },
        { name: "First bank partnership", status: "in-progress", quarter: null },
        { name: "Series A", status: "planned", quarter: null }
      ],
      strengths: ["Regulatory expertise", "Trust from institutions", "Defensible positioning"],
      weaknesses: ["Slow product iteration", "Limited tech talent pool", "Conservative growth"]
    },
    { 
      id: "quantlabs",
      name: "QuantLabs", 
      style: "methodical", 
      logo: "ğŸ§®", 
      desc: "PhD-heavy research team", 
      scores: { sci: 20, dev: 10, mkt: 8 }, 
      status: "active", 
      funded: "Grant-funded",
      location: "London (Imperial College)",
      founded: "2021",
      employees: 10,
      ceo: {
        name: "Prof. David Okonkwo",
        photo: "ğŸ‘¨â€ğŸ«",
        background: "Imperial professor, Fields Medal shortlist. More comfortable with equations than customers.",
        personality: "Brilliant theorist, reluctant businessman. Lets postdocs handle commercial discussions.",
        quote: "We're solving problems that won't be relevant for five years. But when they are, we'll be ready."
      },
      team: [
        { role: "Research Director", name: "Dr. Maria Santos", desc: "Leads the PhD students" },
        { role: "Head of Engineering", name: "Tom Walsh", desc: "Only commercial hire, keeps lights on" },
        { role: "Advisor", name: "Prof. Stephen Chen", desc: "Nobel laureate, lends credibility" }
      ],
      funder: { name: "EPSRC + Alan Turing Institute", type: "Research Grants", raised: "Â£1.5M in grants" },
      milestones: [
        { name: "Novel algorithm published", status: "complete", quarter: 2 },
        { name: "Industry collaboration", status: "in-progress", quarter: null },
        { name: "Spinout formation", status: "planned", quarter: null }
      ],
      strengths: ["Cutting-edge research", "Academic credibility", "Low cost base"],
      weaknesses: ["No commercial focus", "Talent retention issues", "University IP complications"]
    }
  ],
  dream: [
    { 
      id: "pixelgen",
      name: "PixelGen", 
      style: "aggressive", 
      logo: "ğŸ¨", 
      desc: "Viral growth, influencer buzz", 
      scores: { sci: 10, dev: 15, mkt: 25 }, 
      status: "active", 
      funded: "Series A",
      location: "London (Soho)",
      founded: "2023",
      employees: 40,
      ceo: {
        name: "Maya Okonkwo",
        photo: "ğŸ‘©â€ğŸ¤",
        background: "Former creative director at a major ad agency. Built massive TikTok following before starting company.",
        personality: "Pure marketing genius. Product is secondary to brand. Lives for viral moments.",
        quote: "Art is subjective. Engagement metrics aren't. We're the most talked-about AI art tool. Full stop."
      },
      team: [
        { role: "CTO", name: "Alex Rivera", desc: "Self-taught, obsessed with user experience" },
        { role: "Head of Community", name: "Zoe Chen", desc: "Manages 2M+ Discord members" },
        { role: "VP Marketing", name: "Jordan Blake", desc: "Ex-TikTok, viral content specialist" }
      ],
      funder: { name: "a]z + Creator Fund", type: "Consumer VC", raised: "Â£15M Series A" },
      milestones: [
        { name: "1M monthly active users", status: "complete", quarter: 2 },
        { name: "Influencer partnerships", status: "complete", quarter: 3 },
        { name: "Enterprise creative tools", status: "in-progress", quarter: null }
      ],
      strengths: ["Massive user base", "Strong brand", "Community-led growth"],
      weaknesses: ["Thin margins", "Fickle user base", "Technology lagging competitors"]
    },
    { 
      id: "artisan",
      name: "Artisan", 
      style: "methodical", 
      logo: "ğŸ–¼", 
      desc: "Premium B2B positioning", 
      scores: { sci: 12, dev: 18, mkt: 15 }, 
      status: "active", 
      funded: "Seed",
      location: "London (Clerkenwell)",
      founded: "2022",
      employees: 22,
      ceo: {
        name: "Oliver Chambers",
        photo: "ğŸ§‘â€ğŸ¨",
        background: "Former Pixar technical director. Cares deeply about craft and quality.",
        personality: "Perfectionist who won't ship until it's beautiful. High standards attract premium clients.",
        quote: "We're not competing with free AI art generators. We're competing with creative agencies charging Â£50k a project."
      },
      team: [
        { role: "CTO", name: "Nina Petrova", desc: "Ex-Stability AI, deep generative model expertise" },
        { role: "Head of Design", name: "Marcus Lee", desc: "Award-winning creative director" },
        { role: "VP Sales", name: "Charlotte Brown", desc: "Enterprise creative software sales" }
      ],
      funder: { name: "Seedcamp + Angels", type: "Seed VC", raised: "Â£3M" },
      milestones: [
        { name: "Fortune 500 pilot", status: "complete", quarter: 3 },
        { name: "Â£1M ARR", status: "in-progress", quarter: null },
        { name: "Series A", status: "planned", quarter: null }
      ],
      strengths: ["Premium positioning", "Enterprise relationships", "Quality differentiation"],
      weaknesses: ["Slow growth", "High CAC", "Limited market size at premium tier"]
    },
    { 
      id: "neuralcanvas",
      name: "NeuralCanvas", 
      style: "cautious", 
      logo: "ğŸ­", 
      desc: "Artist-friendly, ethical focus", 
      scores: { sci: 18, dev: 14, mkt: 12 }, 
      status: "active", 
      funded: "Bootstrapped",
      location: "Brighton",
      founded: "2022",
      employees: 12,
      ceo: {
        name: "Sam Torres",
        photo: "ğŸ§‘â€ğŸ¨",
        background: "Digital artist who got fed up with AI art controversy. Building the ethical alternative.",
        personality: "Mission-driven to a fault. Prioritizes artist welfare over growth. Beloved by creative community.",
        quote: "Every image in our training set is licensed. Every artist gets paid. This is how AI art should work."
      },
      team: [
        { role: "CTO", name: "Jamie Wilson", desc: "Open source contributor, ethical AI advocate" },
        { role: "Artist Relations", name: "Luna Martinez", desc: "Professional illustrator, bridges both worlds" },
        { role: "Head of Engineering", name: "Robin Taylor", desc: "Built the licensing infrastructure" }
      ],
      funder: { name: "Self-funded + Grants", type: "Bootstrapped", raised: "Â£200k grants" },
      milestones: [
        { name: "10,000 licensed artists", status: "complete", quarter: 4 },
        { name: "Artist revenue sharing live", status: "complete", quarter: 5 },
        { name: "Break-even", status: "in-progress", quarter: null }
      ],
      strengths: ["Ethical positioning", "Artist community love", "Defensible moat"],
      weaknesses: ["Higher cost structure", "Limited funding", "Slower feature development"]
    }
  ],
  cyber: [
    { 
      id: "sentinelai",
      name: "SentinelAI", 
      style: "aggressive", 
      logo: "ğŸ›¡", 
      desc: "Ex-GCHQ founders, government contracts", 
      scores: { sci: 16, dev: 14, mkt: 18 }, 
      status: "active", 
      funded: "Series A",
      location: "Cheltenham",
      founded: "2022",
      employees: 35,
      ceo: {
        name: "Col. (Ret.) James Wright",
        photo: "ğŸ–ï¸",
        background: "25 years GCHQ, led national cyber defense programs. Security clearances that open doors.",
        personality: "Military precision meets startup speed. Network is everything. Commands respect in the room.",
        quote: "We've protected the nation. Now we're protecting the nation's businesses. Same mission, different uniform."
      },
      team: [
        { role: "CTO", name: "Dr. Sarah Blake", desc: "Ex-NCSC, built national threat detection systems" },
        { role: "VP Sales", name: "Michael Foster", desc: "Defence contractor relationships" },
        { role: "Head of Research", name: "Dr. Alan Chen", desc: "Published cryptographer" }
      ],
      funder: { name: "Paladin Capital + GCHQ Alumni Angels", type: "Defence-focused VC", raised: "Â£10M" },
      milestones: [
        { name: "MOD contract secured", status: "complete", quarter: 2 },
        { name: "NCSC certification", status: "complete", quarter: 4 },
        { name: "NATO partnership", status: "in-progress", quarter: null }
      ],
      strengths: ["Government relationships", "Security credibility", "Cleared personnel"],
      weaknesses: ["Commercial sector inexperience", "Slow procurement cycles", "Overreliance on govt contracts"]
    },
    { 
      id: "threatwatch",
      name: "ThreatWatch", 
      style: "methodical", 
      logo: "ğŸ‘", 
      desc: "Enterprise SOC focus, steady growth", 
      scores: { sci: 12, dev: 18, mkt: 14 }, 
      status: "active", 
      funded: "Series B",
      location: "Reading",
      founded: "2020",
      employees: 85,
      ceo: {
        name: "Victoria Singh",
        photo: "ğŸ‘©â€ğŸ’¼",
        background: "Former Symantec VP. Knows enterprise security sales inside out.",
        personality: "Methodical operator who builds repeatable processes. Not flashy but consistently delivers.",
        quote: "Cybersecurity isn't about headlines. It's about stopping the thousand attacks no one ever hears about."
      },
      team: [
        { role: "CTO", name: "Robert Chen", desc: "Built security products used by half of Fortune 500" },
        { role: "VP Engineering", name: "Dr. Emma Watson", desc: "Scaled teams from 10 to 200" },
        { role: "Chief Revenue Officer", name: "Paul Anderson", desc: "Drove Â£50M+ ARR at previous company" }
      ],
      funder: { name: "Insight Partners", type: "Growth Equity", raised: "Â£30M Series B" },
      milestones: [
        { name: "Â£10M ARR", status: "complete", quarter: 6 },
        { name: "SOC 2 Type II", status: "complete", quarter: 4 },
        { name: "US expansion", status: "in-progress", quarter: null }
      ],
      strengths: ["Proven revenue model", "Enterprise credibility", "Strong leadership team"],
      weaknesses: ["Less innovative", "Higher cost structure", "Legacy tech debt"]
    },
    { 
      id: "cybermind",
      name: "CyberMind", 
      style: "cautious", 
      logo: "ğŸ”", 
      desc: "Academic spinout, research-led", 
      scores: { sci: 20, dev: 10, mkt: 8 }, 
      status: "active", 
      funded: "Grant-funded",
      location: "Bristol",
      founded: "2021",
      employees: 11,
      ceo: {
        name: "Prof. Katherine Moore",
        photo: "ğŸ‘©â€ğŸ«",
        background: "Bristol professor, world expert in adversarial machine learning. Consults for intelligence agencies.",
        personality: "Academic first, entrepreneur second. Publishes everything, which competitors read closely.",
        quote: "Our papers get cited by every major security lab. That's worth more than any sales deck."
      },
      team: [
        { role: "Research Lead", name: "Dr. David Osei", desc: "Rising star in AI security research" },
        { role: "Engineering Lead", name: "Jack Murphy", desc: "Trying to productize the research" },
        { role: "Advisor", name: "Prof. Marcus Webb", desc: "Imperial colleague, provides credibility" }
      ],
      funder: { name: "Innovate UK + EPSRC", type: "Research Grants", raised: "Â£900k" },
      milestones: [
        { name: "Three papers at top venues", status: "complete", quarter: 3 },
        { name: "Industry proof-of-concept", status: "in-progress", quarter: null },
        { name: "First commercial contract", status: "planned", quarter: null }
      ],
      strengths: ["Cutting-edge research", "Academic reputation", "Low burn rate"],
      weaknesses: ["No commercial traction", "IP owned by university", "Talent leaves for industry"]
    }
  ],
  terra: [
    { 
      id: "climateos",
      name: "ClimateOS", 
      style: "aggressive", 
      logo: "ğŸŒ", 
      desc: "VC darling, massive funding", 
      scores: { sci: 14, dev: 16, mkt: 20 }, 
      status: "active", 
      funded: "Series B",
      location: "London (Kings Cross)",
      founded: "2021",
      employees: 120,
      ceo: {
        name: "Alexandra Green",
        photo: "ğŸ‘©â€ğŸ’¼",
        background: "Former McKinsey partner, pivoted to climate. Great at fundraising, limited technical depth.",
        personality: "Polished and connected. Knows every LP in the climate space. Mission-driven but also loves the spotlight.",
        quote: "We're building the operating system for the net-zero transition. Everything else is a feature."
      },
      team: [
        { role: "CTO", name: "Dr. Marcus Johnson", desc: "Former Google sustainability lead" },
        { role: "Chief Science Officer", name: "Prof. Elena Rodriguez", desc: "IPCC author, brings credibility" },
        { role: "VP Sales", name: "Tom Harrison", desc: "Enterprise sustainability software veteran" }
      ],
      funder: { name: "Breakthrough Energy + General Catalyst", type: "Climate VC", raised: "Â£45M Series B" },
      milestones: [
        { name: "FTSE 100 customers", status: "complete", quarter: 3 },
        { name: "Platform integration with major ERPs", status: "complete", quarter: 5 },
        { name: "Profitability path", status: "in-progress", quarter: null }
      ],
      strengths: ["Massive funding", "Enterprise relationships", "Brand recognition"],
      weaknesses: ["Burning cash fast", "Product sprawl", "Execution challenges at scale"]
    },
    { 
      id: "greenmind",
      name: "GreenMind", 
      style: "methodical", 
      logo: "ğŸŒ±", 
      desc: "B Corp certified, mission-driven", 
      scores: { sci: 16, dev: 14, mkt: 12 }, 
      status: "active", 
      funded: "Seed",
      location: "Bristol",
      founded: "2022",
      employees: 20,
      ceo: {
        name: "Hannah Williams",
        photo: "ğŸŒ¿",
        background: "Environmental scientist who saw the gap between research and action. First-time founder.",
        personality: "Authentic mission-driven leader. Sometimes prioritizes impact over revenue. Team loves her.",
        quote: "We measure success in tonnes of CO2 avoided, not just ARR. Both matter, but one matters more."
      },
      team: [
        { role: "CTO", name: "Chris Taylor", desc: "Built carbon calculators at previous startup" },
        { role: "Head of Science", name: "Dr. Priya Sharma", desc: "Carbon accounting methodology expert" },
        { role: "Head of Partnerships", name: "James Morgan", desc: "B Corp network connections" }
      ],
      funder: { name: "Bethnal Green Ventures + Impact Angels", type: "Impact Investors", raised: "Â£2.5M" },
      milestones: [
        { name: "B Corp certification", status: "complete", quarter: 2 },
        { name: "100 SME customers", status: "complete", quarter: 5 },
        { name: "Series A", status: "in-progress", quarter: null }
      ],
      strengths: ["Authentic mission", "Strong SME traction", "B Corp network"],
      weaknesses: ["Limited enterprise experience", "Smaller funding", "Balancing mission and growth"]
    },
    { 
      id: "ecopredict",
      name: "EcoPredict", 
      style: "cautious", 
      logo: "ğŸ“Š", 
      desc: "Met Office spinout, deep science", 
      scores: { sci: 22, dev: 10, mkt: 6 }, 
      status: "active", 
      funded: "Grant-funded",
      location: "Exeter",
      founded: "2020",
      employees: 9,
      ceo: {
        name: "Dr. Robert Clarke",
        photo: "ğŸŒ¦ï¸",
        background: "20 years at Met Office, led climate modeling division. Knows the science better than anyone.",
        personality: "Scientist first. Uncomfortable with sales. Lets the research speak for itself.",
        quote: "Our models have been validated against 50 years of data. Can anyone else say that?"
      },
      team: [
        { role: "Chief Scientist", name: "Dr. Sarah Woods", desc: "Climate modeling pioneer" },
        { role: "Engineering Lead", name: "Tom Brown", desc: "Making models accessible" },
        { role: "BD Consultant", name: "Emma Green", desc: "Part-time, trying to find customers" }
      ],
      funder: { name: "Met Office + NERC Grants", type: "Government/Research", raised: "Â£800k" },
      milestones: [
        { name: "Validation study published", status: "complete", quarter: 2 },
        { name: "API launch", status: "in-progress", quarter: null },
        { name: "First paying customer", status: "planned", quarter: null }
      ],
      strengths: ["Most accurate models", "Scientific credibility", "Met Office relationship"],
      weaknesses: ["No commercial traction", "Slow product development", "Limited business experience"]
    }
  ],
  legal: [
    { 
      id: "contractiq",
      name: "ContractIQ", 
      style: "aggressive", 
      logo: "âš–", 
      desc: "US-backed, blitzing UK market", 
      scores: { sci: 10, dev: 18, mkt: 22 }, 
      status: "active", 
      funded: "Series A",
      location: "London (City)",
      founded: "2022",
      employees: 55,
      ceo: {
        name: "Jennifer Walsh",
        photo: "ğŸ‘©â€âš–ï¸",
        background: "Former Latham & Watkins associate, saw the inefficiency firsthand. Stanford MBA. Well-connected.",
        personality: "Aggressive sales culture. Land-and-expand playbook. Cares more about growth than product.",
        quote: "Every law firm in the UK will use our product within three years. That's not a goal, it's a fact."
      },
      team: [
        { role: "CTO", name: "Kevin Park", desc: "Ex-Palantir, enterprise product expertise" },
        { role: "VP Sales", name: "Richard Thompson", desc: "Sold to half of Magic Circle firms" },
        { role: "Head of ML", name: "Dr. Lisa Chen", desc: "NLP specialist, ex-Google" }
      ],
      funder: { name: "a]z US + Bessemer", type: "US VC", raised: "Â£18M Series A" },
      milestones: [
        { name: "Magic Circle pilot", status: "complete", quarter: 2 },
        { name: "50 law firm customers", status: "in-progress", quarter: null },
        { name: "US launch", status: "planned", quarter: null }
      ],
      strengths: ["Aggressive go-to-market", "Strong funding", "Enterprise sales machine"],
      weaknesses: ["Product quality concerns", "High pressure culture", "Burning through cash"]
    },
    { 
      id: "lexisai",
      name: "LexisAI", 
      style: "methodical", 
      logo: "ğŸ“œ", 
      desc: "Magic Circle partnerships", 
      scores: { sci: 14, dev: 16, mkt: 16 }, 
      status: "active", 
      funded: "Series A",
      location: "London (Chancery Lane)",
      founded: "2021",
      employees: 40,
      ceo: {
        name: "Christopher Hughes",
        photo: "ğŸ‘¨â€âš–ï¸",
        background: "Former Clifford Chance partner, 20 years in commercial law. Credibility opens doors.",
        personality: "Understands law firms inside out. Patient relationship builder. Sometimes too conservative.",
        quote: "Law firms change slowly. We're here for the long game, not the quick win."
      },
      team: [
        { role: "CTO", name: "Amanda Foster", desc: "Legal tech veteran, built three products" },
        { role: "Head of Product", name: "Sarah Blackwood", desc: "Former legal ops at Freshfields" },
        { role: "Chief Legal Officer", name: "Mark Stevens", desc: "Navigates regulatory complexity" }
      ],
      funder: { name: "Balderton + Legal Tech Fund", type: "Specialist VC", raised: "Â£12M Series A" },
      milestones: [
        { name: "Three Magic Circle deployments", status: "complete", quarter: 4 },
        { name: "In-house legal expansion", status: "in-progress", quarter: null },
        { name: "European expansion", status: "planned", quarter: null }
      ],
      strengths: ["Deep law firm relationships", "Product-market fit", "Industry credibility"],
      weaknesses: ["Slow sales cycles", "Conservative product evolution", "Limited to UK market"]
    },
    { 
      id: "caselab",
      name: "CaseLab", 
      style: "cautious", 
      logo: "ğŸ”", 
      desc: "Academic roots, research focus", 
      scores: { sci: 20, dev: 12, mkt: 8 }, 
      status: "active", 
      funded: "Seed",
      location: "Cambridge",
      founded: "2022",
      employees: 14,
      ceo: {
        name: "Dr. Emma Richardson",
        photo: "ğŸ‘©â€ğŸ«",
        background: "Cambridge law professor, NLP research applied to legal texts. Reluctant entrepreneur.",
        personality: "Academic rigor in everything. Won't ship features without validation. Slow but thorough.",
        quote: "Our accuracy rates are published and peer-reviewed. Can anyone else in this space say that?"
      },
      team: [
        { role: "CTO", name: "James Mitchell", desc: "Productizing Emma's research" },
        { role: "Research Lead", name: "Dr. Tom Anderson", desc: "Computational law PhD" },
        { role: "BD Lead", name: "Charlotte Green", desc: "Trying to find customers who appreciate accuracy" }
      ],
      funder: { name: "Cambridge Enterprise + Seedcamp", type: "University + Seed VC", raised: "Â£2M" },
      milestones: [
        { name: "Published accuracy benchmarks", status: "complete", quarter: 2 },
        { name: "First law firm pilot", status: "in-progress", quarter: null },
        { name: "Series A", status: "planned", quarter: null }
      ],
      strengths: ["Best-in-class accuracy", "Academic credibility", "Strong research pipeline"],
      weaknesses: ["Slow go-to-market", "Limited sales experience", "Academic culture in startup"]
    }
  ],
  edu: [
    { 
      id: "learnflow",
      name: "LearnFlow", 
      style: "aggressive", 
      logo: "ğŸ“", 
      desc: "Consumer app, viral growth", 
      scores: { sci: 8, dev: 16, mkt: 24 }, 
      status: "active", 
      funded: "Series B",
      location: "London (Shoreditch)",
      founded: "2022",
      employees: 90,
      ceo: {
        name: "Daniel Kim",
        photo: "ğŸ§‘â€ğŸ’»",
        background: "Dropped out of Oxford to build this. Obsessed with gamification and viral loops.",
        personality: "Growth hacker first, educator second. Cares about DAUs more than learning outcomes.",
        quote: "10 million students use our app every day. We're bigger than most universities."
      },
      team: [
        { role: "CTO", name: "Rachel Wong", desc: "Mobile development expert, ex-Duolingo" },
        { role: "VP Growth", name: "Marcus Chen", desc: "Built viral mechanics at TikTok" },
        { role: "Head of Content", name: "Dr. Sarah Jones", desc: "Former teacher, creates curriculum" }
      ],
      funder: { name: "Lightspeed + a]z", type: "Consumer VC", raised: "Â£35M Series B" },
      milestones: [
        { name: "10M monthly users", status: "complete", quarter: 3 },
        { name: "Premium subscription launch", status: "complete", quarter: 4 },
        { name: "Profitability", status: "in-progress", quarter: null }
      ],
      strengths: ["Massive user base", "Viral growth engine", "Strong brand with students"],
      weaknesses: ["Learning efficacy questioned", "Low conversion to paid", "No school relationships"]
    },
    { 
      id: "classmind",
      name: "ClassMind", 
      style: "methodical", 
      logo: "ğŸ“š", 
      desc: "School partnerships, B2B focus", 
      scores: { sci: 14, dev: 18, mkt: 14 }, 
      status: "active", 
      funded: "Series A",
      location: "Manchester",
      founded: "2021",
      employees: 45,
      ceo: {
        name: "Sarah Mitchell",
        photo: "ğŸ‘©â€ğŸ«",
        background: "Former headteacher who learned to code. Understands schools from the inside.",
        personality: "Mission-driven educator. Slow and steady. Teachers trust her because she was one.",
        quote: "We're not disrupting education. We're supporting teachers. There's a difference."
      },
      team: [
        { role: "CTO", name: "James Palmer", desc: "EdTech veteran, built two school platforms" },
        { role: "Head of Pedagogy", name: "Dr. Emma Clark", desc: "Learning science researcher" },
        { role: "VP Sales", name: "Michael Roberts", desc: "Sold to 500+ schools at previous company" }
      ],
      funder: { name: "Reach Capital + Educate Ventures", type: "EdTech Specialist VC", raised: "Â£10M Series A" },
      milestones: [
        { name: "500 school deployments", status: "complete", quarter: 5 },
        { name: "MAT partnerships", status: "in-progress", quarter: null },
        { name: "Government framework approval", status: "planned", quarter: null }
      ],
      strengths: ["Deep school relationships", "Pedagogically sound", "Trusted by teachers"],
      weaknesses: ["Slow sales cycles", "Price-sensitive market", "Limited consumer presence"]
    },
    { 
      id: "cognilearn",
      name: "CogniLearn", 
      style: "cautious", 
      logo: "ğŸ§ ", 
      desc: "Learning science research", 
      scores: { sci: 22, dev: 10, mkt: 6 }, 
      status: "active", 
      funded: "Grant-funded",
      location: "UCL (London)",
      founded: "2020",
      employees: 8,
      ceo: {
        name: "Prof. Michael Foster",
        photo: "ğŸ‘¨â€ğŸ”¬",
        background: "UCL professor, world expert in cognitive load theory. Products are research outputs.",
        personality: "Rigorous scientist. Every feature is a hypothesis to test. Slow but evidence-based.",
        quote: "Most EdTech is built on intuition. We build on evidence. Randomized controlled trials, not A/B tests."
      },
      team: [
        { role: "Research Director", name: "Dr. Anna Thompson", desc: "Leads the PhD students" },
        { role: "Engineering Lead", name: "David Brown", desc: "Keeps the platform running" },
        { role: "Schools Liaison", name: "Emma White", desc: "Part-time, manages pilots" }
      ],
      funder: { name: "ESRC + Wellcome Trust", type: "Research Grants", raised: "Â£1.2M" },
      milestones: [
        { name: "Published RCT results", status: "complete", quarter: 3 },
        { name: "EEF partnership", status: "complete", quarter: 5 },
        { name: "Commercial spinout", status: "in-progress", quarter: null }
      ],
      strengths: ["Evidence-based approach", "Academic credibility", "Research partnerships"],
      weaknesses: ["No commercial focus", "Slow development", "Academic priorities over product"]
    }
  ]
};

// ===== REVENUE MARKETING EVENTS - Integrated into marketing domain =====
// Note: Customer engagement HELPS R&D (no dev/sci penalties)
const REVENUE_MARKETING_EVENTS = [
  // ===== B2B SAAS EVENTS =====
  {
    id: "rev_enterprise_deal",
    revenueModel: "b2bSaas",
    minMilestone: 1,
    intro: "A FTSE 250 company wants to pilot your product. They're talking Â£60k annual contract, with potential to expand across their divisions.",
    aside: "Enterprise logos attract more enterprise logos. This could be the reference customer that unlocks the market - and the feedback will sharpen your product.",
    choices: [
      { 
        text: "Full engagement - dedicated onboarding", 
        reaction: "Red carpet treatment. They're impressed.", 
        emoji: "ğŸ˜Š",
        ap: 3, 
        cost: 20, 
        eff: { mkt: 3, sci: 1 },
        revenueEffect: { addCustomer: { revenue: 15, supportCost: 6, strategic: true } },
        mood: 1 
      },
      { 
        text: "Standard onboarding with check-ins", 
        reaction: "Professional but not premium.", 
        emoji: "ğŸ™‚",
        ap: 2, 
        cost: 10, 
        eff: { mkt: 2 },
        revenueEffect: { addCustomer: { revenue: 15, supportCost: 4, satisfaction: 0.7 } },
        mood: 0 
      },
      { 
        text: "Wait until product is more mature", 
        reaction: "They'll find someone else. You focus on building.", 
        emoji: "ğŸ™‚",
        ap: 1, 
        cost: 0, 
        eff: { dev: 2 },
        mood: 0 
      }
    ]
  },
  
  {
    id: "rev_mid_market_wave",
    revenueModel: "b2bSaas",
    minMilestone: 1,
    intro: "Three mid-size companies finished evaluations this quarter. They're ready to sign - together worth Â£120k ARR. Your team is stretched but excited.",
    aside: "Growth is what you're here for. These customers will stress-test your operations and teach you what really matters in your product.",
    choices: [
      { 
        text: "Sign all three - grow now", 
        reaction: "Revenue jumps. Team rises to the challenge.", 
        emoji: "ğŸ˜Š",
        ap: 4, 
        cost: 25, 
        eff: { mkt: 4, hr: 1 },
        revenueEffect: { 
          addCustomer: [
            { revenue: 10, supportCost: 4 },
            { revenue: 10, supportCost: 4 },
            { revenue: 10, supportCost: 4 }
          ]
        },
        mood: 1 
      },
      { 
        text: "Take two, nurture third for next quarter", 
        reaction: "Sustainable growth. Third stays warm.", 
        emoji: "ğŸ™‚",
        ap: 3, 
        cost: 15, 
        eff: { mkt: 3 },
        revenueEffect: { 
          addCustomer: [
            { revenue: 10, supportCost: 4 },
            { revenue: 10, supportCost: 4 }
          ],
          addToPipeline: { value: 10, closeIn: 1 }
        },
        mood: 1 
      },
      { 
        text: "Focus on making current customers successful first", 
        reaction: "Retention over acquisition. Smart or scared?", 
        emoji: "ğŸ™‚",
        ap: 2, 
        cost: 5, 
        eff: { hr: 2 },
        revenueEffect: { modifyAllCustomers: { satisfactionChange: 0.1 } },
        mood: 0 
      }
    ]
  },
  
  {
    id: "rev_competitor_customer",
    revenueModel: "b2bSaas",
    minMilestone: 1,
    intro: "A competitor's frustrated customer reached out. They're unhappy with support and want to switch. It's a Â£80k contract - but your competitor will notice.",
    aside: "Competitive wins are the sweetest. This customer already understands the category - they'll be easier to onboard and can tell you exactly what your competitor does wrong.",
    choices: [
      { 
        text: "Aggressive pursuit - win at all costs", 
        reaction: "Fast-track migration. Competitor is furious.", 
        emoji: "ğŸ˜Š",
        ap: 3, 
        cost: 20, 
        eff: { mkt: 4 },
        revenueEffect: { addCustomer: { revenue: 20, supportCost: 5, strategic: true } },
        rivalEffect: { slow: true, amount: 2 },
        mood: 2 
      },
      { 
        text: "Welcome them professionally", 
        reaction: "No drama. Smooth transition.", 
        emoji: "ğŸ™‚",
        ap: 2, 
        cost: 10, 
        eff: { mkt: 2, sci: 1 },
        revenueEffect: { addCustomer: { revenue: 20, supportCost: 5 } },
        mood: 1 
      },
      { 
        text: "Let them come to us naturally", 
        reaction: "No games. If they're serious, they'll call.", 
        emoji: "ğŸ™‚",
        ap: 1, 
        cost: 0, 
        eff: { hr: 1 },
        mood: 0 
      }
    ]
  },
  
  {
    id: "rev_customer_expansion",
    revenueModel: "b2bSaas",
    minMilestone: 1,
    minCustomers: 1,
    intro: "Your best customer's CEO saw a demo and wants to expand to three more divisions. They're talking Â£150k total - up from Â£60k. But they want volume discounts.",
    aside: "Land and expand is the dream. Growing existing accounts is cheaper than acquiring new ones, and deep relationships create switching costs.",
    choices: [
      { 
        text: "Negotiate expansion with modest discount", 
        reaction: "Win-win. Relationship deepens.", 
        emoji: "ğŸ˜Š",
        ap: 2, 
        cost: 10, 
        eff: { mkt: 3 },
        revenueEffect: { modifyCustomer: { type: 'largest', revenueChange: 20 } },
        mood: 2 
      },
      { 
        text: "Hold price - we're worth it", 
        reaction: "They respect the confidence. Smaller expansion.", 
        emoji: "ğŸ™‚",
        ap: 2, 
        cost: 5, 
        eff: { mkt: 2 },
        revenueEffect: { modifyCustomer: { type: 'largest', revenueChange: 10 } },
        mood: 1 
      },
      { 
        text: "Suggest a strategic partnership instead", 
        reaction: "Bigger conversation. Longer timeline.", 
        emoji: "ğŸ™‚",
        ap: 3, 
        cost: 15, 
        eff: { mkt: 2, sci: 2 },
        revenueEffect: { addToPipeline: { value: 30, closeIn: 2, name: "Strategic Partnership" } },
        mood: 0 
      }
    ]
  },
  
  {
    id: "rev_churn_risk",
    revenueModel: "b2bSaas",
    minMilestone: 1,
    minCustomers: 2,
    intro: "Your second-largest customer's new CTO wants to 'evaluate alternatives'. Reading between the lines: they're shopping. Losing them would hurt.",
    aside: "Churn is always a signal. Sometimes it's about you, sometimes about them. Either way, you'll learn something from this conversation.",
    choices: [
      { 
        text: "Executive escalation - find out what's wrong", 
        reaction: "Honest conversation reveals fixable issues.", 
        emoji: "ğŸ˜Š",
        ap: 3, 
        cost: 15, 
        eff: { mkt: 1, sci: 2 },
        revenueEffect: { modifyCustomer: { type: 'second_largest', satisfaction: 0.85 } },
        mood: 1 
      },
      { 
        text: "Rush their top feature request", 
        reaction: "Engineering scrambles. Problem solved, temporarily.", 
        emoji: "ğŸ™‚",
        ap: 3, 
        cost: 20, 
        eff: { dev: 2 },
        revenueEffect: { modifyCustomer: { type: 'second_largest', satisfaction: 0.75 } },
        mood: 0 
      },
      { 
        text: "Focus on finding replacement revenue", 
        reaction: "Diversification is wise. They may still leave.", 
        emoji: "ğŸ˜",
        ap: 2, 
        cost: 10, 
        eff: { mkt: 3 },
        revenueEffect: { modifyCustomer: { type: 'second_largest', churnRisk: 0.3 } },
        mood: -1 
      }
    ]
  },
  
  {
    id: "rev_pilot_conversion",
    revenueModel: "b2bSaas",
    minMilestone: 0,
    intro: "A company that's been running a free pilot for 3 months wants to talk commercial terms. They love the product but their procurement team is asking hard questions about security and compliance.",
    aside: "Pilots that don't convert are expensive lessons. This is the moment of truth - can you answer the enterprise questions?",
    choices: [
      { 
        text: "Full compliance package - get certified", 
        reaction: "Investment in enterprise readiness. Deal closes.", 
        emoji: "ğŸ˜Š",
        ap: 3, 
        cost: 30, 
        eff: { mkt: 2, hr: 1 },
        revenueEffect: { addCustomer: { revenue: 12, supportCost: 4, strategic: true } },
        mood: 1 
      },
      { 
        text: "Work through their concerns one by one", 
        reaction: "Slower process. They appreciate the attention.", 
        emoji: "ğŸ™‚",
        ap: 2, 
        cost: 15, 
        eff: { mkt: 2 },
        revenueEffect: { addToPipeline: { value: 12, closeIn: 1 } },
        mood: 0 
      },
      { 
        text: "Suggest they're not ready for enterprise AI", 
        reaction: "Bold. Some respect it, some walk away.", 
        emoji: "ğŸ˜",
        ap: 1, 
        cost: 0, 
        eff: { sci: 1 },
        mood: 0 
      }
    ]
  },
  
  {
    id: "rev_pricing_pressure",
    revenueModel: "b2bSaas",
    minMilestone: 1,
    intro: "A promising prospect loves the product but says your competitor offered 50% off. They want you to match it or they'll walk.",
    aside: "Discounting sets precedents. Every deal at 50% off is a deal you'll renew at 50% off - or lose. But sometimes you need the reference customer more than the revenue.",
    choices: [
      { 
        text: "Match the discount - we need this win", 
        reaction: "They sign. Your margin just got crushed.", 
        emoji: "ğŸ˜",
        ap: 2, 
        cost: 5, 
        eff: { mkt: 2 },
        revenueEffect: { addCustomer: { revenue: 6, supportCost: 4 } },
        mood: 0 
      },
      { 
        text: "Offer 20% plus extra support", 
        reaction: "Negotiate to middle ground.", 
        emoji: "ğŸ™‚",
        ap: 2, 
        cost: 10, 
        eff: { mkt: 2 },
        revenueEffect: { addCustomer: { revenue: 10, supportCost: 5 } },
        mood: 0 
      },
      { 
        text: "Walk away - we don't discount", 
        reaction: "They go to competitor. Your team respects the discipline.", 
        emoji: "ğŸ™‚",
        ap: 1, 
        cost: 0, 
        eff: { hr: 2 },
        mood: 1 
      }
    ]
  },

  // ===== HEALTHCARE/PROCUREMENT EVENTS =====
  {
    id: "rev_nhs_pilot",
    revenueModel: "healthcareProcurement",
    minMilestone: 1,
    intro: "An NHS Trust wants a 6-month evaluation. If it goes well, they're talking Â£100k+ contract. The pilot itself is unpaid, but they'll provide invaluable clinical data and feedback.",
    aside: "NHS procurement is marathon, not sprint. The clinical insights you'll gain are worth more than the pilot cost - if you're building for healthcare, you need this data.",
    choices: [
      { 
        text: "Commit fully - embed with their clinical team", 
        reaction: "Deep integration. Clinicians become advocates.", 
        emoji: "ğŸ˜Š",
        ap: 4, 
        cost: 30, 
        eff: { sci: 3, mkt: 2 },
        revenueEffect: { addToPipeline: { value: 25, closeIn: 4, name: "NHS Trust Pilot" } },
        mood: 1 
      },
      { 
        text: "Structured pilot with defined scope", 
        reaction: "Clear boundaries. Less learning, less risk.", 
        emoji: "ğŸ™‚",
        ap: 3, 
        cost: 20, 
        eff: { sci: 1, mkt: 1 },
        revenueEffect: { addToPipeline: { value: 25, closeIn: 5, name: "NHS Trust Pilot" } },
        mood: 0 
      },
      { 
        text: "Propose paid pilot at reduced rate", 
        reaction: "Unusual in NHS. Shows commercial maturity.", 
        emoji: "ğŸ™‚",
        ap: 2, 
        cost: 10, 
        eff: { mkt: 1 },
        revenueEffect: { addCustomer: { revenue: 5, supportCost: 8, contractLength: 2, name: "NHS Pilot Contract" } },
        mood: 0 
      }
    ]
  },
  
  {
    id: "rev_nice_evidence",
    revenueModel: "healthcareProcurement",
    minMilestone: 1,
    intro: "NICE is developing guidance on AI in your clinical area. They've invited you to submit evidence. Comprehensive submission takes months but could open the entire NHS market.",
    aside: "Regulatory engagement is slow but strategic. NICE guidance shapes what the NHS buys for years. Your R&D team will learn from the rigorous evidence requirements.",
    choices: [
      { 
        text: "Submit comprehensive evidence package", 
        reaction: "Months of work. Credibility if accepted.", 
        emoji: "ğŸ˜Š",
        ap: 4, 
        cost: 25, 
        eff: { sci: 4, mkt: 2 },
        revenueEffect: { addToPipeline: { value: 100, closeIn: 6, name: "NICE Pathway", probability: 0.4 } },
        mood: 1 
      },
      { 
        text: "Partner with academic institution on submission", 
        reaction: "Shared credibility, shared ownership.", 
        emoji: "ğŸ™‚",
        ap: 3, 
        cost: 15, 
        eff: { sci: 3, mkt: 1 },
        revenueEffect: { addToPipeline: { value: 60, closeIn: 6, name: "NICE Pathway", probability: 0.5 } },
        mood: 0 
      },
      { 
        text: "Focus on individual trust sales for now", 
        reaction: "Bottom-up can work. Slower but less risky.", 
        emoji: "ğŸ™‚",
        ap: 2, 
        cost: 10, 
        eff: { mkt: 2 },
        mood: 0 
      }
    ]
  },
  
  {
    id: "rev_procurement_delay",
    revenueModel: "healthcareProcurement",
    minMilestone: 1,
    minCustomers: 0,
    intro: "The NHS trust procurement process is grinding on. Month 14 of a process you were told would take 6 months. They want another pilot extension - unpaid.",
    aside: "Public sector procurement is designed to be slow and careful. Many startups die waiting for healthcare contracts to close.",
    choices: [
      { 
        text: "Extend the pilot - we're so close", 
        reaction: "More waiting. More burn. Maybe progress.", 
        emoji: "ğŸ™‚",
        ap: 2, 
        cost: 15, 
        eff: { sci: 1 },
        revenueEffect: { modifyPipeline: { name: "NHS", progressBonus: 1 } },
        mood: 0 
      },
      { 
        text: "Push for a decision - we can't wait forever", 
        reaction: "They don't like pressure. Relationship strained.", 
        emoji: "ğŸ˜",
        ap: 2, 
        cost: 5, 
        eff: { mkt: -1 },
        revenueEffect: { modifyPipeline: { name: "NHS", progressBonus: 2, satisfactionPenalty: 0.2 } },
        mood: -1 
      },
      { 
        text: "Pursue private healthcare alongside", 
        reaction: "Hedging bets. Faster cycles, smaller market.", 
        emoji: "ğŸ™‚",
        ap: 3, 
        cost: 20, 
        eff: { mkt: 2 },
        revenueEffect: { addToPipeline: { value: 15, closeIn: 2, name: "Private Healthcare" } },
        mood: 0 
      }
    ]
  },

  // ===== CONSUMER EVENTS =====
  {
    id: "rev_viral_moment",
    revenueModel: "consumer",
    minMilestone: 0,
    intro: "A popular creator posted about your app and it's going viral. Downloads are 10x normal. Your servers are struggling and conversion is dropping because the onboarding is overwhelmed.",
    aside: "Viral moments are gifts and tests. The users you acquire now might become your most loyal advocates - or your worst reviews on the app store.",
    choices: [
      { 
        text: "Scale infrastructure, streamline onboarding NOW", 
        reaction: "All hands on deck. Capture the moment.", 
        emoji: "ğŸ˜Š",
        ap: 4, 
        cost: 40, 
        eff: { mkt: 5, dev: 2 },
        revenueEffect: { addCustomer: { type: 'consumer_cohort', revenue: 8, supportCost: 1, name: "Viral Wave Cohort" } },
        mood: 2 
      },
      { 
        text: "Focus on converting quality users", 
        reaction: "Let some drop off. Keep the serious ones.", 
        emoji: "ğŸ™‚",
        ap: 3, 
        cost: 20, 
        eff: { mkt: 3 },
        revenueEffect: { addCustomer: { type: 'consumer_cohort', revenue: 4, supportCost: 0.5, satisfaction: 0.8, name: "Quality Cohort" } },
        mood: 1 
      },
      { 
        text: "Ride it out - what happens happens", 
        reaction: "Some convert. Many bounce. Lessons learned.", 
        emoji: "ğŸ˜",
        ap: 1, 
        cost: 5, 
        eff: { mkt: 2, dev: 1 },
        revenueEffect: { addCustomer: { type: 'consumer_cohort', revenue: 2, supportCost: 0.5, name: "Organic Cohort" } },
        mood: 0 
      }
    ]
  },
  
  {
    id: "rev_influencer_deal",
    revenueModel: "consumer",
    minMilestone: 1,
    intro: "A mid-tier influencer (500k followers) wants to partner. They'll promote your app for Â£10k plus 5% of revenue from their referrals. Their audience looks like your target users.",
    aside: "Influencer partnerships can accelerate growth, but track the cohort carefully. If their users churn faster than organic ones, the economics don't work.",
    choices: [
      { 
        text: "Sign the deal with custom tracking", 
        reaction: "Marketing experiment. Data will tell the story.", 
        emoji: "ğŸ™‚",
        ap: 2, 
        cost: 15, 
        eff: { mkt: 3 },
        revenueEffect: { addCustomer: { type: 'consumer_cohort', revenue: 5, supportCost: 0.5, satisfaction: 0.6, name: "Influencer Cohort" } },
        mood: 0 
      },
      { 
        text: "Negotiate flat fee, no revenue share", 
        reaction: "Simpler deal. Less ongoing complexity.", 
        emoji: "ğŸ™‚",
        ap: 2, 
        cost: 20, 
        eff: { mkt: 2 },
        revenueEffect: { addCustomer: { type: 'consumer_cohort', revenue: 4, supportCost: 0.5, name: "Paid Promo Cohort" } },
        mood: 0 
      },
      { 
        text: "Focus on organic growth and product", 
        reaction: "Slower but sustainable. LTV focus.", 
        emoji: "ğŸ™‚",
        ap: 1, 
        cost: 0, 
        eff: { dev: 2 },
        mood: 1 
      }
    ]
  },
  
  {
    id: "rev_app_store_feature",
    revenueModel: "consumer",
    minMilestone: 1,
    intro: "Apple's App Store team reached out. They're considering featuring you in 'Apps We Love'. But they want you to implement their latest SDK features first - a month of dev work.",
    aside: "App Store features can 10x your organic downloads overnight. The visibility is priceless, but the timing might not be perfect.",
    choices: [
      { 
        text: "Drop everything and implement", 
        reaction: "Engineering pivots. Apple happy.", 
        emoji: "ğŸ˜Š",
        ap: 4, 
        cost: 25, 
        eff: { dev: 1, mkt: 4 },
        revenueEffect: { addCustomer: { type: 'consumer_cohort', revenue: 12, supportCost: 1, name: "App Store Feature Cohort" } },
        mood: 1 
      },
      { 
        text: "Negotiate timeline - implement over two months", 
        reaction: "They might wait. Might not.", 
        emoji: "ğŸ™‚",
        ap: 3, 
        cost: 15, 
        eff: { dev: 2, mkt: 2 },
        revenueEffect: { addToPipeline: { value: 10, closeIn: 2, name: "App Store Feature", probability: 0.6 } },
        mood: 0 
      },
      { 
        text: "Pass - stay focused on our roadmap", 
        reaction: "They'll find someone else. You ship your features.", 
        emoji: "ğŸ™‚",
        ap: 1, 
        cost: 0, 
        eff: { dev: 3 },
        mood: 0 
      }
    ]
  },
  
  {
    id: "rev_churn_crisis",
    revenueModel: "consumer",
    minMilestone: 1,
    minCustomers: 1,
    intro: "Monthly churn spiked to 35%. App store reviews are turning negative. Users complain about the latest update breaking their workflows. Subscriber count is dropping fast.",
    aside: "Consumer churn can kill you before you know what hit you. Every day of negative reviews compounds the damage.",
    choices: [
      { 
        text: "Emergency rollback and apology", 
        reaction: "Humble pie. Users appreciate the honesty.", 
        emoji: "ğŸ˜Š",
        ap: 3, 
        cost: 20, 
        eff: { dev: 2, hr: 1 },
        revenueEffect: { modifyAllCustomers: { satisfactionChange: 0.15, churnReduction: 0.1 } },
        mood: 1 
      },
      { 
        text: "Rush fix and heavy customer support", 
        reaction: "All hands on deck. Some save, some still leave.", 
        emoji: "ğŸ™‚",
        ap: 3, 
        cost: 25, 
        eff: { dev: 1, mkt: 1 },
        revenueEffect: { modifyAllCustomers: { satisfactionChange: 0.05 } },
        mood: 0 
      },
      { 
        text: "Focus on acquiring new users to offset", 
        reaction: "Filling a leaky bucket. Expensive.", 
        emoji: "ğŸ˜",
        ap: 2, 
        cost: 30, 
        eff: { mkt: 3 },
        mood: -1 
      }
    ]
  },

  // ===== RESEARCH/GRANTS EVENTS =====
  {
    id: "rev_innovate_uk",
    revenueModel: "researchGrants",
    minMilestone: 0,
    intro: "Innovate UK has a Â£500k collaborative R&D grant in your sector. Applications due in 6 weeks. You'd need an academic partner and matching funds, but no equity dilution.",
    aside: "Grant writing is its own skill, but the discipline of articulating your research clearly often crystallises your thinking. And the money doesn't dilute you.",
    choices: [
      { 
        text: "Go all-in with university partner", 
        reaction: "Weeks of intense proposal work. Strong submission.", 
        emoji: "ğŸ˜Š",
        ap: 4, 
        cost: 20, 
        eff: { sci: 2 },
        revenueEffect: { grantApplication: { amount: 125, probability: 0.35, quarters: 4, name: "Innovate UK Grant" } },
        mood: 0 
      },
      { 
        text: "Submit smaller feasibility study bid (Â£100k)", 
        reaction: "Less commitment, faster decision.", 
        emoji: "ğŸ™‚",
        ap: 2, 
        cost: 10, 
        eff: { sci: 1 },
        revenueEffect: { grantApplication: { amount: 25, probability: 0.5, quarters: 2, name: "Feasibility Grant" } },
        mood: 0 
      },
      { 
        text: "Skip this round - focus on product", 
        reaction: "Grants aren't the only path.", 
        emoji: "ğŸ™‚",
        ap: 1, 
        cost: 0, 
        eff: { dev: 2 },
        mood: 0 
      }
    ]
  },
  
  {
    id: "rev_horizon_europe",
    revenueModel: "researchGrants",
    minMilestone: 1,
    intro: "A Horizon Europe consortium wants you as their UK commercial partner. â‚¬2M project, you'd get â‚¬400k over 3 years. The paperwork is legendary, but so is the funding.",
    aside: "EU grants are bureaucratic nightmares with excellent funding. The consortium partners could become customers or acquirers.",
    choices: [
      { 
        text: "Join the consortium", 
        reaction: "Months of meetings ahead. Big opportunity.", 
        emoji: "ğŸ˜Š",
        ap: 4, 
        cost: 25, 
        eff: { sci: 3, mkt: 1 },
        revenueEffect: { grantApplication: { amount: 35, probability: 0.4, quarters: 5, name: "Horizon Europe", duration: 12 } },
        mood: 0 
      },
      { 
        text: "Negotiate reduced commitment", 
        reaction: "Smaller share, smaller burden.", 
        emoji: "ğŸ™‚",
        ap: 3, 
        cost: 15, 
        eff: { sci: 2 },
        revenueEffect: { grantApplication: { amount: 20, probability: 0.45, quarters: 5, name: "Horizon Europe (Reduced)" } },
        mood: 0 
      },
      { 
        text: "Decline - too much overhead", 
        reaction: "Focus on UK funding sources.", 
        emoji: "ğŸ™‚",
        ap: 1, 
        cost: 0, 
        eff: { dev: 1 },
        mood: 0 
      }
    ]
  },
  
  {
    id: "rev_licensing_inquiry",
    revenueModel: "researchGrants",
    minMilestone: 1,
    intro: "A US research lab wants to license your core algorithm. They're offering Â£100k/year for non-exclusive rights in academic use. It's validation, but is licensing the right path?",
    aside: "Licensing generates revenue without customer support burden. Academic licenses can lead to commercial ones. But you're also training potential competitors.",
    choices: [
      { 
        text: "Sign non-exclusive academic license", 
        reaction: "Revenue without distraction. They'll publish using your work.", 
        emoji: "ğŸ˜Š",
        ap: 2, 
        cost: 5, 
        eff: { sci: 2, mkt: 1 },
        revenueEffect: { addCustomer: { revenue: 25, supportCost: 3, contractLength: 4, name: "US Lab License" } },
        mood: 1 
      },
      { 
        text: "Negotiate research collaboration instead", 
        reaction: "Less money, more knowledge exchange.", 
        emoji: "ğŸ™‚",
        ap: 3, 
        cost: 15, 
        eff: { sci: 4 },
        revenueEffect: { addCustomer: { revenue: 10, supportCost: 5, contractLength: 4, name: "Research Collaboration" } },
        mood: 1 
      },
      { 
        text: "Decline - keep our IP close", 
        reaction: "Protect the moat. They'll find another way.", 
        emoji: "ğŸ™‚",
        ap: 1, 
        cost: 0, 
        eff: { dev: 1 },
        mood: 0 
      }
    ]
  },
  
  {
    id: "rev_grant_deliverable",
    revenueModel: "researchGrants",
    minMilestone: 1,
    minCustomers: 1,
    intro: "Your major grant's annual review is coming up. The deliverables are behind schedule because you pivoted the product. You could fudge the report or come clean.",
    aside: "Grant compliance matters. Get blacklisted and you'll never win another. But funders also understand that research directions evolve.",
    choices: [
      { 
        text: "Honest report with pivot justification", 
        reaction: "Transparency appreciated. Some deliverables renegotiated.", 
        emoji: "ğŸ˜Š",
        ap: 3, 
        cost: 10, 
        eff: { sci: 1, hr: 1 },
        revenueEffect: { modifyCustomer: { type: 'grant', satisfaction: 0.9 } },
        mood: 1 
      },
      { 
        text: "Scramble to hit original deliverables", 
        reaction: "Team stressed. Report looks good.", 
        emoji: "ğŸ™‚",
        ap: 4, 
        cost: 20, 
        eff: { sci: 2, hr: -1 },
        revenueEffect: { modifyCustomer: { type: 'grant', satisfaction: 0.75 } },
        mood: -1 
      },
      { 
        text: "Creative interpretation of deliverables", 
        reaction: "Technically compliant. Ethically grey.", 
        emoji: "ğŸ˜",
        ap: 2, 
        cost: 5, 
        eff: { mkt: 1 },
        revenueEffect: { modifyCustomer: { type: 'grant', satisfaction: 0.5, auditRisk: true } },
        mood: 0 
      }
    ]
  }
];

// ===== COMPETITIVE EVENTS - Reference rivals dynamically =====
const COMPETITIVE_EVENTS = {
  research: [
    {
      id: "rival_breakthrough",
      intro: "Bad news. {rival} just announced a breakthrough in our core research area. The press is all over them.",
      aside: "We can't let them control the narrative. But chasing headlines isn't science.",
      choices: [
        { text: "Accelerate our own announcement", reaction: "We'll need to cut some validation steps.", emoji: "ğŸ˜¬", ap: 3, cost: 30, eff: { sci: 2, mkt: 4 }, mood: 0, rivalEffect: { slow: false } },
        { text: "Publish a detailed rebuttal", reaction: "Point out the gaps in their work.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { sci: 3, mkt: 1 }, mood: 1, rivalEffect: { slow: true, amount: 2 } },
        { text: "Stay focused on our roadmap", reaction: "Let them have the spotlight. We'll have the substance.", emoji: "ğŸ˜Š", ap: 1, cost: 0, eff: { sci: 2 }, mood: 2, rivalEffect: { slow: false } }
      ]
    },
    {
      id: "poach_researcher",
      intro: "{rival}'s lead researcher just quit. Word is they're open to offers. This could be a game-changer.",
      aside: "They know {rival}'s roadmap inside out. But poaching creates bad blood in this small industry.",
      choices: [
        { text: "Make an aggressive offer", reaction: "We'll pay above market. This is worth it.", emoji: "ğŸ¯", ap: 3, cost: 50, eff: { sci: 5, hr: 2 }, mood: 1, rivalEffect: { slow: true, amount: 4 } },
        { text: "Reach out casually", reaction: "See if there's mutual interest first.", emoji: "ğŸ™‚", ap: 2, cost: 10, eff: { sci: 2, hr: 1 }, mood: 0, rivalEffect: { slow: true, amount: 1 } },
        { text: "Let them come to us", reaction: "Focus on product. Strong attracts strong.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0, rivalEffect: { slow: false } }
      ]
    }
  ],
  dev: [
    {
      id: "rival_launch",
      intro: "{rival} just launched a feature we had on our roadmap. They beat us to market.",
      aside: "First-mover advantage is real. But fast followers can learn from their mistakes.",
      choices: [
        { text: "Rush our version out", reaction: "Ship it now, iterate later.", emoji: "ğŸ˜¬", ap: 4, cost: 40, eff: { dev: 3, mkt: 2, hr: -1 }, mood: -1, rivalEffect: { slow: false } },
        { text: "Learn from their launch, improve ours", reaction: "Their reviews will be our roadmap.", emoji: "ğŸ™‚", ap: 3, cost: 25, eff: { dev: 4, mkt: 1 }, mood: 1, rivalEffect: { slow: false } },
        { text: "Pivot to a different feature", reaction: "Find blue ocean instead of competing head-on.", emoji: "ğŸ˜Š", ap: 2, cost: 15, eff: { dev: 3 }, mood: 1, rivalEffect: { slow: false } }
      ]
    },
    {
      id: "talent_war",
      intro: "Our senior developer got an offer from {rival}. They're offering 40% more equity.",
      aside: "Losing them would set us back months. But we can't match that equity without diluting everyone.",
      choices: [
        { text: "Counter with promotion and equity", reaction: "We value you. Here's proof.", emoji: "ğŸ˜Š", ap: 2, cost: 30, eff: { dev: 2, hr: 2, equity: -2 }, mood: 2, rivalEffect: { slow: true, amount: 1 } },
        { text: "Wish them well, backfill quickly", reaction: "People come and go. The mission continues.", emoji: "ğŸ˜", ap: 1, cost: 10, eff: { dev: 1, mkt: 1 }, mood: -1, rivalEffect: { slow: false } },
        { text: "Guilt trip about loyalty", reaction: "Emotional appeal works. They stay.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0, rivalEffect: { slow: false } }
      ]
    }
  ],
  marketing: [
    {
      id: "conference_clash",
      intro: "{rival} is the headline sponsor at the conference we're attending. Their booth is twice our size.",
      aside: "We can't outspend them. But we can be smarter.",
      choices: [
        { text: "Host an exclusive side event", reaction: "Intimate dinners beat crowded booths.", emoji: "ğŸ˜Š", ap: 4, cost: 40, eff: { mkt: 5, sci: 1 }, mood: 2, rivalEffect: { slow: true, amount: 2 } },
        { text: "Focus on quality demos", reaction: "Let the product speak.", emoji: "ğŸ™‚", ap: 2, cost: 15, eff: { mkt: 3, dev: 1 }, mood: 1, rivalEffect: { slow: false } },
        { text: "Skip this one, pick our battles", reaction: "Strategic patience. Save resources.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { cash: 10 }, mood: 0, rivalEffect: { slow: false } }
      ]
    },
    {
      id: "rival_press",
      intro: "A journalist wants our comment on {rival}'s funding round. They raised twice what we did.",
      aside: "Whatever we say will be quoted. No comment looks defensive. Praise looks weak.",
      choices: [
        { text: "Congratulate and differentiate", reaction: "We're focused on different things.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { mkt: 2 }, mood: 1, rivalEffect: { slow: false } },
        { text: "Subtly question their approach", reaction: "Money isn't everything. Execution matters.", emoji: "ğŸ˜", ap: 2, cost: 10, eff: { mkt: 3, sci: -1 }, mood: 0, rivalEffect: { slow: true, amount: 1 } },
        { text: "No comment", reaction: "Let the work speak for itself. Professional.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0, rivalEffect: { slow: false } }
      ]
    },
    {
      id: "client_competition",
      intro: "A key prospect is evaluating us against {rival}. They want a bake-off next week.",
      aside: "Head-to-head comparisons are risky. But winning this would be a huge reference.",
      choices: [
        { text: "All hands on deck for the demo", reaction: "Cancel everything. We're winning this.", emoji: "ğŸ¯", ap: 5, cost: 50, eff: { mkt: 6, dev: 2, cash: 80 }, mood: 2, rivalEffect: { slow: true, amount: 3 } },
        { text: "Standard demo, highlight our strengths", reaction: "We'll show what makes us different.", emoji: "ğŸ™‚", ap: 3, cost: 20, eff: { mkt: 3, cash: 40 }, mood: 1, rivalEffect: { slow: false } },
        { text: "Decline the bake-off", reaction: "Compete on our terms, not theirs.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { dev: 1 }, mood: 0, rivalEffect: { slow: false } }
      ]
    }
  ],
  hr: [
    {
      id: "rival_layoffs",
      intro: "{rival} just laid off 30% of their team. Good engineers are suddenly available.",
      aside: "Their loss could be our gain. But we need to move fast-everyone's circling.",
      choices: [
        { text: "Hiring spree-grab the best", reaction: "Spin up interviews immediately.", emoji: "ğŸ¯", ap: 4, cost: 60, eff: { hr: 5, dev: 3, sci: 2 }, mood: 2, rivalEffect: { slow: true, amount: 5 } },
        { text: "Cherry-pick a few stars", reaction: "Quality over quantity.", emoji: "ğŸ™‚", ap: 2, cost: 30, eff: { hr: 2, dev: 2 }, mood: 1, rivalEffect: { slow: true, amount: 2 } },
        { text: "Stay disciplined on headcount", reaction: "Lean team. Cash preserved.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { cash: 15 }, mood: 0, rivalEffect: { slow: false } }
      ]
    },
    {
      id: "salary_benchmark",
      intro: "Industry salary data is out. {rival} is paying 20% above market. Our team is talking.",
      aside: "We can't match Big Tech salaries. But we have equity, mission, and culture.",
      choices: [
        { text: "Raise salaries across the board", reaction: "Retention is worth it.", emoji: "ğŸ˜Š", ap: 2, cost: 0, eff: { hr: 4, burn: 15 }, mood: 2, rivalEffect: { slow: false } },
        { text: "Improve equity and perks instead", reaction: "Long-term value over short-term cash.", emoji: "ğŸ™‚", ap: 2, cost: 20, eff: { hr: 2, equity: -2 }, mood: 1, rivalEffect: { slow: false } },
        { text: "Trust our culture to retain people", reaction: "Mission-driven team stays. Stronger core.", emoji: "ğŸ™‚", ap: 1, cost: 0, eff: { hr: 1 }, mood: 0, rivalEffect: { slow: false } }
      ]
    }
  ]
};

const MARKETS = [
  { id: "hype", name: "AI Hype", desc: "Funding flows freely.", type: "positive" },
  { id: "winter", name: "AI Winter", desc: "VCs tighten purse strings.", type: "negative" },
  { id: "regulation", name: "Regulation Wave", desc: "New compliance requirements.", type: "negative" },
  { id: "talent", name: "Talent War", desc: "Big Tech hoovering talent.", type: "negative" },
  { id: "boom", name: "Boom Times", desc: "Enterprise budgets healthy.", type: "positive" },
  { id: "recession", name: "Recession", desc: "Budgets frozen.", type: "negative" },
  { id: "stable", name: "Stable", desc: "Business as usual.", type: "neutral" }
];

const NEWS = {
  hype: ["Horizon Labs valued at $150B â€¢", "Every startup now 'AI company' â€¢", "AI funding hits all-time high â€¢"],
  winter: ["Investors skeptical of AI â€¢", "'AI fatigue' hits buyers â€¢", "70% of AI projects fail â€¢"],
  stable: ["UK tech shows steady growth â€¢", "AI adoption continues â€¢", "London retains hub status â€¢"],
  default: ["What does AI mean for workers? â€¢", "Race to build AGI â€¢", "AI: threat or opportunity? â€¢"]
};

// ===== SHOCKS - Rare events that reshape the game =====
const SHOCKS = {
  // ECONOMIC SHOCKS
  economic: [
    { 
      id: "gov_ai_fund",
      headline: "Government Announces Â£2B AI Investment Fund", 
      text: "The Chancellor unveils a major initiative to support UK AI companies. Grant opportunities and tax incentives are available for qualifying startups.", 
      type: "positive",
      icon: "ğŸ›",
      effects: { val: 100 }, 
      choices: [
        { text: "Chase government contracts (bureaucracy ahead)", ap: 2, eff: { mkt: 5, cash: 150, dev: -1 } },
        { text: "Apply for research grants", ap: 2, eff: { sci: 5, cash: 80 } },
        { text: "Stay focused on commercial growth", ap: 1, eff: { dev: 3 } }
      ]
    },
    { 
      id: "recession",
      headline: "Economic Recession Hits UK Markets", 
      text: "GDP contracts sharply. Enterprise customers are freezing budgets and VCs are pulling back from new investments.", 
      type: "negative",
      icon: "ğŸ“‰",
      effects: { val: -150, cash: -50 }, 
      choices: [
        { text: "Cut costs aggressively to extend runway", ap: 1, eff: { burn: -20, cash: 20, dev: 1 } },
        { text: "Double down on sales to distressed companies", ap: 2, eff: { mkt: 4, cash: 50 } },
        { text: "Pivot to cost-saving solutions for customers", ap: 3, eff: { dev: 4, mkt: 3 } }
      ]
    },
    { 
      id: "interest_rates",
      headline: "Bank of England Raises Rates to 7%", 
      text: "Borrowing costs surge. VC funding dries up as investors seek safer returns. Runway is everything now.", 
      type: "negative",
      icon: "ğŸ¦",
      effects: { val: -100 }, 
      choices: [
        { text: "Seek bridge funding from existing investors", ap: 2, eff: { cash: 100, equity: -2 } },
        { text: "Focus on profitability over growth", ap: 2, eff: { mkt: 3, burn: -15 } },
        { text: "Ride it out and stay the course", ap: 1, eff: { dev: 1 } }
      ]
    },
    {
      id: "tech_boom",
      headline: "AI Stocks Surge After Breakthrough Demo",
      text: "A viral AI demonstration sends tech stocks soaring. Investors are throwing money at anything AI-related. Valuations are through the roof.",
      type: "positive",
      icon: "ğŸš€",
      effects: { val: 200 },
      choices: [
        { text: "Raise funding now at peak valuations", ap: 2, eff: { cash: 200, equity: -2 } },
        { text: "Acquire a struggling competitor", ap: 3, eff: { sci: 4, dev: 4, cash: -150 } },
        { text: "Stay focused, bubbles pop", ap: 1, eff: { hr: 2 } }
      ]
    }
  ],
  
  // TECHNOLOGICAL SHOCKS  
  technological: [
    { 
      id: "open_source_model",
      headline: "Helix Social Releases Powerful Open-Source AI Model", 
      text: "A new open-source model matches proprietary systems. Your technology moat may be eroding.", 
      type: "negative",
      icon: "ğŸ”“",
      effects: { sci: -3 }, 
      choices: [
        { text: "Embrace it-build on top of the open model", ap: 2, eff: { dev: 5, sci: -2 } },
        { text: "Double down on proprietary research", ap: 3, eff: { sci: 6, cash: -50 } },
        { text: "Pivot to services and implementation", ap: 2, eff: { mkt: 4, dev: 2 } }
      ]
    },
    { 
      id: "compute_breakthrough",
      headline: "New Chip Architecture Cuts AI Training Costs 80%", 
      text: "SiliconCore announces next-gen GPUs with dramatically improved efficiency. Compute costs are about to plummet.", 
      type: "positive",
      icon: "ğŸ’»",
      effects: { burn: -10 }, 
      choices: [
        { text: "Pre-order new hardware aggressively", ap: 2, eff: { sci: 4, dev: 3, cash: -80 } },
        { text: "Train larger, more ambitious models", ap: 3, eff: { sci: 6, burn: 10 } },
        { text: "Bank the savings, extend runway", ap: 1, eff: { cash: 40 } }
      ]
    },
    {
      id: "quantum_threat",
      headline: "Quantum Computing Breakthrough Threatens Encryption",
      text: "Researchers demonstrate quantum advantage on cryptographic problems. Security-focused AI companies are in the spotlight.",
      type: "mixed",
      icon: "âš›",
      effects: {},
      choices: [
        { text: "Pivot to quantum-safe solutions", ap: 3, eff: { sci: 5, mkt: 3, dev: -2 } },
        { text: "Partner with quantum security startup", ap: 2, eff: { sci: 3, cash: -60 } },
        { text: "Monitor but stay focused", ap: 1, eff: { dev: 2 } }
      ]
    },
    {
      id: "data_goldmine",
      headline: "Major Dataset Becomes Publicly Available",
      text: "A tech giant releases a massive, high-quality training dataset. Companies that move fast can gain significant advantages.",
      type: "positive", 
      icon: "ğŸ“Š",
      effects: { sci: 2 },
      choices: [
        { text: "All hands on deck-retrain everything", ap: 3, eff: { sci: 6, dev: 4, hr: -2 } },
        { text: "Carefully integrate into existing pipeline", ap: 2, eff: { sci: 3, dev: 2 } },
        { text: "Our proprietary data is our moat", ap: 1, eff: { mkt: 2 } }
      ]
    },
    {
      id: "gpt6_launch",
      headline: "Horizon Labs Releases Atlas-6: Unprecedented Capabilities",
      text: "The new model demonstrates near-human reasoning. The AI landscape is shifting overnight. VCs are asking if your approach is obsolete.",
      type: "mixed",
      icon: "ğŸ¤–",
      effects: { val: -50, mkt: -2 },
      choices: [
        { text: "Build on top of Atlas-6, pivot to applications", ap: 3, eff: { dev: 6, sci: -4, mkt: 4 } },
        { text: "Double down on our unique approach", ap: 2, eff: { sci: 5, mkt: -1 } },
        { text: "Partner with Horizon Labs for API access", ap: 2, eff: { dev: 4, cash: -40, burn: 5 } }
      ]
    },
    {
      id: "ai_safety_incident",
      headline: "Major AI Safety Incident Makes Headlines",
      text: "An AI system causes a high-profile failure. Public trust in AI plummets. Regulators are demanding answers.",
      type: "negative",
      icon: "âš ",
      effects: { mkt: -4, val: -75 },
      choices: [
        { text: "Lead on safety-publish our safeguards", ap: 3, eff: { sci: 2, mkt: 5, hr: 2 } },
        { text: "Quietly strengthen internal testing", ap: 2, eff: { dev: 3, sci: 2 } },
        { text: "Distance ourselves from the incident", ap: 1, eff: { mkt: 1 } }
      ]
    },
    {
      id: "synthetic_data",
      headline: "Synthetic Data Breakthrough Changes Training",
      text: "Researchers prove models can be trained effectively on AI-generated data. The data moat is evaporating.",
      type: "mixed",
      icon: "ğŸ§ª",
      effects: { sci: -2 },
      choices: [
        { text: "Build synthetic data pipeline immediately", ap: 3, eff: { sci: 5, dev: 3, cash: -30 } },
        { text: "Focus on real-world data partnerships", ap: 2, eff: { mkt: 3, sci: 2 } },
        { text: "Combine synthetic + real for best of both", ap: 2, eff: { sci: 4, dev: 2 } }
      ]
    },
    {
      id: "agent_paradigm",
      headline: "AI Agents Take Over: New Computing Paradigm",
      text: "Autonomous AI agents are suddenly everywhere. Companies without agent capabilities are seen as behind.",
      type: "mixed",
      icon: "ğŸ•¹",
      effects: { },
      choices: [
        { text: "Pivot hard to agent-first architecture", ap: 4, eff: { dev: 6, sci: 2, hr: -2 } },
        { text: "Add agent layer to existing product", ap: 2, eff: { dev: 3, mkt: 2 } },
        { text: "Focus on our core strengths", ap: 1, eff: { dev: 2 } }
      ]
    }
  ],
  
  // REGULATORY SHOCKS
  regulatory: [
    { 
      id: "ai_regulation",
      headline: "EU AI Act Comes Into Force", 
      text: "Sweeping new regulations require extensive compliance documentation. High-risk AI systems face strict requirements.", 
      type: "negative",
      icon: "âš–",
      effects: { dev: -2 }, 
      choices: [
        { text: "Hire compliance team and get certified", ap: 2, eff: { hr: 3, cash: -60, mkt: 2 } },
        { text: "Focus on low-risk applications only", ap: 2, eff: { dev: -3, mkt: 3 } },
        { text: "Exit EU market, focus on UK/US", ap: 1, eff: { dev: 2, mkt: 1 } }
      ]
    },
    {
      id: "data_privacy",
      headline: "ICO Launches AI Data Usage Investigation",
      text: "The Information Commissioner is scrutinizing how AI companies use training data. Several startups have received enforcement notices.",
      type: "negative",
      icon: "ğŸ”",
      effects: { hr: -2 },
      choices: [
        { text: "Proactively audit and document everything", ap: 2, eff: { dev: -2, hr: 3, cash: -30 } },
        { text: "Engage lawyers and prepare defence", ap: 1, eff: { cash: -50 } },
        { text: "Switch to fully licensed datasets", ap: 3, eff: { sci: -3, cash: -40, hr: 2 } }
      ]
    },
    {
      id: "nhs_approval",
      headline: "public health system Announces Fast-Track AI Approval Pathway",
      text: "New regulations create an accelerated route for AI medical devices. Healthcare AI companies can now reach market faster.",
      type: "positive",
      icon: "ğŸ¥",
      effects: { mkt: 3 },
      choices: [
        { text: "Prioritise public health system certification immediately", ap: 3, eff: { mkt: 6, sci: 2, cash: -40 } },
        { text: "Partner with established medical device company", ap: 2, eff: { mkt: 4, equity: -2 } },
        { text: "Continue current roadmap", ap: 1, eff: { dev: 2 } }
      ]
    }
  ],
  
  // TALENT SHOCKS
  talent: [
    { 
      id: "key_departure",
      headline: "Key Team Member Poached by Big Tech", 
      text: "Your head of engineering just accepted a Â£400k package at Titan Tech's AI division. The team is shaken.", 
      type: "negative",
      icon: "ğŸšª",
      effects: { hr: -4, dev: -2 }, 
      choices: [
        { text: "Counter-offer with equity and title bump", ap: 2, eff: { hr: 3, equity: -2, cash: -30 } },
        { text: "Wish them well, promote from within", ap: 2, eff: { hr: 2, dev: -1 } },
        { text: "Use it as a wake-up call on culture", ap: 2, eff: { hr: 4, burn: 5 } }
      ]
    },
    {
      id: "talent_flood",
      headline: "Major Tech Company Announces UK Layoffs",
      text: "A Big Tech company is cutting 2,000 UK jobs. Suddenly, world-class talent is available.",
      type: "positive",
      icon: "ğŸ‘¥",
      effects: { hr: 3 },
      choices: [
        { text: "Hire aggressively while we can", ap: 2, eff: { sci: 3, dev: 3, burn: 25, cash: -40 } },
        { text: "Cherry-pick a few senior leaders", ap: 2, eff: { sci: 2, dev: 2, burn: 10 } },
        { text: "Our team chemistry is more important", ap: 1, eff: { hr: 2 } }
      ]
    },
    {
      id: "visa_changes",
      headline: "Government Tightens Tech Visa Rules",
      text: "New immigration rules make it harder to hire international talent. The talent pool just shrunk significantly.",
      type: "negative",
      icon: "ğŸ›‚",
      effects: { hr: -3 },
      choices: [
        { text: "Open a remote hub in EU", ap: 2, eff: { burn: 15, hr: 2, dev: 2 } },
        { text: "Focus on UK university partnerships", ap: 2, eff: { sci: 3, hr: 2 } },
        { text: "Pay premium for remaining UK talent", ap: 1, eff: { burn: 10, hr: 1 } }
      ]
    }
  ],
  
  // COMPETITIVE SHOCKS
  competitive: [
    {
      id: "competitor_funding",
      headline: "Rival Raises Â£50M Series B",
      text: "Your closest competitor just announced a massive funding round. They're planning aggressive expansion and talent acquisition.",
      type: "negative",
      icon: "ğŸ’°",
      effects: { hr: -2, mkt: -2 },
      choices: [
        { text: "Announce our own funding round", ap: 2, eff: { cash: 150, equity: -2, mkt: 3 } },
        { text: "Focus on what makes us different", ap: 2, eff: { dev: 3, sci: 2 } },
        { text: "Approach them about acquisition talks", ap: 1, eff: { val: 50 } }
      ]
    },
    {
      id: "competitor_failure",
      headline: "Major Competitor Shuts Down",
      text: "A well-funded rival has run out of runway and is closing. Their customers and talent are suddenly available.",
      type: "positive",
      icon: "ğŸ“°",
      effects: { mkt: 3 },
      choices: [
        { text: "Acqui-hire their best engineers", ap: 2, eff: { dev: 4, sci: 2, burn: 20 } },
        { text: "Aggressively pursue their customers", ap: 2, eff: { mkt: 5, cash: 30 } },
        { text: "Buy their IP and assets cheap", ap: 3, eff: { sci: 5, dev: 3, cash: -80 } }
      ]
    },
    {
      id: "big_tech_entry",
      headline: "Titan Tech Announces Competing Product",
      text: "Titan Tech just unveiled a product that directly competes with yours. They're offering it for free.",
      type: "negative",
      icon: "ğŸ”´",
      effects: { val: -100, mkt: -3 },
      choices: [
        { text: "Pivot to enterprise where big tech is weak", ap: 3, eff: { mkt: 4, dev: 3, sci: -2 } },
        { text: "Go niche-own a vertical they'll ignore", ap: 2, eff: { mkt: 3, sci: 2 } },
        { text: "Compete on service and customization", ap: 2, eff: { mkt: 2, hr: 3 } }
      ]
    }
  ],
  
  // REVENUE SHOCKS - Only trigger if player has revenue/customers
  revenue: [
    {
      id: "key_customer_leaving",
      headline: "Key Customer Considering Competitor",
      text: "Your largest customer's procurement team is evaluating alternatives. The internal champion who brought you in has moved to a different role.",
      type: "negative",
      icon: "âš ï¸",
      requiresCustomers: true,
      effects: { mkt: -2 },
      revenueEffect: { modifyCustomer: { type: 'largest', satisfaction: 0.3 } },
      choices: [
        { text: "Executive escalation - founder calls their CEO", ap: 3, eff: { mkt: 3 }, revenueEff: { modifyCustomer: { type: 'largest', satisfaction: 0.8 } } },
        { text: "Offer significant discount to renew early", ap: 2, eff: { cash: -30 }, revenueEff: { modifyCustomer: { type: 'largest', satisfaction: 0.7, revenueChange: -5 } } },
        { text: "Focus on other customers - don't chase", ap: 1, eff: { dev: 2 } }
      ]
    },
    {
      id: "economic_downturn_customers",
      headline: "Economic Downturn Hits Customers",
      text: "A recession warning has customers reviewing all vendor contracts. Several have asked about cost reductions or payment delays.",
      type: "negative",
      icon: "ğŸ“‰",
      requiresCustomers: true,
      effects: { mkt: -1, val: -50 },
      revenueEffect: { modifyAllCustomers: { satisfactionChange: -0.15 } },
      choices: [
        { text: "Proactively offer flexible terms", ap: 2, eff: { mkt: 2 }, revenueEff: { modifyAllCustomers: { satisfactionChange: 0.1, churnReduction: 0.1 } } },
        { text: "Hold firm - show confidence in value", ap: 1, eff: { } },
        { text: "Pivot to recession-proof verticals", ap: 3, eff: { mkt: 3, sci: -1 } }
      ]
    },
    {
      id: "customer_expansion",
      headline: "Customer Wants Enterprise-Wide Rollout",
      text: "Your pilot customer is so impressed they want to expand to all divisions. But they want volume pricing and dedicated support.",
      type: "positive",
      icon: "ğŸš€",
      requiresCustomers: true,
      effects: { mkt: 2 },
      choices: [
        { text: "Full expansion with dedicated CSM", ap: 3, eff: { mkt: 4, burn: 15 }, revenueEff: { addCustomer: { revenue: 25, supportCost: 8, type: 'expansion', satisfaction: 0.85, strategic: true } } },
        { text: "Phased rollout with existing team", ap: 2, eff: { mkt: 2 }, revenueEff: { addCustomer: { revenue: 15, supportCost: 5, type: 'expansion', satisfaction: 0.75 } } },
        { text: "Wait until product is more mature", ap: 1, eff: { dev: 2, sci: 1 } }
      ]
    },
    {
      id: "payment_delay",
      headline: "Customer Payment Delayed",
      text: "Your largest customer's finance team says payment will be delayed by 90 days due to 'internal processes'. Your cash flow is tight.",
      type: "negative",
      icon: "ğŸ’³",
      requiresCustomers: true,
      effects: { cash: -40 },
      choices: [
        { text: "Push back firmly - contract terms are clear", ap: 2, eff: { cash: 30 }, revenueEff: { modifyCustomer: { type: 'largest', satisfaction: -0.2 } } },
        { text: "Negotiate early payment discount", ap: 2, eff: { cash: 20 }, revenueEff: { modifyCustomer: { type: 'largest', revenueChange: -3 } } },
        { text: "Accept and manage cash flow", ap: 1, eff: { hr: -1 } }
      ]
    },
    {
      id: "reference_customer_win",
      headline: "Reference Customer Opens Doors",
      text: "A happy customer agreed to be a reference. Now three enterprise prospects want to talk after hearing their story.",
      type: "positive",
      icon: "ğŸ¯",
      requiresCustomers: true,
      effects: { mkt: 4 },
      revenueEffect: { addToPipeline: [
        { value: 20, closeIn: 2, probability: 0.5, name: 'Reference Lead 1' },
        { value: 25, closeIn: 3, probability: 0.4, name: 'Reference Lead 2' },
        { value: 30, closeIn: 3, probability: 0.35, name: 'Reference Lead 3' }
      ]},
      choices: [
        { text: "Fast-track all three simultaneously", ap: 3, eff: { mkt: 3, burn: 10 } },
        { text: "Focus on the largest opportunity", ap: 2, eff: { mkt: 2 } },
        { text: "Qualify carefully - pick the best fit", ap: 2, eff: { mkt: 1, dev: 1 } }
      ]
    },
    {
      id: "customer_acquired",
      headline: "Strategic Acquirer Buys Your Customer",
      text: "Your customer just got acquired by a much larger company. The new owners are reviewing all vendor relationships.",
      type: "neutral",
      icon: "ğŸ¤",
      requiresCustomers: true,
      effects: {},
      revenueEffect: { modifyCustomer: { type: 'random', satisfaction: 0.4 } },
      choices: [
        { text: "Reach out to new leadership immediately", ap: 2, eff: { mkt: 2 }, revenueEff: { modifyCustomer: { type: 'random', satisfaction: 0.7 }, addToPipeline: [{ value: 40, closeIn: 4, probability: 0.3, name: 'Acquirer Corporate' }] } },
        { text: "Let the dust settle, maintain status quo", ap: 1, eff: { } },
        { text: "Propose expanded deal to new parent company", ap: 3, eff: { mkt: 3 }, revenueEff: { addCustomer: { revenue: 20, supportCost: 6, type: 'enterprise', satisfaction: 0.6 } } }
      ]
    },
    {
      id: "board_revenue_pressure",
      headline: "Board Questions Revenue Progress",
      text: "At the quarterly board meeting, investors express concern about revenue being behind projections. They want to see a turnaround plan.",
      type: "negative",
      icon: "ğŸ“Š",
      requiresRevenue: true,
      effects: { hr: -1 },
      choices: [
        { text: "Present aggressive new sales plan", ap: 2, eff: { mkt: 3 } },
        { text: "Explain market timing, request patience", ap: 1, eff: { sci: 1 } },
        { text: "Bring in experienced sales leadership", ap: 3, eff: { mkt: 4, burn: 25, hr: 2 } }
      ]
    },
    {
      id: "inbound_enterprise",
      headline: "Fortune 500 Reaches Out",
      text: "The procurement team from a Fortune 500 company found you through a conference talk. They want to discuss a pilot program.",
      type: "positive",
      icon: "ğŸ¢",
      effects: { mkt: 2, val: 30 },
      revenueEffect: { addToPipeline: [{ value: 60, closeIn: 4, probability: 0.35, name: 'Fortune 500 Pilot', strategic: true }]},
      choices: [
        { text: "Drop everything - this is transformative", ap: 4, eff: { mkt: 4, dev: -1 }, revenueEff: { pipeline: { modify: 'fortune500', probability: 0.5 } } },
        { text: "Engage but maintain other priorities", ap: 2, eff: { mkt: 2 } },
        { text: "Qualify carefully - big co sales are complex", ap: 2, eff: { mkt: 1, sci: 1 } }
      ]
    }
  ]
};

// Flatten shocks for random selection
const ALL_SHOCKS = Object.values(SHOCKS).flat();

// ===== LIFE EVENTS - Random personal/team events =====
const LIFE_EVENTS = [
  // Negative - AP Drain
  { id: "train_rescue", title: "Last Train to Nowhere", icon: "ğŸš‚", type: "negative",
    text: "Your lead developer fell asleep on the train home. She's now in Penzance. You're driving to get her.",
    effect: { type: "ap", value: -1 } },
  { id: "visa_nightmare", title: "Visa Nightmare", icon: "ğŸ›‚", type: "negative",
    text: "The Home Office rejected your engineer's visa renewal. Missing fingerprints. Three weeks of panic.",
    effect: { type: "ap", value: -2 } },
  { id: "hen_do", title: "Hen Do Casualty", icon: "ğŸ‰", type: "negative",
    text: "The Bath hen weekend was 'legendary.' Your head of marketing won't be in this week.",
    effect: { type: "ap", value: -1 } },
  { id: "food_poisoning", title: "Food Poisoning Roulette", icon: "ğŸ½ï¸", type: "negative",
    text: "The team lunch spot had issues. Half your engineers are working from the bathroom.",
    effect: { type: "ap", value: -1 } },
  { id: "reply_all", title: "The Reply-All Incident", icon: "ğŸ“§", type: "negative",
    text: "Someone replied-all to a client thread with opinions about the client. Damage control time.",
    effect: { type: "ap", value: -1 } },
  { id: "flu_office", title: "Flu Sweeps the Office", icon: "ğŸ¤’", type: "negative",
    text: "It spread like wildfire. Three people out. The rest are 'soldiering on' unconvincingly.",
    effect: { type: "ap", value: -1 } },
  { id: "jury_duty", title: "Jury Duty", icon: "âš–ï¸", type: "negative",
    text: "The Crown Court needs you. 'I'm disrupting an industry' is not a valid excuse.",
    effect: { type: "ap", value: -2 } },
  { id: "school_called", title: "School Called", icon: "ğŸ«", type: "negative",
    text: "Your child expressed themselves creatively on the headteacher's car. Meeting required.",
    effect: { type: "ap", value: -1 } },
  { id: "houseguest", title: "Extended Houseguest", icon: "ğŸ›‹ï¸", type: "negative",
    text: "Your uni friend is 'passing through.' That was two weeks ago. They have opinions about your product.",
    effect: { type: "ap", value: -1 } },
  { id: "family_emergency", title: "Family Emergency", icon: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§", type: "negative",
    text: "A close relative needs you. Work waits.",
    effect: { type: "ap", value: -1 } },
  { id: "stag_do", title: "Stag Do Fallout", icon: "ğŸ»", type: "negative",
    text: "Prague was a mistake. Your lead engineer is back but not really back. Write off the week.",
    effect: { type: "ap", value: -1 } },
  { id: "train_strike", title: "Train Strike", icon: "ğŸš«", type: "negative",
    text: "The entire team is working from home. Half don't have WiFi. The other half have toddlers.",
    effect: { type: "ap", value: -1 } },
  
  // Negative - Stat Drain
  { id: "loud_train", title: "The Loud Train Conversation", icon: "ğŸ—£ï¸", type: "negative",
    text: "Two researchers discussed the algorithm on the quiet coach. A competitor was three rows back.",
    effect: { type: "stat", stat: "sci", value: -2 } },
  { id: "laptop_uber", title: "Laptop Left in Uber", icon: "ğŸš—", type: "negative",
    text: "Your sales lead left their laptop in a cab. It had the pitch deck and the customer list.",
    effect: { type: "stat", stat: "mkt", value: -2 } },
  { id: "conference_overshare", title: "Conference Overshare", icon: "ğŸ¤", type: "negative",
    text: "Your CTO got enthusiastic at drinks and told a journalist everything. Everything.",
    effect: { type: "stat", stat: "dev", value: -2 } },
  { id: "slack_screenshot", title: "The Slack Screenshot", icon: "ğŸ“±", type: "negative",
    text: "An internal rant about a partner got screenshotted. It's now on LinkedIn.",
    effect: { type: "stat", stat: "hr", value: -2 } },
  { id: "zoom_background", title: "The Zoom Background", icon: "ğŸ’»", type: "negative",
    text: "Your developer joined the investor call from their bedroom. Their housemate walked past. Undressed.",
    effect: { type: "stat", stat: "mkt", value: -1 } },
  { id: "pub_argument", title: "Pub Argument", icon: "ğŸº", type: "negative",
    text: "Two team members had a falling out at Friday drinks. It's now affecting standups.",
    effect: { type: "stat", stat: "hr", value: -1 } },
  
  // Positive - AP Boost
  { id: "in_laws", title: "In-Laws to the Rescue", icon: "ğŸ‘´", type: "positive",
    text: "Your partner's parents arrived for a month. They've taken over everything. You're suspiciously free.",
    effect: { type: "ap", value: 1 } },
  { id: "conference_cancelled", title: "Conference Cancelled", icon: "âœˆï¸", type: "positive",
    text: "The event you dreaded is off. No travel, no small talk. A week reclaimed.",
    effect: { type: "ap", value: 1 } },
  { id: "childcare_miracle", title: "Childcare Miracle", icon: "ğŸ‘¶", type: "positive",
    text: "The nursery had a cancellation. Three days became five. You could cry with relief.",
    effect: { type: "ap", value: 1 } },
  { id: "smooth_quarter", title: "Smooth Quarter", icon: "ğŸ˜Œ", type: "positive",
    text: "Nothing broke. Nobody quit. The build worked first time. Suspicious, but you'll take it.",
    effect: { type: "ap", value: 1 } },
  { id: "flight_upgrade", title: "Flight Upgrade", icon: "âœ¨", type: "positive",
    text: "Business class to the investor meeting. Arrived rested. Pitched well. Sometimes luck helps.",
    effect: { type: "ap", value: 1 } },
  { id: "remote_week", title: "Remote Work Week", icon: "ğŸ ", type: "positive",
    text: "Everyone worked from home. No commutes, no interruptions. Surprisingly productive.",
    effect: { type: "ap", value: 1 } },
  { id: "chocolate_delivery", title: "Hotel Chocolat Delivery", icon: "ğŸ«", type: "positive",
    text: "A grateful client sent a massive box of truffles. Productivity briefly dipped, then soared.",
    effect: { type: "ap", value: 1 } },
  { id: "perfect_weather", title: "Perfect Weather Week", icon: "â˜€ï¸", type: "positive",
    text: "Sunshine every day. Everyone in good moods. Meetings were shorter. Things just worked.",
    effect: { type: "ap", value: 1 } },
  
  // Positive - Stat Boost
  { id: "weekend_hero", title: "Weekend Hero", icon: "ğŸ¦¸", type: "positive",
    text: "Your developer stayed up all night to fix the demo. The Monday pitch went perfectly.",
    effect: { type: "stat", stat: "dev", value: 2 } },
  { id: "train_serendipity", title: "Conference Serendipity", icon: "ğŸ¤", type: "positive",
    text: "Your sales rep sat next to a procurement director on the train. We have a pilot.",
    effect: { type: "stat", stat: "mkt", value: 3 } },
  { id: "helpful_intern", title: "The Helpful Intern", icon: "ğŸ“", type: "positive",
    text: "The intern fixed a bug that stumped everyone. 'It was obvious,' she said.",
    effect: { type: "stat", stat: "sci", value: 2 } },
  { id: "rival_defects", title: "Rival's Engineer Defects", icon: "ğŸƒ", type: "positive",
    text: "A senior engineer from CortexAI DM'd asking if you're hiring. Their culture is 'interesting.'",
    effect: { type: "stat", stat: "hr", value: 2 } },
  { id: "pub_breakthrough", title: "Pub Breakthrough", icon: "ğŸ’¡", type: "positive",
    text: "Friday drinks whiteboard session cracked a problem you'd been stuck on for months.",
    effect: { type: "stat", stat: "sci", value: 3 } },
  { id: "viral_post", title: "The Viral Post", icon: "ğŸ“ˆ", type: "positive",
    text: "Your engineer's blog post hit front page of Hacker News. Inbox flooded with CVs.",
    effect: { type: "stat", stat: "mkt", value: 2, stat2: "hr", value2: 1 } },
  { id: "client_referral", title: "Client Referral", icon: "ğŸŒŸ", type: "positive",
    text: "Your happiest customer recommended you to three companies. Without being asked.",
    effect: { type: "stat", stat: "mkt", value: 2 } },
  { id: "side_project", title: "Side Project Surprise", icon: "ğŸ”¬", type: "positive",
    text: "Your researcher's weekend experiment accidentally solved a customer problem.",
    effect: { type: "stat", stat: "dev", value: 2 } },
  { id: "team_bonding", title: "Team Bonding Success", icon: "ğŸ¯", type: "positive",
    text: "The offsite actually worked. People are communicating better. Who knew escape rooms helped?",
    effect: { type: "stat", stat: "hr", value: 2 } },
  { id: "podcast_mention", title: "Podcast Mention", icon: "ğŸ™ï¸", type: "positive",
    text: "A popular tech podcast mentioned your product unprompted. Downloads spiked.",
    effect: { type: "stat", stat: "mkt", value: 2 } },
  
  // Positive - Cultural Celebrations
  { id: "diwali_sweets", title: "Diwali Sweets", icon: "ğŸª”", type: "positive",
    text: "Your developer brought boxes of mithai for Diwali. The office smells amazing and everyone's in high spirits.",
    effect: { type: "ap", value: 1 } },
  { id: "eid_feast", title: "Eid Feast", icon: "ğŸŒ™", type: "positive",
    text: "Your engineer organised an Eid lunch for the team. The biryani was exceptional. Nobody worked very hard afterwards.",
    effect: { type: "stat", stat: "hr", value: 2 } },
  { id: "chinese_new_year", title: "Chinese New Year Celebration", icon: "ğŸ‰", type: "positive",
    text: "Your product lead organised a Chinese New Year lunch. The dragon dance in the car park set off a car alarm. Worth it.",
    effect: { type: "ap", value: 1 } },
  { id: "hanukkah_latkes", title: "Hanukkah Latkes", icon: "ğŸ•", type: "positive",
    text: "Your researcher brought in latkes and taught the team to spin the dreidel to enjoy the Festival of Lights.",
    effect: { type: "stat", stat: "hr", value: 2 } },
  
  // Positive - Cash Boost
  { id: "inheritance", title: "Great-Aunt Mildred", icon: "ğŸ’", type: "positive",
    text: "A distant relative left you Â£50,000. You put it straight into the company. Thanks, Mildred.",
    effect: { type: "cash", value: 50 } },
  { id: "tax_credit", title: "Forgotten Tax Credit", icon: "ğŸ“‹", type: "positive",
    text: "Your accountant found R&D credits you'd missed. HMRC sends Â£15,000.",
    effect: { type: "cash", value: 15 } }
];

// ===== CONFERENCE MINI-GAME DATA =====
const CONFERENCES = {
  aether: [
    { name: "BioTech World London", location: "ExCeL Centre" },
    { name: "public health system Innovation Expo", location: "Manchester Central" },
    { name: "Life Sciences Summit", location: "Edinburgh ICC" }
  ],
  vanguard: [
    { name: "Robotics & Automation Show", location: "NEC Birmingham" },
    { name: "Manufacturing Technology Expo", location: "Coventry Arena" },
    { name: "Industry 4.0 Summit", location: "London Olympia" }
  ],
  quant: [
    { name: "FinTech Connect", location: "ExCeL Centre" },
    { name: "Quant Summit Europe", location: "The Barbican" },
    { name: "AI in Finance Conference", location: "Canary Wharf" }
  ],
  dream: [
    { name: "Creative Tech Week", location: "Shoreditch" },
    { name: "Games Developer Conference UK", location: "Brighton Centre" },
    { name: "AI & Creativity Summit", location: "Kings Cross" }
  ]
};

// Delegate types with different values and difficulty
// Delegate types - now with SVG little people (faster speeds for 45s game)
const DELEGATE_TYPES = [
  { type: "student", name: "Student", speed: 4, value: 1, interest: 25, 
    color: "#94a3b8", headColor: "#fef3c7", bodyColor: "#64748b", irritable: 0.1 },
  { type: "developer", name: "Developer", speed: 3.5, value: 2, interest: 40, 
    color: "#60a5fa", headColor: "#fde68a", bodyColor: "#3b82f6", irritable: 0.15 },
  { type: "manager", name: "Manager", speed: 3, value: 3, interest: 55, 
    color: "#f59e0b", headColor: "#fecaca", bodyColor: "#374151", irritable: 0.25 },
  { type: "executive", name: "Executive", speed: 2.5, value: 5, interest: 70, 
    color: "#8b5cf6", headColor: "#fef3c7", bodyColor: "#1f2937", irritable: 0.35 },
  { type: "investor", name: "Investor", speed: 2, value: 8, interest: 80, 
    color: "#10b981", headColor: "#fde68a", bodyColor: "#065f46", irritable: 0.4 },
  { type: "journalist", name: "Journalist", speed: 3.8, value: 4, interest: 45, 
    color: "#ec4899", headColor: "#fecaca", bodyColor: "#db2777", irritable: 0.2 },
  { type: "competitor", name: "Competitor", speed: 3, value: -2, interest: 35, 
    color: "#ef4444", headColor: "#d1d5db", bodyColor: "#7f1d1d", irritable: 0 }
];

// Generate SVG for a delegate
function getDelegateSVG(type, mood = 'neutral') {
  const d = DELEGATE_TYPES.find(t => t.type === type) || DELEGATE_TYPES[0];
  const faceColor = mood === 'interested' ? '#4ade80' : mood === 'disgusted' ? '#f87171' : d.headColor;
  const expression = mood === 'interested' ? 'M7,10 Q10,12 13,10' : // smile
                     mood === 'disgusted' ? 'M7,11 Q10,9 13,11' : // frown
                     'M7,10 L13,10'; // neutral
  return `<svg width="24" height="30" viewBox="0 0 20 28">
    <ellipse cx="10" cy="7" rx="5" ry="5" fill="${faceColor}"/>
    <circle cx="7" cy="6" r="1" fill="#1f2937"/>
    <circle cx="13" cy="6" r="1" fill="#1f2937"/>
    <path d="${expression}" stroke="#1f2937" stroke-width="1" fill="none"/>
    <path d="M5 28 L7 14 L13 14 L15 28" fill="${d.bodyColor}"/>
    <ellipse cx="6" cy="28" rx="2" ry="1" fill="#1f2937"/>
    <ellipse cx="14" cy="28" rx="2" ry="1" fill="#1f2937"/>
  </svg>`;
}

// Conference costs scale with milestone number
const CONF_COSTS = {
  1: { swag: 20, coffee: 50, demo: 150, talk: 400, budget: 1500 },
  2: { swag: 40, coffee: 100, demo: 300, talk: 800, budget: 3000 },
  3: { swag: 80, coffee: 200, demo: 600, talk: 1500, budget: 6000 }
};

// ===== SOUND MANAGER =====

class SoundManager {
  constructor() {
    this.audioContext = null;
    this.enabled = true;
  }
  
  init() {
    if (!this.audioContext) {
      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (this.audioContext.state === 'suspended') {
      this.audioContext.resume();
    }
  }
  
  playTone(frequency, duration, type = 'sine', volume = 0.3, delay = 0) {
    if (!this.enabled) return;
    this.init();
    
    const osc = this.audioContext.createOscillator();
    const gain = this.audioContext.createGain();
    
    osc.type = type;
    osc.frequency.value = frequency;
    osc.connect(gain);
    gain.connect(this.audioContext.destination);
    
    const startTime = this.audioContext.currentTime + delay;
    gain.gain.setValueAtTime(volume, startTime);
    gain.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
    
    osc.start(startTime);
    osc.stop(startTime + duration);
  }
  
  // Department selection sounds - each has a unique character
  playResearch() {
    // Scientific "discovery" sound - ascending crystalline tones
    this.playTone(523, 0.1, 'sine', 0.25); // C5
    this.playTone(659, 0.1, 'sine', 0.25, 0.08); // E5
    this.playTone(784, 0.15, 'sine', 0.3, 0.16); // G5
  }
  
  playProduct() {
    // Technical "build" sound - digital blips
    this.playTone(440, 0.08, 'square', 0.15); // A4
    this.playTone(554, 0.08, 'square', 0.15, 0.06); // C#5
    this.playTone(659, 0.12, 'square', 0.2, 0.12); // E5
  }
  
  playSales() {
    // Confident "deal" sound - bold brass-like
    this.playTone(349, 0.1, 'sawtooth', 0.12); // F4
    this.playTone(440, 0.1, 'sawtooth', 0.12, 0.08); // A4
    this.playTone(523, 0.15, 'sawtooth', 0.15, 0.16); // C5
  }
  
  playHR() {
    // Warm "people" sound - soft harmonious
    this.playTone(392, 0.12, 'sine', 0.2); // G4
    this.playTone(494, 0.12, 'sine', 0.2, 0.1); // B4
    this.playTone(587, 0.15, 'sine', 0.25, 0.2); // D5
  }
  
  // End of quarter - satisfying completion chime
  playQuarterEnd() {
    this.playTone(523, 0.15, 'sine', 0.3); // C5
    this.playTone(659, 0.15, 'sine', 0.3, 0.12); // E5
    this.playTone(784, 0.15, 'sine', 0.3, 0.24); // G5
    this.playTone(1047, 0.25, 'sine', 0.35, 0.36); // C6
  }
  
  // Milestone achieved - triumphant fanfare
  playMilestoneComplete() {
    // First chord
    this.playTone(523, 0.2, 'sine', 0.25); // C5
    this.playTone(659, 0.2, 'sine', 0.25); // E5
    this.playTone(784, 0.2, 'sine', 0.25); // G5
    // Rising sequence
    this.playTone(698, 0.15, 'sine', 0.3, 0.25); // F5
    this.playTone(784, 0.15, 'sine', 0.3, 0.35); // G5
    this.playTone(880, 0.15, 'sine', 0.3, 0.45); // A5
    // Final triumphant chord
    this.playTone(1047, 0.4, 'sine', 0.35, 0.55); // C6
    this.playTone(1319, 0.4, 'sine', 0.3, 0.55); // E6
    this.playTone(1568, 0.4, 'sine', 0.25, 0.55); // G6
  }
  
  // Victory - epic success fanfare
  playVictory() {
    // Majestic opening
    this.playTone(523, 0.2, 'sine', 0.3); // C5
    this.playTone(659, 0.2, 'sine', 0.3, 0.15); // E5
    this.playTone(784, 0.2, 'sine', 0.3, 0.3); // G5
    // Ascending triumph
    this.playTone(880, 0.15, 'sine', 0.3, 0.5); // A5
    this.playTone(988, 0.15, 'sine', 0.3, 0.6); // B5
    this.playTone(1047, 0.3, 'sine', 0.35, 0.7); // C6
    // Final glorious chord with harmonics
    this.playTone(1047, 0.6, 'sine', 0.35, 0.95); // C6
    this.playTone(1319, 0.6, 'sine', 0.3, 0.95); // E6
    this.playTone(1568, 0.6, 'sine', 0.3, 0.95); // G6
    this.playTone(2093, 0.6, 'sine', 0.2, 0.95); // C7
    // Sparkle overtones
    this.playTone(2637, 0.3, 'sine', 0.1, 1.1); // E7
    this.playTone(3136, 0.3, 'sine', 0.08, 1.2); // G7
  }
  
  // Failure - somber descending tones
  playFailure() {
    // Descending minor sequence
    this.playTone(440, 0.25, 'sine', 0.3); // A4
    this.playTone(392, 0.25, 'sine', 0.28, 0.2); // G4
    this.playTone(349, 0.25, 'sine', 0.25, 0.4); // F4
    this.playTone(330, 0.4, 'sine', 0.22, 0.6); // E4
    // Final low dissonant chord
    this.playTone(220, 0.6, 'sine', 0.25, 0.9); // A3
    this.playTone(233, 0.6, 'sine', 0.15, 0.9); // Bb3 (dissonant)
    this.playTone(277, 0.6, 'sine', 0.2, 0.9); // C#4
  }
  
  // Funding received - cash register / coin sound
  playFunding() {
    this.playTone(1319, 0.08, 'sine', 0.3); // E6
    this.playTone(1568, 0.08, 'sine', 0.3, 0.06); // G6
    this.playTone(1976, 0.1, 'sine', 0.35, 0.12); // B6
    this.playTone(2093, 0.15, 'sine', 0.3, 0.18); // C7
    // Coin "ching"
    this.playTone(4186, 0.08, 'sine', 0.15, 0.25);
    this.playTone(5274, 0.1, 'sine', 0.1, 0.28);
  }
  
  // Button click - subtle UI feedback
  playClick() {
    this.playTone(800, 0.05, 'sine', 0.15);
  }
  
  // Warning - attention needed
  playWarning() {
    this.playTone(440, 0.15, 'square', 0.2);
    this.playTone(349, 0.2, 'square', 0.2, 0.15);
  }
  
  // Shock event - dramatic alert
  playShock() {
    this.playTone(220, 0.1, 'sawtooth', 0.2);
    this.playTone(277, 0.1, 'sawtooth', 0.2, 0.08);
    this.playTone(220, 0.15, 'sawtooth', 0.25, 0.16);
    this.playTone(185, 0.25, 'sawtooth', 0.2, 0.28);
  }
  
  // Milestone choice - strategic decision moment
  playMilestoneChoice() {
    // Dramatic "important decision" fanfare
    this.playTone(392, 0.15, 'sine', 0.25); // G4
    this.playTone(494, 0.15, 'sine', 0.25, 0.1); // B4
    this.playTone(587, 0.15, 'sine', 0.25, 0.2); // D5
    // Suspenseful hold
    this.playTone(523, 0.25, 'sine', 0.3, 0.35); // C5
    this.playTone(659, 0.25, 'sine', 0.25, 0.35); // E5
    this.playTone(784, 0.25, 'sine', 0.2, 0.35); // G5
    // Questioning rise
    this.playTone(880, 0.2, 'sine', 0.2, 0.55); // A5
    this.playTone(988, 0.3, 'sine', 0.22, 0.65); // B5
  }
  
  // === SETUP PHASE SOUNDS ===
  
  // Company/venture selection - exciting "opportunity" sound
  playVentureSelect() {
    // Bright, hopeful ascending arpeggio
    this.playTone(392, 0.1, 'sine', 0.2); // G4
    this.playTone(494, 0.1, 'sine', 0.22, 0.07); // B4
    this.playTone(587, 0.1, 'sine', 0.24, 0.14); // D5
    this.playTone(784, 0.15, 'sine', 0.28, 0.21); // G5
    // Sparkle on top
    this.playTone(1175, 0.12, 'sine', 0.15, 0.3); // D6
  }
  
  // Location selection - "placing pin on map" sound
  playLocationSelect() {
    // Soft "pop" with geographic feel
    this.playTone(600, 0.06, 'sine', 0.25);
    this.playTone(800, 0.08, 'sine', 0.2, 0.04);
    this.playTone(1000, 0.1, 'triangle', 0.18, 0.08);
    // Confirmation tone
    this.playTone(523, 0.12, 'sine', 0.22, 0.15); // C5
    this.playTone(659, 0.15, 'sine', 0.2, 0.22); // E5
  }
  
  // Funding path selection - different sounds for each type
  playFundingSelect(fundingType = 'default') {
    if (fundingType === 'bootstrap') {
      this.playBootstrapSound();
    } else if (fundingType === 'angel') {
      this.playAngelSound();
    } else if (fundingType === 'vc') {
      this.playVCSound();
    } else {
      // Default fallback
      this.playAngelSound();
    }
  }
  
  // Bootstrap - humble, self-reliant sound (piggy bank / single coins)
  playBootstrapSound() {
    // Piggy bank shake
    this.playTone(300, 0.05, 'triangle', 0.15);
    this.playTone(350, 0.05, 'triangle', 0.12, 0.06);
    this.playTone(280, 0.05, 'triangle', 0.1, 0.12);
    
    // A few modest coins dropping
    this.playTone(2200, 0.03, 'sine', 0.12, 0.18);
    this.playTone(2500, 0.03, 'sine', 0.1, 0.24);
    this.playTone(2300, 0.03, 'sine', 0.08, 0.30);
    
    // Determined, humble resolution - minor key undertone
    this.playTone(392, 0.12, 'sine', 0.18, 0.36); // G4
    this.playTone(466, 0.12, 'sine', 0.16, 0.42); // Bb4
    this.playTone(523, 0.18, 'sine', 0.2, 0.48); // C5
    
    // Single "I've got this" chime
    this.playTone(784, 0.15, 'sine', 0.15, 0.6); // G5
  }
  
  // Angel investment - warm, personal, encouraging sound
  playAngelSound() {
    // Gentle handshake / connection tone
    this.playTone(349, 0.08, 'sine', 0.15); // F4
    this.playTone(440, 0.08, 'sine', 0.15, 0.06); // A4
    
    // Coins with a personal touch - moderate amount
    this.playTone(2400, 0.04, 'sine', 0.14, 0.12);
    this.playTone(2700, 0.04, 'sine', 0.13, 0.17);
    this.playTone(2500, 0.04, 'sine', 0.12, 0.22);
    this.playTone(2900, 0.04, 'sine', 0.11, 0.27);
    
    // Warm, supportive rising chord
    this.playTone(523, 0.1, 'sine', 0.2, 0.32); // C5
    this.playTone(659, 0.1, 'sine', 0.2, 0.32); // E5
    this.playTone(784, 0.1, 'sine', 0.18, 0.32); // G5
    
    // Encouraging ascending resolution
    this.playTone(880, 0.12, 'sine', 0.22, 0.42); // A5
    this.playTone(1047, 0.15, 'sine', 0.2, 0.5); // C6
    
    // Friendly sparkle
    this.playTone(1568, 0.1, 'sine', 0.12, 0.6); // G6
    this.playTone(2093, 0.12, 'sine', 0.1, 0.65); // C7
  }
  
  // VC investment - big, impressive, Wall Street fanfare
  playVCSound() {
    // Impressive door opening / boardroom entrance
    this.playTone(150, 0.1, 'sawtooth', 0.1);
    this.playTone(200, 0.08, 'sawtooth', 0.12, 0.08);
    
    // Cash register drawer - bigger mechanism
    this.playTone(220, 0.1, 'square', 0.12, 0.15);
    this.playTone(280, 0.08, 'square', 0.1, 0.2);
    
    // LOTS of coins - money raining down
    this.playTone(2400, 0.04, 'sine', 0.16, 0.25);
    this.playTone(2800, 0.04, 'sine', 0.15, 0.28);
    this.playTone(3200, 0.04, 'sine', 0.14, 0.31);
    this.playTone(2600, 0.04, 'sine', 0.14, 0.34);
    this.playTone(3000, 0.04, 'sine', 0.13, 0.37);
    this.playTone(2700, 0.04, 'sine', 0.13, 0.40);
    this.playTone(3100, 0.04, 'sine', 0.12, 0.43);
    this.playTone(2500, 0.04, 'sine', 0.12, 0.46);
    this.playTone(2900, 0.04, 'sine', 0.11, 0.49);
    this.playTone(3300, 0.04, 'sine', 0.1, 0.52);
    
    // Power chord - confident, corporate
    this.playTone(440, 0.15, 'sine', 0.22, 0.55); // A4
    this.playTone(554, 0.15, 'sine', 0.22, 0.55); // C#5
    this.playTone(659, 0.15, 'sine', 0.2, 0.55); // E5
    
    // Rising fanfare - "big deal" energy
    this.playTone(880, 0.1, 'sine', 0.24, 0.68); // A5
    this.playTone(1047, 0.1, 'sine', 0.24, 0.74); // C6
    this.playTone(1319, 0.1, 'sine', 0.24, 0.80); // E6
    
    // Triumphant "CHA-CHING!" finale
    this.playTone(1760, 0.18, 'sine', 0.28, 0.88); // A6
    this.playTone(2093, 0.18, 'sine', 0.25, 0.88); // C7
    this.playTone(2637, 0.18, 'sine', 0.22, 0.88); // E7
    
    // Grand bell / celebration
    this.playTone(3520, 0.15, 'sine', 0.15, 0.98); // A7
    this.playTone(4186, 0.12, 'sine', 0.12, 1.02); // C8
    this.playTone(5274, 0.15, 'sine', 0.1, 1.06); // E8 - sparkle
    
    // Extra prestige shimmer
    this.playTone(6272, 0.1, 'sine', 0.06, 1.12); // G8
  }
  
  // Staff/executive hire - different sounds for each department
  playHireSelect(role = 'default') {
    if (role === 'research') {
      // Scientific/academic feel - thoughtful ascending
      this.playTone(440, 0.1, 'sine', 0.18); // A4
      this.playTone(523, 0.1, 'sine', 0.18, 0.08); // C5
      this.playTone(659, 0.12, 'sine', 0.2, 0.16); // E5
      this.playTone(784, 0.15, 'sine', 0.22, 0.24); // G5
      // Knowledge sparkle
      this.playTone(1047, 0.1, 'sine', 0.15, 0.35); // C6
    } else if (role === 'dev') {
      // Technical/digital feel - blippy
      this.playTone(330, 0.06, 'square', 0.12); // E4
      this.playTone(440, 0.06, 'square', 0.14, 0.05); // A4
      this.playTone(554, 0.08, 'square', 0.16, 0.1); // C#5
      this.playTone(659, 0.1, 'triangle', 0.18, 0.16); // E5
      // Digital confirmation
      this.playTone(880, 0.12, 'triangle', 0.15, 0.24); // A5
    } else if (role === 'marketing') {
      // Bold/confident feel - fanfare-like
      this.playTone(349, 0.08, 'sawtooth', 0.1); // F4
      this.playTone(440, 0.08, 'sawtooth', 0.12, 0.06); // A4
      this.playTone(523, 0.1, 'sawtooth', 0.14, 0.12); // C5
      // Confident resolution
      this.playTone(659, 0.12, 'sine', 0.2, 0.2); // E5
      this.playTone(784, 0.15, 'sine', 0.18, 0.28); // G5
    } else if (role === 'hr') {
      // Warm/people-focused feel - harmonious
      this.playTone(392, 0.1, 'sine', 0.18); // G4
      this.playTone(494, 0.1, 'sine', 0.18, 0.08); // B4
      this.playTone(587, 0.1, 'sine', 0.2, 0.16); // D5
      // Supportive warmth
      this.playTone(698, 0.12, 'sine', 0.22, 0.24); // F5
      this.playTone(784, 0.15, 'sine', 0.2, 0.32); // G5
    } else {
      // Default warm welcome
      this.playTone(349, 0.12, 'sine', 0.2); // F4
      this.playTone(440, 0.12, 'sine', 0.2); // A4
      this.playTone(523, 0.12, 'sine', 0.2); // C5
      // Rising confirmation
      this.playTone(523, 0.1, 'sine', 0.22, 0.12); // C5
      this.playTone(587, 0.1, 'sine', 0.22, 0.18); // D5
      this.playTone(659, 0.15, 'sine', 0.25, 0.24); // E5
      // Handshake "done deal" tone
      this.playTone(784, 0.2, 'sine', 0.2, 0.35); // G5
    }
  }
  
  // Founder profile selection - personal/identity feel
  playFounderSelect() {
    // Introspective, personal sound
    this.playTone(294, 0.15, 'sine', 0.2); // D4
    this.playTone(370, 0.12, 'sine', 0.2, 0.1); // F#4
    this.playTone(440, 0.12, 'sine', 0.22, 0.18); // A4
    // Identity confirmation
    this.playTone(554, 0.1, 'sine', 0.2, 0.28); // C#5
    this.playTone(659, 0.15, 'sine', 0.22, 0.35); // E5
    // Subtle shimmer
    this.playTone(880, 0.12, 'sine', 0.12, 0.45); // A5
  }
  
  // Navigation/page turn in setup - subtle whoosh
  playPageTurn() {
    // Soft swoosh sound
    this.playTone(300, 0.08, 'sine', 0.1);
    this.playTone(400, 0.06, 'sine', 0.12, 0.03);
    this.playTone(500, 0.05, 'sine', 0.1, 0.06);
    this.playTone(600, 0.04, 'sine', 0.08, 0.08);
  }
  
  // Setup complete - "ready to launch" fanfare
  playSetupComplete() {
    // Building anticipation
    this.playTone(392, 0.12, 'sine', 0.22); // G4
    this.playTone(440, 0.12, 'sine', 0.22, 0.1); // A4
    this.playTone(494, 0.12, 'sine', 0.22, 0.2); // B4
    // Triumphant resolution
    this.playTone(523, 0.2, 'sine', 0.28, 0.32); // C5
    this.playTone(659, 0.2, 'sine', 0.26, 0.32); // E5
    this.playTone(784, 0.2, 'sine', 0.24, 0.32); // G5
    // Final flourish
    this.playTone(1047, 0.3, 'sine', 0.25, 0.5); // C6
    this.playTone(1319, 0.3, 'sine', 0.2, 0.55); // E6
  }
  
  // Rocket launch - dramatic whoosh with ignition and ascending power (~3.5 seconds)
  playRocketLaunch() {
    if (!this.enabled) return;
    this.init();
    
    const ctx = this.audioContext;
    const now = ctx.currentTime;
    
    // Create noise for rocket rumble/whoosh
    const bufferSize = ctx.sampleRate * 4;
    const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const output = noiseBuffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) {
      output[i] = Math.random() * 2 - 1;
    }
    
    // Noise source for rumble
    const noise = ctx.createBufferSource();
    noise.buffer = noiseBuffer;
    
    // Filter for rocket rumble character - slower sweep for longer sound
    const filter = ctx.createBiquadFilter();
    filter.type = 'lowpass';
    filter.frequency.setValueAtTime(100, now);
    filter.frequency.exponentialRampToValueAtTime(300, now + 0.5);
    filter.frequency.exponentialRampToValueAtTime(600, now + 1.2);
    filter.frequency.exponentialRampToValueAtTime(1500, now + 2.5);
    filter.frequency.exponentialRampToValueAtTime(3000, now + 3.2);
    
    // Gain envelope for rumble - longer sustain
    const rumbleGain = ctx.createGain();
    rumbleGain.gain.setValueAtTime(0, now);
    rumbleGain.gain.linearRampToValueAtTime(0.25, now + 0.15);
    rumbleGain.gain.linearRampToValueAtTime(0.35, now + 0.6);
    rumbleGain.gain.linearRampToValueAtTime(0.4, now + 1.5);
    rumbleGain.gain.linearRampToValueAtTime(0.3, now + 2.5);
    rumbleGain.gain.exponentialRampToValueAtTime(0.01, now + 3.5);
    
    noise.connect(filter);
    filter.connect(rumbleGain);
    rumbleGain.connect(ctx.destination);
    
    noise.start(now);
    noise.stop(now + 3.5);
    
    // Add deep sub-bass rumble for power
    const subOsc = ctx.createOscillator();
    const subGain = ctx.createGain();
    subOsc.type = 'sine';
    subOsc.frequency.setValueAtTime(40, now);
    subOsc.frequency.linearRampToValueAtTime(60, now + 2.0);
    subGain.gain.setValueAtTime(0, now);
    subGain.gain.linearRampToValueAtTime(0.3, now + 0.3);
    subGain.gain.linearRampToValueAtTime(0.35, now + 1.5);
    subGain.gain.exponentialRampToValueAtTime(0.01, now + 3.0);
    
    subOsc.connect(subGain);
    subGain.connect(ctx.destination);
    subOsc.start(now);
    subOsc.stop(now + 3.0);
    
    // Add ascending tone for "lift-off" feel - longer sweep
    const liftOsc = ctx.createOscillator();
    const liftGain = ctx.createGain();
    liftOsc.type = 'sawtooth';
    liftOsc.frequency.setValueAtTime(60, now + 0.3);
    liftOsc.frequency.exponentialRampToValueAtTime(150, now + 1.5);
    liftOsc.frequency.exponentialRampToValueAtTime(400, now + 2.8);
    liftGain.gain.setValueAtTime(0, now);
    liftGain.gain.linearRampToValueAtTime(0.12, now + 0.5);
    liftGain.gain.linearRampToValueAtTime(0.18, now + 1.5);
    liftGain.gain.linearRampToValueAtTime(0.15, now + 2.5);
    liftGain.gain.exponentialRampToValueAtTime(0.01, now + 3.2);
    
    liftOsc.connect(liftGain);
    liftGain.connect(ctx.destination);
    liftOsc.start(now + 0.3);
    liftOsc.stop(now + 3.2);
    
    // Second harmonic layer for richness
    const liftOsc2 = ctx.createOscillator();
    const liftGain2 = ctx.createGain();
    liftOsc2.type = 'triangle';
    liftOsc2.frequency.setValueAtTime(120, now + 0.5);
    liftOsc2.frequency.exponentialRampToValueAtTime(300, now + 1.8);
    liftOsc2.frequency.exponentialRampToValueAtTime(600, now + 3.0);
    liftGain2.gain.setValueAtTime(0, now);
    liftGain2.gain.linearRampToValueAtTime(0.08, now + 0.8);
    liftGain2.gain.linearRampToValueAtTime(0.1, now + 2.0);
    liftGain2.gain.exponentialRampToValueAtTime(0.01, now + 3.2);
    
    liftOsc2.connect(liftGain2);
    liftGain2.connect(ctx.destination);
    liftOsc2.start(now + 0.5);
    liftOsc2.stop(now + 3.2);
    
    // Ignition sequence - multiple pops
    this.playTone(80, 0.12, 'square', 0.35, 0);
    this.playTone(120, 0.1, 'square', 0.25, 0.08);
    this.playTone(100, 0.08, 'square', 0.2, 0.15);
    
    // Triumphant tones as rocket clears - later and more elaborate
    this.playTone(392, 0.25, 'sine', 0.2, 2.2); // G4
    this.playTone(523, 0.25, 'sine', 0.22, 2.4); // C5
    this.playTone(659, 0.25, 'sine', 0.22, 2.6); // E5
    this.playTone(784, 0.35, 'sine', 0.25, 2.8); // G5
    this.playTone(1047, 0.4, 'sine', 0.2, 3.0); // C6
  }
  
  // === ENDING SOUNDS ===
  
  // Beach ending - gentle waves and peaceful ambiance
  playBeachEnding() {
    if (!this.enabled) return;
    this.init();
    
    const ctx = this.audioContext;
    const now = ctx.currentTime;
    
    // Create wave-like noise
    const bufferSize = ctx.sampleRate * 8;
    const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const output = noiseBuffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) {
      output[i] = Math.random() * 2 - 1;
    }
    
    // Multiple wave cycles
    for (let wave = 0; wave < 3; wave++) {
      const waveStart = now + wave * 2.5;
      
      const noise = ctx.createBufferSource();
      noise.buffer = noiseBuffer;
      
      // Bandpass filter for ocean character
      const filter = ctx.createBiquadFilter();
      filter.type = 'bandpass';
      filter.frequency.value = 800;
      filter.Q.value = 0.5;
      
      // Wave envelope - crescendo then fade
      const waveGain = ctx.createGain();
      waveGain.gain.setValueAtTime(0, waveStart);
      waveGain.gain.linearRampToValueAtTime(0.15, waveStart + 0.8);
      waveGain.gain.linearRampToValueAtTime(0.2, waveStart + 1.2);
      waveGain.gain.exponentialRampToValueAtTime(0.01, waveStart + 2.2);
      
      noise.connect(filter);
      filter.connect(waveGain);
      waveGain.connect(ctx.destination);
      
      noise.start(waveStart);
      noise.stop(waveStart + 2.5);
    }
    
    // Peaceful wind chime tones
    const chimes = [523, 659, 784, 1047, 1319];
    chimes.forEach((freq, i) => {
      this.playTone(freq, 1.5, 'sine', 0.08, 0.5 + i * 0.7);
    });
  }
  
  // Serial entrepreneur - energetic startup sounds
  playSerialEnding() {
    if (!this.enabled) return;
    this.init();
    
    // Rapid ascending pattern - excitement
    const notes = [262, 330, 392, 523, 659, 784, 1047];
    notes.forEach((freq, i) => {
      this.playTone(freq, 0.15, 'sine', 0.2, i * 0.1);
    });
    
    // Keyboard typing sounds (rapid clicks)
    for (let i = 0; i < 8; i++) {
      this.playTone(800 + Math.random() * 400, 0.03, 'square', 0.1, 1.2 + i * 0.08);
    }
    
    // Startup "ding" notification
    this.playTone(880, 0.1, 'sine', 0.25, 2.0);
    this.playTone(1175, 0.15, 'sine', 0.3, 2.1);
    
    // Energy surge at the end
    this.playTone(523, 0.3, 'sine', 0.2, 2.5);
    this.playTone(659, 0.3, 'sine', 0.2, 2.5);
    this.playTone(784, 0.3, 'sine', 0.2, 2.5);
    this.playTone(1047, 0.5, 'sine', 0.25, 2.7);
  }
  
  // Hyper-scale - powerful growth sounds
  playScaleEnding() {
    if (!this.enabled) return;
    this.init();
    
    // Deep power bass
    this.playTone(65, 0.8, 'sine', 0.3);
    this.playTone(82, 0.8, 'sine', 0.25, 0.1);
    
    // Rising scale showing growth
    const scale = [262, 294, 330, 392, 440, 523, 659, 784, 880, 1047];
    scale.forEach((freq, i) => {
      this.playTone(freq, 0.2, 'sine', 0.15 + i * 0.02, 0.3 + i * 0.15);
    });
    
    // Epic chord at peak
    this.playTone(523, 0.6, 'sine', 0.25, 2.0);
    this.playTone(659, 0.6, 'sine', 0.25, 2.0);
    this.playTone(784, 0.6, 'sine', 0.25, 2.0);
    this.playTone(1047, 0.6, 'sine', 0.25, 2.0);
    this.playTone(1319, 0.8, 'sine', 0.2, 2.1);
    
    // Sparkle at the top
    this.playTone(2093, 0.3, 'sine', 0.1, 2.4);
    this.playTone(2637, 0.3, 'sine', 0.08, 2.5);
  }
  
  // Acquisition - corporate deal sounds
  playAcquisitionEnding() {
    if (!this.enabled) return;
    this.init();
    
    // Formal, professional tones
    this.playTone(262, 0.3, 'sine', 0.2);
    this.playTone(330, 0.3, 'sine', 0.2, 0.25);
    this.playTone(392, 0.4, 'sine', 0.22, 0.5);
    
    // Handshake/deal sound - confident
    this.playTone(523, 0.15, 'sine', 0.25, 1.0);
    this.playTone(659, 0.15, 'sine', 0.25, 1.1);
    
    // Cash register / big deal
    this.playTone(1319, 0.08, 'sine', 0.3, 1.5);
    this.playTone(1568, 0.08, 'sine', 0.3, 1.55);
    this.playTone(1976, 0.1, 'sine', 0.35, 1.6);
    this.playTone(2093, 0.15, 'sine', 0.3, 1.65);
    
    // Satisfied resolution chord
    this.playTone(392, 0.5, 'sine', 0.2, 2.0);
    this.playTone(494, 0.5, 'sine', 0.2, 2.0);
    this.playTone(587, 0.5, 'sine', 0.2, 2.0);
    this.playTone(784, 0.6, 'sine', 0.22, 2.1);
  }
  
  // === PIVOT SYSTEM SOUNDS ===
  
  // Market Shift Alert - urgent warning that competitor has beaten you
  playMarketShift() {
    // Alarm-like descending minor tones
    this.playTone(880, 0.12, 'sawtooth', 0.2); // A5
    this.playTone(740, 0.12, 'sawtooth', 0.22, 0.1); // F#5
    this.playTone(622, 0.12, 'sawtooth', 0.2, 0.2); // Eb5
    // Tension chord
    this.playTone(466, 0.25, 'sawtooth', 0.18, 0.32); // Bb4
    this.playTone(554, 0.25, 'sawtooth', 0.16, 0.32); // C#5
    this.playTone(698, 0.25, 'sawtooth', 0.14, 0.32); // F5
    // Ominous low rumble
    this.playTone(110, 0.4, 'sawtooth', 0.15, 0.5); // A2
    this.playTone(130, 0.4, 'sawtooth', 0.12, 0.55); // C3
  }
  
  // Strategic Review Open - thoughtful, contemplative
  playStrategicReview() {
    // Contemplative ascending pattern
    this.playTone(330, 0.15, 'sine', 0.18); // E4
    this.playTone(392, 0.15, 'sine', 0.18, 0.12); // G4
    this.playTone(494, 0.15, 'sine', 0.2, 0.24); // B4
    // Question/consideration tones
    this.playTone(523, 0.2, 'sine', 0.22, 0.4); // C5
    this.playTone(587, 0.2, 'sine', 0.2, 0.4); // D5
    // Suspenseful hold
    this.playTone(659, 0.3, 'sine', 0.18, 0.6); // E5
  }
  
  // Pivot Option Select - decisive click with anticipation
  playPivotSelect() {
    // Selection click
    this.playTone(600, 0.06, 'sine', 0.2);
    this.playTone(800, 0.08, 'sine', 0.22, 0.04);
    // Anticipation rise
    this.playTone(440, 0.12, 'sine', 0.18, 0.1); // A4
    this.playTone(523, 0.12, 'sine', 0.2, 0.18); // C5
    this.playTone(659, 0.15, 'sine', 0.22, 0.26); // E5
  }
  
  // Stakeholder Gathering - team assembly sound
  playStakeholderGather() {
    // Soft "people gathering" - warm harmonic build
    this.playTone(262, 0.15, 'sine', 0.15); // C4
    this.playTone(330, 0.15, 'sine', 0.15, 0.1); // E4
    this.playTone(392, 0.15, 'sine', 0.17, 0.2); // G4
    this.playTone(494, 0.15, 'sine', 0.17, 0.3); // B4
    // Collaborative chord
    this.playTone(523, 0.25, 'sine', 0.2, 0.45); // C5
    this.playTone(659, 0.25, 'sine', 0.18, 0.45); // E5
    this.playTone(784, 0.25, 'sine', 0.16, 0.45); // G5
  }
  
  // Milestone Selection in Pivot - choosing new direction
  playPivotMilestoneSelect() {
    // Target acquisition sound
    this.playTone(440, 0.08, 'triangle', 0.18); // A4
    this.playTone(554, 0.08, 'triangle', 0.2, 0.06); // C#5
    this.playTone(659, 0.1, 'triangle', 0.22, 0.12); // E5
    // Lock-on confirmation
    this.playTone(880, 0.15, 'sine', 0.25, 0.2); // A5
    this.playTone(1047, 0.12, 'sine', 0.2, 0.28); // C6
  }
  
  // Company Rename - transformation/rebrand sound
  playCompanyRename() {
    // Shimmer of change
    this.playTone(698, 0.1, 'sine', 0.15); // F5
    this.playTone(784, 0.1, 'sine', 0.17, 0.08); // G5
    this.playTone(880, 0.1, 'sine', 0.19, 0.16); // A5
    // Identity shift chord
    this.playTone(523, 0.2, 'sine', 0.2, 0.28); // C5
    this.playTone(659, 0.2, 'sine', 0.2, 0.28); // E5
    this.playTone(784, 0.2, 'sine', 0.2, 0.28); // G5
    // New beginning sparkle
    this.playTone(1047, 0.15, 'sine', 0.18, 0.45); // C6
    this.playTone(1319, 0.2, 'sine', 0.15, 0.52); // E6
    this.playTone(1568, 0.25, 'sine', 0.12, 0.6); // G6
  }
  
  // Compete Head-On - battle determination sound
  playCompeteHeadOn() {
    // War drum-like low tones
    this.playTone(110, 0.15, 'sawtooth', 0.2); // A2
    this.playTone(110, 0.15, 'sawtooth', 0.22, 0.18); // A2
    this.playTone(147, 0.12, 'sawtooth', 0.2, 0.32); // D3
    // Battle horn
    this.playTone(220, 0.1, 'sawtooth', 0.15, 0.42); // A3
    this.playTone(277, 0.1, 'sawtooth', 0.15, 0.48); // C#4
    this.playTone(330, 0.15, 'sawtooth', 0.18, 0.54); // E4
    // Determination chord
    this.playTone(440, 0.3, 'sawtooth', 0.15, 0.68); // A4
    this.playTone(554, 0.3, 'sawtooth', 0.13, 0.68); // C#5
    this.playTone(659, 0.3, 'sawtooth', 0.11, 0.68); // E5
  }
  
  // Pivot Complete - transformation success, new chapter begins
  playPivotComplete() {
    // Release of tension - minor to major shift
    this.playTone(392, 0.15, 'sine', 0.2); // G4
    this.playTone(466, 0.12, 'sine', 0.2, 0.1); // Bb4 (minor)
    this.playTone(494, 0.15, 'sine', 0.22, 0.2); // B4 (major resolution)
    // Hopeful ascending sequence
    this.playTone(523, 0.12, 'sine', 0.22, 0.35); // C5
    this.playTone(587, 0.12, 'sine', 0.22, 0.43); // D5
    this.playTone(659, 0.12, 'sine', 0.22, 0.51); // E5
    this.playTone(784, 0.15, 'sine', 0.24, 0.59); // G5
    // New beginning chord - bright and open
    this.playTone(523, 0.35, 'sine', 0.25, 0.75); // C5
    this.playTone(659, 0.35, 'sine', 0.23, 0.75); // E5
    this.playTone(784, 0.35, 'sine', 0.21, 0.75); // G5
    this.playTone(1047, 0.35, 'sine', 0.19, 0.75); // C6
    // Sparkle of possibility
    this.playTone(1319, 0.2, 'sine', 0.12, 1.0); // E6
    this.playTone(1568, 0.2, 'sine', 0.1, 1.1); // G6
    this.playTone(2093, 0.25, 'sine', 0.08, 1.2); // C7
  }
  
  // Team Member Profile Open - subtle "focus" sound
  playTeamFocus() {
    // Soft focus sound
    this.playTone(440, 0.1, 'sine', 0.15); // A4
    this.playTone(523, 0.12, 'sine', 0.18, 0.08); // C5
    this.playTone(659, 0.15, 'sine', 0.15, 0.16); // E5
  }
  
  // Competitor Intel - spy/intelligence reveal sound
  playCompetitorIntel() {
    // Mysterious reveal
    this.playTone(220, 0.1, 'triangle', 0.15); // A3
    this.playTone(277, 0.1, 'triangle', 0.15, 0.08); // C#4
    this.playTone(330, 0.12, 'triangle', 0.17, 0.16); // E4
    // Data processing blips
    this.playTone(800, 0.04, 'square', 0.1, 0.25);
    this.playTone(1000, 0.04, 'square', 0.1, 0.28);
    this.playTone(900, 0.04, 'square', 0.1, 0.31);
    // Intel acquired confirmation
    this.playTone(440, 0.15, 'sine', 0.2, 0.38); // A4
    this.playTone(554, 0.2, 'sine', 0.18, 0.45); // C#5
  }
  
  toggle() {
    this.enabled = !this.enabled;
    return this.enabled;
  }
}

const soundManager = new SoundManager();

// ===== UI EFFECTS HELPER =====
// Lightweight micro-animation utilities for game feel

const UIEffects = {
  // Configuration - tweak these to adjust animation feel
  config: {
    numberAnimationDuration: 400, // ms for number transitions
    toastDuration: 2500, // ms before toast fades out
    staggerDelay: 120, // ms between staggered reveals
    reducedMotion: window.matchMedia('(prefers-reduced-motion: reduce)').matches
  },
  
  // Track active number animations to cancel if needed
  activeAnimations: new Map(),
  
  // Initialize toast container
  init() {
    if (!document.getElementById('ui-toast-container')) {
      const container = document.createElement('div');
      container.id = 'ui-toast-container';
      container.className = 'ui-toast-container';
      document.body.appendChild(container);
    }
  },
  
  // Animate a number from old value to new value
  animateNumber(el, from, to, options = {}) {
    if (!el || this.config.reducedMotion) {
      if (el) el.textContent = options.formatter ? options.formatter(to) : to;
      return;
    }
    
    const duration = options.duration || this.config.numberAnimationDuration;
    const formatter = options.formatter || ((v) => Math.round(v));
    const elId = el.id || el;
    
    // Cancel any existing animation on this element
    if (this.activeAnimations.has(elId)) {
      cancelAnimationFrame(this.activeAnimations.get(elId));
    }
    
    const startTime = performance.now();
    const diff = to - from;
    
    const animate = (currentTime) => {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      
      // Ease-out cubic
      const eased = 1 - Math.pow(1 - progress, 3);
      const current = from + (diff * eased);
      
      el.textContent = formatter(current);
      
      if (progress < 1) {
        this.activeAnimations.set(elId, requestAnimationFrame(animate));
      } else {
        el.textContent = formatter(to);
        this.activeAnimations.delete(elId);
      }
    };
    
    this.activeAnimations.set(elId, requestAnimationFrame(animate));
  },
  
  // Add a class temporarily
  flashClass(el, className, duration = 400) {
    if (!el || this.config.reducedMotion) return;
    
    el.classList.add(className);
    setTimeout(() => el.classList.remove(className), duration);
  },
  
  // Stagger reveal elements
  staggerReveal(container, selector, options = {}) {
    if (!container || this.config.reducedMotion) {
      // If reduced motion, just show all immediately
      const elements = container.querySelectorAll(selector);
      elements.forEach(el => el.classList.add('revealed'));
      return Promise.resolve();
    }
    
    const delay = options.delay || this.config.staggerDelay;
    const elements = container.querySelectorAll(selector);
    
    return new Promise(resolve => {
      elements.forEach((el, i) => {
        setTimeout(() => {
          el.classList.add('revealed');
          if (i === elements.length - 1) {
            setTimeout(resolve, delay);
          }
        }, i * delay);
      });
      if (elements.length === 0) resolve();
    });
  },
  
  // Show a toast notification
  showToast(message, type = 'neutral', icon = '') {
    this.init();
    if (this.config.reducedMotion) return;
    
    const container = document.getElementById('ui-toast-container');
    const toast = document.createElement('div');
    toast.className = `ui-toast toast-${type}`;
    toast.innerHTML = `${icon ? `<span>${icon}</span>` : ''}<span>${message}</span>`;
    
    container.appendChild(toast);
    
    // Remove after duration
    setTimeout(() => {
      toast.classList.add('toast-out');
      setTimeout(() => toast.remove(), 250);
    }, this.config.toastDuration);
  },
  
  // Show KPI change toast
  showKPIChange(label, oldVal, newVal, options = {}) {
    const diff = newVal - oldVal;
    if (Math.abs(diff) < 0.1) return; // Skip tiny changes
    
    const formatter = options.formatter || ((v) => v.toFixed(1));
    const unit = options.unit || '';
    const isGood = options.isGood !== undefined ? options.isGood : diff > 0;
    
    const icon = isGood ? 'ğŸ“ˆ' : 'ğŸ“‰';
    const type = isGood ? 'good' : 'bad';
    const arrow = diff > 0 ? 'â†’' : 'â†’';
    
    this.showToast(
      `${label}: ${formatter(oldVal)}${unit} ${arrow} ${formatter(newVal)}${unit}`,
      type,
      icon
    );
  },
  
  // Apply selection animation to decision option
  animateSelection(optionEl, allOptions) {
    if (!optionEl || this.config.reducedMotion) return;
    
    // Pop the selected option
    this.flashClass(optionEl, 'ui-pop', 200);
    
    // Mark selected as locked-in
    optionEl.classList.add('locked-in');
    optionEl.classList.remove('locked-out');
    
    // Fade out other options
    allOptions.forEach(opt => {
      if (opt !== optionEl) {
        opt.classList.add('locked-out');
        opt.classList.remove('locked-in');
      }
    });
  },
  
  // Clear selection states
  clearSelectionStates(allOptions) {
    allOptions.forEach(opt => {
      opt.classList.remove('locked-in', 'locked-out');
    });
  },
  
  // Animate KPI element based on change direction
  animateKPI(el, direction) {
    if (!el || this.config.reducedMotion) return;
    
    if (direction > 0) {
      this.flashClass(el, 'ui-lift', 400);
      this.flashClass(el, 'ui-glow-good', 600);
    } else if (direction < 0) {
      this.flashClass(el, 'ui-shake', 350);
      this.flashClass(el, 'ui-glow-bad', 600);
    } else {
      this.flashClass(el, 'ui-pulse', 300);
    }
  }
};

// Initialize on load
document.addEventListener('DOMContentLoaded', () => UIEffects.init());

// ===== GAME CLASS =====

class Game {
  constructor() {
    this.turn = 1;
    this.company = null;
    this.location = null; // Selected city
    this.founder = null; // Player character
    this.funding = null;
    this.funder = null;
    this.fundingStage = null;
    // Multi-funder tracking: array of { funder, relationship, isLead }
    this.investors = [];
    this.funderAdvices = []; // Current quarter's advice from all funders
    this.hiringStep = 0; // Wizard step for hiring modal
    this.team = { research: null, dev: null, marketing: null, hr: null };
    this.hiredStaff = []; // Staff hired via job posting system
    this.selectedFireStaffId = null; // Selected staff for layoff
    this.hiringDisruption = {}; // Tracks department disruption from recent hires
    this.currentJobPosting = null; // Active job posting
    this.currentCandidates = []; // Current candidates for review
    this.negotiatingCandidate = null; // Candidate being negotiated with
    this.jobPostingAPCost = 0; // AP spent on job postings this quarter (legacy, now calculated from hiredStaff)
    this.moods = { research: 1, dev: 1, marketing: 1, hr: 1 };
    // Starting metrics boosted for better early game balance
    this.metrics = { cash: 0, val: 0, equity: 100, staff: 0, burn: 0, sci: 15, dev: 15, mkt: 15, hr: 50 };
    this.maxAP = 5;
    this.bankedAP = 0; // Carryover AP from previous quarters (max 2)
    this.maxBankedAP = 2; // Cap on how much can be banked
    // Staffing system
    this.integratingStaff = 0; // Staff hired this quarter (still integrating)
    this.staffAPPenalty = 0; // AP penalty from integrating staff this quarter
    this.hiresThisQuarter = 0; // Track hires this quarter (max 2)
    this.hiresPreviousQuarter = 0; // Track if previous quarter had heavy hiring
    this.startingStaff = 0; // Founding team size - only hires ABOVE this count toward AP bonus
    this.fundingAPCost = 0; // AP cost from fundraising this quarter
    this.milestone = null;
    this.milestoneProgress = 0;
    this.completedMilestones = [];
    this.rivals = [];
    this.market = MARKETS.find(m => m.id === "stable");
    this.currentDomain = "research";
    this.choices = {};
    this.equityGrants = [];
    this.currentEvents = {}; // Track which event each exec is presenting this quarter
    this.usedEvents = new Set(); // Track which events have been used
    this.lastRaiseMilestoneCount = -1; // Can raise once before first milestone
    // Shock event tracking
    this.usedShocks = new Set(); // Track which shocks have occurred
    this.pendingShock = null; // Currently displayed shock
    // Strategic pivot tracking
    this.pendingMarketShift = null; // Rival that triggered market shift
    this.pivotState = {
      mode: null, // 'strategic' or 'forced'
      selectedPivotType: null,
      selectedMilestone: null,
      selectedNameOption: null,
      triggeringRival: null,
      currentPivotData: null,
      currentMilestoneData: null
    };
    // Conference mini-game tracking
    this.conferencesAttended = 0; // How many conferences attended
    this.lastConferenceMilestone = 0; // Which milestone we last had a conference for
    // Extreme mode - harder difficulty with less information
    this.extremeMode = false;
    // Tutorial type - 'beginner' or 'experienced'
    this.tutorialType = 'experienced';
    // Volatility system - adds randomness to outcomes
    this.baseVolatility = 0.15; // 15% variance in normal mode
    this.extremeVolatility = 0.20; // 20% variance in extreme mode
    // Journey tracking for narrative case study
    this.journeyEvents = []; // All significant events
    this.quarterSummaries = []; // Summary of each quarter's decisions
    this.peakValuation = 0; // Highest valuation reached
    this.lowestCash = Infinity; // Lowest cash point
    this.funderAdviceFollowed = 0; // Times player followed funder advice
    this.funderAdviceIgnored = 0; // Times player ignored funder advice
    this.domainInvestments = { research: 0, dev: 0, marketing: 0, hr: 0 }; // AP spent per domain
    this.aggressiveChoices = 0; // High-risk/high-reward choices
    this.conservativeChoices = 0; // Safe/steady choices
    
    // === INVESTOR RELATIONSHIP SYSTEM ===
    // 0: Skeptical, 1: Neutral, 2: Supportive, 3: Champion
    this.investorRelationship = 1; // Start at Neutral
    this.lastRelationshipChange = 0; // Track when relationship last changed
    
    // === UI EFFECTS: Previous KPI values for animated transitions ===
    this.previousMetrics = {
      cash: null,
      burn: null,
      runway: null,
      equity: null,
      valuation: null,
      revenue: null
    };
    
    // === CHAPTER/PACING SYSTEM ===
    this.currentChapter = 1; // Tracks which chapter we're in
    this.chaptersShown = new Set(); // Track which chapter intros we've shown
    
    // Pass/skip tracking for disengaged play detection
    this.totalPasses = 0; // Total passes across all quarters
    this.consecutiveHighPassQuarters = 0; // Quarters in a row with 3+ passes
    this.passWarningShown = false; // Whether we've warned the player
    
    // === STRATEGIC FOCUS SYSTEM ===
    // Tracks whether player is spreading AP too thin
    this.focusTracking = {
      consecutiveSpreadQuarters: 0, // Quarters in a row with even spread
      totalSpreadQuarters: 0,       // Total spread quarters across game
      lastQuarterFocused: true,     // Was last quarter focused?
      spreadEventsTriggered: [],    // Which drift events have fired
      currentEfficiencyMultiplier: 1.0 // Applied to this quarter's effects
    };
    
    // === HASTY DECISION SYSTEM ===
    // Tracks decision timing to discourage click-through behavior
    this.decisionTiming = {
      currentEventShownAt: null,       // Timestamp when current event was rendered
      currentDomain: null,             // Which domain's event is showing
      hastyDecisionsThisQuarter: 0,    // Count of hasty decisions this quarter
      hastyDecisionsTotal: 0,          // Lifetime hasty decisions
      thoughtfulDecisionsTotal: 0,     // Lifetime thoughtful decisions
      hastyChoicesThisQuarter: [],     // Track which domains had hasty choices
      rushedLeadershipTriggered: false // Whether we've triggered the big event
    };
    
    // === CEO STRATEGIC FOCUS ===
    // Player's meta-choice each quarter that biases outcomes
    this.strategicFocus = null; // 'growth', 'efficiency', 'innovation', 'fundraising'
    this.focusHistory = []; // Track what focus was chosen each quarter
    this.STRATEGIC_FOCUSES = {
      growth: {
        name: 'Growth Mode',
        icon: 'ğŸš€',
        desc: 'Prioritize speed and market expansion',
        bonus: { mkt: 1.15, dev: 1.05 },
        penalty: { burn: 1.1 },
        color: 'emerald'
      },
      efficiency: {
        name: 'Lean Operations',
        icon: 'âš¡',
        desc: 'Optimize costs and extend runway',
        bonus: { burnReduction: 0.9 },
        penalty: { mkt: 0.9, dev: 0.95 },
        color: 'amber'
      },
      innovation: {
        name: 'R&D Focus',
        icon: 'ğŸ”¬',
        desc: 'Double down on research breakthroughs',
        bonus: { sci: 1.2 },
        penalty: { mkt: 0.85 },
        color: 'indigo'
      },
      fundraising: {
        name: 'Investor Relations',
        icon: 'ğŸ’¼',
        desc: 'Polish metrics and narratives for raising',
        bonus: { valMultiplier: 1.05, investorRel: 0.1 },
        penalty: { sci: 0.9, dev: 0.95 },
        color: 'violet'
      }
    };
    
    // === PROGRESSION UNLOCKS ===
    // Track achievements that unlock new capabilities
    this.unlocks = {
      firstCustomer: false,        // Unlock pricing experiments
      firstRevenue: false,         // Unlock revenue projections view
      seriesA: false,              // Unlock enterprise sales path
      publishedPaper: false,       // Hiring boost, credibility
      productMarketFit: false,     // Unlock growth experiments
      profitability: false,        // Unlock dividend option
      teamOf10: false,             // Unlock org structure choices
      internationalCustomer: false // Unlock market expansion
    };
    this.unlockNotifications = []; // Queue of unlocks to show
    
    // === INTERESTING FAILURE STATES ===
    // Instead of instant game over, offer dramatic choices
    this.failureState = null; // 'runway_crisis', 'milestone_failed', 'team_collapse'
    this.crisisOptions = null; // Available crisis resolution options
    
    // === REVENUE SYSTEM ===
    this.revenueModel = null;           // Set when company selected
    this.customers = [];                 // Array of customer objects
    this.pipeline = [];                  // Deals in progress (for B2B models)
    this.grantApplications = [];         // Pending grant applications
    this.quarterlyRevenue = 0;           // Calculated each quarter
    this.quarterlySupportCosts = 0;      // Calculated each quarter
    this.projectionDifficulty = null;    // 'conservative', 'balanced', 'ambitious' - set by milestone choice
    this.revenueHistory = [];            // Track actual ARR each quarter for projections
    this.usedRevenueEvents = new Set();  // Track which revenue events used
    
    this.init();
  }

  // Apply volatility to an effect value
  // For research, uses skewed distribution with higher upside potential
  applyVolatility(baseValue, isResearch = false) {
    if (baseValue === 0) return 0;
    
    // Milestone-based volatility scaling
    // M1: Higher volatility (early stage uncertainty)
    // M2: Medium volatility
    // M3: Lower volatility (more mature/predictable)
    const milestoneCount = this.completedMilestones?.length || 0;
    let milestoneMultiplier;
    if (milestoneCount === 0) {
      milestoneMultiplier = 1.5; // 50% more volatile during M1
    } else if (milestoneCount === 1) {
      milestoneMultiplier = 1.2; // 20% more volatile during M2
    } else {
      milestoneMultiplier = 1.0; // Normal volatility during M3
    }
    
    const baseVolatility = this.extremeMode ? this.extremeVolatility : this.baseVolatility;
    const volatility = baseVolatility * milestoneMultiplier;
    
    let adjusted;
    
    if (isResearch && baseValue > 0) {
      // Research has skewed distribution: more upside potential, some downside risk
      // During M1, research is even MORE volatile with bigger swings
      const roll = Math.random();
      
      // M1 has enhanced breakthrough chances (12%) and setback chances (12%)
      const breakthroughChance = milestoneCount === 0 ? 0.12 : 0.10;
      const strongChance = milestoneCount === 0 ? 0.27 : 0.25;
      const normalChance = milestoneCount === 0 ? 0.65 : 0.70;
      const disappointChance = milestoneCount === 0 ? 0.88 : 0.90;
      
      if (roll < breakthroughChance) {
        // Breakthrough! +50% to +120% bonus (bigger during M1)
        const maxBonus = milestoneCount === 0 ? 1.2 : 1.0;
        const breakthroughBonus = 0.5 + Math.random() * (maxBonus - 0.5);
        adjusted = baseValue * (1 + breakthroughBonus);
      } else if (roll < strongChance) {
        // Strong result +20% to +50%
        const strongBonus = 0.2 + Math.random() * 0.3;
        adjusted = baseValue * (1 + strongBonus);
      } else if (roll < normalChance) {
        // Normal variance (Â±volatility)
        const variance = (Math.random() * 2 - 1) * volatility;
        adjusted = baseValue * (1 + variance);
      } else if (roll < disappointChance) {
        // Disappointing -10% to -35% (worse during M1)
        const maxDisappointment = milestoneCount === 0 ? 0.35 : 0.30;
        const disappointment = 0.1 + Math.random() * (maxDisappointment - 0.1);
        adjusted = baseValue * (1 - disappointment);
      } else {
        // Setback -30% to -60% (worse during M1)
        const maxSetback = milestoneCount === 0 ? 0.6 : 0.5;
        const setback = 0.3 + Math.random() * (maxSetback - 0.3);
        adjusted = baseValue * (1 - setback);
      }
    } else {
      // Standard symmetric volatility for non-research (still milestone-scaled)
      const variance = (Math.random() * 2 - 1) * volatility;
      adjusted = baseValue * (1 + variance);
    }
    
    // Round to nearest integer, but preserve sign and ensure at least Â±1 for non-zero base
    if (baseValue > 0) {
      return Math.max(1, Math.round(adjusted));
    } else {
      return Math.min(-1, Math.round(adjusted));
    }
  }

  init() {
    // Venture selection
    const vg = document.getElementById("ventureGrid");
    vg.innerHTML = COMPANIES.map(c => `
      <button data-id="${c.id}" class="hire-card border-2 border-slate-200 rounded-xl p-5 text-left bg-white hover:border-[${c.color}]">
        <div class="flex items-start gap-3 mb-2">
          <div class="w-12 h-12 flex-shrink-0">${LOGOS[c.id]}</div>
          <div>
            <div class="text-xs text-slate-500 uppercase tracking-wide">${c.archetype}</div>
            <div class="text-lg font-bold text-slate-800">${c.name}</div>
          </div>
        </div>
        <p class="text-sm text-slate-600">${c.desc}</p>
      </button>
    `).join("");
    vg.querySelectorAll("button").forEach(b => b.onclick = () => this.selectVenture(b.dataset.id));

    // Funding stage selection
    this.renderFundingStages();

    // Buttons
    document.getElementById("commitBtn").onclick = () => this.tryCommitTurn();
    document.getElementById("hireBtn").onclick = () => this.showJobPostModal();
    document.getElementById("fireBtn").onclick = () => this.showFireStaffModal();
    document.getElementById("achievedContinueBtn").onclick = () => this.onMilestoneAchieved();
  }

  startFromPreamble() {
    // Hide preambles, show founder selection FIRST
    document.getElementById("preambleModal1").classList.add("hidden");
    document.getElementById("preambleModal2").classList.add("hidden");
    document.getElementById("preambleModal2").classList.remove("flex");
    
    // Show founder modal first (before venture)
    this.showFounderModal();
  }

  showPreamblePage2() {
    document.getElementById("preambleModal1").classList.add("hidden");
    document.getElementById("preambleModal2").classList.remove("hidden");
    document.getElementById("preambleModal2").classList.add("flex");
  }

  backToPreamble1() {
    document.getElementById("preambleModal2").classList.add("hidden");
    document.getElementById("preambleModal2").classList.remove("flex");
    document.getElementById("preambleModal1").classList.remove("hidden");
    document.getElementById("preambleModal1").classList.add("flex");
  }

  // ===== HELP SYSTEM =====
  
  showHelpModal() {
    document.getElementById("helpModal").classList.remove("hidden");
    document.getElementById("helpModal").classList.add("flex");
    this.showHelpTab('overview');
    soundManager.playClick();
  }
  
  closeHelpModal() {
    document.getElementById("helpModal").classList.add("hidden");
    document.getElementById("helpModal").classList.remove("flex");
    soundManager.playClick();
  }
  
  showHelpTab(tabId) {
    // Hide all content
    document.querySelectorAll('.help-content').forEach(el => el.classList.add('hidden'));
    // Show selected content
    const content = document.getElementById(`helpContent-${tabId}`);
    if (content) content.classList.remove('hidden');
    
    // Update tab styling
    document.querySelectorAll('.help-tab').forEach(tab => {
      tab.classList.remove('text-indigo-600', 'border-indigo-600');
      tab.classList.add('text-slate-600', 'border-transparent');
    });
    const activeTab = document.querySelector(`.help-tab[data-tab="${tabId}"]`);
    if (activeTab) {
      activeTab.classList.remove('text-slate-600', 'border-transparent');
      activeTab.classList.add('text-indigo-600', 'border-indigo-600');
    }
  }
  
  // Mobile sidebar toggle
  toggleMobileSidebar() {
    const sidebar = document.getElementById('mobileSidebar');
    const toggle = document.getElementById('mobileStatsToggle');
    if (sidebar.classList.contains('hidden')) {
      sidebar.classList.remove('hidden');
      sidebar.classList.add('fixed', 'inset-0', 'z-40', 'bg-slate-100', 'overflow-y-auto', 'p-4');
      toggle.innerHTML = 'âœ•';
      toggle.title = 'Close Stats';
    } else {
      sidebar.classList.add('hidden');
      sidebar.classList.remove('fixed', 'inset-0', 'z-40', 'bg-slate-100', 'overflow-y-auto', 'p-4');
      toggle.innerHTML = 'ğŸ“Š';
      toggle.title = 'Show Stats';
    }
  }
  
  showHelp(topic) {
    // Open help modal and navigate to relevant tab
    this.showHelpModal();
    
    // Map topics to tabs
    const topicToTab = {
      'quarter': 'overview',
      'cash': 'money',
      'runway': 'money',
      'valuation': 'money',
      'milestones': 'milestones',
      'ap': 'ap',
      'team': 'team',
      'staff': 'team'
    };
    
    const tab = topicToTab[topic] || 'overview';
    this.showHelpTab(tab);
  }

  // ===== TUTORIAL SYSTEM (Menu-Based) =====
  
  // Topic content for the new menu-based tutorial
  tutorialTopics = {
    goals: {
      icon: 'ğŸ¯',
      title: 'Goals & Victory',
      subtitle: 'How to win (and lose) the game',
      color: 'from-indigo-500 to-blue-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600">In this game, you'll run an AI startup for <strong>16 quarters (4 years)</strong>. Your goal is to complete <strong>3 major milestones</strong> before running out of money or time.</p>
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-emerald-50 rounded-xl p-4 border-2 border-emerald-200">
              <div class="text-2xl text-center mb-2">ğŸ†</div>
              <div class="font-bold text-emerald-800 text-center text-sm">YOU WIN</div>
              <p class="text-emerald-700 text-xs text-center mt-1">Complete all 3 milestones before Q16</p>
            </div>
            <div class="bg-rose-50 rounded-xl p-4 border-2 border-rose-200">
              <div class="text-2xl text-center mb-2">ğŸ’€</div>
              <div class="font-bold text-rose-800 text-center text-sm">YOU LOSE</div>
              <ul class="text-rose-700 text-xs mt-1 space-y-1">
                <li>â€¢ Cash hits Â£0</li>
                <li>â€¢ Miss a milestone deadline</li>
              </ul>
            </div>
          </div>
          <div class="bg-amber-50 rounded-lg p-3">
            <p class="text-amber-800 text-sm"><strong>â° Time Pressure:</strong> Each milestone has a deadline. Miss it and the board loses confidence.</p>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <p class="text-slate-600">Your <strong>valuation</strong> grows as you hit milestonesâ€”this affects fundraising terms and your final score.</p>
          <p class="text-slate-600">You're racing against <strong>3 rival startups</strong>. If they complete milestones before you, you may need to pivot your strategy.</p>
          <p class="text-slate-600">90% of real startups fail. Don't be discouraged if your first attempt doesn't succeedâ€”learning from failure is part of the game!</p>
          <div class="bg-purple-50 rounded-lg p-3 mt-3">
            <p class="text-purple-700 text-sm"><strong>ğŸ”„ Remember:</strong> If things aren't working, you can pivot to a new direction. Pivoting isn't failureâ€”it's how startups find success.</p>
          </div>
        </div>
      `
    },
    ap: {
      icon: 'AP',
      iconStyle: 'text-white text-sm font-black',
      title: 'Attention Points',
      subtitle: 'Your most precious resource',
      color: 'from-emerald-500 to-teal-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600"><strong>Attention Points (AP)</strong> represent your focus as CEO. You can't do everythingâ€”choose wisely!</p>
          <div class="bg-emerald-50 rounded-xl p-4 text-center">
            <div class="text-4xl font-black text-emerald-600 mb-1">5 AP</div>
            <p class="text-emerald-700 text-sm">per quarter</p>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-slate-50 rounded-lg p-3">
              <div class="font-bold text-slate-700 text-sm mb-1">ğŸ’¾ Banking AP</div>
              <p class="text-xs text-slate-600">Unused AP (up to 2) carries to next quarter. Save up for crucial moments!</p>
            </div>
            <div class="bg-slate-50 rounded-lg p-3">
              <div class="font-bold text-slate-700 text-sm mb-1">ğŸ¯ Spending AP</div>
              <p class="text-xs text-slate-600">Actions cost 1-3 AP. High-impact moves cost more.</p>
            </div>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <p class="text-slate-600">Each quarter, your <strong>executives present options</strong>. The Head of Research, Product, and Sales each bring 2 choices aligned with their expertise.</p>
          <div class="bg-blue-50 rounded-lg p-3">
            <p class="text-blue-700"><strong>ğŸ’¡ Pro Tip:</strong> If you bank AP strategically, you can have 6-7 AP for a critical quarterâ€”enough for multiple high-impact moves at once!</p>
          </div>
          <p class="text-slate-600">Some activities cost more AP because they require significant CEO attention: major pivots, fundraising, and crisis management.</p>
          <p class="text-slate-600">Balance quick wins (1 AP tactical moves) with strategic investments (2-3 AP transformative actions).</p>
        </div>
      `
    },
    milestones: {
      icon: 'ğŸ†',
      title: 'Milestones',
      subtitle: 'Your path to victory',
      color: 'from-amber-500 to-orange-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600">Each milestone requires you to build up <strong>specific stats</strong>. The milestone tracker shows your progress:</p>
          <div class="bg-slate-100 rounded-xl p-4">
            <div class="flex items-center justify-between mb-2">
              <span class="font-bold text-slate-700">First Prototype</span>
              <span class="text-amber-600 font-bold">65%</span>
            </div>
            <div class="h-4 bg-white rounded-full overflow-hidden border">
              <div class="h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full" style="width: 65%"></div>
            </div>
            <div class="mt-2 text-xs text-slate-500">Focus: Research + Product â€¢ Deadline: Q4</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-emerald-50 rounded-lg p-3">
              <div class="font-bold text-emerald-800 text-sm">âœ… Hit 100%</div>
              <p class="text-emerald-700 text-xs">Milestone complete! +Valuation, new sales leads, better close rates</p>
            </div>
            <div class="bg-rose-50 rounded-lg p-3">
              <div class="font-bold text-rose-800 text-sm">âŒ Miss Deadline</div>
              <p class="text-rose-700 text-xs">Game over. The board loses confidence.</p>
            </div>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <div class="space-y-2">
            <div class="flex items-center justify-between bg-emerald-50 rounded-lg p-3">
              <span class="font-medium">M1: First Prototype</span>
              <span class="text-emerald-600 text-xs">Build core technology</span>
            </div>
            <div class="flex items-center justify-between bg-amber-50 rounded-lg p-3">
              <span class="font-medium">M2: Market Validation</span>
              <span class="text-amber-600 text-xs">Prove customer demand</span>
            </div>
            <div class="flex items-center justify-between bg-violet-50 rounded-lg p-3">
              <span class="font-medium">M3: Scale & Exit</span>
              <span class="text-violet-600 text-xs">Grow to acquisition/IPO</span>
            </div>
          </div>
          <div class="bg-blue-50 rounded-lg p-3">
            <h4 class="font-bold text-blue-800 mb-1">ğŸ Milestone Rewards</h4>
            <ul class="text-blue-700 text-xs space-y-1">
              <li>â€¢ <strong>Valuation boost</strong> - worth more to investors</li>
              <li>â€¢ <strong>New sales leads</strong> - customers reach out to you</li>
              <li>â€¢ <strong>Lower churn</strong> - customers stick around longer</li>
              <li>â€¢ <strong>Better close rates</strong> - easier to convert pipeline</li>
            </ul>
          </div>
          <p class="text-slate-600">Complete milestones <strong>before rivals</strong> for first-mover bonuses!</p>
        </div>
      `
    },
    competition: {
      icon: 'âš”ï¸',
      title: 'Competition',
      subtitle: 'Race against 3 rival startups',
      color: 'from-pink-500 to-rose-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600">You're not alone! <strong>3 rival startups</strong> in your sector are racing toward the same milestones.</p>
          <div class="bg-slate-100 rounded-xl p-4">
            <div class="text-center mb-3 text-sm font-medium text-slate-700">Competitor Leaderboard</div>
            <div class="space-y-2">
              <div class="flex items-center justify-between bg-white p-2 rounded-lg border border-emerald-200">
                <span class="text-sm font-medium">ğŸ¥‡ You (hopefully!)</span>
                <span class="text-emerald-600 text-xs font-medium">M1: 65%</span>
              </div>
              <div class="flex items-center justify-between bg-white p-2 rounded-lg">
                <span class="text-sm text-slate-600">ğŸ¥ˆ NeuralTech AI</span>
                <span class="text-slate-500 text-xs">M1: 52%</span>
              </div>
              <div class="flex items-center justify-between bg-white p-2 rounded-lg">
                <span class="text-sm text-slate-600">ğŸ¥‰ DataMind Labs</span>
                <span class="text-slate-500 text-xs">M1: 38%</span>
              </div>
            </div>
          </div>
          <div class="bg-rose-50 rounded-lg p-3">
            <p class="text-rose-800 text-sm">âš ï¸ <strong>If rivals complete a milestone first</strong>, you'll face a Market Shiftâ€”a forced strategic decision!</p>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <p class="text-slate-600"><strong>Click competitor names</strong> in the game to see detailed intelligence: their strategies, funding status, strengths, and weaknesses.</p>
          <div class="bg-emerald-50 rounded-lg p-3">
            <p class="text-emerald-700"><strong>ğŸ† First-Mover Bonus:</strong> Complete a milestone before all rivals for a valuation boost and extra sales leads!</p>
          </div>
          <p class="text-slate-600">Rivals aren't just threatsâ€”they're <strong>information</strong>. Their moves reveal market dynamics. Sometimes the best response isn't to race harder, but to change direction entirely.</p>
          <div class="bg-purple-50 rounded-lg p-3">
            <p class="text-purple-700"><strong>ğŸ”„ When rivals get ahead:</strong> You'll face a Market Shift event. You can compete head-on, or pivot to a new strategic direction where you have an advantage.</p>
          </div>
        </div>
      `
    },
    pivots: {
      icon: 'ğŸ”„',
      title: 'Strategic Pivots',
      subtitle: 'Change direction when needed',
      color: 'from-purple-500 to-violet-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600">Sometimes the best path forward is a <strong>new direction</strong>. The pivot system lets you change your company's strategic focus.</p>
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-violet-50 rounded-xl p-4 border border-violet-200">
              <div class="font-bold text-violet-800 text-sm mb-2">ğŸ”„ Strategic Review</div>
              <p class="text-violet-700 text-xs">Proactive choice when you're struggling or see a better opportunity. Available after M1.</p>
            </div>
            <div class="bg-rose-50 rounded-xl p-4 border border-rose-200">
              <div class="font-bold text-rose-800 text-sm mb-2">âš ï¸ Market Shift</div>
              <p class="text-rose-700 text-xs">Forced response when a competitor completes their milestone before you.</p>
            </div>
          </div>
          <div class="bg-slate-50 rounded-xl p-4">
            <h4 class="font-bold text-slate-800 text-sm mb-2">Pivot Options</h4>
            <div class="grid grid-cols-2 gap-2 text-sm">
              <div class="flex items-center gap-2"><span class="text-violet-600">ğŸ¯</span> <span><strong>Customer</strong> - sell to different buyers</span></div>
              <div class="flex items-center gap-2"><span class="text-amber-600">ğŸ’¡</span> <span><strong>Problem</strong> - solve different pain point</span></div>
              <div class="flex items-center gap-2"><span class="text-rose-600">ğŸ”§</span> <span><strong>Tech</strong> - build it differently</span></div>
              <div class="flex items-center gap-2"><span class="text-emerald-600">ğŸ¯</span> <span><strong>Niche</strong> - become the specialist</span></div>
            </div>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <div class="bg-emerald-50 rounded-lg p-3">
            <h4 class="font-bold text-emerald-800 mb-1">âœ… What You Keep</h4>
            <p class="text-emerald-700">Some progress carries overâ€”you're not starting from zero. Your research, technology foundation, and team capabilities have value in new directions.</p>
          </div>
          <div class="bg-amber-50 rounded-lg p-3">
            <h4 class="font-bold text-amber-800 mb-1">ğŸ’° What It Costs</h4>
            <ul class="text-amber-700 space-y-1">
              <li>â€¢ Transition costs: Â£20k-Â£50k depending on pivot type</li>
              <li>â€¢ Time to reach new milestone target</li>
              <li>â€¢ Some pipeline and market progress is lost</li>
            </ul>
          </div>
          <div class="bg-blue-50 rounded-lg p-3">
            <h4 class="font-bold text-blue-800 mb-1">ğŸ·ï¸ Company Rebranding</h4>
            <p class="text-blue-700">You can rename your company to match your new directionâ€”a fresh identity for a fresh start.</p>
          </div>
          <div class="bg-slate-100 rounded-lg p-3">
            <h4 class="font-bold text-slate-800 mb-1">âš”ï¸ "Compete Head-On" Option</h4>
            <p class="text-slate-600">Don't want to pivot? You can stay the course, but you'll take a <strong>-20% valuation hit</strong> as the market questions your competitiveness.</p>
          </div>
        </div>
      `
    },
    cash: {
      icon: 'ğŸ’·',
      title: 'Cash & Runway',
      subtitle: 'Stay alive long enough to win',
      color: 'from-rose-500 to-red-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600">Every quarter, you pay salaries and costs. This is your <strong>burn rate</strong>. When cash hits zero, it's game over.</p>
          <div class="bg-slate-800 text-white rounded-xl p-4">
            <div class="grid grid-cols-3 gap-4 text-center">
              <div>
                <div class="text-emerald-400 text-2xl font-bold">Â£450k</div>
                <div class="text-slate-400 text-xs">Cash</div>
              </div>
              <div>
                <div class="text-rose-400 text-2xl font-bold">Â£90k/q</div>
                <div class="text-slate-400 text-xs">Burn Rate</div>
              </div>
              <div>
                <div class="text-amber-400 text-2xl font-bold">5q</div>
                <div class="text-slate-400 text-xs">Runway</div>
              </div>
            </div>
          </div>
          <div class="bg-blue-50 rounded-lg p-3">
            <p class="text-blue-800 text-sm"><strong>ğŸ’¡ Runway = Cash Ã· (Burn - Revenue)</strong></p>
            <p class="text-blue-700 text-xs mt-1">Revenue from customers offsets burn. Build enough revenue and you're profitable!</p>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <div class="flex items-center gap-1 mb-2">
            <div class="flex-1 h-8 bg-rose-500 rounded-l-lg flex items-center justify-center text-white text-xs font-bold">1-2q ğŸ˜°</div>
            <div class="flex-1 h-8 bg-amber-500 flex items-center justify-center text-white text-xs font-bold">3-4q ğŸ˜Ÿ</div>
            <div class="flex-1 h-8 bg-emerald-500 rounded-r-lg flex items-center justify-center text-white text-xs font-bold">5+q ğŸ˜Š</div>
          </div>
          <div class="bg-emerald-50 rounded-lg p-3">
            <h4 class="font-bold text-emerald-800 mb-1">ğŸ“Š Finance Panel</h4>
            <p class="text-emerald-700">Click the finance card in the sidebar to see detailed projections, revenue targets, and a what-if forecast tool!</p>
          </div>
          <div class="bg-amber-50 rounded-lg p-3">
            <h4 class="font-bold text-amber-800 mb-1">âš ï¸ What Increases Burn?</h4>
            <ul class="text-amber-700 space-y-1">
              <li>â€¢ Executive salaries (higher-skilled execs cost more)</li>
              <li>â€¢ Staff count (each hire adds to burn)</li>
              <li>â€¢ Location (London is 20-30% more expensive!)</li>
            </ul>
          </div>
          <div class="bg-rose-50 rounded-lg p-3">
            <p class="text-rose-700"><strong>âš ï¸ Danger Zone:</strong> If runway drops below 3 quarters, start raising funding immediately!</p>
          </div>
        </div>
      `
    },
    team: {
      icon: 'ğŸ‘¥',
      title: 'Your Team',
      subtitle: 'Executives and morale',
      color: 'from-blue-500 to-indigo-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600">You'll hire three executives at the start, each leading a department:</p>
          <div class="grid grid-cols-3 gap-3">
            <div class="bg-emerald-50 rounded-xl p-3 text-center">
              <div class="text-2xl mb-1">ğŸ”¬</div>
              <div class="font-bold text-slate-800 text-sm">Research</div>
              <div class="text-xs text-slate-500">Boosts Science</div>
            </div>
            <div class="bg-sky-50 rounded-xl p-3 text-center">
              <div class="text-2xl mb-1">ğŸ’»</div>
              <div class="font-bold text-slate-800 text-sm">Product</div>
              <div class="text-xs text-slate-500">Boosts Dev</div>
            </div>
            <div class="bg-fuchsia-50 rounded-xl p-3 text-center">
              <div class="text-2xl mb-1">ğŸ“£</div>
              <div class="font-bold text-slate-800 text-sm">Sales</div>
              <div class="text-xs text-slate-500">Boosts Marketing</div>
            </div>
          </div>
          <div class="bg-amber-50 rounded-xl p-4">
            <h4 class="font-bold text-amber-800 mb-2">ğŸ˜Š Team Morale Matters!</h4>
            <p class="text-amber-700 text-sm">Happy execs bring better opportunities; frustrated execs bring problems.</p>
            <div class="flex justify-center gap-2 mt-3">
              <span class="px-2 py-1 bg-emerald-200 rounded text-xs">ğŸ˜Š Better</span>
              <span class="px-2 py-1 bg-slate-200 rounded text-xs">ğŸ˜ Random</span>
              <span class="px-2 py-1 bg-amber-200 rounded text-xs">ğŸ˜Ÿ Problems</span>
              <span class="px-2 py-1 bg-rose-200 rounded text-xs">ğŸ˜  Tough</span>
            </div>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <div class="bg-pink-50 rounded-lg p-3">
            <h4 class="font-bold text-pink-800 mb-1">ğŸ’¼ Head of HR (Unlocked after M1)</h4>
            <p class="text-pink-700">After completing your first milestone, the board insists you hire a Head of HRâ€”a fourth executive bringing HR-focused options.</p>
          </div>
          <div class="bg-blue-50 rounded-lg p-3">
            <h4 class="font-bold text-blue-800 mb-1">ğŸ¯ The Talent War</h4>
            <p class="text-blue-700">AI talent is expensive and scarce. Pay top-of-market and strain runway? Offer equity that might be worthless? Compete with big tech on compensation?</p>
          </div>
          <div class="bg-amber-50 rounded-lg p-3">
            <h4 class="font-bold text-amber-800 mb-1">ğŸŒ Visas & Immigration</h4>
            <p class="text-amber-700">Many candidates need visa sponsorship. Becoming a sponsor means compliance, record-keeping, and audits.</p>
          </div>
          <p class="text-slate-600">Executives cost <strong>salary + equity</strong>. Better execs cost more but bring stronger capabilities. You can replace executives if needed (costs time).</p>
        </div>
      `
    },
    funding: {
      icon: 'ğŸ¦',
      title: 'Fundraising',
      subtitle: 'Investors and dilution',
      color: 'from-violet-500 to-purple-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600">Fundraising is a <strong>big part of the founder's job</strong>. Money brings runway, but also stringsâ€”investors want returns.</p>
          <div class="bg-violet-50 rounded-lg p-3">
            <h4 class="font-bold text-violet-800 text-sm mb-2">ğŸ‘¥ Types of Investors</h4>
            <ul class="text-violet-700 text-xs space-y-1">
              <li><strong>Angels:</strong> Smaller cheques, flexible terms, varied experience</li>
              <li><strong>VCs:</strong> Larger amounts, more structure, board seats</li>
              <li><strong>Corporate VCs:</strong> Strategic interest, can open doorsâ€”but may limit options</li>
            </ul>
          </div>
          <div class="bg-amber-50 rounded-lg p-3">
            <p class="text-amber-800 text-sm"><strong>âš ï¸ One Raise Per Milestone</strong> (Costs 1 AP)</p>
            <p class="text-amber-700 text-xs mt-1">Plan carefullyâ€”you need enough cash to reach the next milestone.</p>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <div class="bg-emerald-50 rounded-lg p-3">
            <h4 class="font-bold text-emerald-800 mb-1">ğŸ¥§ Dilution Isn't Always Bad</h4>
            <p class="text-emerald-700">Giving up equity feels painful, but successful founders often own small percentages of valuable companies. <strong>A small slice of a big pie is worth more than a large slice of a small pie.</strong></p>
          </div>
          <div class="bg-blue-50 rounded-lg p-3">
            <h4 class="font-bold text-blue-800 mb-1">ğŸ’¡ Higher Valuation = Less Dilution</h4>
            <p class="text-blue-700">At Â£1M valuation, raising Â£200k costs 20% equity. At Â£2M valuation, same Â£200k only costs 10%!</p>
          </div>
          <div class="bg-slate-50 rounded-lg p-3">
            <h4 class="font-bold text-slate-700 mb-1">â±ï¸ The Fundraising Game</h4>
            <p class="text-slate-600">Different investors have different goals and interests. The 1 AP cost reflects time spent on pitches, due diligence, and negotiations.</p>
          </div>
          <p class="text-slate-600"><strong>Challenges:</strong> Raise early with more dilution, or wait and risk running low? Is corporate money worth the strategic strings?</p>
        </div>
      `
    },
    events: {
      icon: 'âš¡',
      title: 'Events & Mini-Games',
      subtitle: 'The unexpected challenges',
      color: 'from-cyan-500 to-teal-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600">The startup world is unpredictable! Random events and special moments will test your skills:</p>
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-rose-50 rounded-lg p-3">
              <div class="text-lg mb-1">âš¡</div>
              <div class="text-xs font-medium text-rose-800">Market Shocks</div>
              <p class="text-rose-700 text-xs">From Q3: economic, regulatory, competitive disruptions</p>
            </div>
            <div class="bg-cyan-50 rounded-lg p-3">
              <div class="text-lg mb-1">ğŸª</div>
              <div class="text-xs font-medium text-cyan-800">Conference (M1)</div>
              <p class="text-cyan-700 text-xs">45-sec action game: click delegates, hand out swag!</p>
            </div>
            <div class="bg-violet-50 rounded-lg p-3">
              <div class="text-lg mb-1">ğŸ¤</div>
              <div class="text-xs font-medium text-violet-800">Pitch Event (M2)</div>
              <p class="text-violet-700 text-xs">30-sec pitch to skeptical investors</p>
            </div>
            <div class="bg-emerald-50 rounded-lg p-3">
              <div class="text-lg mb-1">ğŸª</div>
              <div class="text-xs font-medium text-emerald-800">Demo Day (M3)</div>
              <p class="text-emerald-700 text-xs">60-sec trade show boothâ€”convert visitors!</p>
            </div>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <div class="bg-rose-50 rounded-lg p-3">
            <h4 class="font-bold text-rose-800 mb-1">âš¡ Market Shocks</h4>
            <p class="text-rose-700">Starting Q3, random shocks may hit: economic downturns, regulatory changes, competitor moves, talent wars, or tech disruptions. You'll get 3 response optionsâ€”choose wisely!</p>
          </div>
          <div class="bg-emerald-50 rounded-lg p-3">
            <h4 class="font-bold text-emerald-800 mb-1">ğŸª Demo Day Tips</h4>
            <ul class="text-emerald-700 space-y-1">
              <li>â€¢ <strong>Engage</strong> visitors first to reveal their value and preferences</li>
              <li>â€¢ <strong>Green offers</strong> match preferences for bigger boosts</li>
              <li>â€¢ <strong>Convert</strong> when interest hits 75%</li>
              <li>â€¢ <strong>Skip time-wasters</strong> (Â£0 value) quickly!</li>
            </ul>
          </div>
          <div class="bg-amber-50 rounded-lg p-3">
            <h4 class="font-bold text-amber-800 mb-1">ğŸ² Life Events</h4>
            <p class="text-amber-700">Occasionally, random life events interrupt: team chaos, personal demands, or good fortune like cultural celebrations (ğŸª”ğŸŒ™ğŸ‰ğŸ•) and unexpected windfalls. Rare (1-2 per game) but add unpredictability.</p>
          </div>
        </div>
      `
    },
    research: {
      icon: 'ğŸ”¬',
      title: 'Research & Science',
      subtitle: 'Engaging with the science base',
      color: 'from-emerald-500 to-green-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600 text-sm">Engaging with science is a <strong>managerial choice</strong>â€”how much, when, with whom, and what you exchange. Do you hire PhD researchers? Collaborate with universities? Publish your work? Each decision has costs and benefits. Getting this right is up to you.</p>
          <div class="bg-emerald-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-emerald-800 text-sm mb-1">âœ… Benefits of Scientific Engagement</h4>
            <ul class="text-emerald-700 text-xs space-y-1">
              <li><strong>Learning:</strong> Access cutting-edge knowledge, methods, and data. Scientists work at the frontierâ€”partnering with them helps you see what's coming next.</li>
              <li><strong>Networking:</strong> Build connections to talented researchers, potential hires, and other labs. The best PhD students hear about opportunities through their advisors.</li>
              <li><strong>Legitimacy:</strong> Scientific credibility matters. Publications and university partnerships signal quality to customers, investors, and regulators.</li>
            </ul>
          </div>
          <div class="bg-rose-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-rose-800 text-sm mb-1">âš  Risks of Scientific Engagement</h4>
            <ul class="text-rose-700 text-xs space-y-1">
              <li><strong>Disclosure:</strong> Publishing and conferences mean sharing knowledgeâ€”possibly with competitors. Open science norms may conflict with your need for secrecy.</li>
              <li><strong>Distraction:</strong> Scientific curiosity can pull resources toward interesting problems that don't help the product. Research timelines rarely match startup urgency.</li>
              <li><strong>Translation:</strong> What works in a paper may not work in production. Bridging the gap between scientific results and commercial applications is harder than it looks.</li>
            </ul>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <div class="bg-amber-50 rounded-lg p-3">
            <h4 class="font-bold text-amber-800 text-sm mb-1">ğŸ”¬ Managing Scientists In Your Firm</h4>
            <p class="text-amber-700 text-xs">Scientists want to explore and publish; product people want to ship. Managing this tensionâ€”without losing your best researchersâ€”is a constant challenge.</p>
          </div>
          <div class="bg-blue-50 rounded-lg p-3">
            <p class="text-blue-700 text-xs"><strong>Challenges:</strong> Should researchers publish or stay secret? How do you stop a university claiming your IP? When a scientist chases interesting problems that won't help the product, what do you say?</p>
          </div>
        </div>
      `
    },
    product: {
      icon: 'ğŸ’»',
      title: 'Product & Development',
      subtitle: 'Building AI products',
      color: 'from-sky-500 to-blue-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600 text-sm">Building AI products means balancing <strong>speed against quality</strong>. Every shortcut creates problems tomorrow. Every delay risks being overtaken.</p>
          <div class="bg-sky-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-sky-800 text-sm mb-1">ğŸ— Build, Buy, or Partner?</h4>
            <p class="text-sky-700 text-xs">Building gives control but takes time. Buying is faster but creates dependencies. Partnering accelerates developmentâ€”but who owns what you create together?</p>
          </div>
          <div class="bg-violet-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-violet-800 text-sm mb-1">ğŸ¤ Collaborating with Other Firms</h4>
            <p class="text-violet-700 text-xs">Joint development, integration partnerships, licensing dealsâ€”these open doors. But negotiations over IP, exclusivity, and roadmap control are tricky. Today's partner might become tomorrow's competitor.</p>
          </div>
          <div class="bg-amber-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-amber-800 text-sm mb-1">ğŸ” Protecting What You Build</h4>
            <p class="text-amber-700 text-xs">Patents, trade secrets, or just moving fast? Should you open-source tools to build community, or keep everything proprietary? What happens when a competitor copies your feature?</p>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <div class="bg-blue-50 rounded-lg p-3">
            <p class="text-blue-700 text-xs"><strong>Challenges:</strong> Fix problems properly or push forward with workarounds? Structure partnerships without giving away advantage? Patent innovations or rely on speed?</p>
          </div>
        </div>
      `
    },
    sales: {
      icon: 'ğŸ“£',
      title: 'Sales & Marketing',
      subtitle: 'Building legitimacy and hype',
      color: 'from-fuchsia-500 to-pink-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600 text-sm">Startups need <strong>legitimacy</strong>â€”customers, investors, and partners must believe you're real before you've proven anything. How you build that credibility, and how far you stretch the truth to get there, is a constant tension.</p>
          <div class="bg-emerald-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-emerald-800 text-sm mb-1">âœ… The Upside of Hype</h4>
            <ul class="text-emerald-700 text-xs space-y-1">
              <li><strong>Legitimacy signals:</strong> Ties to high-status actorsâ€”famous investors, big-name advisors, university partnershipsâ€”make you credible before you've shipped anything.</li>
              <li><strong>Fake it till you make it:</strong> Bold claims and confident promotion can open doors, attract talent, and win early customers. Sometimes you have to act bigger than you are.</li>
              <li><strong>Momentum matters:</strong> Press coverage, awards, and "partnership announcements" create buzz that feeds on itself.</li>
            </ul>
          </div>
          <div class="bg-rose-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-rose-800 text-sm mb-1">âš  The Downside of Hype</h4>
            <ul class="text-rose-700 text-xs space-y-1">
              <li><strong>Hard to get, costly to keep:</strong> High-status partners and advisors don't come cheapâ€”they want equity, board seats, or favours. Maintaining these relationships takes time.</li>
              <li><strong>Overclaiming backfires:</strong> If you promise what you can't deliver, customers leave angry, journalists write takedowns, and your reputation suffers.</li>
              <li><strong>Where's the line?:</strong> "Confident vision" slides into "misleading claims" faster than you'd think. Regulators and lawyers have opinions about this.</li>
            </ul>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <div class="bg-orange-50 rounded-lg p-3">
            <h4 class="font-bold text-orange-800 text-sm mb-1">ğŸ¤ Enterprise vs. Consumer</h4>
            <p class="text-orange-700 text-xs">Enterprise sales are slow but stickyâ€”long cycles, legal reviews, pilots. Consumer markets move fast but churn is brutal.</p>
          </div>
          <div class="bg-blue-50 rounded-lg p-3">
            <p class="text-blue-700 text-xs"><strong>Challenges:</strong> Sell features you haven't built? Announce a "partnership" that's really just a conversation? How do you build credibility without crossing into deception?</p>
          </div>
        </div>
      `
    },
    hr: {
      icon: 'ğŸ’¼',
      title: 'People & HR',
      subtitle: 'The messy human side',
      color: 'from-pink-500 to-rose-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600 text-sm">Startups live and die by their people. But <strong>managing humans is messy</strong>â€”hiring, firing, culture, compensation, and the tension between moving fast and treating people fairly.</p>
          <div class="bg-pink-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-pink-800 text-sm mb-1">ğŸ¯ The Talent War</h4>
            <p class="text-pink-700 text-xs">AI talent is expensive and scarce. Pay top-of-market and strain runway? Offer equity that might be worthless? Compete with Titan Tech and CortexAI on compensation?</p>
          </div>
          <div class="bg-amber-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-amber-800 text-sm mb-1">ğŸŒ Visas & Immigration</h4>
            <p class="text-amber-700 text-xs">Many candidates need visa sponsorship. Becoming a sponsor means compliance, record-keeping, and Immigration Authority audits. Some candidates have settlement clocks ticking.</p>
          </div>
          <div class="bg-rose-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-rose-800 text-sm mb-1">â­ Reputation & WorkReview</h4>
            <p class="text-rose-700 text-xs">Former employees leave reviewsâ€”some fair, some not. Candidates check WorkReview before applying. Your employer brand affects who you can hire.</p>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <div class="bg-blue-50 rounded-lg p-3">
            <p class="text-blue-700 text-xs"><strong>Challenges:</strong> How honest are you about runway with candidates? What do you do when a star performer is toxic? How do you handle the first redundancy?</p>
          </div>
        </div>
      `
    },
    revenue: {
      icon: 'ğŸ“Š',
      title: 'Revenue & ARR',
      subtitle: 'Building recurring income',
      color: 'from-emerald-500 to-green-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600">As you grow, you'll acquire <strong>customers who pay recurring fees</strong>. This revenue offsets your burn rate and can eventually make you profitable.</p>
          <div class="bg-emerald-50 rounded-xl p-4">
            <div class="grid grid-cols-2 gap-4 text-center">
              <div>
                <div class="text-emerald-600 text-xl font-bold">ARR</div>
                <div class="text-emerald-700 text-xs">Annual Recurring Revenue</div>
                <p class="text-emerald-600 text-xs mt-1">Yearly subscription income</p>
              </div>
              <div>
                <div class="text-teal-600 text-xl font-bold">Net</div>
                <div class="text-teal-700 text-xs">Net Contribution</div>
                <p class="text-teal-600 text-xs mt-1">Revenue minus support costs</p>
              </div>
            </div>
          </div>
          <div class="bg-blue-50 rounded-lg p-3">
            <p class="text-blue-800 text-sm"><strong>ğŸ’¡ Why ARR Matters</strong></p>
            <p class="text-blue-700 text-xs mt-1">Investors value startups based on ARR. Higher ARR = higher valuation = less dilution when raising.</p>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <div class="bg-amber-50 rounded-lg p-3">
            <h4 class="font-bold text-amber-800 mb-1">ğŸ“ˆ Building Revenue</h4>
            <ul class="text-amber-700 space-y-1 text-xs">
              <li>â€¢ <strong>Pipeline</strong>: Potential customers you're talking to</li>
              <li>â€¢ <strong>Close rate</strong>: % of pipeline that becomes customers</li>
              <li>â€¢ <strong>Churn</strong>: % of customers who leave each quarter</li>
            </ul>
          </div>
          <div class="bg-violet-50 rounded-lg p-3">
            <h4 class="font-bold text-violet-800 mb-1">ğŸ¯ Revenue Targets</h4>
            <p class="text-violet-700 text-xs">Investors set ARR expectations. Missing targets damages confidence. Check the Finance panel to see your targets vs actual performance.</p>
          </div>
          <div class="bg-emerald-50 rounded-lg p-3">
            <h4 class="font-bold text-emerald-800 mb-1">âœ… Path to Profitability</h4>
            <p class="text-emerald-700 text-xs">When revenue exceeds burn rate, you're profitable! This gives you infinite runwayâ€”no more fundraising pressure.</p>
          </div>
        </div>
      `
    },
    focus: {
      icon: 'ğŸ¯',
      title: 'Strategic Focus',
      subtitle: 'Quarterly priority setting',
      color: 'from-violet-500 to-purple-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600">At the start of each quarter, you choose a <strong>Strategic Focus</strong>â€”where to concentrate your company's energy.</p>
          <div class="bg-violet-50 rounded-xl p-4">
            <div class="grid grid-cols-4 gap-2 text-center">
              <div class="bg-white rounded-lg p-2">
                <div class="text-lg">ğŸ”¬</div>
                <div class="text-xs font-medium text-slate-700">Research</div>
              </div>
              <div class="bg-white rounded-lg p-2">
                <div class="text-lg">ğŸ’»</div>
                <div class="text-xs font-medium text-slate-700">Product</div>
              </div>
              <div class="bg-white rounded-lg p-2">
                <div class="text-lg">ğŸ“£</div>
                <div class="text-xs font-medium text-slate-700">Sales</div>
              </div>
              <div class="bg-white rounded-lg p-2">
                <div class="text-lg">âš–ï¸</div>
                <div class="text-xs font-medium text-slate-700">Balanced</div>
              </div>
            </div>
          </div>
          <div class="bg-emerald-50 rounded-lg p-3">
            <p class="text-emerald-800 text-sm"><strong>âœ… Focus Bonus:</strong> Actions matching your focus get <strong>+1 stat boost</strong>!</p>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <div class="bg-blue-50 rounded-lg p-3">
            <h4 class="font-bold text-blue-800 mb-1">ğŸ¯ How Focus Works</h4>
            <ul class="text-blue-700 space-y-1 text-xs">
              <li>â€¢ Choose focus after reviewing the previous quarter</li>
              <li>â€¢ Focus appears as a badge in the header</li>
              <li>â€¢ Matching actions show a <span class="text-emerald-600 font-bold">+1 Focus</span> indicator</li>
              <li>â€¢ Balanced focus gives smaller bonuses to everything</li>
            </ul>
          </div>
          <div class="bg-amber-50 rounded-lg p-3">
            <h4 class="font-bold text-amber-800 mb-1">ğŸ’¡ Strategic Tip</h4>
            <p class="text-amber-700 text-xs">Match your focus to your current milestone. Working on First Prototype? Focus on Research or Product. Chasing Market Validation? Focus on Sales.</p>
          </div>
          <div class="bg-slate-100 rounded-lg p-3">
            <h4 class="font-bold text-slate-700 mb-1">âš–ï¸ Balanced Focus</h4>
            <p class="text-slate-600 text-xs">Gives +0.5 to all stats instead of +1 to one area. Good when you need broad progress, but less efficient than focused effort.</p>
          </div>
        </div>
      `
    },
    cards: {
      icon: 'ğŸƒ',
      title: 'Reading Decision Cards',
      subtitle: 'Understanding your choices',
      color: 'from-sky-500 to-cyan-600',
      summary: `
        <div class="space-y-4">
          <p class="text-slate-600">Each decision card shows <strong>impact tags</strong> to help you understand the effects before choosing.</p>
          <div class="bg-slate-100 rounded-xl p-4">
            <div class="text-sm font-medium text-slate-700 mb-2">Example Card Tags:</div>
            <div class="flex flex-wrap gap-2">
              <span class="px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-xs">ğŸ”¬ +Science</span>
              <span class="px-2 py-1 bg-sky-100 text-sky-700 rounded text-xs">ğŸ’» +Dev</span>
              <span class="px-2 py-1 bg-amber-100 text-amber-700 rounded text-xs">â± Effort: 2 AP</span>
              <span class="px-2 py-1 bg-rose-100 text-rose-700 rounded text-xs">ğŸ’¸ High Fees</span>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-emerald-50 rounded-lg p-2 text-center">
              <div class="text-xs font-bold text-emerald-800">Green Tags</div>
              <p class="text-emerald-700 text-xs">Positive effects</p>
            </div>
            <div class="bg-rose-50 rounded-lg p-2 text-center">
              <div class="text-xs font-bold text-rose-800">Red Tags</div>
              <p class="text-rose-700 text-xs">Costs or risks</p>
            </div>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3 text-sm">
          <div class="bg-sky-50 rounded-lg p-3">
            <h4 class="font-bold text-sky-800 mb-1">ğŸ“Š Stat Effects</h4>
            <div class="text-sky-700 text-xs space-y-1">
              <div><span class="font-bold">ğŸ”¬ Science</span> - Research progress, publications, credibility</div>
              <div><span class="font-bold">ğŸ’» Dev</span> - Product development, features, tech debt</div>
              <div><span class="font-bold">ğŸ“£ Marketing</span> - Sales, customers, market presence</div>
              <div><span class="font-bold">ğŸ‘¥ HR</span> - Team morale, culture, retention</div>
            </div>
          </div>
          <div class="bg-amber-50 rounded-lg p-3">
            <h4 class="font-bold text-amber-800 mb-1">ğŸ’° Financial Tags</h4>
            <div class="text-amber-700 text-xs space-y-1">
              <div><span class="font-bold">ğŸ’° +Funding</span> - Large cash gain (grants, deals)</div>
              <div><span class="font-bold">ğŸ’µ +Cash</span> - Smaller cash gain</div>
              <div><span class="font-bold">ğŸ’¸ High Fees</span> - Large expense (legal, patents)</div>
              <div><span class="font-bold">ğŸ“‹ Fees</span> - Smaller expense</div>
              <div><span class="font-bold">ğŸ“ˆ +Revenue</span> - Ongoing customer income</div>
            </div>
          </div>
          <div class="bg-violet-50 rounded-lg p-3">
            <h4 class="font-bold text-violet-800 mb-1">ğŸ¯ Focus Bonus</h4>
            <p class="text-violet-700 text-xs">When you see <span class="text-emerald-600 font-bold">+1 Focus</span>, this action matches your Strategic Focus and gets a bonus!</p>
          </div>
        </div>
      `
    },
    faq: {
      icon: 'â“',
      title: 'Common Questions',
      subtitle: 'Quick answers to frequent issues',
      color: 'from-slate-500 to-gray-600',
      summary: `
        <div class="space-y-4">
          <div class="space-y-3">
            <div class="bg-slate-50 rounded-lg p-3">
              <div class="font-bold text-slate-800 text-sm mb-1">My progress disappeared!</div>
              <p class="text-slate-600 text-xs">The game doesn't save to the cloud. Complete it in one sitting (45-90 min). You can leave the browser tab open to pause.</p>
            </div>
            <div class="bg-slate-50 rounded-lg p-3">
              <div class="font-bold text-slate-800 text-sm mb-1">I keep failingâ€”is the game broken?</div>
              <p class="text-slate-600 text-xs">No! Most players fail their first attempt. 90% of real startups fail too. Each failure teaches you something. Try a different strategy.</p>
            </div>
            <div class="bg-slate-50 rounded-lg p-3">
              <div class="font-bold text-slate-800 text-sm mb-1">What's the "right" strategy to win?</div>
              <p class="text-slate-600 text-xs">There isn't one. Every choice involves trade-offs. Learning to navigate uncertainty is the pointâ€”not finding an optimal solution.</p>
            </div>
            <div class="bg-slate-50 rounded-lg p-3">
              <div class="font-bold text-slate-800 text-sm mb-1">How long does a playthrough take?</div>
              <p class="text-slate-600 text-xs">Typically 45-90 minutes depending on how carefully you read events and consider decisions.</p>
            </div>
          </div>
        </div>
      `,
      more: `
        <div class="space-y-3">
          <div class="bg-slate-50 rounded-lg p-3">
            <div class="font-bold text-slate-800 text-sm mb-1">Competitors keep winningâ€”is that fair?</div>
            <p class="text-slate-600 text-xs">Yes. Rivals have strong strategies and some luck. If they get ahead, consider pivoting rather than racing harder. In real markets, sometimes the best response is to change direction.</p>
          </div>
          <div class="bg-slate-50 rounded-lg p-3">
            <div class="font-bold text-slate-800 text-sm mb-1">How do I get more cash?</div>
            <p class="text-slate-600 text-xs">Three ways: (1) Raise funding from investors (gives cash but costs equity), (2) Build revenue from customers (complete milestones to attract leads), (3) Reduce burn rate by hiring fewer people or choosing lower-cost options.</p>
          </div>
          <div class="bg-slate-50 rounded-lg p-3">
            <div class="font-bold text-slate-800 text-sm mb-1">Why does luck matter so much?</div>
            <p class="text-slate-600 text-xs">Because it does in real entrepreneurship! Good decisions improve your odds but don't guarantee success. The skill is making good choices despite uncertainty.</p>
          </div>
          <div class="bg-slate-50 rounded-lg p-3">
            <div class="font-bold text-slate-800 text-sm mb-1">How do I restart?</div>
            <p class="text-slate-600 text-xs">Refresh the page (F5 or Cmd+R). You'll start fresh with new choices available.</p>
          </div>
          <div class="bg-amber-50 rounded-lg p-3 mt-4">
            <div class="font-bold text-amber-800 text-sm mb-1">ğŸ’¡ Pro tip</div>
            <p class="text-amber-700 text-xs">Read the aside text on events carefullyâ€”it often hints at trade-offs you might miss. And don't forget you can pass on actions to save AP for later!</p>
          </div>
        </div>
      `
    }
  };
  
  // Tutorial type and card definitions
  tutorialType = 'quick'; // 'beginner' or 'quick'
  tutorialTopicsRead = new Set();
  
  // Core topics shown in both tutorials (includes Research and FAQ)
  coreTopics = ['goals', 'ap', 'cards', 'milestones', 'focus', 'competition', 'pivots', 'cash', 'revenue', 'team', 'funding', 'events', 'faq'];
  // Additional departmental topics only in beginner tutorial
  advancedTopics = ['research', 'product', 'sales', 'hr'];
  
  // Card metadata for rendering
  topicCards = {
    goals: { icon: 'ğŸ¯', bgClass: 'bg-indigo-500', hoverBorder: 'hover:border-indigo-400', desc: 'Win by completing 3 milestones. Lose if you run out of cash or miss deadlines.' },
    ap: { icon: 'AP', iconClass: 'text-white text-sm font-black', bgClass: 'bg-emerald-500', hoverBorder: 'hover:border-emerald-400', desc: '5 AP per quarter. Choose actions wiselyâ€”you can\'t do everything!' },
    cards: { icon: 'ğŸƒ', bgClass: 'bg-sky-500', hoverBorder: 'hover:border-sky-400', desc: 'Impact tags show effects at a glance. Green = good, red = costs.' },
    milestones: { icon: 'ğŸ†', bgClass: 'bg-amber-500', hoverBorder: 'hover:border-amber-400', desc: 'Build stats to complete milestones. Each has requirements and a deadline.' },
    focus: { icon: 'ğŸ¯', bgClass: 'bg-violet-500', hoverBorder: 'hover:border-violet-400', desc: 'Choose quarterly focus for +1 bonus to matching actions.' },
    competition: { icon: 'âš”ï¸', bgClass: 'bg-pink-500', hoverBorder: 'hover:border-pink-400', desc: '3 rival startups racing you. If they get ahead, you\'ll need to respond.' },
    pivots: { icon: 'ğŸ”„', bgClass: 'bg-gradient-to-br from-purple-500 to-violet-600', hoverBorder: 'hover:border-purple-400', desc: 'Change direction when competitors get ahead or your strategy isn\'t working.' },
    cash: { icon: 'ğŸ’·', bgClass: 'bg-rose-500', hoverBorder: 'hover:border-rose-400', desc: 'Burn rate drains cash each quarter. Zero cash = game over.' },
    revenue: { icon: 'ğŸ“Š', bgClass: 'bg-emerald-600', hoverBorder: 'hover:border-emerald-400', desc: 'Build ARR (Annual Recurring Revenue) from customers to offset burn.' },
    team: { icon: 'ğŸ‘¥', bgClass: 'bg-blue-500', hoverBorder: 'hover:border-blue-400', desc: 'Hire executives for Research, Product & Sales. Keep morale high!' },
    funding: { icon: 'ğŸ¦', bgClass: 'bg-violet-600', hoverBorder: 'hover:border-violet-400', desc: 'Raise money from investors. More cash, but you give up equity.' },
    events: { icon: 'âš¡', bgClass: 'bg-cyan-500', hoverBorder: 'hover:border-cyan-400', desc: 'Market shocks, conferences, and pitch events test your skills.' },
    research: { icon: 'ğŸ”¬', bgClass: 'bg-gradient-to-br from-emerald-500 to-teal-600', hoverBorder: 'hover:border-emerald-300', desc: 'The benefits and risks of scientific engagement. A core theme of this game.' },
    product: { icon: 'ğŸ’»', bgClass: 'bg-sky-600', hoverBorder: 'hover:border-sky-400', desc: 'Build, buy, or partner? Speed vs quality. Protecting what you build.' },
    sales: { icon: 'ğŸ“£', bgClass: 'bg-fuchsia-600', hoverBorder: 'hover:border-fuchsia-400', desc: 'Building legitimacy. The upside and downside of hype.' },
    hr: { icon: 'ğŸ’¼', bgClass: 'bg-pink-600', hoverBorder: 'hover:border-pink-400', desc: 'Talent war, visas, reputation. The messy human side of startups.' },
    faq: { icon: 'â“', bgClass: 'bg-slate-500', hoverBorder: 'hover:border-slate-400', desc: 'Progress lost? Keep failing? Common questions answered here.' }
  };
  
  startTutorial() {
    // Show tutorial type selection
    document.getElementById("preambleModal1").classList.add("hidden");
    document.getElementById("tutorialTypeModal").classList.remove("hidden");
    document.getElementById("tutorialTypeModal").classList.add("flex");
  }
  
  backToTutorialType() {
    document.getElementById("tutorialHubModal").classList.add("hidden");
    document.getElementById("tutorialHubModal").classList.remove("flex");
    document.getElementById("tutorialTypeModal").classList.remove("hidden");
    document.getElementById("tutorialTypeModal").classList.add("flex");
  }
  
  startBeginnerTutorial() {
    this.tutorialType = 'beginner';
    this.tutorialTopicsRead.clear();
    document.getElementById("tutorialTypeModal").classList.add("hidden");
    document.getElementById("tutorialTypeModal").classList.remove("flex");
    this.renderTutorialTopics();
    document.getElementById("tutorialHubTitle").textContent = "Full Tutorial";
    document.getElementById("tutorialHubModal").classList.remove("hidden");
    document.getElementById("tutorialHubModal").classList.add("flex");
    this.updateTutorialReadCounter();
  }
  
  startQuickTutorial() {
    this.tutorialType = 'quick';
    this.tutorialTopicsRead.clear();
    document.getElementById("tutorialTypeModal").classList.add("hidden");
    document.getElementById("tutorialTypeModal").classList.remove("flex");
    this.renderTutorialTopics();
    document.getElementById("tutorialHubTitle").textContent = "Quick Start Guide";
    document.getElementById("tutorialHubModal").classList.remove("hidden");
    document.getElementById("tutorialHubModal").classList.add("flex");
    this.updateTutorialReadCounter();
  }
  
  skipTutorial() {
    document.getElementById("tutorialTypeModal").classList.add("hidden");
    document.getElementById("tutorialTypeModal").classList.remove("flex");
    this.closeTutorialHub();
  }
  
  getCurrentTopicList() {
    return this.tutorialType === 'beginner' 
      ? [...this.coreTopics, ...this.advancedTopics]
      : this.coreTopics;
  }
  
  renderTopicCard(topicId) {
    const card = this.topicCards[topicId];
    const topic = this.tutorialTopics[topicId];
    const iconContent = card.iconClass 
      ? `<span class="${card.iconClass}">${card.icon}</span>`
      : card.icon;
    
    return `
      <button onclick="game.openTutorialTopic('${topicId}')" id="topic-${topicId}" 
        class="tutorial-topic-card group bg-white/10 hover:bg-white/20 border-2 border-slate-500/50 ${card.hoverBorder} rounded-xl p-4 text-left transition-all relative">
        <div class="flex items-center gap-3 mb-2">
          <div class="w-10 h-10 rounded-lg ${card.bgClass} flex items-center justify-center text-xl">${iconContent}</div>
          <h3 class="font-bold text-white text-sm">${topic.title}</h3>
        </div>
        <p class="text-slate-400 text-xs">${card.desc}</p>
      </button>
    `;
  }
  
  renderTutorialTopics() {
    const grid = document.getElementById("tutorialTopicGrid");
    const topics = this.getCurrentTopicList();
    grid.innerHTML = topics.map(topicId => this.renderTopicCard(topicId)).join('');
  }

  openTutorialTopic(topicId) {
    const topic = this.tutorialTopics[topicId];
    if (!topic) return;
    
    // Mark as read
    this.tutorialTopicsRead.add(topicId);
    this.updateTopicCardState(topicId);
    this.updateTutorialReadCounter();
    
    // Set header gradient
    document.getElementById("topicHeader").className = `p-6 bg-gradient-to-r ${topic.color}`;
    
    // Set icon
    const iconEl = document.getElementById("topicIcon");
    if (topic.iconStyle) {
      iconEl.innerHTML = `<span class="${topic.iconStyle}">${topic.icon}</span>`;
    } else {
      iconEl.textContent = topic.icon;
    }
    
    // Set content - combine summary and more into one view
    document.getElementById("topicTitle").textContent = topic.title;
    document.getElementById("topicSubtitle").textContent = topic.subtitle;
    document.getElementById("topicContent").innerHTML = topic.summary + (topic.more ? `<div class="border-t pt-4 mt-4">${topic.more}</div>` : '');
    
    // Show modal
    document.getElementById("tutorialTopicModal").classList.remove("hidden");
    document.getElementById("tutorialTopicModal").classList.add("flex");
  }
  
  closeTutorialTopic() {
    document.getElementById("tutorialTopicModal").classList.add("hidden");
    document.getElementById("tutorialTopicModal").classList.remove("flex");
  }
  
  updateTopicCardState(topicId) {
    const card = document.getElementById(`topic-${topicId}`);
    if (!card) return;
    
    // Change to green/read state
    card.classList.remove('border-slate-500/50', 'border-purple-400');
    card.classList.add('border-emerald-400', 'bg-emerald-900/20');
    
    // Add checkmark
    if (!card.querySelector('.read-check')) {
      const check = document.createElement('div');
      check.className = 'read-check absolute top-2 right-2 w-5 h-5 bg-emerald-500 rounded-full flex items-center justify-center text-white text-xs';
      check.textContent = 'âœ“';
      card.appendChild(check);
    }
  }
  
  updateTutorialReadCounter() {
    const topics = this.getCurrentTopicList();
    const total = topics.length;
    const read = [...this.tutorialTopicsRead].filter(t => topics.includes(t)).length;
    document.getElementById("tutorialReadCounter").textContent = `${read} of ${total} topics read`;
    
    // Update start button if all read
    const btn = document.getElementById("tutorialStartBtn");
    if (read === total) {
      btn.innerHTML = 'ğŸ“ All Topics Read - Start Playing!';
    } else if (read > 0) {
      btn.innerHTML = `ğŸš€ Start Playing (${total - read} unread)`;
    } else {
      btn.innerHTML = 'ğŸš€ Start Playing';
    }
  }
  
  closeTutorialHub() {
    document.getElementById("tutorialHubModal").classList.add("hidden");
    document.getElementById("tutorialHubModal").classList.remove("flex");
    document.getElementById("ventureModal").classList.remove("hidden");
    document.getElementById("ventureModal").classList.add("flex");
    
    // Show extreme mode indicator if enabled
    const extremeIndicator = document.getElementById("extremeModeIndicatorVenture");
    if (this.extremeMode) {
      extremeIndicator.classList.remove("hidden");
    } else {
      extremeIndicator.classList.add("hidden");
    }
  }
  
  // Legacy functions for compatibility
  startExperiencedTutorial() {
    this.startQuickTutorial();
  }
  
  skipTutorialFromSelect() {
    this.closeTutorialHub();
  }
  
  closeTutorial() {
    document.getElementById("tutorialModal").classList.add("hidden");
    document.getElementById("tutorialModal").classList.remove("flex");
    document.getElementById("preambleModal1").classList.remove("hidden");
  }
  
  getTutorialTotalSteps() {
    return this.tutorialType === 'beginner' ? 27 : 16;
  }
  
  tutorialNext() {
    const totalSteps = this.getTutorialTotalSteps();
    if (this.tutorialStep < totalSteps) {
      this.tutorialStep++;
      this.renderTutorialStep();
    } else {
      // Tutorial complete - go to founder selection first
      document.getElementById("tutorialModal").classList.add("hidden");
      document.getElementById("tutorialModal").classList.remove("flex");
      this.showFounderModal();
      
      // Show extreme mode indicator if enabled
      const extremeIndicator = document.getElementById("extremeModeIndicatorVenture");
      if (this.extremeMode) {
        extremeIndicator.classList.remove("hidden");
      } else {
        extremeIndicator.classList.add("hidden");
      }
    }
  }
  
  tutorialBack() {
    if (this.tutorialStep > 1) {
      this.tutorialStep--;
      this.renderTutorialStep();
    }
  }
  
  renderTutorialStep() {
    const step = this.tutorialStep;
    const totalSteps = this.getTutorialTotalSteps();
    document.getElementById("tutorialStepNum").textContent = step;
    document.getElementById("tutorialTotalSteps").textContent = totalSteps;
    document.getElementById("tutorialProgress").style.width = `${(step / totalSteps) * 100}%`;
    document.getElementById("tutorialBackBtn").style.visibility = step === 1 ? "hidden" : "visible";
    document.getElementById("tutorialNextBtn").textContent = step === totalSteps ? "Start Game â†’" : "Next â†’";
    
    const content = this.tutorialType === 'beginner' 
      ? this.getBeginnerTutorialContent(step)
      : this.getTutorialContent(step);
    document.getElementById("tutorialContent").innerHTML = content;
  }
  
  getTutorialContent(step) {
    const tutorials = {
      1: {
        title: "Welcome, Founder! ğŸš€",
        icon: "ğŸ‘‹",
        content: `
          <p class="text-slate-600 mb-4">
            In this game, you'll run an AI startup for <strong>16 quarters (4 years)</strong>. 
            Your goal is to complete <strong>3 major milestones</strong> before running out of money or time.
          </p>
          <div class="bg-indigo-50 rounded-xl p-4 mb-4">
            <h4 class="font-bold text-indigo-800 mb-2">ğŸ¯ Win Condition</h4>
            <p class="text-indigo-700 text-sm">Complete all 3 milestones to win. Each milestone has a deadline-miss it and the board will shut you down.</p>
          </div>
          <div class="bg-rose-50 rounded-xl p-4 mb-4">
            <h4 class="font-bold text-rose-800 mb-2">ğŸ’€ Lose Conditions</h4>
            <ul class="text-rose-700 text-sm space-y-1">
              <li>â€¢ <strong>Bankruptcy:</strong> Cash hits Â£0</li>
              <li>â€¢ <strong>Missed Deadline:</strong> Fail to complete a milestone in time</li>
            </ul>
          </div>
          <div class="bg-purple-50 rounded-xl p-4 border border-purple-200">
            <h4 class="font-bold text-purple-800 mb-2">ğŸ”„ Key Feature: Strategic Pivots</h4>
            <p class="text-purple-700 text-sm">You're racing against <strong>3 rival startups</strong>. If they get ahead, you'll need to <strong>pivot</strong>â€”change your strategy to find a new path to victory. Pivoting is a core startup skill!</p>
          </div>
        `
      },
      2: {
        title: "Game Setup ğŸ®",
        icon: "âš™",
        content: `
          <p class="text-slate-600 mb-4">
            Before you start, you'll make four important choices that shape your entire game:
          </p>
          <div class="space-y-3">
            <div class="bg-violet-50 rounded-xl p-4 flex items-start gap-3">
              <div class="text-2xl">ğŸ‘¤</div>
              <div>
                <h4 class="font-bold text-violet-800">1. Create Your Founder</h4>
                <p class="text-violet-700 text-sm">Choose your background-Academic, Serial Founder, Technical Prodigy, etc. Each has different strengths.</p>
              </div>
            </div>
            <div class="bg-indigo-50 rounded-xl p-4 flex items-start gap-3">
              <div class="text-2xl">ğŸ¢</div>
              <div>
                <h4 class="font-bold text-indigo-800">2. Choose Your Startup</h4>
                <p class="text-indigo-700 text-sm">BioTech, Robotics, FinTech, or Creative AI-each has unique milestones and challenges.</p>
              </div>
            </div>
            <div class="bg-emerald-50 rounded-xl p-4 flex items-start gap-3">
              <div class="text-2xl">ğŸ“</div>
              <div>
                <h4 class="font-bold text-emerald-800">3. Pick Your Location</h4>
                <p class="text-emerald-700 text-sm">London, Oxford, Edinburgh, Manchester... Each city has different salary costs and stat bonuses.</p>
              </div>
            </div>
            <div class="bg-amber-50 rounded-xl p-4 flex items-start gap-3">
              <div class="text-2xl">ğŸ’°</div>
              <div>
                <h4 class="font-bold text-amber-800">4. Select Funding Path</h4>
                <p class="text-amber-700 text-sm">Bootstrap (keep equity), Angel (moderate funding), or VC (big funding, big dilution).</p>
              </div>
            </div>
          </div>
        `
      },
      3: {
        title: "Attention Points (AP) âš¡",
        icon: "ğŸ®",
        content: `
          <p class="text-slate-600 mb-4">
            <strong>Attention Points represent your managerial attention</strong>-the scarcest resource in any startup. 
            You can't do everything. Each quarter, you must choose where to focus while other opportunities pass by.
          </p>
          <p class="text-slate-600 mb-4">
            You have <strong>5 AP per quarter</strong> to spend. Your executive team will present 
            strategic options, each costing different amounts of AP.
          </p>
          <div class="flex gap-2 justify-center mb-4">
            ${[1,2,3,4,5].map(i => `<div class="w-10 h-10 rounded-lg bg-emerald-500 text-white flex items-center justify-center font-bold">${i}</div>`).join('')}
          </div>
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-emerald-50 rounded-lg p-3 text-center">
              <div class="text-2xl mb-1">1-2 AP</div>
              <div class="text-emerald-700 text-sm">Safe, incremental moves</div>
            </div>
            <div class="bg-amber-50 rounded-lg p-3 text-center">
              <div class="text-2xl mb-1">3-4 AP</div>
              <div class="text-amber-700 text-sm">Bold, high-impact moves</div>
            </div>
          </div>
          <div class="bg-blue-50 rounded-xl p-4">
            <h4 class="font-bold text-blue-800 mb-2">ğŸ’¡ Pro Tip: Banking AP</h4>
            <p class="text-blue-700 text-sm">Unused AP (up to 2) carries over to next quarter. Save up for crucial moments when you need 6-7 AP!</p>
          </div>
        `
      },
      4: {
        title: "Your Executive Team ğŸ‘¥",
        icon: "ğŸ‘”",
        content: `
          <p class="text-slate-600 mb-4">
            You'll hire three executives at the start, each leading a department:
          </p>
          <div class="grid grid-cols-3 gap-3 mb-4">
            <div class="bg-emerald-50 rounded-xl p-4 text-center">
              <div class="text-3xl mb-2">ğŸ”¬</div>
              <div class="font-bold text-slate-800">Research</div>
              <div class="text-xs text-slate-500">Boosts Science stat</div>
            </div>
            <div class="bg-sky-50 rounded-xl p-4 text-center">
              <div class="text-3xl mb-2">ğŸ’»</div>
              <div class="font-bold text-slate-800">Product</div>
              <div class="text-xs text-slate-500">Boosts Dev stat</div>
            </div>
            <div class="bg-fuchsia-50 rounded-xl p-4 text-center">
              <div class="text-3xl mb-2">ğŸ“£</div>
              <div class="font-bold text-slate-800">Sales</div>
              <div class="text-xs text-slate-500">Boosts Marketing stat</div>
            </div>
          </div>
          <div class="bg-amber-50 rounded-xl p-4">
            <h4 class="font-bold text-amber-800 mb-2">ğŸ˜Š Team Morale Matters!</h4>
            <p class="text-amber-700 text-sm">Each exec has a mood indicator. Happy execs bring better opportunities; 
            frustrated execs are more likely to bring problems and challenges. <strong>Keep your team engaged!</strong></p>
            <div class="flex justify-center gap-2 mt-3">
              <span class="px-2 py-1 bg-emerald-200 rounded text-xs">ğŸ˜Š Better events</span>
              <span class="px-2 py-1 bg-slate-200 rounded text-xs">ğŸ˜ Random</span>
              <span class="px-2 py-1 bg-amber-200 rounded text-xs">ğŸ˜Ÿ More problems</span>
              <span class="px-2 py-1 bg-rose-200 rounded text-xs">ğŸ˜  Tough situations</span>
            </div>
          </div>
        `
      },
      5: {
        title: "Research & Science ğŸ”¬",
        icon: "ğŸ§¬",
        content: `
          <p class="text-slate-600 mb-3 text-sm">
            Engaging with science is a <strong>managerial choice</strong>-how much, when, with whom, and what you exchange. 
            Do you hire PhD researchers? Collaborate with universities? Publish your work? Each decision has costs and benefits. 
            Getting this right is up to you.
          </p>
          <div class="bg-emerald-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-emerald-800 text-sm mb-1">âœ… Benefits of Scientific Engagement</h4>
            <ul class="text-emerald-700 text-xs space-y-1">
              <li><strong>Learning:</strong> Access cutting-edge knowledge, methods, and data. Scientists work at the frontier-partnering with them helps you see what's coming next.</li>
              <li><strong>Networking:</strong> Build connections to talented researchers, potential hires, and other labs. The best PhD students hear about opportunities through their advisors.</li>
              <li><strong>Legitimacy:</strong> Scientific credibility matters. Publications and university partnerships signal quality to customers, investors, and regulators.</li>
            </ul>
          </div>
          <div class="bg-rose-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-rose-800 text-sm mb-1">âš  Risks of Scientific Engagement</h4>
            <ul class="text-rose-700 text-xs space-y-1">
              <li><strong>Disclosure:</strong> Publishing and conferences mean sharing knowledge-possibly with competitors. Open science norms may conflict with your need for secrecy.</li>
              <li><strong>Distraction:</strong> Scientific curiosity can pull resources toward interesting problems that don't help the product. Research timelines rarely match startup urgency.</li>
              <li><strong>Translation:</strong> What works in a paper may not work in production. Bridging the gap between scientific results and commercial applications is harder than it looks.</li>
            </ul>
          </div>
          <div class="bg-amber-50 rounded-lg p-2 mb-2">
            <h4 class="font-bold text-amber-800 text-xs mb-1">ğŸ”¬ Managing Scientists In Your Firm</h4>
            <p class="text-amber-700 text-xs">Scientists want to explore and publish; product people want to ship. Managing this tension-without losing your best researchers-is a constant challenge.</p>
          </div>
          <div class="bg-blue-50 rounded-lg p-2">
            <p class="text-blue-700 text-xs"><strong>Challenges:</strong> Should researchers publish or stay secret? How do you stop a university claiming your IP? When a scientist chases interesting problems that won't help the product, what do you say?</p>
          </div>
        `
      },
      6: {
        title: "Product & Development ğŸ’»",
        icon: "âš™",
        content: `
          <p class="text-slate-600 mb-3 text-sm">
            Building AI products means balancing <strong>speed against quality</strong>. 
            Every shortcut creates problems tomorrow. Every delay risks being overtaken.
          </p>
          <div class="bg-sky-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-sky-800 text-sm mb-1">ğŸ— Build, Buy, or Partner?</h4>
            <p class="text-sky-700 text-xs">Building gives control but takes time. Buying is faster but creates dependencies. 
            Partnering accelerates development-but who owns what you create together?</p>
          </div>
          <div class="bg-violet-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-violet-800 text-sm mb-1">ğŸ¤ Collaborating with Other Firms</h4>
            <p class="text-violet-700 text-xs">Joint development, integration partnerships, licensing deals-these open doors. 
            But negotiations over IP, exclusivity, and roadmap control are tricky. Today's partner might become tomorrow's competitor.</p>
          </div>
          <div class="bg-amber-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-amber-800 text-sm mb-1">ğŸ” Protecting What You Build</h4>
            <p class="text-amber-700 text-xs">Patents, trade secrets, or just moving fast? Should you open-source tools to build community, 
            or keep everything proprietary? What happens when a competitor copies your feature?</p>
          </div>
          <div class="bg-blue-50 rounded-lg p-2">
            <p class="text-blue-700 text-xs"><strong>Challenges:</strong> Fix problems properly or push forward with workarounds? 
            Structure partnerships without giving away advantage? Patent innovations or rely on speed?</p>
          </div>
        `
      },
      7: {
        title: "Sales & Marketing ğŸ“£",
        icon: "ğŸ¯",
        content: `
          <p class="text-slate-600 mb-3 text-sm">
            Startups need <strong>legitimacy</strong>-customers, investors, and partners must believe you're real before you've proven anything. 
            How you build that credibility, and how far you stretch the truth to get there, is a constant tension.
          </p>
          <div class="bg-emerald-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-emerald-800 text-sm mb-1">âœ… The Upside of Hype</h4>
            <ul class="text-emerald-700 text-xs space-y-1">
              <li><strong>Legitimacy signals:</strong> Ties to high-status actors-famous investors, big-name advisors, university partnerships-make you credible before you've shipped anything.</li>
              <li><strong>Fake it till you make it:</strong> Bold claims and confident promotion can open doors, attract talent, and win early customers. Sometimes you have to act bigger than you are.</li>
              <li><strong>Momentum matters:</strong> Press coverage, awards, and "partnership announcements" create buzz that feeds on itself.</li>
            </ul>
          </div>
          <div class="bg-rose-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-rose-800 text-sm mb-1">âš  The Downside of Hype</h4>
            <ul class="text-rose-700 text-xs space-y-1">
              <li><strong>Hard to get, costly to keep:</strong> High-status partners and advisors don't come cheap-they want equity, board seats, or favours. Maintaining these relationships takes time.</li>
              <li><strong>Overclaiming backfires:</strong> If you promise what you can't deliver, customers leave angry, journalists write takedowns, and your reputation suffers.</li>
              <li><strong>Where's the line?:</strong> "Confident vision" slides into "misleading claims" faster than you'd think. Regulators and lawyers have opinions about this.</li>
            </ul>
          </div>
          <div class="bg-orange-50 rounded-lg p-2 mb-2">
            <h4 class="font-bold text-orange-800 text-xs mb-1">ğŸ¤ Enterprise vs. Consumer</h4>
            <p class="text-orange-700 text-xs">Enterprise sales are slow but sticky-long cycles, legal reviews, pilots. Consumer markets move fast but churn is brutal.</p>
          </div>
          <div class="bg-blue-50 rounded-lg p-2">
            <p class="text-blue-700 text-xs"><strong>Challenges:</strong> Sell features you haven't built? Announce a "partnership" that's really just a conversation? How do you build credibility without crossing into deception?</p>
          </div>
        `
      },
      8: {
        title: "People & HR ğŸ‘¥",
        icon: "ğŸ’¼",
        content: `
          <p class="text-slate-600 mb-3 text-sm">
            Startups live and die by their people. But <strong>managing humans is messy</strong>-hiring, firing, 
            culture, compensation, and the tension between moving fast and treating people fairly.
          </p>
          <div class="bg-pink-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-pink-800 text-sm mb-1">ğŸ¯ The Talent War</h4>
            <p class="text-pink-700 text-xs">AI talent is expensive and scarce. Pay top-of-market and strain runway? 
            Offer equity that might be worthless? Compete with Titan Tech and CortexAI on compensation?</p>
          </div>
          <div class="bg-amber-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-amber-800 text-sm mb-1">ğŸŒ Visas & Immigration</h4>
            <p class="text-amber-700 text-xs">Many candidates need visa sponsorship. Becoming a sponsor means compliance, 
            record-keeping, and Immigration Authority audits. Some candidates have settlement clocks ticking.</p>
          </div>
          <div class="bg-rose-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-rose-800 text-sm mb-1">â­ Reputation & WorkReview</h4>
            <p class="text-rose-700 text-xs">Former employees leave reviews-some fair, some not. Candidates check WorkReview before applying. 
            Your employer brand affects who you can hire.</p>
          </div>
          <div class="bg-blue-50 rounded-lg p-2">
            <p class="text-blue-700 text-xs"><strong>Challenges:</strong> How honest are you about runway with candidates? 
            What do you do when a star performer is toxic? How do you handle the first redundancy?</p>
          </div>
        `
      },
      9: {
        title: "Head of HR Unlock ğŸ’¼",
        icon: "ğŸ‰",
        content: `
          <p class="text-slate-600 mb-4">
            After completing your <strong>first milestone</strong>, the board will insist you formalize HR 
            and hire a <strong>Head of HR</strong>.
          </p>
          <div class="bg-pink-50 rounded-xl p-4 mb-4 border-2 border-pink-200">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-12 h-12 rounded-full bg-pink-500 flex items-center justify-center text-2xl">ğŸ’¼</div>
              <div>
                <h4 class="font-bold text-pink-800">Fourth Executive Unlocked!</h4>
                <p class="text-pink-600 text-sm">A whole new department to manage</p>
              </div>
            </div>
            <p class="text-pink-700 text-sm">The Head of HR will present HR-focused options each quarter, helping you 
            manage team culture, hiring, and employee satisfaction.</p>
          </div>
          <div class="bg-slate-50 rounded-xl p-4">
            <h4 class="font-bold text-slate-700 mb-2">What They Bring:</h4>
            <ul class="text-slate-600 text-sm space-y-1">
              <li>âœ“ Boosts HR stat (affects team effectiveness)</li>
              <li>âœ“ New strategic options each quarter</li>
              <li>âœ“ Helps maintain team morale</li>
              <li>âœ“ Costs salary + equity like other execs</li>
            </ul>
          </div>
        `
      },
      10: {
        title: "Milestones & Deadlines ğŸ¯",
        icon: "ğŸ“…",
        content: `
          <p class="text-slate-600 mb-4">
            Each milestone requires you to build up specific stats. The milestone tracker shows your progress:
          </p>
          <div class="bg-slate-100 rounded-xl p-4 mb-4">
            <div class="flex items-center justify-between mb-2">
              <span class="font-bold text-slate-700">First Prototype</span>
              <span class="text-amber-600 font-bold">65%</span>
            </div>
            <div class="h-4 bg-white rounded-full overflow-hidden border">
              <div class="h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full" style="width: 65%"></div>
            </div>
            <div class="mt-2 text-xs text-slate-500">Focus: Research + Product â€¢ Deadline: Q4</div>
          </div>
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-emerald-50 rounded-lg p-3">
              <div class="font-bold text-emerald-800 text-sm">âœ… Hit 100%</div>
              <p class="text-emerald-700 text-xs">Milestone complete! +Â£150k cash, +Â£400k valuation</p>
            </div>
            <div class="bg-rose-50 rounded-lg p-3">
              <div class="font-bold text-rose-800 text-sm">âŒ Miss Deadline</div>
              <p class="text-rose-700 text-xs">Game over. The board loses confidence.</p>
            </div>
          </div>
          <div class="bg-blue-50 rounded-xl p-4">
            <h4 class="font-bold text-blue-800 mb-2">ğŸ’¡ Focus on the Focus Areas!</h4>
            <p class="text-blue-700 text-sm">The milestone tracker shows which stats matter (Research, Product, or Sales). 
            Prioritize actions that boost those specific areas.</p>
          </div>
        `
      },
      11: {
        title: "Cash & Runway ğŸ’°",
        icon: "ğŸ“Š",
        content: `
          <p class="text-slate-600 mb-4">
            Every quarter, you pay salaries and costs. This is your <strong>burn rate</strong>. 
            When cash hits zero, it's game over.
          </p>
          <div class="bg-slate-800 text-white rounded-xl p-4 mb-4">
            <div class="grid grid-cols-3 gap-4 text-center">
              <div>
                <div class="text-emerald-400 text-2xl font-bold">Â£450k</div>
                <div class="text-slate-400 text-xs">Cash</div>
              </div>
              <div>
                <div class="text-rose-400 text-2xl font-bold">Â£90k/q</div>
                <div class="text-slate-400 text-xs">Burn Rate</div>
              </div>
              <div>
                <div class="text-amber-400 text-2xl font-bold">5q</div>
                <div class="text-slate-400 text-xs">Runway</div>
              </div>
            </div>
          </div>
          <div class="bg-blue-50 rounded-xl p-4 mb-4">
            <h4 class="font-bold text-blue-800 mb-2">ğŸ’¡ Runway = Cash Ã· Burn</h4>
            <p class="text-blue-700 text-sm">Always know how many quarters you can survive. If runway drops below 3, consider raising funding!</p>
          </div>
          <div class="bg-amber-50 rounded-xl p-4">
            <h4 class="font-bold text-amber-800 mb-2">âš  What Increases Burn?</h4>
            <p class="text-amber-700 text-sm">Executive salaries, staff count, location (London is expensive!), and some strategic choices.</p>
          </div>
        `
      },
      12: {
        title: "Raising Funding ğŸ¦",
        icon: "ğŸ’¸",
        content: `
          <p class="text-slate-600 mb-3 text-sm">
            Fundraising is a <strong>big part of the founder's job</strong>. Money brings runway, but also strings-investors want returns, 
            and that shapes what you can do. Choosing the right investors, at the right time, matters as much as the amount raised.
          </p>
          <div class="bg-violet-50 rounded-lg p-3 mb-2">
            <h4 class="font-bold text-violet-800 text-sm mb-1">ğŸ‘¥ Types of Investors</h4>
            <ul class="text-violet-700 text-xs space-y-1">
              <li><strong>Angels:</strong> Wealthy individuals. Smaller cheques, flexible terms, varied experience. Some add real value; others just write cheques.</li>
              <li><strong>Independent VCs:</strong> Professional funds seeking big returns. Larger amounts, more structure, board seats. They've seen many startups-helpful, but demanding.</li>
              <li><strong>Corporate VCs:</strong> Investment arms of big companies. Strategic interest in your technology. Can open doors-but may limit who else you can work with.</li>
            </ul>
          </div>
          <div class="bg-amber-50 rounded-lg p-2 mb-2">
            <h4 class="font-bold text-amber-800 text-xs mb-1">âš  One Raise Per Milestone (Costs 1 AP)</h4>
            <p class="text-amber-700 text-xs">You can only raise external funding <strong>once per milestone</strong>. Each raise costs <strong>1 AP</strong>-fundraising takes time away from running the business. 
            Plan carefully-you need enough cash to reach the next milestone.</p>
          </div>
          <div class="bg-emerald-50 rounded-lg p-2 mb-2">
            <h4 class="font-bold text-emerald-800 text-xs mb-1">ğŸ¥§ Dilution Isn't Always Bad</h4>
            <p class="text-emerald-700 text-xs">Giving up equity feels painful, but successful founders often own small percentages of valuable companies. 
            <strong>A small slice of a big pie is worth more than a large slice of a small pie.</strong> Dilution is normal-what matters is growing the pie.</p>
          </div>
          <div class="bg-slate-50 rounded-lg p-2 mb-2">
            <h4 class="font-bold text-slate-700 text-xs mb-1">â± The Fundraising Game</h4>
            <p class="text-slate-600 text-xs">Different investors have different goals, experience, and interests-keeping them all happy gets harder as you add more. 
            Investors bring not just money, but also help, support, and headaches. The 1 AP cost reflects time spent on pitches, due diligence, and negotiations.</p>
          </div>
          <div class="bg-blue-50 rounded-lg p-2">
            <p class="text-blue-700 text-xs"><strong>Challenges:</strong> Raise early with more dilution, or wait and risk running low? 
            How much is enough to reach the next milestone? Is corporate money worth the strategic strings?</p>
          </div>
        `
      },
      13: {
        title: "Events & Mini-Games âš¡",
        icon: "ğŸª",
        content: `
          <p class="text-slate-600 mb-4">
            The startup world is unpredictable! Random events and special moments will test your skills:
          </p>
          <div class="bg-rose-50 rounded-xl p-4 mb-3">
            <h4 class="font-bold text-rose-800 mb-2">âš¡ Market Shocks</h4>
            <p class="text-rose-700 text-sm mb-2">Starting Q3, random shocks may hit: economic downturns, regulatory changes, 
            competitor moves, talent wars, or tech disruptions.</p>
            <p class="text-rose-600 text-xs">You'll get 3 response options-choose wisely!</p>
          </div>
          <div class="bg-cyan-50 rounded-xl p-4 mb-3">
            <h4 class="font-bold text-cyan-800 mb-2">ğŸª Conference Mini-Game (M1)</h4>
            <p class="text-cyan-700 text-sm">45-second action game! Click delegates, hand out swag, compete with rivals for industry attention.</p>
          </div>
          <div class="bg-violet-50 rounded-xl p-4 mb-3">
            <h4 class="font-bold text-violet-800 mb-2">ğŸ¤ Investor Pitch (M2)</h4>
            <p class="text-violet-700 text-sm">30-second pitch to skeptical investors! Tell stories, share data, keep their attention high.</p>
          </div>
          <div class="bg-emerald-50 rounded-xl p-4 mb-3">
            <h4 class="font-bold text-emerald-800 mb-2">ğŸª Demo Day (M3)</h4>
            <p class="text-emerald-700 text-sm mb-2">60 seconds at your trade show booth! Visitors approach with visual hints about their value.</p>
            <ul class="text-emerald-600 text-xs space-y-1">
              <li>â€¢ <strong>Engage</strong> visitors first to reveal their value and preferences</li>
              <li>â€¢ <strong>Green offers</strong> match preferences for bigger interest boosts</li>
              <li>â€¢ <strong>Convert</strong> when interest hits 75% to close the deal</li>
              <li>â€¢ <strong>Skip time-wasters</strong> (Â£0 value) quickly!</li>
            </ul>
          </div>
          <div class="bg-amber-50 rounded-xl p-4">
            <h4 class="font-bold text-amber-800 mb-2">âš  Demo Day: Premium Offer Warning</h4>
            <p class="text-amber-700 text-sm">Demo (-Â£25k) and Custom (-Â£40k) give huge boosts but require follow-up work. 
            <strong>Using 5+ costs 1 AP, 6+ costs 2 AP!</strong> Save them for high-value visitors.</p>
          </div>
        `
      },
      14: {
        title: "Competitors & Life Events ğŸ",
        icon: "ğŸ¦Š",
        content: `
          <p class="text-slate-600 mb-4">
            Two more elements add unpredictability to your journey:
          </p>
          <div class="bg-indigo-50 rounded-xl p-4 mb-3">
            <h4 class="font-bold text-indigo-800 mb-2">ğŸ Your Competitors</h4>
            <p class="text-indigo-700 text-sm mb-2"><strong>3 rival startups</strong> in your sector are racing for the same milestones. 
            Click their names to learn about their strategies.</p>
            <p class="text-indigo-600 text-xs">Complete a milestone first for a <strong>first-mover bonus</strong>. Watch the leaderboard!</p>
          </div>
          <div class="bg-violet-50 rounded-xl p-4">
            <h4 class="font-bold text-violet-800 mb-2">ğŸ² Life Happens</h4>
            <p class="text-violet-700 text-sm mb-2">Occasionally, random life events interrupt your plans - team chaos, personal demands, 
            or good fortune like cultural celebrations (ğŸª”ğŸŒ™ğŸ‰ğŸ•) and unexpected windfalls.</p>
            <p class="text-violet-600 text-xs">These are rare (1-2 per game) but add to the unpredictability of startup life.</p>
          </div>
        `
      },
      15: {
        title: "Strategic Pivots ğŸ”„",
        icon: "ğŸ”„",
        content: `
          <p class="text-slate-600 mb-4">
            Sometimes the best path forward is a <strong>new direction</strong>. The pivot system lets you change your company's strategic focus.
          </p>
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-violet-50 rounded-xl p-4">
              <h4 class="font-bold text-violet-800 mb-2">ğŸ”„ Strategic Review</h4>
              <p class="text-violet-700 text-sm">Proactive choice when you're struggling or see a better opportunity. Available after your first milestone.</p>
            </div>
            <div class="bg-rose-50 rounded-xl p-4">
              <h4 class="font-bold text-rose-800 mb-2">âš ï¸ Market Shift</h4>
              <p class="text-rose-700 text-sm">Forced response when a competitor completes their milestone before you. You must decide how to respond.</p>
            </div>
          </div>
          <div class="bg-slate-50 rounded-xl p-4 mb-4">
            <h4 class="font-bold text-slate-800 mb-2">Pivot Options</h4>
            <div class="grid grid-cols-2 gap-2 text-sm">
              <div class="flex items-center gap-2"><span class="text-violet-600">ğŸ¯</span> <span>Customer Pivot - sell to different buyers</span></div>
              <div class="flex items-center gap-2"><span class="text-amber-600">ğŸ’¡</span> <span>Problem Pivot - solve different pain point</span></div>
              <div class="flex items-center gap-2"><span class="text-rose-600">ğŸ”§</span> <span>Tech Pivot - build it differently</span></div>
              <div class="flex items-center gap-2"><span class="text-emerald-600">ğŸ¯</span> <span>Narrow Focus - become the specialist</span></div>
            </div>
          </div>
          <div class="bg-amber-50 rounded-xl p-4">
            <h4 class="font-bold text-amber-800 mb-2">ğŸ’¡ Pivot Wisdom</h4>
            <ul class="text-amber-700 text-sm space-y-1">
              <li>â€¢ Some progress carries overâ€”you're not starting from zero</li>
              <li>â€¢ Pivots have transition costs (cash and time)</li>
              <li>â€¢ You can rename your company to match your new direction</li>
              <li>â€¢ "Compete Head-On" keeps all progress but takes a valuation hit</li>
            </ul>
          </div>
        `
      },
      16: {
        title: "You're Ready! ğŸ“",
        icon: "ğŸš€",
        content: `
          <p class="text-slate-600 mb-4">
            You now know everything you need. Here's your quick reference:
          </p>
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-indigo-50 rounded-lg p-3">
              <div class="font-bold text-indigo-700 text-sm mb-1">ğŸ¯ Goal</div>
              <p class="text-indigo-600 text-xs">Complete 3 milestones before running out of cash or time</p>
            </div>
            <div class="bg-emerald-50 rounded-lg p-3">
              <div class="font-bold text-emerald-700 text-sm mb-1">âš¡ Each Quarter</div>
              <p class="text-emerald-600 text-xs">Spend 5 AP wisely, bank up to 2 unused</p>
            </div>
            <div class="bg-amber-50 rounded-lg p-3">
              <div class="font-bold text-amber-700 text-sm mb-1">ğŸ‘¥ Team</div>
              <p class="text-amber-600 text-xs">Keep execs happy, unlock HR after M1</p>
            </div>
            <div class="bg-rose-50 rounded-lg p-3">
              <div class="font-bold text-rose-700 text-sm mb-1">ğŸ’° Survival</div>
              <p class="text-rose-600 text-xs">Watch runway, raise when needed</p>
            </div>
            <div class="bg-violet-50 rounded-lg p-3">
              <div class="font-bold text-violet-700 text-sm mb-1">ğŸ Competitors</div>
              <p class="text-violet-600 text-xs">3 rivals racing you - aim for first-mover bonuses</p>
            </div>
            <div class="bg-cyan-50 rounded-lg p-3">
              <div class="font-bold text-cyan-700 text-sm mb-1">âš¡ Events</div>
              <p class="text-cyan-600 text-xs">Adapt to shocks, life events, and mini-games</p>
            </div>
          </div>
          <div class="bg-purple-50 rounded-lg p-3 mb-4 border border-purple-200">
            <div class="font-bold text-purple-700 text-sm mb-1">ğŸ”„ Pivots</div>
            <p class="text-purple-600 text-xs">If competitors get ahead or you're struggling, pivot to a new directionâ€”some progress carries over</p>
          </div>
          <div class="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl p-4 text-center border border-emerald-200">
            <div class="text-3xl mb-2">ğŸ€</div>
            <p class="text-emerald-800 font-medium">Good luck, founder!</p>
            <p class="text-emerald-600 text-sm">90% of startups fail. But you've got this. Learn, adapt, and try again!</p>
          </div>
        `
      }
    };
    
    const t = tutorials[step];
    return `
      <div class="text-center mb-6">
        <div class="text-5xl mb-3">${t.icon}</div>
        <h2 class="text-2xl font-bold text-slate-800">${t.title}</h2>
      </div>
      ${t.content}
    `;
  }

  // Beginner tutorial with visual mockups
  getBeginnerTutorialContent(step) {
    const tutorials = {
      1: {
        title: "Welcome to the Guided Tour! ğŸŒ±",
        icon: "ğŸ‘‹",
        content: `
          <p class="text-slate-600 mb-4">
            This tutorial will walk you through <strong>every part of the game</strong> with visual examples 
            of the actual screens you'll see. Take your time-understanding these basics will help you succeed!
          </p>
          <div class="bg-emerald-50 rounded-xl p-4 mb-4 border border-emerald-200">
            <h4 class="font-bold text-emerald-800 mb-2">ğŸ¯ What You'll Learn</h4>
            <ul class="text-emerald-700 text-sm space-y-1">
              <li>â€¢ How to read and understand every screen</li>
              <li>â€¢ What all the numbers and buttons mean</li>
              <li>â€¢ How to make good decisions</li>
              <li>â€¢ Common mistakes to avoid</li>
            </ul>
          </div>
          <div class="bg-indigo-50 rounded-xl p-4">
            <h4 class="font-bold text-indigo-800 mb-2">ğŸ® The Big Picture</h4>
            <p class="text-indigo-700 text-sm">You're the CEO of an AI startup. Each quarter, you'll make strategic decisions 
            to grow your company. Complete 3 milestones before running out of money to win!</p>
          </div>
        `
      },
      2: {
        title: "Win & Lose Conditions ğŸ†",
        icon: "ğŸ¯",
        content: `
          <p class="text-slate-600 mb-4">Before we dive in, let's be clear about <strong>how you win and lose</strong>:</p>
          
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div class="bg-emerald-50 rounded-xl p-4 border-2 border-emerald-300">
              <div class="text-3xl text-center mb-2">ğŸ†</div>
              <div class="font-bold text-emerald-800 text-center mb-2">YOU WIN</div>
              <p class="text-emerald-700 text-sm text-center">Complete all 3 milestones before Q16</p>
            </div>
            <div class="bg-rose-50 rounded-xl p-4 border-2 border-rose-300">
              <div class="text-3xl text-center mb-2">ğŸ’€</div>
              <div class="font-bold text-rose-800 text-center mb-2">YOU LOSE</div>
              <ul class="text-rose-700 text-sm space-y-1">
                <li>â€¢ Cash hits Â£0</li>
                <li>â€¢ Miss a milestone deadline</li>
              </ul>
            </div>
          </div>
          
          <div class="bg-purple-50 rounded-xl p-4 mb-4 border border-purple-200">
            <h4 class="font-bold text-purple-800 mb-2">âš”ï¸ Competition & Pivots</h4>
            <p class="text-purple-700 text-sm"><strong>3 rival startups</strong> are racing you to the same milestones. If they get ahead, you'll need to <strong>pivot</strong>â€”change your strategy to find a new path to victory. Don't worry, we'll cover this in detail!</p>
          </div>
          
          <div class="bg-amber-50 rounded-xl p-4">
            <h4 class="font-bold text-amber-800 mb-2">â° Time Pressure</h4>
            <p class="text-amber-700 text-sm">Each milestone has a deadline (measured in quarters). 
            If you don't complete a milestone in time, the board loses confidence and shuts you down. 
            <strong>Always check your deadline!</strong></p>
          </div>
        `
      },
      3: {
        title: "The Header Bar ğŸ“Š",
        icon: "ğŸ”",
        content: `
          <p class="text-slate-600 mb-4">This bar appears at the top of every screen. <strong>It's your dashboard</strong>-check it constantly!</p>
          
          <!-- Header mockup -->
          <div class="bg-slate-800 rounded-xl p-3 mb-4 text-white text-sm">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <span class="font-bold">The AI Startup Game</span>
                <span class="text-slate-400">ğŸ¢ Your Company</span>
              </div>
              <div class="flex items-center gap-6 text-xs">
                <div class="text-center">
                  <div class="text-slate-400">Quarter</div>
                  <div class="font-mono font-bold text-white">Q1</div>
                </div>
                <div class="text-center relative">
                  <div class="text-slate-400">Cash</div>
                  <div class="font-mono font-bold text-emerald-400">Â£500k</div>
                  <div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                </div>
                <div class="text-center relative">
                  <div class="text-slate-400">Runway</div>
                  <div class="font-mono font-bold text-amber-400">5q</div>
                  <div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                </div>
                <div class="text-center">
                  <div class="text-slate-400">Valuation</div>
                  <div class="font-mono font-bold text-sky-400">Â£1.2M</div>
                </div>
                <div class="text-center relative">
                  <div class="text-slate-400">Milestones</div>
                  <div class="font-mono font-bold text-white">0/3</div>
                  <div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-2 text-xs">
            <div class="bg-slate-100 rounded-lg p-2">
              <span class="font-bold text-emerald-600">Cash:</span> Your money. Don't let it hit Â£0!
            </div>
            <div class="bg-slate-100 rounded-lg p-2">
              <span class="font-bold text-amber-600">Runway:</span> Quarters until cash runs out
            </div>
            <div class="bg-slate-100 rounded-lg p-2">
              <span class="font-bold text-sky-600">Valuation:</span> What your company is worth
            </div>
            <div class="bg-slate-100 rounded-lg p-2">
              <span class="font-bold text-slate-600">Milestones:</span> Progress toward winning
            </div>
          </div>
        `
      },
      4: {
        title: "Understanding Cash ğŸ’µ",
        icon: "ğŸ’°",
        content: `
          <p class="text-slate-600 mb-4"><strong>Cash is your lifeline.</strong> Every quarter, you pay salaries and costs (your "burn rate"). 
          When cash hits zero, the game ends immediately.</p>
          
          <!-- Cash flow diagram -->
          <div class="bg-slate-50 rounded-xl p-4 mb-4">
            <div class="flex items-center justify-around text-center">
              <div>
                <div class="text-3xl mb-1">ğŸ’°</div>
                <div class="font-bold text-emerald-600">Â£500k</div>
                <div class="text-xs text-slate-500">Current Cash</div>
              </div>
              <div class="text-2xl text-slate-400">â†’</div>
              <div>
                <div class="text-3xl mb-1">ğŸ”¥</div>
                <div class="font-bold text-rose-600">-Â£100k/q</div>
                <div class="text-xs text-slate-500">Burn Rate</div>
              </div>
              <div class="text-2xl text-slate-400">â†’</div>
              <div>
                <div class="text-3xl mb-1">â³</div>
                <div class="font-bold text-amber-600">5 quarters</div>
                <div class="text-xs text-slate-500">Runway</div>
              </div>
            </div>
          </div>
          
          <div class="bg-rose-50 rounded-xl p-4 mb-3">
            <h4 class="font-bold text-rose-800 mb-2">ğŸ”¥ What Increases Burn Rate?</h4>
            <ul class="text-rose-700 text-sm space-y-1">
              <li>â€¢ <strong>Executive salaries</strong> - each exec costs Â£15-30k per quarter</li>
              <li>â€¢ <strong>Staff count</strong> - more people = higher costs</li>
              <li>â€¢ <strong>Location</strong> - London is most expensive</li>
              <li>â€¢ <strong>Some decisions</strong> - investing in R&D, marketing campaigns, etc.</li>
            </ul>
          </div>
          
          <div class="bg-emerald-50 rounded-xl p-4">
            <h4 class="font-bold text-emerald-800 mb-2">ğŸ’¡ How to Get More Cash</h4>
            <ul class="text-emerald-700 text-sm space-y-1">
              <li>â€¢ <strong>Raise funding</strong> from investors (but you lose equity)</li>
              <li>â€¢ <strong>Complete milestones</strong> - attracts customers &amp; boosts sales</li>
              <li>â€¢ <strong>Win mini-games</strong> - conferences and pitches earn money</li>
            </ul>
          </div>
        `
      },
      5: {
        title: "Understanding Runway â³",
        icon: "ğŸƒ",
        content: `
          <p class="text-slate-600 mb-4"><strong>Runway = Cash Ã· Burn Rate</strong>. It tells you how many quarters you can survive 
          at your current spending rate.</p>
          
          <!-- Runway gauge -->
          <div class="bg-slate-100 rounded-xl p-4 mb-4">
            <div class="text-center text-sm text-slate-600 mb-3">Runway Health Indicator</div>
            <div class="flex items-center gap-1 mb-2">
              <div class="flex-1 h-8 bg-rose-500 rounded-l-lg flex items-center justify-center text-white text-xs font-bold">1-2q ğŸ˜°</div>
              <div class="flex-1 h-8 bg-amber-500 flex items-center justify-center text-white text-xs font-bold">3-4q ğŸ˜Ÿ</div>
              <div class="flex-1 h-8 bg-emerald-500 rounded-r-lg flex items-center justify-center text-white text-xs font-bold">5+q ğŸ˜Š</div>
            </div>
            <div class="text-center text-xs text-slate-500">The higher your runway, the safer you are</div>
          </div>
          
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-rose-50 rounded-lg p-3 border border-rose-200">
              <div class="font-bold text-rose-700 text-sm mb-1">âš  Danger Zone (1-2q)</div>
              <p class="text-rose-600 text-xs">Raise funding immediately or you'll run out of cash!</p>
            </div>
            <div class="bg-amber-50 rounded-lg p-3 border border-amber-200">
              <div class="font-bold text-amber-700 text-sm mb-1">ğŸ˜Ÿ Caution (3-4q)</div>
              <p class="text-amber-600 text-xs">Start thinking about your next fundraise.</p>
            </div>
            <div class="bg-emerald-50 rounded-lg p-3 border border-emerald-200">
              <div class="font-bold text-emerald-700 text-sm mb-1">ğŸ˜Š Safe (5+q)</div>
              <p class="text-emerald-600 text-xs">Comfortable runway. Focus on growing!</p>
            </div>
            <div class="bg-sky-50 rounded-lg p-3 border border-sky-200">
              <div class="font-bold text-sky-700 text-sm mb-1">ğŸ’¡ Pro Tip</div>
              <p class="text-sky-600 text-xs">Always keep runway above 3 quarters if possible.</p>
            </div>
          </div>
        `
      },
      6: {
        title: "Understanding Valuation ğŸ“ˆ",
        icon: "ğŸ’",
        content: `
          <p class="text-slate-600 mb-4"><strong>Valuation is what your company is worth.</strong> Higher valuation means 
          better funding terms and a bigger exit if you win.</p>
          
          <!-- Valuation growth visual -->
          <div class="bg-gradient-to-r from-indigo-50 to-violet-50 rounded-xl p-4 mb-4 border border-indigo-200">
            <div class="text-center mb-3 text-sm text-indigo-700 font-medium">Valuation Growth Path</div>
            <div class="flex items-end justify-around h-24 gap-2">
              <div class="flex flex-col items-center">
                <div class="w-12 bg-indigo-300 rounded-t" style="height: 30px"></div>
                <div class="text-xs mt-1 text-slate-600">Start</div>
                <div class="text-xs text-indigo-600 font-bold">Â£800k</div>
              </div>
              <div class="flex flex-col items-center">
                <div class="w-12 bg-indigo-400 rounded-t" style="height: 50px"></div>
                <div class="text-xs mt-1 text-slate-600">M1</div>
                <div class="text-xs text-indigo-600 font-bold">Â£2M</div>
              </div>
              <div class="flex flex-col items-center">
                <div class="w-12 bg-indigo-500 rounded-t" style="height: 70px"></div>
                <div class="text-xs mt-1 text-slate-600">M2</div>
                <div class="text-xs text-indigo-600 font-bold">Â£5M</div>
              </div>
              <div class="flex flex-col items-center">
                <div class="w-12 bg-indigo-600 rounded-t" style="height: 96px"></div>
                <div class="text-xs mt-1 text-slate-600">M3</div>
                <div class="text-xs text-indigo-600 font-bold">Â£15M+</div>
              </div>
            </div>
          </div>
          
          <div class="bg-emerald-50 rounded-xl p-4 mb-3">
            <h4 class="font-bold text-emerald-800 mb-2">ğŸ“ˆ What Increases Valuation?</h4>
            <ul class="text-emerald-700 text-sm space-y-1">
              <li>â€¢ <strong>Completing milestones</strong> - biggest jumps</li>
              <li>â€¢ <strong>Growing your metrics</strong> - Science, Product, Marketing</li>
              <li>â€¢ <strong>Market conditions</strong> - AI hype helps!</li>
            </ul>
          </div>
          
          <div class="bg-violet-50 rounded-xl p-4">
            <h4 class="font-bold text-violet-800 mb-2">ğŸ’¡ Why It Matters</h4>
            <p class="text-violet-700 text-sm">When you raise funding, higher valuation = less equity given away. 
            At Â£1M valuation, raising Â£200k costs 20% equity. At Â£2M valuation, same Â£200k only costs 10%!</p>
          </div>
        `
      },
      7: {
        title: "Milestones: Key to Victory ğŸ¯",
        icon: "ğŸ…",
        content: `
          <p class="text-slate-600 mb-4"><strong>Milestones are your main objectives.</strong> Complete all 3 to win the game. 
          Each milestone has requirements and a deadline.</p>
          
          <!-- Milestone mockup -->
          <div class="bg-white border-2 border-slate-200 rounded-xl p-4 mb-4 shadow-sm">
            <div class="flex items-center justify-between mb-3">
              <div>
                <div class="text-xs text-slate-500 uppercase tracking-wide">Current Milestone</div>
                <div class="font-bold text-slate-800">ğŸ”¬ First Prototype</div>
              </div>
              <div class="text-right">
                <div class="text-xs text-slate-500">Deadline</div>
                <div class="font-bold text-amber-600">Q4 (3 quarters left)</div>
              </div>
            </div>
            <div class="mb-2">
              <div class="flex justify-between text-xs mb-1">
                <span class="text-slate-600">Progress</span>
                <span class="font-bold text-emerald-600">65%</span>
              </div>
              <div class="h-4 bg-slate-100 rounded-full overflow-hidden">
                <div class="h-full bg-gradient-to-r from-emerald-400 to-emerald-500 rounded-full" style="width: 65%"></div>
              </div>
            </div>
            <div class="text-xs text-slate-500">Focus: <span class="text-indigo-600 font-medium">Research + Product</span></div>
          </div>
          
          <div class="grid grid-cols-3 gap-2 mb-4">
            <div class="bg-indigo-50 rounded-lg p-3 text-center border border-indigo-200">
              <div class="text-xl mb-1">ğŸ”¬</div>
              <div class="font-bold text-indigo-800 text-xs">M1: Prototype</div>
              <div class="text-indigo-600 text-[10px]">Research + Dev</div>
            </div>
            <div class="bg-violet-50 rounded-lg p-3 text-center border border-violet-200">
              <div class="text-xl mb-1">ğŸš€</div>
              <div class="font-bold text-violet-800 text-xs">M2: Market Fit</div>
              <div class="text-violet-600 text-[10px]">Dev + Marketing</div>
            </div>
            <div class="bg-emerald-50 rounded-lg p-3 text-center border border-emerald-200">
              <div class="text-xl mb-1">ğŸ“ˆ</div>
              <div class="font-bold text-emerald-800 text-xs">M3: Scale</div>
              <div class="text-emerald-600 text-[10px]">All areas</div>
            </div>
          </div>
          
          <div class="bg-amber-50 rounded-xl p-4">
            <h4 class="font-bold text-amber-800 mb-2">âš  Important!</h4>
            <p class="text-amber-700 text-sm">Focus on decisions that boost the <strong>focus areas</strong> shown for your current milestone. 
            Research + Product choices are most valuable during Milestone 1!</p>
          </div>
        `
      },
      8: {
        title: "Setup Steps: Founder & Startup ğŸ¢",
        icon: "ğŸ‘¤",
        content: `
          <p class="text-slate-600 mb-4">When you start the game, you'll first <strong>create your founder</strong>-choosing 
          a background like Academic, Serial Founder, or Technical Prodigy. Then you'll <strong>choose which AI startup to run</strong>.</p>
          
          <div class="bg-violet-50 rounded-xl p-4 mb-4">
            <h4 class="font-bold text-violet-800 mb-2">ğŸ‘¤ Your Founder</h4>
            <p class="text-violet-700 text-sm">Your founder's background affects starting bonuses-an Academic has research strengths, 
            while a Dealmaker excels at commercial activities. Pick what fits your playstyle!</p>
          </div>
          
          <!-- Startup selection mockup -->
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="border-2 border-slate-200 rounded-xl p-3 bg-white hover:border-indigo-400 transition-colors">
              <div class="flex items-center gap-2 mb-2">
                <div class="w-10 h-10 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-lg flex items-center justify-center text-white text-lg">ğŸ§¬</div>
                <div>
                  <div class="text-xs text-slate-500">BioTech</div>
                  <div class="font-bold text-slate-800 text-sm">Aether BioLabs</div>
                </div>
              </div>
              <p class="text-xs text-slate-600">AI-powered drug discovery</p>
            </div>
            <div class="border-2 border-indigo-400 rounded-xl p-3 bg-indigo-50">
              <div class="flex items-center gap-2 mb-2">
                <div class="w-10 h-10 bg-gradient-to-br from-orange-400 to-red-500 rounded-lg flex items-center justify-center text-white text-lg">ğŸ¤–</div>
                <div>
                  <div class="text-xs text-slate-500">Robotics</div>
                  <div class="font-bold text-slate-800 text-sm">Forged Dynamics</div>
                </div>
              </div>
              <p class="text-xs text-slate-600">Autonomous warehouse robots</p>
              <div class="text-xs text-indigo-600 font-medium mt-1">âœ“ Selected</div>
            </div>
          </div>
          
          <div class="bg-sky-50 rounded-xl p-4">
            <h4 class="font-bold text-sky-800 mb-2">ğŸ’¡ Tip for Beginners</h4>
            <p class="text-sky-700 text-sm">All startups are balanced for difficulty. Choose based on what sounds interesting to you!</p>
          </div>
        `
      },
      9: {
        title: "Setup: Pick Your Location ğŸ“",
        icon: "ğŸ—º",
        content: `
          <p class="text-slate-600 mb-4"><strong>Location affects your costs and starting bonuses.</strong> 
          London is expensive but prestigious. Other cities are cheaper with different advantages.</p>
          
          <!-- Location selection mockup -->
          <div class="bg-white border rounded-xl p-3 mb-4 space-y-2">
            <div class="flex items-center justify-between p-2 bg-rose-50 border border-rose-200 rounded-lg">
              <div class="flex items-center gap-2">
                <span class="text-lg">ğŸ›</span>
                <div>
                  <div class="font-bold text-sm">London</div>
                  <div class="text-xs text-slate-500">Tech hub, investors nearby</div>
                </div>
              </div>
              <div class="text-right text-xs">
                <div class="text-rose-600 font-bold">Â£Â£Â£ Expensive</div>
                <div class="text-emerald-600">â†‘ Marketing</div>
              </div>
            </div>
            <div class="flex items-center justify-between p-2 bg-indigo-50 border border-indigo-200 rounded-lg">
              <div class="flex items-center gap-2">
                <span class="text-lg">ğŸ“</span>
                <div>
                  <div class="font-bold text-sm">Oxford</div>
                  <div class="text-xs text-slate-500">University talent pool</div>
                </div>
              </div>
              <div class="text-right text-xs">
                <div class="text-amber-600 font-bold">Â£Â£ Moderate</div>
                <div class="text-emerald-600">â†‘â†‘ Research</div>
              </div>
            </div>
            <div class="flex items-center justify-between p-2 bg-slate-50 border rounded-lg">
              <div class="flex items-center gap-2">
                <span class="text-lg">ğŸ´</span>
                <div>
                  <div class="font-bold text-sm">Edinburgh</div>
                  <div class="text-xs text-slate-500">Strong AI community</div>
                </div>
              </div>
              <div class="text-right text-xs">
                <div class="text-emerald-600 font-bold">Â£ Affordable</div>
                <div class="text-emerald-600">â†‘ Research, â†‘ Dev</div>
              </div>
            </div>
          </div>
          
          <div class="bg-amber-50 rounded-xl p-4">
            <h4 class="font-bold text-amber-800 mb-2">âš  Cost Matters!</h4>
            <p class="text-amber-700 text-sm">London salaries are 20-30% higher than other cities. 
            If you're worried about running out of money, a cheaper location gives you more runway. 
            <strong>Edinburgh or Manchester are great for beginners.</strong></p>
          </div>
        `
      },
      10: {
        title: "Setup: Select Funding Path ğŸ’°",
        icon: "ğŸ¦",
        content: `
          <p class="text-slate-600 mb-4"><strong>Your starting funding determines how much cash and equity you begin with.</strong> 
          More funding = more runway, but less ownership.</p>
          
          <!-- Funding path mockup -->
          <div class="space-y-3 mb-4">
            <div class="border-2 border-slate-200 rounded-xl p-3 bg-white">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-12 h-12 bg-amber-100 rounded-lg flex items-center justify-center text-2xl">ğŸ¥¾</div>
                  <div>
                    <div class="font-bold text-slate-800">Bootstrap</div>
                    <div class="text-xs text-slate-500">Self-funded, full control</div>
                  </div>
                </div>
                <div class="text-right text-sm">
                  <div class="text-emerald-600 font-bold">Â£150k cash</div>
                  <div class="text-violet-600">100% equity</div>
                </div>
              </div>
              <div class="mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded">âš  Hardest - very short runway!</div>
            </div>
            
            <div class="border-2 border-indigo-400 rounded-xl p-3 bg-indigo-50">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-12 h-12 bg-sky-100 rounded-lg flex items-center justify-center text-2xl">ğŸ‘¼</div>
                  <div>
                    <div class="font-bold text-slate-800">Angel Investment</div>
                    <div class="text-xs text-slate-500">Wealthy individual investor</div>
                  </div>
                </div>
                <div class="text-right text-sm">
                  <div class="text-emerald-600 font-bold">Â£350k cash</div>
                  <div class="text-violet-600">85% equity</div>
                </div>
              </div>
              <div class="mt-2 text-xs text-emerald-600 bg-emerald-50 p-2 rounded">âœ“ Recommended for beginners</div>
            </div>
            
            <div class="border-2 border-slate-200 rounded-xl p-3 bg-white">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-12 h-12 bg-violet-100 rounded-lg flex items-center justify-center text-2xl">ğŸ›</div>
                  <div>
                    <div class="font-bold text-slate-800">VC Funding</div>
                    <div class="text-xs text-slate-500">Venture capital fund</div>
                  </div>
                </div>
                <div class="text-right text-sm">
                  <div class="text-emerald-600 font-bold">Â£600k cash</div>
                  <div class="text-violet-600">70% equity</div>
                </div>
              </div>
              <div class="mt-2 text-xs text-slate-500 bg-slate-50 p-2 rounded">More cash, but investor has expectations</div>
            </div>
          </div>
          
          <div class="bg-sky-50 rounded-xl p-4">
            <h4 class="font-bold text-sky-800 mb-2">ğŸ’¡ Beginner Recommendation</h4>
            <p class="text-sky-700 text-sm">Choose <strong>Angel Investment</strong> for your first game. 
            It gives you enough runway to learn without the pressure of Bootstrap or the complexity of VC expectations.</p>
          </div>
        `
      },
      11: {
        title: "Setup: Hire Your Team ğŸ‘¥",
        icon: "ğŸ‘”",
        content: `
          <p class="text-slate-600 mb-4"><strong>You'll hire 3 executives</strong>-one each for Research, Product, and Sales. 
          Each has different skills and salary costs.</p>
          
          <!-- Hiring mockup -->
          <div class="bg-white border rounded-xl p-4 mb-4">
            <div class="text-center mb-3">
              <span class="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium">Hiring: Head of Research ğŸ”¬</span>
            </div>
            <div class="grid grid-cols-2 gap-3">
              <div class="border-2 border-slate-200 rounded-lg p-3 hover:border-indigo-400 transition-colors">
                <div class="flex items-center gap-2 mb-2">
                  <div class="w-10 h-10 bg-slate-200 rounded-full"></div>
                  <div>
                    <div class="font-bold text-sm">Dr. Sarah Chen</div>
                    <div class="text-xs text-slate-500">Former CortexAI</div>
                  </div>
                </div>
                <div class="flex justify-between text-xs">
                  <span class="text-emerald-600">â­â­â­ Research</span>
                  <span class="text-rose-600">Â£25k/q</span>
                </div>
              </div>
              <div class="border-2 border-indigo-400 rounded-lg p-3 bg-indigo-50">
                <div class="flex items-center gap-2 mb-2">
                  <div class="w-10 h-10 bg-slate-200 rounded-full"></div>
                  <div>
                    <div class="font-bold text-sm">Dr. James Wright</div>
                    <div class="text-xs text-slate-500">University spinout</div>
                  </div>
                </div>
                <div class="flex justify-between text-xs">
                  <span class="text-emerald-600">â­â­ Research</span>
                  <span class="text-rose-600">Â£18k/q</span>
                </div>
                <div class="text-xs text-indigo-600 font-medium mt-1">âœ“ Selected</div>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-emerald-50 rounded-lg p-3">
              <h4 class="font-bold text-emerald-700 text-sm mb-1">High Skill = High Cost</h4>
              <p class="text-emerald-600 text-xs">Star performers boost stats more but cost more per quarter.</p>
            </div>
            <div class="bg-amber-50 rounded-lg p-3">
              <h4 class="font-bold text-amber-700 text-sm mb-1">Watch Your Burn!</h4>
              <p class="text-amber-600 text-xs">Three expensive execs can eat through cash fast.</p>
            </div>
          </div>
          
          <div class="bg-sky-50 rounded-xl p-4">
            <h4 class="font-bold text-sky-800 mb-2">ğŸ’¡ Beginner Tip</h4>
            <p class="text-sky-700 text-sm">For your first game, pick <strong>mid-tier executives</strong> (not the cheapest or most expensive). 
            This balances capability with affordability. You can always hire better people later!</p>
          </div>
        `
      },
      12: {
        title: "The Main Game Screen ğŸ–¥",
        icon: "ğŸ®",
        content: `
          <p class="text-slate-600 mb-4">After setup, you'll see the main game screen. <strong>Let's learn what each section does.</strong></p>
          
          <!-- Main screen layout mockup -->
          <div class="bg-slate-800 rounded-xl p-2 mb-4">
            <div class="bg-slate-700 rounded p-1 mb-2 text-white text-xs text-center">ğŸ“Š Header Bar (always visible)</div>
            <div class="flex gap-2">
              <div class="flex-1 bg-white rounded p-2">
                <div class="bg-indigo-100 rounded p-2 mb-2 text-center text-xs text-indigo-700 font-medium">ğŸ“‹ Decision Area</div>
                <div class="bg-slate-100 rounded p-1 text-xs text-slate-500 text-center mb-2">Executive presents options</div>
                <div class="grid grid-cols-3 gap-1">
                  <div class="bg-emerald-100 rounded p-1 text-[8px] text-center">Option A</div>
                  <div class="bg-amber-100 rounded p-1 text-[8px] text-center">Option B</div>
                  <div class="bg-rose-100 rounded p-1 text-[8px] text-center">Pass</div>
                </div>
              </div>
              <div class="w-48 bg-slate-100 rounded p-2">
                <div class="text-xs font-medium text-slate-700 mb-2">ğŸ“ˆ Company Dashboard</div>
                <div class="space-y-1 text-[8px]">
                  <div class="bg-white rounded p-1">Milestone Progress</div>
                  <div class="bg-white rounded p-1">Attention Points</div>
                  <div class="bg-white rounded p-1">Team Moods</div>
                  <div class="bg-white rounded p-1">Stats</div>
                  <div class="bg-white rounded p-1">Hire/Fire</div>
                  <div class="bg-white rounded p-1">Raise Funding</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-indigo-50 rounded-lg p-3 border border-indigo-200">
              <h4 class="font-bold text-indigo-700 text-sm mb-1">ğŸ“‹ Decision Area</h4>
              <p class="text-indigo-600 text-xs">This is where you spend most of your time. Each executive presents strategic options. Choose wisely!</p>
            </div>
            <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
              <h4 class="font-bold text-slate-700 text-sm mb-1">ğŸ“ˆ Dashboard</h4>
              <p class="text-slate-600 text-xs">Shows your progress, stats, team, and key actions like hiring or fundraising.</p>
            </div>
          </div>
        `
      },
      13: {
        title: "The Decision Cards ğŸƒ",
        icon: "ğŸ“‹",
        content: `
          <p class="text-slate-600 mb-4"><strong>Each quarter, your executives present strategic options.</strong> 
          Here's how to read a decision card:</p>
          
          <!-- Decision card mockup -->
          <div class="bg-white border-2 border-slate-200 rounded-xl p-4 mb-4 shadow-sm">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center text-2xl">ğŸ”¬</div>
              <div>
                <div class="text-xs text-slate-500">Dr. Sarah Chen â€¢ Head of Research</div>
                <div class="font-bold text-slate-800">Research Strategy</div>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-3">
              <!-- Option A -->
              <div class="border-2 border-emerald-400 rounded-lg p-3 bg-emerald-50 relative">
                <div class="absolute -top-2 -right-2 bg-emerald-500 text-white text-xs px-2 py-0.5 rounded-full">â­ Recommended</div>
                <div class="font-bold text-sm text-slate-800 mb-2">Publish Research Paper</div>
                <p class="text-xs text-slate-600 mb-2">Share findings to build academic credibility</p>
                <div class="flex items-center gap-2 text-xs">
                  <span class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded">2 AP</span>
                  <span class="text-emerald-600">â†‘â†‘ Science</span>
                  <span class="text-sky-600">â†‘ Marketing</span>
                </div>
              </div>
              
              <!-- Option B -->
              <div class="border-2 border-slate-200 rounded-lg p-3 bg-white">
                <div class="font-bold text-sm text-slate-800 mb-2">Secret R&D Push</div>
                <p class="text-xs text-slate-600 mb-2">Keep research private for competitive advantage</p>
                <div class="flex items-center gap-2 text-xs">
                  <span class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded">3 AP</span>
                  <span class="text-emerald-600">â†‘â†‘â†‘ Science</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-3 gap-2 text-xs">
            <div class="bg-indigo-50 rounded-lg p-2 border border-indigo-200">
              <div class="font-bold text-indigo-700">AP Cost</div>
              <p class="text-indigo-600">How many Attention Points it uses</p>
            </div>
            <div class="bg-emerald-50 rounded-lg p-2 border border-emerald-200">
              <div class="font-bold text-emerald-700">Impact</div>
              <p class="text-emerald-600">â†‘ small, â†‘â†‘ good, â†‘â†‘â†‘ major</p>
            </div>
            <div class="bg-amber-50 rounded-lg p-2 border border-amber-200">
              <div class="font-bold text-amber-700">â­ Recommended</div>
              <p class="text-amber-600">Investor suggests this option</p>
            </div>
          </div>
        `
      },
      14: {
        title: "Attention Points (AP) âš¡",
        icon: "âš¡",
        content: `
          <p class="text-slate-600 mb-4"><strong>Attention Points are your most limited resource.</strong> 
          You have 5 AP per quarter to spend on decisions. You can't do everything!</p>
          
          <!-- AP display mockup -->
          <div class="bg-gradient-to-r from-indigo-50 to-violet-50 rounded-xl p-4 mb-4 border border-indigo-200">
            <div class="text-center mb-3">
              <div class="text-sm text-slate-600 mb-1">Attention Points Available</div>
              <div class="flex justify-center gap-2">
                <div class="w-10 h-10 rounded-lg bg-emerald-500 text-white flex items-center justify-center font-bold shadow">âœ“</div>
                <div class="w-10 h-10 rounded-lg bg-emerald-500 text-white flex items-center justify-center font-bold shadow">âœ“</div>
                <div class="w-10 h-10 rounded-lg bg-emerald-500 text-white flex items-center justify-center font-bold shadow">âœ“</div>
                <div class="w-10 h-10 rounded-lg bg-slate-200 text-slate-400 flex items-center justify-center font-bold">4</div>
                <div class="w-10 h-10 rounded-lg bg-slate-200 text-slate-400 flex items-center justify-center font-bold">5</div>
              </div>
              <div class="text-xs text-slate-500 mt-2">3 of 5 AP used this quarter</div>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-emerald-50 rounded-lg p-3">
              <div class="font-bold text-emerald-700 text-sm mb-1">Low AP (1-2)</div>
              <p class="text-emerald-600 text-xs">Safe, incremental moves. Less risk, moderate reward.</p>
            </div>
            <div class="bg-amber-50 rounded-lg p-3">
              <div class="font-bold text-amber-700 text-sm mb-1">High AP (3-4)</div>
              <p class="text-amber-600 text-xs">Bold moves with bigger effects. More risk, more reward.</p>
            </div>
          </div>
          
          <div class="bg-sky-50 rounded-xl p-4">
            <h4 class="font-bold text-sky-800 mb-2">ğŸ’¡ Banking AP</h4>
            <p class="text-sky-700 text-sm">Unused AP (up to 2) carries over to next quarter! 
            Sometimes it's smart to save AP for a big move next quarter. Example: Save 2 AP this quarter 
            to have 7 AP next quarter for multiple high-impact decisions.</p>
          </div>
        `
      },
      15: {
        title: "How to Pick Good Decisions ğŸ¤”",
        icon: "ğŸ’¡",
        content: `
          <p class="text-slate-600 mb-4"><strong>Not all decisions are equal.</strong> Here's how to evaluate your options:</p>
          
          <div class="space-y-3 mb-4">
            <div class="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
              <h4 class="font-bold text-emerald-800 mb-2">1âƒ£ Check Milestone Focus</h4>
              <p class="text-emerald-700 text-sm">If your milestone needs Research + Product, prioritize decisions that boost those stats. 
              Don't waste AP on Marketing during Milestone 1!</p>
            </div>
            
            <div class="bg-indigo-50 rounded-xl p-4 border border-indigo-200">
              <h4 class="font-bold text-indigo-800 mb-2">2âƒ£ Consider AP Efficiency</h4>
              <p class="text-indigo-700 text-sm">A 2 AP decision giving +10 Science is better than a 3 AP decision giving +8 Science. 
              Calculate the "points per AP" when comparing options.</p>
            </div>
            
            <div class="bg-violet-50 rounded-xl p-4 border border-violet-200">
              <h4 class="font-bold text-violet-800 mb-2">3âƒ£ Read Investor Advice</h4>
              <p class="text-violet-700 text-sm">Your investors give recommendations (marked with â­). They're often right, 
              but sometimes you'll want to ignore them for strategic reasons.</p>
            </div>
            
            <div class="bg-amber-50 rounded-xl p-4 border border-amber-200">
              <h4 class="font-bold text-amber-800 mb-2">4âƒ£ Watch for Trade-offs</h4>
              <p class="text-amber-700 text-sm">More arrows (â†‘â†‘â†‘) means bigger impact. Some choices boost one area but hurt another. 
              A â†‘â†‘â†‘ Science with â†“ Marketing might be worth it early on!</p>
            </div>
          </div>
        `
      },
      16: {
        title: "Executive Moods ğŸ˜ŠğŸ˜ ",
        icon: "ğŸ‘¥",
        content: `
          <p class="text-slate-600 mb-4"><strong>Your executives have moods</strong> that affect what events they bring you. 
            Happy execs surface better opportunities; frustrated ones bring more problems. 
          Happy executives give you better choices!</p>
          
          <!-- Mood display mockup -->
          <div class="bg-white border rounded-xl p-4 mb-4">
            <div class="text-sm font-medium text-slate-700 mb-3">Team Morale</div>
            <div class="grid grid-cols-3 gap-4">
              <div class="text-center">
                <div class="relative inline-block">
                  <div class="w-14 h-14 bg-emerald-100 rounded-full flex items-center justify-center text-2xl ring-4 ring-emerald-400">
                    ğŸ˜Š
                  </div>
                </div>
                <div class="text-xs font-medium mt-1">Dr. Chen</div>
                <div class="text-xs text-emerald-600">Happy</div>
              </div>
              <div class="text-center">
                <div class="relative inline-block">
                  <div class="w-14 h-14 bg-slate-100 rounded-full flex items-center justify-center text-2xl ring-4 ring-slate-300">
                    ğŸ˜
                  </div>
                </div>
                <div class="text-xs font-medium mt-1">Tom Smith</div>
                <div class="text-xs text-slate-600">Neutral</div>
              </div>
              <div class="text-center">
                <div class="relative inline-block">
                  <div class="w-14 h-14 bg-amber-100 rounded-full flex items-center justify-center text-2xl ring-4 ring-amber-400">
                    ğŸ˜Ÿ
                  </div>
                </div>
                <div class="text-xs font-medium mt-1">Lisa Wong</div>
                <div class="text-xs text-amber-600">Frustrated</div>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-emerald-50 rounded-lg p-3">
              <h4 class="font-bold text-emerald-700 text-sm mb-1">ğŸ˜Š Make Them Happy</h4>
              <ul class="text-emerald-600 text-xs space-y-1">
                <li>â€¢ Choose their presented options</li>
                <li>â€¢ Pick their preferred strategy</li>
              </ul>
            </div>
            <div class="bg-rose-50 rounded-lg p-3">
              <h4 class="font-bold text-rose-700 text-sm mb-1">ğŸ˜  What Upsets Them</h4>
              <ul class="text-rose-600 text-xs space-y-1">
                <li>â€¢ Passing on their domain</li>
                <li>â€¢ Ignoring their advice repeatedly</li>
              </ul>
            </div>
          </div>
          
          <div class="bg-amber-50 rounded-xl p-4">
            <h4 class="font-bold text-amber-800 mb-2">âš  Upset Executives = Worse Options</h4>
            <p class="text-amber-700 text-sm">When an exec is frustrated or upset, the options they present become weaker. 
            Balance your decisions to keep everyone reasonably happy!</p>
          </div>
        `
      },
      17: {
        title: "Investor Guidance Panel ğŸ’¼",
        icon: "ğŸ¯",
        content: `
          <p class="text-slate-600 mb-4"><strong>Your investors give you advice each quarter.</strong> 
          This appears above the decision cards and shows what they're thinking.</p>
          
          <!-- Investor guidance mockup -->
          <div class="bg-gradient-to-r from-violet-50 to-indigo-50 border border-violet-200 rounded-xl p-4 mb-4">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-12 h-12 bg-violet-200 rounded-full flex items-center justify-center text-xl">ğŸ‘¤</div>
              <div>
                <div class="font-bold text-slate-800">Sarah Mitchell</div>
                <div class="text-xs text-violet-600">Angel Investor â€¢ Lead</div>
              </div>
            </div>
            <div class="bg-white rounded-lg p-3 text-sm text-slate-700">
              "Focus on building technical credibility this quarter. Research is key to unlocking partnerships."
            </div>
            <div class="flex gap-2 mt-3">
              <span class="px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-xs">Prioritize: Research</span>
              <span class="px-2 py-1 bg-amber-100 text-amber-700 rounded text-xs">Runway: Comfortable</span>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-emerald-50 rounded-lg p-3">
              <h4 class="font-bold text-emerald-700 text-sm mb-1">ğŸ‘ Follow Advice</h4>
              <p class="text-emerald-600 text-xs">Keeps investors happy, often good strategic guidance.</p>
            </div>
            <div class="bg-amber-50 rounded-lg p-3">
              <h4 class="font-bold text-amber-700 text-sm mb-1">ğŸ¤” When to Ignore</h4>
              <p class="text-amber-600 text-xs">Sometimes you know better! But be prepared to explain.</p>
            </div>
          </div>
          
          <div class="bg-sky-50 rounded-xl p-4">
            <h4 class="font-bold text-sky-800 mb-2">ğŸ’¡ Reading Between the Lines</h4>
            <p class="text-sky-700 text-sm">Investors care about returns. If they push for fundraising, it might be too early. 
            If they want speed over quality, consider whether that's right for your situation.</p>
          </div>
        `
      },
      18: {
        title: "The Company Dashboard ğŸ“Š",
        icon: "ğŸ“ˆ",
        content: `
          <p class="text-slate-600 mb-4"><strong>The right sidebar shows your company's status.</strong> 
          Check it regularly to track progress and plan your strategy.</p>
          
          <!-- Dashboard mockup -->
          <div class="bg-slate-50 border rounded-xl p-4 mb-4 max-w-xs mx-auto">
            <div class="space-y-3">
              <!-- Milestone -->
              <div class="bg-white rounded-lg p-3 shadow-sm">
                <div class="text-xs text-slate-500 mb-1">Current Milestone</div>
                <div class="font-bold text-sm">ğŸ”¬ First Prototype</div>
                <div class="h-2 bg-slate-200 rounded-full mt-2 overflow-hidden">
                  <div class="h-full bg-emerald-500 rounded-full" style="width: 45%"></div>
                </div>
                <div class="text-xs text-slate-500 mt-1">45% â€¢ Deadline: Q4</div>
              </div>
              
              <!-- AP -->
              <div class="bg-white rounded-lg p-3 shadow-sm">
                <div class="text-xs text-slate-500 mb-1">Attention Points</div>
                <div class="flex gap-1">
                  <div class="w-6 h-6 bg-emerald-500 rounded text-white text-xs flex items-center justify-center">âœ“</div>
                  <div class="w-6 h-6 bg-emerald-500 rounded text-white text-xs flex items-center justify-center">âœ“</div>
                  <div class="w-6 h-6 bg-slate-200 rounded text-slate-400 text-xs flex items-center justify-center">3</div>
                  <div class="w-6 h-6 bg-slate-200 rounded text-slate-400 text-xs flex items-center justify-center">4</div>
                  <div class="w-6 h-6 bg-slate-200 rounded text-slate-400 text-xs flex items-center justify-center">5</div>
                </div>
              </div>
              
              <!-- Stats -->
              <div class="bg-white rounded-lg p-3 shadow-sm">
                <div class="text-xs text-slate-500 mb-2">Key Stats</div>
                <div class="grid grid-cols-2 gap-2 text-xs">
                  <div><span class="text-emerald-600">ğŸ”¬ Science:</span> 32</div>
                  <div><span class="text-sky-600">ğŸ’» Product:</span> 28</div>
                  <div><span class="text-fuchsia-600">ğŸ“£ Marketing:</span> 15</div>
                  <div><span class="text-pink-600">ğŸ‘¥ HR:</span> 45</div>
                </div>
              </div>
              
              <!-- Actions -->
              <div class="flex gap-2">
                <button class="flex-1 bg-emerald-100 text-emerald-700 text-xs py-2 rounded-lg font-medium">Hire +</button>
                <button class="flex-1 bg-violet-100 text-violet-700 text-xs py-2 rounded-lg font-medium">ğŸ’° Raise</button>
              </div>
            </div>
          </div>
          
          <div class="bg-indigo-50 rounded-xl p-4">
            <h4 class="font-bold text-indigo-800 mb-2">ğŸ’¡ What to Watch</h4>
            <ul class="text-indigo-700 text-sm space-y-1">
              <li>â€¢ <strong>Milestone progress</strong> - are you on track for the deadline?</li>
              <li>â€¢ <strong>Stats</strong> - which areas need boosting?</li>
              <li>â€¢ <strong>Team moods</strong> - anyone getting frustrated?</li>
            </ul>
          </div>
        `
      },
      19: {
        title: "Hiring & Firing Staff ğŸ‘¥",
        icon: "â•",
        content: `
          <p class="text-slate-600 mb-4"><strong>You can hire or fire general staff</strong> (separate from executives). 
          Staff boost your productivity but cost money each quarter.</p>
          
          <!-- Staffing controls mockup -->
          <div class="bg-white border rounded-xl p-4 mb-4 max-w-sm mx-auto">
            <div class="text-sm font-medium text-slate-700 mb-3">Staffing</div>
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm text-slate-600">Current Staff:</span>
              <span class="font-bold text-lg">5</span>
            </div>
            <div class="flex items-center justify-between mb-3">
              <span class="text-sm text-slate-600">Monthly Cost:</span>
              <span class="font-bold text-rose-600">Â£25k/q</span>
            </div>
            <div class="flex gap-3">
              <button class="flex-1 bg-emerald-500 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2">
                <span class="text-lg">+</span> Hire
              </button>
              <button class="flex-1 bg-slate-200 text-slate-700 py-3 rounded-xl font-bold flex items-center justify-center gap-2">
                <span class="text-lg">âˆ’</span> Fire
              </button>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-emerald-50 rounded-lg p-3">
              <h4 class="font-bold text-emerald-700 text-sm mb-1">Benefits of Staff</h4>
              <ul class="text-emerald-600 text-xs space-y-1">
                <li>â€¢ +2 to all stats per staff</li>
                <li>â€¢ Faster milestone progress</li>
                <li>â€¢ Scales your capabilities</li>
              </ul>
            </div>
            <div class="bg-rose-50 rounded-lg p-3">
              <h4 class="font-bold text-rose-700 text-sm mb-1">Costs of Staff</h4>
              <ul class="text-rose-600 text-xs space-y-1">
                <li>â€¢ Â£5k per staff per quarter</li>
                <li>â€¢ New hires need 1Q to integrate</li>
                <li>â€¢ Firing hurts morale</li>
              </ul>
            </div>
          </div>
          
          <div class="bg-amber-50 rounded-xl p-4">
            <h4 class="font-bold text-amber-800 mb-2">âš  Integration Penalty</h4>
            <p class="text-amber-700 text-sm">New hires take one quarter to get up to speed. During this time, 
            they cost you 1 AP as you train them. Don't hire right before a critical deadline!</p>
          </div>
        `
      },
      20: {
        title: "Raising Funding ğŸ’°",
        icon: "ğŸ¦",
        content: `
          <p class="text-slate-600 mb-4"><strong>When cash runs low, you can raise more funding</strong> from investors. 
          But this costs equity (ownership) and takes effort (1 AP).</p>
          
          <!-- Raise modal mockup -->
          <div class="bg-white border rounded-xl p-4 mb-4">
            <div class="flex items-center justify-between mb-4">
              <div class="text-lg font-bold">ğŸ’° Raise Funding</div>
              <div class="text-sm text-slate-500">Valuation: <span class="text-emerald-600 font-bold">Â£2M</span></div>
            </div>
            
            <div class="space-y-2 mb-4">
              <div class="border-2 border-slate-200 rounded-lg p-3 hover:border-indigo-400">
                <div class="flex justify-between items-center">
                  <div>
                    <div class="font-bold text-sm">Conservative Round</div>
                    <div class="text-xs text-slate-500">Independent VC</div>
                  </div>
                  <div class="text-right">
                    <div class="text-emerald-600 font-bold">+Â£200k</div>
                    <div class="text-rose-600 text-xs">-10% equity</div>
                  </div>
                </div>
              </div>
              <div class="border-2 border-indigo-400 rounded-lg p-3 bg-indigo-50">
                <div class="flex justify-between items-center">
                  <div>
                    <div class="font-bold text-sm">Growth Round</div>
                    <div class="text-xs text-slate-500">Corporate VC</div>
                  </div>
                  <div class="text-right">
                    <div class="text-emerald-600 font-bold">+Â£400k</div>
                    <div class="text-rose-600 text-xs">-18% equity</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-emerald-50 rounded-lg p-3">
              <h4 class="font-bold text-emerald-700 text-sm mb-1">When to Raise</h4>
              <p class="text-emerald-600 text-xs">When runway drops below 3-4 quarters, or before a big push.</p>
            </div>
            <div class="bg-rose-50 rounded-lg p-3">
              <h4 class="font-bold text-rose-700 text-sm mb-1">The Trade-off</h4>
              <p class="text-rose-600 text-xs">More cash = more runway, but less ownership for you at exit.</p>
            </div>
          </div>
          
          <div class="bg-violet-50 rounded-xl p-4">
            <h4 class="font-bold text-violet-800 mb-2">ğŸ’¡ Timing Matters</h4>
            <p class="text-violet-700 text-sm">You can only raise <strong>once per milestone</strong>. Plan ahead! 
            Raising at higher valuation means giving away less equity for the same cash.</p>
          </div>
        `
      },
      21: {
        title: "Market Events & Shocks âš¡",
        icon: "ğŸŒª",
        content: `
          <p class="text-slate-600 mb-4"><strong>Starting Q3, random events can shake up your plans.</strong> 
          These "shocks" force you to make quick decisions.</p>
          
          <!-- Shock event mockup -->
          <div class="bg-gradient-to-b from-rose-500 to-rose-600 rounded-xl p-4 mb-4 text-white">
            <div class="text-center mb-3">
              <div class="text-3xl mb-2">âš¡</div>
              <div class="text-xs uppercase tracking-wide text-rose-200">Market Shock</div>
              <div class="text-xl font-bold">Economic Downturn</div>
            </div>
            <p class="text-sm text-rose-100 text-center mb-4">
              Investors are pulling back. Funding is harder to get and valuations are dropping across the market.
            </p>
            <div class="grid grid-cols-3 gap-2">
              <button class="bg-white/20 hover:bg-white/30 rounded-lg p-2 text-xs font-medium">
                Cut Costs<br/><span class="text-rose-200">-2 Staff, +Â£50k</span>
              </button>
              <button class="bg-white/20 hover:bg-white/30 rounded-lg p-2 text-xs font-medium">
                Push Through<br/><span class="text-rose-200">No change</span>
              </button>
              <button class="bg-white/20 hover:bg-white/30 rounded-lg p-2 text-xs font-medium">
                Raise Now<br/><span class="text-rose-200">-5% extra equity</span>
              </button>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-rose-50 rounded-lg p-3">
              <h4 class="font-bold text-rose-700 text-sm mb-1">Negative Shocks</h4>
              <p class="text-rose-600 text-xs">Economic downturns, regulation, competitor moves, talent wars.</p>
            </div>
            <div class="bg-emerald-50 rounded-lg p-3">
              <h4 class="font-bold text-emerald-700 text-sm mb-1">Positive Shocks</h4>
              <p class="text-emerald-600 text-xs">AI hype cycles, government grants, partnership opportunities.</p>
            </div>
          </div>
          
          <div class="bg-amber-50 rounded-xl p-4">
            <h4 class="font-bold text-amber-800 mb-2">ğŸ’¡ No Perfect Answer</h4>
            <p class="text-amber-700 text-sm">Shocks often have no "right" response-each option has trade-offs. 
            Consider your current situation (runway, milestone progress) when deciding!</p>
          </div>
        `
      },
      22: {
        title: "Mini-Games: Conferences, Pitches & More ğŸ®",
        icon: "ğŸª",
        content: `
          <p class="text-slate-600 mb-4"><strong>At key moments, you'll play quick mini-games</strong> that test your skills 
          and earn rewards for your company.</p>
          
          <div class="space-y-3 mb-4">
            <!-- Conference -->
            <div class="bg-cyan-50 rounded-xl p-4 border border-cyan-200">
              <div class="flex items-center gap-3 mb-2">
                <div class="text-2xl">ğŸª</div>
                <div>
                  <div class="font-bold text-cyan-800">Conference Mini-Game</div>
                  <div class="text-xs text-cyan-600">After completing Milestone 1</div>
                </div>
              </div>
              <p class="text-cyan-700 text-sm mb-2">45-second action game at a trade show. Click delegates, hand out swag, 
              run demos, compete with rival booths!</p>
              <div class="text-xs text-cyan-600">Rewards: Cash, leads, industry connections</div>
            </div>
            
            <!-- Pitch -->
            <div class="bg-violet-50 rounded-xl p-4 border border-violet-200">
              <div class="flex items-center gap-3 mb-2">
                <div class="text-2xl">ğŸ¤</div>
                <div>
                  <div class="font-bold text-violet-800">Investor Pitch</div>
                  <div class="text-xs text-violet-600">After completing Milestone 2</div>
                </div>
              </div>
              <p class="text-violet-700 text-sm mb-2">30-second pitch to skeptical investors. Tell stories, show data, 
              keep their attention high while avoiding awkward moments!</p>
              <div class="text-xs text-violet-600">Rewards: Better funding terms, investor confidence</div>
            </div>
            
            <!-- Demo Day -->
            <div class="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
              <div class="flex items-center gap-3 mb-2">
                <div class="text-2xl">ğŸª</div>
                <div>
                  <div class="font-bold text-emerald-800">Demo Day</div>
                  <div class="text-xs text-emerald-600">After completing Milestone 3</div>
                </div>
              </div>
              <p class="text-emerald-700 text-sm mb-2">60-second booth management. Visitors approach-engage them, 
              match offers to preferences, convert high-value leads!</p>
              <div class="text-xs text-emerald-600">Rewards: Customer deals, revenue, final valuation boost</div>
            </div>
          </div>
          
          <div class="bg-sky-50 rounded-xl p-4">
            <h4 class="font-bold text-sky-800 mb-2">ğŸ’¡ Don't Worry!</h4>
            <p class="text-sky-700 text-sm">Mini-games are fun extras-even a poor performance won't end your game. 
            They're a chance to earn bonuses, not a risk of failure.</p>
          </div>
        `
      },
      23: {
        title: "End of Quarter: Committing ğŸ”„",
        icon: "âœ…",
        content: `
          <p class="text-slate-600 mb-4"><strong>Once you've made all your decisions, click "Commit to Advance Quarter"</strong> 
          to process everything and move to the next quarter.</p>
          
          <!-- Commit flow mockup -->
          <div class="bg-slate-50 rounded-xl p-4 mb-4">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div class="flex flex-col items-center">
                  <div class="w-10 h-10 bg-emerald-500 rounded-full flex items-center justify-center text-white font-bold">1</div>
                  <div class="text-xs mt-1 text-slate-600">Decisions</div>
                </div>
                <div class="w-8 h-0.5 bg-slate-300"></div>
                <div class="flex flex-col items-center">
                  <div class="w-10 h-10 bg-emerald-500 rounded-full flex items-center justify-center text-white font-bold">2</div>
                  <div class="text-xs mt-1 text-slate-600">Review</div>
                </div>
                <div class="w-8 h-0.5 bg-slate-300"></div>
                <div class="flex flex-col items-center">
                  <div class="w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center text-white font-bold">3</div>
                  <div class="text-xs mt-1 text-slate-600">Commit</div>
                </div>
                <div class="w-8 h-0.5 bg-slate-300"></div>
                <div class="flex flex-col items-center">
                  <div class="w-10 h-10 bg-slate-300 rounded-full flex items-center justify-center text-slate-500 font-bold">4</div>
                  <div class="text-xs mt-1 text-slate-600">Next Q</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="bg-white border rounded-xl p-4 mb-4">
            <div class="text-sm font-medium text-slate-700 mb-2">When you commit:</div>
            <ul class="space-y-2 text-sm">
              <li class="flex items-start gap-2">
                <span class="text-emerald-500">âœ“</span>
                <span class="text-slate-600">Decision effects are applied to your stats</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-rose-500">âˆ’</span>
                <span class="text-slate-600">Burn rate is deducted from cash</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-indigo-500">ğŸ“Š</span>
                <span class="text-slate-600">Milestone progress is updated</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-amber-500">ğŸ˜Š</span>
                <span class="text-slate-600">Executive moods are adjusted</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-violet-500">ğŸ²</span>
                <span class="text-slate-600">Random events may occur</span>
              </li>
            </ul>
          </div>
          
          <div class="bg-amber-50 rounded-xl p-4">
            <h4 class="font-bold text-amber-800 mb-2">âš  Before Committing</h4>
            <p class="text-amber-700 text-sm">Double-check your AP usage and runway. Once you commit, 
            you can't undo! Make sure you have enough cash to survive the next quarter.</p>
          </div>
        `
      },
      24: {
        title: "Common Beginner Mistakes ğŸš«",
        icon: "âš ",
        content: `
          <p class="text-slate-600 mb-4"><strong>Avoid these common pitfalls</strong> that trip up new players:</p>
          
          <div class="space-y-3 mb-4">
            <div class="bg-rose-50 rounded-xl p-4 border-l-4 border-rose-400">
              <h4 class="font-bold text-rose-800 mb-1">âŒ Ignoring Runway</h4>
              <p class="text-rose-700 text-sm">Don't let cash run below 2 quarters of runway! Raise funding before it's desperate.</p>
            </div>
            
            <div class="bg-rose-50 rounded-xl p-4 border-l-4 border-rose-400">
              <h4 class="font-bold text-rose-800 mb-1">âŒ Wrong Focus Areas</h4>
              <p class="text-rose-700 text-sm">Milestone 1 needs Research + Product. Don't waste AP on Marketing until M2!</p>
            </div>
            
            <div class="bg-rose-50 rounded-xl p-4 border-l-4 border-rose-400">
              <h4 class="font-bold text-rose-800 mb-1">âŒ Hiring Spree Before Deadline</h4>
              <p class="text-rose-700 text-sm">New staff take 1Q to integrate. Don't hire right before a milestone deadline!</p>
            </div>
            
            <div class="bg-rose-50 rounded-xl p-4 border-l-4 border-rose-400">
              <h4 class="font-bold text-rose-800 mb-1">âŒ Making Everyone Unhappy</h4>
              <p class="text-rose-700 text-sm">Constantly passing on an exec's domain tanks their mood. Unhappy execs bring you worse situations to deal with!</p>
            </div>
            
            <div class="bg-rose-50 rounded-xl p-4 border-l-4 border-rose-400">
              <h4 class="font-bold text-rose-800 mb-1">âŒ Using All AP Every Quarter</h4>
              <p class="text-rose-700 text-sm">Sometimes banking 1-2 AP for next quarter is smarter than forcing weak decisions.</p>
            </div>
          </div>
        `
      },
      25: {
        title: "Competitors & Life Events ğŸ",
        icon: "ğŸ¦Š",
        content: `
          <p class="text-slate-600 mb-4">
            Two more elements add unpredictability to your startup journey:
          </p>
          
          <div class="bg-indigo-50 rounded-xl p-4 mb-3">
            <h4 class="font-bold text-indigo-800 mb-2">ğŸ Your Competitors</h4>
            <p class="text-indigo-700 text-sm mb-2"><strong>3 rival startups</strong> in your sector are racing for the same milestones. 
            Click their names in the rankings to learn about their strategies.</p>
            <p class="text-indigo-600 text-xs">Complete a milestone first for a <strong>first-mover bonus</strong>!</p>
          </div>
          
          <div class="bg-violet-50 rounded-xl p-4">
            <h4 class="font-bold text-violet-800 mb-2">ğŸ² Life Happens</h4>
            <p class="text-violet-700 text-sm mb-2">Occasionally, random life events interrupt your plans - team chaos, personal demands, 
            or good fortune like cultural celebrations (ğŸª”ğŸŒ™ğŸ‰ğŸ•) and unexpected windfalls.</p>
            <p class="text-violet-600 text-xs">These are rare (1-2 per game) but add to the unpredictability of startup life.</p>
          </div>
        `
      },
      26: {
        title: "Strategic Pivots ğŸ”„",
        icon: "ğŸ”„",
        content: `
          <p class="text-slate-600 mb-4">
            Sometimes the best path forward is a <strong>new direction</strong>. When competitors get ahead or your approach isn't working, 
            you can pivot your company's strategy.
          </p>
          
          <!-- Pivot types visual -->
          <div class="bg-white border rounded-xl p-4 mb-4">
            <div class="text-sm font-medium text-slate-700 mb-3">Two Ways Pivots Happen:</div>
            <div class="grid grid-cols-2 gap-3">
              <div class="bg-violet-50 rounded-lg p-3 border border-violet-200">
                <div class="flex items-center gap-2 mb-1">
                  <span class="text-lg">ğŸ”„</span>
                  <span class="font-bold text-violet-800 text-sm">Strategic Review</span>
                </div>
                <p class="text-violet-700 text-xs">Your choice - available after completing your first milestone when you want to change direction.</p>
              </div>
              <div class="bg-rose-50 rounded-lg p-3 border border-rose-200">
                <div class="flex items-center gap-2 mb-1">
                  <span class="text-lg">âš ï¸</span>
                  <span class="font-bold text-rose-800 text-sm">Market Shift</span>
                </div>
                <p class="text-rose-700 text-xs">Forced response - triggered when a competitor completes a milestone before you.</p>
              </div>
            </div>
          </div>
          
          <!-- Pivot options -->
          <div class="space-y-2 mb-4">
            <div class="flex items-center gap-3 bg-slate-50 rounded-lg p-2">
              <span class="text-xl">ğŸ¯</span>
              <div>
                <span class="font-bold text-sm text-slate-800">Customer Pivot</span>
                <span class="text-slate-600 text-xs ml-2">Sell to different buyers who value your product more</span>
              </div>
            </div>
            <div class="flex items-center gap-3 bg-slate-50 rounded-lg p-2">
              <span class="text-xl">ğŸ’¡</span>
              <div>
                <span class="font-bold text-sm text-slate-800">Problem Pivot</span>
                <span class="text-slate-600 text-xs ml-2">Solve a different pain point with your technology</span>
              </div>
            </div>
            <div class="flex items-center gap-3 bg-slate-50 rounded-lg p-2">
              <span class="text-xl">ğŸ”§</span>
              <div>
                <span class="font-bold text-sm text-slate-800">Tech Pivot</span>
                <span class="text-slate-600 text-xs ml-2">Build it differentlyâ€”new technical approach</span>
              </div>
            </div>
            <div class="flex items-center gap-3 bg-slate-50 rounded-lg p-2">
              <span class="text-xl">ğŸ¯</span>
              <div>
                <span class="font-bold text-sm text-slate-800">Narrow Focus</span>
                <span class="text-slate-600 text-xs ml-2">Become the specialist in one vertical</span>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-emerald-50 rounded-lg p-3">
              <h4 class="font-bold text-emerald-700 text-sm mb-1">What You Keep</h4>
              <ul class="text-emerald-600 text-xs space-y-1">
                <li>â€¢ Some milestone progress carries over</li>
                <li>â€¢ Core technology & research</li>
                <li>â€¢ Team capabilities</li>
              </ul>
            </div>
            <div class="bg-rose-50 rounded-lg p-3">
              <h4 class="font-bold text-rose-700 text-sm mb-1">What It Costs</h4>
              <ul class="text-rose-600 text-xs space-y-1">
                <li>â€¢ Transition costs (Â£20k-Â£50k)</li>
                <li>â€¢ Time to reach new milestone</li>
                <li>â€¢ Sales pipeline rebuild</li>
              </ul>
            </div>
          </div>
          
          <div class="bg-amber-50 rounded-xl p-4">
            <h4 class="font-bold text-amber-800 mb-2">ğŸ’¡ Rebranding Option</h4>
            <p class="text-amber-700 text-sm">After pivoting, you can rename your company to match your new direction. 
            Each name has trade-offs: short-term sales disruption vs. long-term brand positioning.</p>
          </div>
        `
      },
      27: {
        title: "You're Ready to Play! ğŸ“",
        icon: "ğŸš€",
        content: `
          <p class="text-slate-600 mb-4">
            Congratulations! You now have a solid understanding of <strong>The AI Startup Game</strong>. 
            Here's your quick reference:
          </p>
          
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-indigo-50 rounded-lg p-3">
              <div class="font-bold text-indigo-700 text-sm mb-1">ğŸ¯ Goal</div>
              <p class="text-indigo-600 text-xs">Complete 3 milestones before Q16 or running out of cash</p>
            </div>
            <div class="bg-emerald-50 rounded-lg p-3">
              <div class="font-bold text-emerald-700 text-sm mb-1">âš¡ Attention Points</div>
              <p class="text-emerald-600 text-xs">5 AP per quarter, bank up to 2 unused</p>
            </div>
            <div class="bg-amber-50 rounded-lg p-3">
              <div class="font-bold text-amber-700 text-sm mb-1">ğŸ’° Cash & Runway</div>
              <p class="text-amber-600 text-xs">Keep runway above 3Q, raise when needed</p>
            </div>
            <div class="bg-violet-50 rounded-lg p-3">
              <div class="font-bold text-violet-700 text-sm mb-1">ğŸ Competitors</div>
              <p class="text-violet-600 text-xs">3 rivals racing you - aim for first-mover bonuses</p>
            </div>
            <div class="bg-pink-50 rounded-lg p-3">
              <div class="font-bold text-pink-700 text-sm mb-1">ğŸ‘¥ Team</div>
              <p class="text-pink-600 text-xs">Keep executives happy for better options</p>
            </div>
            <div class="bg-cyan-50 rounded-lg p-3">
              <div class="font-bold text-cyan-700 text-sm mb-1">ğŸ² Events</div>
              <p class="text-cyan-600 text-xs">Adapt to shocks, life events, and mini-games</p>
            </div>
          </div>
          
          <div class="bg-purple-50 rounded-lg p-3 mb-4 border border-purple-200">
            <div class="font-bold text-purple-700 text-sm mb-1">ğŸ”„ Pivots</div>
            <p class="text-purple-600 text-xs">If competitors get ahead or you're struggling, pivot to a new directionâ€”some progress carries over, and you can rebrand!</p>
          </div>
          
          <div class="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl p-5 text-center border-2 border-emerald-200">
            <div class="text-4xl mb-3">ğŸ€</div>
            <p class="text-emerald-800 font-bold text-lg mb-1">Good luck, founder!</p>
            <p class="text-emerald-600 text-sm">Remember: 90% of startups fail, but each attempt teaches you something. 
            Don't be afraid to experiment and learn from mistakes!</p>
          </div>
          
          <div class="mt-4 text-center">
            <p class="text-slate-500 text-xs">Click "Start Game" to begin your journey â†’</p>
          </div>
        `
      }
    };
    
    const t = tutorials[step];
    return `
      <div class="text-center mb-6">
        <div class="text-5xl mb-3">${t.icon}</div>
        <h2 class="text-2xl font-bold text-slate-800">${t.title}</h2>
      </div>
      ${t.content}
    `;
  }

  // ===== EXTREME MODE =====
  
  toggleExtremeMode() {
    this.extremeMode = !this.extremeMode;
    
    // Update preamble toggle (page 1)
    const togglePreamble = document.getElementById("extremeModeTogglePreamble");
    const statusPreamble = document.getElementById("extremeModeStatusPreamble");
    const detailsPreamble = document.getElementById("extremeModeDetailsPreamble");
    
    // Update venture page toggle
    const toggle = document.getElementById("extremeModeToggle");
    const status = document.getElementById("extremeModeStatus");
    const details = document.getElementById("extremeModeDetails");
    
    if (this.extremeMode) {
      // Preamble toggle
      if (togglePreamble) {
        togglePreamble.classList.remove("border-slate-600", "bg-slate-800/50", "hover:border-rose-400", "hover:bg-rose-900/30");
        togglePreamble.classList.add("border-rose-500", "bg-rose-900/50");
      }
      if (statusPreamble) {
        statusPreamble.textContent = "ON";
        statusPreamble.classList.remove("bg-slate-700", "text-slate-400");
        statusPreamble.classList.add("bg-rose-500", "text-white");
      }
      if (detailsPreamble) detailsPreamble.classList.remove("hidden");
      
      // Venture page toggle
      if (toggle) {
        toggle.classList.remove("border-slate-200", "bg-slate-50", "hover:border-rose-300", "hover:bg-rose-50");
        toggle.classList.add("border-rose-500", "bg-rose-100");
      }
      if (status) {
        status.textContent = "ON";
        status.classList.remove("bg-slate-200", "text-slate-600");
        status.classList.add("bg-rose-500", "text-white");
      }
      if (details) details.classList.remove("hidden");
      
      soundManager.playWarning();
    } else {
      // Preamble toggle
      if (togglePreamble) {
        togglePreamble.classList.add("border-slate-600", "bg-slate-800/50", "hover:border-rose-400", "hover:bg-rose-900/30");
        togglePreamble.classList.remove("border-rose-500", "bg-rose-900/50");
      }
      if (statusPreamble) {
        statusPreamble.textContent = "OFF";
        statusPreamble.classList.add("bg-slate-700", "text-slate-400");
        statusPreamble.classList.remove("bg-rose-500", "text-white");
      }
      if (detailsPreamble) detailsPreamble.classList.add("hidden");
      
      // Venture page toggle
      if (toggle) {
        toggle.classList.add("border-slate-200", "bg-slate-50", "hover:border-rose-300", "hover:bg-rose-50");
        toggle.classList.remove("border-rose-500", "bg-rose-100");
      }
      if (status) {
        status.textContent = "OFF";
        status.classList.add("bg-slate-200", "text-slate-600");
        status.classList.remove("bg-rose-500", "text-white");
      }
      if (details) details.classList.add("hidden");
      
      soundManager.playClick();
    }
  }

  renderFundingStages() {
    // At game start, only Bootstrap and Angel available
    // VC becomes available after first milestone (via follow-on funding)
    const stages = [
      { id: "bootstrap", icon: "ğŸ ", color: "slate" },
      { id: "angel", icon: "ğŸ‘¼", color: "amber" }
    ];
    
    const fg = document.getElementById("fundingStageGrid");
    fg.innerHTML = stages.map(s => {
      const stage = FUNDING_STAGES[s.id];
      const funders = FUNDER_OPTIONS[s.id].map(id => getFunder(id));
      const cashRange = funders.length > 1 
        ? `Â£${Math.min(...funders.map(f=>f.cash))}k - Â£${Math.max(...funders.map(f=>f.cash))}k`
        : `Â£${funders[0].cash}k`;
      const equityMin = Math.min(...funders.map(f=>f.equity));
      const equityMax = Math.max(...funders.map(f=>f.equity));
      const equityRange = funders.length > 1 && equityMin !== equityMax
        ? `Takes ${equityMin}% - ${equityMax}%`
        : equityMin === 0 ? `Keep 100%` : `Takes ${equityMin}%`;
      
      return `
        <button onclick="game.selectFundingStage('${s.id}')" class="hire-card border-2 border-slate-200 rounded-xl p-5 text-left bg-white hover:border-${s.color}-400">
          <div class="text-3xl mb-2">${s.icon}</div>
          <div class="text-lg font-bold text-slate-800 mb-1">${stage.name}</div>
          <p class="text-sm text-slate-600 mb-3">${stage.desc}</p>
          <div class="text-xs text-slate-500">
            <div class="text-emerald-600 font-medium">Cash: ${cashRange}</div>
            <div class="${equityMax > 25 ? 'text-red-500' : ''}">${equityRange}</div>
          </div>
        </button>
      `;
    }).join("");
    
    // Add VC teaser
    fg.innerHTML += `
      <div class="border-2 border-dashed border-slate-300 rounded-xl p-5 text-left bg-slate-50 opacity-60">
        <div class="text-3xl mb-2">ğŸ¦</div>
        <div class="text-lg font-bold text-slate-500 mb-1">VC Seed</div>
        <p class="text-sm text-slate-400 mb-3">Institutional capital with institutional expectations.</p>
        <div class="text-xs text-slate-400">
          <div class="font-medium">ğŸ”’ Unlocks after Milestone 1</div>
          <div>VCs want to see traction first</div>
        </div>
      </div>
    `;
  }

  selectVenture(id) {
    this.company = COMPANIES.find(c => c.id === id);
    this.rivals = JSON.parse(JSON.stringify(RIVALS[id] || []));
    document.getElementById("companyDisplay").textContent = this.company.name;
    document.getElementById("companyDisplay").style.color = this.company.color;
    const logoEl = document.getElementById("companyLogo");
    logoEl.innerHTML = LOGOS[id];
    logoEl.classList.remove("hidden");
    
    // Initialize revenue model for this company
    this.initializeRevenueModel();
    
    // Play selection sound
    soundManager.playVentureSelect();
    
    // Show location selection
    this.showLocationModal();
  }
  
  showLocationModal() {
    document.getElementById("ventureModal").classList.add("hidden");
    document.getElementById("locationVentureName").textContent = this.company.name;
    
    const locations = getLocations(this.company.id);
    
    const lg = document.getElementById("locationGrid");
    lg.innerHTML = locations.map(loc => {
      const salaryText = loc.salaryMod > 0 ? `+${Math.round(loc.salaryMod * 100)}%` : 
                         `${Math.round(loc.salaryMod * 100)}%`;
      const salaryColor = loc.salaryMod > 0.15 ? "text-red-600" : 
                          loc.salaryMod > 0 ? "text-amber-600" : "text-emerald-600";
      
      return `
        <div class="hire-card border-2 border-slate-200 rounded-xl bg-white flex flex-col overflow-hidden">
          <!-- City Image -->
          <div class="h-20 bg-gradient-to-b from-slate-100 to-slate-50 flex items-center justify-center">
            ${loc.image}
          </div>
          
          <!-- City Name Header -->
          <div class="bg-slate-800 text-white px-4 py-2">
            <div class="flex items-center justify-between">
              <h3 class="font-bold text-base">${loc.name}</h3>
              <span class="text-xs text-slate-300">${loc.region}</span>
            </div>
            <p class="text-xs text-blue-300">"${loc.tagline}"</p>
          </div>
          
          <!-- Content -->
          <div class="p-4 flex-1 flex flex-col">
            <!-- Description -->
            <p class="text-xs text-slate-600 mb-3">${loc.description}</p>
            
            <!-- Salary Cost Only -->
            <div class="bg-slate-50 rounded-lg p-3 mb-3">
              <div class="flex justify-between items-center">
                <span class="text-slate-600 text-sm">ğŸ’· Salary Costs</span>
                <span class="text-sm font-semibold ${salaryColor}">${salaryText}</span>
              </div>
            </div>
            
            <!-- Spacer -->
            <div class="flex-1"></div>
            
            <!-- Action Buttons -->
            <div class="flex gap-2 mt-3">
              <button onclick="event.stopPropagation(); game.showLocationInfo('${loc.id}')" 
                      class="flex-1 px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm font-medium rounded-lg transition-colors">
                Learn more
              </button>
              <button onclick="event.stopPropagation(); game.selectLocation('${loc.id}')" 
                      class="flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg transition-colors">
                Choose
              </button>
            </div>
          </div>
        </div>
      `;
    }).join("");
    
    document.getElementById("locationModal").classList.remove("hidden");
    document.getElementById("locationModal").classList.add("flex");
  }
  
  selectLocation(id) {
    this.location = LOCATION_MAP[id];
    soundManager.playLocationSelect();
    document.getElementById("locationModal").classList.add("hidden");
    document.getElementById("locationModal").classList.remove("flex");
    
    // Go to funding selection next (founder already selected)
    document.getElementById("fundingModal").classList.remove("hidden");
    document.getElementById("fundingModal").classList.add("flex");
  }
  
  showFounderModal() {
    // Populate profile grid with embedded portraits
    const profileGrid = document.getElementById("founderProfileGrid");
    profileGrid.innerHTML = Object.values(FOUNDER_PROFILES).map(p => {
      const portrait = FOUNDER_PORTRAITS[p.portraitStyle] || FOUNDER_PORTRAITS.style1;
      return `
        <div id="profileBtn_${p.id}"
             class="profile-card border-2 border-slate-200 rounded-xl p-5 text-left hover:border-indigo-300 transition-all flex flex-col h-full">
          <div class="flex items-center gap-4 flex-1">
            <div class="w-20 h-20 rounded-full overflow-hidden border-3 border-slate-300 flex-shrink-0 bg-white shadow-sm">
              ${portrait}
            </div>
            <div class="flex-1 min-w-0">
              <div class="font-bold text-slate-800 text-base mb-1">${p.icon} ${p.name}</div>
              <p class="text-sm text-slate-600 mb-1">${p.title}</p>
              <p class="text-xs text-indigo-600 italic">"${p.slogan}"</p>
            </div>
          </div>
          <div class="flex gap-2 mt-4">
            <button onclick="game.showProfileInfo('${p.id}')" 
                    class="flex-1 py-2.5 px-3 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-600 text-xs font-medium transition-colors">
              Learn more
            </button>
            <button onclick="game.selectFounderProfile('${p.id}')" 
                    class="flex-1 py-2.5 px-3 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-bold transition-colors">
              Choose
            </button>
          </div>
        </div>
      `;
    }).join('');
    
    // Reset state
    this.selectedProfile = null;
    this.selectedAppearance = null;
    document.getElementById("founderNameInput").value = '';
    document.getElementById("founderNameHint").classList.add('hidden');
    
    document.getElementById("founderModal").classList.remove("hidden");
    document.getElementById("founderModal").classList.add("flex");
  }
  
  showProfileInfo(profileId) {
    const profile = FOUNDER_PROFILES[profileId];
    if (!profile) return;
    
    this.viewingProfileId = profileId; // Store for choose button
    
    const portrait = FOUNDER_PORTRAITS[profile.portraitStyle] || FOUNDER_PORTRAITS.style1;
    
    document.getElementById("profileInfoAvatar").innerHTML = portrait;
    document.getElementById("profileInfoName").textContent = `${profile.icon} ${profile.name}`;
    document.getElementById("profileInfoTitle").textContent = profile.title;
    document.getElementById("profileInfoSlogan").textContent = `"${profile.slogan}"`;
    document.getElementById("profileInfoDesc").textContent = profile.desc;
    document.getElementById("profileInfoStrengths").textContent = profile.strengths;
    document.getElementById("profileInfoChallenges").textContent = profile.challenges;
    
    document.getElementById("profileInfoModal").classList.remove("hidden");
    document.getElementById("profileInfoModal").classList.add("flex");
  }
  
  hideProfileInfo() {
    document.getElementById("profileInfoModal").classList.add("hidden");
    document.getElementById("profileInfoModal").classList.remove("flex");
  }
  
  chooseProfileFromPopup() {
    if (this.viewingProfileId) {
      this.hideProfileInfo();
      this.selectFounderProfile(this.viewingProfileId);
    }
  }
  
  showLocationInfo(locationId) {
    const locations = getLocations(this.company.id);
    const loc = locations.find(l => l.id === locationId);
    if (!loc) return;
    
    this.viewingLocationId = locationId; // Store for choose button
    
    const salaryText = loc.salaryMod > 0 ? `+${Math.round(loc.salaryMod * 100)}%` : 
                       `${Math.round(loc.salaryMod * 100)}%`;
    const salaryColor = loc.salaryMod > 0.15 ? "text-red-600" : 
                        loc.salaryMod > 0 ? "text-amber-600" : "text-emerald-600";
    
    document.getElementById("locationInfoImage").innerHTML = loc.image;
    document.getElementById("locationInfoName").textContent = `ğŸ“ ${loc.name}`;
    document.getElementById("locationInfoRegion").textContent = loc.region;
    document.getElementById("locationInfoTagline").textContent = `"${loc.tagline}"`;
    document.getElementById("locationInfoDesc").textContent = loc.description;
    document.getElementById("locationInfoSalary").innerHTML = `<span class="${salaryColor}">${salaryText}</span>`;
    
    // Build pros list
    const prosHtml = loc.pros.map(pro => `<li class="flex items-start gap-1"><span class="text-emerald-500 flex-shrink-0">â€¢</span> ${pro}</li>`).join("");
    document.getElementById("locationInfoPros").innerHTML = prosHtml;
    
    // Build cons list
    const consHtml = loc.cons.map(con => `<li class="flex items-start gap-1"><span class="text-amber-500 flex-shrink-0">â€¢</span> ${con}</li>`).join("");
    document.getElementById("locationInfoCons").innerHTML = consHtml;
    
    document.getElementById("locationInfoModal").classList.remove("hidden");
    document.getElementById("locationInfoModal").classList.add("flex");
  }
  
  hideLocationInfo() {
    document.getElementById("locationInfoModal").classList.add("hidden");
    document.getElementById("locationInfoModal").classList.remove("flex");
  }
  
  chooseLocationFromPopup() {
    if (this.viewingLocationId) {
      this.hideLocationInfo();
      this.selectLocation(this.viewingLocationId);
    }
  }
  
  selectFounderProfile(profileId) {
    const profile = FOUNDER_PROFILES[profileId];
    if (!profile) {
      console.error('Profile not found:', profileId);
      return;
    }
    
    // Check if name is entered
    const name = document.getElementById("founderNameInput").value.trim();
    if (!name) {
      // Highlight the name input and show hint
      const nameInput = document.getElementById("founderNameInput");
      const nameHint = document.getElementById("founderNameHint");
      nameInput.classList.add('border-amber-400', 'bg-amber-50');
      nameInput.focus();
      nameHint.classList.remove('hidden');
      nameHint.classList.add('text-amber-600');
      
      // Remove highlight after a moment
      setTimeout(() => {
        nameInput.classList.remove('border-amber-400', 'bg-amber-50');
      }, 2000);
      return;
    }
    
    // Set founder and proceed
    this.selectedProfile = profile;
    this.selectedAppearance = profile.portraitStyle;
    
    const portraitStyle = profile.portraitStyle || 'style1';
    this.founder = {
      name: name,
      profile: profile,
      appearance: portraitStyle,
      portrait: FOUNDER_PORTRAITS[portraitStyle]
    };
    
    soundManager.playFounderSelect();
    document.getElementById("founderModal").classList.add("hidden");
    document.getElementById("founderModal").classList.remove("flex");
    
    // Go to venture selection next
    this.showVentureModal();
  }
  
  showVentureModal() {
    document.getElementById("ventureModal").classList.remove("hidden");
    document.getElementById("ventureModal").classList.add("flex");
    
    // Show extreme mode indicator if enabled
    const extremeIndicator = document.getElementById("extremeModeIndicatorVenture");
    if (extremeIndicator) {
      if (this.extremeMode) {
        extremeIndicator.classList.remove("hidden");
      } else {
        extremeIndicator.classList.add("hidden");
      }
    }
  }
  
  backToPreamble() {
    document.getElementById("founderModal").classList.add("hidden");
    document.getElementById("founderModal").classList.remove("flex");
    document.getElementById("preambleModal2").classList.remove("hidden");
    document.getElementById("preambleModal2").classList.add("flex");
  }
  
  backToFounder() {
    document.getElementById("ventureModal").classList.add("hidden");
    document.getElementById("ventureModal").classList.remove("flex");
    this.showFounderModal();
  }
  
  backToVenture() {
    document.getElementById("locationModal").classList.add("hidden");
    document.getElementById("locationModal").classList.remove("flex");
    this.showVentureModal();
  }

  selectFundingStage(stageId) {
    this.fundingStage = stageId;
    const stage = FUNDING_STAGES[stageId];
    const funderIds = FUNDER_OPTIONS[stageId];
    
    soundManager.playFundingSelect(stageId);
    
    document.getElementById("funderStageTitle").textContent = stage.name;
    document.getElementById("funderStageDesc").textContent = 
      stageId === "bootstrap" ? "No investors, no obligations - just you." :
      stageId === "angel" ? "Angels bring money and expertise." :
      "VCs will shape your company's direction.";
    
    const fg = document.getElementById("funderGrid");
    fg.innerHTML = funderIds.map(id => {
      const f = getFunder(id);
      
      // Determine investor type and calculate angel contribution
      const isBootstrap = f.stage === "bootstrap";
      const isAngel = f.stage === "angel";
      const isVC = f.stage === "vc";
      const angelInvestment = isAngel ? f.cash - 350 : 0;
      
      // Qualitative descriptions hinting at expertise
      const expertiseDesc = {
        self: "You'll learn everything the hard way - but every lesson will be yours.",
        dragon: "Her media connections and commercial instincts will get you customers fast.",
        techAngel: "A technical founder who gets deep in the code and knows how to build products.",
        operatorAngel: "Knows how to build teams that scale without breaking. Process is her superpower.",
        academicAngel: "Deep research networks and grant expertise. Science is her language.",
        sectorVC: "Deep healthcare expertise and relationships across the NHS and research institutions.",
        tier1VC: "The brand opens doors everywhere - with customers, talent, and follow-on investors.",
        corporateVC: "Access to data, APIs, and enterprise customers that would take years to build alone."
      };
      
      return `
        <div class="border-2 border-slate-200 rounded-xl p-5 bg-white hover:border-emerald-300 transition-all flex flex-col h-full">
          <!-- Photo and name -->
          <div class="flex items-center gap-4 mb-4">
            <div class="w-16 h-16 flex-shrink-0 rounded-full overflow-hidden border-2 border-slate-200">
              ${f.photo}
            </div>
            <div class="min-w-0">
              <div class="font-bold text-slate-800">${f.name}</div>
              <div class="text-sm text-slate-500">${f.title}</div>
            </div>
          </div>
          
          <!-- Key financials -->
          <div class="bg-slate-50 rounded-lg p-3 mb-4">
            ${isAngel ? `
              <div class="grid grid-cols-3 gap-2 text-center">
                <div>
                  <div class="text-lg font-bold text-emerald-600">Â£${angelInvestment}k</div>
                  <div class="text-xs text-slate-500">Their Investment</div>
                </div>
                <div>
                  <div class="text-lg font-bold ${f.equity > 25 ? 'text-red-500' : 'text-amber-600'}">${f.equity}%</div>
                  <div class="text-xs text-slate-500">Equity</div>
                </div>
                <div>
                  <div class="text-lg font-bold text-slate-700">Â£${f.val}k</div>
                  <div class="text-xs text-slate-500">Valuation</div>
                </div>
              </div>
              <div class="text-xs text-slate-400 text-center mt-2 pt-2 border-t border-slate-200">
                + your Â£350k = Â£${f.cash}k starting cash
              </div>
            ` : isBootstrap ? `
              <div class="grid grid-cols-2 gap-2 text-center">
                <div>
                  <div class="text-lg font-bold text-emerald-600">Â£${f.cash}k</div>
                  <div class="text-xs text-slate-500">Your Savings</div>
                </div>
                <div>
                  <div class="text-lg font-bold text-emerald-600">${f.equity}%</div>
                  <div class="text-xs text-slate-500">Equity Given</div>
                </div>
              </div>
            ` : `
              <div class="grid grid-cols-3 gap-2 text-center">
                <div>
                  <div class="text-lg font-bold text-emerald-600">Â£${f.cash}k</div>
                  <div class="text-xs text-slate-500">Investment</div>
                </div>
                <div>
                  <div class="text-lg font-bold ${f.equity > 25 ? 'text-red-500' : 'text-amber-600'}">${f.equity}%</div>
                  <div class="text-xs text-slate-500">Equity</div>
                </div>
                <div>
                  <div class="text-lg font-bold text-slate-700">Â£${f.val}k</div>
                  <div class="text-xs text-slate-500">Valuation</div>
                </div>
              </div>
            `}
          </div>
          
          <!-- Qualitative description -->
          <p class="text-sm text-slate-600 mb-4 flex-grow">${expertiseDesc[id] || f.desc}</p>
          
          <!-- Buttons -->
          <div class="flex gap-2 mt-auto">
            <button onclick="game.showInvestorInfo('${id}')" 
                    class="flex-1 py-2.5 px-3 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-600 text-xs font-medium transition-colors">
              Learn more
            </button>
            <button onclick="game.selectFunder('${id}')" 
                    class="flex-1 py-2.5 px-3 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-bold transition-colors">
              Choose
            </button>
          </div>
        </div>
      `;
    }).join("");
    
    document.getElementById("fundingModal").classList.add("hidden");
    document.getElementById("funderModal").classList.remove("hidden");
    document.getElementById("funderModal").classList.add("flex");
  }
  
  showInvestorInfo(funderId) {
    const f = getFunder(funderId);
    if (!f) return;
    
    this.viewingInvestorId = funderId;
    
    // Determine investor type
    const isBootstrap = f.stage === "bootstrap";
    const isAngel = f.stage === "angel";
    const angelInvestment = isAngel ? f.cash - 350 : 0;
    
    document.getElementById("investorInfoAvatar").innerHTML = f.photo;
    document.getElementById("investorInfoName").textContent = f.name;
    document.getElementById("investorInfoTitle").textContent = f.title;
    document.getElementById("investorInfoDesc").textContent = f.desc;
    
    // Update financials display based on investor type
    if (isAngel) {
      document.getElementById("investorInfoCash").textContent = `Â£${angelInvestment}k`;
      document.getElementById("investorInfoCashLabel").textContent = "Their Investment";
      document.getElementById("investorInfoTotal").textContent = `+ your Â£350k = Â£${f.cash}k total`;
      document.getElementById("investorInfoTotal").classList.remove("hidden");
    } else if (isBootstrap) {
      document.getElementById("investorInfoCash").textContent = `Â£${f.cash}k`;
      document.getElementById("investorInfoCashLabel").textContent = "Your Savings";
      document.getElementById("investorInfoTotal").classList.add("hidden");
    } else {
      document.getElementById("investorInfoCash").textContent = `Â£${f.cash}k`;
      document.getElementById("investorInfoCashLabel").textContent = "Investment";
      document.getElementById("investorInfoTotal").classList.add("hidden");
    }
    
    document.getElementById("investorInfoEquity").textContent = `${f.equity}%`;
    document.getElementById("investorInfoEquity").className = `text-xl font-bold ${f.equity > 25 ? 'text-red-500' : f.equity > 0 ? 'text-amber-600' : 'text-emerald-600'}`;
    document.getElementById("investorInfoVal").textContent = `Â£${f.val}k`;
    document.getElementById("investorInfoQuote").textContent = `"${f.personality}"`;
    document.getElementById("investorInfoBenefits").textContent = f.benefits || 'No specific benefits listed.';
    document.getElementById("investorInfoChallenges").textContent = f.challenges || 'No specific challenges listed.';
    
    document.getElementById("investorInfoModal").classList.remove("hidden");
    document.getElementById("investorInfoModal").classList.add("flex");
  }
  
  hideInvestorInfo() {
    document.getElementById("investorInfoModal").classList.add("hidden");
    document.getElementById("investorInfoModal").classList.remove("flex");
  }
  
  chooseInvestorFromPopup() {
    if (this.viewingInvestorId) {
      this.hideInvestorInfo();
      this.selectFunder(this.viewingInvestorId);
    }
  }

  backToFundingStage() {
    document.getElementById("funderModal").classList.add("hidden");
    document.getElementById("funderModal").classList.remove("flex");
    document.getElementById("fundingModal").classList.remove("hidden");
    document.getElementById("fundingModal").classList.add("flex");
  }
  
  backToLocation() {
    document.getElementById("fundingModal").classList.add("hidden");
    document.getElementById("fundingModal").classList.remove("flex");
    this.showLocationModal();
  }

  selectFunder(id) {
    this.funder = getFunder(id);
    this.funding = this.funder; // For compatibility
    
    // Apply extreme mode cash reduction (20% less)
    let startingCash = this.funder.cash;
    if (this.extremeMode) {
      startingCash = Math.round(startingCash * 0.8);
    }
    
    this.metrics.cash = startingCash;
    this.metrics.val = this.funder.val;
    // Equity is now what YOU keep (100 - what they take)
    this.metrics.equity = 100 - this.funder.equity;
    this.metrics.staff = this.company.staff;
    this.startingStaff = this.company.staff; // Track founding team size for AP bonus calculation
    this.metrics.burn = this.company.burn;
    this.maxAP = 5 + this.funder.apMod;
    
    // Log journey event for initial funding
    this.logJourneyEvent('funding', {
      stage: this.fundingStage,
      funderName: this.funder.name,
      amount: startingCash,
      valuation: this.funder.val,
      equityGiven: this.funder.equity
    });
    
    // Play funding selection sound based on funding stage
    soundManager.playFundingSelect(this.fundingStage);
    soundManager.playFundingSelect(this.fundingStage);
    
    // Add to investors array (unless bootstrapped)
    if (this.funder.id !== "self") {
      // Experienced founders start with better investor relationships
      const experienceBonus = this.getFounderExperienceBonus();
      const startingRelationship = Math.min(5, 3 + experienceBonus);
      
      this.investors.push({
        funder: this.funder,
        funderId: this.funder.id,
        relationship: startingRelationship,
        isLead: true,
        joinedTurn: this.turn
      });
      
      if (experienceBonus > 0) {
        this.log(`${this.founder?.profile?.icon || 'ğŸ‘¤'} Your experience gives you a head start with investors.`);
      } else if (experienceBonus < 0) {
        this.log(`${this.founder?.profile?.icon || 'ğŸ‘¤'} As a first-time founder, you'll need to earn investor trust.`);
      }
    }
    
    // Apply funder bonus
    Object.entries(this.funder.bonus).forEach(([k, v]) => {
      if (this.metrics[k] !== undefined) this.metrics[k] += v;
    });
    
    document.getElementById("funderModal").classList.add("hidden");
    document.getElementById("funderModal").classList.remove("flex");
    this.log(`Funded by ${this.funder.name}. ${this.funder.ongoing}`);
    if (this.extremeMode) {
      this.log(`ğŸ”¥ EXTREME MODE: Stat effects & impact tags hidden. Silent advisors. 20% less cash. Good luck!`);
    }
    // Hire team first, then choose milestone based on team strengths
    this.showHiringModal();
  }

  showMilestoneModal() {
    // Play milestone choice sound
    soundManager.playMilestoneChoice();
    
    const milestoneData = MILESTONES[this.company.id];
    const completedCount = this.completedMilestones.length;
    
    console.log("showMilestoneModal called:", {
      completedCount,
      completedMilestones: this.completedMilestones,
      companyId: this.company.id
    });
    
    const mg = document.getElementById("milestoneGrid");
    
    // Show advisor button if team is hired
    const advisorBtn = document.getElementById("openAdvisorBtn");
    if (this.team.research && this.funder) {
      advisorBtn.classList.remove("hidden");
      // Store milestone data for advisor popup
      this.currentMilestoneData = milestoneData;
      this.currentMilestoneStage = completedCount;
    } else {
      advisorBtn.classList.add("hidden");
    }
    
    let milestones = [];
    let stageKey = "";
    let isFirstMilestone = false;
    
    if (completedCount === 0) {
      milestones = milestoneData.m1;
      stageKey = "m1";
      isFirstMilestone = true;
      document.getElementById("milestoneModalTitle").textContent = "Choose Your First Milestone";
      document.getElementById("milestoneModalDesc").textContent = "Your first major goal. Conservative is safer, Ambitious pays more but demands tight execution.";
    } else if (completedCount === 1) {
      milestones = milestoneData.m2;
      stageKey = "m2";
      document.getElementById("milestoneModalTitle").textContent = "Choose Your Second Milestone";
      document.getElementById("milestoneModalDesc").textContent = "You've proven yourself. Now scale upâ€”your team's strengths and runway should guide this choice.";
    } else if (completedCount === 2) {
      milestones = milestoneData.m3;
      stageKey = "m3";
      document.getElementById("milestoneModalTitle").textContent = "Choose Your Final Milestone";
      document.getElementById("milestoneModalDesc").textContent = "The endgame approaches. This milestone will define your company's legacy.";
    }
    
    const focusLabels = { sci: "Research", dev: "Product", mkt: "Sales", hr: "People" };
    const focusColors = { sci: "emerald", dev: "sky", mkt: "fuchsia", hr: "pink" };
    const difficultyColors = { 
      conservative: { bg: "bg-blue-50", border: "border-blue-300", text: "text-blue-700", label: "ğŸ›¡ Conservative" },
      balanced: { bg: "bg-amber-50", border: "border-amber-300", text: "text-amber-700", label: "âš– Balanced" },
      ambitious: { bg: "bg-red-50", border: "border-red-300", text: "text-red-700", label: "ğŸ”¥ Ambitious" }
    };
    
    // Get competition analysis for each milestone's focus areas
    const getCompetitionAnalysis = (focusAreas) => {
      const activeRivals = this.rivals.filter(r => r.status === "active");
      if (activeRivals.length === 0) return { level: 'clear', rivals: [], desc: 'No active competitors' };
      
      const focusToScore = { sci: 'sci', dev: 'dev', mkt: 'mkt', hr: 'hr' };
      const playerScores = focusAreas.map(f => this.metrics[focusToScore[f]] || 0);
      const playerAvg = playerScores.reduce((a, b) => a + b, 0) / playerScores.length;
      
      // Find rivals strong in these focus areas
      const strongRivals = activeRivals.filter(r => {
        const rivalScores = focusAreas.map(f => r.scores[focusToScore[f]] || 0);
        const rivalAvg = rivalScores.reduce((a, b) => a + b, 0) / rivalScores.length;
        return rivalAvg >= playerAvg - 5; // Within 5 points or better
      }).map(r => ({
        name: r.name,
        logo: r.logo,
        style: r.style,
        scores: focusAreas.reduce((acc, f) => { acc[f] = Math.round(r.scores[focusToScore[f]] || 0); return acc; }, {}),
        total: r.scores.sci + r.scores.dev + r.scores.mkt,
        milestoneProgress: r.milestones?.filter(m => m.status === "complete").length || 0,
        currentMilestone: r.milestones?.find(m => m.status === "in-progress")?.name
      }));
      
      const level = strongRivals.length >= 2 ? 'hot' : strongRivals.length === 1 ? 'contested' : 'clear';
      const desc = level === 'hot' ? `${strongRivals.length} rivals competing here` : 
                   level === 'contested' ? `1 rival strong here` : 'Less competition';
      
      return { level, rivals: strongRivals, desc, allRivals: activeRivals };
    };
    
    mg.innerHTML = milestones.map(m => {
      const diff = difficultyColors[m.difficulty];
      const competition = getCompetitionAnalysis(m.focus);
      const compColors = {
        hot: { bg: 'bg-red-100', text: 'text-red-700', icon: 'ğŸ”¥' },
        contested: { bg: 'bg-amber-100', text: 'text-amber-700', icon: 'âš”ï¸' },
        clear: { bg: 'bg-emerald-100', text: 'text-emerald-700', icon: 'ğŸŸ¢' }
      };
      const compStyle = compColors[competition.level];
      
      return `
        <div data-id="${m.id}" class="milestone-card border-2 border-slate-200 rounded-xl text-left bg-white hover:border-amber-300 hover:shadow-md transition-all relative flex flex-col overflow-hidden">
          
          <!-- Difficulty Banner -->
          <div class="px-4 py-2 ${diff.bg} border-b ${diff.border} flex items-center justify-between">
            <span class="${diff.text} text-sm font-bold">${diff.label}</span>
            <button onclick="event.stopPropagation(); game.showMilestoneIntel('${m.id}', ${JSON.stringify(m.focus).replace(/"/g, '&quot;')})" 
                    class="px-2 py-1 ${compStyle.bg} ${compStyle.text} text-xs font-medium rounded-full hover:opacity-80 transition-opacity flex items-center gap-1">
              ${compStyle.icon} Competitor Intel
            </button>
          </div>
          
          <!-- Main Content -->
          <div class="p-4 flex-1 flex flex-col">
            <!-- Icon and Title -->
            <div class="flex items-start gap-3 mb-2">
              <span class="text-2xl">${m.icon || 'ğŸ¯'}</span>
              <h3 class="font-bold text-slate-800 text-base leading-tight">${m.name}</h3>
            </div>
            
            <!-- Description -->
            <p class="text-sm text-slate-600 mb-3">${m.desc}</p>
            
            <!-- Focus Areas -->
            <div class="flex flex-wrap gap-1.5 mb-4">
              ${m.focus.map(f => `<span class="px-2 py-1 rounded-full bg-${focusColors[f]}-100 text-${focusColors[f]}-700 text-xs font-medium">${focusLabels[f]}</span>`).join('')}
            </div>
            
            <!-- Spacer -->
            <div class="flex-1"></div>
            
            <!-- Timeline & Rewards - Clear display -->
            <div class="bg-slate-50 rounded-lg p-3 space-y-2">
              <div class="flex justify-between items-center">
                <span class="text-sm text-slate-600">â± Timeline</span>
                <span class="text-sm font-bold font-mono text-slate-800">${m.time} quarters</span>
              </div>
              <div class="border-t border-slate-200 pt-2 grid grid-cols-2 gap-2">
                <div class="bg-emerald-50 rounded-lg p-2 text-center">
                  <div class="text-lg font-bold font-mono text-emerald-600">+Â£${m.reward.cash}k</div>
                  <div class="text-xs text-emerald-700">Cash Reward</div>
                </div>
                <div class="bg-blue-50 rounded-lg p-2 text-center">
                  <div class="text-lg font-bold font-mono text-blue-600">+Â£${m.reward.val}k</div>
                  <div class="text-xs text-blue-700">Valuation Boost</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Choose Button -->
          <div class="border-t border-slate-100 p-3 bg-slate-50">
            <button onclick="event.stopPropagation(); game.chooseMilestone('${m.id}')" class="w-full px-4 py-2.5 bg-amber-500 hover:bg-amber-600 text-white text-sm font-bold rounded-lg transition-colors">
              Choose This Path
            </button>
          </div>
        </div>
      `;
    }).join("");
    
    // Render competitor and advisor panels
    this.renderMilestoneCompetitorPanel(completedCount);
    this.renderMilestoneAdvisorPanel(milestoneData, completedCount);
    
    document.getElementById("milestoneModal").classList.remove("hidden");
    document.getElementById("milestoneModal").classList.add("flex");
  }
  
  renderMilestoneCompetitorPanel(playerMilestoneCount) {
    const panel = document.getElementById("milestoneCompetitorPanel");
    const activeRivals = this.rivals.filter(r => r.status === "active");
    
    if (activeRivals.length === 0) {
      panel.classList.add("hidden");
      return;
    }
    
    panel.classList.remove("hidden");
    
    // Build race track data
    const playerTotal = this.metrics.sci + this.metrics.dev + this.metrics.mkt;
    const raceData = [
      { 
        name: this.company?.name || "You", 
        logo: 'â­', 
        isPlayer: true,
        milestones: playerMilestoneCount,
        total: playerTotal
      },
      ...activeRivals.map(r => ({
        name: r.name,
        logo: r.logo,
        isPlayer: false,
        milestones: r.milestones?.filter(m => m.status === "complete").length || 0,
        total: r.scores.sci + r.scores.dev + r.scores.mkt,
        style: r.style,
        currentWork: r.milestones?.find(m => m.status === "in-progress")?.name
      }))
    ].sort((a, b) => b.milestones - a.milestones || b.total - a.total);
    
    // Find player position
    const playerPosition = raceData.findIndex(r => r.isPlayer) + 1;
    const leader = raceData[0];
    const isPlayerLeading = leader.isPlayer;
    
    // Race track HTML - very compact
    const trackHtml = raceData.map((r, i) => {
      const progressPct = (r.milestones / 3) * 100;
      const bgColor = r.isPlayer ? 'bg-indigo-500' : 'bg-slate-400';
      const borderColor = r.isPlayer ? 'border-indigo-300 bg-indigo-50' : 'border-slate-200 bg-white';
      
      return `
        <div class="flex items-center gap-1 p-1 rounded ${borderColor} border">
          <span class="text-[10px] font-bold font-mono ${r.isPlayer ? 'text-indigo-600' : 'text-slate-400'}">#${i + 1}</span>
          <span class="text-xs">${r.logo}</span>
          <div class="flex-1 min-w-0">
            <div class="w-full h-1 bg-slate-200 rounded-full">
              <div class="h-full ${bgColor} rounded-full" style="width: ${progressPct}%"></div>
            </div>
          </div>
          <span class="text-[10px] font-mono text-slate-500">${r.milestones}/3</span>
        </div>
      `;
    }).join('');
    
    // Determine grid columns based on number of rivals
    const gridCols = raceData.length <= 2 ? 'grid-cols-2' : raceData.length <= 3 ? 'grid-cols-3' : 'grid-cols-4';
    
    // Status message - short
    let statusMsg, statusColor;
    if (isPlayerLeading) {
      statusMsg = "ğŸ† Leading! +20% bonus for first.";
      statusColor = 'text-emerald-700 bg-emerald-50 border-emerald-200';
    } else {
      const behind = leader.milestones - playerMilestoneCount;
      statusMsg = behind > 0 
        ? `âš ï¸ ${behind} behind ${leader.name}`
        : `ğŸ Tiedâ€”race for +20% bonus`;
      statusColor = behind > 0 ? 'text-amber-700 bg-amber-50 border-amber-200' : 'text-blue-700 bg-blue-50 border-blue-200';
    }
    
    panel.innerHTML = `
      <div class="bg-slate-50 rounded-lg border border-slate-200 p-2">
        <div class="flex items-center gap-3">
          <div class="flex items-center gap-1">
            <span class="text-sm">ğŸ</span>
            <span class="font-bold text-slate-700 text-xs">Race</span>
          </div>
          <div class="flex-1 grid ${gridCols} gap-1.5">
            ${trackHtml}
          </div>
          <div class="text-[10px] p-1.5 rounded border ${statusColor} max-w-[200px]">
            ${statusMsg}
          </div>
        </div>
      </div>
    `;
  }
  
  renderMilestoneAdvisorPanel(milestoneData, completedCount) {
    const panel = document.getElementById("milestoneAdvisorPanel");
    
    // Only show for first milestone when team is hired
    if (!this.team.research || !this.funder) {
      panel.classList.add("hidden");
      return;
    }
    
    panel.classList.remove("hidden");
    
    const stageKey = completedCount === 0 ? 'm1' : completedCount === 1 ? 'm2' : 'm3';
    const milestones = milestoneData[stageKey] || [];
    
    // Calculate team strengths
    const teamStrengths = this.calculateTeamStrengths();
    
    // Find best milestone match for team
    const milestoneScores = milestones.map(m => {
      let score = 0;
      m.focus.forEach(f => {
        if (f === 'sci') score += teamStrengths.research;
        if (f === 'dev') score += teamStrengths.dev;
        if (f === 'mkt') score += teamStrengths.marketing;
      });
      return { milestone: m, score: score / m.focus.length };
    }).sort((a, b) => b.score - a.score);
    
    const bestMatch = milestoneScores[0]?.milestone;
    const worstMatch = milestoneScores[milestoneScores.length - 1]?.milestone;
    
    // Generate team advice based on strengths
    const strongestArea = Object.entries(teamStrengths).sort((a, b) => b[1] - a[1])[0];
    const weakestArea = Object.entries(teamStrengths).sort((a, b) => a[1] - b[1])[0];
    
    const areaLabels = { research: 'Research', dev: 'Product', marketing: 'Sales' };
    const areaToFocus = { research: 'sci', dev: 'dev', marketing: 'mkt' };
    
    // Generate funder advice based on their personality
    let funderAdvice = '';
    const funderType = this.funder.id || '';
    
    if (funderType.includes('bootstrap')) {
      funderAdvice = "Focus on capital efficiency. Conservative milestones let you extend runway while proving traction.";
    } else if (funderType.includes('angel') || funderType.includes('strategic')) {
      funderAdvice = "I've seen startups burn out chasing ambitious goals too early. Build a strong foundation first.";
    } else if (funderType.includes('seed') || funderType.includes('vc') || funderType.includes('VC')) {
      funderAdvice = "We invested for growth. Don't be afraid of ambitious targetsâ€”that's what differentiates category leaders.";
    } else if (funderType.includes('accelerator')) {
      funderAdvice = "Speed matters in accelerators. Pick something you can demonstrate progress on quickly.";
    } else if (funderType === 'self') {
      funderAdvice = "It's your money on the line. Be realistic about what you can achieve before needing outside investment.";
    } else {
      // Default based on funder personality
      const personality = this.funder.personality || '';
      if (personality.toLowerCase().includes('aggressive') || personality.toLowerCase().includes('growth')) {
        funderAdvice = "Go big or go home. The market rewards bold moves.";
      } else if (personality.toLowerCase().includes('patient') || personality.toLowerCase().includes('careful')) {
        funderAdvice = "Build methodically. Sustainable growth beats flash-in-the-pan success.";
      } else {
        funderAdvice = "Choose what plays to your team's strengths. Execution beats ambition every time.";
      }
    }
    
    // Team member quotes based on their focus
    const researchLead = this.team.research;
    const devLead = this.team.dev;
    const marketingLead = this.team.marketing;
    
    let teamQuotes = [];
    
    if (researchLead) {
      const researchFocus = milestones.filter(m => m.focus.includes('sci'));
      if (researchFocus.length > 0 && teamStrengths.research >= 3) {
        teamQuotes.push({
          name: researchLead.name,
          role: 'Research',
          color: 'emerald',
          quote: `My team can deliver on research-heavy milestones. ${researchFocus[0]?.name ? `"${researchFocus[0].name}" plays to our strengths.` : ''}`
        });
      } else if (teamStrengths.research < 3) {
        teamQuotes.push({
          name: researchLead.name,
          role: 'Research',
          color: 'emerald',
          quote: "We're still building research capacity. Heavy R&D milestones will be challenging."
        });
      }
    }
    
    if (devLead) {
      const devFocus = milestones.filter(m => m.focus.includes('dev'));
      if (devFocus.length > 0 && teamStrengths.dev >= 3) {
        teamQuotes.push({
          name: devLead.name,
          role: 'Product',
          color: 'sky',
          quote: `Product-focused goals are our wheelhouse. We can ship fast.`
        });
      } else if (teamStrengths.dev < 3) {
        teamQuotes.push({
          name: devLead.name,
          role: 'Product',
          color: 'sky',
          quote: "Product team needs more runway to hit aggressive targets. Keep expectations realistic."
        });
      }
    }
    
    if (marketingLead) {
      const mktFocus = milestones.filter(m => m.focus.includes('mkt'));
      if (mktFocus.length > 0 && teamStrengths.marketing >= 3) {
        teamQuotes.push({
          name: marketingLead.name,
          role: 'Sales',
          color: 'fuchsia',
          quote: `Give me a sales target and we'll crush it. Market-facing milestones are where we shine.`
        });
      } else if (teamStrengths.marketing < 3) {
        teamQuotes.push({
          name: marketingLead.name,
          role: 'Sales',
          color: 'fuchsia',
          quote: "Sales pipeline takes time to build. Don't overcommit on revenue targets yet."
        });
      }
    }
    
    // Color class mappings (Tailwind needs static classes)
    const colorClasses = {
      emerald: { bg50: 'bg-emerald-50', bg100: 'bg-emerald-100', bg200: 'bg-emerald-200', bg500: 'bg-emerald-500', text500: 'text-emerald-500', text700: 'text-emerald-700', border: 'border-emerald-100' },
      sky: { bg50: 'bg-sky-50', bg100: 'bg-sky-100', bg200: 'bg-sky-200', bg500: 'bg-sky-500', text500: 'text-sky-500', text700: 'text-sky-700', border: 'border-sky-100' },
      fuchsia: { bg50: 'bg-fuchsia-50', bg100: 'bg-fuchsia-100', bg200: 'bg-fuchsia-200', bg500: 'bg-fuchsia-500', text500: 'text-fuchsia-500', text700: 'text-fuchsia-700', border: 'border-fuchsia-100' }
    };
    
    // Build team quotes HTML (show max 2)
    const quotesHtml = teamQuotes.slice(0, 2).map(q => {
      const c = colorClasses[q.color] || colorClasses.emerald;
      return `
        <div class="flex items-start gap-2 p-2 ${c.bg50} rounded-lg border ${c.border}">
          <div class="w-6 h-6 rounded-full ${c.bg200} flex items-center justify-center text-xs font-bold ${c.text700}">${q.name.charAt(0)}</div>
          <div class="flex-1 min-w-0">
            <div class="text-xs font-medium ${c.text700}">${q.name} <span class="${c.text500}">â€¢ ${q.role}</span></div>
            <p class="text-xs text-slate-600 italic">"${q.quote}"</p>
          </div>
        </div>
      `;
    }).join('');
    
    // Build strength indicators
    const strengthsHtml = Object.entries(teamStrengths).map(([area, score]) => {
      const areaColorClasses = { research: colorClasses.emerald, dev: colorClasses.sky, marketing: colorClasses.fuchsia };
      const c = areaColorClasses[area];
      const filled = Math.round(score);
      return `
        <div class="flex items-center gap-1">
          <span class="text-[10px] text-slate-500 w-14">${areaLabels[area]}</span>
          <div class="flex gap-0.5">
            ${[1,2,3,4,5].map(i => `<div class="w-1.5 h-1.5 rounded-full ${i <= filled ? c.bg500 : 'bg-slate-200'}"></div>`).join('')}
          </div>
        </div>
      `;
    }).join('');
    
    // Truncate funder advice
    const shortFunderAdvice = funderAdvice.length > 80 ? funderAdvice.substring(0, 77) + '...' : funderAdvice;
    
    panel.innerHTML = `
      <div class="bg-gradient-to-r from-violet-50 to-slate-50 rounded-lg border border-violet-200 p-2">
        <div class="flex items-center gap-4">
          <!-- Funder Advice -->
          <div class="flex items-center gap-2 flex-1 min-w-0">
            <div class="w-6 h-6 rounded-full bg-amber-100 flex items-center justify-center text-xs flex-shrink-0">ğŸ’°</div>
            <div class="min-w-0">
              <span class="text-[10px] font-bold text-slate-600">${this.funder.name}:</span>
              <span class="text-[10px] text-slate-500 italic"> "${shortFunderAdvice}"</span>
            </div>
          </div>
          
          <!-- Team Strengths -->
          <div class="flex items-center gap-3 flex-shrink-0">
            <div class="flex items-center gap-1">
              <span class="text-xs">ğŸ‘¥</span>
              <span class="text-[10px] font-bold text-slate-600">Team:</span>
            </div>
            <div class="flex gap-2">
              ${strengthsHtml}
            </div>
            ${bestMatch ? `<span class="text-[10px] text-violet-600 font-medium">âœ¨ ${bestMatch.name}</span>` : ''}
          </div>
        </div>
      </div>
    `;
  }
  
  calculateTeamStrengths() {
    // For M2/M3, use actual metrics which reflect company growth
    // Scale metrics (typically 0-100) to strength rating (1-5)
    if (this.completedMilestones && this.completedMilestones.length > 0) {
      return {
        research: Math.min(5, Math.max(1, Math.round(this.metrics.sci / 20) + 1)),
        dev: Math.min(5, Math.max(1, Math.round(this.metrics.dev / 20) + 1)),
        marketing: Math.min(5, Math.max(1, Math.round(this.metrics.mkt / 20) + 1))
      };
    }
    
    // For M1, use team bonuses since no metrics built yet
    const strengths = { research: 2, dev: 2, marketing: 2 }; // Base level
    
    // Add bonuses from team members
    if (this.team.research) {
      const exec = this.team.research;
      if (exec.bonus?.sci) strengths.research += exec.bonus.sci;
      if (exec.effects?.some(e => e.includes('Research') || e.includes('sci'))) strengths.research += 1;
      strengths.research = Math.min(5, strengths.research);
    }
    
    if (this.team.dev) {
      const exec = this.team.dev;
      if (exec.bonus?.dev) strengths.dev += exec.bonus.dev;
      if (exec.effects?.some(e => e.includes('Product') || e.includes('dev'))) strengths.dev += 1;
      strengths.dev = Math.min(5, strengths.dev);
    }
    
    if (this.team.marketing) {
      const exec = this.team.marketing;
      if (exec.bonus?.mkt) strengths.marketing += exec.bonus.mkt;
      if (exec.effects?.some(e => e.includes('Sales') || e.includes('mkt'))) strengths.marketing += 1;
      strengths.marketing = Math.min(5, strengths.marketing);
    }
    
    return strengths;
  }
  
  showMilestoneIntel(milestoneId, focusAreas) {
    const focusLabels = { sci: "Research", dev: "Product", mkt: "Sales", hr: "People" };
    
    // Parse focus areas if it's a string
    if (typeof focusAreas === 'string') {
      try {
        focusAreas = JSON.parse(focusAreas);
      } catch (e) {
        focusAreas = ['sci', 'dev']; // fallback
      }
    }
    
    document.getElementById("intelFocusAreas").textContent = `Focus areas: ${focusAreas.map(f => focusLabels[f]).join(' & ')}`;
    
    const activeRivals = this.rivals.filter(r => r.status === "active");
    const playerScores = focusAreas.map(f => this.metrics[f] || 0);
    const playerAvg = playerScores.reduce((a, b) => a + b, 0) / playerScores.length;
    
    // Analyze each rival's strength in these focus areas - qualitatively
    const rivalAnalysis = activeRivals.map(r => {
      const scores = focusAreas.map(f => r.scores[f] || 0);
      const avg = scores.reduce((a, b) => a + b, 0) / scores.length;
      const diff = avg - playerAvg;
      const threat = diff > 5 ? 'high' : diff > -5 ? 'medium' : 'low';
      
      // Determine qualitative strengths
      const strengths = [];
      const weaknesses = [];
      focusAreas.forEach(f => {
        const playerScore = this.metrics[f] || 0;
        const rivalScore = r.scores[f] || 0;
        if (rivalScore > playerScore + 3) strengths.push(focusLabels[f]);
        else if (rivalScore < playerScore - 3) weaknesses.push(focusLabels[f]);
      });
      
      return {
        name: r.name,
        logo: r.logo,
        style: r.style,
        funded: r.funded,
        threat,
        strengths,
        weaknesses,
        milestoneProgress: r.milestones?.filter(m => m.status === "complete").length || 0,
        currentMilestone: r.milestones?.find(m => m.status === "in-progress")?.name,
        ceo: r.ceo
      };
    }).sort((a, b) => {
      const threatOrder = { high: 0, medium: 1, low: 2 };
      return threatOrder[a.threat] - threatOrder[b.threat];
    });
    
    // Rival cards - qualitative
    const rivalCardsHtml = rivalAnalysis.map(r => {
      const threatColors = {
        high: { bg: 'bg-red-50', border: 'border-red-200', badge: 'bg-red-100 text-red-700' },
        medium: { bg: 'bg-amber-50', border: 'border-amber-200', badge: 'bg-amber-100 text-amber-700' },
        low: { bg: 'bg-emerald-50', border: 'border-emerald-200', badge: 'bg-emerald-100 text-emerald-700' }
      };
      const tc = threatColors[r.threat];
      const styleDescriptions = { 
        aggressive: 'Moves fast, takes risks', 
        methodical: 'Steady, consistent progress', 
        cautious: 'Conservative, careful approach' 
      };
      
      // Build qualitative assessment
      let assessment = '';
      if (r.strengths.length > 0 && r.weaknesses.length > 0) {
        assessment = `Strong in ${r.strengths.join(' & ')}, but weaker in ${r.weaknesses.join(' & ')}`;
      } else if (r.strengths.length > 0) {
        assessment = `Strong in ${r.strengths.join(' & ')}â€”a serious contender here`;
      } else if (r.weaknesses.length > 0) {
        assessment = `Weaker in ${r.weaknesses.join(' & ')}â€”less of a threat`;
      } else {
        assessment = 'Roughly matched with your capabilities';
      }
      
      // Milestone status description
      const milestoneDesc = r.milestoneProgress === 0 ? 'Just starting out' :
                           r.milestoneProgress === 1 ? 'One milestone done' :
                           r.milestoneProgress === 2 ? 'Two milestones doneâ€”moving fast' : 'Nearly complete';
      
      return `
        <div class="${tc.bg} ${tc.border} border rounded-lg p-3 mb-2">
          <div class="flex items-start gap-2">
            <span class="text-xl">${r.logo}</span>
            <div class="flex-1">
              <div class="flex items-center justify-between mb-1">
                <span class="font-bold text-slate-800 text-sm">${r.name}</span>
                <span class="text-[10px] px-2 py-0.5 rounded-full ${tc.badge}">
                  ${r.threat === 'high' ? 'âš ï¸ Strong threat' : r.threat === 'medium' ? 'âš”ï¸ Competitive' : 'âœ“ Less threat'}
                </span>
              </div>
              
              <p class="text-xs text-slate-600 mb-2">${assessment}</p>
              
              <div class="flex flex-wrap gap-x-3 gap-y-1 text-[10px] text-slate-500">
                <span>ğŸ“‹ ${styleDescriptions[r.style] || r.style}</span>
                <span>ğŸ’° ${r.funded}</span>
                <span>ğŸ ${milestoneDesc}</span>
              </div>
              
              ${r.currentMilestone ? `
                <div class="mt-2 text-xs text-indigo-600">
                  ğŸ“ Currently pursuing: ${r.currentMilestone}
                </div>
              ` : ''}
              
              ${r.ceo?.quote ? `
                <div class="mt-2 pt-2 border-t border-slate-200/50 text-[10px] text-slate-500 italic">
                  "${r.ceo.quote.substring(0, 60)}${r.ceo.quote.length > 60 ? '...' : ''}"
                  <span class="text-slate-400">â€” ${r.ceo.name}</span>
                </div>
              ` : ''}
            </div>
          </div>
        </div>
      `;
    }).join('');
    
    // Strategic recommendation
    const highThreats = rivalAnalysis.filter(r => r.threat === 'high').length;
    const mediumThreats = rivalAnalysis.filter(r => r.threat === 'medium').length;
    
    let recommendation;
    if (highThreats >= 2) {
      recommendation = `<span class="text-red-700 font-medium">ğŸ”¥ Crowded space</span> â€” Multiple rivals are strong here. You'll face stiff competition and may struggle to differentiate.`;
    } else if (highThreats === 1) {
      const strongRival = rivalAnalysis.find(r => r.threat === 'high');
      recommendation = `<span class="text-amber-700 font-medium">âš”ï¸ One major rival</span> â€” ${strongRival?.name} is well-positioned here. You can win, but expect a fight.`;
    } else if (mediumThreats >= 2) {
      recommendation = `<span class="text-blue-700 font-medium">ğŸ Competitive field</span> â€” Several rivals are in the running. Speed and execution will determine the winner.`;
    } else {
      recommendation = `<span class="text-emerald-700 font-medium">âœ“ Open opportunity</span> â€” You have an advantage here. A good chance to establish leadership.`;
    }
    
    document.getElementById("milestoneIntelContent").innerHTML = `
      <div class="mb-3">
        <div class="text-xs font-bold text-slate-700 mb-2">Competitors in this space</div>
        ${rivalCardsHtml}
      </div>
      
      <div class="p-3 bg-slate-100 rounded-lg border border-slate-200">
        <div class="text-xs font-medium text-slate-700 mb-1">ğŸ’¡ Bottom Line</div>
        <p class="text-xs text-slate-600">${recommendation}</p>
      </div>
    `;
    
    document.getElementById("milestoneIntelModal").classList.remove("hidden");
    document.getElementById("milestoneIntelModal").classList.add("flex");
  }
  
  closeMilestoneIntel() {
    document.getElementById("milestoneIntelModal").classList.add("hidden");
    document.getElementById("milestoneIntelModal").classList.remove("flex");
  }
  
  showAdvisorSuggestions() {
    const milestoneData = this.currentMilestoneData;
    const completedCount = this.currentMilestoneStage;
    
    if (!milestoneData || !this.team.research || !this.funder) return;
    
    const stageKey = completedCount === 0 ? 'm1' : completedCount === 1 ? 'm2' : 'm3';
    const milestones = milestoneData[stageKey] || [];
    
    // Calculate team strengths
    const teamStrengths = this.calculateTeamStrengths();
    
    // Find best milestone match for team
    const milestoneScores = milestones.map(m => {
      let score = 0;
      m.focus.forEach(f => {
        if (f === 'sci') score += teamStrengths.research;
        if (f === 'dev') score += teamStrengths.dev;
        if (f === 'mkt') score += teamStrengths.marketing;
      });
      return { milestone: m, score: score / m.focus.length };
    }).sort((a, b) => b.score - a.score);
    
    const bestMatch = milestoneScores[0]?.milestone;
    const worstMatch = milestoneScores[milestoneScores.length - 1]?.milestone;
    
    const focusLabels = { sci: 'Research', dev: 'Product', mkt: 'Sales' };
    const bestMatchFocus = bestMatch?.focus.map(f => focusLabels[f]).join(' & ') || '';
    
    // Get milestone by difficulty
    const conservative = milestones.find(m => m.difficulty === 'conservative');
    const balanced = milestones.find(m => m.difficulty === 'balanced');
    const ambitious = milestones.find(m => m.difficulty === 'ambitious');
    
    // Department head opinions based on their personality
    const researchExec = this.team.research;
    const devExec = this.team.dev;
    const mktExec = this.team.marketing;
    
    // Research Lead opinion - based on their personality
    let researchOpinion = { pick: bestMatch, quote: '', concern: '' };
    if (researchExec) {
      if (researchExec.id === 'fatima') {
        // Methodical, cautious - favors conservative
        researchOpinion.pick = conservative;
        researchOpinion.quote = `"${conservative?.name}" gives us time to do things properly. I won't sign off on rushed scienceâ€”too much at stake.`;
        if (ambitious) researchOpinion.concern = `"${ambitious.name}" worries me. The timeline is aggressive and cutting corners on research will haunt us.`;
      } else if (researchExec.id === 'yuki') {
        // Collaborative, patient - favors balanced
        researchOpinion.pick = balanced;
        researchOpinion.quote = `I think "${balanced?.name}" balances ambition with realism. We can build good partnerships along the way.`;
        if (ambitious) researchOpinion.concern = `"${ambitious.name}" might stretch our collaborative relationshipsâ€”partners don't like being rushed.`;
      } else if (researchExec.id === 'kwame') {
        // Bold, ambitious - favors ambitious
        researchOpinion.pick = ambitious;
        researchOpinion.quote = `We should go for "${ambitious?.name}". We're not here to play smallâ€”this is our chance to make a real statement.`;
        if (conservative) researchOpinion.concern = `"${conservative.name}" feels like we're settling. Investors didn't back us to be cautious.`;
      }
    }
    
    // Dev Lead opinion - based on their personality
    let devOpinion = { pick: bestMatch, quote: '', concern: '' };
    if (devExec) {
      if (devExec.id === 'aoife') {
        // Quality-obsessed, systematic - warns about rushing
        devOpinion.pick = conservative || balanced;
        devOpinion.quote = `From an engineering perspective, "${conservative?.name || balanced?.name}" lets us build it right. There's fast, and there's fast in six months.`;
        if (ambitious) devOpinion.concern = `"${ambitious.name}" timeline means technical debt. We'll pay for shortcuts laterâ€”trust me.`;
      } else if (devExec.id === 'raj') {
        // Pragmatic, ships fast - confident about balanced or ambitious
        devOpinion.pick = balanced || ambitious;
        devOpinion.quote = `I've shipped in tighter spots than this. "${balanced?.name || ambitious?.name}"â€”we can hit it if we stay focused.`;
        if (conservative) devOpinion.concern = `Just sayingâ€”"${conservative.name}" might be too slow. Market doesn't wait. Sometimes done beats perfect.`;
      } else if (devExec.id === 'wei') {
        // Sustainable pace, people-focused - warns about burnout
        devOpinion.pick = conservative || balanced;
        devOpinion.quote = `I'd lean toward "${conservative?.name || balanced?.name}". Sustainable pace builds better software and keeps the team healthy.`;
        if (ambitious) devOpinion.concern = `"${ambitious.name}" will require crunch. I can push the team but not foreverâ€”burnout is real.`;
      }
    }
    
    // Marketing Lead opinion - based on their personality
    let mktOpinion = { pick: bestMatch, quote: '', concern: '' };
    if (mktExec) {
      if (mktExec.id === 'priya') {
        // Relationship-driven, enterprise sales - favors partnership milestones
        const partnershipMilestone = milestones.find(m => m.name.toLowerCase().includes('partner') || m.name.toLowerCase().includes('pilot') || m.focus.includes('mkt'));
        mktOpinion.pick = partnershipMilestone || balanced;
        mktOpinion.quote = `"${mktOpinion.pick?.name}" plays to our strengths. I've got relationships that can open doors hereâ€”let me work them.`;
        if (conservative && conservative.focus.every(f => f === 'sci' || f === 'dev')) {
          mktOpinion.concern = `"${conservative.name}" doesn't let me contribute much. My network goes cold if I'm not working it.`;
        }
      } else if (mktExec.id === 'marcus') {
        // Metrics-driven, growth hacker - favors measurable outcomes
        mktOpinion.pick = ambitious || balanced;
        mktOpinion.quote = `"${ambitious?.name || balanced?.name}" gives us clear metrics to hit. I can build funnels around concrete targets.`;
        if (conservative) mktOpinion.concern = `"${conservative.name}" is hard to measure progress on. How do I know if we're winning?`;
      } else if (mktExec.id === 'emma') {
        // Brand strategist, patient - favors brand-building
        mktOpinion.pick = conservative || balanced;
        mktOpinion.quote = `"${conservative?.name || balanced?.name}" lets us build the brand properly. Reputation compoundsâ€”rushing damages it.`;
        if (ambitious) mktOpinion.concern = `"${ambitious.name}" might force us to cut corners on messaging. Brand damage is hard to undo.`;
      }
    }
    
    // Build opinion cards
    const opinions = [
      { exec: researchExec, opinion: researchOpinion, role: 'Research', color: 'emerald', emoji: 'ğŸ”¬' },
      { exec: devExec, opinion: devOpinion, role: 'Product', color: 'sky', emoji: 'âš™ï¸' },
      { exec: mktExec, opinion: mktOpinion, role: 'Sales', color: 'fuchsia', emoji: 'ğŸ“ˆ' }
    ].filter(o => o.exec);
    
    // Count votes
    const votes = {};
    opinions.forEach(o => {
      const pickId = o.opinion.pick?.id;
      if (pickId) votes[pickId] = (votes[pickId] || 0) + 1;
    });
    const consensusPick = Object.entries(votes).sort((a, b) => b[1] - a[1])[0];
    const hasConsensus = consensusPick && consensusPick[1] >= 2;
    const consensusMilestone = hasConsensus ? milestones.find(m => m.id === consensusPick[0]) : bestMatch;
    
    // Color classes for explicit Tailwind
    const colorClasses = {
      emerald: { bg: 'bg-emerald-50', border: 'border-emerald-200', text: 'text-emerald-700', badge: 'bg-emerald-100 text-emerald-800' },
      sky: { bg: 'bg-sky-50', border: 'border-sky-200', text: 'text-sky-700', badge: 'bg-sky-100 text-sky-800' },
      fuchsia: { bg: 'bg-fuchsia-50', border: 'border-fuchsia-200', text: 'text-fuchsia-700', badge: 'bg-fuchsia-100 text-fuchsia-800' }
    };
    
    const opinionsHtml = opinions.map(o => {
      const c = colorClasses[o.color];
      const isAgree = o.opinion.pick?.id === consensusMilestone?.id;
      return `
        <div class="${c.bg} ${c.border} border rounded-xl p-4">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-2">
              <span class="text-lg">${o.emoji}</span>
              <div>
                <span class="font-bold ${c.text}">${o.exec.name}</span>
                <span class="text-xs ${c.text} opacity-70 ml-1">${o.role} Lead</span>
              </div>
            </div>
            <span class="text-xs px-2 py-1 rounded-full ${c.badge}">
              Picks: ${o.opinion.pick?.name?.split(' ').slice(0, 2).join(' ') || 'Undecided'}
            </span>
          </div>
          <p class="text-sm ${c.text} mb-2">"${o.opinion.quote}"</p>
          ${o.opinion.concern ? `
            <div class="mt-2 pt-2 border-t ${c.border} text-xs ${c.text} opacity-80">
              âš ï¸ ${o.opinion.concern}
            </div>
          ` : ''}
        </div>
      `;
    }).join('');
    
    // Investor opinion - varies by stage
    let funderRec = '';
    let funderPick = consensusMilestone;
    const funderType = this.funder.id || '';
    const isM2 = completedCount === 1;
    const isM3 = completedCount === 2;
    
    if (funderType.includes('bootstrap') || funderType === 'self') {
      funderPick = conservative;
      if (isM3) {
        funderRec = `You've come this far on your own terms. "${conservative?.name}" lets you finish strong without risking everything.`;
      } else if (isM2) {
        funderRec = `Good progress, but cash is still tight. "${conservative?.name}" protects what you've built.`;
      } else {
        funderRec = `Every pound counts. "${conservative?.name}" extends your runwayâ€”survive first, then thrive.`;
      }
    } else if (funderType === 'academicAngel') {
      // Molly prefers research-focused milestones, or balanced if none available
      const researchMilestone = milestones.find(m => m.focus.includes('sci'));
      funderPick = researchMilestone || balanced;
      if (isM3) {
        funderRec = `The science you've built is your legacy. "${funderPick?.name}" lets you finish with work that will be cited for years.`;
      } else if (isM2) {
        funderRec = `Your research foundation is solid. "${funderPick?.name}" builds on that strengthâ€”scientific credibility compounds.`;
      } else {
        funderRec = `"${funderPick?.name}" invests in the research that differentiates you. Rigour now pays dividends later.`;
      }
    } else if (funderType.includes('angel') || funderType.includes('strategic') || funderType.includes('dragon')) {
      funderPick = balanced;
      if (isM3) {
        funderRec = `You've proven yourself. "${balanced?.name}" is a strong finish that sets up a good exit.`;
      } else if (isM2) {
        funderRec = `Momentum is building. "${balanced?.name}" keeps you on track for Series A.`;
      } else {
        funderRec = `"${balanced?.name}" shows ambition without recklessness. That's what I like to see.`;
      }
    } else if (funderType.includes('seed') || funderType.includes('vc') || funderType.includes('VC') || funderType.includes('tier1') || funderType.includes('sector') || funderType.includes('corporate')) {
      funderPick = ambitious;
      if (isM3) {
        funderRec = `This is the moment. "${ambitious?.name}"â€”go for category leadership. That's what gets you acquired.`;
      } else if (isM2) {
        funderRec = `Your metrics look solid. Time to accelerateâ€”"${ambitious?.name}" positions us for a big Series A.`;
      } else {
        funderRec = `We invested for category leadership. "${ambitious?.name}"â€”show us you can play at that level.`;
      }
    } else {
      funderRec = `Your team knows the business best. I'd go with whatever plays to your strengths.`;
    }
    
    // Determine if there's disagreement
    const disagreement = opinions.some(o => o.opinion.pick?.id !== consensusMilestone?.id);
    
    // Stage-aware messaging
    const stageContext = isM3 ? 'Your final milestone will define the outcome.' :
                         isM2 ? 'This milestone sets up your endgame.' :
                         'This sets the foundation for everything that follows.';
    
    document.getElementById("advisorModalContent").innerHTML = `
      <!-- Consensus/Recommendation Banner -->
      <div class="mb-5 p-5 ${hasConsensus ? 'bg-gradient-to-r from-violet-500 to-indigo-500' : 'bg-gradient-to-r from-amber-500 to-orange-500'} rounded-xl text-white">
        <div class="text-sm font-medium opacity-90 mb-2">
          ${hasConsensus ? 'âœ… TEAM CONSENSUS' : 'âš–ï¸ SPLIT DECISION'}
        </div>
        <div class="text-2xl font-bold mb-2">${consensusMilestone?.name || 'No clear winner'}</div>
        <p class="text-sm opacity-90">
          ${hasConsensus 
            ? `Your team agreesâ€”${stageContext}` 
            : `Your team has different views. ${stageContext}`}
        </p>
        <button onclick="game.closeAdvisorModal(); game.chooseMilestone('${consensusMilestone?.id}')" 
                class="mt-4 w-full py-2.5 bg-white ${hasConsensus ? 'text-violet-700' : 'text-amber-700'} font-bold rounded-lg hover:bg-opacity-90 transition-colors">
          ${hasConsensus ? 'Go With Team Consensus' : 'Select This Milestone'}
        </button>
      </div>
      
      <!-- Department Head Opinions -->
      <div class="mb-4">
        <div class="flex items-center gap-2 mb-3">
          <span class="text-lg">ğŸ‘¥</span>
          <span class="font-bold text-slate-700">What Your Team Thinks</span>
          ${disagreement ? '<span class="text-xs bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full">Views differ</span>' : ''}
        </div>
        <div class="space-y-3">
          ${opinionsHtml}
        </div>
      </div>
      
      <!-- Investor's Take -->
      <div class="p-4 bg-amber-50 rounded-xl border border-amber-200">
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-2">
            <span class="text-xl">ğŸ’°</span>
            <span class="font-bold text-amber-800">${this.funder.name}</span>
          </div>
          <span class="text-xs bg-amber-100 text-amber-800 px-2 py-1 rounded-full">
            Prefers: ${funderPick?.name?.split(' ').slice(0, 2).join(' ') || 'Your call'}
          </span>
        </div>
        <p class="text-sm text-amber-900">"${funderRec}"</p>
      </div>
      
      <!-- Summary of Options -->
      <div class="mt-4 p-4 bg-slate-50 rounded-xl border border-slate-200">
        <div class="text-xs font-bold text-slate-600 mb-2">QUICK COMPARISON</div>
        <div class="grid grid-cols-3 gap-2 text-center text-xs">
          ${milestones.map(m => {
            const voteCount = votes[m.id] || 0;
            const isTopPick = m.id === consensusMilestone?.id;
            return `
              <div class="p-2 rounded-lg ${isTopPick ? 'bg-violet-100 border border-violet-300' : 'bg-white border border-slate-200'}">
                <div class="font-bold ${isTopPick ? 'text-violet-700' : 'text-slate-700'}">${m.name.split(' ').slice(0, 2).join(' ')}</div>
                <div class="text-slate-500">${m.time}Q Â· Â£${m.reward.cash}k</div>
                <div class="mt-1 text-[10px] ${voteCount > 0 ? 'text-violet-600' : 'text-slate-400'}">
                  ${voteCount > 0 ? `${voteCount} vote${voteCount > 1 ? 's' : ''}` : 'No votes'}
                </div>
              </div>
            `;
          }).join('')}
        </div>
      </div>
    `;
    
    document.getElementById("advisorModal").classList.remove("hidden");
    document.getElementById("advisorModal").classList.add("flex");
  }
  
  closeAdvisorModal() {
    document.getElementById("advisorModal").classList.add("hidden");
    document.getElementById("advisorModal").classList.remove("flex");
  }
  
  chooseMilestone(milestoneId) {
    // Select the milestone
    const mg = document.getElementById("milestoneGrid");
    mg.querySelectorAll(".milestone-card").forEach(x => {
      x.classList.remove("selected", "border-amber-400");
      x.classList.add("border-slate-200");
    });
    const card = mg.querySelector(`[data-id="${milestoneId}"]`);
    if (card) {
      card.classList.add("selected", "border-amber-400");
      card.classList.remove("border-slate-200");
    }
    
    this.pendingMilestone = milestoneId;
    this.pendingMilestoneStage = this.completedMilestones.length === 0 ? "m1" : 
                                  this.completedMilestones.length === 1 ? "m2" : "m3";
    
    // Brief visual feedback then confirm
    setTimeout(() => {
      this.confirmMilestone();
    }, 200);
  }

  confirmMilestone() {
    const milestoneData = MILESTONES[this.company.id];
    const stageKey = this.pendingMilestoneStage;
    
    const milestones = milestoneData[stageKey];
    const m = milestones.find(x => x.id === this.pendingMilestone);
    
    if (!m) {
      console.error("Milestone not found:", this.pendingMilestone);
      return;
    }
    
    this.milestone = { ...m, deadline: this.turn + m.time };
    this.milestoneProgress = 0;
    
    // Set revenue projection difficulty based on milestone difficulty
    if (this.revenueModel && !this.projectionDifficulty) {
      this.projectionDifficulty = m.difficulty || 'balanced';
    }
    
    document.getElementById("milestoneModal").classList.add("hidden");
    
    const diffLabel = m.difficulty === "conservative" ? "ğŸ›¡" : m.difficulty === "balanced" ? "âš–" : "ğŸ”¥";
    this.log(`${diffLabel} Milestone: ${m.name} by Q${this.milestone.deadline}`);
    
    // Check if this is initial game setup or mid-game milestone selection
    if (this.turn === 1 && !this.gameStarted) {
      // Initial setup complete - start the game
      this.startGame();
    } else {
      // Mid-game milestone selection - continue to next quarter
      this.saveQuarterSummary(); // Save before advancing
      this.turn++;
      this.choices = {};
      this.randomizeStartingDomain();
      this.selectQuarterEvents();
      this.update();
      this.renderBoardroom();
    }
  }
  
  randomizeStartingDomain() {
    // Randomly select which department to start with each quarter
    const domains = this.team.hr ? ["research", "dev", "marketing", "hr"] : ["research", "dev", "marketing"];
    this.currentDomain = domains[Math.floor(Math.random() * domains.length)];
  }

  showHiringModal() {
    this.hiringStep = 0;
    this.renderHireColumn("researchHires", getExecutives("research"), "research", "emerald");
    this.renderHireColumn("devHires", getExecutives("dev"), "dev", "sky");
    this.renderHireColumn("mktHires", getExecutives("marketing"), "marketing", "fuchsia");
    
    // Initialize wizard state
    this.updateHiringWizard();
    
    document.getElementById("hiringModal").classList.remove("hidden");
    document.getElementById("hiringModal").classList.add("flex");
  }
  
  goToHiringStep(step) {
    // Only allow going to completed steps or current step
    const canGo = (step === 0) ||
                  (step === 1 && this.team.research) ||
                  (step === 2 && this.team.research && this.team.dev);
    if (!canGo) return;
    
    this.hiringStep = step;
    this.updateHiringWizard();
  }
  
  nextHiringStep() {
    const roles = ["research", "dev", "marketing"];
    const currentRole = roles[this.hiringStep];
    
    // Must have selection for current step
    if (!this.team[currentRole]) return;
    
    if (this.hiringStep < 2) {
      this.hiringStep++;
      soundManager.playPageTurn();
      this.updateHiringWizard();
    } else {
      // Hiring complete - close modal and choose milestone based on team
      document.getElementById("hiringModal").classList.add("hidden");
      document.getElementById("hiringModal").classList.remove("flex");
      this.showMilestoneModal();
    }
  }
  
  prevHiringStep() {
    if (this.hiringStep > 0) {
      this.hiringStep--;
      soundManager.playPageTurn();
      this.updateHiringWizard();
    }
  }
  
  updateHiringWizard() {
    const roles = ["research", "dev", "marketing"];
    const tabColors = [
      { active: "bg-emerald-100 text-emerald-800", inactive: "bg-slate-100 text-slate-400", done: "bg-emerald-100 text-emerald-800" },
      { active: "bg-sky-100 text-sky-800", inactive: "bg-slate-100 text-slate-400", done: "bg-sky-100 text-sky-800" },
      { active: "bg-fuchsia-100 text-fuchsia-800", inactive: "bg-slate-100 text-slate-400", done: "bg-fuchsia-100 text-fuchsia-800" }
    ];
    
    // Update pages - show/hide
    for (let i = 0; i < 3; i++) {
      const page = document.getElementById(`hiringPage${i}`);
      const tab = document.getElementById(`hiringTab${i}`);
      const checkMark = document.getElementById(`hiringCheck${i}`);
      
      const isCompleted = this.team[roles[i]] !== null;
      const isCurrent = i === this.hiringStep;
      const isAccessible = i === 0 || (i === 1 && this.team.research) || (i === 2 && this.team.research && this.team.dev);
      
      // Show/hide page
      if (isCurrent) {
        page.classList.remove("hidden");
      } else {
        page.classList.add("hidden");
      }
      
      // Style tab
      tab.className = `flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm ${
        isCurrent ? tabColors[i].active : 
        isCompleted ? tabColors[i].done : 
        tabColors[i].inactive
      }`;
      tab.disabled = !isAccessible;
      tab.style.cursor = isAccessible ? "pointer" : "not-allowed";
      
      // Show/hide checkmark
      checkMark.classList.toggle("hidden", !isCompleted);
    }
    
    // Update navigation buttons
    const prevBtn = document.getElementById("hiringPrevBtn");
    const nextBtn = document.getElementById("hiringNextBtn");
    
    if (this.hiringStep === 0) {
      prevBtn.classList.add("hidden");
    } else {
      prevBtn.classList.remove("hidden");
    }
    
    const currentRole = roles[this.hiringStep];
    const hasSelection = this.team[currentRole] !== null;
    
    nextBtn.disabled = !hasSelection;
    nextBtn.textContent = this.hiringStep === 2 
      ? (hasSelection ? "Starting..." : "Select to Continue") 
      : "Next â†’";
    
    // Update equity display
    this.updateHiringStatus();
  }

  renderHireColumn(containerId, execs, role, color) {
    const container = document.getElementById(containerId);
    
    container.innerHTML = execs.map(e => `
      <div data-id="${e.id}" data-role="${role}" class="hire-card border-2 border-slate-200 rounded-xl bg-white hover:border-${color}-400 hover:shadow-lg transition-all flex flex-col overflow-hidden">
        <!-- Photo + Name Header -->
        <div class="p-4 pb-3">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-14 h-14 rounded-full border-2 border-${color}-300 overflow-hidden flex-shrink-0">
              ${renderAvatar(e.avatar, e.name)}
            </div>
            <div class="flex-1 min-w-0">
              <div class="font-bold text-slate-800">${e.name}</div>
              <div class="text-xs text-${color}-600 font-medium">${e.title}</div>
              <div class="text-[10px] text-slate-400">${e.origin}</div>
            </div>
          </div>
          
          <!-- Background - full text -->
          <p class="text-xs text-slate-600 mb-3">${e.background}</p>
          
          <!-- Personality traits -->
          <div class="flex flex-wrap gap-1">
            ${e.personality.split(", ").map(t => `<span class="px-2 py-0.5 rounded-full bg-slate-100 text-slate-600 text-[10px]">${t}</span>`).join("")}
          </div>
        </div>
        
        <!-- Spacer -->
        <div class="flex-1"></div>
        
        <!-- Compensation box -->
        <div class="px-4 pb-3">
          <div class="bg-gradient-to-r from-slate-50 to-${color}-50 rounded-lg p-3 space-y-2">
            <!-- Salary line -->
            <div class="flex justify-between items-center">
              <span class="text-xs text-slate-500">ğŸ’° Salary</span>
              <div class="text-right">
                <span class="font-bold text-slate-700">Â£${e.wage}k</span>
                <span class="text-slate-400 text-xs">/quarter</span>
              </div>
            </div>
            <!-- Equity line -->
            <div class="flex justify-between items-center">
              <span class="text-xs text-slate-500">ğŸ“Š Equity</span>
              <div class="text-right">
                <span class="font-bold text-amber-600">${e.equity}%</span>
                <span class="text-slate-400 text-xs block">(${e.vestingYears}yr vest, ${e.cliff}yr cliff)</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Action buttons -->
        <div class="border-t border-slate-100 p-3 flex gap-2 bg-slate-50">
          <button onclick="event.stopPropagation(); game.showExecCV('${e.id}', '${role}')" class="flex-1 px-3 py-2 bg-white border border-slate-200 hover:border-${color}-300 hover:bg-${color}-50 text-slate-600 text-xs font-medium rounded-lg transition-colors">
            View CV
          </button>
          <button onclick="event.stopPropagation(); game.hireExec('${e.id}', '${role}')" class="flex-1 px-3 py-2 bg-${color}-500 hover:bg-${color}-600 text-white text-xs font-bold rounded-lg transition-colors">
            Hire
          </button>
        </div>
      </div>
    `).join("");

    // Card click also selects
    container.querySelectorAll(".hire-card").forEach(card => {
      card.onclick = (e) => {
        // Only if clicking the card itself, not buttons
        if (e.target.tagName === 'BUTTON') return;
        this.selectExec(card.dataset.id, role);
      };
    });
  }
  
  selectExec(execId, role) {
    const container = document.getElementById(role === "research" ? "researchHires" : role === "dev" ? "devHires" : "mktHires");
    const execs = role === "research" ? getExecutives("research") : role === "dev" ? getExecutives("dev") : getExecutives("marketing");
    
    container.querySelectorAll(".hire-card").forEach(c => c.classList.remove("selected"));
    const card = container.querySelector(`[data-id="${execId}"]`);
    if (card) card.classList.add("selected");
    
    this.team[role] = execs.find(e => e.id === execId);
    soundManager.playHireSelect(role);
    this.updateHiringWizard();
    
    // Auto-advance on final step (marketing) after brief delay
    if (this.hiringStep === 2) {
      setTimeout(() => {
        this.nextHiringStep();
      }, 600);
    }
  }
  
  hireExec(execId, role) {
    // Select the exec
    this.selectExec(execId, role);
    
    // Auto-advance to next step after brief visual feedback
    setTimeout(() => {
      this.nextHiringStep();
    }, 300);
  }
  
  showExecCV(execId, role) {
    const execs = role === "research" ? getExecutives("research") : 
                  role === "dev" ? getExecutives("dev") : 
                  role === "marketing" ? getExecutives("marketing") :
                  HR_EXECS;
    const exec = Array.isArray(execs) ? execs.find(e => e.id === execId) : null;
    if (!exec) return;
    
    this.viewingExecId = execId;
    this.viewingExecRole = role;
    
    // Populate modal
    document.getElementById("execCVAvatar").innerHTML = renderAvatar(exec.avatar, exec.name);
    document.getElementById("execCVName").textContent = exec.name;
    document.getElementById("execCVTitle").textContent = exec.title;
    document.getElementById("execCVOrigin").textContent = exec.origin;
    document.getElementById("execCVQuote").textContent = `"${exec.quote}"`;
    
    // CV details
    if (exec.cv) {
      document.getElementById("execCVEducation").textContent = exec.cv.education;
      document.getElementById("execCVExperience").innerHTML = exec.cv.experience.map(exp => `<li>â€¢ ${exp}</li>`).join("");
      document.getElementById("execCVStrengths").innerHTML = exec.cv.strengths.map(s => `<li>â€¢ ${s}</li>`).join("");
      document.getElementById("execCVWeaknesses").innerHTML = exec.cv.weaknesses.map(w => `<li>â€¢ ${w}</li>`).join("");
    }
    
    // Compensation
    const salaryMod = this.location ? (1 + this.location.salaryMod) : 1;
    const adjustedWage = Math.round(exec.wage * salaryMod);
    document.getElementById("execCVSalary").textContent = `Â£${adjustedWage}k`;
    document.getElementById("execCVEquity").textContent = `${exec.equity}%`;
    document.getElementById("execCVVesting").textContent = `${exec.vestingYears}yr (${exec.cliff}yr cliff)`;
    
    // Show modal
    document.getElementById("execCVModal").classList.remove("hidden");
    document.getElementById("execCVModal").classList.add("flex");
  }
  
  hideExecCV() {
    document.getElementById("execCVModal").classList.add("hidden");
    document.getElementById("execCVModal").classList.remove("flex");
    this.viewingExecId = null;
    this.viewingExecRole = null;
  }
  
  hireFromCV() {
    if (this.viewingExecId && this.viewingExecRole) {
      this.hideExecCV();
      if (this.viewingExecRole === "hr") {
        // Mid-game HR hire
        const exec = HR_EXECS.find(e => e.id === this.viewingExecId);
        if (exec) {
          // Check if this hire would result in negative equity
          const resultingEquity = this.metrics.equity - exec.equity;
          if (resultingEquity < 0) {
            this.showExecEquityWarning(exec);
            return;
          }
          
          this.team.hr = exec;
          this.moods.hr = 1;
          const salaryMod = this.location ? (1 + this.location.salaryMod) : 1;
          const adjustedWage = Math.round(exec.wage * salaryMod);
          this.metrics.burn += adjustedWage;
          this.metrics.equity -= exec.equity;
          Object.entries(exec.bonus).forEach(([k, v]) => { if (this.metrics[k] !== undefined) this.metrics[k] += v; });
          this.maxAP = 7;
          this.log(`ğŸ“ˆ With a HR lead on board, you can now manage up to ${this.maxAP} AP per quarter.`);
          this.equityGrants.push({ name: exec.name, role: "People", equity: exec.equity, vestingYears: exec.vestingYears, cliff: exec.cliff, grantedQuarter: this.turn });
          this.log(`ğŸ¤ ${exec.name} joins as your Head of People! ${exec.equity}% equity, Â£${adjustedWage}k/quarter.`);
          soundManager.playHireSelect('hr');
          document.getElementById("hrModal").classList.add("hidden");
          this.updateUI();
        }
      } else {
        this.selectExec(this.viewingExecId, this.viewingExecRole);
      }
    }
  }

  updateHiringStatus() {
    const selected = [this.team.research, this.team.dev, this.team.marketing].filter(Boolean);
    const totalEquity = selected.reduce((sum, e) => sum + e.equity, 0);
    
    document.getElementById("equityCommitted").textContent = totalEquity > 0 ? 
      `Total equity: ${totalEquity.toFixed(1)}%` : "";
  }

  startGame() {
    this.gameStarted = true;
    document.getElementById("hiringModal").classList.add("hidden");
    
    // Track game start with Google Analytics
    if (typeof trackGameEvent === 'function') {
      trackGameEvent('game_started', {
        startup_name: this.startupName,
        location: this.location ? this.location.name : 'unknown',
        funder_type: this.funder ? this.funder.type : 'unknown'
      });
    }
    
    // Play setup complete sound
    soundManager.playSetupComplete();
    
    // Track equity grants
    this.equityGrants = [];
    
    // Apply location bonuses to starting metrics
    if (this.location) {
      Object.entries(this.location.bonuses).forEach(([k, v]) => {
        if (this.metrics[k] !== undefined) this.metrics[k] += v;
      });
      this.log(`ğŸ“ Based in ${this.location.name}. Your local ecosystem will shape your journey.`);
    }
    
    // Apply founder profile bonuses
    if (this.founder && this.founder.profile) {
      const stats = this.founder.profile.stats;
      
      // Display founder in header
      const founderPortrait = document.getElementById("founderPortraitHeader");
      if (founderPortrait && this.founder.portrait) {
        founderPortrait.innerHTML = this.founder.portrait;
        founderPortrait.classList.remove("hidden");
      }
      const founderNameEl = document.getElementById("founderNameHeader");
      if (founderNameEl) {
        founderNameEl.textContent = `${this.founder.profile.icon} ${this.founder.name}`;
        founderNameEl.classList.remove("hidden");
      }
      
      // Technical â†’ Science bonus (+2 per point above 2)
      if (stats.technical > 2) {
        const sciBonus = (stats.technical - 2) * 2;
        this.metrics.sci += sciBonus;
      }
      
      // Commercial â†’ Sales bonus (+2 per point above 2)
      if (stats.commercial > 2) {
        const mktBonus = (stats.commercial - 2) * 2;
        this.metrics.mkt += mktBonus;
      }
      
      // Operational â†’ Burn rate reduction (Â£5k per point above 2) and HR bonus
      if (stats.operational > 2) {
        const burnReduction = (stats.operational - 2) * 5;
        this.metrics.burn = Math.max(0, this.metrics.burn - burnReduction);
        this.metrics.hr += (stats.operational - 2) * 2;
      }
      
      // Leadership â†’ Starting mood bonus for all execs
      if (stats.leadership > 2) {
        const moodBonus = (stats.leadership - 2) * 0.5;
        Object.keys(this.moods).forEach(d => {
          this.moods[d] = Math.min(3, this.moods[d] + moodBonus);
        });
      }
      
      // Store founder bonuses for later use (adaptability, financial, operational, leadership)
      this.founderBonuses = {
        adaptability: stats.adaptability || 2,
        financial: stats.financial || 2,
        technical: stats.technical || 2,
        commercial: stats.commercial || 2,
        operational: stats.operational || 2,
        leadership: stats.leadership || 2
      };
      
      this.log(`${this.founder.profile.icon} ${this.founder.name} (${this.founder.profile.name}) takes the helm.`);
    }
    
    // Apply exec bonuses, wages (adjusted by location), and equity
    const salaryMod = this.location ? (1 + this.location.salaryMod) : 1;
    ["research", "dev", "marketing"].forEach(role => {
      const exec = this.team[role];
      if (exec) {
        Object.entries(exec.bonus).forEach(([k, v]) => {
          if (this.metrics[k] !== undefined) this.metrics[k] += v;
        });
        // Apply location salary modifier
        const adjustedWage = Math.round(exec.wage * salaryMod);
        this.metrics.burn += adjustedWage;
        // No longer adding AP per exec - resources are scarce
        
        // Track equity grant
        this.equityGrants.push({
          name: exec.name,
          equity: exec.equity,
          vestingYears: exec.vestingYears,
          cliff: exec.cliff,
          grantQuarter: this.turn,
          vestedPercent: 0
        });
        
        // Reduce founder equity
        this.metrics.equity -= exec.equity;
      }
    });

    this.log(`Leadership team hired. ${this.equityGrants.reduce((s, g) => s + g.equity, 0).toFixed(1)}% equity granted.`);
    
    // Log journey event for game start
    this.logJourneyEvent('gameStart', {
      company: this.company?.name,
      companyType: this.company?.id,
      location: this.location?.name,
      founder: this.founder ? {
        name: this.founder.name,
        profile: this.founder.profile?.name,
        icon: this.founder.profile?.icon
      } : null,
      fundingStage: this.fundingStage,
      funder: this.funder?.name,
      team: {
        research: this.team.research?.name,
        dev: this.team.dev?.name,
        marketing: this.team.marketing?.name
      }
    });
    
    this.selectQuarterEvents();
    this.update();
    this.renderBoardroom();
    
    // Show situation brief at the start of Q1
    this.showSituationBrief();
  }

  // Calculate how "positive" an event is based on its choices' effects
  getEventPositivity(event) {
    if (!event?.choices) return 0;
    let score = 0;
    event.choices.forEach(c => {
      if (c.eff) {
        // Sum all effect values (positive effects add, negative subtract)
        Object.entries(c.eff).forEach(([key, val]) => {
          // Weight core metrics more heavily
          const weight = ['sci', 'dev', 'mkt', 'hr'].includes(key) ? 1.5 : 1;
          score += val * weight;
        });
      }
      // Also consider mood effects on the event
      if (c.mood) score += c.mood * 2;
    });
    return score;
  }
  
  // Select event with mood-based weighting
  // Low mood = more likely to get "worse" events (lower positivity scores)
  // High mood = slightly more likely to get "better" events
  selectEventWithMoodBias(available, mood, pool) {
    if (available.length <= 1) {
      return { event: available[0], poolIdx: pool.indexOf(available[0]) };
    }
    
    // Score each event by positivity
    const scored = available.map(e => ({ 
      event: e, 
      score: this.getEventPositivity(e),
      poolIdx: pool.indexOf(e)
    }));
    
    // Sort by score: highest (most positive) first
    scored.sort((a, b) => b.score - a.score);
    
    const n = scored.length;
    
    // Calculate weights based on mood
    // Position 0 = most positive event, position n-1 = most negative event
    const weights = scored.map((e, i) => {
      const positionRatio = n > 1 ? i / (n - 1) : 0.5; // 0 = best, 1 = worst
      
      // Base weight is 1 (equal probability)
      let weight = 1;
      
      if (mood <= -2) {
        // Very unhappy: strongly prefer negative events (2x more likely for worst)
        weight = 0.5 + positionRatio * 1.5; // 0.5 to 2.0
      } else if (mood === -1) {
        // Unhappy: moderately prefer negative events
        weight = 0.7 + positionRatio * 0.6; // 0.7 to 1.3
      } else if (mood >= 2) {
        // Very happy: slightly prefer positive events
        weight = 1.15 - positionRatio * 0.25; // 1.15 to 0.9
      } else if (mood === 1) {
        // Happy: very slightly prefer positive events
        weight = 1.08 - positionRatio * 0.15; // 1.08 to 0.93
      }
      // mood 0 or 3+: weight stays 1 (neutral)
      
      return weight;
    });
    
    // Weighted random selection
    const totalWeight = weights.reduce((a, b) => a + b, 0);
    let r = Math.random() * totalWeight;
    
    for (let i = 0; i < weights.length; i++) {
      r -= weights[i];
      if (r <= 0) {
        return { event: scored[i].event, poolIdx: scored[i].poolIdx };
      }
    }
    
    // Fallback to last event
    const last = scored[scored.length - 1];
    return { event: last.event, poolIdx: last.poolIdx };
  }

  selectQuarterEvents() {
    // Select a random event for each exec from their pool OR generic pool
    this.currentEvents = {};
    const domains = this.team.hr ? ["research", "dev", "marketing", "hr"] : ["research", "dev", "marketing"];
    
    domains.forEach(domain => {
      const exec = this.team[domain];
      if (!exec) return;
      
      // 20% chance for competitive event (if rivals exist), 15% for generic, rest character-specific
      const roll = Math.random();
      const hasRivals = this.rivals.filter(r => r.status === "active").length > 0;
      const useCompetitive = hasRivals && roll < 0.20 && COMPETITIVE_EVENTS[domain]?.length > 0;
      const useGeneric = !useCompetitive && roll < 0.35;
      
      let pool, poolType;
      if (useCompetitive) {
        pool = COMPETITIVE_EVENTS[domain] || [];
        poolType = 'competitive';
      } else if (useGeneric) {
        // Combine domain-specific generic events with universal ones
        const domainGeneric = GENERIC_EVENTS[domain] || [];
        const allGeneric = GENERIC_EVENTS.all || [];
        pool = [...domainGeneric, ...allGeneric];
        poolType = 'generic';
      } else {
        pool = CHAR_EVENTS[domain]?.[exec.id];
        poolType = 'char';
      }
      
      if (!pool || pool.length === 0) {
        // Fallback to character events if pool is empty
        pool = CHAR_EVENTS[domain]?.[exec.id];
        poolType = 'char';
      }
      if (!pool || pool.length === 0) return;
      
      // Find unused events, or reset if all used
      const eventKey = poolType === 'competitive' ? `competitive-${domain}` : poolType === 'generic' ? `generic-${domain}` : exec.id;
      let available = pool.filter((e, i) => !this.usedEvents.has(`${eventKey}-${i}`));
      if (available.length === 0) {
        // Reset used events for this pool
        pool.forEach((e, i) => this.usedEvents.delete(`${eventKey}-${i}`));
        available = pool;
      }
      
      // Pick event with mood-based weighting
      // Low mood = more likely to get negative events
      // High mood = slightly more likely to get positive events
      const mood = this.moods[domain] || 0;
      const selection = this.selectEventWithMoodBias(available, mood, pool);
      const eventIdx = selection.poolIdx;
      
      // For competitive events, inject rival name
      let selectedEvent = selection.event;
      if (poolType === 'competitive' && this.rivals.length > 0) {
        const activeRivals = this.rivals.filter(r => r.status === "active");
        if (activeRivals.length > 0) {
          const rival = activeRivals[Math.floor(Math.random() * activeRivals.length)];
          selectedEvent = this.injectRivalIntoEvent(selectedEvent, rival);
        }
      }
      
      this.currentEvents[domain] = { event: selectedEvent, idx: eventIdx, poolType };
      this.usedEvents.add(`${eventKey}-${eventIdx}`);
    });
    
    // Check for revenue event (can replace marketing event)
    if (this.revenueModel) {
      const revenueEvent = this.selectRevenueEvent('marketing');
      if (revenueEvent) {
        this.currentEvents.marketing = { 
          event: revenueEvent, 
          idx: 0, 
          poolType: 'revenue' 
        };
      }
    }
    
    // Generate funder advice for this quarter
    this.generateFunderAdvice();
  }
  
  injectRivalIntoEvent(event, rival) {
    // Create a deep copy and replace {rival} placeholders
    const injected = JSON.parse(JSON.stringify(event));
    injected.intro = injected.intro.replace(/\{rival\}/g, rival.name);
    injected.aside = injected.aside.replace(/\{rival\}/g, rival.name);
    injected.rivalRef = rival; // Store reference for applying effects
    
    injected.choices = injected.choices.map(c => ({
      ...c,
      text: c.text.replace(/\{rival\}/g, rival.name),
      reaction: c.reaction.replace(/\{rival\}/g, rival.name)
    }));
    
    return injected;
  }
  
  generateFunderAdvice() {
    // Redirect to multi-funder version
    this.generateAllFunderAdvice();
  }
  
  generateAllFunderAdvice() {
    this.funderAdvices = [];
    
    // No advice if bootstrapped or no investors
    if (this.investors.length === 0) {
      return;
    }
    
    const domains = this.team.hr ? ["research", "dev", "marketing", "hr"] : ["research", "dev", "marketing"];
    const domainsWithEvents = domains.filter(d => this.currentEvents[d]?.event);
    
    if (domainsWithEvents.length === 0) return;
    
    // Track which domains and choices have been claimed to force disagreement
    const claimedChoices = {}; // { domain: [choiceIndices] }
    
    // Generate advice for each investor
    this.investors.forEach((investor, investorIdx) => {
      const funderId = investor.funderId;
      const adviceData = FUNDER_ADVICE[funderId];
      if (!adviceData) return;
      
      // Pick domain - try to pick different domains for different investors
      let targetDomain;
      const preferredDomains = adviceData.preferredDomains.filter(d => domainsWithEvents.includes(d));
      
      // First investor gets their preferred, subsequent investors try to pick different domains
      if (investorIdx === 0) {
        targetDomain = preferredDomains[Math.floor(Math.random() * preferredDomains.length)] || domainsWithEvents[0];
      } else {
        // Try to pick a domain not heavily claimed yet, or same domain with different choice
        const unclaimedDomains = domainsWithEvents.filter(d => !claimedChoices[d] || claimedChoices[d].length < 2);
        const preferredUnclaimed = preferredDomains.filter(d => unclaimedDomains.includes(d));
        
        if (preferredUnclaimed.length > 0) {
          targetDomain = preferredUnclaimed[Math.floor(Math.random() * preferredUnclaimed.length)];
        } else if (unclaimedDomains.length > 0) {
          targetDomain = unclaimedDomains[Math.floor(Math.random() * unclaimedDomains.length)];
        } else {
          // All domains claimed - pick one to disagree on
          targetDomain = preferredDomains[Math.floor(Math.random() * preferredDomains.length)] || domainsWithEvents[0];
        }
      }
      
      if (!targetDomain || !this.currentEvents[targetDomain]?.event) return;
      
      const event = this.currentEvents[targetDomain].event;
      const choices = event.choices;
      
      // Pick choice based on personality
      let recommendedChoice = this.pickFunderChoice(adviceData, choices, targetDomain, funderId);
      
      // Force disagreement: if another investor already picked this choice for this domain, pick differently
      if (claimedChoices[targetDomain]?.includes(recommendedChoice)) {
        const otherChoices = [0, 1, 2].filter(i => 
          i !== recommendedChoice && 
          i < choices.length && 
          !claimedChoices[targetDomain]?.includes(i)
        );
        if (otherChoices.length > 0) {
          recommendedChoice = otherChoices[Math.floor(Math.random() * otherChoices.length)];
        }
      }
      
      // 20% chance to give suboptimal advice
      if (Math.random() < 0.2) {
        const otherChoices = [0, 1, 2].filter(i => i !== recommendedChoice && i < choices.length);
        if (otherChoices.length > 0) {
          recommendedChoice = otherChoices[Math.floor(Math.random() * otherChoices.length)];
        }
      }
      
      recommendedChoice = Math.min(recommendedChoice, choices.length - 1);
      
      // Track this claim
      if (!claimedChoices[targetDomain]) claimedChoices[targetDomain] = [];
      claimedChoices[targetDomain].push(recommendedChoice);
      
      const chosenOption = choices[recommendedChoice];
      const adviceText = this.generateContextualAdvice(adviceData, chosenOption, targetDomain, funderId);
      
      this.funderAdvices.push({
        investor: investor,
        funder: investor.funder,
        funderId: funderId,
        domain: targetDomain,
        recommendedChoice: recommendedChoice,
        choiceText: chosenOption.text,
        text: adviceText.text,
        reason: adviceText.reason,
        funderName: investor.funder.name, // Use actual investor name, not hardcoded FUNDER_ADVICE name
        followedReaction: adviceData.followedReaction,
        ignoredReaction: adviceData.ignoredReaction
      });
    });
    
    // For backwards compatibility, set funderAdvice to first advice
    this.funderAdvice = this.funderAdvices[0] || null;
  }
  
  pickFunderChoice(adviceData, choices, domain, funderId = null) {
    // Each funder type has different criteria for picking choices
    const fId = funderId || (this.funder ? this.funder.id : 'techAngel');
    
    // Score each choice based on funder personality
    const scores = choices.map((c, i) => {
      let score = 0;
      const effects = c.eff || {};
      
      switch(fId) {
        case 'dragon': // Victoria: Wants visibility, sales, big moves
          score += (effects.mkt || 0) * 3;
          score += c.ap >= 3 ? 2 : 0; // Likes expensive/bold options
          score += c.cost >= 20 ? 1 : 0;
          break;
          
        case 'techAngel': // James: Wants tech quality, research
          score += (effects.sci || 0) * 3;
          score += (effects.dev || 0) * 2;
          score += c.ap === 2 ? 2 : 0; // Prefers balanced options
          break;
          
        case 'operatorAngel': // Sarah: Wants team health, sustainability
          score += (effects.hr || 0) * 3;
          score += c.ap <= 2 ? 2 : 0; // Prefers efficient options
          score += c.cost <= 15 ? 1 : 0;
          break;
          
        case 'academicAngel': // Molly: Wants research rigour, scientific credibility
          score += (effects.sci || 0) * 4;
          score += (effects.dev || 0) * 1;
          score += c.ap === 2 ? 2 : 0; // Prefers methodical options
          score += domain === 'research' ? 3 : 0;
          break;
          
        case 'sectorVC': // Meridian: Wants sector-specific wins
          score += (effects.sci || 0) * 2;
          score += (effects.mkt || 0) * 2;
          score += domain === 'research' ? 2 : 0;
          break;
          
        case 'tier1VC': // Polaris: Wants aggressive growth
          score += (effects.mkt || 0) * 3;
          score += c.ap >= 4 ? 3 : c.ap >= 3 ? 2 : 0;
          score += c.cost >= 25 ? 1 : 0; // Money is no object
          break;
          
        case 'corporateVC': // Lexis: Wants product quality, strategic fit
          score += (effects.dev || 0) * 3;
          score += (effects.sci || 0) * 2;
          score += c.ap === 2 || c.ap === 3 ? 2 : 0; // Middle ground
          break;
          
        default:
          score += c.ap === 2 ? 1 : 0; // Default to middle option
      }
      
      return { index: i, score };
    });
    
    // Sort by score and pick the best
    scores.sort((a, b) => b.score - a.score);
    return scores[0].index;
  }
  
  generateContextualAdvice(adviceData, choice, domain, funderId = null) {
    const fId = funderId || (this.funder ? this.funder.id : 'techAngel');
    const choiceText = choice.text.toLowerCase();
    const effects = choice.eff || {};
    const ap = choice.ap;
    const milestoneStage = this.completedMilestones?.length || 0; // 0=M1, 1=M2, 2=M3
    
    // Generate substantive advice based on funder personality, choice characteristics, and milestone stage
    const templates = {
      dragon: {
        m1: {
          high_ap: [
            `This is the kind of bold move that gets attention early. At this stage, you need to stand out from the crowd of wannabe startups. Investors remember who swung for the fences.`,
            `First milestone is about proving you're serious. This investment shows you're not playing at being a founder-you're building something real.`,
            `I've backed dozens of founders. The ones who make it go big early when it matters. This is one of those moments.`
          ],
          low_ap: [
            `Smart resource management in the early days. You need to survive long enough to prove the concept. Just don't be timid forever.`,
            `Acceptable for M1. Save your powder for when you've got proof points. Then we can talk about scaling up.`,
            `Early stage is about learning fast and cheap. This approach makes sense-for now.`
          ]
        },
        m2: {
          high_ap: [
            `Second milestone is about momentum. You've proven the concept-now prove you can scale. This shows you're ready to accelerate.`,
            `M2 is where real companies separate from science projects. This investment shows you're building for growth, not just validation.`,
            `Now we're talking. You've got your first win. Time to press the advantage before competitors catch up.`
          ],
          low_ap: [
            `M2 is when you should be ramping up, not playing conservatively. What's holding you back?`,
            `I expected more aggression at this stage. You've proven the model-now push harder.`,
            `This is fine, but remember-M2 is about building momentum. Don't lose your edge.`
          ]
        },
        m3: {
          high_ap: [
            `Final stretch. This is where legends are made or forgotten. Go all in-you've earned the right to bet big.`,
            `M3 is about establishing category leadership. This investment positions you to dominate, not just compete.`,
            `You've come too far to play small now. This is the move that defines your exit story.`
          ],
          low_ap: [
            `Careful now doesn't win championships. M3 is about finishing strong, not coasting to the line.`,
            `I'm surprised you're being conservative this late. What happened to the hunger that got you here?`,
            `Defensible, but I want to see fire in the final push. Don't leave anything on the table.`
          ]
        }
      },
      techAngel: {
        m1: {
          high_ap: [
            `Getting the technical foundation right from day one is critical. This investment prevents the "rebuild from scratch" moment I've seen kill too many startups.`,
            `Early stage is when you establish your technical DNA. Cut corners now and you'll pay 10x later. This is the right call.`,
            `M1 is about building something that actually works. This investment in proper engineering will save you in the long run.`
          ],
          low_ap: [
            `Lean approach for early stage makes sense technically. Build the MVP, get feedback, then invest in scaling. Smart sequencing.`,
            `This is the pragmatic engineering choice. You're not over-building before you've validated demand.`,
            `Good technical judgment. Ship something small that works rather than something big that doesn't.`
          ]
        },
        m2: {
          high_ap: [
            `M2 is where technical debt starts to bite. This investment in proper architecture now prevents the "everything is on fire" quarter I've seen too often.`,
            `You've proven the concept. Now you need to build for scale. This investment is exactly what the technical foundation needs.`,
            `Second milestone separates MVPs from real products. This engineering investment shows you're ready to build something lasting.`
          ],
          low_ap: [
            `Reasonable for M2, but keep an eye on technical debt. It compounds faster than you think.`,
            `This works if you're strategic about where you cut corners. Just make sure the core is solid.`,
            `Acceptable scope control. Just don't let velocity become an excuse for accumulating debt.`
          ]
        },
        m3: {
          high_ap: [
            `Final milestone is about technical excellence. Buyers and acquirers will do deep due diligence. This investment shows a mature technical organization.`,
            `M3 is where architecture choices really matter. You're building for acquisition valuations now, not just functionality.`,
            `This is the level of technical investment that makes the difference between a good outcome and a great one.`
          ],
          low_ap: [
            `Late-stage cost optimization is fine, but don't neglect the platform. Technical due diligence will scrutinize everything.`,
            `Make sure you're not accumulating hidden debt at the worst time. Acquirers notice.`,
            `This approach works if your technical foundation is already solid. Is it?`
          ]
        }
      },
      operatorAngel: {
        m1: {
          high_ap: [
            `Early stage is chaotic by nature, but investing in team and process now prevents the "everything breaks at 10 people" moment. Smart founders build culture early.`,
            `M1 is when habits form. This investment in doing things right now will compound as you grow.`,
            `I've seen too many startups implode because they didn't invest in their people early. This is the right priority.`
          ],
          low_ap: [
            `Lean operations for M1 makes sense. You're still figuring out what works. Stay agile, iterate quickly.`,
            `This is appropriate scope for early stage. Don't over-process before you have product-market fit.`,
            `Good resource management. Keep the team focused and lean until you have clear direction.`
          ]
        },
        m2: {
          high_ap: [
            `M2 is when teams either scale or implode. This investment in people and process prevents the chaos I've seen destroy promising companies.`,
            `Second milestone is about building an organization, not just a product. This shows you understand what scaling really means.`,
            `You're at the point where individual heroics stop working. This investment in team capability is exactly right.`
          ],
          low_ap: [
            `Watch for burnout at M2. Teams that stretched to hit the first milestone need recovery time and support.`,
            `This approach can work if your team is resilient, but don't mistake quiet suffering for comfort.`,
            `Be careful not to under-invest in people at the scaling stage. It's the most common mistake I see.`
          ]
        },
        m3: {
          high_ap: [
            `Final stretch is when teams are tested most. This investment shows you're taking care of your people when it matters most.`,
            `M3 success depends on an organization that can execute under pressure. This builds that capability.`,
            `You're preparing for the endgame. This investment in team and operations positions you to close strong.`
          ],
          low_ap: [
            `Your team has carried you this far. Make sure they can carry you across the finish line.`,
            `Efficiency is good, but don't burn out your team in the final push. You need them at their best.`,
            `Acceptable if morale is high. If people are exhausted, this approach will backfire.`
          ]
        }
      },
      academicAngel: {
        m1: {
          high_ap: [
            `First milestone should establish scientific credibility. This investment in rigorous methodology will pay dividends in every conversation with serious partners.`,
            `M1 is about proving your science is real. Cutting corners here undermines everything that follows.`,
            `I invested because I believe in the research. This commitment shows you share that belief.`
          ],
          low_ap: [
            `Focused research spending for M1 is sensible. Prove the core hypothesis before expanding scope.`,
            `This measured approach to early-stage science is appropriate. Build evidence incrementally.`,
            `Good scientific prioritization. Not every question needs answering before you can make progress.`
          ]
        },
        m2: {
          high_ap: [
            `M2 is when you build on your scientific foundation. This investment expands your research moat in the right way.`,
            `Second milestone should deepen your scientific advantage. This shows proper commitment to research excellence.`,
            `You've established credibility. Now this investment builds the depth that makes you defensible.`
          ],
          low_ap: [
            `Be careful not to let commercial pressure erode your scientific standards at M2.`,
            `This approach can work, but make sure you're not accumulating research debt alongside product debt.`,
            `Reasonable, but keep investing in the science that differentiates you. It's your moat.`
          ]
        },
        m3: {
          high_ap: [
            `Final milestone is about scientific leadership. This investment positions you as the definitive company in your space.`,
            `M3 should cement your research reputation. Acquirers and partners pay premium for scientific excellence.`,
            `This is the investment that makes your exit story compelling. Science that matters, scaled properly.`
          ],
          low_ap: [
            `Don't neglect the research at the end. Due diligence will examine your scientific foundations closely.`,
            `Make sure your research credibility survives the commercial push of M3.`,
            `This works if your scientific reputation is already established. Just don't let it erode.`
          ]
        }
      },
      sectorVC: {
        m1: {
          high_ap: [
            `First milestone is about sector credibility. This investment shows you understand what it takes to win in this market.`,
            `M1 in healthcare/biotech requires serious commitment. This shows you're not naive about the sector.`,
            `I've seen too many first-time founders underestimate this sector. This investment shows you get it.`
          ],
          low_ap: [
            `Lean approach for M1 in this sector can work, but don't cut corners on compliance or credibility.`,
            `This measured approach is fine for early stage. Just make sure you're building toward sector requirements.`,
            `Acceptable for M1, but remember-this sector has higher bars than most. Start building toward them.`
          ]
        },
        m2: {
          high_ap: [
            `M2 is when sector expertise really matters. This investment positions you for the enterprise conversations ahead.`,
            `Second milestone should establish you as a serious player. This shows the sector commitment that opens doors.`,
            `You're past proof of concept. This investment builds the sector-specific capabilities that win big deals.`
          ],
          low_ap: [
            `Efficiency is good, but don't underinvest in sector-specific requirements. They're non-negotiable.`,
            `This can work if you're strategic, but remember-half-measures don't fly in regulated industries.`,
            `Be careful not to fall behind on sector expectations. They're higher than in other markets.`
          ]
        },
        m3: {
          high_ap: [
            `Final milestone should establish sector leadership. This investment positions you for the partnerships and exits that matter.`,
            `M3 is about winning in the sector. This shows you're ready for the big leagues.`,
            `This investment builds toward the strategic relationships that define success in this market.`
          ],
          low_ap: [
            `M3 in this sector requires serious capability. Make sure you're not underinvesting in what matters.`,
            `Efficiency is fine, but sector expectations are high. Don't fall short at the finish line.`,
            `This approach can work if you've already built strong sector foundations. Have you?`
          ]
        }
      },
      tier1VC: {
        m1: {
          high_ap: [
            `This is the aggression I invested in. M1 is about proving you can move fast and think big simultaneously.`,
            `First milestone at pace shows you understand what it takes. We don't invest in founders who play small.`,
            `Exactly right. Establish the growth mindset from day one. Your competitors are being timid.`
          ],
          low_ap: [
            `M1 is when you should be proving velocity, not demonstrating caution. What happened to the ambition in your pitch?`,
            `This is fine for survival, but we invested in growth. Show me the ambition next quarter.`,
            `Acceptable for early stage, but remember-we expect you to scale aggression as you scale the company.`
          ]
        },
        m2: {
          high_ap: [
            `M2 is where companies become category leaders or also-rans. This investment shows you're playing to win.`,
            `Second milestone should show acceleration, not cruise control. This is the right level of aggression.`,
            `Now you're thinking like a future category leader. This is exactly the M2 energy we need.`
          ],
          low_ap: [
            `M2 is when you should be pressing the advantage. Why are you playing defensively?`,
            `I expected more aggression at this stage. You've proven the model-now push harder.`,
            `This is concerning for M2. Your competitors are raising and spending. Are you keeping up?`
          ]
        },
        m3: {
          high_ap: [
            `Final stretch is about domination. This investment positions you to own the category, not just participate.`,
            `M3 is where we see who the real winners are. This shows you're ready to close strong.`,
            `This is category-defining investment. You're building for the outcome we both want.`
          ],
          low_ap: [
            `Playing it safe in M3 doesn't win championships. You didn't come this far to finish second.`,
            `I'm surprised you're being conservative this late. Where's the killer instinct?`,
            `This approach might work for a lifestyle business. We invested in a category leader.`
          ]
        }
      },
      corporateVC: {
        m1: {
          high_ap: [
            `First milestone is about building capabilities that matter to enterprise. This investment shows you understand what we value.`,
            `M1 should establish quality standards. This shows the kind of commitment we look for in strategic partners.`,
            `Early investment in proper foundations resonates with how we think. Good alignment.`
          ],
          low_ap: [
            `Lean approach for M1 is sensible, but make sure you're building toward enterprise standards.`,
            `This measured approach works for early stage. Just keep our long-term partnership in mind.`,
            `Acceptable scope for M1. Focus on building quality that enterprise customers expect.`
          ]
        },
        m2: {
          high_ap: [
            `M2 is when strategic partnership conversations get serious. This investment builds the capabilities we'd want to integrate with.`,
            `Second milestone should deepen the strategic fit. This shows you're thinking about the long-term relationship.`,
            `This level of investment creates opportunities for our portfolio companies to partner with you.`
          ],
          low_ap: [
            `Efficiency is valued, but make sure you're building toward enterprise requirements.`,
            `This approach can work, but don't fall behind on the capabilities that matter for strategic partnerships.`,
            `Reasonable, but keep building toward the integration points that would make partnership compelling.`
          ]
        },
        m3: {
          high_ap: [
            `Final milestone should establish you as a strategic asset. This investment builds toward outcomes we both want.`,
            `M3 is about positioning for exit or partnership. This creates the kind of capabilities that drive strategic value.`,
            `This level of investment makes the M&A conversation much more interesting for us.`
          ],
          low_ap: [
            `M3 efficiency is fine, but make sure you're positioned for the strategic conversations ahead.`,
            `This approach works if you've already built strong enterprise foundations.`,
            `Acceptable, but don't underinvest in what makes you strategically valuable at this stage.`
          ]
        }
      }
    };
    
    const funderTemplates = templates[fId] || templates.techAngel;
    const stageKey = milestoneStage === 0 ? 'm1' : milestoneStage === 1 ? 'm2' : 'm3';
    const apCategory = ap >= 3 ? 'high_ap' : 'low_ap';
    
    // Get stage-specific templates, or fall back to m1 if not found
    const stageTemplates = funderTemplates[stageKey] || funderTemplates.m1;
    const options = stageTemplates[apCategory];
    const selectedText = options[Math.floor(Math.random() * options.length)];
    
    return {
      text: selectedText,
      reason: '' // Reason is now integrated into the main text
    };
  }
  
  checkFunderAdvice() {
    // No advice to check if no investors
    if (this.investors.length === 0 || this.funderAdvices.length === 0) return;
    
    // Queue for confrontations to show after all advice is processed
    this.pendingConfrontations = this.pendingConfrontations || [];
    
    // Founder experience affects how investors react
    // Experienced founders get more patience, inexperienced get less
    const experienceBonus = this.getFounderExperienceBonus();
    
    // === DETECT CONFLICTING ADVICE PER DOMAIN ===
    // Group advice by domain and check for conflicts
    const adviceByDomain = {};
    this.funderAdvices.forEach(advice => {
      if (!adviceByDomain[advice.domain]) {
        adviceByDomain[advice.domain] = [];
      }
      adviceByDomain[advice.domain].push(advice);
    });
    
    // Track which domains have conflicts (multiple investors want different things)
    const conflictingDomains = new Set();
    Object.entries(adviceByDomain).forEach(([domain, advices]) => {
      const uniqueChoices = [...new Set(advices.map(a => a.recommendedChoice))];
      if (uniqueChoices.length > 1) {
        conflictingDomains.add(domain);
      }
    });
    
    // Track if advice was followed this quarter for simple meter
    let adviceFollowedThisQuarter = 0;
    let adviceIgnoredThisQuarter = 0;
    let conflictingAdviceCount = 0; // Track advice that was in conflict
    
    // Check each investor's advice
    this.funderAdvices.forEach(advice => {
      const investor = advice.investor;
      const adviceData = FUNDER_ADVICE[advice.funderId];
      if (!adviceData) return;
      
      // Skip if investor has already withdrawn support
      if (investor.hasWithdrawnSupport) {
        return;
      }
      
      const targetDomain = advice.domain;
      const recommendedChoice = advice.recommendedChoice;
      const actualChoice = this.choices[targetDomain];
      
      // === CHECK IF THIS ADVICE WAS IN CONFLICT ===
      const wasInConflict = conflictingDomains.has(targetDomain);
      const domainAdvices = adviceByDomain[targetDomain] || [];
      const playerFollowedSomeoneInDomain = domainAdvices.some(a => a.recommendedChoice === actualChoice);
      
      const previousRelationship = investor.relationship;
      
      // Check if advice was followed
      if (actualChoice === recommendedChoice) {
        // Followed advice - relationship improves
        investor.relationship = Math.min(5, investor.relationship + 1);
        this.log(`${advice.funderName}: ${advice.followedReaction}`);
        
        // Track consecutive follows for potential bonus
        investor.consecutiveFollows = (investor.consecutiveFollows || 0) + 1;
        investor.consecutiveIgnores = 0;
        
        // Track for simple meter
        adviceFollowedThisQuarter++;
        
        // If recovering from low relationship, show positive feedback
        if (previousRelationship <= 2 && investor.relationship > 2) {
          this.log(`ğŸ’š ${advice.funderName} seems relieved: "Good to see we're getting back on track."`);
        }
      } else {
        // Didn't follow this investor's specific advice
        
        // === TOLERANCE FOR CONFLICTING ADVICE ===
        // If advice was in conflict AND player followed another investor's advice,
        // this investor is more understanding (only 30% chance of relationship hit)
        let relationshipLoss = 1;
        let showUnderstandingMessage = false;
        
        if (wasInConflict && playerFollowedSomeoneInDomain) {
          // Player followed someone else's conflicting advice - be more tolerant
          conflictingAdviceCount++;
          
          if (Math.random() < 0.7) {
            // 70% chance investor understands you had to pick
            relationshipLoss = 0;
            showUnderstandingMessage = true;
          } else {
            // 30% chance they're still a bit miffed
            relationshipLoss = 1;
          }
        } else if (experienceBonus > 0 && Math.random() < 0.4) {
          // Experienced founder - 40% chance investor gives benefit of doubt
          relationshipLoss = 0;
          this.log(`${advice.funderName}: ${advice.ignoredReaction} ...but I trust your judgment.`);
        } else if (experienceBonus < 0) {
          // Inexperienced founder - harder to maintain relationships
          // 30% chance of extra penalty
          if (Math.random() < 0.3) {
            relationshipLoss = 2;
          }
          this.log(`${advice.funderName}: ${advice.ignoredReaction}`);
        } else {
          this.log(`${advice.funderName}: ${advice.ignoredReaction}`);
        }
        
        // Show understanding message for conflicting advice
        if (showUnderstandingMessage) {
          const understandingMessages = [
            `${advice.funderName} shrugs: "I see you went with another approach. Fair enough."`,
            `${advice.funderName}: "Not my preference, but I understand you had competing advice."`,
            `${advice.funderName} nods: "Investors don't always agree. Your call."`,
            `${advice.funderName}: "I would have done it differently, but I respect the decision."`
          ];
          this.log(understandingMessages[Math.floor(Math.random() * understandingMessages.length)]);
        }
        
        investor.relationship = Math.max(0, investor.relationship - relationshipLoss);
        
        // Track consecutive ignores (but not if it was a conflict they understood)
        if (relationshipLoss > 0) {
          investor.consecutiveFollows = 0;
          investor.consecutiveIgnores = (investor.consecutiveIgnores || 0) + 1;
          adviceIgnoredThisQuarter++;
        } else if (!showUnderstandingMessage) {
          // If they gave benefit of doubt (experienced founder), don't reset follows
        }
        
        // Queue confrontation if relationship dropped to critical levels
        if (investor.relationship <= 1 && previousRelationship > investor.relationship) {
          this.pendingConfrontations.push({
            investor,
            adviceData,
            funder: advice.funder,
            isHostile: investor.relationship === 0
          });
        }
        
        // If relationship is hostile (0), mark support as withdrawn
        if (investor.relationship === 0 && !investor.hasWithdrawnSupport) {
          investor.hasWithdrawnSupport = true;
          investor.withdrawnTurn = this.turn;
          
          // Apply hostile effect penalties permanently
          if (adviceData.hostileEffect) {
            Object.entries(adviceData.hostileEffect).forEach(([k, v]) => {
              if (this.metrics[k] !== undefined) {
                this.metrics[k] = Math.max(0, this.metrics[k] + v);
              }
            });
            const effectText = Object.entries(adviceData.hostileEffect)
              .map(([k, v]) => `${STAT_LABELS[k] || k} ${v < 0 ? 'decreased' : 'affected'}`)
              .join(", ");
            this.log(`âŒ ${advice.funder.name} has withdrawn support: ${effectText}`);
          }
        }
      }
    });
    
    // === UPDATE SIMPLE INVESTOR RELATIONSHIP METER ===
    // More nuanced: account for conflicting advice situations
    // If there were conflicts, be more forgiving in the global meter
    const netAdviceScore = adviceFollowedThisQuarter - adviceIgnoredThisQuarter;
    const hadConflicts = conflictingDomains.size > 0;
    
    if (netAdviceScore > 0) {
      // Clearly followed more than ignored
      this.updateInvestorRelationship(1, "followed investor advice");
    } else if (netAdviceScore < 0 && !hadConflicts) {
      // Clearly ignored more, and there were no conflicts to blame
      this.updateInvestorRelationship(-1, "ignored investor advice");
    } else if (netAdviceScore < -1 && hadConflicts) {
      // Even accounting for conflicts, ignored a lot - still penalize
      this.updateInvestorRelationship(-1, "frequently ignored investor advice");
    }
    // If netAdviceScore is 0 or slightly negative but with conflicts, no change (benefit of doubt)
    
    // Show confrontations after a delay (so log messages appear first)
    if (this.pendingConfrontations.length > 0) {
      setTimeout(() => this.showNextConfrontation(), 500);
    }
  }
  
  showNextConfrontation() {
    if (!this.pendingConfrontations || this.pendingConfrontations.length === 0) return;
    
    const conf = this.pendingConfrontations.shift();
    this.showInvestorConfrontation(conf.investor, conf.adviceData, conf.funder, conf.isHostile);
  }
  
  showInvestorConfrontation(investor, adviceData, funder, isHostile) {
    // Play confrontation sound
    this.playConfrontationSound(isHostile);
    
    // Update modal content
    const modal = document.getElementById("investorConfrontationModal");
    const header = document.getElementById("confrontationHeader");
    const photo = document.getElementById("confrontationPhoto");
    const status = document.getElementById("confrontationStatus");
    const name = document.getElementById("confrontationName");
    const title = document.getElementById("confrontationTitle");
    const quote = document.getElementById("confrontationQuote");
    const relDiv = document.getElementById("confrontationRelationship");
    const consequences = document.getElementById("confrontationConsequences");
    const consequencesList = document.getElementById("confrontationConsequencesList");
    const recoveryHint = document.getElementById("confrontationRecoveryHint");
    
    // Set header color based on severity
    if (isHostile) {
      header.className = "bg-gradient-to-r from-red-700 to-rose-800 text-white p-4";
      status.textContent = "Support Withdrawn";
    } else {
      header.className = "bg-gradient-to-r from-amber-600 to-orange-600 text-white p-4";
      status.textContent = "Investor Concerned";
    }
    
    // Set investor info
    photo.innerHTML = funder?.photo || '<div class="w-full h-full bg-red-700 flex items-center justify-center text-3xl">ğŸ˜ </div>';
    photo.className = isHostile ? "w-16 h-16 rounded-full border-3 border-white/30 overflow-hidden investor-angry" : "w-16 h-16 rounded-full border-3 border-white/30 overflow-hidden";
    name.textContent = funder?.name || adviceData.name; // Use actual investor name
    title.textContent = funder?.title || "Investor";
    
    // Set quote
    if (isHostile) {
      quote.textContent = `"${adviceData.hostileWarning} I've given you multiple chances. I'm stepping back from active involvement."`;
    } else {
      const warningQuotes = [
        `"I'm getting concerned about the direction here. This is the second time you've ignored my advice."`,
        `"${adviceData.hostileWarning} I hope you know what you're doing."`,
        `"We need to talk about alignment. I invested because I believed we shared a vision."`
      ];
      quote.textContent = warningQuotes[Math.floor(Math.random() * warningQuotes.length)];
    }
    
    // Update relationship dots
    const rel = investor.relationship;
    const dots = [];
    for (let i = 0; i < 5; i++) {
      if (i < rel) {
        dots.push('<span class="w-3 h-3 rounded-full bg-amber-500"></span>');
      } else if (i === 0 && rel === 0) {
        dots.push('<span class="w-3 h-3 rounded-full bg-red-500"></span>');
      } else {
        dots.push('<span class="w-3 h-3 rounded-full bg-slate-600"></span>');
      }
    }
    const relLabel = isHostile ? "Hostile" : "Strained";
    const relColor = isHostile ? "text-red-400" : "text-amber-400";
    
    // Add simple overall meter (0-3 scale)
    const simpleRel = this.getRelationshipLabel(this.investorRelationship);
    
    relDiv.innerHTML = `
      <span class="${relColor} font-bold">${relLabel}</span>
      <div class="flex gap-1">${dots.join('')}</div>
      <span class="text-xs text-slate-400 mx-2">|</span>
      <span class="text-xs ${simpleRel.color}">${simpleRel.emoji}</span>
    `;
    
    // Set consequences
    if (isHostile) {
      consequences.className = "bg-red-900/30 border border-red-500/50 rounded-xl p-4 mb-6";
      const effects = adviceData.hostileEffect ? 
        Object.entries(adviceData.hostileEffect).map(([k, v]) => {
          const label = STAT_LABELS[k] || k;
          return `<li class="flex items-center gap-2"><span class="text-red-400">ğŸ“‰</span> ${label} decreased (${funder?.name}'s support withdrawn)</li>`;
        }).join('') : '';
      consequencesList.innerHTML = `
        <li class="flex items-center gap-2"><span class="text-red-400">ğŸ”‡</span> They will no longer provide strategic advice</li>
        <li class="flex items-center gap-2"><span class="text-red-400">ğŸš«</span> Their ongoing support bonuses are lost</li>
        ${effects}
      `;
      recoveryHint.classList.add("hidden");
    } else {
      consequences.className = "bg-amber-900/30 border border-amber-500/50 rounded-xl p-4 mb-6";
      consequencesList.innerHTML = `
        <li class="flex items-center gap-2"><span class="text-amber-400">âš </span> One more ignored suggestion may cause them to withdraw support</li>
        <li class="flex items-center gap-2"><span class="text-amber-400">ğŸ˜•</span> Their advice quality may decrease while frustrated</li>
      `;
      recoveryHint.classList.remove("hidden");
    }
    
    // Show modal with shake effect if hostile
    modal.classList.remove("hidden");
    modal.classList.add("flex");
    
    if (isHostile) {
      const card = modal.querySelector(".confrontation-card");
      card.classList.add("confrontation-shake");
      setTimeout(() => card.classList.remove("confrontation-shake"), 500);
    }
  }
  
  playConfrontationSound(isHostile) {
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const now = ctx.currentTime;
      
      if (isHostile) {
        // Harsh, discordant sound for hostile
        const notes = [200, 180, 150, 120];
        notes.forEach((freq, i) => {
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.type = "sawtooth";
          osc.frequency.setValueAtTime(freq, now + i * 0.15);
          gain.gain.setValueAtTime(0, now + i * 0.15);
          gain.gain.linearRampToValueAtTime(0.1, now + i * 0.15 + 0.05);
          gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.15 + 0.3);
          osc.connect(gain);
          gain.connect(ctx.destination);
          osc.start(now + i * 0.15);
          osc.stop(now + i * 0.15 + 0.4);
        });
      } else {
        // Warning tone - descending
        const notes = [440, 370, 330];
        notes.forEach((freq, i) => {
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.type = "triangle";
          osc.frequency.setValueAtTime(freq, now + i * 0.2);
          gain.gain.setValueAtTime(0, now + i * 0.2);
          gain.gain.linearRampToValueAtTime(0.12, now + i * 0.2 + 0.05);
          gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.2 + 0.4);
          osc.connect(gain);
          gain.connect(ctx.destination);
          osc.start(now + i * 0.2);
          osc.stop(now + i * 0.2 + 0.5);
        });
      }
    } catch (e) {
      console.log("Confrontation sound not available");
    }
  }
  
  dismissConfrontation() {
    const modal = document.getElementById("investorConfrontationModal");
    modal.classList.add("hidden");
    modal.classList.remove("flex");
    
    // Show next confrontation if any
    if (this.pendingConfrontations && this.pendingConfrontations.length > 0) {
      setTimeout(() => this.showNextConfrontation(), 300);
    }
  }

  renderBoardroom() {
    this.renderAPPips();
    this.updateFocusIndicator(); // Update focus indicator (small badge)
    this.renderExecRow();
    this.renderHiredStaff();
    this.renderFunderAdvice(); // Show investor advice panel
    this.renderDecision();
    this.renderRivals();
    this.renderNews();
  }
  
  renderHiredStaff() {
    const section = document.getElementById("hiredStaffSection");
    const list = document.getElementById("hiredStaffList");
    const count = document.getElementById("hiredStaffCount");
    
    if (!section || !list) return;
    
    if (!this.hiredStaff || this.hiredStaff.length === 0) {
      section.classList.add("hidden");
      return;
    }
    
    section.classList.remove("hidden");
    count.textContent = `${this.hiredStaff.length} hire${this.hiredStaff.length !== 1 ? 's' : ''}`;
    
    const roleColors = { r: "emerald", p: "sky", m: "fuchsia", h: "amber" };
    const roleLabels = { r: "Research", p: "Product", m: "Marketing", h: "People" };
    
    list.innerHTML = this.hiredStaff.map(staff => {
      const roleKey = staff.id.charAt(0);
      const color = roleColors[roleKey] || "slate";
      const roleLabel = roleLabels[roleKey] || "Staff";
      
      return `
        <div class="flex items-center gap-2 px-3 py-2 bg-${color}-50 rounded-lg border border-${color}-200 cursor-pointer hover:bg-${color}-100 transition-colors" onclick="game.showHiredStaffDetail('${staff.id}')">
          <span class="text-2xl">${staff.portrait}</span>
          <div>
            <div class="font-medium text-slate-800 text-sm">${staff.name.split(" ").pop()}</div>
            <div class="text-xs text-${color}-600">${staff.seniority} ${roleLabel}</div>
          </div>
        </div>
      `;
    }).join("");
  }
  
  showHiredStaffDetail(staffId) {
    const staff = this.hiredStaff.find(s => s.id === staffId);
    if (!staff) return;
    
    const roleColors = { r: "from-emerald-500 to-teal-600", p: "from-sky-500 to-blue-600", m: "from-fuchsia-500 to-pink-600", h: "from-amber-500 to-orange-600" };
    const roleKey = staff.id.charAt(0);
    const headerColor = roleColors[roleKey] || "from-slate-500 to-slate-600";
    
    const content = document.getElementById("candidateDetailContent");
    content.innerHTML = `
      <div class="bg-gradient-to-r ${headerColor} px-6 py-5 rounded-t-2xl text-white">
        <div class="flex items-center gap-4">
          <div class="text-5xl bg-white/20 rounded-xl p-3">${staff.portrait}</div>
          <div class="flex-1">
            <h2 class="text-xl font-bold">${staff.name}</h2>
            <p class="text-white/80">${staff.background}</p>
            <p class="text-white/60 text-sm">${staff.origin}</p>
          </div>
          <div class="text-right">
            <div class="text-lg font-bold capitalize">${staff.seniority}</div>
            <div class="text-white/70 text-sm">Hired Q${staff.hiredQuarter || '?'}</div>
          </div>
        </div>
      </div>
      
      <div class="p-6 max-h-[50vh] overflow-y-auto">
        <div class="mb-5 p-4 bg-indigo-50 rounded-xl border border-indigo-200">
          <h3 class="font-bold text-slate-800 mb-2">ğŸ’° Compensation</h3>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <div class="text-slate-500">Salary</div>
              <div class="font-bold text-slate-800">Â£${staff.salary}k/year</div>
              <div class="text-xs text-slate-500">+Â£${Math.round(staff.salary/4)}k/quarter burn</div>
            </div>
            <div>
              <div class="text-slate-500">Equity</div>
              <div class="font-bold text-slate-800">${staff.equity}%</div>
            </div>
          </div>
        </div>
        
        <div class="mb-5">
          <h3 class="font-bold text-slate-800 mb-2">ğŸ“š Background</h3>
          <p class="text-sm text-slate-600 mb-2">${staff.cv?.education || 'N/A'}</p>
          ${(staff.cv?.experience || []).map(e => `<div class="text-sm text-slate-600 mb-1">â€¢ ${e}</div>`).join('')}
        </div>
        
        <div class="grid grid-cols-2 gap-4 mb-5">
          <div class="bg-emerald-50 rounded-lg p-3">
            <h4 class="font-bold text-emerald-800 mb-2 text-sm">âœ“ Strengths</h4>
            ${staff.strengths.map(s => `<div class="text-xs text-emerald-700">${s}</div>`).join('')}
          </div>
          <div class="bg-amber-50 rounded-lg p-3">
            <h4 class="font-bold text-amber-800 mb-2 text-sm">âš  Watch Out</h4>
            ${staff.weaknesses.map(w => `<div class="text-xs text-amber-700">${w}</div>`).join('')}
          </div>
        </div>
        
        <div class="bg-slate-50 rounded-lg p-3">
          <p class="text-sm text-slate-600 italic">"${staff.quote}"</p>
        </div>
      </div>
      
      <div class="px-6 py-4 border-t border-slate-200 bg-slate-50 rounded-b-2xl">
        <button onclick="game.closeCandidateDetail()" class="w-full px-4 py-2.5 border border-slate-300 text-slate-600 rounded-lg hover:bg-white">Close</button>
      </div>
    `;
    
    document.getElementById("candidateDetailModal").classList.remove("hidden");
    document.getElementById("candidateDetailModal").classList.add("flex");
  }

  // Show investor advice panel with general strategic guidance
  renderFunderAdvice() {
    const panel = document.getElementById("investorAdvicePanel");
    const content = document.getElementById("investorAdviceContent");
    
    if (!panel || !content) return;
    
    // Hide if no investors, extreme mode, or bootstrapped
    if (this.extremeMode || !this.investors || this.investors.length === 0) {
      panel.classList.add("hidden");
      return;
    }
    
    // Generate strategic guidance based on investor type and current game state
    const strategicGuidance = [];
    const withdrawnInvestors = [];
    
    this.investors.forEach(investor => {
      if (!investor || !investor.funderId) return;
      
      const adviceData = FUNDER_ADVICE[investor.funderId];
      if (!adviceData) return;
      
      // Handle withdrawn investors separately
      if (investor.hasWithdrawnSupport) {
        withdrawnInvestors.push({
          investor,
          funder: investor.funder,
          name: investor.funder?.name || adviceData.name // Use actual investor name
        });
        return;
      }
      
      // Generate context-aware strategic advice
      const guidance = this.getStrategicGuidance(investor, adviceData);
      if (!guidance) return;
      
      // Relationship indicator
      const rel = investor.relationship || 3;
      const relEmoji = rel >= 4 ? 'ğŸ˜Š' : rel >= 2 ? 'ğŸ˜' : rel === 1 ? 'ğŸ˜ ' : 'ğŸš«';
      const relLabel = rel >= 4 ? 'Supportive' : rel >= 2 ? 'Neutral' : rel === 1 ? 'Frustrated' : 'Hostile';
      
      strategicGuidance.push({
        investor,
        funder: investor.funder,
        name: investor.funder?.name || adviceData.name, // Use actual investor name
        guidance,
        relEmoji,
        relLabel,
        funderId: investor.funderId
      });
    });
    
    // Hide panel if no guidance generated and no withdrawn investors
    if (strategicGuidance.length === 0 && withdrawnInvestors.length === 0) {
      panel.classList.add("hidden");
      return;
    }
    
    // Show panel with content (including header)
    panel.classList.remove("hidden");
    
    // Build withdrawn investors section if any
    const withdrawnSection = withdrawnInvestors.length > 0 ? `
      <div class="mt-3 pt-3 border-t border-red-200">
        <div class="text-xs text-red-600 font-semibold uppercase tracking-wide mb-2">Support Withdrawn</div>
        ${withdrawnInvestors.map(w => `
          <div class="flex items-center gap-3 bg-red-50/50 rounded-lg p-2 opacity-60">
            <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-red-300 flex-shrink-0 grayscale">
              ${w.funder?.photo || '<div class="w-full h-full bg-red-200 flex items-center justify-center text-red-600">ğŸ’¼</div>'}
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2">
                <span class="font-medium text-red-800 text-sm">${w.name}</span>
                <span class="text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded-full">ğŸš« Disengaged</span>
              </div>
              <p class="text-xs text-red-600 italic">No longer providing advice or support</p>
            </div>
          </div>
        `).join('')}
      </div>
    ` : '';
    
    // Get simple investor relationship meter info (0-3 scale)
    const simpleRel = this.getRelationshipLabel(this.investorRelationship);
    const meterDots = [0, 1, 2, 3].map(level => 
      `<span class="w-2 h-2 rounded-full ${level <= this.investorRelationship ? simpleRel.bg.replace('bg-', 'bg-') : 'bg-slate-200'}"></span>`
    ).join('');
    
    content.innerHTML = `
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-2">
          <span class="text-lg">ğŸ’¼</span>
          <h3 class="font-bold text-violet-800 text-sm uppercase tracking-wide">Investor Guidance This Quarter</h3>
        </div>
        <!-- Simple Investor Relationship Meter -->
        <div class="flex items-center gap-2" title="Overall investor relationship">
          <span class="text-xs ${simpleRel.color}">${simpleRel.emoji} ${simpleRel.text}</span>
          <div class="flex gap-0.5">${meterDots}</div>
        </div>
      </div>
      ${strategicGuidance.length > 0 ? `
        <div class="space-y-2">
          ${strategicGuidance.map(g => `
            <div class="flex items-start gap-3 bg-white/60 rounded-lg p-3 ${g.investor.relationship <= 1 ? 'border border-amber-300' : ''}">
              <div class="w-12 h-12 rounded-full overflow-hidden border-2 ${g.investor.relationship <= 1 ? 'border-amber-400' : 'border-amber-300'} flex-shrink-0">
                ${g.funder?.photo || '<div class="w-full h-full bg-amber-200 flex items-center justify-center text-amber-600">ğŸ’¼</div>'}
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 flex-wrap mb-1">
                  <span class="font-bold text-violet-800">${g.name}</span>
                  <span class="text-xs bg-violet-200 text-violet-700 px-2 py-0.5 rounded-full">${this.getFunderTypeLabel(g.funderId)}</span>
                  <span class="text-xs ${g.investor.relationship >= 4 ? 'bg-emerald-100 text-emerald-700' : g.investor.relationship >= 2 ? 'bg-slate-100 text-slate-600' : 'bg-red-100 text-red-700'} px-2 py-0.5 rounded-full">${g.relEmoji} ${g.relLabel}</span>
                </div>
                <p class="text-sm text-slate-700">"${g.guidance}"</p>
              </div>
            </div>
          `).join('')}
        </div>
      ` : '<p class="text-sm text-slate-500 italic">No active investors providing guidance.</p>'}
      ${withdrawnSection}
    `;
  }
  
  getStrategicGuidance(investor, adviceData) {
    const funderId = investor.funderId;
    const milestone = this.milestone;
    const progress = this.milestoneProgress || 0;
    const runway = Math.floor(this.metrics.cash / this.metrics.burn);
    const quarter = this.quarter;
    const milestoneStage = this.completedMilestones?.length || 0; // 0=M1, 1=M2, 2=M3
    
    // Context-specific guidance based on game state
    if (runway <= 3) {
      // Low runway - everyone worried about cash
      const cashAdvice = {
        dragon: [
          "We need revenue NOW. Cut the R&D vanity projects and sell something.",
          "Cash is king. I've seen companies with great products die because they forgot to sell.",
          "Three quarters of runway? Time for war mode. Every decision should drive cash."
        ],
        techAngel: [
          "Runway's tight. Focus on what moves the needle technically-cut everything else.",
          "When cash is low, build features that customers will pay for. Nothing else.",
          "Technical elegance can wait. Ship the features that generate revenue."
        ],
        operatorAngel: [
          "This is a people problem. Are we overstaffed? What can we trim without killing morale?",
          "Runway crisis means hard conversations. Better to cut once deeply than death by a thousand cuts.",
          "Protect your best people. Lose the wrong ones now and recovery gets harder."
        ],
        sectorVC: [
          "I've seen this before. Time to focus on core competency and extend runway.",
          "In this sector, companies that survive the valley find the big opportunities on the other side.",
          "Your sector expertise is your lifeline. Double down on what you do better than anyone."
        ],
        tier1VC: [
          "This isn't the trajectory we signed up for. What's the plan to fix this?",
          "We need to see a credible path to the next milestone. What's your rescue plan?",
          "Growth mode is paused until we solve the cash problem. Show me the plan."
        ],
        academicAngel: [
          "Research excellence doesn't matter if the company dies. Focus on survival first.",
          "Protect the core science team, but everything else is negotiable right now.",
          "Consider grant funding as bridge capital. I can help with Innovate UK applications."
        ],
        corporateVC: [
          "Our partnership pipeline might help here. Let's talk about strategic options.",
          "Survival mode opens different conversations. Want to discuss licensing or acqui-hire?",
          "We've seen portfolio companies through worse. Let's talk about what support we can provide."
        ]
      };
      const pool = cashAdvice[funderId] || ["Cash is getting tight. Let's focus on extending runway."];
      return pool[Math.floor(Math.random() * pool.length)];
    }
    
    if (progress < 30 && this.turnsUntilDeadline() <= 4) {
      // Behind on milestone
      const behindAdvice = {
        dragon: [
          "We're behind. I don't invest in excuses. What's the plan?",
          "The milestone is slipping. Time to stop doing things and start doing the right thing.",
          "Behind schedule is a leadership problem. Show me you can turn this around."
        ],
        techAngel: [
          "The milestone's slipping. Is it a technical problem or a focus problem?",
          "What's blocking progress? Let's diagnose before we prescribe solutions.",
          "Behind on technical milestones usually means scope creep. What can we cut?"
        ],
        operatorAngel: [
          "Is the team stretched too thin? Sometimes you need to do less, better.",
          "Milestone pressure burns teams out. Are we sprinting unsustainably?",
          "Behind schedule often means unrealistic planning. Let's recalibrate expectations."
        ],
        sectorVC: [
          "I've seen companies miss milestones. The ones that survive communicate early.",
          "Sector expertise says this timeline was aggressive. Let's discuss what's realistic.",
          "Behind schedule in this sector isn't fatal if you're transparent about why."
        ],
        tier1VC: [
          "Missing milestones is how companies die. Fix this.",
          "Our portfolio model depends on execution. Show me you can hit targets.",
          "We invested in a company that delivers. What's going wrong?"
        ],
        academicAngel: [
          "Research timelines are inherently uncertain. What have we learned?",
          "Behind on scientific milestones might mean we're learning. Or it might mean we're unfocused.",
          "The scientific method tolerates delayed timelines if we're making real progress."
        ],
        corporateVC: [
          "Let's discuss what support we can provide from our side.",
          "Falling behind is an opportunity to deepen the partnership conversation.",
          "Our resources might help accelerate. What do you need?"
        ]
      };
      const pool = behindAdvice[funderId] || ["We need to pick up the pace on this milestone."];
      return pool[Math.floor(Math.random() * pool.length)];
    }
    
    if (progress >= 80) {
      // Close to milestone
      const closeAdvice = {
        dragon: [
          "Almost there! Don't get complacent. Push through and then let's celebrate.",
          "So close. This is when winners separate from almost-winners. Finish strong.",
          "The last 20% is where deals are made or broken. Bring it home."
        ],
        techAngel: [
          "Looking good. Make sure we're not cutting corners on the tech side.",
          "Strong progress. Don't let the pressure to finish compromise quality.",
          "Almost there technically. Take the time to do it right at the end."
        ],
        operatorAngel: [
          "Great progress! How's the team holding up? Don't burn them out at the finish line.",
          "Nearly there. Make sure we celebrate properly-team morale matters.",
          "Strong execution. Let's finish in a way that sets us up well for the next milestone."
        ],
        sectorVC: [
          "Strong execution. Start thinking about how we position for the next phase.",
          "Good progress on sector-specific metrics. Now let's plan the communications.",
          "Nearly there. This is when to line up the partnerships that matter."
        ],
        tier1VC: [
          "Good momentum. Let's start planning the growth push for after this.",
          "Strong execution. Now think about how to leverage this win for the next raise.",
          "Almost there. The best founders use milestone completion to accelerate, not coast."
        ],
        academicAngel: [
          "Excellent scientific progress. Make sure the documentation is publication-ready.",
          "Strong work. Let's think about how to communicate these results to the community.",
          "Nearly there. This is good science-now let's make sure it gets recognized."
        ],
        corporateVC: [
          "Good momentum. We should discuss synergies for the next phase.",
          "Strong execution. This opens up partnership conversations we should have.",
          "Nearly there. Let's plan how to leverage this milestone strategically."
        ]
      };
      const pool = closeAdvice[funderId] || ["We're close to the milestone. Keep pushing!"];
      return pool[Math.floor(Math.random() * pool.length)];
    }
    
    // Stage-specific strategic guidance based on milestone stage
    const stageAdvice = {
      dragon: {
        m1: [
          "M1 is about proving you're for real. What's your proof point this quarter?",
          "First milestone separates talkers from builders. Show me execution.",
          "Early stage is when you establish your reputation. Make it count.",
          "What are your numbers looking like? Traction is the best argument."
        ],
        m2: [
          "M2 is about momentum. You've proven the concept-now prove you can scale.",
          "Second milestone is where real companies emerge. Time to accelerate.",
          "You've got your first win. Now press the advantage before competitors react.",
          "Middle stage is the hardest. Push through-the rewards are on the other side."
        ],
        m3: [
          "Final stretch. This is where legends are made. What's your finishing move?",
          "M3 is about category definition. Are you building to lead or to follow?",
          "Endgame is about positioning for outcomes. Where do you want to end up?",
          "You've come too far to play small now. Finish like a champion."
        ]
      },
      techAngel: {
        m1: [
          "M1 should prove the technical hypothesis. What's the core insight?",
          "Early stage is about building something that works. Is the foundation solid?",
          "First milestone is technical validation. Don't skip the hard parts.",
          "What's your technical moat? Build that first."
        ],
        m2: [
          "M2 is when technical debt catches up with you. How's the architecture holding?",
          "Second milestone should show technical scalability. Can this handle 10x load?",
          "Middle stage is where good architecture pays off. Are we positioned well?",
          "Time to think about platform vs product. What's the technical vision?"
        ],
        m3: [
          "Final milestone should show technical excellence. Due diligence will be thorough.",
          "M3 is about proving enterprise-grade quality. Are we there?",
          "Endgame technical positioning matters for valuation. What's our story?",
          "Build for the scrutiny that's coming. Acquirers will look under the hood."
        ]
      },
      operatorAngel: {
        m1: [
          "M1 is chaos. That's normal. How's the team handling it?",
          "Early stage culture sets the pattern. What habits are forming?",
          "First milestone stress-tests the team. Are the right people in the right roles?",
          "How's morale? Burnout in M1 becomes a crisis in M2."
        ],
        m2: [
          "M2 is when teams either scale or implode. How's the organization developing?",
          "Second milestone is an operations test. Are processes keeping up with growth?",
          "Middle stage is when you need middle management. Have you thought about it?",
          "Team health determines milestone success. What does the pulse check show?"
        ],
        m3: [
          "Final stretch is hardest on teams. How are your key people doing?",
          "M3 success depends on execution under pressure. Is the team ready?",
          "Endgame is when tired teams make mistakes. Protect your people.",
          "Your team got you here. Make sure they can carry you to the finish."
        ]
      },
      academicAngel: {
        m1: [
          "M1 should establish scientific credibility. What's the publishable result?",
          "Early stage research needs to prove the core hypothesis. Stay focused.",
          "First milestone is about scientific validation. Are we rigorous enough?",
          "What does the data say? Let the science guide the strategy."
        ],
        m2: [
          "M2 should deepen the research moat. What's the next paper?",
          "Second milestone builds on scientific foundations. Is the pipeline full?",
          "Middle stage is when research and commercial start to tension. How are we balancing?",
          "Time to think about research strategy. Where should we focus next?"
        ],
        m3: [
          "Final milestone should cement scientific leadership. What's the capstone?",
          "M3 is about being the definitive source. Are we there yet?",
          "Endgame research positioning matters for outcomes. What's our claim to fame?",
          "Build the research legacy that makes this company valuable."
        ]
      },
      sectorVC: {
        m1: [
          "M1 should establish sector credibility. Are we speaking the language?",
          "Early stage in this sector requires specific foundations. Are we building them?",
          "First milestone is about sector-specific validation. What do experts think?",
          "What's our sector differentiation? That's what matters here."
        ],
        m2: [
          "M2 should show sector leadership. Are we becoming the go-to company?",
          "Second milestone opens enterprise doors. Are we ready for those conversations?",
          "Middle stage is when sector expertise compounds. Are we leveraging it?",
          "Time to think about sector strategy. Where do we want to be positioned?"
        ],
        m3: [
          "Final milestone should establish sector dominance. What's our market position?",
          "M3 is about being essential to the sector. Are we there?",
          "Endgame sector positioning determines strategic value. What's our story?",
          "Build the sector presence that makes acquirers pay premium."
        ]
      },
      tier1VC: {
        m1: [
          "M1 is proof of velocity. Can you move faster than the competition?",
          "Early stage should show exceptional growth potential. Where's the rocket ship?",
          "First milestone is about proving the model. Show me the path to 10x.",
          "What's your unfair advantage? That's what we need to see scaled."
        ],
        m2: [
          "M2 is about acceleration. You've proven the model-now prove you can scale it.",
          "Second milestone should show growth trajectory. Are we on track for category leadership?",
          "Middle stage separates good companies from great ones. Which are you building?",
          "Time to think about market domination. What's the aggressive play?"
        ],
        m3: [
          "Final milestone should show category-defining momentum. Are you the leader?",
          "M3 is about proving you can be the dominant player. Show me the path.",
          "Endgame is about positioning for the outcome we both want. What gets us there?",
          "You didn't come this far to finish second. What's the winning move?"
        ]
      },
      corporateVC: {
        m1: [
          "M1 should show strategic alignment. How does this fit the bigger picture?",
          "Early stage is about building enterprise-grade foundations. Are we on track?",
          "First milestone is about proving quality. Enterprise customers are watching.",
          "What makes you strategically valuable? Build that first."
        ],
        m2: [
          "M2 should deepen strategic integration potential. What are the synergies?",
          "Second milestone opens partnership conversations. Are we ready?",
          "Middle stage is when strategic value becomes clear. What's our angle?",
          "Time to think about the bigger relationship. What could this become?"
        ],
        m3: [
          "Final milestone should make the strategic case compelling. What's the story?",
          "M3 is about proving strategic value. Are we positioned for the conversation we want?",
          "Endgame strategic positioning determines the options you have. Build them now.",
          "What makes you acquisition-ready? That's what we should be building toward."
        ]
      }
    };
    
    // Select stage-specific advice
    const stageKey = milestoneStage === 0 ? 'm1' : milestoneStage === 1 ? 'm2' : 'm3';
    const funderStageAdvice = stageAdvice[funderId]?.[stageKey] || stageAdvice.techAngel[stageKey];
    
    return funderStageAdvice[Math.floor(Math.random() * funderStageAdvice.length)];
  }
  
  turnsUntilDeadline() {
    if (!this.milestone) return 99;
    return Math.max(0, this.milestone.deadline - this.turn);
  }

  renderAPPips() {
    const used = this.getUsedAP();
    const totalAP = this.getTotalAP();
    const baseAP = this.maxAP;
    const banked = this.bankedAP;
    const remaining = totalAP - used;
    const isOver = used > totalAP;
    const overBy = isOver ? used - totalAP : 0;
    
    // Update the three boxes
    const spentBox = document.getElementById("apSpentBox");
    const leftBox = document.getElementById("apLeftBox");
    const bankedBox = document.getElementById("apBankedBox");
    
    if (!spentBox || !leftBox || !bankedBox) return;
    
    // Spent box
    document.getElementById("apSpentNum").textContent = used;
    spentBox.className = isOver 
      ? "bg-red-200 rounded-lg p-2 text-center"
      : used > 0 
        ? "bg-slate-200 rounded-lg p-2 text-center" 
        : "bg-slate-200 rounded-lg p-2 text-center";
    document.getElementById("apSpentNum").className = isOver
      ? "text-2xl font-bold text-red-600"
      : used > 0
        ? "text-2xl font-bold text-slate-500"
        : "text-2xl font-bold text-slate-400";
    
    // Left box
    document.getElementById("apLeftNum").textContent = isOver ? `-${overBy}` : remaining;
    document.getElementById("apLeftLabel").textContent = isOver ? "Over!" : "Left";
    if (isOver) {
      leftBox.className = "bg-red-500 rounded-lg p-2 text-center shadow-md";
      document.getElementById("apLeftNum").className = "text-2xl font-bold text-white";
      document.getElementById("apLeftLabel").className = "text-[10px] text-red-100 font-medium uppercase tracking-wide";
    } else if (remaining === 0) {
      leftBox.className = "bg-slate-400 rounded-lg p-2 text-center";
      document.getElementById("apLeftNum").className = "text-2xl font-bold text-white";
      document.getElementById("apLeftLabel").className = "text-[10px] text-slate-200 font-medium uppercase tracking-wide";
    } else if (remaining <= 2) {
      leftBox.className = "bg-amber-500 rounded-lg p-2 text-center shadow-md";
      document.getElementById("apLeftNum").className = "text-2xl font-bold text-white";
      document.getElementById("apLeftLabel").className = "text-[10px] text-amber-100 font-medium uppercase tracking-wide";
    } else {
      leftBox.className = "bg-emerald-500 rounded-lg p-2 text-center shadow-md";
      document.getElementById("apLeftNum").className = "text-2xl font-bold text-white";
      document.getElementById("apLeftLabel").className = "text-[10px] text-emerald-100 font-medium uppercase tracking-wide";
    }
    
    // Banked box
    document.getElementById("apBankedNum").textContent = banked > 0 ? `+${banked}` : "0";
    if (banked > 0) {
      bankedBox.className = "bg-amber-100 rounded-lg p-2 text-center border border-amber-300";
      document.getElementById("apBankedNum").className = "text-2xl font-bold text-amber-600";
    } else {
      bankedBox.className = "bg-slate-100 rounded-lg p-2 text-center border border-dashed border-slate-300";
      document.getElementById("apBankedNum").className = "text-2xl font-bold text-slate-300";
    }
    
    // Update progress bar
    const totalForBar = isOver ? used : totalAP;
    const spentPercent = (Math.min(used, totalAP) / totalForBar) * 100;
    const baseRemaining = Math.max(0, baseAP - used);
    const basePercent = (baseRemaining / totalForBar) * 100;
    const bankedRemaining = Math.max(0, remaining - baseRemaining);
    const bankedPercent = (bankedRemaining / totalForBar) * 100;
    const overPercent = isOver ? (overBy / totalForBar) * 100 : 0;
    
    document.getElementById("apBarSpent").style.width = `${spentPercent}%`;
    document.getElementById("apBarBase").style.width = `${basePercent}%`;
    document.getElementById("apBarBanked").style.width = `${bankedPercent}%`;
    document.getElementById("apBarOver").style.width = `${overPercent}%`;
    
    // Update totals with breakdown
    const staffBonus = this.getStaffAPBonus();
    const penalty = this.staffAPPenalty;
    const fundingCost = this.fundingAPCost || 0;
    let baseText = `Base: ${this.maxAP}`;
    if (this.bankedAP > 0) baseText += ` +${this.bankedAP} banked`;
    if (staffBonus > 0) baseText += ` +${staffBonus} staff`;
    if (penalty > 0) baseText += ` âˆ’${penalty} disruption`;
    if (fundingCost > 0) baseText += ` âˆ’${fundingCost} fundraising`;
    document.getElementById("apBaseDisplay").textContent = baseText;
    document.getElementById("apTotalDisplay").textContent = totalAP;
    document.getElementById("estCost").textContent = `Â£${this.getEstCost()}k`;
    
    // Container styling for over budget
    const container = document.getElementById("apTrackerContainer");
    const displayArea = document.getElementById("apDisplayArea");
    if (isOver) {
      container.className = "bg-white rounded-xl shadow-sm p-4 border-2 border-red-300";
      displayArea.className = "bg-red-50 rounded-lg p-3";
    } else {
      container.className = "bg-white rounded-xl shadow-sm p-4 border border-slate-200";
      displayArea.className = "bg-slate-100 rounded-lg p-3";
    }
    
    // Warning and commit button
    document.getElementById("apWarning").classList.toggle("hidden", !isOver);
    document.getElementById("commitBtn").disabled = !this.allChosen() || isOver;
    
    // Update opportunity cost hint
    this.updateOpportunityCostHint();
    
    // Update focus indicator
    this.updateFocusIndicator();
  }

  // ===== FOCUS INDICATOR =====
  updateFocusIndicator() {
    const indicatorEl = document.getElementById("focusIndicator");
    const iconEl = document.getElementById("focusIndicatorIcon");
    const textEl = document.getElementById("focusIndicatorText");
    
    if (!indicatorEl || !iconEl || !textEl) return;
    
    // Don't show until all choices are made
    if (!this.allChosen()) {
      indicatorEl.classList.add("hidden");
      return;
    }
    
    const isSpread = this.isSpreadThin();
    const focusedDomain = this.isFocused();
    const domainLabels = { research: "Research", dev: "Product", marketing: "Sales", hr: "People" };
    
    if (isSpread) {
      // Show spread thin warning
      indicatorEl.classList.remove("hidden");
      iconEl.textContent = "âš ï¸";
      
      const streakText = this.focusTracking.consecutiveSpreadQuarters > 0 
        ? ` (${this.focusTracking.consecutiveSpreadQuarters + 1} quarters in a row)` 
        : "";
      textEl.textContent = `Attention spread thin${streakText} â€” may reduce effectiveness`;
      indicatorEl.className = "mt-2 p-2 rounded-lg text-xs text-center bg-amber-50 border border-amber-200 text-amber-700";
      
    } else if (focusedDomain) {
      // Show focused bonus preview
      indicatorEl.classList.remove("hidden");
      iconEl.textContent = "ğŸ¯";
      textEl.textContent = `Focused on ${domainLabels[focusedDomain]} â€” +10% effectiveness!`;
      indicatorEl.className = "mt-2 p-2 rounded-lg text-xs text-center bg-emerald-50 border border-emerald-200 text-emerald-700";
      
    } else {
      // Normal allocation - hide indicator
      indicatorEl.classList.add("hidden");
    }
  }

  // ===== OPPORTUNITY COST HINT SYSTEM =====
  updateOpportunityCostHint() {
    const hintEl = document.getElementById("opportunityCostHint");
    const iconEl = document.getElementById("opportunityCostIcon");
    const textEl = document.getElementById("opportunityCostText");
    
    if (!hintEl || !iconEl || !textEl) return;
    
    const hint = this.calculateOpportunityCostHint();
    
    if (!hint) {
      hintEl.classList.add("hidden");
      return;
    }
    
    // Show the hint with appropriate styling
    hintEl.classList.remove("hidden");
    iconEl.textContent = hint.icon;
    textEl.textContent = hint.text;
    
    // Style based on severity
    if (hint.severity === "warning") {
      hintEl.className = "mt-2 p-2 rounded-lg text-xs text-center bg-amber-50 border border-amber-200 text-amber-700";
    } else if (hint.severity === "danger") {
      hintEl.className = "mt-2 p-2 rounded-lg text-xs text-center bg-red-50 border border-red-200 text-red-700";
    } else {
      hintEl.className = "mt-2 p-2 rounded-lg text-xs text-center bg-blue-50 border border-blue-200 text-blue-600";
    }
  }
  
  calculateOpportunityCostHint() {
    // Don't show hints until at least one choice is made
    if (!this.choices || Object.keys(this.choices).length === 0) {
      return null;
    }
    
    const runway = this.metrics.burn > 0 ? Math.floor(this.metrics.cash / this.metrics.burn) : 99;
    const milestone = this.milestone;
    
    // Calculate AP spent per domain
    const apByDomain = this.getAPSpentByDomain();
    const totalAPSpent = Object.values(apByDomain).reduce((a, b) => a + b, 0);
    
    if (totalAPSpent === 0) return null;
    
    // Find dominant domain (where most AP is being spent)
    let dominantDomain = null;
    let maxAP = 0;
    Object.entries(apByDomain).forEach(([domain, ap]) => {
      if (ap > maxAP) {
        maxAP = ap;
        dominantDomain = domain;
      }
    });
    
    // Priority 1: Critical runway warning
    if (runway <= 2) {
      // Check if any revenue-generating or fundraising actions selected
      const hasRevenueAction = this.hasRevenueOrFundraisingChoice();
      if (!hasRevenueAction) {
        return {
          icon: "ğŸš¨",
          text: "Critical runway! Consider revenue-generating actions or fundraising.",
          severity: "danger"
        };
      }
    }
    
    // Priority 2: Low runway warning
    if (runway <= 4) {
      const hasRevenueAction = this.hasRevenueOrFundraisingChoice();
      if (!hasRevenueAction) {
        return {
          icon: "âš ï¸",
          text: "Runway is low; consider actions that generate revenue or reduce burn.",
          severity: "warning"
        };
      }
    }
    
    // Priority 3: Milestone focus mismatch
    if (milestone && milestone.focus && dominantDomain) {
      const milestoneFocus = milestone.focus; // e.g., ["sci", "dev"]
      const domainToMetric = {
        research: "sci",
        dev: "dev",
        marketing: "mkt",
        hr: "hr"
      };
      const dominantMetric = domainToMetric[dominantDomain];
      
      // Check if dominant spending is NOT in milestone focus areas
      if (!milestoneFocus.includes(dominantMetric)) {
        const domainNames = {
          research: "Research",
          dev: "Product",
          marketing: "Sales",
          hr: "HR"
        };
        const focusNames = milestoneFocus.map(f => {
          const nameMap = { sci: "Research", dev: "Product", mkt: "Sales", hr: "HR" };
          return nameMap[f] || f;
        }).join(" & ");
        
        return {
          icon: "ğŸ’¡",
          text: `Heavy ${domainNames[dominantDomain]} focus may slow milestone progress. Consider ${focusNames}.`,
          severity: "info"
        };
      }
    }
    
    // Priority 4: Milestone deadline approaching with low focus
    if (milestone && milestone.focus) {
      const quartersLeft = Math.max(0, milestone.deadline - this.turn);
      const progress = this.milestoneProgress || 0;
      
      if (quartersLeft <= 2 && progress < 80) {
        // Check if spending aligns with milestone
        const milestoneDomains = milestone.focus.map(f => {
          const metricToDomain = { sci: "research", dev: "dev", mkt: "marketing", hr: "hr" };
          return metricToDomain[f];
        });
        
        const milestoneAPSpent = milestoneDomains.reduce((sum, d) => sum + (apByDomain[d] || 0), 0);
        const milestoneAPRatio = totalAPSpent > 0 ? milestoneAPSpent / totalAPSpent : 0;
        
        if (milestoneAPRatio < 0.5) {
          return {
            icon: "â°",
            text: `Milestone deadline in ${quartersLeft}Q! Focus more AP on milestone requirements.`,
            severity: "warning"
          };
        }
      }
    }
    
    // Priority 5: All passes selected (disengagement warning)
    const domains = this.team.hr ? ["research", "dev", "marketing", "hr"] : ["research", "dev", "marketing"];
    const passCount = domains.filter(d => this.choices[d] === -1).length;
    if (passCount >= domains.length - 1 && Object.keys(this.choices).length >= domains.length - 1) {
      return {
        icon: "ğŸ˜´",
        text: "Passing most decisions? Your team needs active direction.",
        severity: "warning"
      };
    }
    
    return null;
  }
  
  getAPSpentByDomain() {
    const apByDomain = { research: 0, dev: 0, marketing: 0, hr: 0 };
    
    if (!this.choices || !this.currentEvents) return apByDomain;
    
    Object.entries(this.choices).forEach(([domain, choiceIndex]) => {
      if (choiceIndex === -1) {
        // Pass costs 0 AP
        apByDomain[domain] = 0;
      } else if (this.currentEvents[domain]?.event?.choices?.[choiceIndex]) {
        const choice = this.currentEvents[domain].event.choices[choiceIndex];
        apByDomain[domain] = choice.ap || 0;
      }
    });
    
    return apByDomain;
  }
  
  hasRevenueOrFundraisingChoice() {
    // Check if any selected choice has positive cash effect or is marketing-focused
    if (!this.choices || !this.currentEvents) return false;
    
    for (const [domain, choiceIndex] of Object.entries(this.choices)) {
      if (choiceIndex === -1) continue;
      
      const choice = this.currentEvents[domain]?.event?.choices?.[choiceIndex];
      if (!choice) continue;
      
      // Check for positive cash effect
      if (choice.eff?.cash && choice.eff.cash > 0) return true;
      
      // Check for significant marketing boost (revenue potential)
      if (choice.eff?.mkt && choice.eff.mkt >= 4 && domain === "marketing") return true;
    }
    
    return false;
  }

  // === STRATEGIC FOCUS SYSTEM ===
  
  showStrategicFocusModal() {
    // Don't show if already selected this quarter (unless clicking indicator to change)
    const modalHTML = `
      <div id="strategicFocusModal" class="fixed inset-0 bg-slate-900/90 flex items-center justify-center z-[55] p-4">
        <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl max-w-md w-full shadow-2xl border border-slate-700 ui-fade-in">
          <div class="p-6 text-center border-b border-slate-700">
            <div class="text-4xl mb-2">ğŸ¯</div>
            <h2 class="text-xl font-bold text-white">Set Your Focus</h2>
            <p class="text-slate-400 text-sm mt-1">What's your priority this quarter?</p>
          </div>
          
          <div class="p-4 space-y-3">
            ${Object.entries(this.STRATEGIC_FOCUSES).map(([key, focus]) => {
              const isSelected = this.strategicFocus === key;
              
              // Generate visual benefit/cost tags like decision cards
              const benefits = [];
              const costs = [];
              
              if (key === 'growth') {
                benefits.push({ icon: 'ğŸ“ˆ', label: '+Sales', color: 'emerald' });
                benefits.push({ icon: 'âš¡', label: '+Speed', color: 'emerald' });
                costs.push({ icon: 'ğŸ”¥', label: 'Higher Burn', color: 'red' });
              } else if (key === 'efficiency') {
                benefits.push({ icon: 'ğŸ’š', label: 'Lower Costs', color: 'emerald' });
                benefits.push({ icon: 'â±ï¸', label: '+Runway', color: 'emerald' });
                costs.push({ icon: 'ğŸ¢', label: 'Slower Growth', color: 'amber' });
              } else if (key === 'innovation') {
                benefits.push({ icon: 'ğŸ”¬', label: '+Research', color: 'emerald' });
                benefits.push({ icon: 'âœ¨', label: '+Breakthroughs', color: 'emerald' });
                costs.push({ icon: 'ğŸ“‰', label: 'Less Revenue', color: 'red' });
              } else if (key === 'fundraising') {
                benefits.push({ icon: 'ğŸ’¼', label: '+Investor Trust', color: 'emerald' });
                benefits.push({ icon: 'ğŸ“Š', label: '+Valuation', color: 'emerald' });
                costs.push({ icon: 'ğŸ”¬', label: 'Less R&D', color: 'amber' });
              }
              
              return `
                <button onclick="game.selectStrategicFocus('${key}')" 
                        class="w-full p-4 rounded-xl text-left transition-all ${isSelected 
                          ? `bg-${focus.color}-500/30 ring-2 ring-${focus.color}-400` 
                          : 'bg-slate-700/50 hover:bg-slate-700'}">
                  <div class="flex items-center gap-3">
                    <span class="text-3xl">${focus.icon}</span>
                    <div class="flex-1">
                      <div class="font-bold text-white text-lg">${focus.name}</div>
                      <div class="text-sm text-slate-400">${focus.desc}</div>
                    </div>
                    ${isSelected ? '<span class="text-emerald-400 text-xl">âœ“</span>' : ''}
                  </div>
                  <div class="mt-3 flex flex-wrap gap-2">
                    ${benefits.map(b => `
                      <span class="bg-${b.color}-500/20 text-${b.color}-300 px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1">
                        ${b.icon} ${b.label}
                      </span>
                    `).join('')}
                    ${costs.map(c => `
                      <span class="bg-${c.color}-500/20 text-${c.color}-300 px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1">
                        ${c.icon} ${c.label}
                      </span>
                    `).join('')}
                  </div>
                </button>
              `;
            }).join('')}
          </div>
          
          <div class="p-4 border-t border-slate-700">
            <button onclick="game.closeStrategicFocusModal()" class="w-full py-3 bg-slate-600 hover:bg-slate-500 text-white font-bold rounded-xl transition-all">
              ${this.strategicFocus ? 'Continue â†’' : 'Skip (Balanced Approach)'}
            </button>
          </div>
        </div>
      </div>
    `;
    
    // Remove existing modal if any
    const existing = document.getElementById('strategicFocusModal');
    if (existing) existing.remove();
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
  }
  
  closeStrategicFocusModal() {
    const modal = document.getElementById('strategicFocusModal');
    if (modal) modal.remove();
    
    // Update the indicator
    this.updateFocusIndicator();
  }
  
  updateFocusIndicator() {
    const indicator = document.getElementById('strategicFocusIndicator');
    const indicatorText = document.getElementById('focusIndicatorText');
    
    if (!indicator || !indicatorText) return;
    
    // Only show indicator during actual gameplay, hide in Extreme Mode
    if (!this.gameStarted || this.extremeMode) {
      indicator.classList.add('hidden');
      return;
    }
    
    if (this.strategicFocus) {
      const focus = this.STRATEGIC_FOCUSES[this.strategicFocus];
      indicator.classList.remove('hidden');
      indicator.className = `bg-${focus.color}-600 text-white rounded-lg px-3 py-2 text-center cursor-pointer hover:bg-${focus.color}-500 transition-all`;
      indicatorText.innerHTML = `${focus.icon} ${focus.name}`;
    } else {
      // Show "Set Focus" prompt if not yet selected
      indicator.classList.remove('hidden');
      indicator.className = 'bg-slate-700 text-white rounded-lg px-3 py-2 text-center cursor-pointer hover:bg-slate-600 transition-all border-2 border-dashed border-slate-500';
      indicatorText.innerHTML = 'ğŸ¯ Set Focus';
    }
  }
  
  renderStrategicFocus() {
    // Just update the indicator - modal is separate
    this.updateFocusIndicator();
  }
  
  selectStrategicFocus(focusKey) {
    this.strategicFocus = focusKey;
    
    // Play selection sound
    soundManager.playClick();
    
    // Show toast
    const focus = this.STRATEGIC_FOCUSES[focusKey];
    UIEffects.showToast(`Focus: ${focus.name}`, 'neutral', focus.icon);
    
    // Close modal and update indicator
    this.closeStrategicFocusModal();
  }
  
  // Apply strategic focus modifiers to effects
  applyStrategicFocusToEffects(effects) {
    if (!this.strategicFocus) return effects;
    
    const focus = this.STRATEGIC_FOCUSES[this.strategicFocus];
    const modified = { ...effects };
    
    // Apply bonuses
    if (focus.bonus) {
      if (focus.bonus.sci && modified.sci) modified.sci = Math.round(modified.sci * focus.bonus.sci);
      if (focus.bonus.dev && modified.dev) modified.dev = Math.round(modified.dev * focus.bonus.dev);
      if (focus.bonus.mkt && modified.mkt) modified.mkt = Math.round(modified.mkt * focus.bonus.mkt);
      if (focus.bonus.hr && modified.hr) modified.hr = Math.round(modified.hr * focus.bonus.hr);
    }
    
    // Apply penalties
    if (focus.penalty) {
      if (focus.penalty.sci && modified.sci) modified.sci = Math.round(modified.sci * focus.penalty.sci);
      if (focus.penalty.dev && modified.dev) modified.dev = Math.round(modified.dev * focus.penalty.dev);
      if (focus.penalty.mkt && modified.mkt) modified.mkt = Math.round(modified.mkt * focus.penalty.mkt);
    }
    
    return modified;
  }
  
  // === PROGRESSION UNLOCKS SYSTEM ===
  
  checkUnlocks() {
    const newUnlocks = [];
    
    // First paying customer
    if (!this.unlocks.firstCustomer && this.customers.length > 0) {
      this.unlocks.firstCustomer = true;
      newUnlocks.push({
        id: 'firstCustomer',
        title: 'ğŸ‰ First Customer!',
        desc: 'You\'ve acquired your first paying customer.',
        unlock: 'Pricing experiments now available'
      });
    }
    
    // First revenue
    if (!this.unlocks.firstRevenue && this.quarterlyRevenue > 0) {
      this.unlocks.firstRevenue = true;
      newUnlocks.push({
        id: 'firstRevenue',
        title: 'ğŸ’° Revenue!',
        desc: 'Money is coming in the door.',
        unlock: 'Revenue projections dashboard unlocked'
      });
    }
    
    // Series A (check valuation threshold)
    if (!this.unlocks.seriesA && this.metrics.val >= 5000) {
      this.unlocks.seriesA = true;
      newUnlocks.push({
        id: 'seriesA',
        title: 'ğŸš€ Series A Ready',
        desc: 'Your valuation qualifies for institutional funding.',
        unlock: 'Enterprise sales path & regulatory options unlocked'
      });
    }
    
    // Published paper (check research threshold)
    if (!this.unlocks.publishedPaper && this.metrics.sci >= 70) {
      this.unlocks.publishedPaper = true;
      newUnlocks.push({
        id: 'publishedPaper',
        title: 'ğŸ“„ Published Research',
        desc: 'Your team has achieved scientific recognition.',
        unlock: '+15% hiring quality, +10% investor credibility'
      });
    }
    
    // Product-market fit
    if (!this.unlocks.productMarketFit && this.metrics.mkt >= 60 && this.metrics.dev >= 50 && this.customers.length >= 5) {
      this.unlocks.productMarketFit = true;
      newUnlocks.push({
        id: 'productMarketFit',
        title: 'ğŸ¯ Product-Market Fit',
        desc: 'Customers love what you\'re building.',
        unlock: 'Growth experiments unlocked'
      });
    }
    
    // Profitability
    if (!this.unlocks.profitability && this.quarterlyRevenue > this.metrics.burn) {
      this.unlocks.profitability = true;
      newUnlocks.push({
        id: 'profitability',
        title: 'ğŸ’š Profitable!',
        desc: 'Revenue exceeds burn rate.',
        unlock: 'Dividend option & bootstrapping path unlocked'
      });
    }
    
    // Team of 10
    if (!this.unlocks.teamOf10 && (this.hiredStaff.length + 4) >= 10) {
      this.unlocks.teamOf10 = true;
      newUnlocks.push({
        id: 'teamOf10',
        title: 'ğŸ‘¥ Team of 10',
        desc: 'Your organization is growing.',
        unlock: 'Org structure choices unlocked'
      });
    }
    
    // Queue unlocks for display
    this.unlockNotifications.push(...newUnlocks);
    
    return newUnlocks;
  }
  
  showUnlockNotification() {
    if (this.unlockNotifications.length === 0) return;
    
    const unlock = this.unlockNotifications.shift();
    
    const modalHTML = `
      <div id="unlockModal" class="fixed inset-0 bg-slate-900/90 flex items-center justify-center z-[70] p-4">
        <div class="bg-gradient-to-br from-amber-50 to-yellow-50 rounded-2xl max-w-md w-full p-6 shadow-2xl border-2 border-amber-400 ui-fade-in">
          <div class="text-center">
            <div class="text-5xl mb-4">${unlock.title.split(' ')[0]}</div>
            <h2 class="text-2xl font-bold text-amber-800 mb-2">${unlock.title.substring(unlock.title.indexOf(' ') + 1)}</h2>
            <p class="text-amber-700 mb-4">${unlock.desc}</p>
            <div class="bg-amber-100 rounded-lg p-3 mb-4">
              <div class="text-xs uppercase tracking-wide text-amber-600 mb-1">Unlocked</div>
              <div class="font-bold text-amber-800">${unlock.unlock}</div>
            </div>
            <button onclick="game.closeUnlockModal()" class="px-6 py-2 bg-amber-500 hover:bg-amber-600 text-white font-bold rounded-lg">
              Awesome!
            </button>
          </div>
        </div>
      </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    soundManager.playMilestoneComplete();
  }
  
  closeUnlockModal() {
    const modal = document.getElementById('unlockModal');
    if (modal) modal.remove();
    
    // Show next unlock if queued
    if (this.unlockNotifications.length > 0) {
      setTimeout(() => this.showUnlockNotification(), 500);
    }
  }
  
  renderUnlocksPanel() {
    const list = document.getElementById('unlocksList');
    const count = document.getElementById('unlocksCount');
    if (!list) return;
    
    const allUnlocks = [
      { id: 'firstCustomer', name: 'First Customer', icon: 'ğŸ‰', desc: 'Pricing experiments' },
      { id: 'firstRevenue', name: 'Revenue', icon: 'ğŸ’°', desc: 'Revenue projections' },
      { id: 'seriesA', name: 'Series A Ready', icon: 'ğŸš€', desc: 'Enterprise path' },
      { id: 'publishedPaper', name: 'Published Research', icon: 'ğŸ“„', desc: '+Hiring quality' },
      { id: 'productMarketFit', name: 'Product-Market Fit', icon: 'ğŸ¯', desc: 'Growth experiments' },
      { id: 'profitability', name: 'Profitable', icon: 'ğŸ’š', desc: 'Bootstrapping path' },
      { id: 'teamOf10', name: 'Team of 10', icon: 'ğŸ‘¥', desc: 'Org structure' },
      { id: 'internationalCustomer', name: 'Global Customer', icon: 'ğŸŒ', desc: 'Market expansion' }
    ];
    
    const unlockedCount = allUnlocks.filter(u => this.unlocks[u.id]).length;
    count.textContent = `${unlockedCount}/${allUnlocks.length}`;
    
    list.innerHTML = allUnlocks.map(u => {
      const unlocked = this.unlocks[u.id];
      return `
        <div class="flex items-center gap-2 ${unlocked ? 'text-amber-800' : 'text-slate-400'}">
          <span class="${unlocked ? '' : 'grayscale opacity-50'}">${u.icon}</span>
          <span class="${unlocked ? 'font-medium' : 'line-through'}">${u.name}</span>
          ${unlocked ? `<span class="ml-auto text-[9px] text-amber-600">${u.desc}</span>` : ''}
        </div>
      `;
    }).join('');
  }
  
  toggleUnlocksPanel() {
    const list = document.getElementById('unlocksList');
    if (list) {
      list.classList.toggle('hidden');
    }
  }
  
  // === INTERESTING FAILURE STATES ===
  
  checkForCrisis() {
    const runway = this.metrics.burn > 0 ? this.metrics.cash / this.metrics.burn : 99;
    
    // Runway crisis: 0-1 quarters left
    if (runway <= 1 && !this.failureState) {
      this.failureState = 'runway_crisis';
      this.showCrisisModal();
      return true;
    }
    
    return false;
  }
  
  showCrisisModal() {
    const runway = this.metrics.burn > 0 ? Math.max(0, this.metrics.cash / this.metrics.burn).toFixed(1) : 0;
    const region = getRegion();
    
    // Calculate crisis options dynamically
    const bridgeTerms = Math.min(25, 15 + Math.floor(Math.random() * 10)); // 15-25% dilution
    const layoffSavings = Math.min(this.hiredStaff.length, 2) * 25; // Â£25k per person
    
    const modalHTML = `
      <div id="crisisModal" class="fixed inset-0 bg-red-900/95 flex items-center justify-center z-[75] p-4">
        <div class="bg-white rounded-2xl max-w-lg w-full overflow-hidden shadow-2xl">
          <div class="bg-gradient-to-r from-red-600 to-red-700 p-6 text-white text-center">
            <div class="text-5xl mb-3">ğŸš¨</div>
            <h2 class="text-2xl font-bold mb-2">RUNWAY CRISIS</h2>
            <p class="text-red-100">Your company has ${runway} quarters of cash remaining.</p>
          </div>
          
          <div class="p-6">
            <p class="text-slate-700 mb-4 text-center">
              This isn't the end. Every startup faces moments like this. 
              <strong>How will you respond?</strong>
            </p>
            
            <div class="space-y-3">
              <!-- Bridge Round -->
              <button onclick="game.resolveCrisis('bridge')" class="w-full p-4 border-2 border-amber-300 rounded-xl text-left hover:bg-amber-50 transition-all">
                <div class="flex items-start gap-3">
                  <span class="text-2xl">ğŸ’¸</span>
                  <div>
                    <div class="font-bold text-slate-800">Emergency Bridge Round</div>
                    <p class="text-sm text-slate-600 mb-2">Existing investors bail you out on tough terms.</p>
                    <div class="flex flex-wrap gap-2 text-xs">
                      <span class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded">+${region.currency}150k cash</span>
                      <span class="bg-red-100 text-red-700 px-2 py-1 rounded">âˆ’${bridgeTerms}% equity</span>
                      <span class="bg-amber-100 text-amber-700 px-2 py-1 rounded">Investor mood âˆ’1</span>
                    </div>
                  </div>
                </div>
              </button>
              
              <!-- Emergency Layoffs -->
              <button onclick="game.resolveCrisis('layoffs')" class="w-full p-4 border-2 border-slate-300 rounded-xl text-left hover:bg-slate-50 transition-all ${this.hiredStaff.length === 0 ? 'opacity-50 cursor-not-allowed' : ''}" ${this.hiredStaff.length === 0 ? 'disabled' : ''}>
                <div class="flex items-start gap-3">
                  <span class="text-2xl">âœ‚ï¸</span>
                  <div>
                    <div class="font-bold text-slate-800">Emergency Layoffs</div>
                    <p class="text-sm text-slate-600 mb-2">Cut staff to extend runway. ${this.hiredStaff.length === 0 ? '(No staff to lay off)' : ''}</p>
                    <div class="flex flex-wrap gap-2 text-xs">
                      <span class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded">âˆ’${region.currency}${layoffSavings}k/q burn</span>
                      <span class="bg-red-100 text-red-700 px-2 py-1 rounded">âˆ’2 team morale</span>
                      <span class="bg-amber-100 text-amber-700 px-2 py-1 rounded">Reputation hit</span>
                    </div>
                  </div>
                </div>
              </button>
              
              <!-- Pivot -->
              <button onclick="game.resolveCrisis('pivot')" class="w-full p-4 border-2 border-violet-300 rounded-xl text-left hover:bg-violet-50 transition-all">
                <div class="flex items-start gap-3">
                  <span class="text-2xl">ğŸ”„</span>
                  <div>
                    <div class="font-bold text-slate-800">Desperate Pivot</div>
                    <p class="text-sm text-slate-600 mb-2">Abandon current strategy for something with faster revenue.</p>
                    <div class="flex flex-wrap gap-2 text-xs">
                      <span class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded">+${region.currency}100k emergency grant</span>
                      <span class="bg-red-100 text-red-700 px-2 py-1 rounded">Reset progress 50%</span>
                      <span class="bg-violet-100 text-violet-700 px-2 py-1 rounded">New milestone path</span>
                    </div>
                  </div>
                </div>
              </button>
              
              <!-- Give Up -->
              <button onclick="game.resolveCrisis('shutdown')" class="w-full p-3 border border-slate-200 rounded-lg text-center text-slate-500 hover:bg-slate-100 transition-all text-sm">
                Accept defeat and wind down the company
              </button>
            </div>
          </div>
        </div>
      </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    soundManager.playBankruptcyWarning?.() || soundManager.playLowRunway?.();
  }
  
  resolveCrisis(choice) {
    const modal = document.getElementById('crisisModal');
    if (modal) modal.remove();
    
    const region = getRegion();
    
    switch(choice) {
      case 'bridge':
        // Emergency bridge round
        const dilution = Math.min(25, 15 + Math.floor(Math.random() * 10));
        this.metrics.cash += 150;
        this.metrics.equity -= dilution;
        this.investorRelationship = Math.max(0, this.investorRelationship - 1);
        
        this.addLog(`ğŸ†˜ Emergency bridge: +${region.currency}150k, âˆ’${dilution}% equity`);
        UIEffects.showToast(`Bridge round closed: âˆ’${dilution}% equity`, 'bad', 'ğŸ’¸');
        
        this.journeyEvents.push({
          turn: this.turn,
          type: 'crisis_bridge',
          desc: `Survived runway crisis with emergency bridge round (${dilution}% dilution)`
        });
        break;
        
      case 'layoffs':
        // Emergency layoffs
        const toLayoff = Math.min(this.hiredStaff.length, 2);
        for (let i = 0; i < toLayoff; i++) {
          if (this.hiredStaff.length > 0) {
            this.hiredStaff.pop();
          }
        }
        this.metrics.burn = Math.max(25, this.metrics.burn - (toLayoff * 25));
        
        // Morale hit across all departments
        Object.keys(this.moods).forEach(d => {
          this.moods[d] = Math.max(-2, this.moods[d] - 2);
        });
        
        this.addLog(`âœ‚ï¸ Emergency layoffs: ${toLayoff} staff let go, burn reduced`);
        UIEffects.showToast(`${toLayoff} staff laid off`, 'bad', 'âœ‚ï¸');
        
        this.journeyEvents.push({
          turn: this.turn,
          type: 'crisis_layoffs',
          desc: `Survived runway crisis with emergency layoffs (${toLayoff} staff)`
        });
        break;
        
      case 'pivot':
        // Desperate pivot - partial reset but survives
        this.metrics.cash += 100; // Emergency grant/funding
        this.metrics.sci = Math.max(15, Math.floor(this.metrics.sci * 0.5));
        this.metrics.dev = Math.max(15, Math.floor(this.metrics.dev * 0.5));
        this.metrics.mkt = Math.max(15, Math.floor(this.metrics.mkt * 0.5));
        this.milestoneProgress = Math.floor(this.milestoneProgress * 0.3);
        
        this.addLog(`ğŸ”„ Desperate pivot: progress reset, +${region.currency}100k grant`);
        UIEffects.showToast('Pivoted to survive - progress reset', 'neutral', 'ğŸ”„');
        
        this.journeyEvents.push({
          turn: this.turn,
          type: 'crisis_pivot',
          desc: 'Survived runway crisis with desperate pivot (50% progress reset)'
        });
        break;
        
      case 'shutdown':
        // Game over
        this.failureState = 'shutdown';
        this.endGame('bankrupt');
        return;
    }
    
    // Clear crisis state and continue
    this.failureState = null;
    this.update();
    this.renderStrategicFocus();
    this.renderExecRow();
    this.renderDecision();
  }

  renderExecRow() {
    const domains = this.team.hr ? ["research", "dev", "marketing", "hr"] : ["research", "dev", "marketing"];
    const colors = { research: "emerald", dev: "sky", marketing: "fuchsia", hr: "amber" };
    const labels = { research: "Research", dev: "Product", marketing: "Sales & Mktg", hr: "People" };
    const emojis = { research: "ğŸ”¬", dev: "ğŸ’»", marketing: "ğŸ“£", hr: "ğŸ‘¥" };
    
    document.getElementById("execRow").innerHTML = domains.map(d => {
      const exec = this.team[d];
      if (!exec) return "";
      const active = this.currentDomain === d;
      const choice = this.choices[d];
      const done = choice !== undefined;
      const passed = choice === -1;
      const mood = this.moods[d];
      const moodClass = this.extremeMode ? "mood-neutral" : (mood >= 2 ? "mood-happy" : mood >= 0 ? "mood-neutral" : mood >= -1 ? "mood-frustrated" : "mood-upset");
      const moodEmoji = this.extremeMode ? "ğŸ”¥" : (mood >= 2 ? "ğŸ˜Š" : mood >= 0 ? "ğŸ˜" : mood >= -1 ? "ğŸ˜Ÿ" : "ğŸ˜ ");
      const color = colors[d];
      
      return `
        <button onclick="game.selectDomain('${d}')" class="p-3 rounded-xl text-center transition-all ${active ? 'bg-'+color+'-50 ring-2 ring-'+color+'-500' : 'hover:bg-slate-50'}">
          <div class="exec-portrait mx-auto mb-2 relative ${moodClass} border-2 border-${color}-400">
            <div class="mood-ring"></div>
            ${renderAvatar(exec.avatar, exec.name)}
          </div>
          <div class="text-sm font-medium text-slate-800">${exec.name.split(" ").pop()}</div>
          <div class="text-xs text-${color}-600">${emojis[d]} ${labels[d]}</div>
          <div class="flex justify-center gap-1 mt-1">
            <span title="${this.extremeMode ? 'Mood hidden in Extreme Mode' : ''}">${moodEmoji}</span>
            ${passed ? '<span class="text-slate-400">â­</span>' : done ? '<span class="text-emerald-500">âœ“</span>' : ''}
          </div>
        </button>
      `;
    }).join("");
  }

  renderDecision() {
    const d = this.currentDomain;
    const exec = this.team[d];
    const eventData = this.currentEvents[d];
    const event = eventData?.event;
    const container = document.getElementById("decisionArea");
    
    if (!exec || !event) {
      container.innerHTML = `<div class="flex items-center justify-center h-full text-slate-400">No decision pending</div>`;
      return;
    }
    
    // === HASTY DECISION: Record when this event was shown ===
    // Only reset timestamp if we're switching to a new domain
    if (this.decisionTiming.currentDomain !== d) {
      this.decisionTiming.currentEventShownAt = Date.now();
      this.decisionTiming.currentDomain = d;
    }

    const colors = { research: "emerald", dev: "sky", marketing: "fuchsia", hr: "amber" };
    const colorHex = { research: "#10b981", dev: "#0ea5e9", marketing: "#d946ef", hr: "#f59e0b" };
    const labels = { research: "Research", dev: "Product", marketing: "Sales & Marketing", hr: "People" };
    const emojis = { research: "ğŸ”¬", dev: "ğŸ’»", marketing: "ğŸ“£", hr: "ğŸ‘¥" };
    const color = colors[d];
    const selected = this.choices[d];
    
    // Check for investor conflicts on this domain
    const domainAdvices = this.funderAdvices.filter(a => a.domain === d);
    const uniqueChoices = [...new Set(domainAdvices.map(a => a.recommendedChoice))];
    const hasConflict = uniqueChoices.length > 1;
    
    // Show/hide conflict warning
    document.getElementById("conflictWarning").classList.toggle("hidden", !hasConflict);

    container.innerHTML = `
      <!-- Event Header -->
      <div class="bg-gradient-to-r from-${color}-500 to-${color}-600 p-4 text-white">
        <div class="flex items-center gap-2 text-${color}-100 text-sm mb-1">
          <span>${emojis[d]} ${labels[d].toUpperCase()} DECISION</span>
          <span>â€¢</span>
          <span>Q${this.quarter} Year ${this.year}</span>
        </div>
        <h3 class="text-xl font-bold">${event.title || this.generateEventTitle(event, d)}</h3>
      </div>
      
      <!-- Executive presenting the situation -->
      <div class="p-4 border-b border-slate-100">
        <div class="flex items-start gap-4">
          <div class="exec-portrait-lg border-4 border-${color}-200 flex-shrink-0">
            ${renderAvatar(exec.avatar, exec.name)}
          </div>
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-1">
              <span class="font-bold text-slate-800">${exec.name}</span>
              <span class="text-xs bg-${color}-100 text-${color}-700 px-2 py-0.5 rounded-full">${exec.title}</span>
            </div>
            <div class="bg-slate-50 rounded-lg p-3 border-l-4 border-${color}-400">
              <p class="text-slate-700">"${localizeText(event.intro)}"</p>
              <p class="text-slate-500 text-sm mt-2 italic">"${localizeText(event.aside)}"</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Choices with integrated advisor opinions -->
      <div class="p-4">
        <h4 class="text-sm font-bold text-slate-500 uppercase tracking-wide mb-3">Your Options</h4>
        
        <div class="space-y-4">
          ${event.choices
            .map((c, i) => ({ choice: c, originalIndex: i }))
            .sort((a, b) => (b.choice.ap || 0) - (a.choice.ap || 0))
            .map(({ choice: c, originalIndex: i }) => {
            // Find all funders with opinions on this choice
            const supporting = this.funderAdvices.filter(a => a.domain === d && a.recommendedChoice === i);
            const opposing = hasConflict ? this.funderAdvices.filter(a => a.domain === d && a.recommendedChoice !== i) : [];
            const isRecommended = supporting.length > 0;
            const isSelected = selected === i;
            
            // Generate a description for the choice
            const choiceDesc = this.generateChoiceDescription(c, d);
            const impactTagsHtml = this.renderImpactTags(c, d);
            
            return `
            <div class="decision-option border-2 ${isSelected ? 'border-emerald-400 bg-emerald-50/30' : isRecommended ? 'border-amber-300' : 'border-slate-200'} rounded-xl overflow-hidden transition-all hover:border-slate-300" data-choice-index="${i}">
              <!-- Locked badge (shown via CSS when locked-in) -->
              <div class="locked-badge hidden absolute top-2 right-2 bg-emerald-500 text-white text-xs px-2 py-1 rounded-full font-medium z-10">
                âœ“ Locked In
              </div>
              <div class="p-4 bg-white relative">
                <div class="flex items-start gap-3">
                  <div class="w-14 h-12 rounded-lg flex flex-col items-center justify-center ${c.ap >= 4 ? 'bg-red-100 text-red-600' : c.ap >= 3 ? 'bg-amber-100 text-amber-600' : 'bg-emerald-100 text-emerald-600'}">
                    <span class="text-lg font-bold">${c.ap}</span>
                    <span class="text-[10px] font-medium">AP</span>
                  </div>
                  <div class="flex-1">
                    <div class="font-semibold text-slate-800 mb-1">${localizeText(c.text)}</div>
                    ${!this.extremeMode && impactTagsHtml ? `<div class="flex flex-wrap gap-1.5 mb-2">${impactTagsHtml}</div>` : ''}
                    <p class="text-sm text-slate-600 mb-2">${localizeText(choiceDesc)}</p>
                    <div class="flex flex-wrap gap-2 text-xs">
                      <span class="bg-slate-100 text-slate-600 px-2 py-1 rounded">${getRegion().currency}${Math.round(c.cost * getRegion().currencyMultiplier)}k</span>
                      ${!this.extremeMode ? Object.entries(c.eff).map(([k, v]) => {
                        const absV = Math.abs(v);
                        const arrows = absV >= 7 ? (v > 0 ? 'â†‘â†‘â†‘' : 'â†“â†“â†“') : 
                                       absV >= 4 ? (v > 0 ? 'â†‘â†‘' : 'â†“â†“') : 
                                       (v > 0 ? 'â†‘' : 'â†“');
                        return `<span class="${v > 0 ? 'bg-emerald-50 text-emerald-700' : 'bg-red-50 text-red-600'} px-2 py-1 rounded">${arrows} ${this.getStatLabel(k)}</span>`;
                      }).join("") : '<span class="bg-slate-100 text-slate-500 px-2 py-1 rounded">ğŸ”¥ Effects hidden</span>'}
                    </div>
                  </div>
                </div>
              </div>
              
              ${!this.extremeMode && supporting.length > 0 ? `
              <!-- Advisor recommendations -->
              <div class="border-t border-amber-200">
                ${supporting.map(advice => `
                <div class="bg-amber-50 p-3 ${supporting.indexOf(advice) < supporting.length - 1 ? 'border-b border-amber-100' : ''}">
                  <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-amber-300 flex-shrink-0">
                      ${advice.funder?.photo || '<div class="w-full h-full bg-amber-200 flex items-center justify-center">ğŸ’¼</div>'}
                    </div>
                    <div class="flex-1">
                      <div class="flex items-center gap-2 mb-1 flex-wrap">
                        <span class="font-bold text-amber-800 text-sm">${advice.funderName}</span>
                        <span class="text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded-full">${this.getFunderTypeLabel(advice.funderId)}</span>
                        ${hasConflict ? '<span class="text-xs text-emerald-600 font-medium">ğŸ‘ RECOMMENDS</span>' : ''}
                      </div>
                      <p class="text-sm text-amber-900">${advice.text} ${advice.reason ? advice.reason : ''}</p>
                    </div>
                  </div>
                </div>
                `).join('')}
              </div>
              ` : ''}
              
              <div class="p-3 bg-slate-50 border-t">
                <button onclick="game.confirmChoice('${d}', ${i})" class="w-full py-2 px-4 ${isSelected ? 'bg-emerald-500 text-white' : 'bg-white hover:bg-emerald-500 hover:text-white border border-slate-200'} rounded-lg font-medium transition-all">
                  ${isSelected ? 'âœ“ Selected' : 'Choose This Option'}
                </button>
              </div>
            </div>
          `}).join("")}
          
          <!-- Pass Option -->
          <div class="decision-option border-2 border-dashed ${selected === -1 ? 'border-slate-400 bg-slate-100' : 'border-slate-300'} rounded-xl overflow-hidden" data-choice-index="-1">
            <div class="p-4 bg-slate-50">
              <div class="flex items-start gap-3">
                <div class="w-14 h-12 rounded-lg flex flex-col items-center justify-center bg-slate-200 text-slate-500">
                  <span class="text-lg font-bold">0</span>
                  <span class="text-[10px] font-medium">AP</span>
                </div>
                <div class="flex-1">
                  <div class="font-semibold text-slate-600 mb-1">Pass this quarter</div>
                  <p class="text-sm text-slate-500 mb-2">Delay this decision. Your exec will be disappointed and the issue remains unresolved.</p>
                  <div class="flex flex-wrap gap-2 text-xs">
                    <span class="bg-red-50 text-red-600 px-2 py-1 rounded">â†“ Mood</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="p-3 bg-slate-100 border-t border-slate-200">
              <button onclick="game.confirmChoice('${d}', -1)" class="w-full py-2 px-4 ${selected === -1 ? 'bg-slate-500 text-white' : 'bg-white hover:bg-slate-400 hover:text-white border border-slate-300'} rounded-lg font-medium transition-all">
                ${selected === -1 ? 'âœ“ Passing' : 'Skip This Quarter'}
              </button>
            </div>
          </div>
        </div>
      </div>
    `;
  }
  
  generateEventTitle(event, domain) {
    // Generate a descriptive title based on the event intro
    const intro = event.intro.toLowerCase();
    if (intro.includes('research') || intro.includes('science')) return 'Advancing Research Capabilities';
    if (intro.includes('product') || intro.includes('feature')) return 'Product Development Decision';
    if (intro.includes('market') || intro.includes('sales')) return 'Market Expansion Strategy';
    if (intro.includes('team') || intro.includes('hire')) return 'Team Growth Decision';
    if (intro.includes('partner')) return 'Strategic Partnership Opportunity';
    if (intro.includes('customer')) return 'Customer Acquisition Strategy';
    if (intro.includes('cost') || intro.includes('budget')) return 'Resource Allocation';
    return 'Strategic Decision Required';
  }
  
  generateChoiceDescription(choice, domain) {
    // Generate a fuller description for the choice based on its effects and text
    const text = choice.text.toLowerCase();
    const effects = choice.eff || {};
    
    // Check for key themes in the choice text
    if (text.includes('university') || text.includes('academic')) {
      return 'Establish a collaboration for shared expertise and credibility. Lower cost but results take time to materialize.';
    }
    if (text.includes('hire') || text.includes('recruit')) {
      return 'Bring in dedicated talent with full-time commitment. Higher ongoing costs but direct control over output.';
    }
    if (text.includes('acquire') || text.includes('buy')) {
      return 'Instant capability boost through acquisition. Expensive and integration will be challenging.';
    }
    if (text.includes('partner') && !text.includes('university')) {
      return 'Strategic partnership to accelerate progress. Shared upside but also shared control.';
    }
    if (text.includes('outsource') || text.includes('contractor')) {
      return 'Flexible external resources. Quick to deploy but less institutional knowledge.';
    }
    if (text.includes('train') || text.includes('develop')) {
      return 'Invest in your existing team. Slower but builds long-term capability and loyalty.';
    }
    if (text.includes('aggressive') || text.includes('bold')) {
      return 'High-risk, high-reward approach. Could accelerate progress dramatically or backfire.';
    }
    if (text.includes('conservative') || text.includes('careful')) {
      return 'Measured approach that minimizes risk. Steady progress without major surprises.';
    }
    
    // Default based on AP cost
    if (choice.ap >= 4) {
      return 'A significant commitment that could substantially move the needle. Make sure the timing is right.';
    } else if (choice.ap >= 3) {
      return 'A solid investment of resources. Should deliver meaningful progress.';
    } else {
      return 'A modest step forward. Low risk, incremental progress.';
    }
  }
  
  getStatLabel(stat) {
    const labels = { sci: 'Research', dev: 'Product', mkt: 'Sales', hr: 'People', burn: 'Burn', val: 'Valuation', cash: 'Cash', equity: 'Equity' };
    return labels[stat] || stat;
  }
  
  // Generate readable impact tags for a choice
  generateImpactTags(choice, domain) {
    const tags = [];
    const eff = choice.eff || {};
    const text = (choice.text || '').toLowerCase();
    const ap = choice.ap || 0;
    const cost = choice.cost || 0;
    
    // Speed vs Quality tradeoff
    if (ap >= 4 || text.includes('aggressive') || text.includes('rush') || text.includes('fast')) {
      tags.push({ label: '+Speed', type: 'positive', icon: 'âš¡' });
    }
    if (text.includes('careful') || text.includes('thorough') || text.includes('comprehensive')) {
      tags.push({ label: '+Quality', type: 'positive', icon: 'âœ¨' });
    }
    
    // Credibility
    if (text.includes('university') || text.includes('academic') || text.includes('publish') || text.includes('paper')) {
      tags.push({ label: '+Credibility', type: 'positive', icon: 'ğŸ“' });
    }
    if (text.includes('partner') || text.includes('enterprise') || text.includes('established')) {
      tags.push({ label: '+Credibility', type: 'positive', icon: 'ğŸ¤' });
    }
    
    // Revenue potential
    if (eff.mkt >= 4 || text.includes('sales') || text.includes('customer') || text.includes('revenue')) {
      tags.push({ label: '+Revenue', type: 'positive', icon: 'ğŸ’°' });
    }
    if (text.includes('pricing') || text.includes('monetize') || text.includes('commercial')) {
      tags.push({ label: 'Revenue Next Q', type: 'neutral', icon: 'ğŸ“ˆ' });
    }
    
    // Risk indicators
    if (ap >= 4 || text.includes('risky') || text.includes('gamble') || text.includes('bet')) {
      tags.push({ label: 'High Risk', type: 'warning', icon: 'ğŸ²' });
    }
    if (text.includes('aggressive') || text.includes('bold') || text.includes('ambitious')) {
      tags.push({ label: 'Volatile', type: 'warning', icon: 'ğŸ“Š' });
    }
    
    // Cost impacts
    if (cost >= 40 || (eff.burn && eff.burn > 0)) {
      tags.push({ label: 'âˆ’Runway', type: 'negative', icon: 'â±ï¸' });
    }
    if (cost <= 10 && ap <= 2) {
      tags.push({ label: 'Low Cost', type: 'positive', icon: 'ğŸ’š' });
    }
    
    // Cash effects (one-time money impacts)
    if (eff.cash && eff.cash > 0) {
      if (eff.cash >= 50) {
        tags.push({ label: '+Funding', type: 'positive', icon: 'ğŸ’°' });
      } else {
        tags.push({ label: '+Cash', type: 'positive', icon: 'ğŸ’µ' });
      }
    }
    if (eff.cash && eff.cash < 0) {
      if (eff.cash <= -40) {
        tags.push({ label: 'High Fees', type: 'negative', icon: 'ğŸ’¸' });
      } else {
        tags.push({ label: 'Fees', type: 'warning', icon: 'ğŸ“‹' });
      }
    }
    
    // Team impacts
    if (eff.hr >= 3 || text.includes('team') || text.includes('culture') || text.includes('morale')) {
      tags.push({ label: '+Team', type: 'positive', icon: 'ğŸ‘¥' });
    }
    if (eff.hr <= -2 || text.includes('layoff') || text.includes('fire') || text.includes('cut')) {
      tags.push({ label: 'âˆ’Morale', type: 'negative', icon: 'ğŸ˜”' });
    }
    
    // Long-term vs short-term
    if (text.includes('foundation') || text.includes('invest') || text.includes('build') || text.includes('develop')) {
      tags.push({ label: 'Long Game', type: 'neutral', icon: 'ğŸŒ±' });
    }
    if (text.includes('quick') || text.includes('immediate') || text.includes('now')) {
      tags.push({ label: 'Quick Win', type: 'positive', icon: 'ğŸ¯' });
    }
    
    // Domain-specific tags
    if (domain === 'research' && eff.sci >= 4) {
      tags.push({ label: '+Innovation', type: 'positive', icon: 'ğŸ”¬' });
    }
    if (domain === 'dev' && eff.dev >= 4) {
      tags.push({ label: '+Product', type: 'positive', icon: 'ğŸ› ï¸' });
    }
    
    // Limit to 3 most relevant tags
    return tags.slice(0, 3);
  }
  
  // Render impact tags as HTML
  renderImpactTags(choice, domain) {
    const tags = this.generateImpactTags(choice, domain);
    if (tags.length === 0) return '';
    
    return tags.map(tag => {
      let bgClass, textClass;
      switch(tag.type) {
        case 'positive':
          bgClass = 'bg-emerald-100';
          textClass = 'text-emerald-700';
          break;
        case 'negative':
          bgClass = 'bg-red-100';
          textClass = 'text-red-700';
          break;
        case 'warning':
          bgClass = 'bg-amber-100';
          textClass = 'text-amber-700';
          break;
        default:
          bgClass = 'bg-slate-100';
          textClass = 'text-slate-600';
      }
      return `<span class="${bgClass} ${textClass} px-2 py-0.5 rounded-full text-[10px] font-medium">${tag.icon} ${tag.label}</span>`;
    }).join('');
  }
  
  // Format currency based on active region
  formatCash(amount) {
    const region = getRegion();
    const converted = Math.round(amount * region.currencyMultiplier);
    return `${region.currency}${converted}k`;
  }
  
  getFunderTypeLabel(funderId) {
    const labels = {
      dragon: "Dragon's Den",
      techAngel: "Tech Angel",
      operatorAngel: "Operator Angel", 
      sectorVC: "Sector VC",
      growthVC: "Growth VC",
      impactVC: "Impact VC",
      tier1VC: "Tier 1 VC",
      corporateVC: "Corporate VC"
    };
    return labels[funderId] || "Investor";
  }

  selectDomain(d) {
    this.currentDomain = d;
    this.renderExecRow();
    this.renderDecision();
  }

  confirmChoice(d, i) {
    const isFirstChoice = Object.keys(this.choices).length === 0;
    
    // === SELECTION MICRO-ANIMATION ===
    // Animate the selection before re-rendering
    const allOptions = document.querySelectorAll('#decisionArea .decision-option');
    const selectedOption = document.querySelector(`#decisionArea .decision-option[data-choice-index="${i}"]`);
    
    if (selectedOption && allOptions.length > 0) {
      UIEffects.animateSelection(selectedOption, allOptions);
    }
    
    // === HASTY DECISION CHECK ===
    const hastyResult = this.checkHastyDecision(d, i);
    
    this.choices[d] = i;
    
    // Store hasty flag on this choice for later processing in commitTurn
    if (hastyResult.isHashy) {
      if (!this.decisionTiming.hastyChoicesThisQuarter.includes(d)) {
        this.decisionTiming.hastyChoicesThisQuarter.push(d);
      }
    }
    
    // Slight delay before re-render to let animation complete
    setTimeout(() => {
      this.renderAPPips();
      this.renderExecRow();
      this.renderDecision();
    }, 80);
    
    // Play department-specific sound
    if (d === 'research') soundManager.playResearch();
    else if (d === 'dev') soundManager.playProduct();
    else if (d === 'marketing') soundManager.playSales();
    else if (d === 'hr') soundManager.playHR();
    
    // Auto-advance to next department that doesn't have a choice yet
    const domains = this.team.hr ? ["research", "dev", "marketing", "hr"] : ["research", "dev", "marketing"];
    const currentIndex = domains.indexOf(d);
    
    // Find the next department without a choice
    let nextDomain = null;
    for (let offset = 1; offset <= domains.length; offset++) {
      const checkIndex = (currentIndex + offset) % domains.length;
      const checkDomain = domains[checkIndex];
      if (this.choices[checkDomain] === undefined) {
        nextDomain = checkDomain;
        break;
      }
    }
    
    // If found an unchosen domain, switch to it after a brief delay
    if (nextDomain) {
      setTimeout(() => {
        this.currentDomain = nextDomain;
        this.renderExecRow();
        this.renderDecision();
      }, 150);
    }
    
    // Trigger mini-game after first choice (one per milestone)
    // M1: Conference, M2: Pitch, M3: Demo Day
    if (isFirstChoice) {
      const currentMilestoneNum = this.completedMilestones.length + 1;
      if (currentMilestoneNum > this.lastConferenceMilestone) {
        this.lastConferenceMilestone = currentMilestoneNum;
        // Small delay so the choice registers visually first, then show intro
        if (currentMilestoneNum === 1) {
          setTimeout(() => this.showMiniGameIntro("conference"), 300);
        } else if (currentMilestoneNum === 2) {
          setTimeout(() => this.showMiniGameIntro("pitch"), 300);
        } else if (currentMilestoneNum === 3) {
          setTimeout(() => this.showMiniGameIntro("demoday"), 300);
        }
      }
    }
  }
  
  // === HASTY DECISION SYSTEM ===
  
  checkHastyDecision(domain, choiceIndex) {
    const result = { isHashy: false, timeSpent: 0, minTime: 0 };
    
    // Don't check if no timestamp (shouldn't happen)
    if (!this.decisionTiming.currentEventShownAt) {
      return result;
    }
    
    const now = Date.now();
    const timeSpent = (now - this.decisionTiming.currentEventShownAt) / 1000; // in seconds
    result.timeSpent = timeSpent;
    
    // Determine minimum time based on event complexity
    const eventData = this.currentEvents[domain];
    const event = eventData?.event;
    const minTime = this.getMinDecisionTime(event);
    result.minTime = minTime;
    
    // Check if this is a pass (always allowed to be quick)
    if (choiceIndex === -1) {
      return result;
    }
    
    // Check for hasty decision
    if (timeSpent < minTime) {
      result.isHashy = true;
      this.processHastyDecision(domain, timeSpent, minTime);
    } else if (timeSpent >= minTime * 2) {
      // Thoughtful decision bonus (took at least 2x minimum time)
      this.processThoughtfulDecision(domain, timeSpent);
    }
    
    return result;
  }
  
  getMinDecisionTime(event) {
    if (!event) return 4;
    
    // Calculate complexity based on intro length and number of options
    const introLength = (event.intro || '').length;
    const optionCount = event.options?.length || event.choices?.length || 3;
    
    // Simple: short intro (<100 chars) and few options
    if (introLength < 100 && optionCount <= 2) {
      return 3;
    }
    
    // Complex: long intro (>200 chars) or many options
    if (introLength > 200 || optionCount >= 4) {
      return 6;
    }
    
    // Normal
    return 4;
  }
  
  processHastyDecision(domain, timeSpent, minTime) {
    const exec = this.team[domain];
    const execName = exec?.name?.split(" ").pop() || "Your advisor";
    
    // Increment counters
    this.decisionTiming.hastyDecisionsThisQuarter++;
    this.decisionTiming.hastyDecisionsTotal++;
    
    // Mood penalty
    if (this.moods[domain] !== undefined) {
      this.moods[domain] = Math.max(-3, this.moods[domain] - 0.5);
    }
    
    // Varied feedback messages
    const messages = [
      `âš¡ ${execName} raises an eyebrow at your quick decision.`,
      `âš¡ That was fast... ${execName} barely finished explaining.`,
      `âš¡ Hasty call. Your team scrambles to execute.`,
      `âš¡ Speed over strategy? ${execName} looks unconvinced.`,
      `âš¡ ${execName}: "Wait, are you sure? We just started discussing this..."`,
      `âš¡ Rapid-fire decision. ${execName} sighs quietly.`
    ];
    const message = messages[Math.floor(Math.random() * messages.length)];
    this.log(message);
    
    // Show toast feedback
    this.showHastyDecisionToast(execName);
    
    // Check for "Rushed Leadership" event trigger
    if (this.decisionTiming.hastyDecisionsTotal >= 5 && !this.decisionTiming.rushedLeadershipTriggered) {
      // Trigger on next quarter
      this.decisionTiming.triggerRushedLeadership = true;
    }
    
    // Warning for multiple hasty decisions this quarter
    if (this.decisionTiming.hastyDecisionsThisQuarter >= 2) {
      this.log("âš ï¸ Your team is struggling to keep up with rapid decisions.");
    }
  }
  
  processThoughtfulDecision(domain, timeSpent) {
    const exec = this.team[domain];
    const execName = exec?.name?.split(" ").pop() || "Your advisor";
    
    // Increment thoughtful counter
    this.decisionTiming.thoughtfulDecisionsTotal++;
    
    // Small mood bonus (not every time, ~30% chance)
    if (Math.random() < 0.3 && this.moods[domain] !== undefined) {
      this.moods[domain] = Math.min(3, this.moods[domain] + 0.25);
      this.log(`ğŸ’­ ${execName} appreciates your thoughtful consideration.`);
    }
  }
  
  showHastyDecisionToast(execName) {
    // CONSOLIDATED: Use inline visual feedback instead of toast popup
    // Flash the decision area briefly with amber color
    const decisionArea = document.getElementById("decisionArea");
    if (decisionArea) {
      // Add flash effect
      const originalBg = decisionArea.style.backgroundColor;
      decisionArea.style.transition = "background-color 0.2s ease-in-out";
      decisionArea.style.backgroundColor = "rgba(251, 191, 36, 0.3)"; // amber-400 with transparency
      
      setTimeout(() => {
        decisionArea.style.backgroundColor = "rgba(251, 191, 36, 0.1)";
        setTimeout(() => {
          decisionArea.style.backgroundColor = originalBg || "";
          decisionArea.style.transition = "";
        }, 200);
      }, 200);
    }
    
    // Small inline indicator appears on the exec row (optional enhancement)
    // The log message is the primary feedback now
  }
  
  triggerRushedLeadershipEvent() {
    if (this.decisionTiming.rushedLeadershipTriggered) return;
    this.decisionTiming.rushedLeadershipTriggered = true;
    
    // Apply effect: -1 to all exec moods, -1 HR
    const domains = ["research", "dev", "marketing"];
    if (this.team.hr) domains.push("hr");
    domains.forEach(d => {
      if (this.moods[d] !== undefined) {
        this.moods[d] = Math.max(-3, this.moods[d] - 1);
      }
    });
    this.metrics.hr = Math.max(0, this.metrics.hr - 1);
    
    // Show event modal
    const event = {
      icon: "âš¡",
      title: "Rushed Leadership",
      message: "Your rapid-fire decision style is creating whiplash across the organization. Team members are executing before fully understanding the plan, leading to rework, frustration, and declining morale.",
      effectText: "All exec moods âˆ’1, âˆ’1 People"
    };
    
    this.showStrategicDriftModal(event);
    this.log("âš ï¸ Rushed Leadership: Your hasty decision pattern is hurting team morale.");
  }
  
  // Reset hasty tracking at start of quarter
  resetQuarterlyHastyTracking() {
    this.decisionTiming.hastyDecisionsThisQuarter = 0;
    this.decisionTiming.hastyChoicesThisQuarter = [];
    
    // Check if we need to trigger Rushed Leadership event
    if (this.decisionTiming.triggerRushedLeadership) {
      this.decisionTiming.triggerRushedLeadership = false;
      setTimeout(() => this.triggerRushedLeadershipEvent(), 500);
    }
  }
  
  // Get hasty multiplier for a specific domain's choice
  getHastyMultiplier(domain) {
    if (this.decisionTiming.hastyChoicesThisQuarter.includes(domain)) {
      return 0.85; // 15% reduction
    }
    return 1.0;
  }

  // Keep selectChoice for backward compatibility but just highlight
  selectChoice(d, i) {
    // Just re-render to show preview, don't confirm
    this.renderDecision();
  }

  getUsedAP() {
    let ap = 0;
    Object.entries(this.choices).forEach(([d, i]) => {
      if (i === -1) return; // Pass costs 0 AP
      const eventData = this.currentEvents[d];
      if (eventData?.event) ap += eventData.event.choices[i].ap;
    });
    // Count hires THIS quarter directly from hiredStaff array
    // Each hire costs 1 AP
    const hiresThisQuarter = (this.hiredStaff || []).filter(s => s.hiredTurn === this.turn).length;
    ap += hiresThisQuarter;
    return ap;
  }
  
  getTotalAP() {
    // Total available = base AP + banked AP + staff bonus - integration penalty - funding cost + life event mod
    const staffBonus = this.getStaffAPBonus();
    const fundingCost = this.fundingAPCost || 0;
    const lifeEventMod = this.lifeEventAPMod || 0;
    return this.maxAP + this.bankedAP + staffBonus - this.staffAPPenalty - fundingCost + lifeEventMod;
  }
  
  getStaffAPBonus() {
    // Staff AP bonus: based on hires above starting team
    // 1st hire = +1 AP, encouraging early investment in team
    const currentStaff = this.metrics?.staff || 0;
    const startingStaff = this.startingStaff || 0;
    const hiredStaff = Math.max(0, currentStaff - startingStaff - (this.integratingStaff || 0));
    
    if (hiredStaff >= 5) return 3;
    if (hiredStaff >= 3) return 2;
    if (hiredStaff >= 1) return 1;
    return 0;
  }
  
  // ===== REVENUE SYSTEM =====
  // Tracks customers, revenue, and sales projections tied to business model
  
  initializeRevenueModel() {
    if (!this.company?.revenueModel) return;
    this.revenueModel = REVENUE_MODELS[this.company.revenueModel];
    this.customers = [];
    this.pipeline = [];
    this.grantApplications = [];
    this.quarterlyRevenue = 0;
    this.quarterlySupportCosts = 0;
    
    this.log(`ğŸ“Š Business model: ${this.revenueModel.name}`);
  }
  
  addCustomer(customerData) {
    const model = this.revenueModel;
    if (!model) return null;
    
    const customer = {
      id: `cust_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,
      name: customerData.name || this.generateCustomerName(),
      type: customerData.type || 'standard',
      quarterlyRevenue: customerData.revenue || model.metrics.avgRevenuePerCustomer,
      supportCost: customerData.supportCost || model.metrics.supportCostPerCustomer,
      acquiredQuarter: this.turn,
      contractLength: customerData.contractLength || null,
      satisfaction: customerData.satisfaction || 0.7,
      strategic: customerData.strategic || false,
      notes: customerData.notes || ''
    };
    
    this.customers.push(customer);
    this.log(`ğŸ¤ New customer: ${customer.name} (+Â£${customer.quarterlyRevenue}k/q)`);
    
    this.journeyEvents.push({
      quarter: this.turn,
      type: 'customer_acquired',
      description: `Acquired customer: ${customer.name} (Â£${customer.quarterlyRevenue}k/quarter)`,
      customerName: customer.name,
      revenue: customer.quarterlyRevenue
    });
    
    return customer;
  }
  
  generateCustomerName() {
    const model = this.revenueModel;
    if (!model) return "Customer";
    
    const names = {
      b2bSaas: [
        "Meridian Partners", "Ashford Holdings", "Sterling Analytics",
        "Catalyst Group", "Pinnacle Systems", "Horizon Consulting",
        "Vantage Corp", "Nexus Industries", "Apex Solutions", "Quantum Dynamics",
        "Brightwell Capital", "Northgate Industries", "Crestview Holdings",
        "Evergreen Partners", "Summit Dynamics", "Clearwater Systems"
      ],
      healthcareProcurement: [
        "NHS Greater Manchester", "Barts Health Trust", "Guy's & St Thomas'",
        "Imperial College Healthcare", "Oxford University Hospitals",
        "Cambridge University Hospitals", "NHS Digital", "NICE Collaboration",
        "King's College Hospital", "Royal Free London", "Leeds Teaching Hospitals"
      ],
      consumer: [
        `Subscriber Cohort Q${this.turn}`, `User Wave ${this.customers.length + 1}`,
        `Growth Cohort ${this.turn}`, `Acquisition Batch ${this.customers.length + 1}`
      ],
      researchGrants: [
        "UKRI Innovation Grant", "Innovate UK Award", "Horizon Europe Grant",
        "Wellcome Trust Fellowship", "EPSRC Programme", "Royal Society Grant",
        "NIHR Research Grant", "MRC Discovery Award", "BBSRC Partnership"
      ],
      platformAPI: [
        "DevStudio Pro", "CodeCraft Ltd", "BuilderHQ", "TechSmith Solutions",
        "Integrator Systems", "API Partners", "CloudNative Inc", "DataFlow Labs",
        "Synapse Tech", "NeuralStack", "Bytewise Solutions"
      ]
    };
    
    const pool = names[model.id] || names.b2bSaas;
    const usedNames = this.customers.map(c => c.name);
    const available = pool.filter(n => !usedNames.includes(n));
    
    if (available.length > 0) {
      return available[Math.floor(Math.random() * available.length)];
    }
    return `Client ${this.customers.length + 1}`;
  }
  
  calculateStaffRevenueEffects() {
    const model = this.revenueModel;
    if (!model) return { leadsGenerated: 0, conversionBonus: 0, churnReduction: 0, satisfactionBonus: 0, dealSizeBonus: 0, supportEfficiency: 0 };
    
    const effects = model.staffEffects;
    let results = {
      leadsGenerated: 0,
      conversionBonus: 0,
      churnReduction: 0,
      satisfactionBonus: 0,
      dealSizeBonus: 0,
      supportEfficiency: 0
    };
    
    // Count staff by department
    const staffCounts = { research: 0, dev: 0, marketing: 0, hr: 0 };
    (this.hiredStaff || []).forEach(staff => {
      if (staff.department && staffCounts[staff.department] !== undefined) {
        staffCounts[staff.department]++;
      }
    });
    
    // Apply effects from each department
    Object.entries(effects).forEach(([dept, deptEffects]) => {
      const count = staffCounts[dept] || 0;
      if (count === 0) return;
      
      if (deptEffects.leadsPerStaff) results.leadsGenerated += deptEffects.leadsPerStaff * count;
      if (deptEffects.conversionBonus) results.conversionBonus += deptEffects.conversionBonus * count;
      if (deptEffects.churnReduction) results.churnReduction += deptEffects.churnReduction * count;
      if (deptEffects.satisfactionBonus) results.satisfactionBonus += deptEffects.satisfactionBonus * count;
      if (deptEffects.dealSizeBonus) results.dealSizeBonus += deptEffects.dealSizeBonus * count;
      if (deptEffects.supportEfficiency) results.supportEfficiency += deptEffects.supportEfficiency * count;
    });
    
    // Cap effects
    results.churnReduction = Math.min(results.churnReduction, 0.15);
    results.conversionBonus = Math.min(results.conversionBonus, 0.3);
    results.supportEfficiency = Math.min(results.supportEfficiency, 0.4);
    
    // === HIDDEN MODIFIERS: Founder, Location, Funder ===
    // These are subtle bonuses not directly visible to player
    const hidden = this.calculateHiddenRevenueModifiers();
    results.conversionBonus += hidden.conversionBonus;
    results.churnReduction += hidden.churnReduction;
    results.dealSizeBonus += hidden.dealSizeBonus;
    results.satisfactionBonus += hidden.satisfactionBonus;
    
    return results;
  }
  
  // Hidden revenue modifiers from founder profile, location, and funder
  // These are intentionally NOT displayed to player - subtle advantages
  calculateHiddenRevenueModifiers() {
    const modifiers = {
      conversionBonus: 0,
      churnReduction: 0,
      dealSizeBonus: 0,
      satisfactionBonus: 0
    };
    
    // === FOUNDER PROFILE ===
    // Commercial skill affects sales ability
    // Scale: 1 (worst) to 5+ (best), baseline is 2
    if (this.founderBonuses) {
      const commercial = this.founderBonuses.commercial || 2;
      // +2% conversion and -1% churn per point above baseline
      if (commercial > 2) {
        modifiers.conversionBonus += (commercial - 2) * 0.02;
        modifiers.churnReduction += (commercial - 2) * 0.01;
      }
      // Low commercial skill = slight penalty
      if (commercial < 2) {
        modifiers.conversionBonus -= 0.03;
      }
      
      // Leadership helps with enterprise deals
      const leadership = this.founderBonuses.leadership || 2;
      if (leadership > 3) {
        modifiers.dealSizeBonus += (leadership - 3) * 0.03;
      }
    }
    
    // === LOCATION ===
    // Different cities have different customer access
    if (this.location) {
      const locationId = this.location.id;
      
      // Major business centers: better enterprise access
      const enterpriseHubs = ['london', 'manchester', 'birmingham', 'leeds'];
      if (enterpriseHubs.includes(locationId)) {
        modifiers.conversionBonus += 0.03;
      }
      
      // Financial centers: larger deal sizes
      const financialCenters = ['london', 'edinburgh'];
      if (financialCenters.includes(locationId)) {
        modifiers.dealSizeBonus += 0.05;
      }
      
      // Regional locations: stronger customer relationships
      const regionalLocations = ['glasgow', 'cardiff', 'newcastle', 'belfast', 'nottingham'];
      if (regionalLocations.includes(locationId)) {
        modifiers.satisfactionBonus += 0.02;
        modifiers.churnReduction += 0.01;
      }
      
      // Academic hubs: better for grants/research revenue
      const academicHubs = ['oxford', 'cambridge', 'edinburgh'];
      if (academicHubs.includes(locationId) && this.revenueModel?.id === 'researchGrants') {
        modifiers.conversionBonus += 0.05;
      }
      
      // Healthcare hubs: NHS connections
      const healthcareHubs = ['oxford', 'cambridge', 'glasgow', 'manchester'];
      if (healthcareHubs.includes(locationId) && this.revenueModel?.id === 'healthcareProcurement') {
        modifiers.conversionBonus += 0.04;
      }
    }
    
    // === FUNDER ===
    // Different investors bring different customer network effects
    if (this.funder) {
      const funderId = this.funder.id;
      
      // TV Dragon: massive PR, great for visibility/conversion
      if (funderId === 'dragon') {
        modifiers.conversionBonus += 0.06;
      }
      
      // Tech Angel with syndicate: good enterprise connections
      if (funderId === 'techAngel') {
        modifiers.dealSizeBonus += 0.04;
        modifiers.conversionBonus += 0.02;
      }
      
      // Corporate VC: direct customer introductions
      if (funderId === 'corporate') {
        modifiers.conversionBonus += 0.08;
        modifiers.dealSizeBonus += 0.06;
      }
      
      // Tier 1 VC: brand credibility helps close enterprise
      if (funderId === 'tier1') {
        modifiers.conversionBonus += 0.04;
        modifiers.dealSizeBonus += 0.05;
      }
      
      // Impact/Climate investors: mission-aligned customers stick
      if (funderId === 'impact' || funderId === 'climate') {
        modifiers.satisfactionBonus += 0.03;
        modifiers.churnReduction += 0.02;
      }
      
      // Bootstrap: no investor network, but more customer focus
      if (funderId === 'self') {
        modifiers.satisfactionBonus += 0.02;
      }
      
      // Grant funders: academic credibility for research sales
      if ((funderId === 'grant' || funderId === 'ukri') && this.revenueModel?.id === 'researchGrants') {
        modifiers.conversionBonus += 0.06;
      }
    }
    
    // Cap hidden modifiers to keep them subtle
    modifiers.conversionBonus = Math.min(modifiers.conversionBonus, 0.15);
    modifiers.churnReduction = Math.min(modifiers.churnReduction, 0.05);
    modifiers.dealSizeBonus = Math.min(modifiers.dealSizeBonus, 0.12);
    modifiers.satisfactionBonus = Math.min(modifiers.satisfactionBonus, 0.05);
    
    return modifiers;
  }
  
  processPipeline() {
    const model = this.revenueModel;
    if (!model || this.pipeline.length === 0) return [];
    
    const staffEffects = this.calculateStaffRevenueEffects();
    const closedDeals = [];
    const remainingPipeline = [];
    
    this.pipeline.forEach(deal => {
      const quartersInPipeline = this.turn - deal.addedQuarter;
      
      if (quartersInPipeline >= deal.closeIn) {
        let closeProb = deal.probability || 0.6;
        closeProb += staffEffects.conversionBonus;
        
        // Apply milestone modifier (permanent close rate boost from credibility)
        if (this.milestoneModifiers?.closeRateBonus) {
          closeProb += this.milestoneModifiers.closeRateBonus;
        }
        
        if (Math.random() < closeProb) {
          let revenue = deal.value || model.metrics.avgRevenuePerCustomer;
          revenue *= (1 + staffEffects.dealSizeBonus);
          
          // Apply milestone ACV multiplier
          if (this.milestoneModifiers?.acvMultiplier) {
            revenue *= this.milestoneModifiers.acvMultiplier;
          }
          
          const customer = this.addCustomer({
            revenue: Math.round(revenue),
            supportCost: model.metrics.supportCostPerCustomer,
            name: deal.name || null,
            strategic: deal.strategic || false,
            contractLength: deal.contractLength || null
          });
          
          closedDeals.push({ deal, customer });
        } else {
          this.log(`ğŸ˜” Lost opportunity: ${deal.name || 'Pipeline deal'}`);
        }
      } else {
        remainingPipeline.push(deal);
      }
    });
    
    this.pipeline = remainingPipeline;
    
    if (closedDeals.length > 0) {
      this.log(`ğŸ‰ Closed ${closedDeals.length} deal(s) from pipeline!`);
    }
    
    return closedDeals;
  }
  
  processGrantApplications() {
    if (!this.grantApplications || this.grantApplications.length === 0) return [];
    
    const awarded = [];
    const remaining = [];
    
    this.grantApplications.forEach(grant => {
      const quartersWaiting = this.turn - grant.appliedQuarter;
      
      if (quartersWaiting >= grant.quarters) {
        const staffEffects = this.calculateStaffRevenueEffects();
        let prob = grant.probability;
        prob += staffEffects.conversionBonus * 0.5;
        
        if (Math.random() < prob) {
          this.addCustomer({
            revenue: grant.amount,
            supportCost: Math.round(grant.amount * 0.1),
            name: grant.name || 'Research Grant',
            type: 'grant',
            contractLength: grant.duration || 4
          });
          awarded.push(grant);
          this.log(`ğŸ“ Grant awarded: ${grant.name || 'Research Grant'} (Â£${grant.amount * 4}k total)`);
        } else {
          this.log(`ğŸ“ Grant application unsuccessful: ${grant.name || 'Research Grant'}`);
        }
      } else {
        remaining.push(grant);
      }
    });
    
    this.grantApplications = remaining;
    return awarded;
  }
  
  processCustomerChurn() {
    const model = this.revenueModel;
    if (!model || this.customers.length === 0) return [];
    
    const staffEffects = this.calculateStaffRevenueEffects();
    const churned = [];
    const remaining = [];
    
    this.customers.forEach(customer => {
      // Grants expire, don't churn
      if (customer.type === 'grant') {
        if (customer.contractLength && (this.turn - customer.acquiredQuarter) >= customer.contractLength) {
          this.log(`ğŸ“‹ Grant completed: ${customer.name}`);
          churned.push({ ...customer, reason: 'completed' });
        } else {
          remaining.push(customer);
        }
        return;
      }
      
      // Calculate churn probability
      let churnProb = model.metrics.baseChurnRate;
      churnProb *= (1.5 - customer.satisfaction);
      churnProb = Math.max(0.02, churnProb - staffEffects.churnReduction);
      
      // Apply milestone modifier (permanent churn reduction from proving milestones)
      if (this.milestoneModifiers?.churnReduction) {
        churnProb *= (1 - this.milestoneModifiers.churnReduction);
      }
      
      if (customer.strategic) churnProb *= 0.5;
      
      // Fixed-term contracts
      if (customer.contractLength) {
        const quartersRemaining = customer.contractLength - (this.turn - customer.acquiredQuarter);
        if (quartersRemaining > 0) {
          remaining.push(customer);
          return;
        } else {
          const renewalProb = 0.5 + customer.satisfaction * 0.3 + staffEffects.satisfactionBonus;
          if (Math.random() < renewalProb) {
            customer.contractLength = null;
            remaining.push(customer);
            this.log(`ğŸ”„ ${customer.name} renewed!`);
            return;
          } else {
            churned.push({ ...customer, reason: 'not_renewed' });
            return;
          }
        }
      }
      
      // Random churn check
      if (Math.random() < churnProb) {
        churned.push({ ...customer, reason: 'churned' });
      } else {
        customer.satisfaction = Math.min(1, customer.satisfaction + staffEffects.satisfactionBonus * 0.1);
        remaining.push(customer);
      }
    });
    
    this.customers = remaining;
    
    if (churned.length > 0) {
      const revenueImpact = churned.reduce((sum, c) => sum + c.quarterlyRevenue, 0);
      this.log(`ğŸ“‰ Lost ${churned.length} customer(s) (-Â£${Math.round(revenueImpact)}k/q)`);
      
      churned.forEach(c => {
        this.journeyEvents.push({
          quarter: this.turn,
          type: 'customer_lost',
          description: `Lost customer: ${c.name} (${c.reason})`,
          customerName: c.name,
          revenue: c.quarterlyRevenue
        });
      });
    }
    
    return churned;
  }
  
  calculateQuarterlyRevenue() {
    const model = this.revenueModel;
    if (!model) return { gross: 0, support: 0, net: 0 };
    
    const staffEffects = this.calculateStaffRevenueEffects();
    
    const grossRevenue = this.customers.reduce((sum, c) => sum + c.quarterlyRevenue, 0);
    let supportCosts = this.customers.reduce((sum, c) => sum + c.supportCost, 0);
    supportCosts *= (1 - staffEffects.supportEfficiency);
    
    // Scaling penalty after 3 customers
    if (this.customers.length > 3) {
      const extraCustomers = this.customers.length - 3;
      const scalingPenalty = Math.max(0, 0.1 - staffEffects.supportEfficiency * 0.5);
      supportCosts *= (1 + extraCustomers * scalingPenalty);
    }
    
    const maxEfficiency = 0.60 + staffEffects.supportEfficiency * 0.25;
    const netContribution = Math.min(grossRevenue - supportCosts, grossRevenue * maxEfficiency);
    
    this.quarterlyRevenue = Math.round(grossRevenue);
    this.quarterlySupportCosts = Math.round(supportCosts);
    
    // Track for projections (store as ARR)
    if (!this.revenueHistory) this.revenueHistory = [];
    this.revenueHistory[this.turn - 1] = Math.round(grossRevenue * 4);
    
    return {
      gross: Math.round(grossRevenue),
      support: Math.round(supportCosts),
      net: Math.round(Math.max(0, netContribution))
    };
  }
  
  getSalesProjections() {
    const model = this.revenueModel;
    if (!model) return null;
    
    const track = this.projectionDifficulty || 'balanced';
    const projections = model.projections[track];
    
    const data = [];
    for (let q = 1; q <= 16; q++) {
      const projected = projections[q - 1] || 0;
      const actual = this.revenueHistory[q - 1] || null;
      
      let status = 'future';
      if (actual !== null) {
        const variance = projected > 0 ? (actual - projected) / projected : 0;
        if (variance >= 0) status = 'on_track';
        else if (variance >= -model.investorToleranceBand) status = 'within_tolerance';
        else status = 'behind';
      }
      
      data.push({ quarter: q, year: Math.ceil(q / 4), projected, actual, status });
    }
    
    return {
      model: model.name,
      track: track,
      toleranceBand: model.investorToleranceBand,
      quarters: data,
      currentQuarter: this.turn,
      annualSummary: [1, 2, 3, 4].map(year => {
        const yearQuarters = data.filter(d => d.year === year);
        const projectedEnd = yearQuarters[yearQuarters.length - 1]?.projected || 0;
        const lastActual = yearQuarters.filter(d => d.actual !== null).pop();
        return {
          year,
          projectedARR: projectedEnd,
          actualARR: lastActual?.actual || null,
          status: lastActual?.status || 'future'
        };
      })
    };
  }
  
  checkRevenueExpectations() {
    const model = this.revenueModel;
    if (!model || !this.funder) return;
    
    const projections = this.getSalesProjections();
    if (!projections) return;
    
    const currentData = projections.quarters[this.turn - 1];
    if (!currentData || currentData.projected === 0) return;
    
    const annualizedRevenue = this.quarterlyRevenue * 4;
    const projected = currentData.projected;
    const variance = projected > 0 ? (annualizedRevenue - projected) / projected : 0;
    
    if (variance < -model.investorToleranceBand) {
      // Significantly below expectations
      this.investorRelationship = Math.max(0, this.investorRelationship - 0.5);
      this.log(`ğŸ“‰ Revenue (Â£${annualizedRevenue}k ARR) below investor expectations (Â£${projected}k)`);
    } else if (variance > 0.2) {
      // Exceeding expectations
      this.log(`ğŸ“ˆ Exceeding revenue expectations! Investors pleased.`);
      this.investorRelationship = Math.min(3, this.investorRelationship + 0.25);
    }
  }
  
  selectRevenueEvent(domain) {
    if (domain !== 'marketing') return null;
    
    const model = this.revenueModel;
    if (!model) return null;
    
    // Filter events for this revenue model
    const modelEvents = REVENUE_MARKETING_EVENTS.filter(e => {
      if (e.revenueModel !== model.id) return false;
      if (e.minMilestone !== undefined && this.completedMilestones.length < e.minMilestone) return false;
      if (e.minCustomers !== undefined && this.customers.length < e.minCustomers) return false;
      if (this.usedRevenueEvents.has(e.id)) return false;
      return true;
    });
    
    if (modelEvents.length === 0) return null;
    
    // Weight: higher chance after M1
    let baseWeight = 0.18;
    const milestoneBonus = this.completedMilestones.length * 0.05;
    
    // === HIDDEN: Founder commercial skill affects opportunity spotting ===
    // High commercial founders see more revenue opportunities
    if (this.founderBonuses) {
      const commercial = this.founderBonuses.commercial || 2;
      if (commercial > 3) baseWeight += 0.04;  // Hustler types
      else if (commercial < 2) baseWeight -= 0.03;  // Pure academics
    }
    
    // === HIDDEN: Certain funders bring deal flow ===
    if (this.funder) {
      const funderId = this.funder.id;
      if (funderId === 'dragon') baseWeight += 0.03;  // Media exposure
      if (funderId === 'corporate') baseWeight += 0.05;  // Direct intros
      if (funderId === 'techAngel') baseWeight += 0.02;  // Syndicate network
    }
    
    const weight = Math.min(baseWeight + milestoneBonus, 0.40);
    
    if (Math.random() < weight) {
      const event = modelEvents[Math.floor(Math.random() * modelEvents.length)];
      this.usedRevenueEvents.add(event.id);
      return event;
    }
    
    return null;
  }
  
  processRevenueEffect(effect) {
    if (!effect) return;
    
    // Add single customer
    if (effect.addCustomer && !Array.isArray(effect.addCustomer)) {
      this.addCustomer(effect.addCustomer);
    }
    
    // Add multiple customers
    if (effect.addCustomer && Array.isArray(effect.addCustomer)) {
      effect.addCustomer.forEach(c => this.addCustomer(c));
    }
    
    // Add to pipeline
    if (effect.addToPipeline) {
      this.pipeline.push({
        ...effect.addToPipeline,
        addedQuarter: this.turn
      });
      this.log(`ğŸ“‹ Added to pipeline: Â£${effect.addToPipeline.value}k (expected Q${this.turn + effect.addToPipeline.closeIn})`);
    }
    
    // Grant application
    if (effect.grantApplication) {
      this.grantApplications.push({
        ...effect.grantApplication,
        appliedQuarter: this.turn
      });
      this.log(`ğŸ“ Grant application submitted (${Math.round(effect.grantApplication.probability * 100)}% success rate)`);
    }
    
    // Modify specific customer
    if (effect.modifyCustomer) {
      let target = null;
      if (effect.modifyCustomer.type === 'largest') {
        target = this.customers.reduce((max, c) => c.quarterlyRevenue > (max?.quarterlyRevenue || 0) ? c : max, null);
      } else if (effect.modifyCustomer.type === 'second_largest') {
        const sorted = [...this.customers].sort((a, b) => b.quarterlyRevenue - a.quarterlyRevenue);
        target = sorted[1] || sorted[0];
      } else if (effect.modifyCustomer.type === 'grant') {
        target = this.customers.find(c => c.type === 'grant');
      } else {
        target = this.customers.find(c => c.name === effect.modifyCustomer.name);
      }
      
      if (target) {
        if (effect.modifyCustomer.satisfaction !== undefined) {
          target.satisfaction = effect.modifyCustomer.satisfaction;
        }
        if (effect.modifyCustomer.revenueChange !== undefined) {
          target.quarterlyRevenue += effect.modifyCustomer.revenueChange;
          this.log(`ğŸ“ˆ ${target.name} expanded to Â£${target.quarterlyRevenue}k/q`);
        }
        if (effect.modifyCustomer.churnRisk !== undefined) {
          target.satisfaction = Math.max(0.1, target.satisfaction - effect.modifyCustomer.churnRisk);
        }
      }
    }
    
    // Modify all customers
    if (effect.modifyAllCustomers) {
      this.customers.forEach(c => {
        if (effect.modifyAllCustomers.satisfactionChange) {
          c.satisfaction = Math.max(0.1, Math.min(1, c.satisfaction + effect.modifyAllCustomers.satisfactionChange));
        }
        if (effect.modifyAllCustomers.churnReduction) {
          c.satisfaction = Math.min(1, c.satisfaction + effect.modifyAllCustomers.churnReduction);
        }
      });
    }
    
    // Lose customers
    if (effect.loseCustomers) {
      const count = Math.min(effect.loseCustomers, this.customers.length);
      for (let i = 0; i < count; i++) {
        const lost = this.customers.pop();
        if (lost) {
          this.log(`ğŸ“‰ Lost customer: ${lost.name}`);
        }
      }
    }
  }
  
  getRevenueStatus() {
    const model = this.revenueModel;
    if (!model) return null;
    
    const revenue = this.calculateQuarterlyRevenue();
    const projections = this.getSalesProjections();
    
    let status = 'none';
    let expectedRevenue = 0;
    if (projections && projections.quarters[this.turn - 1]) {
      expectedRevenue = projections.quarters[this.turn - 1].projected;
      if (expectedRevenue > 0) {
        const annualized = revenue.gross * 4;
        const variance = (annualized - expectedRevenue) / expectedRevenue;
        if (variance >= 0) status = 'on_track';
        else if (variance >= -model.investorToleranceBand) status = 'within_tolerance';
        else status = 'behind';
      }
    }
    
    return {
      model,
      customers: this.customers.length,
      grossRevenue: revenue.gross,
      supportCosts: revenue.support,
      netContribution: revenue.net,
      annualizedRevenue: revenue.gross * 4,
      expectedRevenue,
      status,
      pipeline: this.pipeline.length,
      pendingGrants: this.grantApplications.length
    };
  }
  
  showProjectionsModal() {
    const projections = this.getSalesProjections();
    if (!projections) return;
    
    const modal = document.getElementById("projectionsModal");
    const content = document.getElementById("projectionsContent");
    if (!modal || !content) return;
    
    const statusColors = {
      'on_track': 'bg-emerald-100 text-emerald-700',
      'within_tolerance': 'bg-amber-100 text-amber-700',
      'behind': 'bg-rose-100 text-rose-700',
      'future': 'bg-slate-100 text-slate-500'
    };
    const statusLabels = {
      'on_track': 'âœ…',
      'within_tolerance': 'âš ï¸',
      'behind': 'âŒ',
      'future': 'â€”'
    };
    
    const yearRows = projections.annualSummary.map(year => {
      const isCurrentYear = this.turn >= (year.year - 1) * 4 + 1 && this.turn <= year.year * 4;
      return `
        <tr class="${isCurrentYear ? 'bg-indigo-50' : ''}">
          <td class="py-3 px-4 font-medium">Year ${year.year}</td>
          <td class="py-3 px-4 text-right font-mono">${getRegion().currency}${year.projectedARR}k</td>
          <td class="py-3 px-4 text-right font-mono">${year.actualARR !== null ? getRegion().currency + year.actualARR + 'k' : 'â€”'}</td>
          <td class="py-3 px-4 text-center">
            <span class="px-2 py-1 rounded-full text-xs ${statusColors[year.status]}">${statusLabels[year.status]}</span>
          </td>
        </tr>
      `;
    }).join('');
    
    const currentYear = Math.ceil(this.turn / 4);
    const quarterlyDetail = projections.quarters
      .filter(q => q.year === currentYear)
      .map(q => {
        const isCurrent = q.quarter === this.turn;
        const statusTextColors = {
          'on_track': 'text-emerald-600',
          'within_tolerance': 'text-amber-600',
          'behind': 'text-rose-600',
          'future': 'text-slate-400'
        };
        return `
          <div class="flex justify-between items-center py-2 ${isCurrent ? 'bg-indigo-100 -mx-2 px-2 rounded' : ''}">
            <span class="text-sm ${isCurrent ? 'font-bold' : ''}">Q${q.quarter}</span>
            <span class="text-sm font-mono text-slate-500">${getRegion().currency}${q.projected}k</span>
            <span class="text-sm font-mono ${statusTextColors[q.status]}">${q.actual !== null ? getRegion().currency + q.actual + 'k' : 'â€”'}</span>
          </div>
        `;
      }).join('');
    
    // Customer list
    let customerList = '';
    if (this.customers.length > 0) {
      customerList = this.customers.map(c => `
        <div class="flex justify-between items-center py-2 border-b border-slate-100 last:border-0">
          <div>
            <div class="font-medium text-slate-800 text-sm">${c.name}</div>
            <div class="text-xs text-slate-500">Since Q${c.acquiredQuarter} ${c.strategic ? 'â­' : ''} ${c.type === 'grant' ? 'ğŸ“' : ''}</div>
          </div>
          <div class="text-right">
            <div class="text-emerald-600 font-mono text-sm">${getRegion().currency}${c.quarterlyRevenue}k/q</div>
          </div>
        </div>
      `).join('');
    } else {
      customerList = '<div class="text-slate-400 text-center py-4 text-sm">No customers yet</div>';
    }
    
    // Pipeline list
    let pipelineList = '';
    if (this.pipeline.length > 0 || this.grantApplications.length > 0) {
      const allPipeline = [
        ...this.pipeline.map(p => ({ ...p, type: 'deal' })),
        ...this.grantApplications.map(g => ({ ...g, type: 'grant', value: g.amount, closeIn: g.quarters }))
      ];
      pipelineList = allPipeline.map(p => {
        const quartersRemaining = p.closeIn - (this.turn - (p.addedQuarter || p.appliedQuarter));
        return `
          <div class="flex justify-between items-center py-2 border-b border-slate-100 last:border-0">
            <div>
              <div class="font-medium text-slate-800 text-sm">${p.name || (p.type === 'grant' ? 'Grant Application' : 'Pipeline Deal')}</div>
              <div class="text-xs text-slate-500">${p.type === 'grant' ? 'ğŸ“ Grant' : 'ğŸ“‹ Deal'} â€¢ ${quartersRemaining}q remaining</div>
            </div>
            <div class="text-right">
              <div class="text-indigo-600 font-mono text-sm">${getRegion().currency}${p.value}k/q</div>
              <div class="text-xs text-slate-500">${Math.round((p.probability || 0.6) * 100)}% prob</div>
            </div>
          </div>
        `;
      }).join('');
    } else {
      pipelineList = '<div class="text-slate-400 text-center py-4 text-sm">No deals in pipeline</div>';
    }
    
    content.innerHTML = `
      <div class="bg-slate-50 rounded-xl p-4 mb-4">
        <div class="flex justify-between items-center">
          <div>
            <div class="text-xs text-slate-500 uppercase">Business Model</div>
            <div class="font-bold text-slate-800">${projections.model}</div>
          </div>
          <div class="text-right">
            <div class="text-xs text-slate-500 uppercase">Projection Track</div>
            <div class="font-bold text-slate-800 capitalize">${projections.track}</div>
          </div>
        </div>
        <div class="mt-2 text-xs text-slate-500">
          Investor tolerance: Â±${Math.round(projections.toleranceBand * 100)}% variance
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-3 mb-4">
        <div class="bg-emerald-50 rounded-xl p-3 group relative">
          <div class="text-xs text-emerald-600 uppercase flex items-center gap-1">
            Current ARR
            <span class="cursor-help text-emerald-400 hover:text-emerald-600" title="Annual Recurring Revenue - your yearly subscription income from customers">â“˜</span>
          </div>
          <div class="text-xl font-bold text-emerald-700">${getRegion().currency}${this.quarterlyRevenue * 4}k</div>
          <div class="absolute bottom-full left-0 mb-2 w-48 bg-slate-800 text-white text-xs rounded-lg p-2 hidden group-hover:block z-10 shadow-lg">
            <strong>Annual Recurring Revenue</strong><br>
            Your yearly subscription income from customers. This is quarterly revenue Ã— 4.
          </div>
        </div>
        <div class="bg-indigo-50 rounded-xl p-3 group relative">
          <div class="text-xs text-indigo-600 uppercase flex items-center gap-1">
            Net Contribution
            <span class="cursor-help text-indigo-400 hover:text-indigo-600" title="Revenue minus customer support costs">â“˜</span>
          </div>
          <div class="text-xl font-bold text-indigo-700">${getRegion().currency}${this.calculateQuarterlyRevenue().net}k/q</div>
          <div class="absolute bottom-full right-0 mb-2 w-48 bg-slate-800 text-white text-xs rounded-lg p-2 hidden group-hover:block z-10 shadow-lg">
            <strong>Net Contribution</strong><br>
            Revenue after customer support costs. What actually flows to your bottom line.
          </div>
        </div>
      </div>
      
      <h3 class="font-bold text-slate-800 mb-2 text-sm flex items-center gap-1">
        Annual ARR Targets
        <span class="cursor-help text-slate-400 hover:text-slate-600 font-normal" title="Investors expect you to hit these revenue milestones">â“˜</span>
      </h3>
      <div class="bg-white border rounded-xl overflow-hidden mb-4">
        <table class="w-full text-sm">
          <thead class="bg-slate-100">
            <tr>
              <th class="py-2 px-4 text-left text-xs text-slate-600">Year</th>
              <th class="py-2 px-4 text-right text-xs text-slate-600">Target</th>
              <th class="py-2 px-4 text-right text-xs text-slate-600">Actual</th>
              <th class="py-2 px-4 text-center text-xs text-slate-600">Status</th>
            </tr>
          </thead>
          <tbody class="divide-y">${yearRows}</tbody>
        </table>
      </div>
      
      <h3 class="font-bold text-slate-800 mb-2 text-sm">Year ${currentYear} Quarterly Detail</h3>
      <div class="bg-white border rounded-xl p-3 mb-4">
        <div class="flex justify-between text-xs text-slate-500 mb-2 border-b pb-2">
          <span>Quarter</span>
          <span>Target ARR</span>
          <span>Actual ARR</span>
        </div>
        ${quarterlyDetail}
      </div>
      
      <h3 class="font-bold text-slate-800 mb-2 text-sm">Customers (${this.customers.length})</h3>
      <div class="bg-white border rounded-xl p-3 mb-4 max-h-40 overflow-y-auto">
        ${customerList}
      </div>
      
      <h3 class="font-bold text-slate-800 mb-2 text-sm">Pipeline (${this.pipeline.length + this.grantApplications.length})</h3>
      <div class="bg-white border rounded-xl p-3 max-h-32 overflow-y-auto">
        ${pipelineList}
      </div>
    `;
    
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  }
  
  closeProjectionsModal() {
    const modal = document.getElementById("projectionsModal");
    if (modal) {
      modal.classList.add("hidden");
      modal.classList.remove("flex");
    }
  }
  
  // ===== REVENUE-VALUATION INTEGRATION =====
  // Real startup valuations are heavily influenced by revenue metrics
  
  calculateARRValuation() {
    if (!this.revenueModel) return null;
    
    const arr = this.quarterlyRevenue * 4;  // Annualized
    if (arr <= 0) return null;
    
    const model = this.revenueModel;
    
    // Base multiple varies by business model
    const baseMultiples = {
      b2bSaas: 10,        // SaaS companies get highest multiples
      healthcareProcurement: 8,  // Healthcare premium
      consumer: 6,        // Consumer lower due to churn
      researchGrants: 4,  // Grants aren't recurring revenue
      platformAPI: 12     // Platform/API = network effects
    };
    
    let multiple = baseMultiples[model.id] || 8;
    
    // Growth rate affects multiple significantly
    if (this.revenueHistory && this.revenueHistory.length >= 2) {
      const prevARR = this.revenueHistory[this.revenueHistory.length - 2] || 0;
      const currentARR = this.revenueHistory[this.revenueHistory.length - 1] || 0;
      if (prevARR > 0) {
        const qoqGrowth = (currentARR - prevARR) / prevARR;
        // High growth = higher multiple
        if (qoqGrowth > 0.3) multiple += 4;       // >30% QoQ = exceptional
        else if (qoqGrowth > 0.15) multiple += 2; // >15% QoQ = great
        else if (qoqGrowth > 0.05) multiple += 1; // >5% QoQ = good
        else if (qoqGrowth < 0) multiple -= 2;    // Declining = penalty
      }
    }
    
    // Customer metrics affect multiple
    const customerCount = this.customers.length;
    if (customerCount >= 10) multiple += 2;
    else if (customerCount >= 5) multiple += 1;
    
    // Churn rate affects multiple (estimate from satisfaction)
    const avgSatisfaction = this.customers.length > 0
      ? this.customers.reduce((sum, c) => sum + c.satisfaction, 0) / this.customers.length
      : 0.5;
    if (avgSatisfaction > 0.8) multiple += 1;  // Low churn
    else if (avgSatisfaction < 0.5) multiple -= 2;  // High churn risk
    
    // Pipeline affects valuation
    if (this.pipeline.length >= 5) multiple += 1;
    
    // Calculate ARR-based valuation
    const arrValuation = Math.round(arr * multiple);
    
    return {
      arr,
      multiple,
      arrValuation,
      customerCount,
      avgSatisfaction
    };
  }
  
  updateValuationFromRevenue() {
    const arrVal = this.calculateARRValuation();
    if (!arrVal) return;
    
    // Blend ARR valuation with milestone-based valuation
    // Early stage: milestone matters more
    // Later stage: revenue matters more
    const milestoneWeight = Math.max(0.3, 1 - (this.completedMilestones.length * 0.2) - (this.customers.length * 0.05));
    const revenueWeight = 1 - milestoneWeight;
    
    const currentVal = this.metrics.val;
    const targetVal = Math.round((currentVal * milestoneWeight) + (arrVal.arrValuation * revenueWeight));
    
    // Smooth transition - valuation changes gradually
    const maxChange = Math.max(50, currentVal * 0.15);  // Max 15% change per quarter
    const change = Math.max(-maxChange, Math.min(maxChange, targetVal - currentVal));
    
    if (Math.abs(change) > 20) {
      this.metrics.val = Math.round(currentVal + change);
      
      // Log significant changes
      if (change > 50) {
        this.log(`ğŸ“ˆ Revenue traction boosting valuation (+Â£${Math.round(change)}k)`);
      } else if (change < -50) {
        this.log(`ğŸ“‰ Revenue concerns affecting valuation (-Â£${Math.round(Math.abs(change))}k)`);
      }
    }
  }
  
  // ===== BOARD/INVESTOR PRESSURE =====
  // Investors track revenue against projections
  
  getBoardRevenueSentiment() {
    if (!this.revenueModel) return { sentiment: 'neutral', message: null };
    
    // Only check after M1 complete (when revenue tracking begins)
    if (this.completedMilestones.length < 1) return { sentiment: 'neutral', message: null };
    
    const projections = this.getSalesProjections();
    if (!projections) return { sentiment: 'neutral', message: null };
    
    const currentQuarter = Math.min(this.turn, projections.quarters.length);
    const quarterData = projections.quarters[currentQuarter - 1];
    if (!quarterData || quarterData.projected === 0) return { sentiment: 'neutral', message: null };
    
    const actualARR = this.quarterlyRevenue * 4;
    const projectedARR = quarterData.projected;
    const variance = (actualARR - projectedARR) / projectedARR;
    const toleranceBand = this.revenueModel.investorToleranceBand || 0.3;
    
    // Track consecutive misses
    if (!this.consecutiveRevenueMisses) this.consecutiveRevenueMisses = 0;
    
    if (variance < -toleranceBand) {
      this.consecutiveRevenueMisses++;
      
      if (this.consecutiveRevenueMisses >= 3) {
        return {
          sentiment: 'critical',
          message: 'The board is seriously concerned about repeated revenue misses.',
          investorPenalty: -1.0
        };
      } else if (this.consecutiveRevenueMisses >= 2) {
        return {
          sentiment: 'worried',
          message: 'Investors are questioning the commercial strategy.',
          investorPenalty: -0.5
        };
      } else {
        return {
          sentiment: 'concerned',
          message: 'The board noted revenue is below projections.',
          investorPenalty: -0.25
        };
      }
    } else if (variance > 0.2) {
      this.consecutiveRevenueMisses = 0;
      return {
        sentiment: 'delighted',
        message: 'Investors are thrilled with the revenue performance!',
        investorBonus: 0.5
      };
    } else if (variance >= 0) {
      this.consecutiveRevenueMisses = 0;
      return {
        sentiment: 'satisfied',
        message: null,
        investorBonus: 0
      };
    } else {
      // Within tolerance but below target
      return {
        sentiment: 'watchful',
        message: 'Revenue is slightly behind projections but within tolerance.',
        investorPenalty: 0
      };
    }
  }
  
  // ===== REVENUE MILESTONE REQUIREMENTS =====
  // Some milestones require revenue proof
  
  checkRevenueRequirements() {
    if (!this.milestone) return { met: true, message: null };
    
    const milestoneId = this.milestone.id || '';
    const requirements = [];
    
    // Check for revenue-related milestone names
    if (milestoneId.includes('customer') || this.milestone.name?.toLowerCase().includes('customer')) {
      if (this.customers.length < 1) {
        requirements.push({
          type: 'customer',
          required: 1,
          current: this.customers.length,
          met: false,
          message: 'Need at least 1 paying customer'
        });
      }
    }
    
    if (milestoneId.includes('revenue') || this.milestone.name?.toLowerCase().includes('revenue')) {
      const requiredARR = 50;  // Â£50k ARR minimum
      const currentARR = this.quarterlyRevenue * 4;
      if (currentARR < requiredARR) {
        requirements.push({
          type: 'revenue',
          required: requiredARR,
          current: currentARR,
          met: false,
          message: `Need Â£${requiredARR}k ARR (currently Â£${Math.round(currentARR)}k)`
        });
      }
    }
    
    // M2 ambitious often requires "first paying customer"
    if (milestoneId === 'm2_ambitious' && this.completedMilestones.length === 1) {
      if (this.customers.length < 1) {
        requirements.push({
          type: 'customer',
          required: 1,
          current: this.customers.length,
          met: false,
          message: 'First paying customer required for this milestone'
        });
      }
    }
    
    const unmetRequirements = requirements.filter(r => !r.met);
    return {
      met: unmetRequirements.length === 0,
      requirements: requirements,
      unmetRequirements: unmetRequirements,
      message: unmetRequirements.length > 0 
        ? unmetRequirements.map(r => r.message).join('; ')
        : null
    };
  }
  
  // ===== VICTORY CONDITION MODIFIERS =====
  // Revenue performance affects ending quality
  
  getRevenueVictoryModifiers() {
    const modifiers = {
      tier: 'standard',
      valuationBonus: 0,
      acquirerInterest: 'normal',
      ipoEligible: false,
      narrative: []
    };
    
    if (!this.revenueModel) return modifiers;
    
    const arr = this.quarterlyRevenue * 4;
    const customerCount = this.customers.length;
    const avgSatisfaction = customerCount > 0
      ? this.customers.reduce((sum, c) => sum + c.satisfaction, 0) / customerCount
      : 0;
    
    // Revenue tiers affect ending quality
    if (arr >= 500) {
      modifiers.tier = 'exceptional';
      modifiers.valuationBonus = 0.5;  // 50% bonus to ending valuation
      modifiers.acquirerInterest = 'bidding_war';
      modifiers.ipoEligible = arr >= 1000;
      modifiers.narrative.push(`Built a Â£${Math.round(arr)}k ARR business - exceptional commercial execution.`);
    } else if (arr >= 200) {
      modifiers.tier = 'strong';
      modifiers.valuationBonus = 0.25;
      modifiers.acquirerInterest = 'strong';
      modifiers.narrative.push(`Achieved Â£${Math.round(arr)}k ARR - proven product-market fit.`);
    } else if (arr >= 50) {
      modifiers.tier = 'promising';
      modifiers.valuationBonus = 0.1;
      modifiers.acquirerInterest = 'normal';
      modifiers.narrative.push(`Early revenue traction with Â£${Math.round(arr)}k ARR.`);
    } else if (arr > 0) {
      modifiers.tier = 'early';
      modifiers.valuationBonus = 0;
      modifiers.acquirerInterest = 'low';
      modifiers.narrative.push('Initial customer traction but revenue still nascent.');
    } else {
      modifiers.tier = 'prerevenue';
      modifiers.valuationBonus = -0.1;  // Penalty for no revenue
      modifiers.acquirerInterest = 'acquihire';
      modifiers.narrative.push('Pre-revenue - acquisition would be primarily for team/technology.');
    }
    
    // Customer quality affects narrative
    if (customerCount >= 10 && avgSatisfaction > 0.7) {
      modifiers.narrative.push(`Strong customer base of ${customerCount} satisfied customers.`);
      modifiers.valuationBonus += 0.1;
    } else if (customerCount >= 5) {
      modifiers.narrative.push(`Growing customer base of ${customerCount} accounts.`);
    }
    
    // Unit economics
    const revenue = this.calculateQuarterlyRevenue();
    if (revenue.net > 0 && revenue.gross > 0) {
      const margin = revenue.net / revenue.gross;
      if (margin > 0.6) {
        modifiers.narrative.push('Healthy unit economics with strong margins.');
        modifiers.valuationBonus += 0.1;
      } else if (margin > 0.4) {
        modifiers.narrative.push('Sustainable unit economics.');
      } else if (margin < 0.2) {
        modifiers.narrative.push('Unit economics need improvement for scale.');
        modifiers.valuationBonus -= 0.05;
      }
    }
    
    return modifiers;
  }
  
  // ===== CASE STUDY REVENUE NARRATIVE =====
  // Generate revenue story for PDF export
  
  generateRevenueNarrative() {
    if (!this.revenueModel) return null;
    
    const narrative = {
      modelName: this.revenueModel.name,
      modelId: this.revenueModel.id,
      timeline: [],
      keyMetrics: {},
      insights: []
    };
    
    // Final metrics
    const arr = this.quarterlyRevenue * 4;
    narrative.keyMetrics = {
      finalARR: arr,
      totalCustomers: this.customers.length,
      pipelineDeals: this.pipeline.length,
      avgCustomerRevenue: this.customers.length > 0 
        ? Math.round(this.customers.reduce((sum, c) => sum + c.quarterlyRevenue, 0) / this.customers.length * 4)
        : 0
    };
    
    // Build timeline from journey events
    const revenueEvents = (this.journeyEvents || []).filter(e => 
      e.type === 'customer_acquired' || 
      e.type === 'customer_lost' ||
      e.type === 'revenue' ||
      e.type === 'pivot_customer_loss'
    );
    
    narrative.timeline = revenueEvents.map(e => ({
      quarter: e.quarter,
      event: e.type,
      description: e.description,
      impact: e.revenue || e.revenueLost || 0
    }));
    
    // Generate insights
    if (this.customers.length === 0) {
      narrative.insights.push('Pre-revenue at journey end - focus was on technical milestones over commercialization.');
    } else if (arr >= 200) {
      narrative.insights.push(`Achieved significant revenue traction with Â£${Math.round(arr)}k ARR.`);
    } else if (arr >= 50) {
      narrative.insights.push('Early revenue validation - customers willing to pay for the solution.');
    }
    
    // Customer acquisition pattern
    const customerEvents = revenueEvents.filter(e => e.type === 'customer_acquired');
    if (customerEvents.length > 0) {
      const firstCustomerQ = customerEvents[0].quarter;
      narrative.insights.push(`First customer acquired in Q${firstCustomerQ}.`);
    }
    
    // Churn insights
    const lostEvents = revenueEvents.filter(e => e.type === 'customer_lost');
    if (lostEvents.length > 0) {
      const churnRate = lostEvents.length / (this.customers.length + lostEvents.length);
      if (churnRate > 0.3) {
        narrative.insights.push(`High customer churn (${Math.round(churnRate * 100)}%) - retention was a challenge.`);
      }
    }
    
    // Projection accuracy
    const projections = this.getSalesProjections();
    if (projections && arr > 0) {
      const finalProjected = projections.quarters[this.turn - 1]?.projected || 0;
      if (finalProjected > 0) {
        const accuracy = arr / finalProjected;
        if (accuracy >= 1) {
          narrative.insights.push('Met or exceeded revenue projections.');
        } else if (accuracy >= 0.7) {
          narrative.insights.push('Revenue slightly below projections but within tolerance.');
        } else {
          narrative.insights.push('Revenue significantly below initial projections.');
        }
      }
    }
    
    return narrative;
  }

  // ===== STAFF CONTRIBUTION SYSTEM =====
  // Hired staff contribute to company performance based on their INDIVIDUAL skills.
  // BUT: New hires take time to onboard and temporarily disrupt their department.
  //
  // ONBOARDING RAMP (quarters since hire):
  //   Q1: 0% (just joined, learning)
  //   Q2: 25% (starting to contribute)
  //   Q3: 50% (getting productive)
  //   Q4: 75% (nearly full speed)
  //   Q5+: 100% (fully productive)
  //
  // DISRUPTION: New hires reduce department effectiveness for 2 quarters
  //   as existing team spends time training and supporting them.
  //
  // HR LEAD BONUS: A skilled HR lead reduces onboarding time and disruption
  //   - Each HR skill point speeds onboarding by ~0.25 quarters
  //   - Each HR skill point reduces disruption penalty by 1%
  
  getHRSkillLevel() {
    // Get the total effective HR skill level from:
    // 1. HR Lead (full contribution)
    // 2. Hired HR staff (partial contribution with diminishing returns)
    
    let totalSkill = 0;
    
    // HR Lead contributes fully
    if (this.team.hr) {
      const hr = this.team.hr;
      const hrBonus = hr.bonus?.hr || hr.statBonus?.hr || 0;
      totalSkill += hrBonus;
    }
    
    // Hired HR staff contribute with diminishing returns
    // Sum their hr skills, apply sqrt(), multiply by 0.3
    // So 2 people with hr:3 each = sqrt(6) * 0.3 â‰ˆ 0.73 extra
    let hiredHRSkills = 0;
    (this.hiredStaff || []).forEach(staff => {
      // Only count HR hires (id starts with 'h'), and not the one who became HR lead
      if (staff.id.startsWith('h') && staff.id !== this.team.hr?.id) {
        const hrSkill = staff.statBonus?.hr || 0;
        // Weight by onboarding progress
        const onboarding = this.getOnboardingMultiplier(staff);
        hiredHRSkills += hrSkill * onboarding;
      }
    });
    
    // Diminishing returns: sqrt of total, scaled down
    if (hiredHRSkills > 0) {
      totalSkill += Math.sqrt(hiredHRSkills) * 0.3;
    }
    
    return totalSkill;
  }
  
  getOnboardingMultiplier(staff) {
    // Calculate how productive a staff member is based on time since hire
    // HR lead skill accelerates onboarding (using only lead's skill to avoid recursion)
    const quartersSinceHire = this.turn - (staff.hiredTurn || this.turn);
    
    // Get HR lead's skill directly (not total HR skill, to avoid infinite recursion)
    let hrLeadSkill = 0;
    if (this.team.hr) {
      hrLeadSkill = this.team.hr.bonus?.hr || this.team.hr.statBonus?.hr || 0;
    }
    
    // HR skill accelerates onboarding: each point = 0.25 quarters faster
    // So hr:4 means new hires are effectively 1 quarter ahead
    const effectiveQuarters = quartersSinceHire + (hrLeadSkill * 0.25);
    
    if (effectiveQuarters <= 0) return 0;       // Just hired this quarter
    if (effectiveQuarters < 1) return 0.25 * effectiveQuarters; // Partial first quarter
    if (effectiveQuarters < 2) return 0.25;     // First quarter working
    if (effectiveQuarters < 3) return 0.50;     // Second quarter
    if (effectiveQuarters < 4) return 0.75;     // Third quarter
    return 1.0;                                  // Fully onboarded
  }
  
  getStaffSkillsByDomain() {
    // Sum up skill points from all hired staff, weighted by onboarding progress
    const skills = { sci: 0, dev: 0, mkt: 0, hr: 0 };
    
    (this.hiredStaff || []).forEach(staff => {
      const onboardingMult = this.getOnboardingMultiplier(staff);
      if (staff.statBonus && onboardingMult > 0) {
        Object.entries(staff.statBonus).forEach(([stat, value]) => {
          if (skills.hasOwnProperty(stat)) {
            skills[stat] += value * onboardingMult;
          }
        });
      }
    });
    
    return skills;
  }
  
  getDepartmentDisruption(domain) {
    // Get disruption penalty for a department from recent hires
    // HR lead skill reduces this penalty
    // Returns a multiplier (e.g., 0.9 = 10% penalty)
    if (!this.hiringDisruption) return 1;
    
    const domainMap = { research: 'research', dev: 'dev', marketing: 'marketing', hr: 'hr' };
    const dept = domainMap[domain];
    const disruptionQuarters = this.hiringDisruption[dept] || 0;
    
    if (disruptionQuarters === 0) return 1;
    
    // Base: 5% penalty per quarter of disruption
    // HR skill reduces penalty: each point = 1% less penalty
    const hrSkill = this.getHRSkillLevel();
    const basePenaltyPerQuarter = Math.max(0.01, 0.05 - (hrSkill * 0.01)); // Min 1% per quarter
    
    const penalty = Math.min(0.15, disruptionQuarters * basePenaltyPerQuarter);
    return 1 - penalty;
  }
  
  decayHiringDisruption() {
    // Called at end of quarter - reduce disruption counters
    // HR skill makes disruption decay faster
    if (!this.hiringDisruption) return;
    
    const hrSkill = this.getHRSkillLevel();
    // With high HR skill (4+), disruption decays by 2 per quarter instead of 1
    const decayRate = hrSkill >= 4 ? 2 : 1;
    
    Object.keys(this.hiringDisruption).forEach(dept => {
      if (this.hiringDisruption[dept] > 0) {
        this.hiringDisruption[dept] = Math.max(0, this.hiringDisruption[dept] - decayRate);
      }
    });
  }
  
  getDepartmentMultiplier(domain) {
    // Get effectiveness multiplier for a domain based on:
    // 1. Total onboarded staff skill points (positive)
    // 2. Hiring disruption penalty (negative)
    
    const domainToStat = { research: 'sci', dev: 'dev', marketing: 'mkt', hr: 'hr' };
    const stat = domainToStat[domain];
    if (!stat) return 1;
    
    const skills = this.getStaffSkillsByDomain();
    const skillPoints = skills[stat] || 0;
    
    // Diminishing returns: sqrt(points) * 4%, capped at 15%
    const skillBonus = Math.min(0.15, Math.sqrt(skillPoints) * 0.04);
    
    // Apply disruption penalty
    const disruptionMult = this.getDepartmentDisruption(domain);
    
    return (1 + skillBonus) * disruptionMult;
  }
  
  applyStaffPassiveContribution() {
    // Apply quarterly gains based on each staff member's skills AND onboarding progress
    // Fully onboarded staff contribute sqrt(total) * 0.25 per quarter (with diminishing returns)
    
    if (!this.hiredStaff || this.hiredStaff.length === 0) return;
    
    // Get onboarding-weighted skill totals
    const skills = this.getStaffSkillsByDomain();
    
    const contributions = {};
    const statNames = { sci: 'Science', dev: 'Product', mkt: 'Marketing', hr: 'HR' };
    const contribParts = [];
    
    Object.entries(skills).forEach(([stat, totalPoints]) => {
      if (totalPoints > 0) {
        // Diminishing returns via square root
        const contribution = Math.sqrt(totalPoints) * 0.25;
        const rounded = Math.round(contribution * 10) / 10;
        
        if (rounded > 0) {
          this.metrics[stat] = (this.metrics[stat] || 0) + rounded;
          contribParts.push(`${statNames[stat]} +${rounded}`);
        }
      }
    });
    
    if (contribParts.length > 0) {
      const hrSkill = this.getHRSkillLevel();
      const hiredHRCount = (this.hiredStaff || []).filter(s => 
        s.id.startsWith('h') && s.id !== this.team.hr?.id
      ).length;
      
      let hrNote = '';
      if (this.team.hr && hrSkill >= 3) {
        if (hiredHRCount > 0) {
          hrNote = ` (${this.team.hr.name.split(' ').pop()} + ${hiredHRCount} HR staff supporting)`;
        } else {
          hrNote = ` (${this.team.hr.name.split(' ').pop()} accelerating onboarding)`;
        }
      } else if (hiredHRCount > 0) {
        hrNote = ` (${hiredHRCount} HR staff supporting)`;
      }
      this.log(`ğŸ‘¥ Staff contributions: ${contribParts.join(', ')}${hrNote}`);
    }
    
    // Decay hiring disruption at end of quarter
    this.decayHiringDisruption();
  }
  
  // Get founder experience bonus for investor relations
  // Experienced founders get better starting relationships and more patience from investors
  // Inexperienced founders start lower and have less margin for error
  getFounderExperienceBonus() {
    if (!this.founder?.profile?.id) return 0;
    
    const profileId = this.founder.profile.id;
    
    // Experienced profiles: get +1 starting relationship
    const experiencedProfiles = ['serial', 'corporate', 'domain', 'strategist'];
    if (experiencedProfiles.includes(profileId)) return 1;
    
    // Moderately experienced: neutral (no bonus)
    const neutralProfiles = ['academic', 'operator', 'dealmaker', 'bootstrapper', 'community'];
    if (neutralProfiles.includes(profileId)) return 0;
    
    // Inexperienced: -1 starting relationship, less patience
    const inexperiencedProfiles = ['firsttimer', 'prodigy', 'visionary'];
    if (inexperiencedProfiles.includes(profileId)) return -1;
    
    return 0;
  }
  
  // Get founder bonus for milestone progress based on profile match
  // Returns a small percentage reduction in effective targets (0.05 = 5% easier)
  getFounderMilestoneBonus(threshold) {
    if (!this.founder?.profile?.id || !threshold) return 0;
    
    const profileId = this.founder.profile.id;
    const metrics = Object.keys(threshold);
    
    // Calculate which metric is dominant in this milestone
    const maxWeight = Math.max(...Object.values(threshold));
    let dominantMetric = null;
    Object.entries(threshold).forEach(([metric, weight]) => {
      if (weight === maxWeight) dominantMetric = metric;
    });
    
    // Research-heavy milestones (sci dominant)
    if (dominantMetric === 'sci' || (metrics.includes('sci') && threshold.sci >= 40)) {
      const researchProfiles = ['academic', 'prodigy', 'strategist'];
      if (researchProfiles.includes(profileId)) return 0.05; // 5% easier
    }
    
    // Commercial/Sales milestones (mkt dominant)
    if (dominantMetric === 'mkt' || (metrics.includes('mkt') && threshold.mkt >= 40)) {
      const commercialProfiles = ['dealmaker', 'domain', 'community', 'corporate'];
      if (commercialProfiles.includes(profileId)) return 0.05;
    }
    
    // Product/Dev milestones (dev dominant)
    if (dominantMetric === 'dev' || (metrics.includes('dev') && threshold.dev >= 40)) {
      const productProfiles = ['prodigy', 'operator', 'serial'];
      if (productProfiles.includes(profileId)) return 0.05;
    }
    
    // Operational/Team milestones (hr present)
    if (metrics.includes('hr') && threshold.hr >= 30) {
      const operationalProfiles = ['operator', 'corporate', 'visionary', 'community'];
      if (operationalProfiles.includes(profileId)) return 0.05;
    }
    
    // Serial founders get a small bonus on all later milestones (learned from experience)
    if (profileId === 'serial' && this.completedMilestones.length >= 1) {
      return 0.03; // 3% easier on M2 and M3
    }
    
    // First-timers get adaptability bonus on pivots/later milestones
    if (profileId === 'firsttimer' && this.completedMilestones.length >= 2) {
      return 0.04; // 4% easier on M3 (learning fast!)
    }
    
    return 0;
  }

  getEstCost() {
    let cost = this.metrics.burn;
    Object.entries(this.choices).forEach(([d, i]) => {
      if (i === -1) return; // Pass costs Â£0
      const eventData = this.currentEvents[d];
      if (eventData?.event) cost += eventData.event.choices[i].cost;
    });
    return cost;
  }

  allChosen() {
    const domains = this.team.hr ? ["research", "dev", "marketing", "hr"] : ["research", "dev", "marketing"];
    return domains.every(d => this.choices[d] !== undefined);
  }

  // ===== RUNWAY WARNING SYSTEM =====
  // Checks if committing would lead to lethal runway and warns player
  tryCommitTurn() {
    // === COMBINED PRE-COMMIT REVIEW ===
    // Check all issues at once and show combined modal if any exist
    const issues = this.checkPreCommitIssues();
    
    if (issues.hasIssues) {
      this.showPreCommitReview(issues);
    } else {
      this.commitTurn();
    }
  }
  
  checkPreCommitIssues() {
    const issues = {
      hasIssues: false,
      spreadThin: false,
      spreadStreak: 0,
      lowRunway: false,
      projectedRunway: 0
    };
    
    // Check for spread thin allocation
    if (this.isSpreadThin()) {
      issues.hasIssues = true;
      issues.spreadThin = true;
      issues.spreadStreak = this.focusTracking.consecutiveSpreadQuarters + 1;
    }
    
    // Check for low runway
    const projectedRunway = this.calculateProjectedRunway();
    if (projectedRunway < 1 && !this.hasPendingFundingEvent()) {
      issues.hasIssues = true;
      issues.lowRunway = true;
      issues.projectedRunway = projectedRunway;
    }
    
    return issues;
  }
  
  showPreCommitReview(issues) {
    const modal = document.getElementById("preCommitReviewModal");
    const header = document.getElementById("preCommitHeader");
    const icon = document.getElementById("preCommitIcon");
    const title = document.getElementById("preCommitTitle");
    const runwayIssue = document.getElementById("preCommitRunwayIssue");
    const focusIssue = document.getElementById("preCommitFocusIssue");
    const runwayValue = document.getElementById("preCommitRunwayValue");
    const focusStreak = document.getElementById("preCommitFocusStreak");
    const streakCount = document.getElementById("preCommitStreakCount");
    const suggestions = document.getElementById("preCommitSuggestions");
    const proceedBtn = document.getElementById("preCommitProceedBtn");
    
    // Determine severity for header styling
    const isCritical = issues.lowRunway;
    
    if (isCritical) {
      header.className = "bg-gradient-to-r from-red-600 to-rose-600 text-white p-4";
      icon.textContent = "ğŸš¨";
      title.textContent = "Critical Issues Detected";
      proceedBtn.className = "flex-1 py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-xl transition-all";
    } else {
      header.className = "bg-gradient-to-r from-amber-500 to-orange-500 text-white p-4";
      icon.textContent = "âš ï¸";
      title.textContent = "Review Your Choices";
      proceedBtn.className = "flex-1 py-3 bg-amber-500 hover:bg-amber-600 text-white font-bold rounded-xl transition-all";
    }
    
    // Show/hide runway issue
    if (issues.lowRunway) {
      runwayIssue.classList.remove("hidden");
      const runwayText = issues.projectedRunway <= 0 ? "0 quarters (bankruptcy risk!)" : `${issues.projectedRunway} quarter`;
      runwayValue.textContent = runwayText;
    } else {
      runwayIssue.classList.add("hidden");
    }
    
    // Show/hide focus issue
    if (issues.spreadThin) {
      focusIssue.classList.remove("hidden");
      if (issues.spreadStreak >= 2) {
        focusStreak.classList.remove("hidden");
        streakCount.textContent = issues.spreadStreak;
      } else {
        focusStreak.classList.add("hidden");
      }
    } else {
      focusIssue.classList.add("hidden");
    }
    
    // Update suggestions based on issues
    const suggestionParts = [];
    if (issues.lowRunway) {
      suggestionParts.push("Consider raising funding or choosing revenue-generating options.");
    }
    if (issues.spreadThin) {
      suggestionParts.push("Try concentrating AP in fewer domains for more impact.");
    }
    suggestions.textContent = suggestionParts.join(" ") || "Consider adjusting your choices before committing.";
    
    // Store issues for confirm handler
    this.pendingPreCommitIssues = issues;
    
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  }
  
  cancelPreCommitReview() {
    const modal = document.getElementById("preCommitReviewModal");
    modal.classList.add("hidden");
    modal.classList.remove("flex");
    this.pendingPreCommitIssues = null;
    // Player goes back to adjust choices
  }
  
  confirmPreCommitReview() {
    const modal = document.getElementById("preCommitReviewModal");
    modal.classList.add("hidden");
    modal.classList.remove("flex");
    
    // Mark if we're proceeding with spread allocation
    if (this.pendingPreCommitIssues?.spreadThin) {
      this.focusTracking.proceedingWithSpread = true;
    }
    
    this.pendingPreCommitIssues = null;
    
    // Proceed with commit
    this.commitTurn();
  }
  
  // LEGACY: Keep old functions for compatibility but they redirect to new system
  proceedAfterFocusCheck() {
    // Now handled by combined pre-commit review
    this.tryCommitTurn();
  }
  
  showFocusWarning() {
    // Redirect to combined modal
    const issues = this.checkPreCommitIssues();
    issues.spreadThin = true;
    issues.hasIssues = true;
    this.showPreCommitReview(issues);
  }
  
  cancelFocusWarning() {
    this.cancelPreCommitReview();
  }
  
  confirmFocusWarning() {
    this.focusTracking.proceedingWithSpread = true;
    this.confirmPreCommitReview();
  }
  
  showRunwayWarning(projectedRunway) {
    // Redirect to combined modal
    const issues = this.checkPreCommitIssues();
    issues.lowRunway = true;
    issues.projectedRunway = projectedRunway;
    issues.hasIssues = true;
    this.showPreCommitReview(issues);
  }
  
  cancelRunwayWarning() {
    this.cancelPreCommitReview();
  }
  
  confirmRunwayWarning() {
    this.confirmPreCommitReview();
  }
  
  // ===== STRATEGIC FOCUS SYSTEM =====
  // Detects if player is spreading AP too thin (even allocation)
  
  isSpreadThin() {
    const domains = ["research", "dev", "marketing"];
    if (this.team.hr) domains.push("hr");
    
    const apByDomain = domains.map(d => {
      const choice = this.choices[d];
      if (choice === undefined || choice === -1) return 0; // Pass = 0 AP
      const eventData = this.currentEvents[d];
      return eventData?.event?.options?.[choice]?.ap || 0;
    });
    
    const nonZeroAP = apByDomain.filter(a => a > 0);
    const totalAP = apByDomain.reduce((a, b) => a + b, 0);
    const max = Math.max(...apByDomain);
    const min = nonZeroAP.length > 0 ? Math.min(...nonZeroAP) : 0;
    
    // Not spread thin if:
    // - Using AP in 2 or fewer domains
    // - One domain has 3+ more AP than others (focused)
    // - Total AP is very low (passing a lot)
    if (nonZeroAP.length <= 2) return false;
    if (max - min >= 2) return false;
    if (totalAP <= 3) return false;
    
    // Spread thin if: 3+ domains have similar AP (max-min â‰¤ 1) and each has at least 1 AP
    return nonZeroAP.length >= 3 && (max - min) <= 1 && min >= 1;
  }
  
  isFocused() {
    // Returns the focused domain if highly focused, null otherwise
    const domains = ["research", "dev", "marketing"];
    if (this.team.hr) domains.push("hr");
    
    const apByDomain = {};
    domains.forEach(d => {
      const choice = this.choices[d];
      if (choice === undefined || choice === -1) {
        apByDomain[d] = 0;
      } else {
        const eventData = this.currentEvents[d];
        apByDomain[d] = eventData?.event?.options?.[choice]?.ap || 0;
      }
    });
    
    // Find max and second max
    const sorted = Object.entries(apByDomain).sort((a, b) => b[1] - a[1]);
    const [topDomain, topAP] = sorted[0];
    const secondAP = sorted[1] ? sorted[1][1] : 0;
    
    // Focused if: top domain has 3+ AP AND is at least 2 AP more than second
    if (topAP >= 3 && (topAP - secondAP) >= 2) {
      return topDomain;
    }
    return null;
  }
  
  showFocusWarning() {
    const modal = document.getElementById("focusWarningModal");
    const streakWarning = document.getElementById("focusStreakWarning");
    const streakCount = document.getElementById("focusStreakCount");
    
    // Show streak warning if consecutive spread quarters >= 2
    if (this.focusTracking.consecutiveSpreadQuarters >= 1) {
      streakWarning.classList.remove("hidden");
      streakCount.textContent = this.focusTracking.consecutiveSpreadQuarters + 1; // Including this one
    } else {
      streakWarning.classList.add("hidden");
    }
    
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  }
  
  cancelFocusWarning() {
    const modal = document.getElementById("focusWarningModal");
    modal.classList.add("hidden");
    modal.classList.remove("flex");
    // Player goes back to adjust choices
  }
  
  confirmFocusWarning() {
    const modal = document.getElementById("focusWarningModal");
    modal.classList.add("hidden");
    modal.classList.remove("flex");
    
    // Mark that we're proceeding with spread allocation
    this.focusTracking.proceedingWithSpread = true;
    
    // Continue to runway check
    this.proceedAfterFocusCheck();
  }
  
  processFocusTracking() {
    // Called at end of commitTurn to update tracking and determine multiplier
    const wasSpread = this.focusTracking.proceedingWithSpread || this.isSpreadThin();
    const focusedDomain = this.isFocused();
    
    // Reset the proceed flag
    this.focusTracking.proceedingWithSpread = false;
    
    if (wasSpread) {
      // Spread thin quarter
      this.focusTracking.consecutiveSpreadQuarters++;
      this.focusTracking.totalSpreadQuarters++;
      this.focusTracking.lastQuarterFocused = false;
      this.focusTracking.currentEfficiencyMultiplier = 0.9; // -10% effectiveness
      
      this.log("ğŸ“‰ Diluted effort: spreading attention thin reduced effectiveness this quarter.");
      
      // Check for Strategic Drift event trigger
      if (this.focusTracking.consecutiveSpreadQuarters >= 3) {
        this.triggerStrategicDriftEvent();
      } else if (this.focusTracking.consecutiveSpreadQuarters >= 2) {
        // Investor relationship hit at 2 consecutive spread quarters
        this.updateInvestorRelationship(-1, "lack of strategic focus");
        this.log("ğŸ˜• Your investors are concerned about lack of strategic focus.");
      }
      
      return 0.9; // Return multiplier for this quarter
      
    } else if (focusedDomain) {
      // Highly focused quarter - bonus!
      this.focusTracking.consecutiveSpreadQuarters = 0;
      this.focusTracking.lastQuarterFocused = true;
      this.focusTracking.currentEfficiencyMultiplier = 1.1; // +10% effectiveness
      
      // Show momentum toast
      this.showMomentumBonus(focusedDomain);
      
      // If recovering from spread, note it
      if (this.focusTracking.totalSpreadQuarters > 0) {
        this.log("ğŸ¯ Focused effort! Your team appreciates the clear priorities.");
      }
      
      return 1.1; // Return multiplier for this quarter
      
    } else {
      // Normal quarter (neither spread thin nor highly focused)
      this.focusTracking.consecutiveSpreadQuarters = 0;
      this.focusTracking.lastQuarterFocused = false;
      this.focusTracking.currentEfficiencyMultiplier = 1.0;
      
      return 1.0;
    }
  }
  
  showMomentumBonus(focusedDomain) {
    // CONSOLIDATED: Now log-only, no toast popup
    const domainLabels = { research: "Research", dev: "Product", marketing: "Sales & Marketing", hr: "People" };
    this.log(`ğŸ¯ Focused effort in ${domainLabels[focusedDomain]}! +10% effectiveness this quarter.`);
  }
  
  // === STRATEGIC DRIFT EVENTS ===
  triggerStrategicDriftEvent() {
    const events = [
      {
        id: "team_confusion",
        title: "Team Confusion",
        message: "With priorities scattered across too many fronts, teams are stepping on each other's toes. Work is being duplicated and dropped.",
        icon: "ğŸ˜µ",
        effect: () => {
          // -1 to two random metrics
          const metrics = ["sci", "dev", "mkt", "hr"].filter(m => this.metrics[m] > 0);
          const shuffled = metrics.sort(() => Math.random() - 0.5);
          shuffled.slice(0, 2).forEach(m => {
            this.metrics[m] = Math.max(0, this.metrics[m] - 1);
          });
          // +Â£10k burn for coordination overhead
          this.metrics.burn += 10;
        },
        effectText: "âˆ’1 to two random metrics, +Â£10k burn this quarter"
      },
      {
        id: "competitor_surge",
        title: "Competitor Surge",
        message: "While you spread resources thin, a competitor noticed and doubled down. They're pulling ahead in the market.",
        icon: "ğŸƒ",
        effect: () => {
          // Boost a random active rival
          const activeRival = this.rivals?.find(r => r.status === "active");
          if (activeRival) {
            activeRival.progress = Math.min(100, (activeRival.progress || 50) + 15);
          }
          // Small valuation hit
          this.metrics.val = Math.max(0, this.metrics.val - 30);
        },
        effectText: "Rival gains +15% progress, âˆ’Â£30k valuation"
      },
      {
        id: "investor_concern",
        title: "Investor Concern",
        message: "Your lead investor requests an urgent call. 'We need to discuss strategic clarity. The board is getting concerned.'",
        icon: "ğŸ“",
        effect: () => {
          this.updateInvestorRelationship(-1, "strategic drift concerns");
        },
        effectText: "Investor relationship decreased"
      },
      {
        id: "talent_friction",
        title: "Talent Friction",
        message: "Your best engineer pulls you aside: 'We start everything and finish nothing. People are getting frustrated.'",
        icon: "ğŸ˜¤",
        effect: () => {
          // Random exec mood -2
          const execs = ["research", "dev", "marketing"];
          const randomExec = execs[Math.floor(Math.random() * execs.length)];
          if (this.moods[randomExec] !== undefined) {
            this.moods[randomExec] = Math.max(-3, this.moods[randomExec] - 2);
          }
          // Small HR hit
          this.metrics.hr = Math.max(0, this.metrics.hr - 1);
        },
        effectText: "One exec mood âˆ’2, âˆ’1 People"
      },
      {
        id: "missed_opportunity",
        title: "Missed Opportunity",
        message: "A partnership opportunity slipped away while the team was stretched thin. 'They went with a more focused competitor.'",
        icon: "ğŸ’¨",
        effect: () => {
          // Would have gained cash/val
          this.metrics.mkt = Math.max(0, this.metrics.mkt - 1);
        },
        effectText: "Lost partnership opportunity, âˆ’1 Sales"
      }
    ];
    
    // Filter to events not yet triggered
    const available = events.filter(e => !this.focusTracking.spreadEventsTriggered.includes(e.id));
    if (available.length === 0) return;
    
    // Pick random event
    const event = available[Math.floor(Math.random() * available.length)];
    this.focusTracking.spreadEventsTriggered.push(event.id);
    
    // Apply effect
    event.effect();
    
    // Show as life event modal
    this.showStrategicDriftModal(event);
    
    this.log(`âš ï¸ Strategic Drift: ${event.title} - ${event.effectText}`);
  }
  
  showStrategicDriftModal(event) {
    // Reuse life event modal structure
    const modal = document.getElementById("lifeEventModal");
    const icon = document.getElementById("lifeEventIcon");
    const title = document.getElementById("lifeEventTitle");
    const text = document.getElementById("lifeEventText");
    const effect = document.getElementById("lifeEventEffect");
    const response = document.getElementById("lifeEventResponse");
    const continueBtn = document.getElementById("lifeEventContinue");
    
    if (!modal) {
      // Fallback to log if modal not available
      this.log(`âš ï¸ ${event.title}: ${event.message}`);
      return;
    }
    
    icon.textContent = event.icon;
    title.textContent = `Strategic Drift: ${event.title}`;
    title.className = "text-xl font-bold text-amber-800";
    text.textContent = event.message;
    effect.innerHTML = `<span class="text-amber-700 font-medium">${event.effectText}</span>`;
    
    // Hide response options, just show continue
    if (response) response.classList.add("hidden");
    continueBtn.textContent = "Understood";
    continueBtn.className = "w-full py-3 bg-amber-600 hover:bg-amber-700 text-white font-bold rounded-xl transition-all";
    
    // Set up dismiss handler
    const newBtn = continueBtn.cloneNode(true);
    continueBtn.parentNode.replaceChild(newBtn, continueBtn);
    newBtn.addEventListener('click', () => {
      modal.classList.add("hidden");
      modal.classList.remove("flex");
    });
    
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  }
  
  calculateProjectedRunway() {
    // Calculate total cost this quarter (burn + choice costs)
    let totalCost = this.metrics.burn;
    Object.entries(this.choices).forEach(([d, i]) => {
      if (i === -1) return;
      const eventData = this.currentEvents[d];
      if (eventData?.event?.choices?.[i]) {
        totalCost += eventData.event.choices[i].cost || 0;
      }
    });
    
    // Calculate cash after this quarter
    const cashAfter = this.metrics.cash - totalCost;
    
    // Calculate runway (quarters of cash remaining)
    if (this.metrics.burn <= 0) return 99; // No burn = infinite runway
    return Math.floor(cashAfter / this.metrics.burn);
  }
  
  hasPendingFundingEvent() {
    // Check if there's an active funding round or cash injection pending
    // This is a simple check - could be expanded
    return this.pendingFunding || this.raisingFunds || false;
  }
  
  showRunwayWarning(projectedRunway) {
    const modal = document.getElementById("runwayWarningModal");
    const valueEl = document.getElementById("runwayWarningValue");
    
    if (valueEl) {
      const runwayText = projectedRunway <= 0 
        ? "0 quarters (bankruptcy risk!)" 
        : `${projectedRunway} quarter${projectedRunway !== 1 ? 's' : ''}`;
      valueEl.textContent = runwayText;
    }
    
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  }
  
  cancelRunwayWarning() {
    const modal = document.getElementById("runwayWarningModal");
    modal.classList.add("hidden");
    modal.classList.remove("flex");
  }
  
  confirmRunwayWarning() {
    const modal = document.getElementById("runwayWarningModal");
    modal.classList.add("hidden");
    modal.classList.remove("flex");
    
    // Proceed with the commit
    this.commitTurn();
  }
  
  // ===== CHAPTER/PACING SYSTEM =====
  // Shows chapter labels at key quarter milestones
  getChapterInfo(quarter) {
    if (quarter >= 12) {
      return { num: 3, title: "Chapter 3", subtitle: "Towards exit", icon: "ğŸš€" };
    } else if (quarter >= 6) {
      return { num: 2, title: "Chapter 2", subtitle: "Scaling up", icon: "ğŸ“ˆ" };
    } else {
      return { num: 1, title: "Chapter 1", subtitle: "Finding productâ€“market fit", icon: "ğŸ”" };
    }
  }
  
  updateChapterLabel() {
    const chapterLabel = document.getElementById("chapterLabel");
    if (!chapterLabel) return;
    
    const chapter = this.getChapterInfo(this.turn);
    this.currentChapter = chapter.num;
    chapterLabel.textContent = `Ch.${chapter.num}`;
    
    // Update color based on chapter
    if (chapter.num === 1) {
      chapterLabel.className = "text-[9px] text-indigo-400 font-medium";
    } else if (chapter.num === 2) {
      chapterLabel.className = "text-[9px] text-emerald-400 font-medium";
    } else {
      chapterLabel.className = "text-[9px] text-amber-400 font-medium";
    }
  }
  
  maybeShowChapterToast() {
    // DISABLED: Chapter info is now shown in Situation Brief
    // Keeping function for backward compatibility but it does nothing
    return;
  }
  
  showChapterToast(chapterNum) {
    const toast = document.getElementById("chapterToast");
    const iconEl = document.getElementById("chapterToastIcon");
    const titleEl = document.getElementById("chapterToastTitle");
    const subtitleEl = document.getElementById("chapterToastSubtitle");
    
    if (!toast || !iconEl || !titleEl || !subtitleEl) return;
    
    const chapter = this.getChapterInfo(chapterNum === 1 ? 1 : chapterNum === 2 ? 6 : 12);
    
    iconEl.textContent = chapter.icon;
    titleEl.textContent = chapter.title;
    subtitleEl.textContent = chapter.subtitle;
    
    // Update toast color based on chapter
    const card = toast.querySelector("div");
    if (card) {
      if (chapterNum === 1) {
        card.className = "bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-4 rounded-xl shadow-2xl border border-indigo-400";
      } else if (chapterNum === 2) {
        card.className = "bg-gradient-to-r from-emerald-600 to-teal-600 text-white px-6 py-4 rounded-xl shadow-2xl border border-emerald-400";
      } else {
        card.className = "bg-gradient-to-r from-amber-500 to-orange-500 text-white px-6 py-4 rounded-xl shadow-2xl border border-amber-400";
      }
    }
    
    // Show toast with animation
    toast.classList.remove("hidden");
    toast.style.opacity = "0";
    toast.style.transform = "translate(-50%, -20px)";
    
    // Animate in
    requestAnimationFrame(() => {
      toast.style.transition = "opacity 0.5s ease-out, transform 0.5s ease-out";
      toast.style.opacity = "1";
      toast.style.transform = "translate(-50%, 0)";
    });
    
    // Hide after 3 seconds
    setTimeout(() => {
      toast.style.opacity = "0";
      toast.style.transform = "translate(-50%, -20px)";
      setTimeout(() => {
        toast.classList.add("hidden");
      }, 500);
    }, 3000);
  }
  
  // ===== INVESTOR RELATIONSHIP METER =====
  // Simple 0-3 scale: 0=Skeptical, 1=Neutral, 2=Supportive, 3=Champion
  getRelationshipLabel(level) {
    const labels = {
      0: { text: "Skeptical", emoji: "ğŸ˜", color: "text-slate-500", bg: "bg-slate-100" },
      1: { text: "Neutral", emoji: "ğŸ¤", color: "text-blue-600", bg: "bg-blue-100" },
      2: { text: "Supportive", emoji: "ğŸ˜Š", color: "text-emerald-600", bg: "bg-emerald-100" },
      3: { text: "Champion", emoji: "ğŸŒŸ", color: "text-amber-600", bg: "bg-amber-100" }
    };
    return labels[Math.max(0, Math.min(3, level))] || labels[1];
  }
  
  updateInvestorRelationship(change, reason) {
    const oldLevel = this.investorRelationship;
    this.investorRelationship = Math.max(0, Math.min(3, this.investorRelationship + change));
    
    // Only log if actually changed
    if (this.investorRelationship !== oldLevel) {
      const rel = this.getRelationshipLabel(this.investorRelationship);
      if (change > 0) {
        this.log(`${rel.emoji} Investor relationship improved: ${rel.text}`);
      } else {
        this.log(`${rel.emoji} Investor relationship declined: ${rel.text}`);
      }
      this.lastRelationshipChange = this.turn;
    }
  }

  commitTurn() {
    let totalCost = this.metrics.burn;
    let researchBreakthrough = false;
    let researchSetback = false;
    
    // === REVENUE SYSTEM: Process at start of quarter ===
    if (this.revenueModel) {
      this.processCustomerChurn();
      this.processPipeline();
      this.processGrantApplications();
    }
    
    // === STRATEGIC FOCUS: Calculate efficiency multiplier ===
    const focusMultiplier = this.processFocusTracking();
    
    // Count passes this quarter
    let passesThisQuarter = 0;
    Object.entries(this.choices).forEach(([d, i]) => {
      if (i === -1) passesThisQuarter++;
    });
    this.totalPasses += passesThisQuarter;
    
    // Track decision outcomes for feedback display
    this.lastTurnOutcomes = [];
    const metricsBefore = { ...this.metrics };

    // Apply choices
    Object.entries(this.choices).forEach(([d, i]) => {
      const exec = this.team[d];
      const eventData = this.currentEvents[d];
      if (!eventData?.event) return;
      
      // Track this decision's outcome
      const outcome = {
        domain: d,
        executive: exec,
        event: eventData.event,
        choiceIndex: i,
        isPass: i === -1,
        expectedEffects: {},
        actualEffects: {},
        choiceText: i === -1 ? "Passed" : eventData.event.choices[i].text
      };
      
      // Handle pass choice - reduced penalty, still gives tiny progress
      if (i === -1) {
        this.moods[d] = Math.max(-3, this.moods[d] - 0.5); // Reduced mood penalty
        // Still get a tiny bit of progress from background work
        const domainMetric = d === "research" ? "sci" : d === "dev" ? "dev" : d === "marketing" ? "mkt" : "hr";
        outcome.actualEffects[domainMetric] = 1;
        outcome.expectedEffects[domainMetric] = 0;
        this.metrics[domainMetric] = Math.max(0, this.metrics[domainMetric] + 1);
        this.log(`${exec.name.split(" ").pop()}: "Working on other things..." ğŸ˜`);
        this.lastTurnOutcomes.push(outcome);
        return;
      }
      
      const c = eventData.event.choices[i];
      totalCost += c.cost;
      const isResearch = (d === "research");
      
      // Store expected effects before volatility
      outcome.expectedEffects = { ...c.eff };
      
      Object.entries(c.eff).forEach(([k, v]) => {
        // Apply volatility - research gets skewed distribution
        let adjustedValue = this.applyVolatility(v, isResearch);
        
        // Progress multiplier for core metrics to make choices more impactful
        // This reflects compound growth from good decisions
        if (['sci', 'dev', 'mkt'].includes(k) && adjustedValue > 0) {
          const progressMultiplier = 1.5; // 50% bonus to positive core metric gains
          adjustedValue = Math.round(adjustedValue * progressMultiplier);
        }
        
        // === STRATEGIC FOCUS: Apply efficiency multiplier ===
        // Positive effects are scaled by focus multiplier
        if (adjustedValue > 0 && ['sci', 'dev', 'mkt', 'hr'].includes(k)) {
          adjustedValue = Math.round(adjustedValue * focusMultiplier);
        }
        
        // === CEO STRATEGIC FOCUS: Apply quarterly focus bonuses/penalties ===
        if (this.strategicFocus && adjustedValue !== 0) {
          const ceoFocus = this.STRATEGIC_FOCUSES[this.strategicFocus];
          if (ceoFocus) {
            // Apply bonuses
            if (ceoFocus.bonus) {
              if (ceoFocus.bonus.sci && k === 'sci' && adjustedValue > 0) {
                adjustedValue = Math.round(adjustedValue * ceoFocus.bonus.sci);
              }
              if (ceoFocus.bonus.dev && k === 'dev' && adjustedValue > 0) {
                adjustedValue = Math.round(adjustedValue * ceoFocus.bonus.dev);
              }
              if (ceoFocus.bonus.mkt && k === 'mkt' && adjustedValue > 0) {
                adjustedValue = Math.round(adjustedValue * ceoFocus.bonus.mkt);
              }
            }
            // Apply penalties
            if (ceoFocus.penalty) {
              if (ceoFocus.penalty.sci && k === 'sci' && adjustedValue > 0) {
                adjustedValue = Math.round(adjustedValue * ceoFocus.penalty.sci);
              }
              if (ceoFocus.penalty.dev && k === 'dev' && adjustedValue > 0) {
                adjustedValue = Math.round(adjustedValue * ceoFocus.penalty.dev);
              }
              if (ceoFocus.penalty.mkt && k === 'mkt' && adjustedValue > 0) {
                adjustedValue = Math.round(adjustedValue * ceoFocus.penalty.mkt);
              }
            }
          }
        }
        
        // === HASTY DECISION: Apply hasty penalty for rushed choices ===
        // If this domain's choice was made too quickly, reduce effectiveness
        if (adjustedValue > 0) {
          const hastyMultiplier = this.getHastyMultiplier(d);
          if (hastyMultiplier < 1) {
            adjustedValue = Math.round(adjustedValue * hastyMultiplier);
          }
        }
        
        // Founder profile bonuses for domain expertise
        if (this.founderBonuses) {
          // Technical bonus: +15% to science gains in research domain
          if (d === "research" && k === "sci" && adjustedValue > 0 && this.founderBonuses.technical > 2) {
            const techBonus = 1 + ((this.founderBonuses.technical - 2) * 0.15);
            adjustedValue = Math.round(adjustedValue * techBonus);
          }
          // Commercial bonus: +15% to marketing gains in sales domain
          if (d === "marketing" && k === "mkt" && adjustedValue > 0 && this.founderBonuses.commercial > 2) {
            const commBonus = 1 + ((this.founderBonuses.commercial - 2) * 0.15);
            adjustedValue = Math.round(adjustedValue * commBonus);
          }
        }
        
        // === STAFF EFFECTIVENESS: Department staffing bonus ===
        // Hired staff in a department boost event outcomes (+5% per staff, max +20%)
        if (adjustedValue > 0 && ['sci', 'dev', 'mkt', 'hr'].includes(k)) {
          const deptMultiplier = this.getDepartmentMultiplier(d);
          if (deptMultiplier > 1) {
            adjustedValue = Math.round(adjustedValue * deptMultiplier);
          }
        }
        
        // Track actual effect after volatility
        outcome.actualEffects[k] = adjustedValue;
        
        // Track if research had a breakthrough or setback
        if (isResearch && k === "sci" && v > 0) {
          if (adjustedValue >= v * 1.4) researchBreakthrough = true;
          if (adjustedValue <= v * 0.6) researchSetback = true;
        }
        
        if (k === "cash") this.metrics.cash += adjustedValue;
        else if (k === "equity") {
          // Apply equity changes (negative = dilution)
          this.metrics.equity = Math.max(0, this.metrics.equity + adjustedValue);
          if (adjustedValue < 0) {
            this.log(`ğŸ“‰ Equity diluted by ${Math.abs(adjustedValue)}% (now ${this.metrics.equity.toFixed(1)}%)`);
          }
        }
        else if (this.metrics[k] !== undefined) this.metrics[k] = Math.max(0, this.metrics[k] + adjustedValue);
      });
      if (c.mood !== undefined) this.moods[d] = Math.max(-3, Math.min(3, this.moods[d] + c.mood));
      
      // Apply rival effects from competitive events
      if (c.rivalEffect && eventData.event.rivalRef) {
        this.applyRivalEffect(eventData.event.rivalRef, c.rivalEffect);
      }
      
      // === REVENUE SYSTEM: Process revenue effects from choice ===
      if (c.revenueEffect) {
        this.processRevenueEffect(c.revenueEffect);
      }
      
      this.log(`${exec.name.split(" ").pop()}: "${c.reaction.substring(0, 35)}..."`);
      this.lastTurnOutcomes.push(outcome);
    });

    // Special message for research breakthroughs
    if (researchBreakthrough) {
      const breakthroughMessages = [
        "ğŸ”¬ Eureka! The research team made an unexpected breakthrough!",
        "âœ¨ Research exceeded expectations - promising early results!",
        "ğŸ¯ The hypothesis paid off - significant progress in the lab!",
        "ğŸ’¡ A late-night insight led to accelerated research outcomes!",
        "ğŸ§ª Experimental results came in stronger than projected!"
      ];
      this.log(breakthroughMessages[Math.floor(Math.random() * breakthroughMessages.length)]);
    }
    
    // Special message for research setbacks
    if (researchSetback && !researchBreakthrough) {
      const setbackMessages = [
        "ğŸ”¬ Research hit some snags - experiments didn't replicate as hoped.",
        "ğŸ“‰ The research direction proved less fruitful than expected.",
        "ğŸ§ª Lab results were inconclusive - back to the drawing board.",
        "âš  A promising hypothesis didn't pan out this quarter.",
        "ğŸ”„ Research pivot needed - initial approach hit a dead end."
      ];
      this.log(setbackMessages[Math.floor(Math.random() * setbackMessages.length)]);
    }

    // Occasional flavour messages about market unpredictability (15% chance)
    if (Math.random() < 0.15) {
      const volatilityMessages = [
        "ğŸ“Š Market conditions shifted unexpectedly this quarter.",
        "ğŸ² Some initiatives performed differently than projected.",
        "ğŸ“ˆ External factors influenced outcomes this quarter.",
        "ğŸŒŠ The startup landscape proved unpredictable as usual.",
        "âš¡ Results varied from forecasts - such is startup life.",
        "ğŸ¯ Some bets paid off better than expected, others less so."
      ];
      this.log(volatilityMessages[Math.floor(Math.random() * volatilityMessages.length)]);
    }

    // No passive bonuses - progress comes from deliberate choices only
    // This reflects real startups: nothing happens without action

    // Check if funder advice was followed
    this.checkFunderAdvice();

    // ===== DISENGAGED PLAY DETECTION =====
    // Penalize players who skip too many choices
    const domains = this.team.hr ? 4 : 3;
    const passThreshold = domains >= 4 ? 3 : 2; // 3 passes with 4 domains, 2 with 3 domains
    
    if (passesThisQuarter >= passThreshold) {
      this.consecutiveHighPassQuarters++;
      
      if (this.consecutiveHighPassQuarters === 2 && !this.passWarningShown) {
        // First warning
        this.passWarningShown = true;
        this.log("âš  Your team is losing confidence. They need leadership, not silence.");
        this.log("ğŸ’¡ Skipping too many decisions will lead to problems...");
      } else if (this.consecutiveHighPassQuarters === 3) {
        // Serious consequences - investors notice
        this.log("ğŸ˜  Investors are questioning your engagement with the company.");
        this.log("ğŸ“‰ Team morale is suffering from lack of direction.");
        // Metric penalties
        this.metrics.hr = Math.max(0, this.metrics.hr - 10);
        this.metrics.val = Math.round(this.metrics.val * 0.9); // 10% valuation hit
        Object.keys(this.moods).forEach(d => {
          this.moods[d] = Math.max(-3, this.moods[d] - 1);
        });
      } else if (this.consecutiveHighPassQuarters >= 4) {
        // Critical - board intervention
        this.log("ğŸš¨ BOARD INTERVENTION: Your investors have lost confidence in your leadership.");
        this.log("ğŸ’” Key team members are looking for other opportunities.");
        // Severe penalties
        this.metrics.hr = Math.max(0, this.metrics.hr - 15);
        this.metrics.sci = Math.max(0, this.metrics.sci - 10);
        this.metrics.dev = Math.max(0, this.metrics.dev - 10);
        this.metrics.mkt = Math.max(0, this.metrics.mkt - 10);
        this.metrics.val = Math.round(this.metrics.val * 0.8); // 20% valuation hit
        this.metrics.burn += 20; // Higher costs due to turnover
        
        // After 5 consecutive quarters of disengagement, force early exit
        if (this.consecutiveHighPassQuarters >= 5) {
          this.log("ğŸ’€ The board has voted to remove you as CEO. Game over.");
          this.endGame("disengaged");
          return;
        }
      }
    } else {
      // Reset consecutive counter if player engages
      if (this.consecutiveHighPassQuarters > 0 && passesThisQuarter === 0) {
        this.log("ğŸ‘ Your team appreciates your renewed focus and engagement.");
      }
      this.consecutiveHighPassQuarters = 0;
    }

    // === REVENUE SYSTEM: Calculate and apply revenue offset ===
    let revenueOffset = 0;
    if (this.revenueModel && this.customers.length > 0) {
      const revenueCalc = this.calculateQuarterlyRevenue();
      revenueOffset = revenueCalc.net;
      if (revenueOffset > 0) {
        this.log(`ğŸ“Š Revenue: Â£${revenueCalc.gross}k gross, Â£${revenueCalc.support}k support = Â£${revenueOffset}k net contribution`);
      }
      // Check revenue expectations periodically
      if (this.turn % 4 === 0) {
        this.checkRevenueExpectations();
      }
    }
    
    // === REVENUE SYSTEM: Update valuation based on ARR ===
    if (this.revenueModel && this.turn >= 4) {
      this.updateValuationFromRevenue();
    }
    
    // === REVENUE SYSTEM: Board sentiment check ===
    if (this.revenueModel && this.completedMilestones.length >= 1) {
      const boardSentiment = this.getBoardRevenueSentiment();
      if (boardSentiment.message && this.turn % 4 === 0) {
        this.log(`ğŸ“‹ ${boardSentiment.message}`);
      }
      // Apply investor relationship impact
      if (boardSentiment.investorPenalty) {
        // Track cumulative investor sentiment
        this.investorSentiment = (this.investorSentiment || 0) + boardSentiment.investorPenalty;
        if (this.investorSentiment <= -2) {
          this.log(`âš ï¸ Investor confidence is critically low. Consider a turnaround plan.`);
        }
      }
      if (boardSentiment.investorBonus) {
        this.investorSentiment = (this.investorSentiment || 0) + boardSentiment.investorBonus;
      }
    }
    
    // === CEO STRATEGIC FOCUS: Apply quarterly focus special effects ===
    if (this.strategicFocus) {
      const ceoFocus = this.STRATEGIC_FOCUSES[this.strategicFocus];
      if (ceoFocus) {
        // Efficiency focus: Reduce burn rate
        if (ceoFocus.bonus?.burnReduction) {
          const burnSavings = Math.round(this.metrics.burn * (1 - ceoFocus.bonus.burnReduction));
          if (burnSavings > 0) {
            totalCost = Math.max(0, totalCost - burnSavings);
            this.log(`âš¡ Lean operations: âˆ’${getRegion().currency}${burnSavings}k burn this quarter`);
          }
        }
        // Efficiency focus: Penalty to burn from other focuses
        if (ceoFocus.penalty?.burn) {
          const burnIncrease = Math.round(this.metrics.burn * (ceoFocus.penalty.burn - 1));
          if (burnIncrease > 0) {
            totalCost += burnIncrease;
          }
        }
        // Fundraising focus: Valuation boost
        if (ceoFocus.bonus?.valMultiplier) {
          const valBoost = Math.round(this.metrics.val * (ceoFocus.bonus.valMultiplier - 1));
          if (valBoost > 0) {
            this.metrics.val += valBoost;
          }
        }
        // Fundraising focus: Investor relationship boost
        if (ceoFocus.bonus?.investorRel) {
          this.investorRelationship = Math.min(3, this.investorRelationship + ceoFocus.bonus.investorRel);
        }
      }
    }
    
    // Apply costs minus revenue offset
    const netCost = Math.max(0, totalCost - revenueOffset);
    this.metrics.cash -= netCost;

    // === CHECK FOR CRISIS (instead of immediate bankruptcy) ===
    if (this.metrics.cash <= 0) {
      // Give player a chance to recover
      this.metrics.cash = Math.max(0, this.metrics.cash); // Floor at 0
      if (this.checkForCrisis()) {
        return; // Crisis modal will handle continuing the game
      }
    }
    
    // Low runway warning (check after cash update)
    const currentRunway = this.metrics.burn > 0 ? this.metrics.cash / this.metrics.burn : 99;
    if (currentRunway <= 1 && !this.failureState) {
      if (this.checkForCrisis()) {
        return;
      }
    }

    // End of game?
    if (this.turn >= 16) {
      this.endGame("completed");
      return;
    }

    // === STAFF PASSIVE CONTRIBUTION ===
    // Hired staff provide small ongoing benefits each quarter
    this.applyStaffPassiveContribution();

    // Rivals
    this.simulateRivals();
    
    // Check if a rival just overtook us - trigger market shift response
    if (this.pendingMarketShift && this.milestone) {
      const rival = this.pendingMarketShift.rival;
      this.pendingMarketShift = null; // Clear the flag
      this.showMarketShiftModal(rival);
      return; // Market shift modal will handle continuing the game
    }

    // Check for random shock event (25% chance per quarter, starting Q2)
    if (this.turn >= 2 && Math.random() < 0.25 && !this.pendingShock) {
      this.triggerRandomShock();
      return; // Shock modal will handle continuing the game
    }

    // Milestone check (after conference opportunity)
    if (this.milestone) {
      // Calculate progress based on thresholds
      if (this.milestone.threshold) {
        // New threshold-based system
        let totalProgress = 0;
        let thresholdCount = 0;
        let nearMissMetrics = []; // Track metrics that are close but not there
        
        // Get founder profile bonus for milestone progress
        const founderMilestoneBonus = this.getFounderMilestoneBonus(this.milestone.threshold);
        
        Object.entries(this.milestone.threshold).forEach(([metric, target]) => {
          const current = this.metrics[metric] || 0;
          // Apply founder bonus: effective target is slightly lower for matching profiles
          const effectiveTarget = target * (1 - founderMilestoneBonus);
          const progress = Math.min(100, (current / effectiveTarget) * 100);
          totalProgress += progress;
          thresholdCount++;
          
          // Track metrics at 80-99% - these get catch-up bonus
          if (progress >= 80 && progress < 100) {
            nearMissMetrics.push({ metric, current, target, needed: target - current });
          }
        });
        
        this.milestoneProgress = Math.min(100, Math.floor(totalProgress / thresholdCount));
        
        // No catch-up mechanism - you either hit the numbers or you don't
        // This reflects startup reality: deadlines are deadlines
      } else {
        // Legacy focus-based system (fallback)
        let prog = 0;
        this.milestone.focus.forEach(f => prog += this.metrics[f] || 0);
        this.milestoneProgress = Math.min(100, Math.floor(prog * 1.8));
      }
      
      // Milestone completion requires at least 2 full quarters (can't complete in Q1 or Q2)
      const minTurnForCompletion = 3;
      if (this.milestoneProgress >= 100 && this.turn >= minTurnForCompletion) {
        this.completeMilestone();
        return;
      }
      if (this.turn >= this.milestone.deadline) {
        this.failMilestone();
        return;
      }
    }

    // Continue to next turn (banking AP and advancing)
    this.continueAfterShock();
  }

  simulateRivals() {
    const volatility = this.extremeMode ? this.extremeVolatility : this.baseVolatility;
    this.rivals.forEach(r => {
      if (r.status !== "active") return;
      
      // Initialize dynamic tracking if not present
      if (!r.history) r.history = [];
      if (r.currentMilestoneIndex === undefined) r.currentMilestoneIndex = 0;
      if (!r.totalRaised) r.totalRaised = this.parseRaised(r.funder?.raised) || 0;
      if (!r.runway) r.runway = this.estimateRunway(r);
      if (!r.lastFundingQuarter) r.lastFundingQuarter = 0;
      
      // Base growth rate by style
      const g = r.style === "aggressive" ? 3 : r.style === "methodical" ? 2 : 1;
      
      // Funding multiplier - more funding = faster growth
      const fundingMultiplier = r.funded === "Series B" ? 1.5 : 
                                 r.funded === "Series A" ? 1.25 : 
                                 r.funded === "Seed" ? 1.1 : 1.0;
      
      // Add volatility to rival progress
      const volatilityMultiplier = 1 + (Math.random() * 2 - 1) * volatility * 2;
      r.scores.sci += Math.random() * g * volatilityMultiplier * fundingMultiplier;
      r.scores.dev += Math.random() * g * volatilityMultiplier * fundingMultiplier;
      r.scores.mkt += Math.random() * g * volatilityMultiplier * fundingMultiplier;
      
      // Decrease runway each quarter
      r.runway = Math.max(0, r.runway - 1);
      
      // Check for milestone completion
      this.checkRivalMilestone(r);
      
      // Check if rival needs/gets funding
      this.checkRivalFunding(r);
      
      // Random events (hiring, setbacks, news)
      this.generateRivalEvent(r);
      
      // Small chance of rival setback (5% normal, 10% extreme)
      if (Math.random() < (this.extremeMode ? 0.10 : 0.05)) {
        const setbackMetric = ['sci', 'dev', 'mkt'][Math.floor(Math.random() * 3)];
        const oldScore = r.scores[setbackMetric];
        r.scores[setbackMetric] = Math.max(0, r.scores[setbackMetric] - 3);
        if (oldScore - r.scores[setbackMetric] > 2) {
          const metricNames = { sci: "research", dev: "product", mkt: "sales" };
          r.history.unshift({ quarter: this.turn, event: `Setback in ${metricNames[setbackMetric]}`, type: "negative" });
        }
      }
      
      // Cap history at 10 items
      if (r.history.length > 10) r.history = r.history.slice(0, 10);
    });
  }
  
  parseRaised(raisedStr) {
    if (!raisedStr) return 0;
    const match = raisedStr.match(/Â£([\d.]+)(k|M)/i);
    if (!match) return 0;
    const num = parseFloat(match[1]);
    return match[2].toLowerCase() === 'm' ? num * 1000 : num;
  }
  
  estimateRunway(r) {
    // Estimate quarters of runway based on funding stage
    if (r.funded === "Series B") return 10 + Math.floor(Math.random() * 4);
    if (r.funded === "Series A") return 7 + Math.floor(Math.random() * 4);
    if (r.funded === "Seed") return 5 + Math.floor(Math.random() * 3);
    if (r.funded === "Grant-funded") return 6 + Math.floor(Math.random() * 4);
    if (r.funded === "Bootstrapped") return 8 + Math.floor(Math.random() * 4); // Profitable, longer runway
    return 4;
  }
  
  checkRivalMilestone(r) {
    if (!r.milestones || r.currentMilestoneIndex >= r.milestones.length) return;
    
    const currentMilestone = r.milestones[r.currentMilestoneIndex];
    if (currentMilestone.status === "complete") {
      r.currentMilestoneIndex++;
      return;
    }
    
    // Check if they should complete current milestone based on scores
    const totalScore = r.scores.sci + r.scores.dev + r.scores.mkt;
    const threshold = 30 + (r.currentMilestoneIndex * 25); // Higher bar for later milestones
    
    // Also factor in time - in-progress milestones more likely to complete
    const progressBonus = currentMilestone.status === "in-progress" ? 10 : 0;
    
    if (totalScore > threshold + progressBonus && Math.random() < 0.3) {
      // Complete the milestone
      currentMilestone.status = "complete";
      currentMilestone.quarter = this.turn;
      
      const rivalMilestoneCount = r.milestones.filter(m => m.status === "complete").length;
      
      r.history.unshift({ 
        quarter: this.turn, 
        event: `Completed milestone: ${currentMilestone.name}`, 
        type: "milestone" 
      });
      
      // Move next milestone to in-progress
      if (r.currentMilestoneIndex + 1 < r.milestones.length) {
        r.milestones[r.currentMilestoneIndex + 1].status = "in-progress";
      }
      
      r.currentMilestoneIndex++;
      
      // Strategic notification based on relative position
      const playerMilestoneCount = this.completedMilestones.length;
      const playerTotal = this.metrics.sci + this.metrics.dev + this.metrics.mkt;
      const rivalTotal = r.scores.sci + r.scores.dev + r.scores.mkt;
      
      if (rivalMilestoneCount > playerMilestoneCount) {
        // They're now ahead on milestones
        this.log(`âš ï¸ ${r.name} completed Milestone ${rivalMilestoneCount}: ${currentMilestone.name} â€” they're now ahead!`);
        
        // Flag for market shift modal (will be checked after simulation completes)
        if (!this.pendingMarketShift) {
          this.pendingMarketShift = {
            rival: r,
            milestone: currentMilestone
          };
        }
      } else if (rivalMilestoneCount === playerMilestoneCount && rivalTotal >= playerTotal) {
        // Tied on milestones but they're matching/beating on score
        this.log(`ğŸ¯ ${r.name} matched your progress: ${currentMilestone.name}`);
      } else if (rivalTotal >= playerTotal - 10) {
        // Close competitor completed something
        this.log(`ğŸ¯ ${r.name} completed: ${currentMilestone.name}`);
      }
    } else if (currentMilestone.status === "planned" && totalScore > threshold - 10) {
      // Start working on milestone
      currentMilestone.status = "in-progress";
    }
  }
  
  checkRivalFunding(r) {
    // Don't raise too frequently
    if (this.turn - r.lastFundingQuarter < 4) return;
    
    // Check if they need funding (low runway) or earned it (milestone)
    const needsFunding = r.runway < 3;
    const earnedFunding = r.history.some(h => h.type === "milestone" && h.quarter >= this.turn - 2);
    
    if (!needsFunding && !earnedFunding) return;
    if (Math.random() > 0.4) return; // Not every opportunity converts
    
    // Determine next funding stage
    const fundingProgression = {
      "Grant-funded": { next: "Seed", amount: "Â£1.5M", cash: 1500 },
      "Bootstrapped": { next: "Seed", amount: "Â£2M", cash: 2000 },
      "Seed": { next: "Series A", amount: "Â£8M", cash: 8000 },
      "Series A": { next: "Series B", amount: "Â£25M", cash: 25000 },
      "Series B": null // Already at max for this game
    };
    
    const progression = fundingProgression[r.funded];
    if (!progression) return;
    
    // Aggressive companies more likely to raise
    const raiseChance = r.style === "aggressive" ? 0.7 : r.style === "methodical" ? 0.5 : 0.3;
    if (Math.random() > raiseChance) return;
    
    // Raise the round
    r.funded = progression.next;
    r.totalRaised += progression.cash;
    r.runway = this.estimateRunway(r);
    r.lastFundingQuarter = this.turn;
    
    // Update funder info
    const newFunders = this.getNewFunderName(r, progression.next);
    r.funder = {
      name: newFunders,
      type: progression.next + " Investors",
      raised: `Â£${(r.totalRaised / 1000).toFixed(1)}M total`
    };
    
    // Grow team with funding
    const hireCount = progression.next === "Series B" ? 30 : progression.next === "Series A" ? 15 : 5;
    r.employees = (r.employees || 10) + hireCount;
    
    r.history.unshift({ 
      quarter: this.turn, 
      event: `Raised ${progression.amount} ${progression.next}`, 
      type: "funding" 
    });
    
    // Always notify player of competitor funding
    this.log(`ğŸ’° ${r.name} raised ${progression.amount} ${progression.next}!`);
  }
  
  getNewFunderName(r, stage) {
    const seedFunders = ["Seedcamp", "Entrepreneur First", "LocalGlobe", "Passion Capital", "Forward Partners"];
    const seriesAFunders = ["Index Ventures", "Balderton Capital", "Accel", "Atomico", "Northzone"];
    const seriesBFunders = ["General Catalyst", "Insight Partners", "Tiger Global", "Coatue", "a]z"];
    
    const funders = stage === "Seed" ? seedFunders : 
                    stage === "Series A" ? seriesAFunders : seriesBFunders;
    
    // Keep existing lead if upgrading
    const existingLead = r.funder?.name?.split(" + ")[0] || "";
    const newLead = funders[Math.floor(Math.random() * funders.length)];
    
    return existingLead && !funders.includes(existingLead) 
      ? `${newLead} + ${existingLead}`
      : newLead;
  }
  
  generateRivalEvent(r) {
    // 15% chance of a notable event each quarter
    if (Math.random() > 0.15) return;
    
    const totalScore = r.scores.sci + r.scores.dev + r.scores.mkt;
    
    const positiveEvents = [
      { event: `Key hire: ${this.randomHire(r)}`, type: "hire" },
      { event: "Won major customer contract", type: "positive" },
      { event: "Featured in TechCrunch", type: "positive" },
      { event: "Patent granted", type: "positive" },
      { event: "Strategic partnership announced", type: "positive" },
      { event: "Expanded to new market", type: "positive" }
    ];
    
    const negativeEvents = [
      { event: "Key executive departed", type: "negative" },
      { event: "Product launch delayed", type: "negative" },
      { event: "Lost major deal to competitor", type: "negative" },
      { event: "Restructuring announced", type: "negative" },
      { event: "Negative press coverage", type: "negative" }
    ];
    
    const neutralEvents = [
      { event: "Opened new office", type: "neutral" },
      { event: "Rebranded product line", type: "neutral" },
      { event: "New advisory board member", type: "neutral" }
    ];
    
    // Weight towards events matching their trajectory
    let events;
    if (totalScore > 50 && r.runway > 4) {
      events = [...positiveEvents, ...positiveEvents, ...neutralEvents]; // Doing well
    } else if (r.runway < 3 || totalScore < 25) {
      events = [...negativeEvents, ...negativeEvents, ...neutralEvents]; // Struggling
    } else {
      events = [...positiveEvents, ...negativeEvents, ...neutralEvents]; // Mixed
    }
    
    const selected = events[Math.floor(Math.random() * events.length)];
    r.history.unshift({ quarter: this.turn, ...selected });
    
    // Hire events increase employee count
    if (selected.type === "hire") {
      r.employees = (r.employees || 10) + Math.floor(Math.random() * 3) + 1;
    }
  }
  
  randomHire(r) {
    const roles = [
      "VP Engineering from Google",
      "Head of Sales from Salesforce", 
      "Chief Science Officer from DeepMind",
      "CFO from Series C startup",
      "Head of Product from Meta",
      "VP Marketing from HubSpot",
      "CTO from AWS"
    ];
    return roles[Math.floor(Math.random() * roles.length)];
  }
  
  applyRivalEffect(rival, effect) {
    if (!effect || !rival) return;
    
    if (effect.slow && effect.amount) {
      // Reduce rival's progress
      const reduction = effect.amount;
      rival.scores.sci = Math.max(0, rival.scores.sci - reduction * 0.3);
      rival.scores.dev = Math.max(0, rival.scores.dev - reduction * 0.3);
      rival.scores.mkt = Math.max(0, rival.scores.mkt - reduction * 0.4);
      this.log(`ğŸ“‰ ${rival.name} loses momentum`);
    }
  }

  // ===== COMPETITIVE POSITION ANALYSIS =====
  
  getCompetitivePosition() {
    const activeRivals = this.rivals.filter(r => r.status === "active");
    if (activeRivals.length === 0) {
      return { rank: 1, total: 1, status: 'leading', leadRival: null, gap: 0, details: [] };
    }
    
    const playerTotal = this.metrics.sci + this.metrics.dev + this.metrics.mkt;
    const playerMilestones = this.completedMilestones?.length || 0;
    
    // Create sorted leaderboard - milestones first, then total score
    const all = [
      { 
        name: this.company?.name || "You", 
        total: playerTotal, 
        milestones: playerMilestones,
        isPlayer: true, 
        funded: this.fundingStage 
      },
      ...activeRivals.map(r => ({ 
        name: r.name, 
        total: r.scores.sci + r.scores.dev + r.scores.mkt,
        milestones: r.milestones?.filter(m => m.status === "complete").length || 0,
        isPlayer: false,
        funded: r.funded,
        logo: r.logo,
        style: r.style,
        recentFunding: r.history?.some(h => h.type === 'funding' && h.quarter >= this.turn - 2),
        recentMilestone: r.history?.some(h => h.type === 'milestone' && h.quarter >= this.turn - 2)
      }))
    ].sort((a, b) => {
      // Primary sort: milestones completed
      if (b.milestones !== a.milestones) return b.milestones - a.milestones;
      // Secondary sort: total score
      return b.total - a.total;
    });
    
    const playerIdx = all.findIndex(x => x.isPlayer);
    const rank = playerIdx + 1;
    const leader = all[0];
    const leadRival = leader.isPlayer ? all[1] : leader;
    
    // Calculate gap based on milestones first, then score
    let gap;
    if (leader.isPlayer) {
      // Player is leading - gap is positive
      const nextRival = all[1];
      if (nextRival) {
        const milestoneDiff = playerMilestones - nextRival.milestones;
        gap = milestoneDiff > 0 ? milestoneDiff * 20 + (playerTotal - nextRival.total) : playerTotal - nextRival.total;
      } else {
        gap = 20;
      }
    } else {
      // Player is behind - gap is negative
      const milestoneDiff = playerMilestones - leader.milestones;
      gap = milestoneDiff < 0 ? milestoneDiff * 20 + (playerTotal - leader.total) : playerTotal - leader.total;
    }
    
    // Determine status based on rank and gap
    let status;
    if (rank === 1 && gap > 15) status = 'dominant';
    else if (rank === 1) status = 'leading';
    else if (rank === 2 && gap > -20) status = 'competitive';
    else if (rank <= 3 && gap > -40) status = 'behind';
    else status = 'struggling';
    
    // Check for recent competitor funding (sector heat)
    const recentCompetitorFunding = activeRivals.filter(r => 
      r.history?.some(h => h.type === 'funding' && h.quarter >= this.turn - 3)
    ).length;
    
    return {
      rank,
      total: all.length,
      status,
      leadRival,
      gap,
      leaderboard: all.slice(0, 4), // Top 4 for display
      sectorHeat: recentCompetitorFunding, // How many rivals raised recently
      playerTotal,
      playerMilestones,
      details: all
    };
  }
  
  getCompetitiveFundingModifier() {
    const position = this.getCompetitivePosition();
    
    // Base modifier starts at 1.0
    let cashMod = 1.0;
    let dilutionMod = 1.0;
    let valMod = 1.0;
    
    // Position affects terms
    switch (position.status) {
      case 'dominant':
        cashMod = 1.15;      // VCs want in, offer more
        dilutionMod = 0.85;  // Less dilution - you have leverage
        valMod = 1.2;        // Premium valuation
        break;
      case 'leading':
        cashMod = 1.08;
        dilutionMod = 0.92;
        valMod = 1.1;
        break;
      case 'competitive':
        // Neutral - standard terms
        break;
      case 'behind':
        cashMod = 0.92;
        dilutionMod = 1.1;   // More dilution - weaker position
        valMod = 0.9;
        break;
      case 'struggling':
        cashMod = 0.85;
        dilutionMod = 1.25;  // Significant penalty
        valMod = 0.75;
        break;
    }
    
    // Sector heat: if competitors just raised, VCs have allocation fatigue
    if (position.sectorHeat >= 2) {
      cashMod *= 0.9;       // Harder to raise
      dilutionMod *= 1.1;   // Worse terms
    }
    
    return {
      cashMod,
      dilutionMod, 
      valMod,
      position,
      sectorHeat: position.sectorHeat
    };
  }

  // ===== SHOCK EVENT SYSTEM =====
  
  triggerRandomShock() {
    // Don't repeat shocks we've seen
    let availableShocks = ALL_SHOCKS.filter(s => !this.usedShocks?.has(s.id));
    
    // Filter revenue shocks based on game state
    availableShocks = availableShocks.filter(s => {
      // Revenue shocks require customers
      if (s.requiresCustomers && (!this.customers || this.customers.length === 0)) {
        return false;
      }
      // Some revenue shocks require revenue model to be active
      if (s.requiresRevenue && !this.revenueModel) {
        return false;
      }
      // Board pressure shock only if behind on projections
      if (s.id === 'board_revenue_pressure') {
        const sentiment = this.getBoardRevenueSentiment();
        if (sentiment.sentiment !== 'worried' && sentiment.sentiment !== 'critical') {
          return false;
        }
      }
      return true;
    });
    
    if (availableShocks.length === 0) return this.continueAfterShock();
    
    const shock = availableShocks[Math.floor(Math.random() * availableShocks.length)];
    this.showShock(shock);
  }
  
  showShock(shock) {
    // Play shock sound
    soundManager.playShock();
    
    this.pendingShock = shock;
    this.usedShocks = this.usedShocks || new Set();
    this.usedShocks.add(shock.id);
    
    // Log journey event for shock
    this.logJourneyEvent('shock', {
      headline: shock.headline,
      text: shock.text,
      type: shock.type,
      effects: shock.effects
    });
    
    // Populate modal
    const typeColors = {
      positive: "text-emerald-600",
      negative: "text-red-600", 
      mixed: "text-amber-600"
    };
    const typeBorders = {
      positive: "border-emerald-500",
      negative: "border-red-500",
      mixed: "border-amber-500"
    };
    
    document.getElementById("shockHeadline").innerHTML = `${shock.icon || "âš¡"} ${shock.headline}`;
    document.getElementById("shockText").textContent = shock.text;
    
    // Show immediate effects
    const effectLabels = { cash: "Cash", val: "Valuation", sci: "Research", dev: "Product", mkt: "Sales", hr: "People", burn: "Burn", equity: "Equity" };
    const effectsHtml = Object.entries(shock.effects).map(([k, v]) => {
      const color = v > 0 ? "text-emerald-600" : "text-red-600";
      const sign = v > 0 ? "+" : "";
      const suffix = k === "cash" || k === "val" ? "k" : k === "equity" ? "%" : "";
      return `<span class="${color} font-medium">${sign}${v}${suffix} ${effectLabels[k]}</span>`;
    }).join(" â€¢ ");
    
    document.getElementById("shockEffects").innerHTML = effectsHtml || "<span class='text-slate-400'>No immediate effects</span>";
    
    // Show response choices
    document.getElementById("shockChoices").innerHTML = shock.choices.map((c, i) => {
      const effText = Object.entries(c.eff).map(([k, v]) => {
        const sign = v > 0 ? "+" : "";
        const suffix = k === "cash" || k === "val" ? "k" : k === "equity" ? "%" : k === "burn" ? "/q" : "";
        return `${sign}${v}${suffix} ${effectLabels[k] || k}`;
      }).join(", ");
      
      return `
        <button onclick="game.resolveShock(${i})" class="w-full p-3 bg-white border-2 border-slate-200 rounded-xl text-left hover:border-blue-400 hover:bg-blue-50 transition-all">
          <div class="flex justify-between items-start">
            <span class="font-medium text-slate-800">${c.text}</span>
            <span class="text-xs bg-slate-100 px-2 py-1 rounded-full text-slate-600">${c.ap} AP</span>
          </div>
          <div class="text-xs text-slate-500 mt-1">${effText}</div>
        </button>
      `;
    }).join("");
    
    // Update modal border color based on shock type
    const modal = document.getElementById("shockModal").querySelector("div");
    modal.className = modal.className.replace(/border-\w+-500/g, typeBorders[shock.type] || "border-amber-500");
    
    document.getElementById("shockModal").classList.remove("hidden");
    document.getElementById("shockModal").classList.add("flex");
  }
  
  resolveShock(choiceIndex) {
    const shock = this.pendingShock;
    if (!shock) return;
    
    // Adaptability reduces negative shock effects (10% reduction per point above 2)
    const adaptabilityMod = this.founderBonuses?.adaptability > 2 
      ? 1 - ((this.founderBonuses.adaptability - 2) * 0.1) 
      : 1;
    
    // Apply immediate shock effects (with volatility and adaptability)
    Object.entries(shock.effects).forEach(([k, v]) => {
      let adjustedValue = this.applyVolatility(v);
      // Adaptability only reduces negative effects
      if (adjustedValue < 0 && adaptabilityMod < 1) {
        adjustedValue = Math.round(adjustedValue * adaptabilityMod);
      }
      if (k === "equity") {
        this.metrics.equity = Math.max(0, this.metrics.equity + adjustedValue);
      } else if (this.metrics[k] !== undefined) {
        this.metrics[k] = Math.max(0, this.metrics[k] + adjustedValue);
      }
    });
    
    // Apply choice effects (with volatility and adaptability for negative effects)
    const choice = shock.choices[choiceIndex];
    Object.entries(choice.eff).forEach(([k, v]) => {
      let adjustedValue = this.applyVolatility(v);
      // Adaptability only reduces negative effects
      if (adjustedValue < 0 && adaptabilityMod < 1) {
        adjustedValue = Math.round(adjustedValue * adaptabilityMod);
      }
      if (k === "equity") {
        this.metrics.equity = Math.max(0, this.metrics.equity + adjustedValue);
      } else if (k === "burn") {
        this.metrics.burn = Math.max(0, this.metrics.burn + adjustedValue);
      } else if (this.metrics[k] !== undefined) {
        this.metrics[k] = Math.max(0, this.metrics[k] + adjustedValue);
      }
    });
    
    // === REVENUE SYSTEM: Process shock revenue effects ===
    // Apply base shock revenue effect
    if (shock.revenueEffect) {
      this.processRevenueEffect(shock.revenueEffect);
    }
    // Apply choice-specific revenue effect
    if (choice.revenueEff) {
      this.processRevenueEffect(choice.revenueEff);
    }
    
    // Log the event
    this.log(`âš¡ ${shock.headline} - chose: "${choice.text.substring(0, 30)}..."`);;
    
    // Close modal
    document.getElementById("shockModal").classList.add("hidden");
    document.getElementById("shockModal").classList.remove("flex");
    this.pendingShock = null;
    
    // Continue to next turn
    this.continueAfterShock();
  }
  
  continueAfterShock() {
    // Play quarter end sound
    soundManager.playQuarterEnd();
    
    // Bank unused AP for next quarter
    const usedAP = this.getUsedAP();
    const totalAP = this.getTotalAP();
    const unusedAP = Math.max(0, totalAP - usedAP);
    
    // Calculate new banked amount (capped at maxBankedAP)
    const newBanked = Math.min(unusedAP, this.maxBankedAP);
    if (newBanked > 0) {
      this.bankedAP = newBanked;
      this.log(`ğŸ’¾ Saved ${newBanked} unused AP for next quarter`);
    } else {
      this.bankedAP = 0;
    }

    // Show decision feedback transition (replaces random transition)
    if (this.shouldShowTransition() && this.lastTurnOutcomes && this.lastTurnOutcomes.length > 0) {
      this.showDecisionFeedback(() => {
        this.advanceToNextTurn();
      });
    } else if (this.shouldShowTransition()) {
      this.showQuarterTransition(() => {
        this.advanceToNextTurn();
      });
    } else {
      this.advanceToNextTurn();
    }
  }
  
  // ===== LIFE EVENTS SYSTEM =====
  maybeShowLifeEvent() {
    // Track life events used this game
    this.usedLifeEvents = this.usedLifeEvents || new Set();
    this.lifeEventCount = this.lifeEventCount || 0;
    
    // Max 2 life events per game
    if (this.lifeEventCount >= 2) return false;
    
    // ~15% chance per quarter (results in ~1.5 events over 12 quarters)
    if (Math.random() > 0.15) return false;
    
    // Get available events (not already used)
    const available = LIFE_EVENTS.filter(e => !this.usedLifeEvents.has(e.id));
    if (available.length === 0) return false;
    
    // Pick a random event
    const event = available[Math.floor(Math.random() * available.length)];
    this.showLifeEvent(event);
    return true;
  }
  
  showLifeEvent(event) {
    this.pendingLifeEvent = event;
    this.usedLifeEvents.add(event.id);
    this.lifeEventCount++;
    
    // Populate modal
    document.getElementById("lifeEventIcon").textContent = event.icon;
    document.getElementById("lifeEventTitle").textContent = event.title;
    document.getElementById("lifeEventText").textContent = event.text;
    
    // Format effect display
    let effectHtml = "";
    const effectDiv = document.getElementById("lifeEventEffect");
    
    if (event.effect.type === "ap") {
      const color = event.effect.value > 0 ? "text-emerald-600" : "text-red-600";
      const sign = event.effect.value > 0 ? "+" : "";
      effectHtml = `<span class="${color} text-xl font-bold">${sign}${event.effect.value} AP</span>`;
      effectDiv.className = event.effect.value > 0 
        ? "bg-emerald-50 rounded-xl p-4 mb-5 border border-emerald-200 text-center"
        : "bg-red-50 rounded-xl p-4 mb-5 border border-red-200 text-center";
    } else if (event.effect.type === "cash") {
      effectHtml = `<span class="text-emerald-600 text-xl font-bold">+Â£${event.effect.value}k cash</span>`;
      effectDiv.className = "bg-emerald-50 rounded-xl p-4 mb-5 border border-emerald-200 text-center";
    } else if (event.effect.type === "stat") {
      const statLabels = { sci: "Research", dev: "Product", mkt: "Marketing", hr: "People" };
      const arrow = event.effect.value > 0 ? "â†‘" : "â†“";
      const color = event.effect.value > 0 ? "text-emerald-600" : "text-red-600";
      effectHtml = `<span class="${color} text-xl font-bold">${arrow} ${statLabels[event.effect.stat]}</span>`;
      if (event.effect.stat2) {
        effectHtml += `<span class="text-slate-400 mx-2">â€¢</span><span class="${color} text-xl font-bold">${arrow} ${statLabels[event.effect.stat2]}</span>`;
      }
      effectDiv.className = event.effect.value > 0 
        ? "bg-emerald-50 rounded-xl p-4 mb-5 border border-emerald-200 text-center"
        : "bg-red-50 rounded-xl p-4 mb-5 border border-red-200 text-center";
    }
    
    effectDiv.innerHTML = effectHtml;
    
    // Update modal border color
    const modal = document.getElementById("lifeEventModal").querySelector("div");
    if (event.type === "positive") {
      modal.className = "bg-gradient-to-br from-emerald-50 to-green-50 rounded-2xl max-w-lg w-full p-6 shadow-2xl border-2 border-emerald-300";
    } else {
      modal.className = "bg-gradient-to-br from-rose-50 to-red-50 rounded-2xl max-w-lg w-full p-6 shadow-2xl border-2 border-rose-300";
    }
    
    // Show modal
    document.getElementById("lifeEventModal").classList.remove("hidden");
    document.getElementById("lifeEventModal").classList.add("flex");
    
    // Ensure button works by re-adding click handler
    const btn = document.getElementById("lifeEventModal").querySelector("button");
    if (btn) {
      // Remove any existing listeners by cloning
      const newBtn = btn.cloneNode(true);
      newBtn.removeAttribute('onclick'); // Remove HTML onclick to prevent double-firing
      btn.parentNode.replaceChild(newBtn, btn);
      newBtn.addEventListener('click', () => this.resolveLifeEvent());
    }
    
    // Log it
    this.log(`ğŸ² Life event: ${event.title}`);
  }
  
  resolveLifeEvent() {
    try {
      const event = this.pendingLifeEvent;
      if (!event) return;
      
      // Apply effect
      if (event.effect.type === "ap") {
        this.lifeEventAPMod = (this.lifeEventAPMod || 0) + event.effect.value;
      } else if (event.effect.type === "cash") {
        this.metrics.cash += event.effect.value;
      } else if (event.effect.type === "stat") {
        const stat = event.effect.stat;
        this.metrics[stat] = Math.max(0, this.metrics[stat] + event.effect.value);
        if (event.effect.stat2) {
          this.metrics[event.effect.stat2] = Math.max(0, this.metrics[event.effect.stat2] + event.effect.value2);
        }
      }
      
      // Clear pending event BEFORE closing modal to prevent double-processing
      this.pendingLifeEvent = null;
      
      // Close modal
      const modal = document.getElementById("lifeEventModal");
      if (modal) {
        modal.classList.add("hidden");
        modal.classList.remove("flex");
      }
      
      // Re-render everything to ensure UI is fully responsive
      this.update();
      this.renderDashboard();
      this.renderAPPips();
      this.renderBoardroom();
      
      // Show strategic focus modal after life event
      setTimeout(() => this.showStrategicFocusModal(), 300);
      
    } catch (e) {
      console.error("Error in resolveLifeEvent:", e);
      // Still try to close modal even on error
      this.pendingLifeEvent = null;
      const modal = document.getElementById("lifeEventModal");
      if (modal) {
        modal.classList.add("hidden");
        modal.classList.remove("flex");
      }
    }
  }
  
  // ===== SITUATION BRIEF SYSTEM =====
  showSituationBrief() {
    // Calculate values
    const quarter = this.turn || 1;
    const totalQuarters = 16;
    const year = Math.ceil(quarter / 4);
    const runway = this.metrics.burn > 0 ? Math.floor(this.metrics.cash / this.metrics.burn) : 99;
    const milestone = this.milestone;
    const milestoneProgress = this.milestoneProgress || 0;
    const milestoneNum = this.completedMilestones ? this.completedMilestones.length + 1 : 1;
    
    // === CHAPTER INFO (integrated from Chapter Toast) ===
    const chapterInfo = this.getChapterInfo(quarter);
    const isNewChapter = !this.chaptersShown.has(chapterInfo.num);
    
    const chapterBanner = document.getElementById("briefChapterBanner");
    const chapterBadge = document.getElementById("briefChapterBadge");
    
    // Always update chapter badge
    chapterBadge.textContent = `Ch.${chapterInfo.num}`;
    
    // Show chapter banner only on chapter-starting quarters
    if (isNewChapter) {
      this.chaptersShown.add(chapterInfo.num);
      chapterBanner.classList.remove("hidden");
      document.getElementById("briefChapterIcon").textContent = chapterInfo.icon;
      document.getElementById("briefChapterTitle").textContent = chapterInfo.title;
      document.getElementById("briefChapterSubtitle").textContent = chapterInfo.subtitle;
    } else {
      chapterBanner.classList.add("hidden");
    }
    
    // Update quarter title
    document.getElementById("briefQuarterTitle").textContent = `Q${quarter} of ${totalQuarters}`;
    document.getElementById("briefYearBadge").textContent = `Year ${year}`;
    
    // Update runway
    const runwayText = runway >= 99 ? "âˆ" : `${runway} quarter${runway !== 1 ? 's' : ''}`;
    document.getElementById("briefRunway").textContent = runwayText;
    
    // Runway bar (cap at 8 quarters for display)
    const runwayPercent = Math.min(100, (runway / 8) * 100);
    const runwayBar = document.getElementById("briefRunwayBar");
    runwayBar.style.width = `${runwayPercent}%`;
    
    // Runway bar color based on health
    if (runway <= 2) {
      runwayBar.className = "h-full bg-gradient-to-r from-red-500 to-rose-500 rounded-full transition-all duration-500";
      document.getElementById("briefRunwayWarning").classList.remove("hidden");
      document.getElementById("briefRunwayWarning").textContent = "ğŸš¨ Critical! Raise funding immediately";
    } else if (runway <= 4) {
      runwayBar.className = "h-full bg-gradient-to-r from-amber-500 to-orange-500 rounded-full transition-all duration-500";
      document.getElementById("briefRunwayWarning").classList.remove("hidden");
      document.getElementById("briefRunwayWarning").textContent = "âš ï¸ Low runway - consider fundraising soon";
    } else {
      runwayBar.className = "h-full bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full transition-all duration-500";
      document.getElementById("briefRunwayWarning").classList.add("hidden");
    }
    
    // Update milestone info
    document.getElementById("briefMilestoneNum").textContent = `M${milestoneNum}`;
    if (milestone) {
      document.getElementById("briefMilestoneName").textContent = `${milestone.icon || 'ğŸ¯'} ${milestone.name}`;
      document.getElementById("briefMilestoneProgress").textContent = `${milestoneProgress}%`;
      document.getElementById("briefMilestoneBar").style.width = `${milestoneProgress}%`;
      
      // Milestone bar color based on progress
      const milestoneBar = document.getElementById("briefMilestoneBar");
      if (milestoneProgress >= 80) {
        milestoneBar.className = "h-full bg-gradient-to-r from-emerald-500 to-green-500 rounded-full transition-all duration-500";
      } else if (milestoneProgress >= 50) {
        milestoneBar.className = "h-full bg-gradient-to-r from-amber-500 to-orange-500 rounded-full transition-all duration-500";
      } else {
        milestoneBar.className = "h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-500";
      }
      
      // Deadline
      const quartersLeft = Math.max(0, milestone.deadline - this.turn);
      const deadlineText = quartersLeft === 0 ? "â° Final quarter!" : `â° ${quartersLeft} quarter${quartersLeft !== 1 ? 's' : ''} remaining`;
      document.getElementById("briefMilestoneDeadline").textContent = deadlineText;
      
      // Color deadline warning
      const deadlineEl = document.getElementById("briefMilestoneDeadline");
      if (quartersLeft <= 1) {
        deadlineEl.className = "text-xs text-red-600 font-medium mt-1";
      } else if (quartersLeft <= 2) {
        deadlineEl.className = "text-xs text-amber-600 mt-1";
      } else {
        deadlineEl.className = "text-xs text-slate-500 mt-1";
      }
    } else {
      document.getElementById("briefMilestoneName").textContent = "No active milestone";
      document.getElementById("briefMilestoneProgress").textContent = "-";
      document.getElementById("briefMilestoneBar").style.width = "0%";
      document.getElementById("briefMilestoneDeadline").textContent = "";
    }
    
    // Calculate suggested focus
    const suggestion = this.calculateSuggestedFocus(milestone, runway, milestoneProgress);
    document.getElementById("briefSuggestion").textContent = suggestion.focus;
    document.getElementById("briefSuggestionReason").textContent = suggestion.reason;
    
    // Update suggestion box color based on urgency
    const suggestionBox = document.getElementById("briefSuggestionBox");
    if (suggestion.urgent) {
      suggestionBox.className = "bg-gradient-to-r from-red-50 to-rose-50 rounded-xl p-3 border border-red-200";
    } else if (suggestion.warning) {
      suggestionBox.className = "bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-3 border border-amber-200";
    } else {
      suggestionBox.className = "bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-3 border border-indigo-200";
    }
    
    // === HASTY DECISION WARNING ===
    // Show warning if there were hasty decisions in previous quarter or total is high
    const hastyWarning = document.getElementById("briefHastyWarning");
    const hastyText = document.getElementById("briefHastyText");
    const hastyDetail = document.getElementById("briefHastyDetail");
    
    const totalHashy = this.decisionTiming?.hastyDecisionsTotal || 0;
    const thoughtful = this.decisionTiming?.thoughtfulDecisionsTotal || 0;
    
    if (totalHashy >= 3 && totalHashy > thoughtful) {
      hastyWarning.classList.remove("hidden");
      if (totalHashy >= 5) {
        hastyText.textContent = `You've rushed ${totalHashy} decisions so far.`;
        hastyDetail.textContent = "Your team is struggling to keep up. Slow down for better outcomes.";
      } else {
        hastyText.textContent = `You've made ${totalHashy} hasty decisions so far.`;
        hastyDetail.textContent = "Taking time to read events carefully improves effectiveness.";
      }
    } else {
      hastyWarning.classList.add("hidden");
    }
    
    // Show modal
    document.getElementById("situationBriefModal").classList.remove("hidden");
    document.getElementById("situationBriefModal").classList.add("flex");
  }
  
  calculateSuggestedFocus(milestone, runway, progress) {
    // Priority 1: Critical runway - must fundraise
    if (runway <= 2) {
      return {
        focus: "ğŸš¨ Fundraising & Revenue",
        reason: "Critical runway! Secure funding or revenue immediately to survive.",
        urgent: true,
        warning: false
      };
    }
    
    // Priority 2: Low runway - consider fundraising
    if (runway <= 4) {
      return {
        focus: "ğŸ’° Fundraising & Cost Control",
        reason: "Low runway - start fundraising process or boost revenue.",
        urgent: false,
        warning: true
      };
    }
    
    // Priority 3: Milestone deadline pressure
    if (milestone) {
      const quartersLeft = Math.max(0, milestone.deadline - this.turn);
      const progressNeeded = 100 - progress;
      const progressPerQuarter = quartersLeft > 0 ? progressNeeded / quartersLeft : progressNeeded;
      
      // If we need to make more than 25% progress per quarter, it's urgent
      if (progressPerQuarter > 25 && quartersLeft <= 2) {
        const focusAreas = this.getMilestoneFocusAreas(milestone);
        return {
          focus: `âš¡ ${focusAreas}`,
          reason: `Milestone deadline approaching! Need ${Math.round(progressNeeded)}% in ${quartersLeft} quarter${quartersLeft !== 1 ? 's' : ''}.`,
          urgent: false,
          warning: true
        };
      }
    }
    
    // Priority 4: Match milestone focus areas
    if (milestone && milestone.focus) {
      const focusAreas = this.getMilestoneFocusAreas(milestone);
      const reason = this.getMilestoneFocusReason(milestone);
      return {
        focus: focusAreas,
        reason: reason,
        urgent: false,
        warning: false
      };
    }
    
    // Default: balanced approach
    return {
      focus: "Balanced Growth",
      reason: "Build capabilities across all areas while monitoring cash.",
      urgent: false,
      warning: false
    };
  }
  
  getMilestoneFocusAreas(milestone) {
    if (!milestone || !milestone.focus) return "Balanced Growth";
    
    const focusMap = {
      sci: "Research",
      dev: "Product",
      mkt: "Sales & Marketing",
      hr: "Team Building"
    };
    
    const areas = milestone.focus.map(f => focusMap[f] || f).slice(0, 2);
    
    if (areas.length === 1) return areas[0];
    if (areas.length === 2) return `${areas[0]} & ${areas[1]}`;
    return areas.join(", ");
  }
  
  getMilestoneFocusReason(milestone) {
    if (!milestone || !milestone.threshold) return "Focus on milestone requirements.";
    
    // Find which metrics need the most work
    const gaps = [];
    Object.entries(milestone.threshold).forEach(([metric, target]) => {
      const current = this.metrics[metric] || 0;
      const gap = target - current;
      if (gap > 0) {
        const metricNames = { sci: "Science", dev: "Product", mkt: "Marketing", hr: "Team" };
        gaps.push({ name: metricNames[metric] || metric, gap, target, current });
      }
    });
    
    gaps.sort((a, b) => b.gap - a.gap);
    
    if (gaps.length === 0) {
      return "Almost there! Push to complete the milestone.";
    } else if (gaps.length === 1) {
      return `Need +${gaps[0].gap} ${gaps[0].name} to hit target of ${gaps[0].target}.`;
    } else {
      return `Biggest gaps: ${gaps[0].name} (need +${gaps[0].gap}) and ${gaps[1].name} (need +${gaps[1].gap}).`;
    }
  }
  
  closeSituationBrief() {
    document.getElementById("situationBriefModal").classList.add("hidden");
    document.getElementById("situationBriefModal").classList.remove("flex");
    
    // Show chapter toast if this is a chapter-starting quarter
    this.maybeShowChapterToast();
    
    // After closing the brief, check for life events (but not on Q1)
    if (this.turn > 1) {
      const hadLifeEvent = this.maybeShowLifeEvent();
      // If no life event, show strategic focus modal
      if (!hadLifeEvent) {
        setTimeout(() => this.showStrategicFocusModal(), 300);
      }
    } else {
      // Q1: Show strategic focus modal directly
      setTimeout(() => this.showStrategicFocusModal(), 300);
    }
  }
  
  showDecisionFeedback(callback) {
    const outcomes = this.lastTurnOutcomes || [];
    const milestone = this.milestone;
    const milestoneProgress = this.milestoneProgress || 0;
    
    // Calculate previous progress (approximate from current - changes)
    let progressChange = 0;
    if (milestone && milestone.threshold) {
      outcomes.forEach(outcome => {
        Object.entries(outcome.actualEffects).forEach(([metric, value]) => {
          if (milestone.threshold[metric]) {
            // This metric contributes to milestone
            const target = milestone.threshold[metric];
            progressChange += (value / target) * 100 / Object.keys(milestone.threshold).length;
          }
        });
      });
    }
    progressChange = Math.round(progressChange);
    
    // Rate each decision
    const ratedOutcomes = outcomes.map(outcome => {
      let rating = 'met'; // Default
      let ratingLabel = 'Met Expectations';
      let ratingIcon = 'âœ“';
      let ratingClass = 'feedback-met';
      let milestoneContribution = 0;
      
      if (outcome.isPass) {
        rating = 'pass';
        ratingLabel = 'Passed';
        ratingIcon = '-';
        ratingClass = 'feedback-pass';
      } else {
        // Calculate milestone contribution
        let contributesToMilestone = false;
        let contributionValue = 0;
        
        if (milestone && milestone.threshold) {
          Object.entries(outcome.actualEffects).forEach(([metric, value]) => {
            if (milestone.threshold[metric] && value > 0) {
              contributesToMilestone = true;
              contributionValue += value;
            }
          });
        }
        
        // Compare actual vs expected
        let totalExpected = 0;
        let totalActual = 0;
        Object.entries(outcome.expectedEffects).forEach(([metric, expected]) => {
          if (['sci', 'dev', 'mkt', 'hr'].includes(metric)) {
            totalExpected += expected;
            totalActual += outcome.actualEffects[metric] || 0;
          }
        });
        
        // Determine rating
        if (totalActual <= 0 && totalExpected > 0) {
          rating = 'failed';
          ratingLabel = 'Failed';
          ratingIcon = 'âœ—';
          ratingClass = 'feedback-failed';
        } else if (totalActual >= totalExpected * 1.3) {
          rating = 'exceeded';
          ratingLabel = 'Exceeded Expectations';
          ratingIcon = 'â˜…';
          ratingClass = 'feedback-exceeded';
        } else if (totalActual < totalExpected * 0.7) {
          rating = 'below';
          ratingLabel = 'Below Expectations';
          ratingIcon = 'â†“';
          ratingClass = 'feedback-below';
        }
        
        milestoneContribution = contributesToMilestone ? contributionValue : 0;
      }
      
      return { ...outcome, rating, ratingLabel, ratingIcon, ratingClass, milestoneContribution };
    });
    
    // Build feedback HTML
    const overlay = document.createElement('div');
    overlay.id = 'decisionFeedback';
    overlay.className = 'fixed inset-0 z-50 flex items-center justify-center bg-slate-900/95 feedback-overlay';
    
    const domainLabels = {
      research: { name: 'Research', icon: 'ğŸ”¬', color: 'purple' },
      dev: { name: 'Product', icon: 'âš™', color: 'blue' },
      marketing: { name: 'Sales', icon: 'ğŸ“ˆ', color: 'green' },
      hr: { name: 'People', icon: 'ğŸ‘¥', color: 'amber' }
    };
    
    const feedbackItems = ratedOutcomes.map(o => {
      const domain = domainLabels[o.domain] || { name: o.domain, icon: 'ğŸ“‹', color: 'slate' };
      
      // Format effects display - show direction and magnitude without exact numbers
      const effectsDisplay = Object.entries(o.actualEffects)
        .filter(([k, v]) => v !== 0 && ['sci', 'dev', 'mkt', 'hr', 'cash', 'equity'].includes(k))
        .map(([k, v]) => {
          const label = STAT_LABELS[k] || k;
          const color = v > 0 ? 'text-emerald-600' : 'text-red-600';
          const absV = Math.abs(v);
          const arrows = absV >= 7 ? (v > 0 ? 'â†‘â†‘â†‘' : 'â†“â†“â†“') : 
                         absV >= 4 ? (v > 0 ? 'â†‘â†‘' : 'â†“â†“') : 
                         (v > 0 ? 'â†‘' : 'â†“');
          return `<span class="${color} font-medium">${arrows} ${label}</span>`;
        })
        .join('<span class="text-slate-400 mx-1">â€¢</span>');
      
      // Milestone contribution indicator - show progress without numbers
      const milestoneIndicator = o.milestoneContribution > 0 
        ? `<span class="text-xs text-emerald-600 bg-emerald-100 px-2 py-0.5 rounded-full ml-2">ğŸ“Š Progress toward milestone</span>` 
        : '';
      
      return `
        <div class="feedback-item ${o.ratingClass} rounded-lg p-4 mb-3">
          <div class="flex items-start gap-3">
            <div class="text-2xl">${domain.icon}</div>
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2 mb-1">
                <span class="font-bold text-slate-800">${domain.name}</span>
                <span class="text-sm px-2 py-0.5 rounded-full ${
                  o.rating === 'exceeded' ? 'bg-emerald-200 text-emerald-800' :
                  o.rating === 'met' ? 'bg-blue-200 text-blue-800' :
                  o.rating === 'below' ? 'bg-amber-200 text-amber-800' :
                  o.rating === 'failed' ? 'bg-red-200 text-red-800' :
                  'bg-slate-200 text-slate-600'
                }">${o.ratingIcon} ${o.ratingLabel}</span>
                ${milestoneIndicator}
              </div>
              <p class="text-sm text-slate-700 mb-2">${o.choiceText}</p>
              <div class="text-sm">${effectsDisplay || '<span class="text-slate-400">No stat changes</span>'}</div>
            </div>
          </div>
        </div>
      `;
    }).join('');
    
    // Milestone progress bar
    const prevProgress = Math.max(0, milestoneProgress - progressChange);
    const progressBar = milestone ? `
      <div class="mt-6 pt-4 border-t border-slate-700">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm text-slate-400">Milestone Progress</span>
          <span class="text-sm font-bold ${progressChange > 0 ? 'text-emerald-400' : progressChange < 0 ? 'text-red-400' : 'text-slate-400'}">
            ${progressChange > 0 ? '+' : ''}${progressChange}% this quarter
          </span>
        </div>
        <div class="relative h-4 bg-slate-700 rounded-full overflow-hidden ${progressChange > 0 ? 'progress-positive' : ''}">
          <div class="absolute inset-0 h-full bg-slate-600 rounded-full" style="width: ${prevProgress}%"></div>
          <div class="milestone-contribution-bar absolute inset-0 h-full bg-gradient-to-r from-emerald-500 to-teal-400 rounded-full" style="width: ${milestoneProgress}%"></div>
        </div>
        <div class="flex justify-between mt-1 text-xs text-slate-500">
          <span>${milestone.name}</span>
          <span>${milestoneProgress}%</span>
        </div>
      </div>
    ` : '';
    
    overlay.innerHTML = `
      <div class="feedback-card bg-slate-800 rounded-2xl shadow-2xl p-6 max-w-xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h2 class="text-xl font-bold text-white">Q${this.quarter} Results</h2>
            <p class="text-sm text-slate-400">How your decisions played out</p>
          </div>
          <div class="text-3xl">ğŸ“Š</div>
        </div>
        
        <div class="space-y-1">
          ${feedbackItems}
        </div>
        
        ${progressBar}
        
        <button onclick="game.dismissDecisionFeedback()" class="w-full mt-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-400 hover:to-indigo-400 text-white font-semibold rounded-xl transition-all">
          Continue to Q${this.quarter + 1} â†’
        </button>
      </div>
    `;
    
    document.body.appendChild(overlay);
    
    // Play feedback sound
    this.playFeedbackSound(progressChange);
    
    // Store callback
    this.feedbackCallback = callback;
    
    // Auto-dismiss after 15 seconds
    this.feedbackTimeout = setTimeout(() => this.dismissDecisionFeedback(), 15000);
  }
  
  playFeedbackSound(progressChange) {
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const now = ctx.currentTime;
      
      if (progressChange > 5) {
        // Positive progress - uplifting arpeggio
        const notes = [392, 493.88, 587.33, 783.99]; // G4, B4, D5, G5
        notes.forEach((freq, i) => {
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.type = "sine";
          osc.frequency.setValueAtTime(freq, now + i * 0.12);
          gain.gain.setValueAtTime(0, now + i * 0.12);
          gain.gain.linearRampToValueAtTime(0.12, now + i * 0.12 + 0.05);
          gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.12 + 0.4);
          osc.connect(gain);
          gain.connect(ctx.destination);
          osc.start(now + i * 0.12);
          osc.stop(now + i * 0.12 + 0.5);
        });
      } else if (progressChange < -2) {
        // Negative progress - descending tone
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = "triangle";
        osc.frequency.setValueAtTime(400, now);
        osc.frequency.linearRampToValueAtTime(250, now + 0.4);
        gain.gain.setValueAtTime(0.1, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.5);
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start(now);
        osc.stop(now + 0.5);
      } else {
        // Neutral - simple notification
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = "sine";
        osc.frequency.setValueAtTime(523.25, now);
        gain.gain.setValueAtTime(0.08, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start(now);
        osc.stop(now + 0.3);
      }
    } catch (e) {
      console.log("Feedback sound not available");
    }
  }
  
  dismissDecisionFeedback() {
    clearTimeout(this.feedbackTimeout);
    const overlay = document.getElementById('decisionFeedback');
    if (overlay) overlay.remove();
    if (this.feedbackCallback) {
      this.feedbackCallback();
      this.feedbackCallback = null;
    }
  }
  
  advanceToNextTurn() {
    // Save quarter summary before advancing
    this.saveQuarterSummary();
    
    // === CHECK FOR UNLOCKS ===
    const newUnlocks = this.checkUnlocks();
    
    // === RECORD STRATEGIC FOCUS for this quarter ===
    if (this.strategicFocus) {
      this.focusHistory.push({
        quarter: this.turn,
        focus: this.strategicFocus
      });
    }
    
    // Integrating staff become fully productive
    const integratingCount = this.integratingStaff;
    if (integratingCount > 0) {
      this.integratingStaff = 0; // Clear first so getStaffAPBonus shows correct value
      const newBonus = this.getStaffAPBonus();
      const staffCount = this.metrics?.staff || 0;
      const startingStaff = this.startingStaff || 0;
      const hiredStaff = staffCount - startingStaff;
      const nextThreshold = hiredStaff < 1 ? 1 : hiredStaff < 3 ? 3 : hiredStaff < 5 ? 5 : null;
      const thresholdText = nextThreshold ? ` (${nextThreshold - hiredStaff} more hire${nextThreshold - hiredStaff !== 1 ? 's' : ''} â†’ next tier)` : ' (max tier)';
      this.log(`âœ… ${integratingCount} new staff integrated. Hires: ${hiredStaff} â†’ +${newBonus} AP${thresholdText}`);
    } else {
      this.integratingStaff = 0;
    }
    this.staffAPPenalty = 0;
    this.fundingAPCost = 0; // Reset fundraising cost for new quarter
    this.lifeEventAPMod = 0; // Reset life event AP modifier for new quarter
    this.jobPostingAPCost = 0; // Legacy reset
    
    // Track hiring patterns for sustained growth penalties
    this.hiresPreviousQuarter = this.hiresThisQuarter || 0;
    this.hiresThisQuarter = 0;
    
    // === HASTY DECISION: Reset quarterly tracking ===
    this.resetQuarterlyHastyTracking();
    
    // === RESET STRATEGIC FOCUS for new quarter ===
    this.strategicFocus = null;
    
    // Next turn
    this.turn++;
    this.choices = {};
    this.randomizeStartingDomain();
    this.selectQuarterEvents();
    this.update();
    this.renderBoardroom();
    
    // Show unlock notification if any
    if (newUnlocks.length > 0) {
      setTimeout(() => this.showUnlockNotification(), 500);
    }
    
    // Show situation brief at the start of each quarter
    // Life events will be checked after the brief is closed
    this.showSituationBrief();
  }

  // ===== MINI-GAME INTRO TRANSITION =====
  
  showMiniGameIntro(type) {
    // Store which mini-game is pending
    this.pendingMiniGame = type;
    
    // Define content for each mini-game type
    const content = {
      conference: {
        icon: "ğŸª",
        title: "Conference Time!",
        headerClass: "from-blue-600 to-indigo-700",
        desc: "You're heading to an industry conference! Work your booth, attract delegates, and generate leads for your startup. Spend your budget wisely!",
        tips: [
          "Click on delegates walking by to engage them",
          "Use ğŸ Swag and â˜• Coffee to attract attention",
          "Run demos to impress serious prospects",
          "Watch your budget - don't overspend!"
        ],
        rewards: "ğŸ’° Cash Leads â€¢ ğŸ“ˆ Marketing Boost â€¢ ğŸŒŸ Brand Awareness"
      },
      pitch: {
        icon: "ğŸ¤",
        title: "Investor Pitch!",
        headerClass: "from-purple-600 to-pink-600",
        desc: "You've got 30 seconds in front of venture capitalists! Keep their attention high, use your pitch points wisely, and convince them your startup is worth backing.",
        tips: [
          "Watch the attention meter - don't let it drop!",
          "Different actions cost different points",
          "Time your demo for maximum impact",
          "Read the investors' reactions"
        ],
        rewards: "ğŸ’° Funding Boost â€¢ ğŸ“Š Valuation Increase â€¢ ğŸ¤ Investor Relations"
      },
      demoday: {
        icon: "ğŸš€",
        title: "Demo Day!",
        headerClass: "from-amber-500 to-orange-600",
        desc: "It's Demo Day! You have 60 seconds as visitors approach your booth. Engage leads, build interest, and close deals. Not everyone is worth your time - choose wisely!",
        tips: [
          "Engage visitors first to see their value and preferences",
          "Green offers match preferences - bigger interest boost!",
          "Demo & Custom give huge boosts but cost money - save for high-value visitors!",
          "âš  Using 5+ Demos/Customs costs 1 AP, 6+ costs 2 AP (follow-up overload)"
        ],
        rewards: "ğŸ’° Contract Revenue â€¢ ğŸ“ˆ All Stats Boost â€¢ â­ Prestige Clients"
      }
    };
    
    const c = content[type] || content.conference;
    
    // Update modal content
    document.getElementById("minigameIntroIcon").textContent = c.icon;
    document.getElementById("minigameIntroTitle").textContent = c.title;
    document.getElementById("minigameIntroHeader").className = `bg-gradient-to-r ${c.headerClass} text-white p-6 text-center`;
    document.getElementById("minigameIntroDesc").textContent = c.desc;
    document.getElementById("minigameIntroRewards").textContent = c.rewards;
    
    // Update tips
    const tipsList = document.getElementById("minigameIntroTipsList");
    tipsList.innerHTML = c.tips.map(tip => `<li>â€¢ ${tip}</li>`).join("");
    
    // Play intro sound
    this.playMiniGameIntroSound();
    
    // Show modal
    document.getElementById("minigameIntroModal").classList.remove("hidden");
    document.getElementById("minigameIntroModal").classList.add("flex");
  }
  
  playMiniGameIntroSound() {
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const now = ctx.currentTime;
      
      // Create a pleasant "level up" / announcement sound
      // Rising arpeggio with reverb feel
      const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
      
      notes.forEach((freq, i) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        
        osc.type = "sine";
        osc.frequency.setValueAtTime(freq, now + i * 0.1);
        
        gain.gain.setValueAtTime(0, now + i * 0.1);
        gain.gain.linearRampToValueAtTime(0.15, now + i * 0.1 + 0.05);
        gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.1 + 0.4);
        
        osc.connect(gain);
        gain.connect(ctx.destination);
        
        osc.start(now + i * 0.1);
        osc.stop(now + i * 0.1 + 0.5);
      });
      
      // Add a final shimmer
      setTimeout(() => {
        const shimmer = ctx.createOscillator();
        const shimmerGain = ctx.createGain();
        shimmer.type = "triangle";
        shimmer.frequency.setValueAtTime(1567.98, ctx.currentTime); // G6
        shimmerGain.gain.setValueAtTime(0.08, ctx.currentTime);
        shimmerGain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.6);
        shimmer.connect(shimmerGain);
        shimmerGain.connect(ctx.destination);
        shimmer.start();
        shimmer.stop(ctx.currentTime + 0.6);
      }, 350);
      
    } catch (e) {
      console.log("Mini-game intro sound not available");
    }
  }
  
  startPendingMiniGame() {
    // Hide intro modal
    document.getElementById("minigameIntroModal").classList.add("hidden");
    document.getElementById("minigameIntroModal").classList.remove("flex");
    
    // Start the appropriate mini-game
    const type = this.pendingMiniGame;
    this.pendingMiniGame = null;
    
    if (type === "conference") {
      this.startConference();
    } else if (type === "pitch") {
      this.startPitch();
    } else if (type === "demoday") {
      this.startDemoDay();
    }
  }

  // ===== CONFERENCE MINI-GAME =====
  
  startConference() {
    // Use current milestone number (1, 2, or 3)
    const milestoneNum = Math.min(3, Math.max(1, this.completedMilestones.length + 1));
    const costs = CONF_COSTS[milestoneNum] || CONF_COSTS[1];
    const conferences = CONFERENCES[this.company.id] || CONFERENCES.aether;
    const conf = conferences[Math.floor(Math.random() * conferences.length)];
    
    this.conferencesAttended++;
    
    // Initialize conference state
    this.conf = {
      active: true,
      timeLeft: 45, // 45 seconds
      budget: costs.budget,
      budgetSpent: 0,
      leads: 0,
      quality: 0,
      interest: 0,
      rivalInterest: 20, // Rivals start with some interest
      rivalLeads: 0,
      delegates: [],
      delegateId: 0,
      costs: costs,
      milestoneNum: milestoneNum,
      demoCooldown: 0,
      talkUsed: false,
      waveCount: 0,
      rivalActionTimer: 0,
      // === ACTION TRACKING FOR DEBRIEF ===
      actionsUsed: { wave: 0, swag: 0, coffee: 0, demo: 0, talk: 0 },
      leadsFromEngaged: 0, // Leads from engaged delegates (attracted by actions)
      leadsFromRandom: 0   // Leads from random walk-ins
    };
    
    // Update UI
    document.getElementById("confName").textContent = `${conf.name} â€¢ ${conf.location}`;
    document.getElementById("confBoothName").textContent = this.company.name.toUpperCase();
    document.getElementById("confBudget").textContent = `Â£${this.conf.budget.toLocaleString()}`;
    document.getElementById("confLeads").textContent = "0";
    document.getElementById("confQuality").textContent = "0";
    document.getElementById("confInterest").textContent = "0";
    document.getElementById("confRivalInterest").textContent = "20";
    document.getElementById("confTimer").textContent = "0:45";
    
    // Update cost displays
    document.querySelectorAll(".swag-cost").forEach(el => el.textContent = costs.swag);
    document.querySelectorAll(".coffee-cost").forEach(el => el.textContent = costs.coffee);
    document.querySelectorAll(".demo-cost").forEach(el => el.textContent = costs.demo);
    document.querySelectorAll(".talk-cost").forEach(el => el.textContent = costs.talk);
    
    // Clear delegates
    document.getElementById("confDelegates").innerHTML = "";
    document.getElementById("confEffects").innerHTML = "";
    
    // Reset buttons
    document.querySelectorAll(".conf-action-btn").forEach(btn => btn.disabled = false);
    document.getElementById("confDemoStatus").textContent = "â–¶ Demo Ready";
    
    // Start background music
    this.startConfMusic();
    
    // Show modal
    document.getElementById("conferenceModal").classList.remove("hidden");
    document.getElementById("conferenceModal").classList.add("flex");
    
    // Start game loop
    this.confGameLoop();
    this.confSpawnLoop();
    this.confRivalLoop();
  }
  
  startConfMusic() {
    // Create audio context for upbeat background music
    try {
      this.confAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
      this.confMusicPlaying = true;
      this.playConfMusicLoop();
    } catch (e) {
      console.log("Audio not available");
    }
  }
  
  playConfMusicLoop() {
    if (!this.confMusicPlaying || !this.confAudioCtx) return;
    
    const ctx = this.confAudioCtx;
    const now = ctx.currentTime;
    
    // Simple upbeat melody pattern
    const notes = [261.63, 329.63, 392.00, 329.63, 261.63, 392.00, 329.63, 261.63]; // C4, E4, G4 pattern
    const bassNotes = [130.81, 130.81, 164.81, 164.81]; // C3, E3 bass
    
    notes.forEach((freq, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = 'square';
      osc.frequency.value = freq;
      gain.gain.value = 0.03;
      gain.gain.exponentialRampToValueAtTime(0.001, now + (i + 1) * 0.15);
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start(now + i * 0.15);
      osc.stop(now + (i + 1) * 0.15);
    });
    
    // Bass
    bassNotes.forEach((freq, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = 'triangle';
      osc.frequency.value = freq;
      gain.gain.value = 0.05;
      gain.gain.exponentialRampToValueAtTime(0.001, now + (i + 1) * 0.3);
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start(now + i * 0.3);
      osc.stop(now + (i + 1) * 0.3);
    });
    
    // Loop
    setTimeout(() => this.playConfMusicLoop(), 1200);
  }
  
  stopConfMusic() {
    this.confMusicPlaying = false;
    if (this.confAudioCtx) {
      this.confAudioCtx.close();
      this.confAudioCtx = null;
    }
  }
  
  confGameLoop() {
    if (!this.conf?.active) return;
    
    this.conf.timeLeft -= 0.1;
    
    // Update timer
    const mins = Math.floor(this.conf.timeLeft / 60);
    const secs = Math.floor(this.conf.timeLeft % 60);
    document.getElementById("confTimer").textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
    
    // Demo cooldown
    if (this.conf.demoCooldown > 0) {
      this.conf.demoCooldown -= 0.1;
      if (this.conf.demoCooldown <= 0) {
        document.getElementById("confDemoStatus").textContent = "â–¶ Demo Ready";
        document.getElementById("confActionDemo").disabled = false;
      }
    }
    
    // Move delegates
    this.confMoveDelegates();
    
    // Decay interest slowly
    this.conf.interest = Math.max(0, this.conf.interest - 0.05);
    document.getElementById("confInterest").textContent = Math.round(this.conf.interest);
    
    // End game?
    if (this.conf.timeLeft <= 0) {
      this.endConference();
      return;
    }
    
    setTimeout(() => this.confGameLoop(), 100);
  }
  
  confSpawnLoop() {
    if (!this.conf?.active) return;
    
    // Faster spawn rate for 45s game
    const spawnChance = 0.5 + (this.conf.interest / 150);
    
    if (Math.random() < spawnChance && this.conf.delegates.length < 20) {
      this.confSpawnDelegate();
    }
    
    setTimeout(() => this.confSpawnLoop(), 500); // Faster spawning
  }
  
  confSpawnDelegate() {
    // Weight delegate types - more common types appear more often
    const weights = [30, 25, 20, 12, 5, 5, 3]; // student to competitor
    const totalWeight = weights.reduce((a, b) => a + b, 0);
    let random = Math.random() * totalWeight;
    let typeIndex = 0;
    for (let i = 0; i < weights.length; i++) {
      random -= weights[i];
      if (random <= 0) {
        typeIndex = i;
        break;
      }
    }
    
    const delegateType = DELEGATE_TYPES[typeIndex];
    const fromLeft = Math.random() > 0.5;
    const id = this.conf.delegateId++;
    
    const delegate = {
      id,
      ...delegateType,
      x: fromLeft ? -30 : 830,
      direction: fromLeft ? 1 : -1,
      interestLevel: 0,
      mood: 'neutral',
      engaged: false,
      engagedTo: null // 'player', 'left', 'right'
    };
    
    this.conf.delegates.push(delegate);
    
    // Create DOM element with SVG person
    const el = document.createElement("div");
    el.id = `delegate-${id}`;
    el.className = "conf-delegate walking";
    el.style.left = `${delegate.x}px`;
    el.innerHTML = getDelegateSVG(delegate.type, 'neutral');
    el.onclick = () => this.confClickDelegate(id);
    
    document.getElementById("confDelegates").appendChild(el);
  }
  
  confRivalLoop() {
    if (!this.conf?.active) return;
    
    // Rivals do random actions
    this.conf.rivalActionTimer -= 0.5;
    if (this.conf.rivalActionTimer <= 0) {
      this.confRivalAction();
      this.conf.rivalActionTimer = 3 + Math.random() * 4; // Every 3-7 seconds
    }
    
    setTimeout(() => this.confRivalLoop(), 500);
  }
  
  confRivalAction() {
    const actions = ['demo', 'swag', 'wave'];
    const action = actions[Math.floor(Math.random() * actions.length)];
    const isLeft = Math.random() > 0.5;
    const boothEl = document.getElementById(isLeft ? 'confBoothLeft' : 'confBoothRight');
    const demoEl = document.getElementById(isLeft ? 'confLeftDemo' : 'confRightDemo');
    
    // Visual feedback
    if (boothEl) {
      boothEl.classList.add('conf-rival-action');
      setTimeout(() => boothEl.classList.remove('conf-rival-action'), 500);
    }
    
    // Update demo status
    if (action === 'demo' && demoEl) {
      demoEl.textContent = 'ğŸ”´ LIVE!';
      setTimeout(() => demoEl.textContent = 'â–¶ DEMO', 2000);
    }
    
    // Boost rival interest
    const boost = action === 'demo' ? 15 : action === 'swag' ? 8 : 3;
    this.conf.rivalInterest = Math.min(100, this.conf.rivalInterest + boost);
    document.getElementById("confRivalInterest").textContent = Math.round(this.conf.rivalInterest);
    
    // Rivals might steal delegates near their booth
    const rivalBoothX = isLeft ? 80 : 720;
    this.conf.delegates.forEach(d => {
      if (!d.engaged && Math.abs(d.x - rivalBoothX) < 100) {
        if (Math.random() < 0.15 && this.conf.rivalInterest > this.conf.interest) {
          d.engaged = true;
          d.engagedTo = isLeft ? 'left' : 'right';
          const el = document.getElementById(`delegate-${d.id}`);
          if (el) {
            el.classList.remove('walking');
            el.classList.add('interested');
          }
        }
      }
    });
  }
  
  confMoveDelegates() {
    const boothLeft = 320;
    const boothRight = 480;
    const toRemove = [];
    
    this.conf.delegates.forEach(d => {
      const el = document.getElementById(`delegate-${d.id}`);
      if (!el) return;
      
      // If engaged to player, move toward your booth
      if (d.engaged && d.engagedTo === 'player') {
        const targetX = 400;
        const diff = targetX - d.x;
        d.x += diff * 0.08;
        
        // Check if converted
        if (Math.abs(diff) < 20 && d.interestLevel >= 100) {
          this.confConvertDelegate(d);
          toRemove.push(d.id);
        }
      } else if (d.engagedTo === 'left' || d.engagedTo === 'right') {
        // Moving to rival booth
        const targetX = d.engagedTo === 'left' ? 80 : 720;
        const diff = targetX - d.x;
        d.x += diff * 0.08;
        
        // Convert to rival
        if (Math.abs(diff) < 15) {
          this.conf.rivalLeads++;
          toRemove.push(d.id);
          const el = document.getElementById(`delegate-${d.id}`);
          if (el) el.remove();
        }
      } else {
        // Normal walking
        d.x += d.direction * d.speed;
        
        // Near your booth - might get interested or disgusted
        if (d.x > boothLeft && d.x < boothRight) {
          // High interest attracts them
          if (this.conf.interest > 20 && Math.random() < 0.04) {
            d.engaged = true;
            d.engagedTo = 'player';
            d.interestLevel = 25;
            d.mood = 'interested';
            el.classList.remove('walking');
            el.classList.add("interested");
            el.innerHTML = getDelegateSVG(d.type, 'interested');
          }
          // Some delegates get turned off (irritable ones more likely)
          else if (Math.random() < d.irritable * 0.03) {
            d.mood = 'disgusted';
            el.classList.add("disgusted");
            el.innerHTML = getDelegateSVG(d.type, 'disgusted');
            this.confShowEffect(d.x, 180, "ğŸ˜¤", "#ef4444");
            // Speed up to leave
            d.speed *= 1.5;
          }
        }
        
        // Near rival booths - might get stolen
        if ((d.x > 40 && d.x < 140) || (d.x > 680 && d.x < 780)) {
          if (Math.random() < 0.02 && this.conf.rivalInterest > this.conf.interest) {
            d.engaged = true;
            d.engagedTo = d.x < 400 ? 'left' : 'right';
            d.mood = 'interested';
            el.classList.remove('walking');
            el.classList.add("interested");
          }
        }
        
        // Remove if off screen
        if (d.x < -40 || d.x > 840) {
          toRemove.push(d.id);
        }
      }
      
      el.style.left = `${d.x}px`;
    });
    
    // Remove delegates
    toRemove.forEach(id => {
      const el = document.getElementById(`delegate-${id}`);
      if (el) el.remove();
      this.conf.delegates = this.conf.delegates.filter(d => d.id !== id);
    });
  }
  
  confClickDelegate(id) {
    const d = this.conf.delegates.find(x => x.id === id);
    if (!d || d.engagedTo === 'left' || d.engagedTo === 'right') return; // Can't steal from rivals
    
    // Clicking boosts their interest
    d.interestLevel += 20;
    d.engaged = true;
    d.engagedTo = 'player';
    d.mood = 'interested';
    
    const el = document.getElementById(`delegate-${id}`);
    if (el) {
      el.classList.remove('walking', 'disgusted');
      el.classList.add("interested");
      el.innerHTML = getDelegateSVG(d.type, 'interested');
      this.confShowEffect(d.x, 180, "+ğŸ¯");
    }
    
    // Check if converted
    if (d.interestLevel >= 100) {
      this.confConvertDelegate(d);
    }
  }
  
  confConvertDelegate(d) {
    const el = document.getElementById(`delegate-${d.id}`);
    if (el) {
      el.classList.remove("interested", "walking");
      el.classList.add("converting");
      setTimeout(() => el.remove(), 400);
    }
    
    // Remove from array
    this.conf.delegates = this.conf.delegates.filter(x => x.id !== d.id);
    
    // Add lead (or lose point for competitor)
    if (d.type === "competitor") {
      this.conf.quality -= 2;
      this.confShowEffect(400, 150, "ğŸ•µ Spy!", "#ef4444");
    } else {
      this.conf.leads++;
      this.conf.quality += d.value;
      // Track lead source for debrief
      if (d.engaged) {
        this.conf.leadsFromEngaged = (this.conf.leadsFromEngaged || 0) + 1;
      } else {
        this.conf.leadsFromRandom = (this.conf.leadsFromRandom || 0) + 1;
      }
      this.confShowEffect(400, 150, `+1 Lead! â­${d.value}`, "#10b981");
    }
    
    // Update UI
    document.getElementById("confLeads").textContent = this.conf.leads;
    document.getElementById("confQuality").textContent = this.conf.quality;
  }
  
  confAction(type) {
    const costs = this.conf.costs;
    let cost = 0;
    
    // Track action usage for debrief
    if (this.conf.actionsUsed) {
      this.conf.actionsUsed[type] = (this.conf.actionsUsed[type] || 0) + 1;
    }
    
    switch (type) {
      case "wave":
        // Free, small effect
        this.conf.waveCount++;
        this.conf.interest += 3;
        this.confShowWave();
        // Boost nearby delegates
        this.conf.delegates.forEach(d => {
          if (d.x > 250 && d.x < 550 && !d.engaged) {
            d.interestLevel += 5;
          }
        });
        break;
        
      case "swag":
        cost = costs.swag;
        if (this.conf.budget < cost) return;
        this.conf.budget -= cost;
        this.conf.interest += 8;
        this.confShowEffect(350, 250, "ğŸ", "#f59e0b");
        // Boost all visible delegates
        this.conf.delegates.forEach(d => {
          if (d.x > 100 && d.x < 700) {
            d.interestLevel += 10;
          }
        });
        break;
        
      case "coffee":
        cost = costs.coffee;
        if (this.conf.budget < cost) return;
        this.conf.budget -= cost;
        this.conf.interest += 15;
        this.confShowEffect(450, 250, "â˜•", "#f97316");
        // Stronger effect on nearby delegates
        this.conf.delegates.forEach(d => {
          if (d.x > 200 && d.x < 600) {
            d.interestLevel += 20;
            if (!d.engaged && d.interestLevel > 30) {
              d.engaged = true;
              const el = document.getElementById(`delegate-${d.id}`);
              if (el) el.classList.add("interested");
            }
          }
        });
        break;
        
      case "demo":
        cost = costs.demo;
        if (this.conf.budget < cost || this.conf.demoCooldown > 0) return;
        this.conf.budget -= cost;
        this.conf.interest += 30;
        this.conf.demoCooldown = 10; // 10 second cooldown
        document.getElementById("confDemoStatus").textContent = "ğŸ”„ Running...";
        document.getElementById("confActionDemo").disabled = true;
        this.confShowEffect(400, 180, "ğŸ’» DEMO!", "#3b82f6");
        // Big boost to all delegates
        this.conf.delegates.forEach(d => {
          d.interestLevel += 25;
          if (!d.engaged && d.interestLevel > 20) {
            d.engaged = true;
            const el = document.getElementById(`delegate-${d.id}`);
            if (el) el.classList.add("interested");
          }
        });
        break;
        
      case "talk":
        cost = costs.talk;
        if (this.conf.budget < cost || this.conf.talkUsed) return;
        this.conf.budget -= cost;
        this.conf.interest += 50;
        this.conf.talkUsed = true;
        document.getElementById("confActionTalk").disabled = true;
        this.confShowEffect(400, 100, "ğŸ¤ KEYNOTE!", "#8b5cf6");
        // Massive boost
        this.conf.delegates.forEach(d => {
          d.interestLevel += 40;
          d.engaged = true;
          const el = document.getElementById(`delegate-${d.id}`);
          if (el) el.classList.add("interested");
        });
        break;
    }
    
    // Update budget display
    document.getElementById("confBudget").textContent = `Â£${this.conf.budget.toLocaleString()}`;
    document.getElementById("confInterest").textContent = Math.round(this.conf.interest);
  }
  
  confShowEffect(x, y, text, color = "#000") {
    const el = document.createElement("div");
    el.className = "conf-effect";
    el.style.left = `${x}px`;
    el.style.top = `${y}px`;
    el.style.color = color;
    el.style.fontWeight = "bold";
    el.style.fontSize = "16px";
    el.textContent = text;
    
    document.getElementById("confEffects").appendChild(el);
    setTimeout(() => el.remove(), 600);
  }
  
  confShowWave() {
    const el = document.createElement("div");
    el.className = "conf-wave";
    el.style.left = "380px";
    el.style.top = "220px";
    el.style.width = "40px";
    el.style.height = "40px";
    
    document.getElementById("confEffects").appendChild(el);
    setTimeout(() => el.remove(), 800);
  }
  
  endConference() {
    this.conf.active = false;
    this.stopConfMusic();
    
    // Calculate results
    const leads = this.conf.leads;
    const quality = this.conf.quality;
    const rivalLeads = this.conf.rivalLeads || 0;
    const spent = CONF_COSTS[this.conf.milestoneNum]?.budget - this.conf.budget || 0;
    
    // Determine tier (compare to rivals too)
    let tier, icon, title;
    const netLeads = leads - rivalLeads;
    if (leads <= 3) {
      tier = 1;
      icon = "ğŸ˜•";
      title = "Quiet Show";
    } else if (leads <= 8) {
      tier = 2;
      icon = "ğŸ‘";
      title = "Decent Showing";
    } else if (leads <= 15) {
      tier = 3;
      icon = "ğŸŒŸ";
      title = "Great Booth!";
    } else if (leads <= 25) {
      tier = 4;
      icon = "ğŸ”¥";
      title = "Hit of the Show!";
    } else {
      tier = 5;
      icon = "ğŸ†";
      title = "Legendary Performance!";
    }
    
    // Calculate rewards based on tier and milestone stage
    const milestoneNum = this.conf.milestoneNum || 1;
    const multiplier = milestoneNum; // Later milestones = bigger rewards
    
    const rewards = {
      mkt: tier * multiplier,
      sci: tier >= 3 ? Math.floor(tier / 2) * multiplier : 0,
      cash: tier >= 3 ? (30 + (tier - 2) * 40) * multiplier : 0, // Tier 3: 70k, Tier 4: 110k, Tier 5: 150k (x milestone)
      val: tier >= 3 ? (20 + (tier - 2) * 25) * multiplier : 0   // Tier 3: 45k, Tier 4: 70k, Tier 5: 95k (x milestone)
    };
    
    // Apply rewards
    Object.entries(rewards).forEach(([k, v]) => {
      if (v > 0 && this.metrics[k] !== undefined) {
        this.metrics[k] += v;
      }
    });
    
    // === REVENUE SYSTEM: Convert high-quality conference leads to pipeline ===
    const pipelineResults = this.applyConferenceRevenueBonus(leads, quality, tier);
    
    // Hide game modal
    document.getElementById("conferenceModal").classList.add("hidden");
    document.getElementById("conferenceModal").classList.remove("flex");
    
    // Show results
    document.getElementById("confResultIcon").textContent = icon;
    document.getElementById("confResultTitle").textContent = title;
    document.getElementById("confResultText").textContent = 
      tier <= 2 ? "Not many people stopped by, but you made some connections." :
      tier === 3 ? "Good engagement! Your booth attracted solid interest." :
      tier === 4 ? "Fantastic! People were queuing to see your demo." :
      "Incredible! You were the talk of the conference!";
    
    document.getElementById("confResultStats").innerHTML = `
      <div class="flex justify-between mb-1"><span>Leads Generated:</span><span class="font-bold">${leads}</span></div>
      <div class="flex justify-between mb-1"><span>Lead Quality:</span><span class="font-bold">â­${quality}</span></div>
      <div class="flex justify-between"><span>Budget Spent:</span><span class="font-bold">Â£${spent.toLocaleString()}</span></div>
      ${pipelineResults.added > 0 ? `<div class="flex justify-between text-emerald-600"><span>Pipeline Leads:</span><span class="font-bold">+${pipelineResults.added}</span></div>` : ''}
    `;
    
    const rewardLines = [];
    if (rewards.mkt > 0) rewardLines.push(`+${rewards.mkt} Sales`);
    if (rewards.sci > 0) rewardLines.push(`+${rewards.sci} Research`);
    if (rewards.cash > 0) rewardLines.push(`+Â£${rewards.cash}k Cash`);
    if (rewards.val > 0) rewardLines.push(`+Â£${rewards.val}k Valuation`);
    
    document.getElementById("confResultRewards").innerHTML = rewardLines.length > 0 
      ? `<div class="font-bold mb-1">Rewards:</div>${rewardLines.join(" â€¢ ")}`
      : `<div class="text-slate-500">No significant rewards this time.</div>`;
    
    // Generate and display debrief insights
    const debriefInsights = this.generateConferenceDebrief();
    document.getElementById("confDebriefList").innerHTML = debriefInsights
      .map(insight => `<li>â€¢ ${insight}</li>`).join('');
    
    document.getElementById("conferenceResultsModal").classList.remove("hidden");
    document.getElementById("conferenceResultsModal").classList.add("flex");
    
    this.log(`ğŸ“ Attended conference: ${leads} leads, +${rewards.mkt} Sales${pipelineResults.added > 0 ? `, +${pipelineResults.added} pipeline` : ''}`);
  }
  
  // === CONFERENCE REVENUE BONUS ===
  // Convert high-quality conference leads into revenue pipeline
  applyConferenceRevenueBonus(leads, quality, tier) {
    if (!this.revenueModel) return { added: 0 };
    
    // Conference leads are early-stage - they need to be nurtured
    // Only high-quality leads from good conferences convert to pipeline
    
    let pipelineDeals = 0;
    
    // Hidden bonus from founder/funder
    let conversionBonus = 0;
    if (this.founderBonuses?.commercial > 3) conversionBonus += 0.1;
    if (this.funder?.id === 'dragon') conversionBonus += 0.05;
    if (this.funder?.id === 'techAngel') conversionBonus += 0.1;  // Networker
    
    // Quality threshold: need quality 3+ for pipeline leads
    if (quality >= 3 && tier >= 3) {
      // Convert a fraction of leads to pipeline based on quality
      const conversionRate = 0.1 + (quality - 3) * 0.05 + conversionBonus;  // 10-25% based on quality
      const potentialDeals = Math.floor(leads * conversionRate);
      
      for (let i = 0; i < Math.min(potentialDeals, 3); i++) {
        // Conference leads take longer to close (3-4 quarters)
        const dealValue = this.revenueModel.metrics.avgRevenuePerCustomer * (0.5 + Math.random() * 0.3);
        this.pipeline.push({
          value: Math.round(dealValue),
          closeIn: 3 + Math.floor(Math.random() * 2),
          addedQuarter: this.turn,
          name: `Conference Lead ${i + 1}`,
          probability: 0.25 + (quality - 3) * 0.05 + conversionBonus,
          source: 'conference'
        });
        pipelineDeals++;
      }
    }
    
    // Exceptional conference (tier 5, quality 5) = one hot lead
    if (tier >= 5 && quality >= 5 && Math.random() < 0.4 + conversionBonus) {
      this.pipeline.push({
        value: Math.round(this.revenueModel.metrics.avgRevenuePerCustomer * 0.9),
        closeIn: 2,
        addedQuarter: this.turn,
        name: 'Hot Conference Lead',
        probability: 0.5 + conversionBonus,
        source: 'conference'
      });
      pipelineDeals++;
    }
    
    return { added: pipelineDeals };
  }
  
  // === CONFERENCE DEBRIEF GENERATION ===
  generateConferenceDebrief() {
    const insights = [];
    const actions = this.conf.actionsUsed || {};
    const totalBudget = CONF_COSTS[this.conf.milestoneNum]?.budget || 3000;
    const spent = totalBudget - this.conf.budget;
    const leads = this.conf.leads;
    const leadsEngaged = this.conf.leadsFromEngaged || 0;
    const leadsRandom = this.conf.leadsFromRandom || 0;
    
    // Calculate action percentages
    const totalActions = Object.values(actions).reduce((a, b) => a + b, 0);
    const demoUsed = actions.demo > 0;
    const talkUsed = actions.talk > 0;
    const swagCount = actions.swag || 0;
    const coffeeCount = actions.coffee || 0;
    const waveCount = actions.wave || 0;
    
    // Insight: Budget allocation
    if (spent > 0) {
      const swagSpend = swagCount * (this.conf.costs?.swag || 200);
      const coffeeSpend = coffeeCount * (this.conf.costs?.coffee || 500);
      const demoSpend = demoUsed ? (this.conf.costs?.demo || 800) : 0;
      const talkSpend = talkUsed ? (this.conf.costs?.talk || 1500) : 0;
      
      const swagPercent = Math.round((swagSpend / spent) * 100);
      const coffeePercent = Math.round((coffeeSpend / spent) * 100);
      
      if (swagPercent > 50) {
        insights.push(`You spent ${swagPercent}% of budget on swag. Swag attracts attention but demos convert better.`);
      } else if (coffeePercent > 40) {
        insights.push(`Coffee runs were popular (${coffeePercent}% of spend). Good for engagement, expensive per lead.`);
      }
    }
    
    // Insight: Demo effectiveness
    if (demoUsed && leadsEngaged > leadsRandom) {
      insights.push(`Most leads (${leadsEngaged}/${leads}) came from engaged visitorsâ€”demos and talks work!`);
    } else if (!demoUsed && leads < 8) {
      insights.push(`No demos run. Demos are expensive but convert curious visitors into leads.`);
    }
    
    // Insight: Talk usage
    if (talkUsed && leads >= 10) {
      insights.push(`Your keynote talk drew a crowd. High-cost, high-impact strategy paid off.`);
    } else if (!talkUsed && spent > totalBudget * 0.7) {
      insights.push(`You didn't use the keynote talk. It's expensive but can flood your booth with visitors.`);
    }
    
    // Insight: Wave spamming
    if (waveCount > 10 && leads < 5) {
      insights.push(`Lots of waving (${waveCount}x) but few leads. Waving is free but only works on nearby visitors.`);
    }
    
    // Insight: Efficiency
    if (leads > 0 && spent > 0) {
      const costPerLead = Math.round(spent / leads);
      if (costPerLead > 400) {
        insights.push(`Cost per lead was Â£${costPerLead}. Mix free actions (waves) with paid actions for better ROI.`);
      } else if (costPerLead < 150) {
        insights.push(`Excellent efficiency! Â£${costPerLead} per lead is well below industry average.`);
      }
    }
    
    // Insight: No budget spent
    if (spent === 0 && leads > 0) {
      insights.push(`Free leads from waves only! Great ROI, but you missed conversion opportunities.`);
    }
    
    // Fallback insight
    if (insights.length === 0) {
      if (leads >= 15) {
        insights.push(`Strong performance! You balanced attention-grabbing with conversion tactics.`);
      } else {
        insights.push(`Try mixing free waves with targeted demos to maximize lead quality.`);
      }
    }
    
    return insights.slice(0, 3); // Max 3 insights
  }
  
  closeConference() {
    document.getElementById("conferenceResultsModal").classList.add("hidden");
    document.getElementById("conferenceResultsModal").classList.remove("flex");
    // Player continues making their choices for the quarter
  }

  // ===== INVESTOR PITCH MINI-GAME =====
  
  // Test function to jump directly to pitch mini-game
  testPitch() {
    // Set up minimal game state for testing
    this.company = { id: 'aether', name: 'Aether BioLabs', color: '#10b981' };
    this.metrics = { cash: 500, val: 1200, equity: 75, staff: 8, burn: 80, sci: 45, dev: 40, mkt: 35, hr: 50 };
    this.completedMilestones = ['m1', 'm2']; // Pretend we completed M1 and M2
    
    // Hide preamble
    document.getElementById("preambleModal1").classList.add("hidden");
    
    // Show intro first (or call this.startPitch() directly to skip intro)
    this.showMiniGameIntro("pitch");
  }
  
  // Test functions for other mini-games
  testConference() {
    this.company = { id: 'aether', name: 'Aether BioLabs', color: '#10b981' };
    this.metrics = { cash: 500, val: 1200, equity: 75, staff: 8, burn: 80, sci: 45, dev: 40, mkt: 35, hr: 50 };
    this.completedMilestones = [];
    document.getElementById("preambleModal1").classList.add("hidden");
    this.showMiniGameIntro("conference");
  }
  
  testDemoDay() {
    this.company = { id: 'aether', name: 'Aether BioLabs', color: '#10b981', subtitle: 'AI-Powered Healthcare' };
    this.metrics = { cash: 500, val: 1200, equity: 75, staff: 8, burn: 80, sci: 45, dev: 40, mkt: 35, hr: 50 };
    this.completedMilestones = ['m1', 'm2'];
    document.getElementById("preambleModal1").classList.add("hidden");
    this.showMiniGameIntro("demoday");
  }


  // ===== MEDIA DAY MINI-GAME (M3) =====
  // ===== DEMO DAY MINI-GAME (M3) =====
  
  // Hidden bonuses for Demo Day based on founder/funder/location
  // These subtly improve performance without being visible to player
  calculateDemoDayHiddenBonus() {
    const bonus = {
      extraTime: 0,
      extraSwag: 0,
      extraCoffee: 0,
      extraDemo: 0,
      extraPatience: 0,
      interestBonus: 0,
      highValueBonus: 0
    };
    
    // === FOUNDER EFFECTS ===
    if (this.founderBonuses) {
      const commercial = this.founderBonuses.commercial || 2;
      const leadership = this.founderBonuses.leadership || 2;
      
      // High commercial skill = better at engaging visitors
      if (commercial >= 4) {
        bonus.interestBonus += 5;  // Visitors start more interested
        bonus.extraPatience += 2;  // Better at keeping attention
      } else if (commercial >= 3) {
        bonus.interestBonus += 2;
      } else if (commercial <= 1) {
        bonus.interestBonus -= 3;  // Struggle with sales talk
      }
      
      // Leadership draws high-value visitors
      if (leadership >= 4) {
        bonus.highValueBonus += 0.1;  // 10% more likely to get enterprise/CTO
      }
    }
    
    // === FUNDER EFFECTS ===
    if (this.funder) {
      const funderId = this.funder.id;
      
      // TV Dragon - media presence, better booth resources
      if (funderId === 'dragon') {
        bonus.extraSwag += 2;
        bonus.extraTime += 5;  // Better booth placement
        bonus.interestBonus += 3;  // Brand recognition
      }
      
      // Corporate VC - brings enterprise connections
      if (funderId === 'corporate') {
        bonus.highValueBonus += 0.2;  // Much more likely to get enterprise
        bonus.extraDemo += 1;  // Better demo equipment
      }
      
      // Tech Angel - startup network
      if (funderId === 'techAngel') {
        bonus.extraCoffee += 2;  // Networking budget
        bonus.highValueBonus += 0.05;
      }
      
      // Tier 1 VC - credibility draws interest
      if (funderId === 'tier1') {
        bonus.interestBonus += 4;
        bonus.highValueBonus += 0.1;
      }
      
      // Bootstrap - lean but scrappy
      if (funderId === 'self') {
        bonus.extraPatience += 2;  // Work harder to keep attention
      }
    }
    
    // === LOCATION EFFECTS ===
    if (this.location) {
      const locId = this.location.id;
      
      // London - biggest market, most enterprise buyers
      if (locId === 'london') {
        bonus.highValueBonus += 0.15;
        bonus.extraTime += 3;  // Major venue
      }
      
      // Manchester/Birmingham - strong enterprise presence
      if (['manchester', 'birmingham', 'leeds'].includes(locId)) {
        bonus.highValueBonus += 0.08;
      }
      
      // Academic cities - more researchers/students
      if (['oxford', 'cambridge', 'edinburgh'].includes(locId)) {
        bonus.interestBonus += 2;  // Curious visitors
      }
      
      // Regional - friendly but smaller
      if (['glasgow', 'cardiff', 'belfast', 'newcastle'].includes(locId)) {
        bonus.extraPatience += 3;  // More time per visitor
      }
    }
    
    return bonus;
  }
  
  startDemoDay() {
    // === HIDDEN BONUSES: Calculate based on founder/funder/location ===
    const hiddenBonus = this.calculateDemoDayHiddenBonus();
    
    // Initialize Demo Day state
    this.demoDay = {
      running: true,
      timeLeft: 60 + hiddenBonus.extraTime,
      conversions: 0,
      totalVisitors: 0,
      currentVisitor: null,
      resources: { 
        swag: 5 + hiddenBonus.extraSwag, 
        coffee: 6 + hiddenBonus.extraCoffee, 
        demo: 3 + hiddenBonus.extraDemo, 
        discount: 4, 
        custom: 3, 
        massive: 1 
      },
      resourcesUsed: { swag: 0, coffee: 0, demo: 0, discount: 0, custom: 0, massive: 0 },
      costs: { swag: 0, coffee: 0, demo: 25, discount: 20, custom: 40, massive: 80 },
      statBonuses: { demo: { dev: 1 }, custom: { dev: 1, sci: 1 } },
      totalCostsSpent: 0,
      totalConversionValue: 0,
      prestigeBonus: 0,
      earnedStats: { dev: 0, sci: 0, mkt: 0 },
      offersGiven: [],
      visitorPatience: 18 + hiddenBonus.extraPatience, // seconds per visitor
      interestBonus: hiddenBonus.interestBonus, // bonus to starting interest
      highValueBonus: hiddenBonus.highValueBonus // chance to get higher value visitors
    };
    
    this.demoDayVisitorTypes = [
      { type: "startup", emoji: "ğŸ‘¨â€ğŸ’»", title: "Startup Founder", interest: 45, value: 15, likes: ["swag", "coffee", "demo"], dislikes: [], engageQuote: "We just closed our seed round.", conversionBonus: { mkt: 1 } },
      { type: "enterprise", emoji: "ğŸ‘”", title: "Enterprise Buyer", interest: 15, value: 80, prestige: true, likes: ["custom", "discount", "demo", "massive"], dislikes: ["swag"], engageQuote: "I'm head of procurement for a Fortune 500.", conversionBonus: { mkt: 1 } },
      { type: "developer", emoji: "ğŸ‘©â€ğŸ’»", title: "Senior Developer", interest: 50, value: 20, likes: ["swag", "coffee", "demo"], dislikes: ["discount"], engageQuote: "Evaluating tools for our dev team of 50.", conversionBonus: { dev: 1 } },
      { type: "investor", emoji: "ğŸ’¼", title: "VC Associate", interest: 20, value: 60, prestige: true, likes: ["coffee", "demo"], dislikes: ["swag", "discount", "massive"], engageQuote: "We lead Series A rounds in enterprise SaaS.", conversionBonus: { mkt: 1 } },
      { type: "cto", emoji: "ğŸ§‘â€ğŸ’¼", title: "Scaleup CTO", interest: 20, value: 70, prestige: true, likes: ["custom", "discount", "coffee", "demo", "massive"], dislikes: [], engageQuote: "Looking to replace our vendor. Budget approved.", conversionBonus: { dev: 1 } },
      { type: "champion", emoji: "ğŸ™‹", title: "Internal Champion", interest: 45, value: 35, likes: ["discount", "coffee", "demo"], dislikes: [], engageQuote: "My team wants this - need to build the case.", conversionBonus: { mkt: 1 } },
      { type: "student", emoji: "ğŸ“", title: "CS Student", interest: 65, value: 5, likes: ["swag"], dislikes: ["custom", "discount", "massive"], engageQuote: "Doing a university project on AI tools.", conversionBonus: { sci: 1 } },
      { type: "researcher", emoji: "ğŸ”¬", title: "PhD Researcher", interest: 50, value: 5, likes: ["coffee", "demo"], dislikes: ["discount", "massive"], engageQuote: "I'm at Imperial, researching ML applications.", conversionBonus: { sci: 1 } },
      { type: "browser", emoji: "ğŸš¶", title: "Just Browsing", interest: 70, value: 0, likes: ["swag"], dislikes: ["custom", "discount", "coffee", "demo", "massive"], engageQuote: "Just walking the floor, killing time.", conversionBonus: null },
      { type: "competitor", emoji: "ğŸ•µï¸", title: "Competitor Scout", interest: 60, value: 0, likes: ["demo"], dislikes: ["custom", "discount", "massive"], engageQuote: "I work in... a similar space. Just curious.", conversionBonus: null },
      { type: "tire_kicker", emoji: "ğŸ¤”", title: "Tire Kicker", interest: 40, value: 0, likes: ["demo", "coffee"], dislikes: ["discount", "massive"], engageQuote: "We've been researching for 18 months. No rush.", conversionBonus: null },
      { type: "cheapskate", emoji: "ğŸ’¸", title: "Budget Hunter", interest: 20, value: 10, likes: ["discount", "massive"], dislikes: ["custom"], engageQuote: "We only buy if it's at least 50% off.", conversionBonus: null }
    ];
    
    const html = `
      <div class="fixed inset-0 bg-gradient-to-b from-slate-800 to-slate-900 flex flex-col z-50 p-4" id="demoDayModal">
        <div class="max-w-4xl mx-auto w-full flex-1 flex flex-col">
          <!-- Top Bar -->
          <div class="flex justify-between items-center mb-4">
            <div id="ddTimerBox" class="bg-slate-700 rounded-xl px-5 py-3 flex items-center gap-3">
              <span class="text-2xl">â±</span>
              <span id="ddTimer" class="text-4xl font-bold text-white font-mono">60</span>
            </div>
            <div class="bg-slate-700 rounded-xl px-5 py-3 text-center">
              <div class="text-slate-400 text-sm uppercase tracking-wide">Converted</div>
              <div class="flex items-center gap-2 justify-center">
                <span id="ddConversions" class="text-3xl font-bold text-amber-400">0</span>
                <span class="text-slate-500 text-xl">/</span>
                <span id="ddTotalVisitors" class="text-xl text-slate-400">0</span>
              </div>
            </div>
            <div class="bg-slate-700 rounded-xl px-5 py-3 text-center">
              <div class="text-slate-400 text-sm uppercase tracking-wide">Net Profit</div>
              <div id="ddNetProfit" class="text-3xl font-bold text-emerald-400">Â£0k</div>
            </div>
          </div>
          
          <!-- Resources Bar -->
          <div class="bg-slate-800 rounded-xl p-3 mb-4 flex justify-between items-center">
            <div class="flex gap-4 text-base">
              <span class="flex items-center gap-1">ğŸ<span id="ddSwag" class="text-emerald-400 font-bold">5</span></span>
              <span class="flex items-center gap-1">â˜•<span id="ddCoffee" class="text-purple-400 font-bold">6</span></span>
              <span class="flex items-center gap-1">ğŸ–¥<span id="ddDemo" class="text-cyan-400 font-bold">3</span></span>
              <span class="flex items-center gap-1">ğŸ’°<span id="ddDiscount" class="text-amber-400 font-bold">4</span></span>
              <span class="flex items-center gap-1">ğŸ”§<span id="ddCustom" class="text-blue-400 font-bold">3</span></span>
              <span class="flex items-center gap-1">â­<span id="ddMassive" class="text-rose-400 font-bold">1</span></span>
            </div>
            <div class="text-slate-400 text-sm">Costs: <span id="ddCosts" class="text-red-400 font-bold">Â£0k</span></div>
          </div>
          
          <!-- Booth -->
          <div class="bg-gradient-to-b from-blue-800 to-blue-900 rounded-xl p-4 mb-4 border-2 border-blue-500">
            <div class="flex items-center gap-4 text-white">
              <span class="text-4xl">ğŸš€</span>
              <div>
                <div class="font-bold text-xl">${this.company?.name || 'YOUR STARTUP'}</div>
                <div class="text-blue-300 text-sm">${this.company?.subtitle || 'AI-Powered Innovation'}</div>
              </div>
            </div>
          </div>
          
          <!-- Visitor Zone -->
          <div id="ddVisitorZone" class="flex-1 relative">
            <div class="text-center py-16 text-slate-500">
              <div class="text-6xl mb-3">ğŸ‘€</div>
              <div class="text-lg">Waiting for visitors...</div>
            </div>
          </div>
          
          <!-- Floating text -->
          <div id="ddFloatingText" class="absolute inset-0 pointer-events-none overflow-hidden"></div>
        </div>
      </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', html);
    
    // Start game loop
    this.demoDayLoop();
    setTimeout(() => this.demoDaySpawnVisitor(), 500);
  }
  
  demoDayLoop() {
    if (!this.demoDay?.running) return;
    
    this.demoDay.timeLeft -= 0.1;
    const t = this.demoDay.timeLeft;
    
    document.getElementById('ddTimer').textContent = Math.ceil(t);
    
    const timerBox = document.getElementById('ddTimerBox');
    if (t <= 10) timerBox.className = "bg-red-600 rounded-xl px-4 py-2 flex items-center gap-2";
    else if (t <= 20) timerBox.className = "bg-amber-600 rounded-xl px-4 py-2 flex items-center gap-2";
    
    if (t <= 0) {
      this.demoDayEnd();
      return;
    }
    
    setTimeout(() => this.demoDayLoop(), 100);
  }
  
  demoDaySpawnVisitor() {
    if (!this.demoDay?.running || this.demoDay.currentVisitor) return;
    
    // === HIDDEN: Apply high-value bonus to visitor selection ===
    let vType;
    const highValueBonus = this.demoDay.highValueBonus || 0;
    
    if (highValueBonus > 0 && Math.random() < highValueBonus) {
      // Bias toward high-value visitors (enterprise, CTO, investor, champion)
      const highValueTypes = this.demoDayVisitorTypes.filter(v => v.value >= 35);
      vType = highValueTypes[Math.floor(Math.random() * highValueTypes.length)];
    } else {
      vType = this.demoDayVisitorTypes[Math.floor(Math.random() * this.demoDayVisitorTypes.length)];
    }
    
    const patience = this.demoDay.visitorPatience || 18;
    
    // === HIDDEN: Apply interest bonus from founder/funder ===
    const interestBonus = this.demoDay.interestBonus || 0;
    const startingInterest = Math.min(75, Math.max(5, vType.interest + interestBonus));
    
    this.demoDay.currentVisitor = { ...vType, currentInterest: startingInterest, timeLeft: patience, maxTime: patience, qualified: false };
    this.demoDay.totalVisitors++;
    this.demoDay.offersGiven = [];
    
    document.getElementById('ddTotalVisitors').textContent = this.demoDay.totalVisitors;
    this.demoDayRenderVisitor();
    this.demoDayVisitorCountdown();
  }
  
  demoDayVisitorCountdown() {
    if (!this.demoDay?.running || !this.demoDay.currentVisitor) return;
    
    this.demoDay.currentVisitor.timeLeft -= 0.1;
    const maxTime = this.demoDay.currentVisitor.maxTime || 15;
    const pct = (this.demoDay.currentVisitor.timeLeft / maxTime) * 100;
    
    const bar = document.getElementById('ddPatienceBar');
    if (bar) {
      bar.style.width = `${pct}%`;
      bar.className = `h-full rounded-full transition-all ${pct > 50 ? 'bg-emerald-500' : pct > 25 ? 'bg-amber-500' : 'bg-red-500'}`;
    }
    
    if (this.demoDay.currentVisitor.timeLeft <= 0) {
      this.demoDayVisitorLeaves(false);
      return;
    }
    
    setTimeout(() => this.demoDayVisitorCountdown(), 100);
  }
  
  demoDayRenderVisitor() {
    const zone = document.getElementById('ddVisitorZone');
    const v = this.demoDay.currentVisitor;
    const dd = this.demoDay;
    
    if (!v) {
      zone.innerHTML = `<div class="text-center py-12 text-slate-500"><div class="text-4xl mb-2">ğŸ‘€</div><div>Waiting for visitors...</div></div>`;
      return;
    }
    
    if (!v.qualified) {
      // Generate visual hints based on visitor type
      const hints = this.getDemoDayVisitorHints(v);
      
      zone.innerHTML = `
        <div class="bg-slate-800 rounded-xl p-5 border-2 border-slate-600">
          <div class="flex items-start gap-4 mb-4">
            <div class="text-6xl">${v.emoji}</div>
            <div class="flex-1">
              <h3 class="text-white font-bold text-xl mb-1">Someone approaches...</h3>
              <p class="text-slate-400 text-base italic">"Hi, interested in your product."</p>
              
              <!-- Visual hints -->
              <div class="mt-3 bg-slate-700/50 rounded-lg p-3">
                <div class="text-xs text-slate-500 uppercase tracking-wide mb-2">First Impressions</div>
                <div class="flex flex-wrap gap-2">
                  ${hints.map(h => `<span class="px-2 py-1 rounded-full text-sm ${h.color}">${h.icon} ${h.text}</span>`).join('')}
                </div>
              </div>
              
              <div class="h-2 bg-slate-700 rounded-full mt-3 overflow-hidden">
                <div id="ddPatienceBar" class="h-full bg-emerald-500 rounded-full" style="width:100%"></div>
              </div>
            </div>
            <div class="text-right">
              <div class="text-slate-500 text-2xl mb-1">???</div>
              <div class="text-xs text-slate-500">Value unknown</div>
            </div>
          </div>
          <div class="flex gap-3">
            <button onclick="game.demoDayEngage()" class="flex-1 py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg text-lg">Engage (-2s)</button>
            <button onclick="game.demoDaySkip()" class="flex-1 py-3 bg-slate-600 hover:bg-slate-500 text-white font-bold rounded-lg text-lg">Skip</button>
          </div>
        </div>`;
      return;
    }
    
    const getEff = (t) => {
      const e = { swag: [25,10], coffee: [20,10], demo: [30,18], discount: [30,15], custom: [35,15], massive: [50,25] };
      if (v.likes.includes(t)) return `+${e[t][0]}%`;
      if (v.dislikes.includes(t)) return `-10%`;
      return `+${e[t][1]}%`;
    };
    const effColor = (t) => v.likes.includes(t) ? 'text-emerald-400' : v.dislikes.includes(t) ? 'text-red-400' : 'text-slate-400';
    const valColor = v.value >= 50 ? 'text-emerald-400' : v.value >= 20 ? 'text-amber-400' : v.value > 0 ? 'text-slate-400' : 'text-red-400';
    const warn = v.value === 0 && !v.conversionBonus ? '<span class="text-red-400 text-sm">âš  Time-waster!</span>' : v.conversionBonus ? `<span class="text-cyan-400 text-sm">+1 ${Object.keys(v.conversionBonus)[0]}</span>` : '';
    
    // Determine if convert is possible
    const canConvert = v.currentInterest >= 75;
    
    zone.innerHTML = `
      <div class="bg-slate-800 rounded-xl p-4 border-2 ${v.value === 0 ? 'border-red-800' : 'border-slate-600'}">
        <!-- Header row with visitor info -->
        <div class="flex items-center gap-3 mb-2">
          <div class="text-5xl">${v.emoji}</div>
          <div class="flex-1 min-w-0">
            <div class="flex justify-between items-center">
              <h3 class="text-white font-bold text-lg">${v.title}</h3>
              <div class="flex items-center gap-2">
                <span class="${valColor} font-bold text-xl">Â£${v.value}k</span>
                ${v.prestige ? '<span class="text-amber-400">â­</span>' : ''}
              </div>
            </div>
            <p class="text-slate-400 text-sm italic truncate">"${v.engageQuote}"</p>
          </div>
          ${warn ? `<div>${warn}</div>` : ''}
        </div>
        
        <!-- Interest bar and Convert button side by side -->
        <div class="flex gap-3 mb-3">
          <div class="flex-1 bg-slate-900 rounded-lg p-2">
            <div class="flex justify-between text-xs mb-1">
              <span class="text-slate-500">Interest</span>
              <span id="ddInterest" class="text-white font-bold">${v.currentInterest}%</span>
            </div>
            <div class="h-3 bg-slate-700 rounded-full overflow-hidden relative">
              <div id="ddInterestBar" class="h-full bg-blue-500 transition-all" style="width:${v.currentInterest}%"></div>
              <div class="absolute top-0 bottom-0 w-1 bg-emerald-400" style="left:75%"></div>
            </div>
            <!-- Patience bar below -->
            <div class="h-1.5 bg-slate-700 rounded-full mt-2 overflow-hidden">
              <div id="ddPatienceBar" class="h-full bg-emerald-500 rounded-full" style="width:100%"></div>
            </div>
          </div>
          
          <!-- Convert button - prominent on right -->
          <button onclick="game.demoDayConvert()" id="ddConvertBtn" class="w-32 ${canConvert ? 'bg-gradient-to-r from-emerald-500 to-green-400 hover:from-emerald-400 hover:to-green-300' : 'bg-slate-700 cursor-not-allowed'} text-white font-bold rounded-xl text-sm transition-all flex flex-col items-center justify-center" ${canConvert ? '' : 'disabled'}>
            ${canConvert ? `<span class="text-2xl">âœ…</span><span>CONVERT</span><span class="text-xs">Â£${v.value}k</span>` : `<span class="text-lg">ğŸ”’</span><span class="text-xs">Need ${75 - v.currentInterest}%</span>`}
          </button>
        </div>
        
        <!-- Offer buttons - compact 1 row of 6 -->
        <div class="grid grid-cols-6 gap-1 mb-2">
          <button onclick="game.demoDayOffer('swag')" ${dd.resources.swag <= 0 || dd.offersGiven.includes('swag') ? 'disabled' : ''} class="p-2 bg-emerald-700 hover:bg-emerald-600 disabled:bg-slate-700 disabled:opacity-50 rounded text-white text-xs font-medium text-center">ğŸ<br><span class="${effColor('swag')}">${getEff('swag')}</span></button>
          <button onclick="game.demoDayOffer('coffee')" ${dd.resources.coffee <= 0 || dd.offersGiven.includes('coffee') ? 'disabled' : ''} class="p-2 bg-purple-700 hover:bg-purple-600 disabled:bg-slate-700 disabled:opacity-50 rounded text-white text-xs font-medium text-center">â˜•<br><span class="${effColor('coffee')}">${getEff('coffee')}</span></button>
          <button onclick="game.demoDayOffer('demo')" ${dd.resources.demo <= 0 || dd.offersGiven.includes('demo') ? 'disabled' : ''} class="p-2 bg-cyan-700 hover:bg-cyan-600 disabled:bg-slate-700 disabled:opacity-50 rounded text-white text-xs font-medium text-center">ğŸ–¥<br><span class="${effColor('demo')}">${getEff('demo')}</span></button>
          <button onclick="game.demoDayOffer('discount')" ${dd.resources.discount <= 0 || dd.offersGiven.includes('discount') ? 'disabled' : ''} class="p-2 bg-amber-700 hover:bg-amber-600 disabled:bg-slate-700 disabled:opacity-50 rounded text-white text-xs font-medium text-center">ğŸ’°<br><span class="${effColor('discount')}">${getEff('discount')}</span></button>
          <button onclick="game.demoDayOffer('custom')" ${dd.resources.custom <= 0 || dd.offersGiven.includes('custom') ? 'disabled' : ''} class="p-2 bg-blue-700 hover:bg-blue-600 disabled:bg-slate-700 disabled:opacity-50 rounded text-white text-xs font-medium text-center">ğŸ”§<br><span class="${effColor('custom')}">${getEff('custom')}</span></button>
          <button onclick="game.demoDayOffer('massive')" ${dd.resources.massive <= 0 || dd.offersGiven.includes('massive') ? 'disabled' : ''} class="p-2 bg-rose-700 hover:bg-rose-600 disabled:bg-slate-700 disabled:opacity-50 rounded text-white text-xs font-medium text-center border border-rose-500">â­<br><span class="${effColor('massive')}">${getEff('massive')}</span></button>
        </div>
        
        <!-- Bottom actions -->
        <div class="flex gap-2">
          <button onclick="game.demoDayChat()" class="flex-1 py-2 bg-slate-600 hover:bg-slate-500 text-white font-bold rounded-lg text-sm">Chat (+5%)</button>
          <button onclick="game.demoDaySkip()" class="flex-1 py-2 bg-red-800 hover:bg-red-700 text-white font-bold rounded-lg text-sm">Skip</button>
        </div>
      </div>`;
  }
  
  // Generate hints about visitor before engaging
  getDemoDayVisitorHints(v) {
    const hints = [];
    
    const attireHints = {
      startup: [
        { icon: "ğŸ‘•", text: "Casual hoodie", color: "bg-slate-600 text-slate-300" },
        { icon: "ğŸ’»", text: "Laptop bag", color: "bg-slate-600 text-slate-300" }
      ],
      enterprise: [
        { icon: "ğŸ‘”", text: "Expensive suit", color: "bg-emerald-900 text-emerald-300" },
        { icon: "ğŸ’¼", text: "Leather briefcase", color: "bg-emerald-900 text-emerald-300" }
      ],
      developer: [
        { icon: "ğŸ§", text: "Headphones around neck", color: "bg-blue-900 text-blue-300" },
        { icon: "â˜•", text: "Coffee in hand", color: "bg-slate-600 text-slate-300" }
      ],
      investor: [
        { icon: "âŒš", text: "Expensive watch", color: "bg-emerald-900 text-emerald-300" },
        { icon: "ğŸ“±", text: "Two phones", color: "bg-amber-900 text-amber-300" }
      ],
      cto: [
        { icon: "ğŸ‘”", text: "Smart casual", color: "bg-emerald-900 text-emerald-300" },
        { icon: "ğŸ¯", text: "Purposeful stride", color: "bg-emerald-900 text-emerald-300" }
      ],
      champion: [
        { icon: "ğŸ“‹", text: "Taking notes", color: "bg-blue-900 text-blue-300" },
        { icon: "ğŸ¢", text: "Company lanyard", color: "bg-slate-600 text-slate-300" }
      ],
      student: [
        { icon: "ğŸ’", text: "Backpack", color: "bg-amber-900 text-amber-300" },
        { icon: "ğŸ“š", text: "Young, eager", color: "bg-amber-900 text-amber-300" }
      ],
      researcher: [
        { icon: "ğŸ”¬", text: "Conference badge", color: "bg-purple-900 text-purple-300" },
        { icon: "ğŸ“", text: "Notebook", color: "bg-slate-600 text-slate-300" }
      ],
      browser: [
        { icon: "ğŸš¶", text: "Wandering slowly", color: "bg-red-900 text-red-300" },
        { icon: "ğŸ‘€", text: "Looking around", color: "bg-red-900 text-red-300" }
      ],
      competitor: [
        { icon: "ğŸ•µ", text: "Avoiding eye contact", color: "bg-red-900 text-red-300" },
        { icon: "ğŸ“·", text: "Taking photos", color: "bg-red-900 text-red-300" }
      ],
      tire_kicker: [
        { icon: "ğŸ¤”", text: "Arms crossed", color: "bg-amber-900 text-amber-300" },
        { icon: "â°", text: "Checking watch often", color: "bg-red-900 text-red-300" }
      ],
      cheapskate: [
        { icon: "ğŸ’¸", text: "Asks about pricing first", color: "bg-amber-900 text-amber-300" },
        { icon: "ğŸ›", text: "Collecting free stuff", color: "bg-red-900 text-red-300" }
      ]
    };
    
    if (attireHints[v.type]) {
      hints.push(...attireHints[v.type]);
    }
    
    if (v.value >= 50) {
      hints.push({ icon: "ğŸ’", text: "Looks important", color: "bg-emerald-900 text-emerald-300" });
    } else if (v.value === 0) {
      hints.push({ icon: "âš ", text: "Seems distracted", color: "bg-red-900 text-red-300" });
    }
    
    return hints;
  }
  
  demoDayEngage() {
    if (!this.demoDay?.currentVisitor) return;
    this.demoDay.timeLeft -= 2;
    this.demoDay.currentVisitor.qualified = true;
    this.demoDayFloat("ğŸ” Qualified!", "blue");
    this.demoDayRenderVisitor();
  }
  
  demoDayOffer(type) {
    const dd = this.demoDay;
    const v = dd.currentVisitor;
    if (!v || dd.resources[type] <= 0 || dd.offersGiven.includes(type)) return;
    
    if (!v.qualified) { v.qualified = true; }
    
    const effects = { swag: [25,10], coffee: [20,10], demo: [30,18], discount: [30,15], custom: [35,15], massive: [50,25] };
    let eff = effects[type][1];
    if (v.likes.includes(type)) eff = effects[type][0];
    else if (v.dislikes.includes(type)) eff = -10;
    
    v.currentInterest = Math.max(0, Math.min(100, v.currentInterest + eff));
    dd.resources[type]--;
    dd.resourcesUsed[type]++;
    dd.offersGiven.push(type);
    dd.totalCostsSpent += dd.costs[type];
    
    // Stat bonuses from demo/custom
    if (dd.statBonuses[type]) {
      Object.entries(dd.statBonuses[type]).forEach(([k, val]) => dd.earnedStats[k] += val);
      this.demoDayFloat(`+1 ${Object.keys(dd.statBonuses[type])[0]}`, "cyan");
    }
    
    this.demoDayFloat(`${eff >= 0 ? '+' : ''}${eff}%`, eff >= 0 ? "emerald" : "red");
    if (dd.costs[type] > 0) this.demoDayFloat(`-Â£${dd.costs[type]}k`, "red");
    
    this.demoDayUpdateUI();
    this.demoDayRenderVisitor();
  }
  
  demoDayChat() {
    if (!this.demoDay?.currentVisitor) return;
    this.demoDay.timeLeft -= 3;
    this.demoDay.currentVisitor.currentInterest = Math.min(100, this.demoDay.currentVisitor.currentInterest + 5);
    this.demoDayFloat("+5%", "slate");
    this.demoDayFloat("-3s", "red");
    this.demoDayRenderVisitor();
  }
  
  demoDayConvert() {
    const dd = this.demoDay;
    const v = dd.currentVisitor;
    if (!v || v.currentInterest < 75) return;
    
    dd.totalConversionValue += v.value;
    dd.conversions++;
    
    // Conversion bonus
    if (v.conversionBonus) {
      Object.entries(v.conversionBonus).forEach(([k, val]) => dd.earnedStats[k] += val);
    }
    
    // Prestige bonus
    if (dd.offersGiven.includes('massive') && v.prestige) {
      dd.prestigeBonus = 25;
      dd.earnedStats.mkt += 1;
      this.demoDayFloat(`+Â£${v.value}k +â­PRESTIGE!`, "amber");
    } else if (v.value > 0) {
      this.demoDayFloat(`+Â£${v.value}k!`, "emerald");
    } else if (v.conversionBonus) {
      this.demoDayFloat(`+1 ${Object.keys(v.conversionBonus)[0]}!`, "cyan");
    }
    
    this.demoDayUpdateUI();
    this.demoDayVisitorLeaves(true);
  }
  
  demoDaySkip() {
    this.demoDayVisitorLeaves(false);
  }
  
  demoDayVisitorLeaves(converted) {
    this.demoDay.currentVisitor = null;
    if (this.demoDay.running && this.demoDay.timeLeft > 2) {
      setTimeout(() => this.demoDaySpawnVisitor(), 600);
    }
    this.demoDayRenderVisitor();
  }
  
  demoDayUpdateUI() {
    const dd = this.demoDay;
    document.getElementById('ddConversions').textContent = dd.conversions;
    document.getElementById('ddSwag').textContent = dd.resources.swag;
    document.getElementById('ddCoffee').textContent = dd.resources.coffee;
    document.getElementById('ddDemo').textContent = dd.resources.demo;
    document.getElementById('ddDiscount').textContent = dd.resources.discount;
    document.getElementById('ddCustom').textContent = dd.resources.custom;
    document.getElementById('ddMassive').textContent = dd.resources.massive;
    document.getElementById('ddCosts').textContent = `Â£${dd.totalCostsSpent}k`;
    
    const net = dd.totalConversionValue - dd.totalCostsSpent + dd.prestigeBonus;
    const netEl = document.getElementById('ddNetProfit');
    netEl.textContent = net >= 0 ? `Â£${net}k` : `-Â£${Math.abs(net)}k`;
    netEl.className = `text-2xl font-bold ${net >= 0 ? 'text-emerald-400' : 'text-red-400'}`;
  }
  
  demoDayFloat(text, color) {
    const container = document.getElementById('ddFloatingText');
    if (!container) return;
    const el = document.createElement('div');
    el.className = `absolute left-1/2 top-1/2 -translate-x-1/2 text-${color}-400 font-bold text-xl`;
    el.style.animation = 'float-up 0.8s ease-out forwards';
    el.textContent = text;
    container.appendChild(el);
    setTimeout(() => el.remove(), 800);
  }
  
  demoDayEnd() {
    this.demoDay.running = false;
    const dd = this.demoDay;
    const net = dd.totalConversionValue - dd.totalCostsSpent + dd.prestigeBonus;
    
    // Calculate AP penalty for overusing premium offers (demo + custom)
    const premiumUsed = dd.resourcesUsed.demo + dd.resourcesUsed.custom;
    let apPenalty = 0;
    if (premiumUsed >= 6) apPenalty = 2;
    else if (premiumUsed > 4) apPenalty = 1;
    
    // Apply AP penalty
    if (apPenalty > 0) {
      this.ap = Math.max(0, this.ap - apPenalty);
    }
    
    let emoji, title, baseBonus;
    if (net >= 60) { emoji = "ğŸŒŸ"; title = "Excellent ROI!"; baseBonus = { dev: 1, sci: 0, mkt: 1, val: 40 }; }
    else if (net >= 30) { emoji = "ğŸ‰"; title = "Profitable Day!"; baseBonus = { dev: 0, sci: 0, mkt: 1, val: 25 }; }
    else if (net >= 0) { emoji = "ğŸ‘"; title = "Break Even"; baseBonus = { dev: 0, sci: 0, mkt: 0, val: 10 }; }
    else if (net >= -40) { emoji = "ğŸ˜"; title = "Small Loss"; baseBonus = { dev: 0, sci: 0, mkt: 0, val: 0 }; }
    else { emoji = "ğŸ˜¬"; title = "Tough Day"; baseBonus = { dev: 0, sci: 0, mkt: 0, val: 0 }; }
    
    const total = {
      dev: baseBonus.dev + dd.earnedStats.dev,
      sci: baseBonus.sci + dd.earnedStats.sci,
      mkt: baseBonus.mkt + dd.earnedStats.mkt,
      val: baseBonus.val + Math.max(0, net)
    };
    
    // Apply to game
    this.metrics.dev += total.dev;
    this.metrics.sci += total.sci;
    this.metrics.mkt += total.mkt;
    this.metrics.val += total.val;
    
    // === REVENUE SYSTEM: Convert high-value Demo Day conversions to pipeline/customers ===
    const revenueResults = this.applyDemoDayRevenueBonus(dd);
    
    const apPenaltyHtml = apPenalty > 0 ? `
      <div class="bg-red-100 border border-red-300 rounded-xl p-3 mb-4 text-sm">
        <div class="text-red-700 font-bold">âš  Follow-up Overload: -${apPenalty} AP</div>
        <div class="text-red-600 text-xs">Used ${premiumUsed} premium offers (Demo/Custom) - too many to follow up!</div>
      </div>` : '';
    
    // Revenue results html
    const revenueHtml = revenueResults.added > 0 ? `
      <div class="bg-emerald-50 border border-emerald-300 rounded-xl p-3 mb-4 text-sm">
        <div class="text-emerald-700 font-bold">ğŸ“Š Sales Pipeline Updated</div>
        <div class="text-emerald-600 text-xs">${revenueResults.message}</div>
      </div>` : '';
    
    // Generate debrief insights
    const debriefInsights = this.generateDemoDayDebrief();
    const debriefHtml = `
      <div class="bg-amber-50 rounded-xl p-3 mb-4 text-left border border-amber-200">
        <div class="flex items-center gap-2 mb-2">
          <span class="text-lg">ğŸ’¡</span>
          <span class="font-bold text-amber-800 text-sm">Debrief Insights</span>
        </div>
        <ul class="text-sm text-amber-700 space-y-1">
          ${debriefInsights.map(i => `<li>â€¢ ${i}</li>`).join('')}
        </ul>
      </div>`;
    
    const zone = document.getElementById('ddVisitorZone');
    zone.innerHTML = `
      <div class="bg-white rounded-2xl p-6 text-center max-w-md mx-auto">
        <div class="text-5xl mb-3">${emoji}</div>
        <h2 class="text-2xl font-bold text-slate-800 mb-2">${title}</h2>
        <div class="flex justify-center gap-6 mb-4">
          <div><div class="text-3xl font-bold ${net >= 0 ? 'text-emerald-600' : 'text-red-600'}">${net >= 0 ? 'Â£' : '-Â£'}${Math.abs(net)}k</div><div class="text-xs text-slate-500">Net Profit</div></div>
          <div><div class="text-3xl font-bold text-amber-600">${dd.conversions}</div><div class="text-xs text-slate-500">Converted</div></div>
        </div>
        ${apPenaltyHtml}
        ${revenueHtml}
        <div class="bg-slate-100 rounded-xl p-3 mb-4 text-sm">
          <div class="text-slate-600 mb-2">Demo Day Rewards:</div>
          <div class="flex justify-center gap-3">
            ${total.dev > 0 ? `<span class="text-cyan-600 font-bold">+${total.dev} Dev</span>` : ''}
            ${total.sci > 0 ? `<span class="text-blue-600 font-bold">+${total.sci} Sci</span>` : ''}
            ${total.mkt > 0 ? `<span class="text-fuchsia-600 font-bold">+${total.mkt} Mkt</span>` : ''}
            ${total.val > 0 ? `<span class="text-emerald-600 font-bold">+Â£${total.val}k Val</span>` : ''}
            ${total.dev + total.sci + total.mkt + total.val === 0 ? '<span class="text-slate-500">No bonus</span>' : ''}
          </div>
        </div>
        ${debriefHtml}
        <button onclick="game.closeDemoDay()" class="px-6 py-3 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-xl">Continue â†’</button>
      </div>`;
    
    this.log(`ğŸª Demo Day: ${title} - Net Â£${net}k, ${dd.conversions} converted${apPenalty > 0 ? `, -${apPenalty} AP (premium overuse)` : ''}${revenueResults.added > 0 ? `, ${revenueResults.added} leads added` : ''}`);
  }
  
  // === DEMO DAY REVENUE BONUS ===
  // Convert high-value conversions into actual pipeline deals or customers
  applyDemoDayRevenueBonus(dd) {
    if (!this.revenueModel) return { added: 0, message: '' };
    
    const conversions = dd.conversions || 0;
    const totalValue = dd.totalConversionValue || 0;
    const hadPrestige = dd.prestigeBonus > 0;
    
    let pipelineDeals = 0;
    let directCustomers = 0;
    let message = '';
    
    // Calculate hidden bonus from founder/funder
    let conversionBonus = 0;
    if (this.founderBonuses?.commercial > 3) conversionBonus += 0.1;
    if (this.funder?.id === 'dragon') conversionBonus += 0.1;  // Media presence helps at events
    if (this.funder?.id === 'corporate') conversionBonus += 0.15;  // Corporate brings credibility
    
    // High-value day (Â£60k+ net) = strong pipeline
    if (totalValue >= 80) {
      // Excellent performance - add to pipeline
      const deals = Math.min(3, Math.floor(conversions / 3));
      for (let i = 0; i < deals; i++) {
        const dealValue = this.revenueModel.metrics.avgRevenuePerCustomer * (0.8 + Math.random() * 0.4);
        this.pipeline.push({
          value: Math.round(dealValue),
          closeIn: 2 + Math.floor(Math.random() * 2),
          addedQuarter: this.turn,
          name: `Demo Day Lead ${i + 1}`,
          probability: 0.4 + conversionBonus
        });
        pipelineDeals++;
      }
      message = `${pipelineDeals} qualified leads added to pipeline`;
    } 
    // Good day (Â£40-79k) = some pipeline
    else if (totalValue >= 40) {
      const deals = Math.min(2, Math.floor(conversions / 4));
      for (let i = 0; i < deals; i++) {
        const dealValue = this.revenueModel.metrics.avgRevenuePerCustomer * (0.6 + Math.random() * 0.4);
        this.pipeline.push({
          value: Math.round(dealValue),
          closeIn: 2 + Math.floor(Math.random() * 3),
          addedQuarter: this.turn,
          name: `Demo Day Lead`,
          probability: 0.3 + conversionBonus
        });
        pipelineDeals++;
      }
      message = `${pipelineDeals} lead(s) added to pipeline`;
    }
    // Prestige bonus - enterprise/CTO conversion
    else if (hadPrestige && conversions >= 2) {
      this.pipeline.push({
        value: Math.round(this.revenueModel.metrics.avgRevenuePerCustomer * 1.2),
        closeIn: 3,
        addedQuarter: this.turn,
        name: 'Enterprise Lead (Demo Day)',
        probability: 0.35 + conversionBonus,
        strategic: true
      });
      pipelineDeals++;
      message = `1 enterprise lead added (prestige conversion)`;
    }
    
    // Exceptional performance (10+ conversions, Â£100k+ value) = direct customer
    if (conversions >= 10 && totalValue >= 100 && Math.random() < 0.3 + conversionBonus) {
      this.addCustomer({
        revenue: Math.round(this.revenueModel.metrics.avgRevenuePerCustomer * 0.7),
        supportCost: this.revenueModel.metrics.supportCostPerCustomer,
        name: 'Demo Day Direct Sign',
        satisfaction: 0.8
      });
      directCustomers++;
      message = `1 customer signed directly! ${pipelineDeals > 0 ? `Plus ${pipelineDeals} pipeline leads` : ''}`;
    }
    
    return { 
      added: pipelineDeals + directCustomers, 
      message,
      pipelineDeals,
      directCustomers
    };
  }
  
  // === DEMO DAY DEBRIEF GENERATION ===
  generateDemoDayDebrief() {
    const insights = [];
    const dd = this.demoDay;
    const used = dd.resourcesUsed || {};
    const conversions = dd.conversions || 0;
    const totalVisitors = dd.totalVisitors || 0;
    const totalSpent = dd.totalCostsSpent || 0;
    const net = dd.totalConversionValue - totalSpent + (dd.prestigeBonus || 0);
    
    // Calculate usage patterns
    const swagUsed = used.swag || 0;
    const coffeeUsed = used.coffee || 0;
    const demoUsed = used.demo || 0;
    const discountUsed = used.discount || 0;
    const customUsed = used.custom || 0;
    const massiveUsed = used.massive || 0;
    
    const freeUsed = swagUsed + coffeeUsed;
    const premiumUsed = demoUsed + customUsed;
    const totalOffers = freeUsed + premiumUsed + discountUsed + massiveUsed;
    
    // Insight: Free vs Premium balance
    if (freeUsed > 0 && premiumUsed === 0 && conversions < 3) {
      insights.push(`Only free offers used (swag/coffee). Demos and custom solutions convert high-value visitors.`);
    } else if (premiumUsed > 4) {
      insights.push(`Heavy premium offer use (${premiumUsed}x). Watch for AP penalty from follow-up overload!`);
    }
    
    // Insight: Conversion rate
    if (totalVisitors > 0) {
      const conversionRate = Math.round((conversions / totalVisitors) * 100);
      if (conversionRate < 20) {
        insights.push(`${conversionRate}% conversion rate. Try matching offers to visitor preferencesâ€”check their likes/dislikes.`);
      } else if (conversionRate > 60) {
        insights.push(`Impressive ${conversionRate}% conversion rate! You read visitor signals well.`);
      }
    }
    
    // Insight: Massive discount
    if (massiveUsed > 0 && dd.prestigeBonus > 0) {
      insights.push(`Massive discount secured a prestige client! High-value but use sparingly.`);
    } else if (massiveUsed > 0 && dd.prestigeBonus === 0) {
      insights.push(`Massive discount used on non-prestige visitor. Save it for enterprise/VC types.`);
    }
    
    // Insight: ROI analysis
    if (totalSpent > 0 && conversions > 0) {
      const costPerConversion = Math.round(totalSpent / conversions);
      if (costPerConversion > 30) {
        insights.push(`Â£${costPerConversion}k cost per conversion. Free offers (swag/coffee) can qualify visitors first.`);
      }
    } else if (totalSpent === 0 && conversions > 0) {
      insights.push(`Conversions with zero spend! Free offers work for low-value leads.`);
    }
    
    // Insight: Discount effectiveness
    if (discountUsed > 3 && net < 20) {
      insights.push(`Heavy discounting (${discountUsed}x) hurt margins. Discounts work best on "Budget Hunter" types.`);
    }
    
    // Insight: Visitor skipping
    if (totalVisitors > conversions + 2 && totalOffers < totalVisitors) {
      insights.push(`Some visitors left without offers. Even a "no fit" chat costs less than missed opportunities.`);
    }
    
    // Fallback
    if (insights.length === 0) {
      if (net >= 30) {
        insights.push(`Strong Demo Day! Good balance of engagement and conversion tactics.`);
      } else {
        insights.push(`Match offers to visitor types: swag for students, demos for CTOs, discounts for budget hunters.`);
      }
    }
    
    return insights.slice(0, 3); // Max 3 insights
  }
  
  closeDemoDay() {
    document.getElementById('demoDayModal')?.remove();
    this.demoDay = null;
    this.update();
    this.renderBoardroom();
  }


  startPitch() {
    // Initialize pitch state
    this.pitch = {
      active: true,
      timeLeft: 30, // 30 seconds
      totalTime: 30,
      points: 12, // Attention points for the pitch
      attention: 40, // Start at 40% attention (grumpy investors)
      peakAttention: 40,
      attentionHistory: [40], // For worm chart
      actionsUsed: [],
      demoUsed: false,
      jokeSuccess: 0,
      jokeFail: 0,
      tickCount: 0
    };
    
    // Investor data based on company type
    const investorSets = {
      aether: [
        { name: "Dr. Sarah Chen", title: "Lead Partner, HealthTech VC", face: "ğŸ‘©âš•" },
        { name: "Marcus Webb", title: "GP, BioFund", face: "ğŸ‘¨ğŸ’¼" },
        { name: "Priya Patel", title: "Angel Investor", face: "ğŸ‘©ğŸ’¼" },
        { name: "James Liu", title: "Venture Partner", face: "ğŸ§‘ğŸ’¼" }
      ],
      vanguard: [
        { name: "James Morrison", title: "Industrial VC", face: "ğŸ‘¨ğŸ’¼" },
        { name: "Elena Schmidt", title: "Robotics Fund GP", face: "ğŸ‘©ğŸ’¼" },
        { name: "Raj Krishnan", title: "Angel Investor", face: "ğŸ§‘ğŸ’¼" },
        { name: "Tom Bradley", title: "Venture Partner", face: "ğŸ‘¨ğŸ’»" }
      ],
      quantflow: [
        { name: "William Thorne", title: "FinTech Capital", face: "ğŸ‘¨ğŸ’¼" },
        { name: "Yuki Tanaka", title: "Quant Fund GP", face: "ğŸ‘©ğŸ’»" },
        { name: "David Morrison", title: "Angel Investor", face: "ğŸ§‘ğŸ’¼" },
        { name: "Lisa Park", title: "Venture Partner", face: "ğŸ‘©ğŸ’¼" }
      ],
      dreamscape: [
        { name: "Alex Rivera", title: "Creative Fund GP", face: "ğŸ§‘ğŸ¨" },
        { name: "Sophie Laurent", title: "Media VC", face: "ğŸ‘©ğŸ’¼" },
        { name: "Chris Park", title: "Angel Investor", face: "ğŸ‘¨ğŸ’¼" },
        { name: "Maya Johnson", title: "Venture Partner", face: "ğŸ‘©ğŸ’»" }
      ]
    };
    
    const investors = investorSets[this.company?.id] || investorSets.aether;
    
    // Update UI
    document.getElementById("pitchVenueName").textContent = `Series A Pitch â€¢ ${this.company?.name || "Your Startup"}`;
    document.getElementById("pitchTimer").textContent = "0:30";
    document.getElementById("pitchTimerSmall").textContent = "0:30";
    document.getElementById("pitchPoints").textContent = "12";
    document.getElementById("pitchAttentionValue").textContent = "40%";
    document.getElementById("pitchActionLog").textContent = "The investors look skeptical...";
    document.getElementById("pitchInvestorMood").textContent = "Skeptical";
    document.getElementById("pitchSpeechText").textContent = '"Thank you for having me today..."';
    
    // Update investor panel - start grumpy
    investors.forEach((inv, i) => {
      const nameEl = document.getElementById(`investor-name-${i}`);
      const titleEl = document.getElementById(`investor-title-${i}`);
      const faceEl = document.querySelector(`#investor-${i} .investor-face`);
      const reactionEl = document.getElementById(`investor-reaction-${i}`);
      
      if (nameEl) nameEl.textContent = inv.name;
      if (titleEl) titleEl.textContent = inv.title;
      if (faceEl) faceEl.textContent = inv.face;
      if (reactionEl) {
        reactionEl.textContent = "ğŸ˜ Waiting...";
        reactionEl.className = "mt-1 px-2 py-0.5 rounded-full text-[10px] font-medium investor-reaction bg-amber-500/50 text-white";
      }
    });
    
    // Reset worm chart - start at 40% (60% from top)
    document.getElementById("pitchWormLine").setAttribute("points", "0,60");
    document.getElementById("pitchWormDot").style.left = "0%";
    document.getElementById("pitchWormDot").style.top = "60%";
    
    // Clear effects
    document.getElementById("pitchEffects").innerHTML = "";
    
    // Reset buttons
    document.querySelectorAll(".pitch-action-btn").forEach(btn => btn.disabled = false);
    document.getElementById("pitchDemoBtn").disabled = false;
    
    // Start pitch audio (speaking sounds + ambient)
    this.startPitchAudio();
    
    // Show modal
    document.getElementById("pitchModal").classList.remove("hidden");
    document.getElementById("pitchModal").classList.add("flex");
    
    // Start game loop
    this.pitchGameLoop();
  }
  
  startPitchAudio() {
    try {
      this.pitchAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
      this.pitchMusicPlaying = true;
      this.playPitchSpeakingSound();
      this.playPitchAmbience();
    } catch (e) {
      console.log("Audio not available");
    }
  }
  
  playPitchSpeakingSound() {
    // Simulates someone speaking - rhythmic low tones
    if (!this.pitchMusicPlaying || !this.pitchAudioCtx) return;
    
    const ctx = this.pitchAudioCtx;
    const now = ctx.currentTime;
    
    // Voice-like frequencies with natural rhythm
    const syllables = [];
    const baseFreq = 120 + Math.random() * 40; // Vary pitch slightly
    const syllableCount = 3 + Math.floor(Math.random() * 4); // 3-6 syllables
    
    for (let i = 0; i < syllableCount; i++) {
      syllables.push({
        freq: baseFreq + Math.random() * 30 - 15,
        duration: 0.08 + Math.random() * 0.12,
        gap: 0.02 + Math.random() * 0.05
      });
    }
    
    let time = 0;
    syllables.forEach((syl) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      const filter = ctx.createBiquadFilter();
      
      osc.type = 'sawtooth';
      osc.frequency.value = syl.freq;
      
      filter.type = 'lowpass';
      filter.frequency.value = 800 + Math.random() * 400;
      filter.Q.value = 2;
      
      gain.gain.setValueAtTime(0, now + time);
      gain.gain.linearRampToValueAtTime(0.06, now + time + 0.02);
      gain.gain.linearRampToValueAtTime(0.04, now + time + syl.duration - 0.02);
      gain.gain.linearRampToValueAtTime(0, now + time + syl.duration);
      
      osc.connect(filter);
      filter.connect(gain);
      gain.connect(ctx.destination);
      
      osc.start(now + time);
      osc.stop(now + time + syl.duration);
      
      time += syl.duration + syl.gap;
    });
    
    // Schedule next phrase with natural pause
    const pauseDuration = 200 + Math.random() * 400;
    setTimeout(() => this.playPitchSpeakingSound(), time * 1000 + pauseDuration);
  }
  
  playPitchAmbience() {
    // Subtle room ambience - very quiet white noise
    if (!this.pitchMusicPlaying || !this.pitchAudioCtx) return;
    
    const ctx = this.pitchAudioCtx;
    const bufferSize = ctx.sampleRate * 2;
    const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const data = buffer.getChannelData(0);
    
    for (let i = 0; i < bufferSize; i++) {
      data[i] = (Math.random() * 2 - 1) * 0.015; // Very quiet
    }
    
    this.pitchAmbienceNode = ctx.createBufferSource();
    this.pitchAmbienceNode.buffer = buffer;
    this.pitchAmbienceNode.loop = true;
    
    const filter = ctx.createBiquadFilter();
    filter.type = 'lowpass';
    filter.frequency.value = 500;
    
    this.pitchAmbienceNode.connect(filter);
    filter.connect(ctx.destination);
    this.pitchAmbienceNode.start();
  }
  
  stopPitchAudio() {
    this.pitchMusicPlaying = false;
    if (this.pitchAmbienceNode) {
      try { this.pitchAmbienceNode.stop(); } catch(e) {}
      this.pitchAmbienceNode = null;
    }
    if (this.pitchAudioCtx) {
      this.pitchAudioCtx.close();
      this.pitchAudioCtx = null;
    }
  }
  
  pitchGameLoop() {
    if (!this.pitch?.active) return;
    
    this.pitch.timeLeft -= 0.1;
    this.pitch.tickCount++;
    
    // Update timer
    const mins = Math.floor(this.pitch.timeLeft / 60);
    const secs = Math.floor(this.pitch.timeLeft % 60);
    const timerText = `${mins}:${secs.toString().padStart(2, '0')}`;
    document.getElementById("pitchTimer").textContent = timerText;
    const timerSmall = document.getElementById("pitchTimerSmall");
    if (timerSmall) timerSmall.textContent = timerText;
    
    // Attention naturally decays over time - grumpier investors = faster decay
    this.pitch.attention = Math.max(0, this.pitch.attention - 0.22);
    
    // Record attention for worm chart (every 3 ticks = 0.3 seconds for smoother line)
    if (this.pitch.tickCount % 3 === 0) {
      this.pitch.attentionHistory.push(this.pitch.attention);
      this.updateWormChart();
    }
    
    this.updatePitchAttention();
    
    // Update investor moods based on attention
    this.updateInvestorMoods();
    
    // End game?
    if (this.pitch.timeLeft <= 0) {
      this.endPitch();
      return;
    }
    
    setTimeout(() => this.pitchGameLoop(), 100);
  }
  
  updateWormChart() {
    const history = this.pitch.attentionHistory;
    const totalTime = this.pitch.totalTime || 30;
    const elapsed = totalTime - this.pitch.timeLeft;
    
    // SVG viewBox is 300 x 100
    const chartWidth = 300;
    const chartHeight = 100;
    
    // Calculate points - x moves from left to right over 30 seconds
    // y maps attention (0-100) to position (100-0, inverted)
    const points = history.map((att, i) => {
      const x = (i / (totalTime / 0.3)) * chartWidth; // 30 seconds / 0.3s per sample = 100 samples
      const y = chartHeight - (att / 100) * chartHeight;
      return `${x},${y}`;
    }).join(" ");
    
    document.getElementById("pitchWormLine").setAttribute("points", points);
    
    // Update dot position - moves left to right
    const dotX = (elapsed / totalTime) * 100; // percentage
    const dotY = 100 - this.pitch.attention; // percentage (inverted)
    const dot = document.getElementById("pitchWormDot");
    dot.style.left = `${dotX}%`;
    dot.style.top = `${dotY}%`;
    
    // Update gradient end color based on current attention
    const gradient = document.getElementById("wormGradient");
    if (gradient) {
      const stops = gradient.querySelectorAll('stop');
      const color = this.pitch.attention < 30 ? '#ef4444' : 
                    this.pitch.attention < 50 ? '#f59e0b' : 
                    this.pitch.attention < 70 ? '#eab308' : '#10b981';
      if (stops[2]) stops[2].style.stopColor = color;
    }
  }
  
  updatePitchAttention() {
    const attention = Math.round(this.pitch.attention);
    document.getElementById("pitchAttentionValue").textContent = `${attention}%`;
    
    // Track peak attention
    if (this.pitch.attention > this.pitch.peakAttention) {
      this.pitch.peakAttention = this.pitch.attention;
    }
    
    // Update mood label
    let mood, moodColor;
    if (attention < 30) {
      mood = "Losing Interest";
      moodColor = "text-red-400";
    } else if (attention < 50) {
      mood = "Neutral";
      moodColor = "text-amber-400";
    } else if (attention < 70) {
      mood = "Interested";
      moodColor = "text-emerald-400";
    } else if (attention < 90) {
      mood = "Very Engaged";
      moodColor = "text-emerald-300";
    } else {
      mood = "Excited!";
      moodColor = "text-pink-400";
    }
    
    document.getElementById("pitchInvestorMood").textContent = mood;
    document.getElementById("pitchInvestorMood").className = moodColor + " font-medium";
  }
  
  updateInvestorMoods() {
    const attention = this.pitch.attention;
    
    // Grumpier investors - higher thresholds needed to impress them
    const reactions = attention < 20 ? [
      { face: 'ğŸ˜´', text: 'Falling asleep', bg: 'bg-red-600/60', textColor: 'text-white' },
      { face: 'ğŸ™„', text: 'Eye roll', bg: 'bg-red-600/60', textColor: 'text-white' },
      { face: 'ğŸ“±', text: 'Checking phone', bg: 'bg-red-600/60', textColor: 'text-white' },
      { face: 'ğŸ˜¤', text: 'Annoyed', bg: 'bg-red-600/60', textColor: 'text-white' }
    ] : attention < 35 ? [
      { face: 'ğŸ˜‘', text: 'Unimpressed', bg: 'bg-red-500/50', textColor: 'text-white' },
      { face: 'ğŸ˜', text: 'Skeptical', bg: 'bg-amber-600/50', textColor: 'text-white' },
      { face: 'ğŸ¥±', text: 'Yawning', bg: 'bg-red-500/50', textColor: 'text-white' },
      { face: 'ğŸ˜’', text: 'Heard it before', bg: 'bg-amber-600/50', textColor: 'text-white' }
    ] : attention < 50 ? [
      { face: 'ğŸ¤¨', text: 'Doubtful', bg: 'bg-amber-500/50', textColor: 'text-white' },
      { face: 'ğŸ˜', text: 'Unconvinced', bg: 'bg-amber-500/50', textColor: 'text-white' },
      { face: 'ğŸ¤”', text: 'Skeptical', bg: 'bg-slate-500/50', textColor: 'text-white' },
      { face: 'ğŸ˜¶', text: 'Waiting...', bg: 'bg-slate-500/50', textColor: 'text-white' }
    ] : attention < 65 ? [
      { face: 'ğŸ¤”', text: 'Listening', bg: 'bg-slate-600', textColor: 'text-slate-200' },
      { face: 'ğŸ˜', text: 'Considering', bg: 'bg-slate-600', textColor: 'text-slate-200' },
      { face: 'ğŸ™‚', text: 'Mildly curious', bg: 'bg-emerald-500/30', textColor: 'text-emerald-200' },
      { face: 'ğŸ¤”', text: 'Hmm...', bg: 'bg-slate-600', textColor: 'text-slate-200' }
    ] : attention < 80 ? [
      { face: 'ğŸ™‚', text: 'Interested', bg: 'bg-emerald-500/40', textColor: 'text-white' },
      { face: 'ğŸ˜Š', text: 'Engaged', bg: 'bg-emerald-500/40', textColor: 'text-white' },
      { face: 'âœ', text: 'Taking notes', bg: 'bg-blue-500/50', textColor: 'text-white' },
      { face: 'ğŸ‘', text: 'Not bad!', bg: 'bg-emerald-500/40', textColor: 'text-white' }
    ] : attention < 90 ? [
      { face: 'ğŸ˜€', text: 'Impressed!', bg: 'bg-emerald-500/50', textColor: 'text-white' },
      { face: 'ğŸ˜Š', text: 'Very interested', bg: 'bg-emerald-500/50', textColor: 'text-white' },
      { face: 'ğŸ¤©', text: 'Excited!', bg: 'bg-emerald-500/50', textColor: 'text-white' },
      { face: 'ğŸ‘', text: 'Great pitch!', bg: 'bg-emerald-500/50', textColor: 'text-white' }
    ] : [
      { face: 'ğŸ¤©', text: 'Love it!', bg: 'bg-pink-500/60', textColor: 'text-white' },
      { face: 'ğŸ˜', text: 'Want to invest!', bg: 'bg-pink-500/60', textColor: 'text-white' },
      { face: 'ğŸ™Œ', text: 'Amazing!', bg: 'bg-pink-500/60', textColor: 'text-white' },
      { face: 'ğŸ’°', text: 'Take my money!', bg: 'bg-emerald-500/60', textColor: 'text-white' }
    ];
    
    for (let i = 0; i < 4; i++) {
      const faceEl = document.querySelector(`#investor-${i} .investor-face`);
      const reactionEl = document.getElementById(`investor-reaction-${i}`);
      const investorEl = document.getElementById(`investor-${i}`);
      
      if (faceEl && reactions[i]) faceEl.textContent = reactions[i].face;
      if (reactionEl && reactions[i]) {
        reactionEl.textContent = reactions[i].text;
        reactionEl.className = `mt-1 px-2 py-0.5 rounded-full text-[10px] font-medium investor-reaction ${reactions[i].bg} ${reactions[i].textColor}`;
      }
      
      if (investorEl) {
        investorEl.classList.remove('bored', 'interested', 'excited');
        if (attention < 35) investorEl.classList.add('bored');
        else if (attention >= 85) investorEl.classList.add('excited');
        else if (attention >= 55) investorEl.classList.add('interested');
      }
    }
  }
  
  pitchAction(type) {
    if (!this.pitch?.active) return;
    
    // Speech lines for each action type
    const speechLines = {
      story: [
        '"Let me tell you about our first customer..."',
        '"When we started, nobody believed in us..."',
        '"Picture this: a world where AI actually helps..."',
        '"I remember the moment everything clicked..."'
      ],
      joke: [
        '"Why did the AI cross the road? To optimize the other side!"',
        '"Our burn rate is so low, even our accountant smiles!"',
        '"VCs say we move fast. Our code says otherwise!"',
        '"Machine learning? More like machine yearning... for funding!"'
      ],
      customer: [
        '"Titan Tech is already piloting our solution..."',
        '"public health system just signed a Â£2M contract..."',
        '"Apex Commerce reached out to us last week..."',
        '"We have 3 Fortune 500 companies in our pipeline..."'
      ],
      data: [
        '"Our monthly revenue grew 40% last month..."',
        '"95% of customers stay with us year after year..."',
        '"We reduced costs by 60% for our clients..."',
        '"When we survey customers, they rate us 72 out of 100-industry average is just 30..."'
      ],
      smile: [
        '"*warm, confident smile*"',
        '"*genuine enthusiasm*"',
        '"*makes eye contact*"'
      ],
      walk: [
        '"*steps closer to investors*"',
        '"*moves toward the whiteboard*"',
        '"*approaches with confidence*"'
      ],
      enthusiasm: [
        '"This is what gets me out of bed every morning!"',
        '"I genuinely believe we can change this industry!"',
        '"We are SO excited about what we are building!"',
        '"This opportunity is absolutely massive!"'
      ],
      demo: [
        '"Let me show you the product in action..."',
        '"Here is our live dashboard..."',
        '"Watch what happens when I click this..."'
      ]
    };
    
    const actions = {
      story: { points: 3, attention: 15, text: "ğŸ“– Great story!", successRate: 1.0 },
      joke: { points: 2, attention: 12, text: "ğŸ˜„ Haha! Good one!", successRate: 0.65, failText: "ğŸ˜¬ Awkward silence...", failAttention: -10 },
      customer: { points: 2, attention: 14, text: "ğŸ¢ Impressive client!", successRate: 1.0 },
      data: { points: 2, attention: 10, text: "ğŸ“Š Solid metrics!", successRate: 1.0 },
      smile: { points: 1, attention: 5, text: "ğŸ˜Š Charming!", successRate: 1.0 },
      walk: { points: 1, attention: 6, text: "ğŸš¶ Confident!", successRate: 1.0 },
      enthusiasm: { points: 2, attention: 11, text: "ğŸ™Œ Love the energy!", successRate: 1.0 },
      demo: { points: 4, attention: 22, text: "ğŸ’» Wow! Amazing demo!", successRate: 0.80, failText: "ğŸ’» Demo crashed! ğŸ˜±", failAttention: -12, once: true }
    };
    
    const action = actions[type];
    if (!action) return;
    
    // Check points
    if (this.pitch.points < action.points) {
      this.pitchShowEffect("âŒ Not enough points!", "#ef4444");
      document.getElementById("pitchSpeechText").textContent = '"I... uh... need a moment..."';
      return;
    }
    
    // Check if demo already used
    if (type === 'demo' && this.pitch.demoUsed) {
      return;
    }
    
    // Deduct points
    this.pitch.points -= action.points;
    document.getElementById("pitchPoints").textContent = this.pitch.points;
    
    // Track action
    this.pitch.actionsUsed.push(type);
    
    // Update speech bubble
    const lines = speechLines[type] || ['"..."'];
    const speechText = lines[Math.floor(Math.random() * lines.length)];
    document.getElementById("pitchSpeechText").textContent = speechText;
    
    // Animate presenter
    const presenter = document.getElementById("pitchPresenter");
    presenter.classList.add("pitch-presenter-action");
    setTimeout(() => presenter.classList.remove("pitch-presenter-action"), 300);
    
    // Determine success
    const success = Math.random() < action.successRate;
    
    if (success) {
      this.pitch.attention = Math.min(100, this.pitch.attention + action.attention);
      this.pitchShowEffect(action.text, "#10b981");
      document.getElementById("pitchActionLog").textContent = action.text;
      
      if (type === 'joke') this.pitch.jokeSuccess++;
      
      // Play success sound - satisfying chime
      if (soundManager.enabled && soundManager.ctx) {
        const ctx = soundManager.ctx;
        const now = ctx.currentTime;
        [523, 659, 784].forEach((freq, i) => {
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.type = 'sine';
          osc.frequency.value = freq;
          gain.gain.setValueAtTime(0.15, now + i * 0.08);
          gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.08 + 0.15);
          osc.connect(gain);
          gain.connect(ctx.destination);
          osc.start(now + i * 0.08);
          osc.stop(now + i * 0.08 + 0.2);
        });
      }
    } else {
      this.pitch.attention = Math.max(0, this.pitch.attention + (action.failAttention || -5));
      this.pitchShowEffect(action.failText || "ğŸ˜¬ That didn't land...", "#ef4444");
      document.getElementById("pitchActionLog").textContent = action.failText || "That didn't work...";
      document.getElementById("pitchSpeechText").textContent = '"...anyway, moving on..."';
      
      if (type === 'joke') this.pitch.jokeFail++;
      
      // Play fail sound - descending tone
      if (soundManager.enabled && soundManager.ctx) {
        const ctx = soundManager.ctx;
        const now = ctx.currentTime;
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(300, now);
        osc.frequency.exponentialRampToValueAtTime(150, now + 0.3);
        gain.gain.setValueAtTime(0.1, now);
        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start(now);
        osc.stop(now + 0.35);
      }
    }
    
    // Mark demo as used
    if (type === 'demo') {
      this.pitch.demoUsed = true;
      document.getElementById("pitchDemoBtn").disabled = true;
    }
    
    // Immediately update worm chart for responsiveness
    this.pitch.attentionHistory.push(this.pitch.attention);
    this.updateWormChart();
    
    this.updatePitchAttention();
  }
  
  pitchShowEffect(text, color = "#fff") {
    const el = document.createElement("div");
    el.className = "pitch-effect";
    el.style.left = `${200 + Math.random() * 400}px`;
    el.style.top = `${80 + Math.random() * 60}px`;
    el.style.color = color;
    el.textContent = text;
    
    document.getElementById("pitchEffects").appendChild(el);
    setTimeout(() => el.remove(), 600);
  }
  
  endPitch() {
    this.pitch.active = false;
    this.stopPitchAudio();
    
    // Calculate performance metrics
    const finalAttention = this.pitch.attention;
    const peakAttention = this.pitch.peakAttention;
    const avgAttention = (finalAttention + peakAttention) / 2;
    const actionsCount = this.pitch.actionsUsed.length;
    const pointsUsed = 12 - this.pitch.points;
    const efficiency = actionsCount > 0 ? avgAttention / actionsCount : 0; // attention per action
    
    // Determine tier for display purposes
    let tier, icon, title;
    if (avgAttention < 25) {
      tier = 1;
      icon = "ğŸ˜”";
      title = "Tough Crowd";
    } else if (avgAttention < 40) {
      tier = 2;
      icon = "ğŸ˜";
      title = "Lukewarm Response";
    } else if (avgAttention < 55) {
      tier = 3;
      icon = "ğŸ‘";
      title = "Decent Pitch";
    } else if (avgAttention < 70) {
      tier = 4;
      icon = "ğŸŒŸ";
      title = "Strong Pitch!";
    } else if (avgAttention < 85) {
      tier = 5;
      icon = "ğŸ”¥";
      title = "Excellent Pitch!";
    } else {
      tier = 6;
      icon = "ğŸ†";
      title = "Legendary Pitch!";
    }
    
    // Calculate rewards based on actual performance, not tiers
    // Valuation: based on final attention (investors' lasting impression)
    const valBonus = Math.floor(finalAttention * 2); // 0-200k based on 0-100% attention
    
    // Sales: based on peak attention (how excited they got)
    const mktBonus = peakAttention >= 40 ? Math.floor((peakAttention - 30) / 8) : 0; // 0-8 pts
    
    // Research & Product: based on efficiency (smart pitching)
    const sciBonus = efficiency >= 6 ? Math.floor(efficiency / 3) : 0; // 0-5 pts for efficient pitching
    const devBonus = efficiency >= 6 ? Math.floor(efficiency / 3) : 0;
    
    // People: based on finishing strong (ended above 50%)
    const hrBonus = finalAttention >= 50 ? Math.floor((finalAttention - 40) / 12) : 0; // 0-5 pts
    
    // Cash: starts at decent performance (avg 50%+), scales up significantly
    const cashBonus = avgAttention >= 50 ? Math.floor((avgAttention - 40) * 4) : 0; // 40-240k
    
    const rewards = {
      val: valBonus,
      sci: sciBonus,
      dev: devBonus,
      mkt: mktBonus,
      hr: hrBonus,
      cash: cashBonus
    };
    
    // Apply rewards
    Object.entries(rewards).forEach(([k, v]) => {
      if (v > 0 && this.metrics[k] !== undefined) {
        this.metrics[k] += v;
      }
    });
    
    // Hide game modal
    document.getElementById("pitchModal").classList.add("hidden");
    document.getElementById("pitchModal").classList.remove("flex");
    
    // Show results
    document.getElementById("pitchResultIcon").textContent = icon;
    document.getElementById("pitchResultTitle").textContent = title;
    document.getElementById("pitchResultText").textContent = 
      tier <= 2 ? "The investors seemed distracted. You'll need to work harder next time." :
      tier === 3 ? "Not bad! The investors showed some interest but weren't blown away." :
      tier === 4 ? "Great job! You clearly communicated your vision." :
      tier === 5 ? "Fantastic pitch! The investors are excited about your startup." :
      "Incredible! The investors are fighting over who gets to lead the round!";
    
    document.getElementById("pitchResultStats").innerHTML = `
      <div class="flex justify-between mb-1"><span>Final Attention:</span><span class="font-bold ${finalAttention >= 60 ? 'text-emerald-400' : finalAttention >= 40 ? 'text-amber-400' : 'text-red-400'}">${Math.round(finalAttention)}%</span></div>
      <div class="flex justify-between mb-1"><span>Peak Attention:</span><span class="font-bold ${peakAttention >= 70 ? 'text-emerald-400' : 'text-slate-300'}">${Math.round(peakAttention)}%</span></div>
      <div class="flex justify-between mb-1"><span>Pitch Efficiency:</span><span class="font-bold ${efficiency >= 8 ? 'text-emerald-400' : 'text-slate-300'}">${efficiency.toFixed(1)} pts/action</span></div>
      <div class="flex justify-between"><span>Actions Used:</span><span class="font-bold">${actionsCount} (${pointsUsed} pts)</span></div>
    `;
    
    const rewardLines = [];
    if (rewards.val > 0) rewardLines.push(`+Â£${rewards.val}k Valuation`);
    if (rewards.mkt > 0) rewardLines.push(`+${rewards.mkt} Sales`);
    if (rewards.sci > 0) rewardLines.push(`+${rewards.sci} Research`);
    if (rewards.dev > 0) rewardLines.push(`+${rewards.dev} Product`);
    if (rewards.hr > 0) rewardLines.push(`+${rewards.hr} People`);
    if (rewards.cash > 0) rewardLines.push(`+Â£${rewards.cash}k Cash`);
    
    document.getElementById("pitchResultRewards").innerHTML = rewardLines.length > 0 
      ? `<div class="font-bold mb-1">Investor Confidence Rewards:</div>${rewardLines.join(" â€¢ ")}`
      : `<div class="text-slate-500">The investors weren't impressed enough to offer any bonuses.</div>`;
    
    // Generate and display debrief insights
    const debriefInsights = this.generatePitchDebrief();
    document.getElementById("pitchDebriefList").innerHTML = debriefInsights
      .map(insight => `<li>â€¢ ${insight}</li>`).join('');
    
    document.getElementById("pitchResultsModal").classList.remove("hidden");
    document.getElementById("pitchResultsModal").classList.add("flex");
    
    // Play appropriate sound
    if (tier >= 5) {
      soundManager.playVictory();
    } else if (tier >= 3) {
      soundManager.playMilestoneComplete();
    } else {
      soundManager.playWarning();
    }
    
    this.log(`ğŸ¤ Investor pitch: ${title} - +Â£${rewards.val}k valuation`);
  }
  
  closePitch() {
    document.getElementById("pitchResultsModal").classList.add("hidden");
    document.getElementById("pitchResultsModal").classList.remove("flex");
    
    // Continue normal gameplay after pitch mini-game
    this.update();
    this.renderBoardroom();
  }
  
  // === PITCH DEBRIEF GENERATION ===
  generatePitchDebrief() {
    const insights = [];
    const actions = this.pitch.actionsUsed || [];
    const finalAttention = this.pitch.attention;
    const peakAttention = this.pitch.peakAttention;
    const jokeSuccess = this.pitch.jokeSuccess || 0;
    const jokeFail = this.pitch.jokeFail || 0;
    const demoUsed = this.pitch.demoUsed;
    
    // Count action types
    const actionCounts = {};
    actions.forEach(a => actionCounts[a] = (actionCounts[a] || 0) + 1);
    
    const dataCount = actionCounts.data || 0;
    const storyCount = actionCounts.story || 0;
    const jokeCount = (actionCounts.joke || 0);
    const pauseCount = actionCounts.pause || 0;
    const energyCount = actionCounts.energy || 0;
    
    // Insight: Data vs Story balance
    if (dataCount > 0 && storyCount === 0) {
      insights.push(`You led with data only. Story + data combos typically keep investor attention higher.`);
    } else if (storyCount > 0 && dataCount === 0) {
      insights.push(`All story, no data. Investors need numbers to validate the narrative.`);
    } else if (dataCount > 0 && storyCount > 0) {
      insights.push(`Good mix of data and storytelling. This builds both credibility and emotional connection.`);
    }
    
    // Insight: Joke effectiveness
    if (jokeCount >= 2) {
      if (jokeFail > jokeSuccess) {
        insights.push(`Jokes fell flat ${jokeFail}/${jokeCount} times. Humor is riskyâ€”use sparingly with this crowd.`);
      } else if (jokeSuccess >= 2) {
        insights.push(`Your humor landed! ${jokeSuccess} successful jokes kept the energy up.`);
      }
    }
    
    // Insight: Demo timing
    if (demoUsed && peakAttention > 70) {
      insights.push(`Demo timing was effectiveâ€”you hit ${Math.round(peakAttention)}% peak attention.`);
    } else if (!demoUsed) {
      insights.push(`You skipped the demo. Live demos are high-impact but risky if they fail.`);
    }
    
    // Insight: Attention management
    if (finalAttention < 30 && peakAttention > 50) {
      insights.push(`Attention dropped from ${Math.round(peakAttention)}% to ${Math.round(finalAttention)}%. Ending strong mattersâ€”save impactful moves for the close.`);
    } else if (finalAttention > peakAttention - 10 && finalAttention > 60) {
      insights.push(`You maintained momentum to the end. Strong closers win term sheets.`);
    }
    
    // Insight: Energy/pause balance
    if (energyCount > 3 && pauseCount === 0) {
      insights.push(`All energy, no pauses. Strategic pauses let key points sink in.`);
    } else if (pauseCount > 2 && energyCount === 0) {
      insights.push(`Too many pauses can lose momentum. Mix in energy bursts to re-engage.`);
    }
    
    // Insight: Action variety
    const uniqueActions = Object.keys(actionCounts).length;
    if (uniqueActions <= 2 && actions.length > 5) {
      insights.push(`You relied on just ${uniqueActions} action types. Variety keeps investors engaged.`);
    }
    
    // Fallback insights
    if (insights.length === 0) {
      if (finalAttention >= 70) {
        insights.push(`Excellent pitch execution! Your varied approach kept investors engaged throughout.`);
      } else {
        insights.push(`Try mixing data, stories, and demos to build a compelling narrative arc.`);
      }
    }
    
    return insights.slice(0, 3); // Max 3 insights
  }

  renderRivals() {
    const playerTotal = this.metrics.sci + this.metrics.dev + this.metrics.mkt;
    const playerMilestones = this.completedMilestones?.length || 0;
    const activeRivals = this.rivals.filter(r => r.status === "active");
    
    const all = [
      { 
        name: this.company?.name || "You", 
        total: playerTotal, 
        milestones: playerMilestones,
        isPlayer: true 
      },
      ...activeRivals.map(r => ({ 
        id: r.id,
        name: r.name, 
        total: r.scores.sci + r.scores.dev + r.scores.mkt,
        milestones: r.milestones?.filter(m => m.status === "complete").length || 0,
        currentMilestone: r.milestones?.find(m => m.status === "in-progress")?.name,
        logo: r.logo,
        style: r.style,
        funded: r.funded,
        desc: r.desc
      }))
    ].sort((a, b) => {
      // Primary sort: milestones completed (more = better)
      if (b.milestones !== a.milestones) return b.milestones - a.milestones;
      // Secondary sort: total score
      return b.total - a.total;
    });
    
    const rank = all.findIndex(x => x.isPlayer) + 1;
    document.getElementById("playerRank").textContent = `#${rank}`;
    document.getElementById("playerRank").className = `font-bold ${rank === 1 ? 'text-emerald-600' : rank === 2 ? 'text-amber-600' : 'text-red-600'}`;
    
    // Calculate max total for progress bars
    const maxTotal = Math.max(...all.map(r => r.total));
    
    document.getElementById("rivalsList").innerHTML = all.map((r, i) => {
      const progress = (r.total / maxTotal) * 100;
      const styleColors = {
        aggressive: 'text-red-500',
        methodical: 'text-blue-500', 
        cautious: 'text-amber-500'
      };
      const styleIcons = {
        aggressive: 'ğŸ”¥',
        methodical: 'ğŸ“Š',
        cautious: 'ğŸ¢'
      };
      
      if (r.isPlayer) {
        return `
          <div class="p-2 rounded-lg bg-gradient-to-r from-emerald-50 to-green-50 border border-emerald-200">
            <div class="flex items-center gap-2">
              <span class="text-lg">${this.company?.id ? (this.company.id === 'aether' ? 'ğŸ§¬' : this.company.id === 'vanguard' ? 'ğŸ¤–' : this.company.id === 'quant' ? 'ğŸ“Š' : 'ğŸ¨') : 'ğŸš€'}</span>
              <div class="flex-1">
                <div class="flex items-center justify-between">
                  <span class="font-bold text-emerald-700 text-sm">#${i + 1} ${r.name}</span>
                  <span class="text-xs text-emerald-600">${r.milestones}/3 ğŸ¯</span>
                </div>
                <div class="w-full h-1.5 bg-emerald-200 rounded-full mt-1">
                  <div class="h-full bg-emerald-500 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                </div>
              </div>
            </div>
          </div>
        `;
      } else {
        // Determine relative position to player based on milestones first, then score
        const milestoneDiff = r.milestones - playerMilestones;
        const scoreDiff = r.total - playerTotal;
        
        let status, statusText, statusColor;
        if (milestoneDiff > 0) {
          status = 'ahead';
          statusText = `â†‘ +${milestoneDiff} milestone${milestoneDiff > 1 ? 's' : ''}`;
          statusColor = 'text-red-500';
        } else if (milestoneDiff < 0) {
          status = 'behind';
          statusText = `â†“ ${milestoneDiff} milestone${milestoneDiff < -1 ? 's' : ''}`;
          statusColor = 'text-emerald-500';
        } else if (scoreDiff > 10) {
          status = 'close-ahead';
          statusText = 'â†— Slightly ahead';
          statusColor = 'text-amber-500';
        } else if (scoreDiff < -10) {
          status = 'close-behind';
          statusText = 'â†˜ Slightly behind';
          statusColor = 'text-emerald-500';
        } else {
          status = 'tied';
          statusText = 'â‰ˆ Neck and neck';
          statusColor = 'text-amber-500';
        }
        
        return `
          <div onclick="game.showCompetitorModal('${r.id}')" class="p-2 rounded-lg bg-slate-50 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-colors cursor-pointer group">
            <div class="flex items-center gap-2">
              <span class="text-lg">${r.logo}</span>
              <div class="flex-1">
                <div class="flex items-center justify-between">
                  <span class="font-medium text-slate-700 text-sm group-hover:text-indigo-700"><span class="font-mono">#${i + 1}</span> ${r.name}</span>
                  <span class="text-xs font-mono text-slate-500">${r.milestones}/3 ğŸ¯</span>
                </div>
                <div class="flex items-center gap-2 text-[10px] mt-0.5">
                  <span class="${statusColor} font-medium">${statusText}</span>
                  <span class="text-slate-400">â€¢</span>
                  <span class="text-slate-500">${styleIcons[r.style]} ${r.style}</span>
                  <span class="ml-auto text-indigo-400 opacity-0 group-hover:opacity-100 transition-opacity">View â†’</span>
                </div>
                <div class="w-full h-1 bg-slate-200 rounded-full mt-1">
                  <div class="h-full bg-slate-400 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                </div>
              </div>
            </div>
          </div>
        `;
      }
    }).join("");
    
    // Show rival news occasionally
    this.updateRivalNews();
  }
  
  updateRivalNews() {
    const newsEl = document.getElementById("rivalNews");
    const activeRivals = this.rivals.filter(r => r.status === "active");
    if (activeRivals.length === 0) {
      newsEl.classList.add("hidden");
      return;
    }
    
    // Pick a random rival for news
    const rival = activeRivals[Math.floor(Math.random() * activeRivals.length)];
    const playerTotal = this.metrics.sci + this.metrics.dev + this.metrics.mkt;
    const rivalTotal = rival.scores.sci + rival.scores.dev + rival.scores.mkt;
    
    const newsOptions = rivalTotal > playerTotal ? [
      `${rival.name} reportedly closing a new funding round...`,
      `${rival.name} expanding their team aggressively`,
      `Industry buzz: ${rival.name} gaining traction`,
      `${rival.name} spotted at major client meetings`
    ] : [
      `${rival.name} facing internal challenges, sources say`,
      `${rival.name} pivoting strategy after setbacks`,
      `Rumour: Key talent leaving ${rival.name}`,
      `${rival.name} delaying their product roadmap`
    ];
    
    newsEl.textContent = `ğŸ“° ${newsOptions[Math.floor(Math.random() * newsOptions.length)]}`;
    newsEl.classList.remove("hidden");
  }

  showCompetitorModal(rivalId) {
    const rival = this.rivals.find(r => r.id === rivalId);
    if (!rival) return;
    
    // Basic info
    document.getElementById("competitorLogo").textContent = rival.logo;
    document.getElementById("competitorName").textContent = rival.name;
    document.getElementById("competitorDesc").textContent = rival.desc;
    
    // CEO info
    if (rival.ceo) {
      document.getElementById("competitorCEOPhoto").textContent = rival.ceo.photo;
      document.getElementById("competitorCEOName").textContent = rival.ceo.name;
      document.getElementById("competitorCEOBackground").textContent = rival.ceo.background;
      document.getElementById("competitorCEOQuote").textContent = `"${rival.ceo.quote}"`;
      document.getElementById("competitorCEOPersonality").textContent = rival.ceo.personality;
    }
    
    // Quick stats
    document.getElementById("competitorLocation").textContent = rival.location || "Unknown";
    document.getElementById("competitorFounded").textContent = rival.founded || "2023";
    document.getElementById("competitorEmployees").textContent = rival.employees ? `${rival.employees} people` : "Unknown";
    document.getElementById("competitorFundingStatus").textContent = rival.funded;
    
    // Development progress with comparison
    const maxScore = Math.max(rival.scores.sci, rival.scores.dev, rival.scores.mkt, this.metrics.sci, this.metrics.dev, this.metrics.mkt, 30);
    const playerScores = { sci: this.metrics.sci, dev: this.metrics.dev, mkt: this.metrics.mkt };
    const labels = { sci: "Research", dev: "Product", mkt: "Sales" };
    const colors = { sci: "emerald", dev: "sky", mkt: "fuchsia" };
    
    document.getElementById("competitorScores").innerHTML = Object.entries(rival.scores).map(([key, value]) => {
      const playerVal = playerScores[key];
      const diff = Math.round(value) - Math.round(playerVal);
      const comparison = diff > 2 ? `+${diff} ahead` : diff < -2 ? `${diff} behind` : "â‰ˆ even";
      const compColor = diff > 2 ? "text-red-500" : diff < -2 ? "text-emerald-500" : "text-amber-500";
      return `
        <div>
          <div class="flex justify-between items-center mb-1">
            <span class="text-sm font-medium text-slate-700">${labels[key]}</span>
            <div class="flex items-center gap-2">
              <span class="text-sm font-bold text-${colors[key]}-600">${Math.round(value)}</span>
              <span class="text-xs ${compColor}">(${comparison})</span>
            </div>
          </div>
          <div class="w-full h-2 bg-slate-200 rounded-full overflow-hidden">
            <div class="h-full bg-${colors[key]}-500 rounded-full transition-all" style="width: ${(value / maxScore) * 100}%"></div>
          </div>
        </div>
      `;
    }).join("");
    
    // Team
    if (rival.team) {
      document.getElementById("competitorTeam").innerHTML = rival.team.map(member => `
        <div class="bg-white rounded-lg p-3 border border-blue-100">
          <div class="text-xs font-bold text-blue-600 mb-1">${member.role}</div>
          <div class="font-medium text-slate-800 text-sm">${member.name}</div>
          <div class="text-xs text-slate-500 mt-1">${member.desc}</div>
        </div>
      `).join("");
    }
    
    // Funder - now dynamic
    if (rival.funder) {
      const totalRaised = rival.totalRaised ? `Â£${(rival.totalRaised / 1000).toFixed(1)}M total` : rival.funder.raised;
      document.getElementById("competitorFunder").innerHTML = `
        <div class="flex items-center justify-between">
          <div>
            <div class="font-bold text-slate-800">${rival.funder.name}</div>
            <div class="text-xs text-slate-500">${rival.funder.type}</div>
          </div>
          <div class="text-emerald-600 font-bold">${totalRaised}</div>
        </div>
      `;
    }
    
    // Milestones - now shows actual progress
    if (rival.milestones) {
      document.getElementById("competitorMilestones").innerHTML = rival.milestones.map(m => {
        const statusIcon = m.status === 'complete' ? 'âœ…' : m.status === 'in-progress' ? 'ğŸ”„' : 'ğŸ“‹';
        const statusColor = m.status === 'complete' ? 'bg-emerald-100 text-emerald-700' : 
                           m.status === 'in-progress' ? 'bg-amber-100 text-amber-700' : 
                           'bg-slate-100 text-slate-500';
        const quarterText = m.status === 'complete' ? `Q${m.quarter}` : 
                           m.status === 'in-progress' ? 'In Progress' : 'Planned';
        return `
          <div class="flex items-center justify-between p-2 rounded-lg ${statusColor}">
            <span class="flex items-center gap-2">
              <span>${statusIcon}</span>
              <span class="font-medium">${m.name}</span>
            </span>
            <span class="text-xs">${quarterText}</span>
          </div>
        `;
      }).join("");
    }
    
    // Strengths - can be dynamic based on state
    if (rival.strengths) {
      let dynamicStrengths = [...rival.strengths];
      if (rival.runway > 6) dynamicStrengths.push("Strong runway position");
      if (rival.funded === "Series B") dynamicStrengths.push("Well-capitalized for growth");
      if (rival.employees > 50) dynamicStrengths.push("Scaled team capacity");
      
      document.getElementById("competitorStrengths").innerHTML = dynamicStrengths.slice(0, 4).map(s => 
        `<li class="flex items-start gap-1"><span class="text-emerald-500">â€¢</span> ${s}</li>`
      ).join("");
    }
    
    // Weaknesses - can be dynamic based on state
    if (rival.weaknesses) {
      let dynamicWeaknesses = [...rival.weaknesses];
      if (rival.runway && rival.runway < 3) dynamicWeaknesses.unshift("âš ï¸ Low runway - needs funding soon");
      if (rival.runway && rival.runway < 2) dynamicWeaknesses.unshift("ğŸš¨ Critical runway - may fold");
      
      document.getElementById("competitorWeaknesses").innerHTML = dynamicWeaknesses.slice(0, 4).map(w => 
        `<li class="flex items-start gap-1"><span class="text-red-500">â€¢</span> ${w}</li>`
      ).join("");
    }
    
    // Strategic Insights section (new)
    const insightsEl = document.getElementById("competitorInsights");
    if (insightsEl) {
      const playerTotal = this.metrics.sci + this.metrics.dev + this.metrics.mkt;
      const rivalTotal = rival.scores.sci + rival.scores.dev + rival.scores.mkt;
      const threatLevel = rivalTotal > playerTotal + 10 ? "High" : 
                         rivalTotal > playerTotal - 5 ? "Medium" : "Low";
      const threatColor = threatLevel === "High" ? "text-red-600 bg-red-50" : 
                         threatLevel === "Medium" ? "text-amber-600 bg-amber-50" : "text-emerald-600 bg-emerald-50";
      
      const runway = rival.runway || this.estimateRunway(rival);
      const runwayStatus = runway < 3 ? "Critical" : runway < 5 ? "Tight" : "Healthy";
      const runwayColor = runway < 3 ? "text-red-600" : runway < 5 ? "text-amber-600" : "text-emerald-600";
      
      // Predict their next move
      let prediction = "";
      if (runway < 3) {
        prediction = "Likely seeking emergency funding or may pivot/fold";
      } else if (rival.milestones?.find(m => m.status === "in-progress")) {
        const inProgress = rival.milestones.find(m => m.status === "in-progress");
        prediction = `Focused on completing: ${inProgress.name}`;
      } else if (rival.funded === "Seed" && rivalTotal > 40) {
        prediction = "Likely preparing for Series A raise";
      } else if (rival.style === "aggressive") {
        prediction = "Expect aggressive market expansion moves";
      } else {
        prediction = "Steady execution on current roadmap";
      }
      
      insightsEl.innerHTML = `
        <div class="grid grid-cols-3 gap-3 mb-3">
          <div class="text-center p-2 rounded-lg ${threatColor}">
            <div class="text-xs text-slate-500 mb-1">Threat Level</div>
            <div class="font-bold">${threatLevel}</div>
          </div>
          <div class="text-center p-2 rounded-lg bg-slate-50">
            <div class="text-xs text-slate-500 mb-1">Est. Runway</div>
            <div class="font-bold ${runwayColor}">${runway}q (${runwayStatus})</div>
          </div>
          <div class="text-center p-2 rounded-lg bg-slate-50">
            <div class="text-xs text-slate-500 mb-1">Growth Rate</div>
            <div class="font-bold text-slate-700">${rival.style === "aggressive" ? "Fast ğŸ”¥" : rival.style === "methodical" ? "Steady ğŸ“Š" : "Slow ğŸ¢"}</div>
          </div>
        </div>
        <div class="p-3 bg-indigo-50 rounded-lg border border-indigo-100">
          <div class="text-xs font-bold text-indigo-700 mb-1">ğŸ¯ Predicted Next Move</div>
          <div class="text-sm text-indigo-900">${prediction}</div>
        </div>
      `;
    }
    
    // Recent Activity section (new)
    const activityEl = document.getElementById("competitorActivity");
    if (activityEl) {
      const history = rival.history || [];
      if (history.length > 0) {
        activityEl.innerHTML = `
          <h4 class="font-bold text-slate-700 mb-3 flex items-center gap-2">
            <span>ğŸ“°</span> Recent Activity
          </h4>
          <div class="space-y-2">
            ${history.slice(0, 5).map(h => {
              const icon = h.type === "funding" ? "ğŸ’°" : 
                          h.type === "milestone" ? "ğŸ¯" : 
                          h.type === "hire" ? "ğŸ‘”" :
                          h.type === "positive" ? "ğŸ“ˆ" : 
                          h.type === "negative" ? "ğŸ“‰" : "ğŸ“‹";
              const bgColor = h.type === "funding" ? "bg-emerald-50 border-emerald-200" :
                             h.type === "milestone" ? "bg-purple-50 border-purple-200" :
                             h.type === "negative" ? "bg-red-50 border-red-200" :
                             "bg-slate-50 border-slate-200";
              return `
                <div class="flex items-center gap-2 p-2 rounded-lg ${bgColor} border">
                  <span>${icon}</span>
                  <span class="flex-1 text-sm text-slate-700">${h.event}</span>
                  <span class="text-xs text-slate-400">Q${h.quarter}</span>
                </div>
              `;
            }).join("")}
          </div>
        `;
        activityEl.classList.remove("hidden");
      } else {
        activityEl.innerHTML = `
          <h4 class="font-bold text-slate-700 mb-3 flex items-center gap-2">
            <span>ğŸ“°</span> Recent Activity
          </h4>
          <p class="text-sm text-slate-500 italic">No recent activity reported</p>
        `;
      }
    }
    
    document.getElementById("competitorModal").classList.remove("hidden");
    document.getElementById("competitorModal").classList.add("flex");
  }
  
  closeCompetitorModal() {
    document.getElementById("competitorModal").classList.add("hidden");
    document.getElementById("competitorModal").classList.remove("flex");
  }

  renderNews() {
    const headlines = NEWS[this.market?.id] || NEWS.stable;
    const all = [...headlines, ...NEWS.default];
    document.getElementById("newsContent").textContent = all.join(" ").repeat(3);
  }

  // ===== STAFFING SYSTEM =====
  
  showHireStaffModal() {
    const modal = document.getElementById("hireStaffModal");
    
    // Base costs modified by founder's operational skill
    const baseHireCost = 50;
    const baseBurnIncrease = 25;
    
    // Operational founders reduce hiring costs (Â£5k per point above 2)
    const operationalBonus = this.founderBonuses?.operational || 2;
    const hireCostReduction = Math.max(0, (operationalBonus - 2) * 5);
    const hireCost = Math.max(25, baseHireCost - hireCostReduction); // Min Â£25k
    const burnIncrease = baseBurnIncrease;
    
    // Check hiring limits (max 2 per quarter)
    const hiresRemaining = 2 - (this.hiresThisQuarter || 0);
    const atLimit = hiresRemaining <= 0;
    const wouldBeSecondHire = this.hiresThisQuarter === 1;
    const hadHeavyHiringLastQ = this.hiresPreviousQuarter >= 2;
    
    // Update current stats
    document.getElementById("hireModalStaff").textContent = this.metrics.staff;
    document.getElementById("hireModalAPCurrent").textContent = `+${this.getStaffAPBonus()}`;
    document.getElementById("hireModalCash").textContent = `Â£${this.metrics.cash}k`;
    document.getElementById("hireModalBurn").textContent = `Â£${this.metrics.burn}k/q`;
    
    // Calculate after-hire stats
    const newStaff = this.metrics.staff + 1;
    const newBurn = this.metrics.burn + burnIncrease;
    const newCash = this.metrics.cash - hireCost;
    const newAPBonus = this.calculateStaffAPBonus(newStaff);
    
    document.getElementById("hireModalNewStaff").textContent = newStaff;
    document.getElementById("hireModalAPNew").textContent = `+${newAPBonus}`;
    document.getElementById("hireModalNewBurn").textContent = `Â£${newBurn}k/q`;
    document.getElementById("hireModalNewCash").textContent = `Â£${newCash}k`;
    
    // Show hiring cost with discount if applicable
    const hireCostEl = document.getElementById("hireModalCostDisplay");
    if (hireCostEl) {
      if (hireCostReduction > 0) {
        hireCostEl.innerHTML = `<span class="line-through text-slate-400">Â£${baseHireCost}k</span> <span class="text-emerald-600 font-bold">Â£${hireCost}k</span> <span class="text-xs text-emerald-500">(${this.founder?.profile?.name})</span>`;
      } else {
        hireCostEl.textContent = `Â£${hireCost}k one-time`;
      }
    }
    
    // Show integration/mood bonuses from leadership
    const leadershipBonus = this.founderBonuses?.leadership || 2;
    const integrationEl = document.getElementById("hireModalIntegrationDisplay");
    if (integrationEl) {
      let penaltyText = "-1 AP this quarter";
      // Add extra penalty warnings
      if (wouldBeSecondHire) {
        penaltyText = "-1 AP + <span class='text-red-600'>-1 rapid growth</span>";
        if (hadHeavyHiringLastQ) {
          penaltyText = "-1 AP + <span class='text-red-600'>-2 sustained growth strain</span>";
        }
      }
      if (leadershipBonus > 2) {
        integrationEl.innerHTML = `-0.5 AP <span class="text-xs text-emerald-500">(${this.founder?.profile?.name})</span>`;
      } else {
        integrationEl.innerHTML = penaltyText;
      }
    }
    
    const moodEl = document.getElementById("hireModalMoodDisplay");
    if (moodEl) {
      if (leadershipBonus > 3) {
        moodEl.innerHTML = `-0.25 mood <span class="text-xs text-emerald-500">(Leader)</span>`;
      } else {
        moodEl.textContent = "-0.5 mood all depts";
      }
    }
    
    // Show/hide hiring limit notice
    const earlyLimitNotice = document.getElementById("hireModalEarlyLimit");
    if (earlyLimitNotice) {
      if (atLimit) {
        earlyLimitNotice.innerHTML = `<span class="text-red-600">âš ï¸ Hiring limit reached this quarter (max 2). More hiring available next quarter.</span>`;
        earlyLimitNotice.classList.remove("hidden");
      } else if (wouldBeSecondHire && hadHeavyHiringLastQ) {
        earlyLimitNotice.innerHTML = `<span class="text-red-600">âš ï¸ Warning: 2nd hire after heavy hiring last quarter will incur -2 AP penalty (sustained growth strain)</span>`;
        earlyLimitNotice.classList.remove("hidden");
      } else if (wouldBeSecondHire) {
        earlyLimitNotice.innerHTML = `<span class="text-amber-600">âš ï¸ Note: 2nd hire this quarter will incur -1 AP extra penalty (rapid growth)</span>`;
        earlyLimitNotice.classList.remove("hidden");
      } else {
        earlyLimitNotice.innerHTML = `<span class="text-slate-600">ğŸ“‹ Hiring limit: ${hiresRemaining} hire${hiresRemaining !== 1 ? 's' : ''} remaining this quarter</span>`;
        earlyLimitNotice.classList.remove("hidden");
      }
    }
    
    // Disable button if can't afford OR at limit
    const canAfford = this.metrics.cash >= hireCost;
    const canHire = canAfford && !atLimit;
    document.getElementById("confirmHireBtn").disabled = !canHire;
    
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  }
  
  closeHireStaffModal() {
    document.getElementById("hireStaffModal").classList.add("hidden");
    document.getElementById("hireStaffModal").classList.remove("flex");
  }
  
  confirmHireStaff() {
    // Base costs modified by founder's operational skill
    const baseHireCost = 50;
    const operationalBonus = this.founderBonuses?.operational || 2;
    const hireCostReduction = Math.max(0, (operationalBonus - 2) * 5);
    const hireCost = Math.max(25, baseHireCost - hireCostReduction);
    const burnIncrease = 25;
    
    if (this.metrics.cash < hireCost) return;
    
    // Check per-quarter hiring limit (max 2)
    if (this.hiresThisQuarter >= 2) return;
    
    // Check if this is the 2nd hire (triggers extra penalties)
    const isSecondHire = this.hiresThisQuarter === 1;
    const hadHeavyHiringLastQ = this.hiresPreviousQuarter >= 2;
    
    // Track hires this quarter
    this.hiresThisQuarter += 1;
    
    // Apply costs
    this.metrics.cash -= hireCost;
    this.metrics.burn += burnIncrease;
    this.metrics.staff += 1;
    
    // Track integrating staff (AP penalty this quarter)
    // Leadership reduces integration penalty
    const leadershipBonus = this.founderBonuses?.leadership || 2;
    const integrationPenaltyReduction = leadershipBonus > 2 ? 0.5 : 0; // High leadership = halved penalty
    
    this.integratingStaff += 1;
    let basePenalty = Math.min(this.integratingStaff, 2);
    
    // Extra penalties for rapid/sustained growth
    let extraPenalty = 0;
    let penaltyReason = "";
    if (isSecondHire) {
      if (hadHeavyHiringLastQ) {
        extraPenalty = 2; // Sustained growth strain
        penaltyReason = " Sustained growth strain (-2 AP extra)!";
      } else {
        extraPenalty = 1; // Rapid growth penalty
        penaltyReason = " Rapid growth (-1 AP extra).";
      }
    }
    
    this.staffAPPenalty = Math.max(0, basePenalty + extraPenalty - (integrationPenaltyReduction * this.integratingStaff));
    
    // Mood hit from team being stretched (leadership reduces this too)
    const moodPenalty = leadershipBonus > 3 ? 0.25 : 0.5;
    // Extra mood penalty for 2nd hire
    const extraMoodPenalty = isSecondHire ? 0.5 : 0;
    Object.keys(this.moods).forEach(dept => {
      if (this.team[dept]) {
        this.moods[dept] = Math.max(-3, this.moods[dept] - moodPenalty - extraMoodPenalty);
      }
    });
    
    const discountText = hireCostReduction > 0 ? ` (${this.founder?.profile?.name} discount)` : '';
    this.log(`ğŸ‘¥ Hired 1 staff (-Â£${hireCost}k${discountText}, +Â£${burnIncrease}k burn).${penaltyReason} Integrating...`);
    soundManager.playHireSelect();
    
    this.closeHireStaffModal();
    this.update();
    this.renderBoardroom();
  }
  
  // ===== NEW JOB POSTING SYSTEM =====
  
  showJobPostModal() {
    // Reset selections
    document.querySelectorAll('.job-role-option').forEach(opt => {
      opt.classList.remove('border-indigo-400', 'bg-indigo-50');
      opt.classList.add('border-slate-200');
      opt.querySelector('input').checked = false;
    });
    document.querySelectorAll('.job-seniority-option').forEach(opt => {
      opt.classList.remove('border-indigo-400', 'bg-indigo-50');
      opt.classList.add('border-slate-200');
      opt.querySelector('input').checked = false;
    });
    
    // Set default values
    document.getElementById('jobSalaryMin').value = 65;
    document.getElementById('jobSalaryMax').value = 100;
    document.getElementById('jobEquityMin').value = 0.5;
    document.getElementById('jobEquityMax').value = 2;
    this.updateJobSalary();
    this.updateJobEquity();
    
    // Show/hide HR prompt
    const noHRPrompt = document.getElementById('noHRPrompt');
    if (noHRPrompt) {
      if (this.team.hr) {
        noHRPrompt.classList.add('hidden');
      } else {
        noHRPrompt.classList.remove('hidden');
      }
    }
    
    document.getElementById('jobPostModal').classList.remove('hidden');
    document.getElementById('jobPostModal').classList.add('flex');
  }
  
  closeJobPostModal() {
    document.getElementById('jobPostModal').classList.add('hidden');
    document.getElementById('jobPostModal').classList.remove('flex');
  }
  
  updateJobPost() {
    // Update role selection styling
    document.querySelectorAll('.job-role-option').forEach(opt => {
      const input = opt.querySelector('input');
      if (input.checked) {
        opt.classList.add('border-indigo-400', 'bg-indigo-50');
        opt.classList.remove('border-slate-200');
      } else {
        opt.classList.remove('border-indigo-400', 'bg-indigo-50');
        opt.classList.add('border-slate-200');
      }
    });
    
    // Update seniority selection styling and adjust salary/equity ranges
    const seniorityRanges = {
      junior: { salaryMin: 40, salaryMax: 60, equityMin: 0.25, equityMax: 1.0 },
      senior: { salaryMin: 65, salaryMax: 100, equityMin: 0.5, equityMax: 2.0 },
      lead: { salaryMin: 100, salaryMax: 150, equityMin: 1.0, equityMax: 3.0 }
    };
    
    document.querySelectorAll('.job-seniority-option').forEach(opt => {
      const input = opt.querySelector('input');
      if (input.checked) {
        opt.classList.add('border-indigo-400', 'bg-indigo-50');
        opt.classList.remove('border-slate-200');
        
        // Update salary/equity sliders to match seniority
        const ranges = seniorityRanges[input.value];
        if (ranges) {
          document.getElementById('jobSalaryMin').value = ranges.salaryMin;
          document.getElementById('jobSalaryMax').value = ranges.salaryMax;
          document.getElementById('jobEquityMin').value = ranges.equityMin;
          document.getElementById('jobEquityMax').value = ranges.equityMax;
          this.updateJobSalary();
          this.updateJobEquity();
        }
      } else {
        opt.classList.remove('border-indigo-400', 'bg-indigo-50');
        opt.classList.add('border-slate-200');
      }
    });
  }
  
  updateJobSalary() {
    const min = parseInt(document.getElementById('jobSalaryMin').value);
    const max = parseInt(document.getElementById('jobSalaryMax').value);
    document.getElementById('jobSalaryMinDisplay').textContent = min;
    document.getElementById('jobSalaryMaxDisplay').textContent = Math.max(min, max);
  }
  
  updateJobEquity() {
    const min = parseFloat(document.getElementById('jobEquityMin').value);
    const max = parseFloat(document.getElementById('jobEquityMax').value);
    document.getElementById('jobEquityMinDisplay').textContent = min.toFixed(1);
    document.getElementById('jobEquityMaxDisplay').textContent = Math.max(min, max).toFixed(1);
  }
  
  confirmJobPost() {
    const role = document.querySelector('input[name="jobRole"]:checked')?.value;
    const seniority = document.querySelector('input[name="jobSeniority"]:checked')?.value;
    
    if (!role || !seniority) {
      alert('Please select a role and seniority level');
      return;
    }
    
    // Check AP - need at least 1 remaining (for potential hire)
    const totalAP = this.getTotalAP();
    const usedAP = this.getUsedAP();
    const remainingAP = totalAP - usedAP;
    
    if (remainingAP < 1) {
      alert('Not enough AP to hire');
      return;
    }
    
    // Store job posting
    this.currentJobPosting = {
      role,
      seniority,
      salaryMin: parseInt(document.getElementById('jobSalaryMin').value),
      salaryMax: parseInt(document.getElementById('jobSalaryMax').value),
      equityMin: parseFloat(document.getElementById('jobEquityMin').value),
      equityMax: parseFloat(document.getElementById('jobEquityMax').value)
    };
    
    // Job posting is free - AP is spent when hire is completed
    this.log(`ğŸ“‹ Posted job listing for ${seniority} ${role} role`);
    soundManager.playClick();
    
    // Close job post modal
    document.getElementById('jobPostModal').classList.add('hidden');
    document.getElementById('jobPostModal').classList.remove('flex');
    
    // Generate candidates and show them
    this.generateCandidates();
    
    // Force update all displays
    this.update();
    this.renderAPPips();
  }
  
  generateCandidates() {
    const job = this.currentJobPosting;
    if (!job) return;
    
    const pool = CANDIDATE_POOL[job.role] || [];
    
    // Filter by exact seniority match
    let filtered = pool.filter(c => c.seniority === job.seniority);
    
    // Adjust interest based on salary/equity match
    filtered = filtered.map(c => {
      let adjustedInterest = c.interest;
      if (job.salaryMax >= c.salaryExpect.ideal) adjustedInterest += 0.1;
      else if (job.salaryMax < c.salaryExpect.min) adjustedInterest -= 0.2;
      if (job.equityMax >= c.equityExpect.ideal) adjustedInterest += 0.1;
      else if (job.equityMax < c.equityExpect.min) adjustedInterest -= 0.15;
      return { ...c, adjustedInterest: Math.max(0.1, Math.min(1, adjustedInterest)) };
    });
    
    // Randomly select 4-6 candidates
    const numCandidates = 4 + Math.floor(Math.random() * 3);
    this.currentCandidates = this.shuffleArray(filtered).slice(0, numCandidates);
    
    this.showCandidatesModal();
  }
  
  shuffleArray(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }
  
  showCandidatesModal() {
    const job = this.currentJobPosting;
    const roleLabels = { research: 'Research', product: 'Product', marketing: 'Marketing', people: 'People' };
    
    // Check if HR is hired
    const hasHR = this.team.hr !== null;
    const hrNote = hasHR 
      ? `<span class="text-amber-600">ğŸ¤ ${this.team.hr.name.split(' ').pop()} is reviewing candidates</span>`
      : `<span class="text-slate-400">ğŸ’¡ Hire a People lead for hiring recommendations</span>`;
    
    document.getElementById('candidatesSubtitle').innerHTML = `${this.currentCandidates.length} candidates for ${roleLabels[job.role]} (${job.seniority}) Â· ${hrNote}`;
    
    const container = document.getElementById('candidatesList');
    container.innerHTML = this.currentCandidates.map(c => this.renderCandidateCard(c)).join('');
    
    document.getElementById('candidatesModal').classList.remove('hidden');
    document.getElementById('candidatesModal').classList.add('flex');
  }
  
  closeCandidatesModal() {
    document.getElementById('candidatesModal').classList.add('hidden');
    document.getElementById('candidatesModal').classList.remove('flex');
    // Refresh AP display after closing
    this.renderAPPips();
  }
  
  renderCandidateCard(candidate) {
    const interest = candidate.adjustedInterest || candidate.interest;
    const interestLabel = interest >= 0.85 ? 'Very Interested' : interest >= 0.6 ? 'Interested' : 'Exploring';
    const interestColor = interest >= 0.85 ? 'text-emerald-600 bg-emerald-50' : interest >= 0.6 ? 'text-blue-600 bg-blue-50' : 'text-slate-600 bg-slate-50';
    const availabilityLabel = { immediate: 'ğŸŸ¢ Available now', '1 month': 'ğŸŸ¡ 1 month notice', '3 months': 'ğŸ”´ 3 month notice' };
    const nonCompeteLabel = { none: '', low: 'âš ï¸ Minor non-compete', medium: 'âš ï¸ Non-compete review', high: 'ğŸš¨ Significant non-compete' };
    
    const seniorityColors = {
      junior: { bg: 'from-emerald-50 to-teal-50', border: 'border-emerald-200', badge: 'bg-emerald-100 text-emerald-700' },
      senior: { bg: 'from-blue-50 to-indigo-50', border: 'border-blue-200', badge: 'bg-blue-100 text-blue-700' },
      lead: { bg: 'from-violet-50 to-purple-50', border: 'border-violet-200', badge: 'bg-violet-100 text-violet-700' }
    };
    const colors = seniorityColors[candidate.seniority];
    
    // Get HR recommendation if HR exec is hired
    const hrRec = this.getHRRecommendation(candidate);
    
    return `
      <div class="bg-gradient-to-br ${colors.bg} ${colors.border} border-2 rounded-xl p-4">
        <div class="flex items-start gap-3 mb-3">
          <div class="text-4xl">${candidate.portrait}</div>
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-1 flex-wrap">
              <h3 class="font-bold text-slate-800">${candidate.name}</h3>
              <span class="px-2 py-0.5 text-xs font-medium rounded-full ${colors.badge}">${candidate.seniority}</span>
            </div>
            <p class="text-sm text-slate-600">${candidate.background}</p>
          </div>
        </div>
        
        <div class="flex flex-wrap gap-2 mb-3">
          <span class="px-2 py-1 text-xs font-medium rounded-full ${interestColor}">${interestLabel}</span>
          <span class="px-2 py-1 text-xs rounded-full bg-slate-100 text-slate-600">${availabilityLabel[candidate.availability]}</span>
        </div>
        
        ${candidate.nonCompeteRisk !== 'none' ? `<div class="text-xs text-amber-700 mb-3">${nonCompeteLabel[candidate.nonCompeteRisk]}</div>` : ''}
        
        ${hrRec ? `
        <div class="mb-3 p-2.5 rounded-lg ${hrRec.recommended ? 'bg-amber-50 border border-amber-200' : 'bg-slate-100 border border-slate-200'}">
          <div class="flex items-start gap-2">
            <span class="text-lg flex-shrink-0">${this.team.hr?.avatar ? 'ğŸ‘¤' : 'ğŸ¤'}</span>
            <div class="flex-1 min-w-0">
              <div class="text-xs font-medium ${hrRec.recommended ? 'text-amber-800' : 'text-slate-600'} mb-0.5">
                ${this.team.hr?.name.split(' ').pop() || 'HR'}: ${hrRec.recommended ? 'ğŸ‘ Recommended' : 'ğŸ¤” Hesitant'}
              </div>
              <p class="text-xs ${hrRec.recommended ? 'text-amber-700' : 'text-slate-500'} italic">"${hrRec.comment}"</p>
            </div>
          </div>
        </div>
        ` : ''}
        
        <div class="bg-white/60 rounded-lg p-3 mb-3">
          <div class="text-xs text-slate-500 mb-1">Salary & Equity Expectations</div>
          <div class="flex justify-between text-sm">
            <span class="font-medium text-slate-700">ğŸ’· Â£${candidate.salaryExpect.min}k - Â£${candidate.salaryExpect.max}k</span>
            <span class="font-medium text-slate-700">ğŸ“Š ${candidate.equityExpect.min}% - ${candidate.equityExpect.max}%</span>
          </div>
        </div>
        
        <div class="flex flex-wrap gap-1 mb-3">
          ${candidate.strengths.map(s => `<span class="px-2 py-0.5 text-xs bg-emerald-100 text-emerald-700 rounded-full">${s}</span>`).join('')}
          ${candidate.weaknesses.map(w => `<span class="px-2 py-0.5 text-xs bg-amber-100 text-amber-700 rounded-full">âš  ${w}</span>`).join('')}
        </div>
        
        <p class="text-sm text-slate-500 italic border-t border-slate-200/50 pt-3 mb-3">"${candidate.quote}"</p>
        
        <div class="flex gap-2">
          <button onclick="game.showCandidateDetail('${candidate.id}')" class="flex-1 px-3 py-2 text-sm border border-slate-300 rounded-lg hover:bg-white">View CV</button>
          <button onclick="game.startNegotiation('${candidate.id}')" class="flex-1 px-3 py-2 text-sm bg-indigo-500 hover:bg-indigo-600 text-white font-medium rounded-lg">Make Offer</button>
        </div>
      </div>
    `;
  }
  
  // HR recommendation system - biased toward "safe" choices
  getHRRecommendation(candidate) {
    const hr = this.team.hr;
    if (!hr) return null; // No HR = no recommendations
    
    // Each HR exec has different biases
    // Original executives from initial hiring
    const execBiases = {
      david: { // Process Builder - favors credentials, process, safe hires
        favors: ['PhD', 'MA ', 'MSc', 'MBA', 'years)', 'Director', 'Lead', 'Manager', 'Google', 'DeepMind', 'Meta', 'Stripe'],
        dislikes: ['Self-taught', 'Bootcamp', 'Kaggle', 'freelance', 'unconventional'],
        safetyBias: 0.8, // Very conservative
        salaryBias: 0.95, // Recommends slightly below market
        comments: {
          strong: ["Solid credentials. Low risk hire.", "Proper experience, proper process.", "I can work with this background."],
          weak: ["Unorthodox background. Hard to verify competence.", "No formal credentials - that's a red flag.", "I'd want more documentation on their experience."],
          salary: ["Market rate seems fair.", "Don't overpay - we can find others.", "Standard package should suffice."]
        }
      },
      sofia: { // Culture Champion - favors values, collaboration, potential
        favors: ['culture', 'team', 'collaborative', 'values', 'empathy', 'Potential', 'passionate'],
        dislikes: ['competitive', 'aggressive', 'difficult', 'impatient', 'Authority issues'],
        safetyBias: 0.6, // More open but still cautious
        salaryBias: 1.0, // Fair market rate
        comments: {
          strong: ["They'd fit our culture beautifully.", "I sense real passion here.", "Good energy - the team would gel with them."],
          weak: ["I'm worried about culture fit.", "Might disrupt team dynamics.", "Let's think about how they'd integrate."],
          salary: ["Pay fairly - it builds trust.", "Invest in people who invest in us.", "Consider their whole situation."]
        }
      },
      aisha: { // Talent Magnet - favors stars, top credentials, competitive hires
        favors: ['DeepMind', 'Google', 'Meta', 'Stanford', 'Oxford', 'Cambridge', 'Imperial', 'world-class', 'top', 'best', 'patents', 'publications'],
        dislikes: ['junior', 'trainee', 'assistant', 'affordable', 'cheap'],
        safetyBias: 0.5, // Willing to take risks for stars
        salaryBias: 1.15, // Recommends paying above market for talent
        comments: {
          strong: ["This is the calibre we need.", "A-player. Move fast before someone else does.", "I know their reputation - they deliver."],
          weak: ["Bit underwhelming for what we're building.", "Are we sure we can't get someone stronger?", "I'd keep looking for better options."],
          salary: ["Top talent costs top money.", "Pay what it takes to win them.", "Underpaying loses you the best people."]
        }
      }
    };
    
    // Biases for hired People candidates (from job posting)
    const hiredBiases = {
      h1: { // Suki Patel - Culture-focused, startup experienced
        favors: ['startup', 'culture', 'scale-up', 'values', 'team', 'passionate', 'hungry'],
        dislikes: ['corporate', 'bureaucratic', 'process', 'compliance'],
        safetyBias: 0.5,
        salaryBias: 1.05,
        comments: {
          strong: ["They've got that startup hunger.", "Culture add, not just culture fit.", "I like their energy."],
          weak: ["Might not handle our pace.", "Corporate mindset showing through.", "Not sure they get startup life."],
          salary: ["Competitive offer shows we're serious.", "Don't lowball - word gets around.", "Fair pay, but don't overpay for potential."]
        }
      },
      h2: { // Jerome Jackson - Process and scaling focused
        favors: ['Google', 'Meta', 'scale', 'process', 'systems', 'MBA', 'structured'],
        dislikes: ['scrappy', 'chaos', 'unconventional', 'self-taught'],
        safetyBias: 0.75,
        salaryBias: 1.0,
        comments: {
          strong: ["Strong systems thinker.", "They'll help us scale properly.", "Good foundational experience."],
          weak: ["Might struggle with our current stage.", "Looking for more structure than we have.", "Not sure they can handle ambiguity."],
          salary: ["Market rate is fair.", "Don't over-index on salary.", "Standard compensation works."]
        }
      },
      h3: { // Ava Lindgren - Recruiting focused
        favors: ['top', 'competitive', 'talent', 'recruited', 'headhunted', 'star'],
        dislikes: ['available', 'immediate', 'affordable', 'looking'],
        safetyBias: 0.4,
        salaryBias: 1.2,
        comments: {
          strong: ["Hard to get, worth the effort.", "Everyone wants them - so should we.", "Competitive hire, but we can win."],
          weak: ["Too easy to get - what's the catch?", "If they're available, why?", "I'd dig deeper on why they're looking."],
          salary: ["Offer above market or lose them.", "The best cost more. Budget for it.", "Don't be cheap with top talent."]
        }
      },
      h4: { // Dayo Adeyinka - Founder empathy
        favors: ['founder', 'startup', 'ownership', 'autonomous', 'self-starter', 'entrepreneurial'],
        dislikes: ['corporate', 'managed', 'supervised', 'structured'],
        safetyBias: 0.45,
        salaryBias: 1.0,
        comments: {
          strong: ["They get what we're building.", "Founder mindset - rare and valuable.", "Will own their outcomes."],
          weak: ["Needs too much direction.", "Corporate refugee syndrome.", "Might not thrive in ambiguity."],
          salary: ["Equity matters more than cash to the right people.", "Balance salary with ownership.", "Fair offer, emphasize the mission."]
        }
      },
      h5: { // Jordan Osei - Remote specialist
        favors: ['remote', 'distributed', 'async', 'flexible', 'autonomous'],
        dislikes: ['office', 'in-person', 'collaborative', 'meetings'],
        safetyBias: 0.55,
        salaryBias: 0.95,
        comments: {
          strong: ["Perfect for our remote setup.", "Self-managed, low overhead.", "Async communicator - efficient."],
          weak: ["Might struggle with in-person collaboration.", "Communication style might not fit.", "Need to think about timezone overlap."],
          salary: ["Remote talent is cost-effective.", "Geographic arbitrage works both ways.", "Fair pay for their location."]
        }
      },
      h6: { // Katya Sorokina - Psychology-trained junior
        favors: ['psychology', 'potential', 'learning', 'growth', 'development'],
        dislikes: ['rigid', 'fixed', 'experienced', 'senior'],
        safetyBias: 0.35,
        salaryBias: 0.9,
        comments: {
          strong: ["High potential, trainable.", "Fresh perspective could help.", "Coachable attitude."],
          weak: ["Might need more experience.", "Learning curve could slow us down.", "Risky bet at this stage."],
          salary: ["Junior rate is appropriate.", "Invest in development, not just salary.", "Room to grow compensation with them."]
        }
      },
      h7: { // Kofi Asante - Operations background
        favors: ['systems', 'operations', 'process', 'efficient', 'organized'],
        dislikes: ['chaotic', 'unstructured', 'creative', 'unconventional'],
        safetyBias: 0.65,
        salaryBias: 0.95,
        comments: {
          strong: ["Operationally sound.", "Will bring structure where we need it.", "Systems thinker."],
          weak: ["Might over-engineer things.", "Less comfortable with ambiguity.", "Process over progress risk."],
          salary: ["Efficient hire at this rate.", "Don't overpay - good ops people are findable.", "Market rate works."]
        }
      }
    };
    
    // Get bias data - check exec IDs first, then hired candidate IDs
    let bias = execBiases[hr.id] || hiredBiases[hr.id];
    
    // Fallback: create generic bias based on seniority if we don't have specific data
    if (!bias) {
      bias = {
        favors: ['experience', 'track record', 'proven'],
        dislikes: ['junior', 'unproven', 'risky'],
        safetyBias: 0.6,
        salaryBias: 1.0,
        comments: {
          strong: ["Solid candidate.", "Worth considering.", "Decent fit."],
          weak: ["Not sure about this one.", "Some concerns here.", "Might want to keep looking."],
          salary: ["Market rate seems right.", "Standard offer.", "Fair compensation."]
        }
      };
    }
    
    // Score candidate based on HR biases
    const candidateText = JSON.stringify(candidate).toLowerCase();
    let score = 0.5; // Neutral starting point
    
    // Check for favored traits
    bias.favors.forEach(trait => {
      if (candidateText.includes(trait.toLowerCase())) score += 0.15;
    });
    
    // Check for disliked traits
    bias.dislikes.forEach(trait => {
      if (candidateText.includes(trait.toLowerCase())) score -= 0.2;
    });
    
    // Senior/Lead candidates get bonus from safety-focused HR
    if (candidate.seniority === 'lead') score += bias.safetyBias * 0.2;
    if (candidate.seniority === 'senior') score += bias.safetyBias * 0.1;
    if (candidate.seniority === 'junior') score -= bias.safetyBias * 0.15;
    
    // Clamp score
    score = Math.max(0, Math.min(1, score));
    
    const recommended = score >= 0.55;
    const comments = recommended ? bias.comments.strong : bias.comments.weak;
    const comment = comments[Math.floor(Math.random() * comments.length)];
    
    return {
      recommended,
      score,
      comment,
      salaryAdvice: bias.salaryBias,
      salaryComment: bias.comments.salary[Math.floor(Math.random() * bias.comments.salary.length)]
    };
  }
  
  showCandidateDetail(candidateId) {
    const candidate = this.currentCandidates.find(c => c.id === candidateId);
    if (!candidate) return;
    
    const interest = candidate.adjustedInterest || candidate.interest;
    const interestPercent = Math.round(interest * 100);
    const availabilityLabel = { immediate: 'Available immediately', '1 month': '1 month notice', '3 months': '3 month notice' };
    const nonCompeteDesc = {
      none: 'No restrictions', low: 'Standard confidentiality, unlikely enforced',
      medium: 'Non-compete present - may need legal review', high: 'Significant non-compete - expect delays'
    };
    
    const seniorityColors = {
      junior: { header: 'from-emerald-500 to-teal-600' },
      senior: { header: 'from-blue-500 to-indigo-600' },
      lead: { header: 'from-violet-500 to-purple-600' }
    };
    const colors = seniorityColors[candidate.seniority];
    
    const content = document.getElementById('candidateDetailContent');
    content.innerHTML = `
      <div class="bg-gradient-to-r ${colors.header} px-6 py-5 rounded-t-2xl text-white">
        <div class="flex items-center gap-4">
          <div class="text-5xl bg-white/20 rounded-xl p-3">${candidate.portrait}</div>
          <div class="flex-1">
            <h2 class="text-xl font-bold">${candidate.name}</h2>
            <p class="text-white/80">${candidate.background}</p>
            <p class="text-white/60 text-sm">${candidate.origin}</p>
          </div>
          <div class="text-right">
            <div class="text-2xl font-bold">${interestPercent}%</div>
            <div class="text-white/70 text-sm">Interest</div>
          </div>
        </div>
      </div>
      
      <div class="p-6 max-h-[50vh] overflow-y-auto">
        <div class="grid grid-cols-3 gap-3 mb-5">
          <div class="bg-slate-50 rounded-lg p-3 text-center">
            <div class="text-sm font-bold text-slate-800">${availabilityLabel[candidate.availability].split(' ')[0]}</div>
            <div class="text-xs text-slate-500">${availabilityLabel[candidate.availability].split(' ').slice(1).join(' ') || 'Start'}</div>
          </div>
          <div class="bg-slate-50 rounded-lg p-3 text-center">
            <div class="text-sm font-bold text-slate-800 capitalize">${candidate.seniority}</div>
            <div class="text-xs text-slate-500">Level</div>
          </div>
          <div class="bg-slate-50 rounded-lg p-3 text-center">
            <div class="text-sm font-bold text-slate-800 capitalize">${candidate.nonCompeteRisk}</div>
            <div class="text-xs text-slate-500">Non-compete</div>
          </div>
        </div>
        
        <div class="mb-5 p-4 bg-indigo-50 rounded-xl border border-indigo-200">
          <h3 class="font-bold text-slate-800 mb-2">ğŸ’° Compensation Expectations</h3>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <div class="text-slate-500 mb-1">Salary</div>
              <div class="font-bold text-slate-800">Â£${candidate.salaryExpect.min}k - Â£${candidate.salaryExpect.max}k</div>
              <div class="text-xs text-indigo-600">Ideal: Â£${candidate.salaryExpect.ideal}k</div>
            </div>
            <div>
              <div class="text-slate-500 mb-1">Equity</div>
              <div class="font-bold text-slate-800">${candidate.equityExpect.min}% - ${candidate.equityExpect.max}%</div>
              <div class="text-xs text-indigo-600">Ideal: ${candidate.equityExpect.ideal}%</div>
            </div>
          </div>
        </div>
        
        <div class="mb-5">
          <h3 class="font-bold text-slate-800 mb-2">ğŸ“ Education</h3>
          <p class="text-sm text-slate-600">${candidate.cv.education}</p>
        </div>
        
        <div class="mb-5">
          <h3 class="font-bold text-slate-800 mb-2">ğŸ’¼ Experience</h3>
          ${candidate.cv.experience.map(e => `<div class="text-sm text-slate-600 mb-2 pl-3 border-l-2 border-slate-200">${e}</div>`).join('')}
        </div>
        
        ${candidate.cv.achievements ? `
        <div class="mb-5">
          <h3 class="font-bold text-slate-800 mb-2">ğŸ† Achievements</h3>
          <p class="text-sm text-slate-600">${candidate.cv.achievements}</p>
        </div>
        ` : ''}
        
        ${candidate.cv.skills ? `
        <div class="mb-5">
          <h3 class="font-bold text-slate-800 mb-2">ğŸ› ï¸ Skills</h3>
          <p class="text-sm text-slate-600">${candidate.cv.skills}</p>
        </div>
        ` : ''}
        
        <div class="grid grid-cols-2 gap-4 mb-5">
          <div class="bg-emerald-50 rounded-lg p-3">
            <h4 class="font-bold text-emerald-800 mb-2 text-sm">âœ“ Strengths</h4>
            ${candidate.strengths.map(s => `<div class="text-xs text-emerald-700">${s}</div>`).join('')}
          </div>
          <div class="bg-amber-50 rounded-lg p-3">
            <h4 class="font-bold text-amber-800 mb-2 text-sm">âš  Watch Out</h4>
            ${candidate.weaknesses.map(w => `<div class="text-xs text-amber-700">${w}</div>`).join('')}
          </div>
        </div>
        
        <div class="bg-slate-50 rounded-lg p-3">
          <h4 class="font-bold text-slate-800 mb-1 text-sm">ğŸ§  Personality</h4>
          <p class="text-sm text-slate-600">${candidate.cv.personality}</p>
        </div>
      </div>
      
      <div class="px-6 py-4 border-t border-slate-200 bg-slate-50 rounded-b-2xl flex gap-3">
        <button onclick="game.closeCandidateDetail()" class="flex-1 px-4 py-2.5 border border-slate-300 text-slate-600 rounded-lg hover:bg-white">Back</button>
        <button onclick="game.closeCandidateDetail(); game.startNegotiation('${candidate.id}')" class="flex-1 px-4 py-2.5 bg-indigo-500 hover:bg-indigo-600 text-white font-medium rounded-lg">ğŸ’¼ Make Offer</button>
      </div>
    `;
    
    document.getElementById('candidateDetailModal').classList.remove('hidden');
    document.getElementById('candidateDetailModal').classList.add('flex');
  }
  
  closeCandidateDetail() {
    document.getElementById('candidateDetailModal').classList.add('hidden');
    document.getElementById('candidateDetailModal').classList.remove('flex');
  }
  
  startNegotiation(candidateId) {
    const candidate = this.currentCandidates.find(c => c.id === candidateId);
    if (!candidate) {
      console.error('Candidate not found:', candidateId);
      return;
    }
    
    this.negotiatingCandidate = candidate;
    
    // Get HR recommendation for salary advice (with error handling)
    let hrRec = null;
    try {
      hrRec = this.getHRRecommendation(candidate);
    } catch (e) {
      console.error('Error getting HR recommendation:', e);
    }
    
    const hrLeadName = this.team.hr?.name?.split(' ').pop() || 'HR';
    const hrAdviceSection = hrRec ? `
      <div class="mb-5 p-3 rounded-lg ${hrRec.recommended ? 'bg-amber-50 border border-amber-200' : 'bg-slate-100 border border-slate-200'}">
        <div class="flex items-start gap-2">
          <span class="text-lg flex-shrink-0">ğŸ¤</span>
          <div class="flex-1">
            <div class="text-xs font-medium ${hrRec.recommended ? 'text-amber-800' : 'text-slate-600'} mb-1">
              ${hrLeadName}'s advice:
            </div>
            <p class="text-xs ${hrRec.recommended ? 'text-amber-700' : 'text-slate-500'}">"${hrRec.salaryComment || ''}"</p>
            <div class="mt-1 text-xs ${hrRec.recommended ? 'text-amber-600' : 'text-slate-400'}">
              Suggested: Â£${Math.round(candidate.salaryExpect.ideal * (hrRec.salaryAdvice || 1))}k
            </div>
          </div>
        </div>
      </div>
    ` : '';
    
    const content = document.getElementById('negotiationContent');
    content.innerHTML = `
      <div class="px-6 py-4 border-b border-slate-200 bg-gradient-to-r from-indigo-600 to-violet-600 rounded-t-2xl">
        <h2 class="font-bold text-white text-lg">ğŸ’¼ Make an Offer</h2>
        <p class="text-indigo-100 text-sm">to ${candidate.name}</p>
      </div>
      
      <div class="p-6">
        <div class="bg-slate-50 rounded-lg p-3 mb-5 text-sm">
          <div class="font-medium text-slate-700 mb-1">Their expectations:</div>
          <div class="text-slate-600">ğŸ’· Â£${candidate.salaryExpect.min}k - Â£${candidate.salaryExpect.max}k (ideal: Â£${candidate.salaryExpect.ideal}k)</div>
          <div class="text-slate-600">ğŸ“Š ${candidate.equityExpect.min}% - ${candidate.equityExpect.max}% (ideal: ${candidate.equityExpect.ideal}%)</div>
        </div>
        
        ${hrAdviceSection}
        
        <div class="mb-5">
          <label class="block text-sm font-bold text-slate-700 mb-2">ğŸ’· Salary Offer</label>
          <div class="flex items-center gap-4">
            <input type="range" id="offerSalary" min="35" max="160" value="${candidate.salaryExpect.ideal}" class="flex-1" oninput="game.updateOfferPreview()">
            <div class="font-mono font-bold text-lg text-slate-800 w-20">Â£<span id="offerSalaryDisplay">${candidate.salaryExpect.ideal}</span>k</div>
          </div>
          <div class="text-xs text-slate-500 mt-1">Quarterly burn: +Â£<span id="offerQuarterlyCost">${Math.round(candidate.salaryExpect.ideal/4)}</span>k</div>
        </div>
        
        <div class="mb-5">
          <label class="block text-sm font-bold text-slate-700 mb-2">ğŸ“Š Equity Offer</label>
          <div class="flex items-center gap-4">
            <input type="range" id="offerEquity" min="0" max="4" step="0.25" value="${candidate.equityExpect.ideal}" class="flex-1" oninput="game.updateOfferPreview()">
            <div class="font-mono font-bold text-lg text-slate-800 w-16"><span id="offerEquityDisplay">${candidate.equityExpect.ideal}</span>%</div>
          </div>
        </div>
        
        <div id="offerAssessment" class="mb-5 p-4 rounded-lg bg-blue-50 border border-blue-200">
          <div class="flex items-center gap-2 mb-2">
            <span class="text-xl">ğŸ¤”</span>
            <span class="font-medium text-blue-800">Assessing...</span>
          </div>
        </div>
        
        <div class="p-3 bg-slate-50 rounded-lg text-sm">
          <div class="flex items-center justify-between">
            <span class="text-slate-600">ğŸ“… Start date:</span>
            <span class="font-medium text-slate-800">${candidate.availability === 'immediate' ? 'Next quarter' : candidate.availability === '1 month' ? 'Next quarter' : 'In 2 quarters'}</span>
          </div>
          <div class="flex items-center justify-between mt-2 pt-2 border-t border-slate-200">
            <span class="text-amber-600">ğŸ“‰ Your equity after:</span>
            <span id="offerDilutionPreview" class="font-medium text-amber-700">${this.metrics.equity.toFixed(1)}% â†’ ${(this.metrics.equity - candidate.equityExpect.ideal).toFixed(1)}%</span>
          </div>
          ${candidate.nonCompeteRisk !== 'none' ? `
          <div class="flex items-center justify-between mt-2 pt-2 border-t border-slate-200">
            <span class="text-amber-600">âš–ï¸ Non-compete:</span>
            <span class="font-medium text-amber-700">${candidate.nonCompeteRisk === 'high' ? 'May delay start' : 'Unlikely issue'}</span>
          </div>
          ` : ''}
        </div>
      </div>
      
      <div class="px-6 py-4 border-t border-slate-200 bg-slate-50 rounded-b-2xl flex gap-3">
        <button onclick="game.closeNegotiation()" class="flex-1 px-4 py-2.5 border border-slate-300 text-slate-600 rounded-lg hover:bg-white">Cancel</button>
        <button onclick="game.submitOffer()" class="flex-1 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg">ğŸ“¤ Send Offer</button>
      </div>
    `;
    
    this.updateOfferPreview();
    
    document.getElementById('negotiationModal').classList.remove('hidden');
    document.getElementById('negotiationModal').classList.add('flex');
  }
  
  updateOfferPreview() {
    const salary = parseInt(document.getElementById('offerSalary').value);
    const equity = parseFloat(document.getElementById('offerEquity').value);
    const candidate = this.negotiatingCandidate;
    
    document.getElementById('offerSalaryDisplay').textContent = salary;
    document.getElementById('offerEquityDisplay').textContent = equity.toFixed(2);
    document.getElementById('offerQuarterlyCost').textContent = Math.round(salary / 4);
    
    // Update dilution preview
    const dilutionEl = document.getElementById('offerDilutionPreview');
    if (dilutionEl) {
      const newEquity = this.metrics.equity - equity;
      dilutionEl.textContent = `${this.metrics.equity.toFixed(1)}% â†’ ${newEquity.toFixed(1)}%`;
    }
    
    // Assess offer
    const salaryScore = salary >= candidate.salaryExpect.ideal ? 1 : salary >= candidate.salaryExpect.min ? 0.5 : 0;
    const equityScore = equity >= candidate.equityExpect.ideal ? 1 : equity >= candidate.equityExpect.min ? 0.5 : 0;
    const interest = candidate.adjustedInterest || candidate.interest;
    const finalScore = (salaryScore + equityScore) / 2 * 0.7 + interest * 0.3;
    
    const assessment = document.getElementById('offerAssessment');
    
    if (finalScore >= 0.85) {
      assessment.className = 'mb-5 p-4 rounded-lg bg-emerald-50 border border-emerald-200';
      assessment.innerHTML = `<div class="flex items-center gap-2 mb-1"><span class="text-xl">ğŸ‰</span><span class="font-medium text-emerald-800">Very likely to accept!</span></div><p class="text-sm text-emerald-700">This exceeds their expectations.</p>`;
    } else if (finalScore >= 0.6) {
      assessment.className = 'mb-5 p-4 rounded-lg bg-blue-50 border border-blue-200';
      assessment.innerHTML = `<div class="flex items-center gap-2 mb-1"><span class="text-xl">ğŸ¤”</span><span class="font-medium text-blue-800">Likely to consider</span></div><p class="text-sm text-blue-700">Reasonable offer. May accept or negotiate.</p>`;
    } else if (finalScore >= 0.35) {
      assessment.className = 'mb-5 p-4 rounded-lg bg-amber-50 border border-amber-200';
      assessment.innerHTML = `<div class="flex items-center gap-2 mb-1"><span class="text-xl">ğŸ˜¬</span><span class="font-medium text-amber-800">Below expectations</span></div><p class="text-sm text-amber-700">Expect counter-offer or decline.</p>`;
    } else {
      assessment.className = 'mb-5 p-4 rounded-lg bg-red-50 border border-red-200';
      assessment.innerHTML = `<div class="flex items-center gap-2 mb-1"><span class="text-xl">âŒ</span><span class="font-medium text-red-800">Likely to decline</span></div><p class="text-sm text-red-700">Well below their minimum.</p>`;
    }
  }
  
  closeNegotiation() {
    document.getElementById('negotiationModal').classList.add('hidden');
    document.getElementById('negotiationModal').classList.remove('flex');
  }
  
  submitOffer() {
    const salaryEl = document.getElementById('offerSalary');
    const equityEl = document.getElementById('offerEquity');
    
    if (!salaryEl || !equityEl) {
      console.error('Offer inputs not found');
      return;
    }
    
    const salary = parseInt(salaryEl.value);
    const equity = parseFloat(equityEl.value);
    const candidate = this.negotiatingCandidate;
    
    if (!candidate) {
      console.error('No candidate being negotiated');
      return;
    }
    
    if (!candidate.salaryExpect || !candidate.equityExpect) {
      console.error('Candidate missing salary/equity expectations');
      return;
    }
    
    // Calculate acceptance
    const salaryScore = salary >= candidate.salaryExpect.ideal ? 1 : salary >= candidate.salaryExpect.min ? 0.6 : 0.2;
    const equityScore = equity >= candidate.equityExpect.ideal ? 1 : equity >= candidate.equityExpect.min ? 0.6 : 0.2;
    const interest = candidate.adjustedInterest || candidate.interest || 0.5;
    const acceptChance = (salaryScore * 0.4 + equityScore * 0.3 + interest * 0.3);
    
    const roll = Math.random();
    
    if (roll < acceptChance * 0.9) {
      this.hireCandidate(candidate, salary, equity);
    } else if (roll < acceptChance * 0.9 + 0.3) {
      this.showCounterOffer(candidate, salary, equity);
    } else {
      this.showDecline(candidate);
    }
  }
  
  hireCandidate(candidate, salary, equity) {
    try {
      // Check if this hire would result in negative equity
      const resultingEquity = this.metrics.equity - equity;
      if (resultingEquity < 0) {
        this.showHiringEquityWarning(candidate, equity);
        return;
      }
      
      // Track hires this quarter (for hiring limits)
      this.hiresThisQuarter = (this.hiresThisQuarter || 0) + 1;
      
      // Track integrating staff - they don't give AP bonus until next quarter
      this.integratingStaff = (this.integratingStaff || 0) + 1;
      
      // Add to hired staff with turn tracking for onboarding
      // AP cost is calculated from this array in getUsedAP()
      this.hiredStaff = this.hiredStaff || [];
      const hiredRole = this.currentJobPosting?.role || 'product';
      this.hiredStaff.push({ ...candidate, role: hiredRole, salary, equity, hiredTurn: this.turn });
      
      // Update metrics
      this.metrics.burn += Math.round(salary / 4);
      const previousEquity = this.metrics.equity;
      this.metrics.equity -= equity;
      this.metrics.staff += 1;
      
      // Track equity grant for cap table
      this.equityGrants = this.equityGrants || [];
      this.equityGrants.push({
        name: candidate.name,
        role: (candidate.seniority || 'new') + ' hire',
        equity: equity,
        vestingYears: 4,
        cliff: 1,
        grantedQuarter: this.turn
      });
      
      // Track department disruption - new hires temporarily reduce team effectiveness
      // as colleagues spend time onboarding them
      this.hiringDisruption = this.hiringDisruption || {};
      const dept = candidate.id.startsWith('r') ? 'research' :
                   candidate.id.startsWith('p') ? 'dev' :
                   candidate.id.startsWith('m') ? 'marketing' :
                   candidate.id.startsWith('h') ? 'hr' : null;
      if (dept) {
        // Disruption lasts 2 quarters, stacks if hiring multiple people
        this.hiringDisruption[dept] = (this.hiringDisruption[dept] || 0) + 2;
      }
      
      // NO IMMEDIATE STAT BONUS - new hires take time to become productive
      // Their skills contribute gradually through the onboarding system
      
      // If this is a People hire, make them the HR lead (enables HR recommendations)
      if (candidate.id.startsWith('h') && !this.team.hr) {
        this.team.hr = {
          id: candidate.id,
          name: candidate.name,
          title: `${(candidate.seniority || 'new').charAt(0).toUpperCase() + (candidate.seniority || 'new').slice(1)} People Lead`,
          avatar: null, // No SVG avatar for hired staff
          portrait: candidate.portrait,
          personality: candidate.cv?.personality || '',
          wage: Math.round(salary / 4),
          equity: equity,
          bonus: candidate.statBonus || { hr: 3 },
          quote: candidate.quote,
          cv: candidate.cv
        };
        this.moods.hr = 1; // Starting mood
        this.log(`ğŸ‰ ${candidate.name} is now your Head of People! (${equity}% equity, your stake: ${previousEquity.toFixed(1)}% â†’ ${this.metrics.equity.toFixed(1)}%) (-1 AP)`);
      } else {
        this.log(`ğŸ‰ ${candidate.name} joined! Â£${salary}k/yr + ${equity}% equity. Your stake: ${previousEquity.toFixed(1)}% â†’ ${this.metrics.equity.toFixed(1)}% (-1 AP)`);
      }
      
      soundManager.playFunding(); // Success sound for hiring
      
      // Show success with dilution info
      const content = document.getElementById('negotiationContent');
      const isHRHire = candidate.id.startsWith('h') && this.team.hr?.id === candidate.id;
      const isHRSupport = candidate.id.startsWith('h') && this.team.hr && this.team.hr.id !== candidate.id;
      
      let hrSkill = 0;
      try {
        hrSkill = this.getHRSkillLevel();
      } catch (e) {
        console.error('Error getting HR skill level:', e);
      }
      
      const hasHRBonus = hrSkill > 0 && !isHRHire && !isHRSupport && this.team.hr;
      const hrLeadName = this.team.hr?.name?.split(' ').pop() || 'HR';
      
      content.innerHTML = `
        <div class="p-8 text-center">
          <div class="text-6xl mb-4">${isHRHire ? 'ğŸ¤' : 'ğŸ‰'}</div>
          <h2 class="text-2xl font-bold text-slate-800 mb-2">Offer Accepted!</h2>
          <p class="text-slate-600 mb-4">${candidate.name} is joining your team${isHRHire ? ' as Head of People' : ''}!</p>
          <div class="bg-emerald-50 rounded-lg p-4 mb-4 text-left">
            <div class="flex justify-between mb-2"><span class="text-slate-600">Salary:</span><span class="font-bold text-slate-800">Â£${salary}k/year (+Â£${Math.round(salary/4)}k/q burn)</span></div>
            <div class="flex justify-between mb-2"><span class="text-slate-600">Equity granted:</span><span class="font-bold text-slate-800">${equity}%</span></div>
            <div class="flex justify-between"><span class="text-slate-600">Start:</span><span class="font-bold text-slate-800">${candidate.availability === 'immediate' ? 'Next quarter' : candidate.availability || 'Next quarter'}</span></div>
          </div>
          <div class="bg-amber-50 rounded-lg p-3 mb-3 text-sm text-amber-700 border border-amber-200">
            ğŸ“‰ <strong>Dilution:</strong> Your equity ${previousEquity.toFixed(1)}% â†’ ${this.metrics.equity.toFixed(1)}%
          </div>
          <div class="bg-rose-50 rounded-lg p-3 mb-3 text-sm text-rose-700 border border-rose-200">
            âš¡ <strong>AP Spent:</strong> -1 AP this quarter for hiring
          </div>
          <div class="bg-slate-50 rounded-lg p-3 ${(hasHRBonus || isHRSupport) ? 'mb-3' : 'mb-6'} text-sm text-slate-600 border border-slate-200">
            â³ <strong>Onboarding:</strong> New hires take time to reach full productivity. Team temporarily disrupted.
          </div>
          ${hasHRBonus ? `
          <div class="bg-emerald-50 rounded-lg p-3 mb-6 text-sm text-emerald-700 border border-emerald-200">
            ğŸ¤ <strong>${hrLeadName} helps:</strong> Faster onboarding, less team disruption
          </div>
          ` : ''}
          ${isHRSupport ? `
          <div class="bg-violet-50 rounded-lg p-3 mb-6 text-sm text-violet-700 border border-violet-200">
            ğŸ‘¥ <strong>HR team grows:</strong> ${candidate.name.split(' ').pop()} will support ${hrLeadName}, modestly improving onboarding across the company (diminishing returns apply).
          </div>
          ` : ''}
          ${isHRHire ? `
          <div class="bg-indigo-50 rounded-lg p-3 mb-6 text-sm text-indigo-700 border border-indigo-200">
            ğŸ’¡ <strong>New ability unlocked:</strong> ${candidate.name.split(' ').pop()} will review candidates, speed up onboarding, and reduce hiring disruption.
          </div>
          ` : ''}
          <button onclick="game.closeNegotiation(); game.closeCandidatesModal(); game.update(); game.renderBoardroom();" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg">Continue</button>
        </div>
      `;
    } catch (error) {
      console.error('Error in hireCandidate:', error);
      alert('Error hiring candidate: ' + error.message);
    }
  }
  
  showCounterOffer(candidate, originalSalary, originalEquity) {
    const counterSalary = Math.min(candidate.salaryExpect.max, Math.round(candidate.salaryExpect.ideal * 1.05));
    const counterEquity = Math.min(candidate.equityExpect.max, candidate.equityExpect.ideal * 1.1);
    
    const content = document.getElementById('negotiationContent');
    content.innerHTML = `
      <div class="px-6 py-4 border-b border-slate-200 bg-gradient-to-r from-amber-500 to-orange-500 rounded-t-2xl">
        <h2 class="font-bold text-white text-lg">ğŸ’¬ Counter-Offer</h2>
        <p class="text-amber-100 text-sm">from ${candidate.name}</p>
      </div>
      
      <div class="p-6">
        <div class="flex items-center gap-4 mb-6">
          <div class="text-5xl">${candidate.portrait}</div>
          <div class="flex-1 bg-slate-50 rounded-lg p-4">
            <p class="text-slate-700 italic">"I appreciate the offer, but I was hoping for Â£${counterSalary}k with ${counterEquity.toFixed(1)}% equity."</p>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4 mb-6">
          <div class="bg-slate-50 rounded-lg p-4">
            <div class="text-sm text-slate-500 mb-1">Your offer</div>
            <div class="font-bold text-slate-800">Â£${originalSalary}k + ${originalEquity}%</div>
          </div>
          <div class="bg-amber-50 rounded-lg p-4">
            <div class="text-sm text-amber-600 mb-1">Their counter</div>
            <div class="font-bold text-amber-800">Â£${counterSalary}k + ${counterEquity.toFixed(1)}%</div>
          </div>
        </div>
      </div>
      
      <div class="px-6 py-4 border-t border-slate-200 bg-slate-50 rounded-b-2xl flex gap-3">
        <button onclick="game.rejectCounter()" class="flex-1 px-4 py-2.5 border border-slate-300 text-slate-600 rounded-lg hover:bg-white">Decline</button>
        <button onclick="game.acceptCounter(${counterSalary}, ${counterEquity})" class="flex-1 px-4 py-2.5 bg-amber-500 hover:bg-amber-600 text-white font-medium rounded-lg">Accept Counter</button>
      </div>
    `;
  }
  
  acceptCounter(salary, equity) {
    this.hireCandidate(this.negotiatingCandidate, salary, equity);
  }
  
  rejectCounter() {
    const content = document.getElementById('negotiationContent');
    content.innerHTML = `
      <div class="p-8 text-center">
        <div class="text-6xl mb-4">ğŸ¤</div>
        <h2 class="text-xl font-bold text-slate-800 mb-2">Negotiation Ended</h2>
        <p class="text-slate-600 mb-6">${this.negotiatingCandidate.name} will consider other opportunities.</p>
        <button onclick="game.closeNegotiation()" class="px-6 py-3 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg">Continue</button>
      </div>
    `;
  }
  
  showDecline(candidate) {
    const content = document.getElementById('negotiationContent');
    content.innerHTML = `
      <div class="p-8 text-center">
        <div class="text-6xl mb-4">ğŸ˜”</div>
        <h2 class="text-xl font-bold text-slate-800 mb-2">Offer Declined</h2>
        <div class="flex items-center gap-4 mb-6 justify-center">
          <div class="text-4xl">${candidate.portrait}</div>
          <div class="bg-slate-50 rounded-lg p-4 text-left max-w-xs">
            <p class="text-slate-700 italic">"Thanks, but this isn't quite the right fit for me right now."</p>
          </div>
        </div>
        <button onclick="game.closeNegotiation()" class="px-6 py-3 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg">Continue</button>
      </div>
    `;
  }
  
  // ===== END JOB POSTING SYSTEM =====

  showFireStaffModal() {
    const modal = document.getElementById("fireStaffModal");
    const severanceCost = 40;
    
    // Reset selection
    this.selectedFireStaffId = null;
    
    // Populate staff list (only hired staff, not department heads)
    const staffList = document.getElementById("fireStaffList");
    const noStaffMsg = document.getElementById("fireNoStaffMsg");
    const afterSection = document.getElementById("fireAfterSection");
    
    const hiredStaff = this.hiredStaff || [];
    
    if (hiredStaff.length === 0) {
      staffList.innerHTML = '';
      staffList.classList.add('hidden');
      noStaffMsg.classList.remove('hidden');
      afterSection.classList.add('hidden');
      document.getElementById("confirmFireBtn").disabled = true;
    } else {
      staffList.classList.remove('hidden');
      noStaffMsg.classList.add('hidden');
      afterSection.classList.remove('hidden');
      
      const roleLabels = { research: 'Research', product: 'Product', marketing: 'Marketing', people: 'People' };
      const roleColors = {
        research: 'bg-blue-50 border-blue-200 hover:bg-blue-100',
        product: 'bg-emerald-50 border-emerald-200 hover:bg-emerald-100',
        marketing: 'bg-amber-50 border-amber-200 hover:bg-amber-100',
        people: 'bg-violet-50 border-violet-200 hover:bg-violet-100'
      };
      
      const statNames = { sci: 'Sci', dev: 'Dev', mkt: 'Mkt', hr: 'HR' };
      
      staffList.innerHTML = hiredStaff.map(staff => {
        const role = staff.role || 'product';
        const colors = roleColors[role] || roleColors.product;
        const skillsText = staff.statBonus 
          ? Object.entries(staff.statBonus).map(([s, v]) => `${statNames[s] || s}+${v}`).join(' ')
          : '';
        return `
          <button onclick="game.selectFireStaff('${staff.id}')" 
                  id="fireStaff_${staff.id}"
                  class="w-full p-3 rounded-lg border-2 ${colors} text-left transition-all">
            <div class="flex items-center gap-3">
              <span class="text-2xl">${staff.portrait || 'ğŸ‘¤'}</span>
              <div class="flex-1">
                <div class="font-medium text-slate-800">${staff.name}</div>
                <div class="text-xs text-slate-500">${staff.seniority} ${roleLabels[role] || role} Â· Â£${staff.salary || 50}k/year Â· Hired Q${staff.hiredTurn || '?'}</div>
                ${skillsText ? `<div class="text-xs text-slate-400 mt-0.5">Skills: ${skillsText}</div>` : ''}
              </div>
              <div class="text-slate-400" id="fireCheck_${staff.id}">â—‹</div>
            </div>
          </button>
        `;
      }).join('');
      
      document.getElementById("confirmFireBtn").disabled = true; // Must select someone first
    }
    
    // Update current stats
    document.getElementById("fireModalStaff").textContent = this.metrics.staff;
    document.getElementById("fireModalAPCurrent").textContent = `+${this.getStaffAPBonus()}`;
    document.getElementById("fireModalCash").textContent = `Â£${this.metrics.cash}k`;
    document.getElementById("fireModalBurn").textContent = `Â£${this.metrics.burn}k/q`;
    
    // Initial after-fire stats (will update when staff selected)
    const newStaff = Math.max(0, this.metrics.staff - 1);
    const avgBurnDecrease = 12; // Rough average for display before selection
    const newBurn = Math.max(0, this.metrics.burn - avgBurnDecrease);
    const newCash = this.metrics.cash - severanceCost;
    const newAPBonus = this.calculateStaffAPBonus(newStaff);
    
    document.getElementById("fireModalNewStaff").textContent = newStaff;
    document.getElementById("fireModalAPNew").textContent = `+${newAPBonus}`;
    document.getElementById("fireModalNewBurn").textContent = `Â£${newBurn}k/q`;
    document.getElementById("fireModalNewCash").textContent = `Â£${newCash}k`;
    
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  }
  
  selectFireStaff(staffId) {
    // Deselect previous
    if (this.selectedFireStaffId) {
      const prevBtn = document.getElementById(`fireStaff_${this.selectedFireStaffId}`);
      const prevCheck = document.getElementById(`fireCheck_${this.selectedFireStaffId}`);
      if (prevBtn) prevBtn.classList.remove('ring-2', 'ring-rose-500');
      if (prevCheck) prevCheck.innerHTML = 'â—‹';
    }
    
    // Select new
    this.selectedFireStaffId = staffId;
    const btn = document.getElementById(`fireStaff_${staffId}`);
    const check = document.getElementById(`fireCheck_${staffId}`);
    if (btn) btn.classList.add('ring-2', 'ring-rose-500');
    if (check) check.innerHTML = '<span class="text-rose-500 font-bold">â—</span>';
    
    // Update after-fire stats based on selected person's actual salary
    const staff = (this.hiredStaff || []).find(s => s.id === staffId);
    if (staff) {
      const severanceCost = 40;
      const actualBurnDecrease = Math.round((staff.salary || 50) / 4);
      const newStaff = Math.max(0, this.metrics.staff - 1);
      const newBurn = Math.max(0, this.metrics.burn - actualBurnDecrease);
      const newCash = this.metrics.cash - severanceCost;
      const newAPBonus = this.calculateStaffAPBonus(newStaff);
      
      document.getElementById("fireModalNewStaff").textContent = newStaff;
      document.getElementById("fireModalAPNew").textContent = `+${newAPBonus}`;
      document.getElementById("fireModalNewBurn").textContent = `Â£${newBurn}k/q`;
      document.getElementById("fireModalNewCash").textContent = `Â£${newCash}k`;
    }
    
    // Enable confirm button
    const canFire = this.metrics.cash >= 40;
    document.getElementById("confirmFireBtn").disabled = !canFire;
  }
  
  closeFireStaffModal() {
    document.getElementById("fireStaffModal").classList.add("hidden");
    document.getElementById("fireStaffModal").classList.remove("flex");
  }
  
  confirmFireStaff() {
    const severanceCost = 40;
    
    // Must have selected someone
    if (!this.selectedFireStaffId) return;
    
    // Find the staff member
    const staffIndex = (this.hiredStaff || []).findIndex(s => s.id === this.selectedFireStaffId);
    if (staffIndex === -1) return;
    
    const firedStaff = this.hiredStaff[staffIndex];
    
    if (this.metrics.cash < severanceCost) return;
    
    // Calculate burn decrease from their actual salary
    const actualBurnDecrease = Math.round((firedStaff.salary || 50) / 4);
    
    // Calculate values before layoff for logging
    const apBefore = this.getStaffAPBonus();
    const burnBefore = this.metrics.burn;
    
    // Remove from hiredStaff array (this stops their stat contributions)
    this.hiredStaff.splice(staffIndex, 1);
    
    // If this person was the HR lead, remove them
    if (this.team.hr && this.team.hr.id === firedStaff.id) {
      this.team.hr = null;
      this.log(`âš ï¸ ${firedStaff.name} was your HR lead. HR recommendations disabled until you hire a new People lead.`);
    }
    
    // Apply costs - use ACTUAL salary for burn reduction
    this.metrics.cash -= severanceCost;
    this.metrics.burn = Math.max(0, this.metrics.burn - actualBurnDecrease);
    this.metrics.staff -= 1;
    
    // If we had integrating staff, reduce that first
    if (this.integratingStaff > 0) {
      this.integratingStaff -= 1;
    }
    
    // Layoff disruption: -1 AP this quarter (reorganization, knowledge loss)
    this.staffAPPenalty = Math.min(this.staffAPPenalty + 1, 2); // Max -2 AP penalty
    
    // Calculate AP after layoff
    const apAfter = this.getStaffAPBonus();
    const apLost = apBefore - apAfter;
    
    // Morale hit from layoffs
    Object.keys(this.moods).forEach(dept => {
      if (this.team[dept]) {
        this.moods[dept] = Math.max(-3, this.moods[dept] - 1);
      }
    });
    
    // Build detailed log message
    let logMsg = `ğŸ“‰ Laid off ${firedStaff.name}. Severance: -Â£${severanceCost}k. Burn: Â£${burnBefore}k â†’ Â£${this.metrics.burn}k/q.`;
    if (firedStaff.statBonus) {
      const statNames = { sci: 'Science', dev: 'Product', mkt: 'Marketing', hr: 'HR' };
      const lostStats = Object.entries(firedStaff.statBonus)
        .map(([stat, val]) => `${statNames[stat] || stat} -${val}`)
        .join(', ');
      logMsg += ` Lost skills: ${lostStats}.`;
    }
    if (apLost > 0) {
      logMsg += ` AP tier dropped (-${apLost}).`;
    }
    logMsg += ` Team disrupted (-1 AP this Q).`;
    this.log(logMsg);
    
    soundManager.playWarning();
    
    // Clear selection
    this.selectedFireStaffId = null;
    
    this.closeFireStaffModal();
    this.update();
    this.renderBoardroom();
    this.renderHiredStaffSection();
  }
  
  calculateStaffAPBonus(staffCount) {
    // Calculate what AP bonus would be for a given total staff count
    // Only staff HIRED (above starting team) count toward bonus
    const startingStaff = this.startingStaff || 0;
    const hiredStaff = Math.max(0, staffCount - startingStaff);
    
    if (hiredStaff >= 5) return 3;
    if (hiredStaff >= 3) return 2;
    if (hiredStaff >= 1) return 1;
    return 0;
  }
  
  toggleStaffInfo() {
    const panel = document.getElementById("staffInfoPanel");
    panel.classList.toggle("hidden");
  }

  completeMilestone() {
    // Play milestone complete sound
    soundManager.playMilestoneComplete();
    
    this.completedMilestones.push(this.milestone.id);
    this.lastMilestoneCompletedTurn = this.turn; // Track when milestone was completed for funding terms
    
    // Store milestone info for display before clearing
    const completedMilestone = { ...this.milestone };
    const milestoneNum = this.completedMilestones.length; // 1, 2, or 3
    
    // === INVESTOR RELATIONSHIP: Meeting targets improves relationship ===
    this.updateInvestorRelationship(1, "completed milestone");
    
    // Check for first-mover bonus
    const firstMoverBonus = this.checkFirstMoverBonus();
    
    // Log journey event for milestone completion
    this.logJourneyEvent('milestone', {
      name: completedMilestone.name,
      description: completedMilestone.desc,
      difficulty: completedMilestone.difficulty,
      milestoneNumber: milestoneNum,
      quarterCompleted: this.turn,
      firstMover: firstMoverBonus.isFirst
    });
    
    // Track milestone completion with Google Analytics
    if (typeof trackGameEvent === 'function') {
      trackGameEvent('milestone_completed', {
        milestone_number: milestoneNum,
        milestone_id: completedMilestone.id,
        milestone_name: completedMilestone.name,
        quarters_taken: this.turn,
        cash_remaining: this.metrics.cash
      });
    }
    
    // === NEW REWARD SYSTEM ===
    // Valuation still increases (proving milestones boosts investor confidence)
    let valReward = completedMilestone.reward?.val || 400;
    
    // Apply first-mover bonus or follower penalty to valuation
    if (firstMoverBonus.isFirst) {
      valReward = Math.round(valReward * 1.25);
    } else if (firstMoverBonus.isFollower) {
      valReward = Math.round(valReward * 0.85);
    }
    this.metrics.val += valReward;
    
    // === PIPELINE INJECTION (Option H) ===
    // Milestone completion attracts qualified leads
    const pipelineBoost = this.getMilestonePipelineBoost(milestoneNum, completedMilestone.difficulty);
    if (this.revenueModel && pipelineBoost.deals > 0) {
      for (let i = 0; i < pipelineBoost.deals; i++) {
        this.pipeline.push({
          id: `milestone_${milestoneNum}_${i}`,
          name: this.generateLeadName(),
          type: pipelineBoost.dealType,
          value: pipelineBoost.avgValue,
          stage: 'qualified', // Already qualified - milestone credibility
          probability: 0.6 + (milestoneNum * 0.1), // Higher close rate from credibility
          closeQuarter: this.turn + 1 + Math.floor(Math.random() * 2),
          source: 'milestone'
        });
      }
    }
    
    // === PERMANENT MODIFIERS (Option E) ===
    // Initialize modifier tracking if needed
    if (!this.milestoneModifiers) {
      this.milestoneModifiers = {
        churnReduction: 0,      // Cumulative % reduction in churn
        closeRateBonus: 0,      // Cumulative % increase in close rate
        acvMultiplier: 1.0,     // Multiplier for deal values
        hiringQuality: 0        // Bonus to candidate quality
      };
    }
    
    // Apply permanent improvements based on milestone number
    const modifiers = this.getMilestoneModifiers(milestoneNum, completedMilestone.difficulty);
    this.milestoneModifiers.churnReduction += modifiers.churnReduction;
    this.milestoneModifiers.closeRateBonus += modifiers.closeRateBonus;
    this.milestoneModifiers.acvMultiplier *= modifiers.acvMultiplier;
    this.milestoneModifiers.hiringQuality += modifiers.hiringQuality;
    
    // Milestone completion unlocks ability to raise (milestone-based funding)
    
    // Show celebration transition, then the achievement modal
    const diffLabel = completedMilestone.difficulty === "ambitious" ? "ğŸ”¥ Ambitious" : 
                      completedMilestone.difficulty === "balanced" ? "âš– Balanced" : "ğŸ›¡ Conservative";
    
    let bonusText = '';
    if (firstMoverBonus.isFirst) {
      bonusText = ` ğŸ† First-mover bonus: +25% valuation!`;
      this.log(`ğŸ† First to market! You beat ${firstMoverBonus.rivalCount} rival(s) to this milestone.`);
    } else if (firstMoverBonus.isFollower && firstMoverBonus.firstRival) {
      bonusText = ` (${firstMoverBonus.firstRival.name} got there first)`;
    }
    
    // Build reward text - qualitative, not numerical
    let rewardText = `+Â£${valReward}k valuation`;
    
    // Qualitative descriptions based on milestone stage
    const qualitativeRewards = {
      1: {
        pipeline: 'Early adopters are reaching out',
        modifier: 'Your credibility is growing'
      },
      2: {
        pipeline: 'Real customers want to talk',
        modifier: 'Sales conversations are getting easier'
      },
      3: {
        pipeline: 'Enterprise buyers are interested',
        modifier: 'You\'re now a trusted vendor'
      }
    };
    
    const rewards = qualitativeRewards[milestoneNum] || qualitativeRewards[1];
    
    if (pipelineBoost.deals > 0) {
      rewardText += `. ${rewards.pipeline}`;
    }
    rewardText += ` â€” ${rewards.modifier}.`;
    
    // Clear current milestone so UI doesn't show old progress bar
    this.milestone = null;
    this.milestoneProgress = 0;
    
    this.showQuarterTransition(() => {
      document.getElementById("achievedText").textContent = `${diffLabel} milestone complete: ${completedMilestone.name}! ${rewardText}${bonusText} ğŸ’° New funding round unlocked!`;
      document.getElementById("achievedModal").classList.remove("hidden");
      document.getElementById("achievedModal").classList.add("flex");
    }, true); // true = celebration scene
  }
  
  getMilestonePipelineBoost(milestoneNum, difficulty) {
    // Deal counts and types based on milestone progression
    const baseDeals = {
      1: { deals: 3, dealType: 'early_adopter', avgValue: 5 },   // M1: validation customers
      2: { deals: 5, dealType: 'smb', avgValue: 15 },            // M2: real SMB customers
      3: { deals: 4, dealType: 'enterprise', avgValue: 50 }      // M3: enterprise logos
    };
    
    const boost = baseDeals[milestoneNum] || baseDeals[1];
    
    // Difficulty multiplier
    if (difficulty === 'ambitious') {
      boost.deals += 2;
      boost.avgValue = Math.round(boost.avgValue * 1.3);
    } else if (difficulty === 'conservative') {
      boost.deals -= 1;
      boost.avgValue = Math.round(boost.avgValue * 0.8);
    }
    
    return boost;
  }
  
  getMilestoneModifiers(milestoneNum, difficulty) {
    // Base modifiers per milestone
    const baseModifiers = {
      1: { churnReduction: 0.10, closeRateBonus: 0.05, acvMultiplier: 1.0, hiringQuality: 5 },
      2: { churnReduction: 0.15, closeRateBonus: 0.10, acvMultiplier: 1.1, hiringQuality: 10 },
      3: { churnReduction: 0.10, closeRateBonus: 0.15, acvMultiplier: 1.2, hiringQuality: 15 }
    };
    
    const mods = { ...baseModifiers[milestoneNum] } || { ...baseModifiers[1] };
    
    // Difficulty scaling
    if (difficulty === 'ambitious') {
      mods.churnReduction *= 1.3;
      mods.closeRateBonus *= 1.3;
      mods.hiringQuality += 5;
    } else if (difficulty === 'conservative') {
      mods.churnReduction *= 0.7;
      mods.closeRateBonus *= 0.7;
      mods.hiringQuality -= 3;
    }
    
    return mods;
  }
  
  generateLeadName() {
    const prefixes = ['Acme', 'Nova', 'Apex', 'Vertex', 'Prime', 'Atlas', 'Zenith', 'Pulse', 'Core', 'Nexus'];
    const suffixes = ['Corp', 'Inc', 'Ltd', 'Group', 'Systems', 'Solutions', 'Tech', 'Global', 'Partners', 'Health'];
    return `${prefixes[Math.floor(Math.random() * prefixes.length)]} ${suffixes[Math.floor(Math.random() * suffixes.length)]}`;
  }
  
  checkFirstMoverBonus() {
    const milestoneNumber = this.completedMilestones.length;
    const activeRivals = this.rivals.filter(r => r.status === "active");
    
    if (activeRivals.length === 0) {
      return { isFirst: true, isFollower: false, rivalCount: 0 };
    }
    
    // Check how many rivals have completed this many or more milestones
    const rivalsAhead = activeRivals.filter(r => {
      const completedCount = r.milestones?.filter(m => m.status === "complete").length || 0;
      return completedCount >= milestoneNumber;
    });
    
    if (rivalsAhead.length === 0) {
      // You're first! Count rivals you beat
      const rivalsBehind = activeRivals.filter(r => {
        const completedCount = r.milestones?.filter(m => m.status === "complete").length || 0;
        return completedCount < milestoneNumber;
      });
      return { isFirst: true, isFollower: false, rivalCount: rivalsBehind.length };
    } else {
      // Someone beat you
      return { 
        isFirst: false, 
        isFollower: true, 
        firstRival: rivalsAhead[0],
        rivalCount: rivalsAhead.length 
      };
    }
  }

  onMilestoneAchieved() {
    document.getElementById("achievedModal").classList.add("hidden");
    
    console.log("onMilestoneAchieved called:", {
      completedMilestonesLength: this.completedMilestones.length,
      completedMilestones: this.completedMilestones,
      hasHR: !!this.team.hr
    });
    
    // HR hire after M1
    if (this.completedMilestones.length === 1 && !this.team.hr) {
      console.log("Showing HR modal");
      this.showHRModal();
      return;
    }
    
    // Check if all milestones complete (3 total)
    if (this.completedMilestones.length >= 3) {
      console.log("All milestones complete - ending game");
      this.endGame("allMilestones");
      return;
    }
    
    // Show next milestone selection (M2 or M3)
    console.log("Showing milestone modal for next milestone");
    this.showMilestoneModal();
  }

  showHRModal() {
    const container = document.getElementById("hrHires");
    const salaryMod = this.location ? (1 + this.location.salaryMod) : 1;
    
    container.innerHTML = HR_EXECS.map(e => {
      const adjustedWage = Math.round(e.wage * salaryMod);
      return `
      <div data-id="${e.id}" class="hire-card border-2 border-slate-200 rounded-xl bg-white hover:border-amber-400 hover:shadow-lg transition-all flex flex-col overflow-hidden">
        <!-- Photo + Name Header -->
        <div class="p-4 pb-3">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-14 h-14 rounded-full border-2 border-amber-300 overflow-hidden flex-shrink-0">
              ${renderAvatar(e.avatar, e.name)}
            </div>
            <div class="flex-1 min-w-0">
              <div class="font-bold text-slate-800">${e.name}</div>
              <div class="text-xs text-amber-600 font-medium">${e.title}</div>
              <div class="text-[10px] text-slate-400">${e.origin}</div>
            </div>
          </div>
          
          <!-- Background - full text -->
          <p class="text-xs text-slate-600 mb-3">${e.background}</p>
          
          <!-- Personality traits -->
          <div class="flex flex-wrap gap-1">
            ${e.personality.split(", ").map(t => `<span class="px-2 py-0.5 rounded-full bg-slate-100 text-slate-600 text-[10px]">${t}</span>`).join("")}
          </div>
        </div>
        
        <!-- Spacer -->
        <div class="flex-1"></div>
        
        <!-- Compensation box -->
        <div class="px-4 pb-3">
          <div class="bg-gradient-to-r from-slate-50 to-amber-50 rounded-lg p-3 space-y-2">
            <!-- Salary line -->
            <div class="flex justify-between items-center">
              <span class="text-xs text-slate-500">ğŸ’° Salary</span>
              <div class="text-right">
                <span class="font-bold text-slate-700">Â£${adjustedWage}k</span>
                <span class="text-slate-400 text-xs">/quarter</span>
              </div>
            </div>
            <!-- Equity line -->
            <div class="flex justify-between items-center">
              <span class="text-xs text-slate-500">ğŸ“Š Equity</span>
              <div class="text-right">
                <span class="font-bold text-amber-600">${e.equity}%</span>
                <span class="text-slate-400 text-xs block">(${e.vestingYears}yr vest, ${e.cliff}yr cliff)</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Action buttons -->
        <div class="border-t border-slate-100 p-3 flex gap-2 bg-slate-50">
          <button onclick="event.stopPropagation(); game.showExecCV('${e.id}', 'hr')" class="flex-1 px-3 py-2 bg-white border border-slate-200 hover:border-amber-300 hover:bg-amber-50 text-slate-600 text-xs font-medium rounded-lg transition-colors">
            View CV
          </button>
          <button onclick="event.stopPropagation(); game.hireHRExec('${e.id}')" class="flex-1 px-3 py-2 bg-amber-500 hover:bg-amber-600 text-white text-xs font-bold rounded-lg transition-colors">
            Hire
          </button>
        </div>
      </div>
    `}).join("");
    
    // Actually show the modal!
    document.getElementById("hrModal").classList.remove("hidden");
    document.getElementById("hrModal").classList.add("flex");
  }
  
  hireHRExec(execId) {
    const exec = HR_EXECS.find(e => e.id === execId);
    if (!exec) return;
    
    const salaryMod = this.location ? (1 + this.location.salaryMod) : 1;
    const adjustedWage = Math.round(exec.wage * salaryMod);
    
    this.team.hr = exec;
    this.moods.hr = 1;
    this.metrics.burn += adjustedWage;
    this.metrics.equity -= exec.equity;
    Object.entries(exec.bonus).forEach(([k, v]) => { if (this.metrics[k] !== undefined) this.metrics[k] += v; });
    
    // Increase max AP to 7 now that we have a HR lead
    this.maxAP = 7;
    this.log(`ğŸ“ˆ With a HR lead on board, you can now manage up to ${this.maxAP} AP per quarter.`);
    
    // Track equity grant
    this.equityGrants.push({
      name: exec.name,
      role: "People",
      equity: exec.equity,
      vestingYears: exec.vestingYears,
      cliff: exec.cliff,
      grantedQuarter: this.turn
    });
    
    this.log(`ğŸ¤ ${exec.name} joins as your Head of People! ${exec.equity}% equity, Â£${adjustedWage}k/quarter.`);
    soundManager.playHireSelect('hr');
    document.getElementById("hrModal").classList.add("hidden");
    
    // After HR hire, show M2 (second milestone)
    if (this.completedMilestones.length < 3) {
      this.showMilestoneModal();
    } else {
      this.endGame("allMilestones");
    }
  }

  failMilestone() {
    // === INVESTOR RELATIONSHIP: Missing targets hurts relationship ===
    this.updateInvestorRelationship(-1, "missed milestone deadline");
    
    document.getElementById("failedText").textContent = `You missed: ${this.milestone.name}. The board has lost confidence.`;
    document.getElementById("failedModal").classList.remove("hidden");
    document.getElementById("failedModal").classList.add("flex");
  }

  endGame(reason) {
    // Track game end with Google Analytics
    if (typeof trackGameEvent === 'function') {
      trackGameEvent('game_ended', {
        outcome: reason,
        quarters_played: this.turn,
        milestone_reached: this.currentMilestone,
        final_cash: this.metrics.cash,
        startup_name: this.startupName
      });
    }
    
    // Victory path - show special victory modal
    if (reason === "allMilestones") {
      soundManager.playVictory();
      
      // Check for unicorn event (10% chance on winning)
      if (this.checkForUnicorn()) {
        this.triggerUnicornEvent();
      } else {
        this.showVictoryModal();
      }
      return;
    }
    
    // Failure - play failure sound
    soundManager.playFailure();
    
    // Analyze the game to provide feedback
    const analysis = this.analyzeGame(reason);
    
    // Set header based on reason
    if (reason === "bankrupt") {
      document.getElementById("endIcon").textContent = "ğŸ’¸";
      document.getElementById("endTitle").textContent = "Ran Out of Runway";
      document.getElementById("endSubtitle").textContent = `${this.company.name} ran out of cash in Q${this.turn}`;
    } else if (reason === "missedMilestone") {
      document.getElementById("endIcon").textContent = "â°";
      document.getElementById("endTitle").textContent = "Missed the Deadline";
      document.getElementById("endSubtitle").textContent = `The board lost confidence after Q${this.turn}`;
    } else if (reason === "disengaged") {
      document.getElementById("endIcon").textContent = "ğŸ‘‹";
      document.getElementById("endTitle").textContent = "Removed as CEO";
      document.getElementById("endSubtitle").textContent = `The board voted you out after ${this.turn} quarters of disengagement`;
    } else {
      document.getElementById("endIcon").textContent = "ğŸ“‰";
      document.getElementById("endTitle").textContent = "Game Over";
      document.getElementById("endSubtitle").textContent = `${this.company.name} after ${this.turn} quarters`;
    }
    
    // What happened section
    document.getElementById("endReason").innerHTML = analysis.reasonHtml;
    
    // Stats section
    document.getElementById("endStats").innerHTML = `
      <div class="bg-slate-50 rounded-lg p-3">
        <div class="text-slate-500 text-xs">Quarters Survived</div>
        <div class="font-bold text-slate-800">${this.turn} of 16</div>
      </div>
      <div class="bg-slate-50 rounded-lg p-3">
        <div class="text-slate-500 text-xs">Milestones Completed</div>
        <div class="font-bold text-slate-800">${this.completedMilestones.length} of 3</div>
      </div>
      <div class="bg-slate-50 rounded-lg p-3">
        <div class="text-slate-500 text-xs">Peak Valuation</div>
        <div class="font-bold text-emerald-600">Â£${analysis.peakValuation.toLocaleString()}k</div>
      </div>
      <div class="bg-slate-50 rounded-lg p-3">
        <div class="text-slate-500 text-xs">Final Cash</div>
        <div class="font-bold ${this.metrics.cash <= 0 ? 'text-red-600' : 'text-slate-800'}">Â£${this.metrics.cash}k</div>
      </div>
      <div class="bg-slate-50 rounded-lg p-3">
        <div class="text-slate-500 text-xs">Team Size</div>
        <div class="font-bold text-slate-800">${this.metrics.staff} people</div>
      </div>
      <div class="bg-slate-50 rounded-lg p-3">
        <div class="text-slate-500 text-xs">Equity Retained</div>
        <div class="font-bold text-slate-800">${this.metrics.equity.toFixed(1)}%</div>
      </div>
    `;
    
    // Positives section
    document.getElementById("endPositives").innerHTML = analysis.positives.map(p => `
      <div class="flex items-start gap-2 bg-emerald-50 rounded-lg p-3">
        <span class="text-emerald-500 mt-0.5">âœ“</span>
        <span class="text-slate-700">${p}</span>
      </div>
    `).join('');
    
    // Lessons section
    document.getElementById("endLessons").innerHTML = analysis.lessons.map(l => `
      <div class="flex items-start gap-2 bg-amber-50 rounded-lg p-3">
        <span class="text-amber-500 mt-0.5">â†’</span>
        <span class="text-slate-700">${l}</span>
      </div>
    `).join('');
    
    // Encouragement section
    document.getElementById("endEncouragement").innerHTML = `
      <div class="text-2xl mb-2">${analysis.encouragementEmoji}</div>
      <p class="text-indigo-800 font-medium mb-1">${analysis.encouragementTitle}</p>
      <p class="text-indigo-600 text-sm">${analysis.encouragementText}</p>
    `;
    
    document.getElementById("endModal").classList.remove("hidden");
    document.getElementById("endModal").classList.add("flex");
  }

  analyzeGame(reason) {
    const positives = [];
    const lessons = [];
    let reasonHtml = "";
    
    // Track peak valuation (approximation based on current + milestones)
    const peakValuation = this.metrics.val + (this.completedMilestones.length * 400);
    
    // Reason-specific analysis
    if (reason === "bankrupt") {
      reasonHtml = `
        <div class="flex items-start gap-3">
          <div class="text-2xl">ğŸ’¸</div>
          <div>
            <p class="font-medium text-rose-800 mb-1">Cash hit zero</p>
            <p class="text-rose-700 text-sm">Your burn rate of Â£${this.metrics.burn}k/quarter exceeded your ability to generate or raise funds.</p>
          </div>
        </div>
      `;
      
      // Burn rate lessons
      if (this.metrics.burn > 100) {
        lessons.push("Your burn rate was very high. Consider hiring more conservatively early on, or choosing a lower-cost location.");
      }
      if (this.investors.length === 0) {
        lessons.push("You never raised follow-on funding. After completing milestones, raising capital can extend your runway significantly.");
      } else if (this.investors.length === 1) {
        lessons.push("You only raised once. Multiple funding rounds, timed well, can keep you going through tough periods.");
      }
    } else if (reason === "missedMilestone") {
      reasonHtml = `
        <div class="flex items-start gap-3">
          <div class="text-2xl">â°</div>
          <div>
            <p class="font-medium text-rose-800 mb-1">Missed milestone deadline</p>
            <p class="text-rose-700 text-sm">You reached ${this.milestoneProgress}% progress on "${this.milestone?.name || 'the milestone'}" but ran out of time.</p>
          </div>
        </div>
      `;
      
      // Milestone lessons
      if (this.milestoneProgress >= 80) {
        lessons.push("You were so close! With just a bit more focus on the milestone requirements, you would have made it.");
      } else if (this.milestoneProgress >= 50) {
        lessons.push("Try to prioritize actions that directly contribute to your milestone's focus areas (shown in the milestone tracker).");
      } else {
        lessons.push("Keep a close eye on milestone deadlines and focus heavily on the required stats. The milestone tracker shows what to prioritize.");
      }
      lessons.push("Banking unused AP (up to 2 points) can give you a crucial burst when deadline pressure hits.");
    } else if (reason === "disengaged") {
      reasonHtml = `
        <div class="flex items-start gap-3">
          <div class="text-2xl">ğŸ‘‹</div>
          <div>
            <p class="font-medium text-rose-800 mb-1">The board lost confidence in your leadership</p>
            <p class="text-rose-700 text-sm">You skipped too many decisions over consecutive quarters. Your team and investors concluded you weren't seriously engaged with running the company.</p>
          </div>
        </div>
      `;
      
      // Disengagement lessons
      lessons.push("A startup CEO needs to make decisions every quarter. Skipping choices signals disengagement to your team.");
      lessons.push("Even when options seem unappealing, picking one shows leadership. Passing should be rare, not routine.");
      lessons.push("Your team looks to you for direction. Consistent inaction erodes confidence and morale.");
    }
    
    // Analyze what went well
    if (this.completedMilestones.length >= 1) {
      positives.push(`You completed ${this.completedMilestones.length} milestone${this.completedMilestones.length > 1 ? 's' : ''} - that's real progress!`);
    }
    if (this.turn >= 8) {
      positives.push(`You survived ${this.turn} quarters - that's ${Math.floor(this.turn / 4)} year${this.turn >= 8 ? 's' : ''} of startup life!`);
    }
    if (this.metrics.val >= 1000) {
      positives.push(`You built the company to a Â£${this.metrics.val.toLocaleString()}k valuation - investors noticed.`);
    }
    if (this.metrics.equity >= 60) {
      positives.push(`You retained ${this.metrics.equity.toFixed(0)}% equity - you didn't over-dilute.`);
    }
    if (this.team.hr) {
      positives.push("You unlocked and hired a Head of HR - that's Milestone 1 complete!");
    }
    if (Object.values(this.moods).every(m => m >= 0)) {
      positives.push("Your team morale stayed positive - that's good leadership.");
    }
    if (this.investors.length >= 2) {
      positives.push(`You successfully raised ${this.investors.length} rounds of funding - VCs believed in you.`);
    }
    if (this.conferencesAttended > 0) {
      positives.push(`You attended ${this.conferencesAttended} conference${this.conferencesAttended > 1 ? 's' : ''} and generated leads.`);
    }
    
    // Ensure at least 2 positives
    if (positives.length === 0) {
      positives.push("You took the leap and started a company - most people never do.");
      positives.push("You learned the fundamentals of startup economics and decision-making.");
    } else if (positives.length === 1) {
      positives.push("Every attempt teaches you something. You're building founder intuition.");
    }
    
    // Add general lessons based on game state
    if (this.metrics.equity < 40 && reason === "bankrupt") {
      lessons.push("Heavy dilution left you with less runway flexibility. Balance raising with preserving equity.");
    }
    if (Object.values(this.moods).some(m => m <= -2)) {
      lessons.push("Some team members were very unhappy. Low morale reduces effectiveness. Try to keep your team motivated.");
    }
    if (this.metrics.staff > 10 && this.turn < 8) {
      lessons.push("You scaled headcount quickly. Early-stage startups often benefit from staying lean until product-market fit.");
    }
    
    // Ensure at least 2 lessons
    if (lessons.length < 2) {
      lessons.push("Watch your runway closely - always know how many quarters of cash you have left.");
      if (lessons.length < 2) {
        lessons.push("Match your spending to your milestone timeline. Aggressive moves need aggressive funding.");
      }
    }
    
    // Pick encouragement based on progress
    let encouragementEmoji, encouragementTitle, encouragementText;
    
    if (this.completedMilestones.length >= 2) {
      encouragementEmoji = "ğŸŒŸ";
      encouragementTitle = "So Close to Greatness!";
      encouragementText = "Two milestones down means you understand the game. One more push and you'll crack it.";
    } else if (this.completedMilestones.length >= 1) {
      encouragementEmoji = "ğŸ’ª";
      encouragementTitle = "You've Got the Basics!";
      encouragementText = "Completing your first milestone is the hardest. Now you know the rhythm-try again!";
    } else if (this.turn >= 6) {
      encouragementEmoji = "ğŸ¯";
      encouragementTitle = "Building Experience!";
      encouragementText = "Surviving multiple quarters is an achievement. Each game sharpens your instincts.";
    } else {
      encouragementEmoji = "ğŸš€";
      encouragementTitle = "Every Expert Was Once a Beginner";
      encouragementText = "The best founders failed many times before succeeding. Your next run will be better!";
    }
    
    return {
      reasonHtml,
      peakValuation,
      positives: positives.slice(0, 4), // Max 4 positives
      lessons: lessons.slice(0, 3), // Max 3 lessons
      encouragementEmoji,
      encouragementTitle,
      encouragementText
    };
  }

  showVictoryModal() {
    // Calculate final stats
    const quartersElapsed = this.turn;
    let totalGrantedEquity = 0;
    let totalVested = 0;
    
    (this.equityGrants || []).forEach(g => {
      totalGrantedEquity += g.equity;
      const quartersSinceGrant = quartersElapsed - g.grantQuarter;
      const yearsSinceGrant = quartersSinceGrant / 4;
      if (yearsSinceGrant >= g.cliff) {
        totalVested += Math.min(g.equity, (yearsSinceGrant / g.vestingYears) * g.equity);
      }
    });
    
    const effectiveEquity = this.metrics.equity;
    const netWorth = Math.round((effectiveEquity / 100) * this.metrics.val);
    
    // Store for ending calculations
    this.victoryStats = {
      quarters: quartersElapsed,
      valuation: this.metrics.val,
      equity: effectiveEquity,
      cash: this.metrics.cash,
      netWorth: netWorth,
      totalVested: totalVested
    };
    
    // Populate victory modal
    document.getElementById("victoryQuarters").textContent = quartersElapsed;
    document.getElementById("victoryValuation").textContent = `Â£${this.metrics.val.toLocaleString()}k`;
    document.getElementById("victoryEquity").textContent = `${effectiveEquity.toFixed(1)}%`;
    document.getElementById("victoryCash").textContent = `Â£${this.metrics.cash.toLocaleString()}k`;
    document.getElementById("victoryNetWorth").innerHTML = `
      <div class="text-slate-400 text-sm mb-1">Your stake is worth</div>
      <div class="text-4xl font-black text-emerald-400">Â£${netWorth.toLocaleString()}k</div>
    `;
    
    // Set industry-specific acquirer name
    const acquirerMap = {
      aether: "Eli Lilly",
      vanguard: "ABB",
      quant: "Irongate Capital",
      dream: "Disney"
    };
    document.getElementById("victoryAcquirerName").textContent = acquirerMap[this.company.id] || "Industry Leader";
    
    // === REVENUE SYSTEM: Get revenue-based victory modifiers ===
    const revenueModifiers = this.getRevenueVictoryModifiers();
    const valuationMultiplier = 1 + (revenueModifiers.valuationBonus || 0);
    
    // Store revenue narrative for case study
    this.victoryRevenueNarrative = revenueModifiers.narrative;
    this.victoryRevenueTier = revenueModifiers.tier;
    
    // Populate ending choice values (now revenue-adjusted)
    const adjustedVal = Math.round(this.metrics.val * valuationMultiplier);
    const beachWealth = netWorth + this.metrics.cash;
    const serialSeed = Math.round(netWorth * 0.3);
    
    // Scale path: higher revenue = better terms
    const scaleMultiplier = revenueModifiers.tier === 'exceptional' ? 4.5 : 
                            revenueModifiers.tier === 'strong' ? 4.0 : 
                            revenueModifiers.tier === 'promising' ? 3.5 : 3.0;
    const scaleValuation = Math.round(adjustedVal * scaleMultiplier);
    const scaleDilutedEquity = Math.round(effectiveEquity * 0.6 * 10) / 10;
    const scaleStakeValue = Math.round((scaleDilutedEquity / 100) * scaleValuation);
    
    // Acquisition: acquirer interest affects premium
    const acquiMultiplier = revenueModifiers.acquirerInterest === 'bidding_war' ? 3.0 :
                            revenueModifiers.acquirerInterest === 'strong' ? 2.5 :
                            revenueModifiers.acquirerInterest === 'normal' ? 2.2 :
                            revenueModifiers.acquirerInterest === 'low' ? 1.8 : 1.5;
    const acquiPremium = Math.round(adjustedVal * acquiMultiplier);
    const acquiPayout = Math.round((effectiveEquity / 100) * acquiPremium);
    
    // IPO path unlocked with exceptional revenue
    const ipoAvailable = revenueModifiers.ipoEligible;
    
    document.getElementById("endingBeachValue").textContent = `Â£${beachWealth.toLocaleString()}k`;
    document.getElementById("endingSerialSale").textContent = `Â£${netWorth.toLocaleString()}k`;
    document.getElementById("endingSerialSeed").textContent = `Â£${serialSeed.toLocaleString()}k`;
    document.getElementById("endingScaleValuation").textContent = `Â£${scaleValuation.toLocaleString()}k`;
    document.getElementById("endingScaleStake").textContent = `Â£${scaleStakeValue.toLocaleString()}k`;
    document.getElementById("endingAcquiPrice").textContent = `Â£${acquiPremium.toLocaleString()}k`;
    document.getElementById("endingAcquiPayout").textContent = `Â£${acquiPayout.toLocaleString()}k`;
    
    // Show extreme mode badge if applicable
    const extremeBadge = document.getElementById("extremeModeBadge");
    if (this.extremeMode) {
      extremeBadge.classList.remove("hidden");
    } else {
      extremeBadge.classList.add("hidden");
    }
    
    // Show modal
    document.getElementById("victoryModal").classList.remove("hidden");
    document.getElementById("victoryModal").classList.add("flex");
  }

  // Check if unicorn event should trigger (10% chance, with slight boosts for good play)
  checkForUnicorn() {
    let unicornChance = 0.10; // Base 10% chance
    
    // Small boosts for exceptional play (can push to ~15% max)
    if (this.metrics.val >= 3000) unicornChance += 0.02; // High valuation
    if (this.metrics.equity >= 60) unicornChance += 0.01; // Good equity retention
    if (this.turn <= 12) unicornChance += 0.02; // Fast completion
    if (this.extremeMode) unicornChance += 0.02; // Extreme mode bonus
    
    // Revenue boosts unicorn chance
    const arr = this.quarterlyRevenue * 4;
    if (arr >= 500) unicornChance += 0.05;  // Strong revenue
    else if (arr >= 200) unicornChance += 0.02;
    
    return Math.random() < unicornChance;
  }

  triggerUnicornEvent() {
    // Show unicorn modal
    document.getElementById("unicornModal").classList.remove("hidden");
    document.getElementById("unicornModal").classList.add("flex");
    
    // Calculate unicorn values
    const baseVal = this.metrics.val;
    const unicornValuation = 1000000; // Â£1B = Â£1,000,000k
    const multiplier = Math.round(unicornValuation / baseVal);
    
    document.getElementById("unicornPreVal").textContent = `Â£${baseVal.toLocaleString()}k`;
    document.getElementById("unicornMultiplier").textContent = `${multiplier}x`;
    
    // Store for when they continue
    this.unicornTriggered = true;
  }

  acceptUnicorn() {
    // Get founder name
    const nameInput = document.getElementById("unicornFounderName");
    const founderName = nameInput.value.trim() || "Anonymous Founder";
    
    // Apply unicorn valuation boost
    this.metrics.val = 1000000; // Â£1B
    
    // Store unicorn data
    this.unicornFounderName = founderName;
    
    // Close unicorn modal
    document.getElementById("unicornModal").classList.add("hidden");
    document.getElementById("unicornModal").classList.remove("flex");
    
    // Add log entry
    this.log("ğŸ¦„ UNICORN STATUS ACHIEVED! Valuation: Â£1,000,000k");
    
    // Show Hall of Fame
    this.showHallOfFame();
  }

  showHallOfFame() {
    // Get random selection of legends (8-10)
    const shuffled = [...HALL_OF_FAME_LEGENDS].sort(() => Math.random() - 0.5);
    const selectedLegends = shuffled.slice(0, 8);
    
    // Sort by valuation descending
    selectedLegends.sort((a, b) => b.valuation - a.valuation);
    
    // Find where the player would rank
    const playerValuation = 1; // Â£1B in the same scale
    let playerRank = 1;
    selectedLegends.forEach(l => {
      if (l.valuation > playerValuation) playerRank++;
    });
    
    // Render the list
    const listHtml = selectedLegends.map((legend, idx) => {
      const rank = idx + 1;
      const isTop3 = rank <= 3;
      const medalEmoji = rank === 1 ? "ğŸ¥‡" : rank === 2 ? "ğŸ¥ˆ" : rank === 3 ? "ğŸ¥‰" : "";
      
      return `
        <div class="flex items-center gap-4 p-3 rounded-xl ${isTop3 ? 'bg-amber-900/30 border border-amber-500/30' : 'bg-black/20'}">
          <div class="w-8 text-center">
            ${medalEmoji || `<span class="text-slate-500 font-mono text-sm">#${rank}</span>`}
          </div>
          <div class="text-2xl">${legend.emoji}</div>
          <div class="flex-1">
            <div class="font-bold text-white">${legend.name}</div>
            <div class="text-amber-400/80 text-sm">${legend.company} â€¢ ${legend.year}</div>
          </div>
          <div class="text-right">
            <div class="font-bold ${legend.valuation >= 100 ? 'text-emerald-400' : 'text-white'}">Â£${legend.valuation}B</div>
          </div>
        </div>
      `;
    }).join("");
    
    document.getElementById("hallOfFameList").innerHTML = listHtml;
    
    // Show player's new entry
    const newEntry = document.getElementById("newHofEntry");
    newEntry.classList.remove("hidden");
    document.getElementById("newHofName").textContent = this.unicornFounderName;
    document.getElementById("newHofCompany").textContent = `${this.company.name} â€¢ ${new Date().getFullYear()}`;
    
    // Stats
    document.getElementById("hofTotalFounders").textContent = selectedLegends.length + 1;
    document.getElementById("hofYourRank").textContent = `#${Math.min(playerRank, selectedLegends.length + 1)}`;
    
    // Calculate total wealth
    const totalWealth = selectedLegends.reduce((sum, l) => sum + l.valuation, 0) + 1;
    document.getElementById("hofTotalWealth").textContent = `Â£${totalWealth.toLocaleString()}B`;
    
    // Show modal
    document.getElementById("hallOfFameModal").classList.remove("hidden");
    document.getElementById("hallOfFameModal").classList.add("flex");
  }

  closeHallOfFame() {
    document.getElementById("hallOfFameModal").classList.add("hidden");
    document.getElementById("hallOfFameModal").classList.remove("flex");
    
    // Now show victory modal with updated values
    this.showVictoryModal();
  }

  selectEnding(ending) {
    const stats = this.victoryStats;
    const companyName = this.company.name;
    let content = "";
    
    // Play ending-specific sound
    switch(ending) {
      case 'beach':
        soundManager.playBeachEnding();
        break;
      case 'serial':
        soundManager.playSerialEnding();
        break;
      case 'scale':
        soundManager.playScaleEnding();
        break;
      case 'acquisition':
        soundManager.playAcquisitionEnding();
        break;
    }
    
    switch(ending) {
      case 'beach':
        const beachWealth = stats.netWorth + stats.cash;
        content = `
          <div class="text-center mb-6">
            <div class="text-6xl mb-3">ğŸ–</div>
            <h2 class="text-2xl font-bold text-slate-800">The Good Life</h2>
          </div>
          <div class="prose prose-slate max-w-none">
            <p class="text-slate-600 leading-relaxed mb-4">
              You cash out your stake in ${companyName} for <span class="font-bold text-emerald-600">Â£${stats.netWorth.toLocaleString()}k</span>, 
              say goodbye to your team, and board a one-way flight to somewhere warm.
            </p>
            <p class="text-slate-600 leading-relaxed mb-4">
              The early mornings, the investor calls, the all-nighters before launches-they're all behind you now. 
              Your phone stops buzzing. Your inbox goes quiet. And you discover that the beach really is as nice as they say.
            </p>
            <p class="text-slate-500 text-sm italic">
              Years later, you occasionally see ${companyName} in the news. You smile, pour another drink, and turn back to the sunset.
            </p>
          </div>
          <div class="mt-6 p-4 bg-cyan-50 rounded-xl text-center">
            <div class="text-sm text-cyan-600 mb-1">Final Net Worth</div>
            <div class="text-3xl font-bold text-cyan-700">Â£${beachWealth.toLocaleString()}k</div>
            <div class="text-xs text-cyan-500 mt-1">+ Priceless peace of mind</div>
          </div>
        `;
        break;
        
      case 'serial':
        const seedFunding = Math.round(stats.netWorth * 0.3);
        content = `
          <div class="text-center mb-6">
            <div class="text-6xl mb-3">ğŸš€</div>
            <h2 class="text-2xl font-bold text-slate-800">The Serial Founder</h2>
          </div>
          <div class="prose prose-slate max-w-none">
            <p class="text-slate-600 leading-relaxed mb-4">
              You sell your stake for <span class="font-bold text-emerald-600">Â£${stats.netWorth.toLocaleString()}k</span>, 
              but retirement never crosses your mind. Within weeks, you're sketching ideas on napkins again.
            </p>
            <p class="text-slate-600 leading-relaxed mb-4">
              This time, you don't need to beg for angel funding. You write yourself a seed check for 
              <span class="font-bold text-violet-600">Â£${seedFunding.toLocaleString()}k</span> and hire your first employee before the ink dries on the ${companyName} sale.
            </p>
            <p class="text-slate-500 text-sm italic">
              The pattern repeats: the garage, the pitch decks, the product pivots. But now you know the moves. 
              And this time, you're playing the game on your own terms.
            </p>
          </div>
          <div class="mt-6 p-4 bg-violet-50 rounded-xl text-center">
            <div class="text-sm text-violet-600 mb-1">Your Next Startup's Seed Round</div>
            <div class="text-3xl font-bold text-violet-700">Â£${seedFunding.toLocaleString()}k</div>
            <div class="text-xs text-violet-500 mt-1">Self-funded. No strings attached.</div>
          </div>
        `;
        break;
        
      case 'scale':
        const seriesBValuation = Math.round(stats.valuation * 3.5);
        const dilutedEquity = Math.round(stats.equity * 0.6 * 10) / 10;
        const futureWorth = Math.round((dilutedEquity / 100) * seriesBValuation);
        content = `
          <div class="text-center mb-6">
            <div class="text-6xl mb-3">ğŸ“ˆ</div>
            <h2 class="text-2xl font-bold text-slate-800">The Empire Builder</h2>
          </div>
          <div class="prose prose-slate max-w-none">
            <p class="text-slate-600 leading-relaxed mb-4">
              You turn down every acquisition offer and tell your board: "We're just getting started." 
              The Series B closes at a <span class="font-bold text-emerald-600">Â£${seriesBValuation.toLocaleString()}k</span> valuation.
            </p>
            <p class="text-slate-600 leading-relaxed mb-4">
              The next three years are a blur of international expansion, enterprise deals, and magazine covers. 
              Your team grows from dozens to hundreds. ${companyName} becomes a verb.
            </p>
            <p class="text-slate-500 text-sm italic">
              The IPO rumors start. Your equity is diluted to ${dilutedEquity}%, but at this valuation? 
              You're not complaining. This is what it means to build something that lasts.
            </p>
          </div>
          <div class="mt-6 p-4 bg-amber-50 rounded-xl text-center">
            <div class="text-sm text-amber-600 mb-1">Post-Series B Stake Value</div>
            <div class="text-3xl font-bold text-amber-700">Â£${futureWorth.toLocaleString()}k</div>
            <div class="text-xs text-amber-500 mt-1">${dilutedEquity}% of Â£${seriesBValuation.toLocaleString()}k valuation</div>
          </div>
        `;
        break;
        
      case 'acquisition':
        const acquiPremium = Math.round(stats.valuation * 2.2);
        const acquiPayout = Math.round((stats.equity / 100) * acquiPremium);
        
        // Industry-specific acquirers
        const acquirerMap = {
          aether: { name: "Eli Lilly", type: "pharma giant" },
          vanguard: { name: "ABB", type: "industrial automation leader" },
          quant: { name: "Irongate Capital", type: "investment powerhouse" },
          dream: { name: "Disney", type: "entertainment empire" }
        };
        const acquirerInfo = acquirerMap[this.company.id] || { name: "a major corporation", type: "industry leader" };
        const acquirer = acquirerInfo.name;
        const acquirerType = acquirerInfo.type;
        
        content = `
          <div class="text-center mb-6">
            <div class="text-6xl mb-3">ğŸ¢</div>
            <h2 class="text-2xl font-bold text-slate-800">The Strategic Exit</h2>
          </div>
          <div class="prose prose-slate max-w-none">
            <p class="text-slate-600 leading-relaxed mb-4">
              When <span class="font-bold">${acquirer}</span>, the ${acquirerType}, comes calling with a 
              <span class="font-bold text-emerald-600">Â£${acquiPremium.toLocaleString()}k</span> offer, 
              the board doesn't need long to decide. The premium is too good to ignore.
            </p>
            <p class="text-slate-600 leading-relaxed mb-4">
              You stay on to lead "${companyName} by ${acquirer}"-your tech, their resources. 
              The integration is smoother than expected. Your team gets ${acquirer} stock. 
              You get a corner office and an expense account.
            </p>
            <p class="text-slate-500 text-sm italic">
              It's not quite the indie founder dream anymore, but there's something satisfying about seeing 
              your creation reach global scale with ${acquirer}'s distribution behind it.
            </p>
          </div>
          <div class="mt-6 p-4 bg-emerald-50 rounded-xl text-center">
            <div class="text-sm text-emerald-600 mb-1">Your Acquisition Payout</div>
            <div class="text-3xl font-bold text-emerald-700">Â£${acquiPayout.toLocaleString()}k</div>
            <div class="text-xs text-emerald-500 mt-1">+ ${acquirer} VP title & stock options</div>
          </div>
        `;
        break;
    }
    
    // Hide victory modal, show ending result
    document.getElementById("victoryModal").classList.add("hidden");
    document.getElementById("victoryModal").classList.remove("flex");
    document.getElementById("endingResultContent").innerHTML = content;
    document.getElementById("endingResultModal").classList.remove("hidden");
    document.getElementById("endingResultModal").classList.add("flex");
  }

  changeStaff(delta) {
    this.metrics.staff = Math.max(1, this.metrics.staff + delta);
    this.metrics.burn += delta * 12;
    this.update();
    this.log(delta > 0 ? "Hired additional staff." : "Reduced headcount.");
  }
  
  updateFundingCard(runway) {
    // Old funding card removed - now only update the sidebar finance card
    this.updateSidebarFinanceCard(runway);
  }
  
  updateSidebarFinanceCard(runway) {
    const card = document.getElementById("sidebarFinanceCard");
    const cashEl = document.getElementById("sidebarCash");
    const runwayEl = document.getElementById("sidebarRunway");
    const statusEl = document.getElementById("sidebarFinanceStatus");
    const barEl = document.getElementById("sidebarRunwayBar");
    const revenueRow = document.getElementById("sidebarRevenueRow");
    const revenueEl = document.getElementById("sidebarRevenue");
    
    if (!card) return;
    
    const region = getRegion();
    const currency = region.currency;
    const multiplier = region.currencyMultiplier;
    
    // Calculate if profitable (revenue > burn)
    const revenue = this.quarterlyRevenue || 0;
    const netBurn = this.metrics.burn - revenue;
    const isProfitable = netBurn <= 0;
    
    // Update cash
    cashEl.textContent = `${currency}${Math.round(this.metrics.cash * multiplier)}k`;
    
    // Update runway text
    if (isProfitable) {
      runwayEl.textContent = "âˆ";
      runwayEl.className = "font-bold font-mono text-lg text-emerald-300";
    } else if (runway > 99) {
      runwayEl.textContent = "99+";
      runwayEl.className = "font-bold font-mono text-lg text-emerald-300";
    } else {
      runwayEl.textContent = `${runway} QTR`;
      if (runway <= 1) {
        runwayEl.className = "font-bold font-mono text-lg text-red-300";
      } else if (runway <= 3) {
        runwayEl.className = "font-bold font-mono text-lg text-amber-300";
      } else {
        runwayEl.className = "font-bold font-mono text-lg text-emerald-300";
      }
    }
    
    // Update card color class based on runway
    card.classList.remove("runway-healthy", "runway-ok", "runway-low", "runway-critical", "runway-profitable");
    if (isProfitable) {
      card.classList.add("runway-profitable");
      statusEl.textContent = "Profitable ğŸ‰";
    } else if (runway <= 1) {
      card.classList.add("runway-critical");
      statusEl.textContent = "CRITICAL ğŸš¨";
    } else if (runway <= 3) {
      card.classList.add("runway-low");
      statusEl.textContent = "Low âš ï¸";
    } else if (runway <= 5) {
      card.classList.add("runway-ok");
      statusEl.textContent = "OK";
    } else {
      card.classList.add("runway-healthy");
      statusEl.textContent = "Healthy âœ“";
    }
    
    // Update runway bar
    const displayRunway = Math.min(runway, 8);
    let barHTML = '';
    for (let i = 0; i < 8; i++) {
      const isActive = isProfitable || i < displayRunway;
      let activeClass, inactiveClass;
      if (isProfitable) {
        activeClass = "bg-white/70";
        inactiveClass = "bg-white/20";
      } else if (runway <= 1) {
        activeClass = "bg-red-300";
        inactiveClass = "bg-white/20";
      } else if (runway <= 3) {
        activeClass = "bg-amber-300";
        inactiveClass = "bg-white/20";
      } else {
        activeClass = "bg-white/70";
        inactiveClass = "bg-white/20";
      }
      const segmentClass = isActive ? activeClass : inactiveClass;
      barHTML += `<div class="flex-1 ${segmentClass} rounded-sm"></div>`;
    }
    barEl.innerHTML = barHTML;
    
    // Show revenue if exists
    if (revenue > 0) {
      revenueRow.classList.remove("hidden");
      revenueEl.textContent = `${currency}${Math.round(revenue * multiplier)}k/q`;
    } else {
      revenueRow.classList.add("hidden");
    }
  }
  
  showFinanceDetailsModal() {
    const region = getRegion();
    const currency = region.currency;
    const multiplier = region.currencyMultiplier;
    
    const revenue = this.quarterlyRevenue || 0;
    const netBurn = this.metrics.burn - revenue;
    const isProfitable = netBurn <= 0;
    const runway = netBurn > 0 ? Math.floor(this.metrics.cash / netBurn) : 999;
    
    // Update header color
    const header = document.getElementById("financeModalHeader");
    const subtitle = document.getElementById("financeModalSubtitle");
    
    if (isProfitable) {
      header.className = "px-6 py-4 rounded-t-2xl bg-gradient-to-r from-teal-600 to-cyan-600";
      subtitle.textContent = "Cash flow positive!";
    } else if (runway <= 1) {
      header.className = "px-6 py-4 rounded-t-2xl bg-gradient-to-r from-red-600 to-rose-600";
      subtitle.textContent = "Critical - immediate action needed";
    } else if (runway <= 3) {
      header.className = "px-6 py-4 rounded-t-2xl bg-gradient-to-r from-amber-600 to-orange-600";
      subtitle.textContent = "Low runway - consider raising";
    } else {
      header.className = "px-6 py-4 rounded-t-2xl bg-gradient-to-r from-emerald-600 to-green-600";
      subtitle.textContent = "Your company is in good shape";
    }
    
    // Update metrics
    document.getElementById("finDetailCash").textContent = `${currency}${Math.round(this.metrics.cash * multiplier)}k`;
    document.getElementById("finDetailBurn").textContent = `${currency}${Math.round(this.metrics.burn * multiplier)}k/q`;
    document.getElementById("finDetailRevenue").textContent = `${currency}${Math.round(revenue * multiplier)}k/q`;
    
    // Runway
    const runwayEl = document.getElementById("finDetailRunway");
    const runwayStatus = document.getElementById("finDetailRunwayStatus");
    if (isProfitable) {
      runwayEl.textContent = "âˆ";
      runwayEl.className = "text-2xl font-bold font-mono text-emerald-600";
      runwayStatus.textContent = "Profitable ğŸ‰";
      runwayStatus.className = "text-xs px-2 py-0.5 rounded-full bg-teal-100 text-teal-700";
    } else if (runway > 99) {
      runwayEl.textContent = "99+";
      runwayEl.className = "text-2xl font-bold font-mono text-emerald-600";
      runwayStatus.textContent = "Healthy";
      runwayStatus.className = "text-xs px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700";
    } else {
      runwayEl.textContent = `${runway} QTR`;
      if (runway <= 1) {
        runwayEl.className = "text-2xl font-bold font-mono text-red-600";
        runwayStatus.textContent = "Critical ğŸš¨";
        runwayStatus.className = "text-xs px-2 py-0.5 rounded-full bg-red-100 text-red-700";
      } else if (runway <= 3) {
        runwayEl.className = "text-2xl font-bold font-mono text-amber-600";
        runwayStatus.textContent = "Low âš ï¸";
        runwayStatus.className = "text-xs px-2 py-0.5 rounded-full bg-amber-100 text-amber-700";
      } else {
        runwayEl.className = "text-2xl font-bold font-mono text-emerald-600";
        runwayStatus.textContent = "Healthy";
        runwayStatus.className = "text-xs px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700";
      }
    }
    
    // Runway bar in modal
    const displayRunway = Math.min(runway, 8);
    const barEl = document.getElementById("finDetailRunwayBar");
    let barHTML = '';
    for (let i = 0; i < 8; i++) {
      const isActive = isProfitable || i < displayRunway;
      let activeClass = isProfitable ? "bg-teal-500" : (runway <= 1 ? "bg-red-500" : (runway <= 3 ? "bg-amber-500" : "bg-emerald-500"));
      barHTML += `<div class="flex-1 h-3 ${isActive ? activeClass : 'bg-slate-200'} rounded"></div>`;
    }
    barEl.innerHTML = barHTML;
    
    // Initialize forecast sliders to default
    const burnSlider = document.getElementById("burnAdjustSlider");
    const revenueSlider = document.getElementById("revenueOutlookSlider");
    if (burnSlider) burnSlider.value = 0;
    if (revenueSlider) revenueSlider.value = 1;
    
    // Store baseline values for forecast calculations
    this.forecastBaseline = {
      cash: this.metrics.cash,
      burn: this.metrics.burn,
      revenue: this.quarterlyRevenue || 0,
      currency: currency,
      multiplier: multiplier
    };
    
    // Render initial forecast
    this.updateForecast();
    
    // Advice
    const adviceEl = document.getElementById("finDetailAdvice");
    if (isProfitable) {
      adviceEl.textContent = "Congratulations on profitability! You can now grow on your own terms or raise to accelerate.";
    } else if (runway <= 1) {
      adviceEl.textContent = "Your runway is critical! Raise funding immediately or drastically cut costs to survive.";
    } else if (runway <= 3) {
      adviceEl.textContent = "Runway is getting low. Start fundraising conversations now - the process takes time.";
    } else if (runway <= 5) {
      adviceEl.textContent = "Keep an eye on your runway. You have time, but don't wait too long to raise if needed.";
    } else {
      adviceEl.textContent = "Your runway looks healthy. Focus on hitting milestones and building toward product-market fit.";
    }
    
    // Update raise button state
    const raiseBtn = document.getElementById("finDetailRaiseBtn");
    const canRaise = this.completedMilestones.length > this.lastRaiseMilestoneCount;
    const hasEquity = this.metrics.equity >= 10;
    
    if (!canRaise) {
      raiseBtn.textContent = "ğŸ¯ Complete Milestone First";
      raiseBtn.disabled = true;
      raiseBtn.className = "flex-1 bg-slate-300 text-slate-500 py-3 rounded-xl font-bold cursor-not-allowed";
    } else if (!hasEquity) {
      raiseBtn.textContent = "ğŸš« Need 10%+ Equity";
      raiseBtn.disabled = true;
      raiseBtn.className = "flex-1 bg-slate-300 text-slate-500 py-3 rounded-xl font-bold cursor-not-allowed";
    } else {
      raiseBtn.textContent = "ğŸ’° Raise Funding";
      raiseBtn.disabled = false;
      raiseBtn.className = "flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-3 rounded-xl font-bold transition-colors";
    }
    
    // Update revenue section if revenue model exists
    this.updateFinanceModalRevenueSection(currency, multiplier);
    
    document.getElementById("financeDetailsModal").classList.remove("hidden");
    document.getElementById("financeDetailsModal").classList.add("flex");
  }
  
  updateFinanceModalRevenueSection(currency, multiplier) {
    const section = document.getElementById("finDetailRevenueSection");
    const projections = this.getSalesProjections ? this.getSalesProjections() : null;
    
    if (!projections || !this.revenueModel) {
      section.classList.add("hidden");
      return;
    }
    
    section.classList.remove("hidden");
    
    // Get current quarter data
    const currentQ = this.turn;
    const currentData = projections.quarters[currentQ - 1];
    const actualRevenue = this.quarterlyRevenue || 0;
    const targetRevenue = currentData ? Math.round(currentData.projected / 4) : 0; // Convert annual to quarterly
    
    // Update current vs target
    document.getElementById("finDetailCurrentRev").textContent = `${currency}${Math.round(actualRevenue * multiplier)}k`;
    document.getElementById("finDetailTargetRev").textContent = `${currency}${Math.round(targetRevenue * multiplier)}k`;
    
    // Calculate variance
    const variance = targetRevenue > 0 ? Math.round(((actualRevenue - targetRevenue) / targetRevenue) * 100) : 0;
    const varianceEl = document.getElementById("finDetailVarianceValue");
    
    if (variance >= 0) {
      varianceEl.textContent = `+${variance}%`;
      varianceEl.className = "font-bold text-emerald-600";
    } else if (variance >= -15) {
      varianceEl.textContent = `${variance}%`;
      varianceEl.className = "font-bold text-amber-600";
    } else {
      varianceEl.textContent = `${variance}%`;
      varianceEl.className = "font-bold text-red-600";
    }
    
    // Update status badge
    const statusEl = document.getElementById("finDetailRevenueStatus");
    if (variance >= 0) {
      statusEl.textContent = "On Track âœ“";
      statusEl.className = "text-xs px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700";
    } else if (variance >= -15) {
      statusEl.textContent = "Within Tolerance";
      statusEl.className = "text-xs px-2 py-0.5 rounded-full bg-amber-100 text-amber-700";
    } else {
      statusEl.textContent = "Behind Target";
      statusEl.className = "text-xs px-2 py-0.5 rounded-full bg-red-100 text-red-700";
    }
    
    // Render the chart
    this.renderFinanceModalChart(projections, currency);
  }
  
  renderFinanceModalChart(projections, currency) {
    const container = document.getElementById("finDetailChart");
    if (!container || !projections) return;
    
    const width = container.clientWidth || 450;
    const height = 180;
    const padding = { top: 20, right: 20, bottom: 30, left: 50 };
    const chartWidth = width - padding.left - padding.right;
    const chartHeight = height - padding.top - padding.bottom;
    
    const quarters = projections.quarters;
    const currentQ = this.turn;
    const tolerance = projections.toleranceBand || 0.15;
    
    // Find max value for scaling
    const maxTarget = Math.max(...quarters.map(q => q.projected));
    const maxActual = Math.max(...quarters.filter(q => q.actual !== null).map(q => q.actual), 0);
    const maxVal = Math.max(maxTarget, maxActual, 100) * 1.15;
    
    // Scale functions
    const xScale = (q) => padding.left + ((q - 1) / 15) * chartWidth;
    const yScale = (v) => padding.top + chartHeight - (v / maxVal) * chartHeight;
    
    let svg = `<svg width="100%" height="${height}" viewBox="0 0 ${width} ${height}">`;
    
    // Background grid
    svg += `<g stroke="#e2e8f0" stroke-width="1">`;
    for (let i = 0; i <= 4; i++) {
      const y = padding.top + (chartHeight / 4) * i;
      svg += `<line x1="${padding.left}" y1="${y}" x2="${width - padding.right}" y2="${y}" stroke-dasharray="3,3" />`;
    }
    svg += `</g>`;
    
    // Y-axis labels
    svg += `<g fill="#64748b" font-size="11">`;
    for (let i = 0; i <= 4; i++) {
      const val = Math.round(maxVal * (4 - i) / 4);
      const y = padding.top + (chartHeight / 4) * i;
      svg += `<text x="${padding.left - 8}" y="${y + 4}" text-anchor="end">${currency}${val}k</text>`;
    }
    svg += `</g>`;
    
    // X-axis labels (quarters)
    svg += `<g fill="#64748b" font-size="10">`;
    [1, 4, 8, 12, 16].forEach(q => {
      const x = xScale(q);
      svg += `<text x="${x}" y="${height - 8}" text-anchor="middle">Q${q}</text>`;
    });
    svg += `</g>`;
    
    // Tolerance band (shaded area)
    const tolerancePoints = quarters.filter(q => q.projected > 0).map(q => ({
      x: xScale(q.quarter),
      upper: yScale(Math.min(q.projected * (1 + tolerance), maxVal)),
      lower: yScale(q.projected * (1 - tolerance))
    }));
    
    if (tolerancePoints.length > 1) {
      let bandPath = `M ${tolerancePoints[0].x} ${tolerancePoints[0].upper}`;
      tolerancePoints.forEach(p => bandPath += ` L ${p.x} ${p.upper}`);
      for (let i = tolerancePoints.length - 1; i >= 0; i--) {
        bandPath += ` L ${tolerancePoints[i].x} ${tolerancePoints[i].lower}`;
      }
      bandPath += ' Z';
      svg += `<path d="${bandPath}" fill="rgba(251,191,36,0.2)" />`;
    }
    
    // Target line (dashed)
    const targetPoints = quarters.filter(q => q.projected > 0).map(q => `${xScale(q.quarter)},${yScale(q.projected)}`);
    if (targetPoints.length > 1) {
      svg += `<polyline points="${targetPoints.join(' ')}" fill="none" stroke="#94a3b8" stroke-width="2" stroke-dasharray="6,4" />`;
    }
    
    // Actual revenue line (solid)
    const actualQuarters = quarters.filter(q => q.actual !== null && q.quarter <= currentQ);
    if (actualQuarters.length > 0) {
      const actualPoints = actualQuarters.map(q => `${xScale(q.quarter)},${yScale(q.actual)}`);
      
      if (actualPoints.length > 1) {
        svg += `<polyline points="${actualPoints.join(' ')}" fill="none" stroke="#10b981" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />`;
      }
      
      // Data points with status colors
      actualQuarters.forEach(q => {
        const x = xScale(q.quarter);
        const y = yScale(q.actual);
        let pointColor = '#10b981'; // green - on track
        if (q.status === 'behind') pointColor = '#ef4444'; // red
        else if (q.status === 'within_tolerance') pointColor = '#f59e0b'; // amber
        
        svg += `<circle cx="${x}" cy="${y}" r="6" fill="${pointColor}" stroke="white" stroke-width="2" />`;
      });
    }
    
    // Current quarter marker
    if (currentQ >= 1 && currentQ <= 16) {
      const x = xScale(currentQ);
      svg += `<line x1="${x}" y1="${padding.top}" x2="${x}" y2="${height - padding.bottom}" stroke="#6366f1" stroke-width="2" stroke-dasharray="4,4" />`;
      svg += `<text x="${x}" y="${padding.top - 5}" fill="#6366f1" font-size="11" font-weight="bold" text-anchor="middle">NOW</text>`;
    }
    
    svg += `</svg>`;
    container.innerHTML = svg;
  }
  
  toggleFinancialHelp() {
    const content = document.getElementById("finHelpContent");
    const toggle = document.getElementById("finHelpToggle");
    
    if (content.classList.contains("hidden")) {
      content.classList.remove("hidden");
      toggle.style.transform = "rotate(180deg)";
    } else {
      content.classList.add("hidden");
      toggle.style.transform = "rotate(0deg)";
    }
  }
  
  // === INTERACTIVE FORECAST SYSTEM ===
  
  updateForecast() {
    if (!this.forecastBaseline) return;
    
    const burnSlider = document.getElementById("burnAdjustSlider");
    const revenueSlider = document.getElementById("revenueOutlookSlider");
    const burnAdjustValue = document.getElementById("burnAdjustValue");
    const revenueOutlookValue = document.getElementById("revenueOutlookValue");
    
    if (!burnSlider || !revenueSlider) return;
    
    const burnAdjust = parseInt(burnSlider.value) / 100; // -0.3 to 0.3
    const revenueOutlook = parseInt(revenueSlider.value); // 0, 1, 2
    
    // Update slider labels
    const burnPct = parseInt(burnSlider.value);
    if (burnPct < 0) {
      burnAdjustValue.textContent = `${burnPct}%`;
      burnAdjustValue.className = "text-xs font-mono text-emerald-400";
    } else if (burnPct > 0) {
      burnAdjustValue.textContent = `+${burnPct}%`;
      burnAdjustValue.className = "text-xs font-mono text-red-400";
    } else {
      burnAdjustValue.textContent = "0%";
      burnAdjustValue.className = "text-xs font-mono text-slate-400";
    }
    
    const outlookLabels = ['ğŸ˜Ÿ Pessimistic', 'ğŸ“Š Baseline', 'ğŸš€ Optimistic'];
    const outlookColors = ['text-red-400', 'text-slate-400', 'text-emerald-400'];
    revenueOutlookValue.textContent = outlookLabels[revenueOutlook];
    revenueOutlookValue.className = `text-xs font-mono ${outlookColors[revenueOutlook]}`;
    
    // Calculate adjusted values
    const { cash, burn, revenue, currency, multiplier } = this.forecastBaseline;
    const adjustedBurn = Math.round(burn * (1 + burnAdjust));
    
    // Revenue multipliers for each outlook
    const revenueMultipliers = [0.7, 1.0, 1.4]; // pessimistic, baseline, optimistic
    const baseGrowth = 1.15; // 15% quarter-over-quarter growth assumed
    
    // Calculate 5-point forecast (now, +1, +2, +3, +4 quarters)
    const forecastPoints = [];
    let currentCash = cash;
    let currentRevenue = revenue;
    
    for (let q = 0; q <= 4; q++) {
      forecastPoints.push({
        quarter: q,
        cash: Math.max(0, currentCash),
        revenue: currentRevenue
      });
      
      // Apply changes for next quarter
      const projectedRevenue = currentRevenue * baseGrowth * revenueMultipliers[revenueOutlook];
      const netFlow = projectedRevenue - adjustedBurn;
      currentCash += netFlow;
      currentRevenue = projectedRevenue;
    }
    
    // Render the chart
    this.renderForecastChart(forecastPoints, currency, multiplier);
    
    // Update summary
    const endCash = forecastPoints[4].cash;
    const netBurn = adjustedBurn - (revenue * revenueMultipliers[revenueOutlook]);
    const endRunway = netBurn > 0 ? Math.floor(endCash / netBurn) : 99;
    
    const endCashEl = document.getElementById("forecastEndCash");
    const endRunwayEl = document.getElementById("forecastEndRunway");
    
    endCashEl.textContent = `${currency}${Math.round(endCash * multiplier)}k`;
    endCashEl.className = endCash <= 0 ? "font-bold font-mono text-red-400" : "font-bold font-mono";
    
    if (netBurn <= 0) {
      endRunwayEl.textContent = "âˆ";
      endRunwayEl.className = "font-bold font-mono text-emerald-400";
    } else {
      endRunwayEl.textContent = endRunway > 20 ? "20+ QTR" : `${endRunway} QTR`;
      endRunwayEl.className = endRunway <= 2 ? "font-bold font-mono text-red-400" : 
                              endRunway <= 4 ? "font-bold font-mono text-amber-400" : "font-bold font-mono";
    }
    
    // Show scenario impact if different from baseline
    const impactEl = document.getElementById("scenarioImpact");
    const impactText = document.getElementById("scenarioImpactText");
    
    if (burnAdjust !== 0 || revenueOutlook !== 1) {
      impactEl.classList.remove("hidden");
      
      const baselineEndCash = cash + (revenue - burn) * 4;
      const scenarioEndCash = endCash;
      const diff = scenarioEndCash - baselineEndCash;
      
      if (diff > 10) {
        impactText.innerHTML = `ğŸ’š This scenario adds <strong class="text-emerald-400">${currency}${Math.round(diff * multiplier)}k</strong> to your runway`;
      } else if (diff < -10) {
        impactText.innerHTML = `ğŸ”´ This scenario costs <strong class="text-red-400">${currency}${Math.round(Math.abs(diff) * multiplier)}k</strong> vs baseline`;
      } else {
        impactText.innerHTML = `Similar to baseline scenario`;
      }
    } else {
      impactEl.classList.add("hidden");
    }
  }
  
  renderForecastChart(points, currency, multiplier) {
    const svg = document.getElementById("forecastChart");
    if (!svg) return;
    
    const width = svg.clientWidth || 280;
    const height = 80;
    const padding = { left: 35, right: 10, top: 10, bottom: 5 };
    
    // Find max value for scaling
    const maxCash = Math.max(...points.map(p => p.cash), 1);
    
    // Scale functions
    const xScale = (q) => padding.left + (q / 4) * (width - padding.left - padding.right);
    const yScale = (val) => height - padding.bottom - (val / maxCash) * (height - padding.top - padding.bottom);
    
    // Build path
    const pathPoints = points.map(p => `${xScale(p.quarter)},${yScale(p.cash)}`);
    
    // Gradient for fill under line
    const lastPoint = points[points.length - 1];
    const isPositive = lastPoint.cash > 0;
    const lineColor = lastPoint.cash <= 0 ? '#ef4444' : 
                      lastPoint.cash < points[0].cash * 0.5 ? '#f59e0b' : '#10b981';
    
    let chartHTML = `
      <defs>
        <linearGradient id="cashGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color:${lineColor};stop-opacity:0.3"/>
          <stop offset="100%" style="stop-color:${lineColor};stop-opacity:0"/>
        </linearGradient>
      </defs>
      
      <!-- Y-axis labels -->
      <text x="2" y="${yScale(maxCash) + 4}" fill="#94a3b8" font-size="9">${currency}${Math.round(maxCash * multiplier)}k</text>
      <text x="2" y="${yScale(0) - 2}" fill="#94a3b8" font-size="9">${currency}0</text>
      
      <!-- Grid lines -->
      <line x1="${padding.left}" y1="${yScale(maxCash)}" x2="${width - padding.right}" y2="${yScale(maxCash)}" stroke="#475569" stroke-width="0.5" stroke-dasharray="3,3"/>
      <line x1="${padding.left}" y1="${yScale(maxCash/2)}" x2="${width - padding.right}" y2="${yScale(maxCash/2)}" stroke="#475569" stroke-width="0.5" stroke-dasharray="3,3"/>
      <line x1="${padding.left}" y1="${yScale(0)}" x2="${width - padding.right}" y2="${yScale(0)}" stroke="#64748b" stroke-width="1"/>
    `;
    
    // Area fill under line
    const areaPath = `M ${xScale(0)},${yScale(0)} ` + 
                     points.map(p => `L ${xScale(p.quarter)},${yScale(p.cash)}`).join(' ') + 
                     ` L ${xScale(4)},${yScale(0)} Z`;
    chartHTML += `<path d="${areaPath}" fill="url(#cashGradient)"/>`;
    
    // Main line
    chartHTML += `<polyline points="${pathPoints.join(' ')}" fill="none" stroke="${lineColor}" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>`;
    
    // Data points
    points.forEach((p, i) => {
      const x = xScale(p.quarter);
      const y = yScale(p.cash);
      const pointColor = p.cash <= 0 ? '#ef4444' : lineColor;
      chartHTML += `<circle cx="${x}" cy="${y}" r="${i === 0 ? 5 : 4}" fill="${pointColor}" stroke="#1e293b" stroke-width="2"/>`;
      
      // Value label on first and last point
      if (i === 0 || i === points.length - 1) {
        const labelY = i === 0 ? y - 10 : (p.cash < points[0].cash * 0.3 ? y - 10 : y + 15);
        chartHTML += `<text x="${x}" y="${labelY}" fill="white" font-size="10" font-weight="bold" text-anchor="middle">${currency}${Math.round(p.cash * multiplier)}k</text>`;
      }
    });
    
    svg.innerHTML = chartHTML;
  }
  
  resetForecastAssumptions() {
    const burnSlider = document.getElementById("burnAdjustSlider");
    const revenueSlider = document.getElementById("revenueOutlookSlider");
    
    if (burnSlider) burnSlider.value = 0;
    if (revenueSlider) revenueSlider.value = 1;
    
    this.updateForecast();
    UIEffects.showToast('Assumptions reset', 'neutral', 'ğŸ”„');
  }
  
  closeFinanceDetailsModal() {
    document.getElementById("financeDetailsModal").classList.add("hidden");
    document.getElementById("financeDetailsModal").classList.remove("flex");
  }

  showRaiseModal() {
    const canRaise = this.completedMilestones.length > this.lastRaiseMilestoneCount;
    const currentVal = this.metrics.val;
    const currentEquity = this.metrics.equity;
    
    document.getElementById("raiseCurrentVal").textContent = `Â£${currentVal}k`;
    document.getElementById("raiseCurrentEquity").textContent = `${currentEquity.toFixed(1)}%`;
    
    // Render competitive position panel
    this.renderCompetitivePositionPanel();
    
    const container = document.getElementById("raiseOptions");
    
    if (!canRaise) {
      container.innerHTML = `
        <div class="text-center py-8 text-slate-500">
          <p class="text-lg mb-2">ğŸ¯ Complete a milestone to unlock funding</p>
          <p>You can raise one round per milestone. Complete your next milestone to attract new investors.</p>
        </div>
      `;
    } else if (this.metrics.equity < 10) {
      container.innerHTML = `
        <div class="text-center py-8 text-slate-500">
          <p class="text-lg mb-2">âš  Insufficient equity</p>
          <p>You need at least 10% equity to raise funding.</p>
        </div>
      `;
    } else {
      // Get follow-on investors based on initial funding stage
      const options = this.generateFundingOptions();
      
      // Check if we're mid-milestone for warning display
      const anyMidMilestone = options.some(opt => opt.isMidMilestone);
      
      // === INVESTOR RELATIONSHIP WARNING ===
      const relationship = this.investorRelationship || 1;
      const relLabel = this.getRelationshipLabel(relationship);
      
      let warningHtml = '';
      
      // Relationship warning (most important - show first)
      if (relationship === 0) {
        warningHtml += `
          <div class="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg">
            <p class="text-sm text-red-800">
              <span class="font-bold">ğŸš« Investor Relationship: Skeptical</span><br>
              Your existing investors have lost confidence and <strong>will not offer follow-on funding</strong>. 
              New investors are wary of your track record and demand worse terms (+20% dilution, âˆ’15% cash).
            </p>
          </div>
        `;
      } else if (relationship >= 2) {
        const bonusText = relationship === 3 
          ? "Your champion investors offer excellent terms and vouch for you with new investors."
          : "Your supportive investors offer favorable terms.";
        warningHtml += `
          <div class="mb-4 p-3 bg-emerald-50 border border-emerald-200 rounded-lg">
            <p class="text-sm text-emerald-800">
              <span class="font-bold">âœ¨ Investor Relationship: ${relLabel.label}</span><br>
              ${bonusText}
            </p>
          </div>
        `;
      }
      
      // Mid-milestone warning
      if (anyMidMilestone) {
        warningHtml += `
          <div class="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg">
            <p class="text-sm text-amber-800">
              <span class="font-bold">âš ï¸ Mid-Milestone Terms:</span> 
              New investors demand 25% more equity when you haven't recently hit a milestone. 
              ${relationship > 0 ? 'Your existing investors offer better terms.' : ''}
            </p>
          </div>
        `;
      }
      
      container.innerHTML = warningHtml + options.map(opt => `
        <div onclick="game.acceptFunding('${opt.id}')" class="hire-card border-2 border-slate-200 rounded-xl p-4 bg-white cursor-pointer hover:border-emerald-400 hover:shadow-lg transition-all ${opt.isMidMilestone ? 'opacity-90' : ''} ${opt.relationshipPenalty ? 'border-red-200' : ''} ${opt.relationshipBonus ? 'border-emerald-200' : ''}">
          <div class="flex gap-3">
            <div class="w-16 h-16 flex-shrink-0">
              ${opt.photo}
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex items-start justify-between gap-2">
                <div class="min-w-0">
                  <div class="font-bold text-slate-800">${opt.name}</div>
                  <div class="text-xs text-slate-500">${opt.title}</div>
                  ${opt.relationshipBonus ? '<div class="text-xs text-emerald-600 font-medium">ğŸ’š Strong relationship bonus</div>' : ''}
                  ${opt.relationshipPenalty ? '<div class="text-xs text-red-600 font-medium">âš ï¸ Reputation penalty</div>' : ''}
                  ${opt.isMidMilestone ? '<div class="text-xs text-amber-600 font-medium">ğŸ“ˆ Mid-milestone premium</div>' : ''}
                  ${opt.competitiveStatus === 'struggling' ? '<div class="text-xs text-red-600 font-medium">ğŸ“‰ Weak position penalty</div>' : ''}
                  ${opt.competitiveStatus === 'behind' ? '<div class="text-xs text-orange-600 font-medium">ğŸ“‰ Behind rivals</div>' : ''}
                  ${opt.competitiveStatus === 'dominant' ? '<div class="text-xs text-emerald-600 font-medium">ğŸ† Market leader bonus</div>' : ''}
                </div>
                <div class="text-right flex-shrink-0">
                  <div class="text-emerald-600 font-bold text-lg">+Â£${opt.cash}k</div>
                  <div class="text-xs ${opt.dilution > 20 ? 'text-red-500 font-bold' : opt.dilution > 10 ? 'text-amber-600' : 'text-slate-500'}">
                    Takes ${opt.dilution}%
                  </div>
                  <div class="text-xs text-slate-400">â†’ Â£${opt.newVal}k val</div>
                </div>
              </div>
              <div class="mt-2 p-2 bg-amber-50 rounded border-l-2 border-amber-400">
                <p class="text-xs text-amber-800 italic">"${opt.personality}"</p>
              </div>
              ${opt.benefits ? `
                <div class="mt-2 p-2 bg-emerald-50 rounded border-l-2 border-emerald-400">
                  <p class="text-xs text-emerald-800">âœ“ ${opt.benefits}</p>
                </div>
              ` : ''}
            </div>
          </div>
        </div>
      `).join("");
    }
    
    document.getElementById("raiseModal").classList.remove("hidden");
    document.getElementById("raiseModal").classList.add("flex");
  }
  
  renderCompetitivePositionPanel() {
    const panel = document.getElementById("raiseCompetitivePanel");
    const position = this.getCompetitivePosition();
    
    if (!position || position.total <= 1) {
      panel.classList.add("hidden");
      return;
    }
    
    panel.classList.remove("hidden");
    
    const statusConfig = {
      dominant: { 
        bgClass: 'from-emerald-50', borderClass: 'border-emerald-200', textClass: 'text-emerald-700',
        icon: 'ğŸ†', label: 'Market Leader', desc: 'VCs are competing to invest. Better terms available.' 
      },
      leading: { 
        bgClass: 'from-green-50', borderClass: 'border-green-200', textClass: 'text-green-700',
        icon: 'ğŸ“ˆ', label: 'Leading', desc: 'Strong position. Good negotiating leverage.' 
      },
      competitive: { 
        bgClass: 'from-blue-50', borderClass: 'border-blue-200', textClass: 'text-blue-700',
        icon: 'âš”ï¸', label: 'Competitive', desc: 'Neck and neck with rivals. Standard terms.' 
      },
      behind: { 
        bgClass: 'from-orange-50', borderClass: 'border-orange-200', textClass: 'text-orange-700',
        icon: 'ğŸ“‰', label: 'Behind', desc: 'Rivals are ahead. Investors want a discount.' 
      },
      struggling: { 
        bgClass: 'from-red-50', borderClass: 'border-red-200', textClass: 'text-red-700',
        icon: 'âš ï¸', label: 'Struggling', desc: 'Falling behind. Expect tough terms.' 
      }
    };
    
    const config = statusConfig[position.status] || statusConfig.competitive;
    
    // Build leaderboard HTML - show milestones prominently
    const leaderboardHtml = position.leaderboard.map((entry, i) => {
      const isPlayer = entry.isPlayer;
      const bgColor = isPlayer ? 'bg-indigo-100 border-indigo-300' : 'bg-slate-50 border-slate-200';
      const textColor = isPlayer ? 'text-indigo-700' : 'text-slate-700';
      const milestones = entry.milestones || 0;
      return `
        <div class="flex items-center gap-2 px-2 py-1 rounded border ${bgColor}">
          <span class="text-xs font-bold ${textColor}">#${i + 1}</span>
          <span class="text-xs ${textColor}">${isPlayer ? 'â­ ' : ''}${entry.name}</span>
          <span class="text-xs ml-auto ${milestones > (position.playerMilestones || 0) && !isPlayer ? 'text-red-500 font-medium' : 'text-slate-500'}">${milestones}/3 ğŸ¯</span>
          ${entry.recentFunding ? '<span class="text-[10px] text-emerald-600">ğŸ’°</span>' : ''}
        </div>
      `;
    }).join('');
    
    // Sector heat warning
    let sectorHeatHtml = '';
    if (position.sectorHeat >= 2) {
      sectorHeatHtml = `
        <div class="mt-2 p-2 bg-amber-50 rounded border border-amber-200">
          <p class="text-xs text-amber-800">
            <span class="font-bold">ğŸ”¥ Sector Heat:</span> ${position.sectorHeat} competitors raised recently. VCs have allocation fatigueâ€”expect tougher terms.
          </p>
        </div>
      `;
    }
    
    panel.innerHTML = `
      <div class="p-4 bg-gradient-to-r ${config.bgClass} to-slate-50 rounded-xl border ${config.borderClass}">
        <div class="flex items-start justify-between gap-4">
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-1">
              <span class="text-xl">${config.icon}</span>
              <span class="font-bold ${config.textClass}">${config.label}</span>
              <span class="text-xs text-slate-500">(#${position.rank} of ${position.total})</span>
            </div>
            <p class="text-sm text-slate-600 mb-2">${config.desc}</p>
            ${position.leadRival && !position.leaderboard[0]?.isPlayer ? `
              <p class="text-xs text-slate-500">
                ${position.leadRival.logo || 'ğŸ¢'} <strong>${position.leadRival.name}</strong> leads by ${Math.abs(Math.round(position.gap))} points
                ${position.leadRival.recentFunding ? 'â€¢ Just raised ğŸ’°' : ''}
              </p>
            ` : ''}
          </div>
          <div class="flex-shrink-0 w-40">
            <div class="text-[10px] text-slate-500 uppercase font-medium mb-1">Leaderboard</div>
            <div class="space-y-1">
              ${leaderboardHtml}
            </div>
          </div>
        </div>
        ${sectorHeatHtml}
      </div>
    `;
  }

  generateFundingOptions() {
    const val = this.metrics.val;
    const stage = this.completedMilestones.length;
    const marketMod = this.market.type === "positive" ? 1.3 : this.market.type === "negative" ? 0.7 : 1.0;
    
    // Get competitive position modifier
    const competitiveMod = this.getCompetitiveFundingModifier();
    
    // === INVESTOR RELATIONSHIP MODIFIER ===
    // Relationship affects funding terms and availability
    const relationship = this.investorRelationship || 1;
    const relationshipMod = this.getRelationshipFundingModifier(relationship);
    
    // Mid-milestone penalty: if you haven't completed a milestone recently, terms are worse
    // Check if we just completed a milestone (within last 2 turns) or are mid-milestone
    const turnsSinceLastMilestone = this.lastMilestoneCompletedTurn 
      ? this.turn - this.lastMilestoneCompletedTurn 
      : this.turn; // If never completed, use current turn
    const isMidMilestone = turnsSinceLastMilestone > 2;
    const midMilestonePenalty = isMidMilestone ? 1.25 : 1.0; // 25% more dilution mid-milestone
    
    // Get investors based on initial funding path
    const fundingStage = this.fundingStage || "bootstrap";
    let investors = [...(FOLLOW_ON_INVESTORS[fundingStage] || FOLLOW_ON_INVESTORS.bootstrap)];
    
    // After completing Milestone 1, add VC options for bootstrap/angel paths
    if (stage >= 1 && (fundingStage === "bootstrap" || fundingStage === "angel")) {
      const vcOptions = FOLLOW_ON_INVESTORS.vc_unlocked || [];
      investors = [...investors, ...vcOptions];
    }
    
    // === FILTER OUT EXISTING INVESTORS IF RELATIONSHIP IS SKEPTICAL ===
    if (relationship === 0) {
      investors = investors.filter(inv => 
        inv.id !== 'fof_existing' && inv.id !== 'fof_insideround'
      );
    }
    
    // Generate options from each investor
    return investors.map(inv => {
      // For angel follow-on, customize based on which angel was initially chosen
      let effectiveInv = { ...inv };
      if (fundingStage === "angel" && inv.id === "fof_existing" && this.funder) {
        const angelFollowOn = FOLLOW_ON_INVESTORS.angel_followon?.[this.funder.id];
        if (angelFollowOn) {
          effectiveInv = {
            ...inv,
            name: this.funder.name,
            title: "Your Angel Follows On",
            photo: this.funder.photo,
            baseCash: angelFollowOn.baseCash,
            baseDilution: angelFollowOn.baseDilution,
            valMult: angelFollowOn.valMult,
            personality: angelFollowOn.personality,
            benefits: angelFollowOn.benefits,
            bonus: angelFollowOn.bonus
          };
        }
      }
      
      // Scale cash and dilution based on stage progress and market
      const cashMult = 1 + (stage * 0.4); // More cash available as you progress
      const dilutionMult = 1 + (stage * 0.15); // Slightly more dilution for later rounds
      
      // Financial skill reduces dilution (5% reduction per point above 2)
      const financialMod = game.founderBonuses?.financial > 2 
        ? 1 - ((game.founderBonuses.financial - 2) * 0.05) 
        : 1;
      
      // Existing investors don't apply mid-milestone penalty (they're supportive)
      // They also aren't affected by competitive position (insider support)
      const isExistingInvestor = inv.id === 'fof_existing' || inv.id === 'fof_insideround';
      const effectiveMidMilestonePenalty = isExistingInvestor ? 1.0 : midMilestonePenalty;
      const effectiveCompetitiveCashMod = isExistingInvestor ? 1.0 : competitiveMod.cashMod;
      const effectiveCompetitiveDilutionMod = isExistingInvestor ? 1.0 : competitiveMod.dilutionMod;
      const effectiveCompetitiveValMod = isExistingInvestor ? 1.0 : competitiveMod.valMod;
      
      // === APPLY RELATIONSHIP MODIFIER ===
      // Existing investors get relationship bonus/penalty
      // New investors get reputation effect (good relationship = your investors vouch for you)
      const effectiveRelCashMod = isExistingInvestor ? relationshipMod.existingCashMod : relationshipMod.newCashMod;
      const effectiveRelDilutionMod = isExistingInvestor ? relationshipMod.existingDilutionMod : relationshipMod.newDilutionMod;
      
      const cash = Math.round(effectiveInv.baseCash * cashMult * marketMod * effectiveCompetitiveCashMod * effectiveRelCashMod);
      const dilution = Math.round(effectiveInv.baseDilution * dilutionMult * financialMod * effectiveMidMilestonePenalty * effectiveCompetitiveDilutionMod * effectiveRelDilutionMod);
      const newVal = Math.round(val * effectiveInv.valMult * (1 + stage * 0.1) * (isMidMilestone ? 0.9 : 1.0) * effectiveCompetitiveValMod);
      
      return {
        id: inv.id,
        name: effectiveInv.name,
        title: effectiveInv.title,
        photo: effectiveInv.photo,
        cash: cash,
        dilution: dilution,
        newVal: newVal,
        personality: effectiveInv.personality,
        benefits: effectiveInv.benefits || '',
        bonus: effectiveInv.bonus || {},
        isVC: inv.id.includes('seedvc') || inv.id.includes('seriesa') || inv.id.includes('growth'),
        isMidMilestone: isMidMilestone && !isExistingInvestor,
        competitiveStatus: isExistingInvestor ? null : competitiveMod.position.status,
        relationshipPenalty: relationship === 0, // Flag for UI
        relationshipBonus: relationship >= 2 && isExistingInvestor // Flag for UI
      };
    });
  }
  
  // === INVESTOR RELATIONSHIP FUNDING MODIFIER ===
  getRelationshipFundingModifier(relationship) {
    // Relationship levels: 0=Skeptical, 1=Neutral, 2=Supportive, 3=Champion
    switch(relationship) {
      case 0: // Skeptical - existing investors won't fund, new investors wary
        return {
          existingCashMod: 0,      // Won't offer (filtered out above)
          existingDilutionMod: 0,
          newCashMod: 0.85,        // 15% less cash from new investors
          newDilutionMod: 1.20     // 20% more dilution demanded
        };
      case 1: // Neutral - normal terms
        return {
          existingCashMod: 1.0,
          existingDilutionMod: 1.0,
          newCashMod: 1.0,
          newDilutionMod: 1.0
        };
      case 2: // Supportive - existing investors generous, reputation helps
        return {
          existingCashMod: 1.10,   // 10% more from existing
          existingDilutionMod: 0.90, // 10% less dilution
          newCashMod: 1.05,        // 5% more from new (reputation)
          newDilutionMod: 0.95     // 5% less dilution
        };
      case 3: // Champion - excellent terms all around
        return {
          existingCashMod: 1.20,   // 20% more from existing
          existingDilutionMod: 0.80, // 20% less dilution
          newCashMod: 1.10,        // 10% more from new
          newDilutionMod: 0.90     // 10% less dilution
        };
      default:
        return {
          existingCashMod: 1.0,
          existingDilutionMod: 1.0,
          newCashMod: 1.0,
          newDilutionMod: 1.0
        };
    }
  }

  acceptFunding(optionId) {
    const options = this.generateFundingOptions();
    const opt = options.find(o => o.id === optionId);
    if (!opt) return;
    
    // Check if this deal would result in negative equity
    const resultingEquity = this.metrics.equity - opt.dilution;
    if (resultingEquity < 0) {
      this.showNegativeEquityWarning(opt);
      return;
    }
    
    // Play funding sound
    soundManager.playFunding();
    
    // Apply funding
    this.metrics.cash += opt.cash;
    this.metrics.equity -= opt.dilution;
    this.metrics.val = opt.newVal;
    this.lastRaiseMilestoneCount = this.completedMilestones.length; // Track which milestone count we raised at
    
    // Fundraising costs time and attention - costs 1 AP this quarter
    this.fundingAPCost = 1;
    
    // Check if this is follow-on from existing investor
    const isExistingInvestor = optionId === 'fof_existing' || optionId === 'fof_insideround';
    
    // === LOG RELATIONSHIP IMPACT ===
    const relationship = this.investorRelationship || 1;
    if (opt.relationshipPenalty) {
      this.log("âš ï¸ Your damaged investor reputation resulted in worse funding terms.");
    } else if (opt.relationshipBonus) {
      this.log("ğŸ’š Strong investor relationship secured favorable terms.");
    }
    
    if (isExistingInvestor) {
      // Don't add new investor - just boost relationship with lead investor
      const leadInvestor = this.investors.find(inv => inv.isLead);
      if (leadInvestor) {
        leadInvestor.relationship = Math.min(5, leadInvestor.relationship + 1);
        this.log(`${leadInvestor.funder.name} doubled down on their investment. Relationship strengthened!`);
        
        // === IMPROVE INVESTOR RELATIONSHIP METER ===
        // Getting follow-on from existing investors shows alignment
        if (this.investorRelationship < 3) {
          this.updateInvestorRelationship(1, "successful follow-on investment");
        }
      }
    } else {
      // Find the investor from regular pool or VC unlocked pool
      let followOnInvestor = FOLLOW_ON_INVESTORS[this.fundingStage]?.find(f => f.id === optionId);
      if (!followOnInvestor) {
        followOnInvestor = FOLLOW_ON_INVESTORS.vc_unlocked?.find(f => f.id === optionId);
      }
      
      if (followOnInvestor) {
        // Check if this investor already exists (by name)
        const existingInvestor = this.investors.find(inv => inv.funder.name === followOnInvestor.name);
        
        if (existingInvestor) {
          // Already invested - just boost relationship
          existingInvestor.relationship = Math.min(5, existingInvestor.relationship + 1);
        } else {
          // Map follow-on investor to a funder-like structure for advice
          const pseudoFunder = {
            id: followOnInvestor.id,
            name: followOnInvestor.name,
            title: followOnInvestor.title,
            photo: followOnInvestor.photo,
            personality: followOnInvestor.personality
          };
          
          this.investors.push({
            funder: pseudoFunder,
            funderId: this.mapFollowOnToFunderType(followOnInvestor.id),
            relationship: 3,
            isLead: false,
            joinedTurn: this.turn
          });
        }
        
        // Regenerate advice to include new investor
        this.generateAllFunderAdvice();
        this.renderFunderAdvice();
      }
    }
    
    // Apply any bonuses from the investor
    Object.entries(opt.bonus).forEach(([k, v]) => {
      if (this.metrics[k] !== undefined) this.metrics[k] += v;
    });
    
    this.closeRaiseModal();
    this.update();
    this.renderBoardroom(); // Update boardroom display including AP to show fundraising cost
    
    const bonusText = Object.keys(opt.bonus).length > 0 
      ? ` ${Object.entries(opt.bonus).map(([k,v]) => `${v > 0 ? '+' : ''}${v} ${k}`).join(', ')}.`
      : '';
    this.log(`${opt.name} invested Â£${opt.cash}k for ${opt.dilution}%. New val: Â£${opt.newVal}k.${bonusText} (-1 AP for fundraising)`);
  }
  
  // Map follow-on investor types to funder personality types for advice generation
  mapFollowOnToFunderType(followOnId) {
    const mapping = {
      // Bootstrap follow-ons
      'fof_fff': 'operatorAngel', // F&F are like supportive operators
      'fof_microangel': 'techAngel', // Local entrepreneur, technical
      'fof_crowdfund': 'dragon', // Crowd wants visibility/growth
      // Angel follow-ons  
      'fof_existing': null, // Use existing investor's type
      'fof_superangel': 'tier1VC', // Super angels think like VCs
      'fof_seedvc': 'tier1VC', // Seed VCs are growth focused
      // VC follow-ons
      'fof_insideround': null, // Use existing
      'fof_seriesa': 'tier1VC', // Polaris = tier 1
      'fof_growth': 'tier1VC' // Velocity = aggressive growth
    };
    return mapping[followOnId] || 'techAngel';
  }

  closeRaiseModal() {
    document.getElementById("raiseModal").classList.add("hidden");
    document.getElementById("raiseModal").classList.remove("flex");
  }

  showNegativeEquityWarning(opt) {
    const currentEquity = this.metrics.equity;
    const resultingEquity = currentEquity - opt.dilution;
    const region = getRegion();
    
    const modalHTML = `
      <div id="negativeEquityModal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
          <div class="text-center mb-4">
            <div class="text-5xl mb-3">âš ï¸</div>
            <h2 class="text-xl font-bold text-red-600 mb-2">Deal Rejected</h2>
            <h3 class="text-lg font-semibold text-slate-700">Insufficient Equity</h3>
          </div>
          
          <div class="bg-red-50 border border-red-200 rounded-xl p-4 mb-4">
            <p class="text-slate-700 mb-3">
              This funding round requires <strong>${opt.dilution}%</strong> equity, but you only have <strong>${currentEquity.toFixed(1)}%</strong> remaining.
            </p>
            <p class="text-slate-700 mb-3">
              Accepting this deal would leave you with <strong class="text-red-600">${resultingEquity.toFixed(1)}%</strong> ownership â€” meaning you'd lose control of your company entirely.
            </p>
            <p class="text-slate-600 text-sm">
              ğŸ’¡ <em>Consider raising less money, finding investors who take less equity, or growing the business to improve your negotiating position.</em>
            </p>
          </div>
          
          <div class="bg-slate-100 rounded-lg p-3 mb-4">
            <div class="flex justify-between text-sm mb-1">
              <span class="text-slate-600">Your current equity:</span>
              <span class="font-bold text-slate-800">${currentEquity.toFixed(1)}%</span>
            </div>
            <div class="flex justify-between text-sm mb-1">
              <span class="text-slate-600">This deal requires:</span>
              <span class="font-bold text-red-600">-${opt.dilution}%</span>
            </div>
            <div class="border-t border-slate-300 my-2"></div>
            <div class="flex justify-between text-sm">
              <span class="text-slate-600">Would leave you with:</span>
              <span class="font-bold text-red-600">${resultingEquity.toFixed(1)}%</span>
            </div>
          </div>
          
          <button onclick="game.closeNegativeEquityWarning()" 
                  class="w-full bg-slate-700 text-white py-3 rounded-xl font-semibold hover:bg-slate-800 transition-colors">
            Understood â€” Choose Different Terms
          </button>
        </div>
      </div>
    `;
    
    // Remove any existing modal first
    const existing = document.getElementById("negativeEquityModal");
    if (existing) existing.remove();
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
  }

  closeNegativeEquityWarning() {
    const modal = document.getElementById("negativeEquityModal");
    if (modal) modal.remove();
  }

  showHiringEquityWarning(candidate, equity) {
    const currentEquity = this.metrics.equity;
    const resultingEquity = currentEquity - equity;
    
    const modalHTML = `
      <div id="hiringEquityModal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
          <div class="text-center mb-4">
            <div class="text-5xl mb-3">âš ï¸</div>
            <h2 class="text-xl font-bold text-red-600 mb-2">Cannot Complete Hire</h2>
            <h3 class="text-lg font-semibold text-slate-700">Insufficient Equity</h3>
          </div>
          
          <div class="bg-red-50 border border-red-200 rounded-xl p-4 mb-4">
            <p class="text-slate-700 mb-3">
              <strong>${candidate.name}</strong> requires <strong>${equity}%</strong> equity, but you only have <strong>${currentEquity.toFixed(1)}%</strong> remaining.
            </p>
            <p class="text-slate-700 mb-3">
              Granting this equity would leave you with <strong class="text-red-600">${resultingEquity.toFixed(1)}%</strong> ownership â€” you cannot give away more equity than you own.
            </p>
            <p class="text-slate-600 text-sm">
              ğŸ’¡ <em>Try negotiating a lower equity offer, or hire candidates with lower equity expectations.</em>
            </p>
          </div>
          
          <div class="bg-slate-100 rounded-lg p-3 mb-4">
            <div class="flex justify-between text-sm mb-1">
              <span class="text-slate-600">Your current equity:</span>
              <span class="font-bold text-slate-800">${currentEquity.toFixed(1)}%</span>
            </div>
            <div class="flex justify-between text-sm mb-1">
              <span class="text-slate-600">This hire requires:</span>
              <span class="font-bold text-red-600">-${equity}%</span>
            </div>
            <div class="border-t border-slate-300 my-2"></div>
            <div class="flex justify-between text-sm">
              <span class="text-slate-600">Would leave you with:</span>
              <span class="font-bold text-red-600">${resultingEquity.toFixed(1)}%</span>
            </div>
          </div>
          
          <button onclick="game.closeHiringEquityWarning()" 
                  class="w-full bg-slate-700 text-white py-3 rounded-xl font-semibold hover:bg-slate-800 transition-colors">
            Understood
          </button>
        </div>
      </div>
    `;
    
    // Remove any existing modal first
    const existing = document.getElementById("hiringEquityModal");
    if (existing) existing.remove();
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
  }

  closeHiringEquityWarning() {
    const modal = document.getElementById("hiringEquityModal");
    if (modal) modal.remove();
  }

  showExecEquityWarning(exec) {
    const currentEquity = this.metrics.equity;
    const resultingEquity = currentEquity - exec.equity;
    
    const modalHTML = `
      <div id="execEquityModal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
          <div class="text-center mb-4">
            <div class="text-5xl mb-3">âš ï¸</div>
            <h2 class="text-xl font-bold text-red-600 mb-2">Cannot Hire Executive</h2>
            <h3 class="text-lg font-semibold text-slate-700">Insufficient Equity</h3>
          </div>
          
          <div class="bg-red-50 border border-red-200 rounded-xl p-4 mb-4">
            <p class="text-slate-700 mb-3">
              <strong>${exec.name}</strong> requires <strong>${exec.equity}%</strong> equity, but you only have <strong>${currentEquity.toFixed(1)}%</strong> remaining.
            </p>
            <p class="text-slate-700 mb-3">
              You cannot hire this executive without losing control of your company.
            </p>
            <p class="text-slate-600 text-sm">
              ğŸ’¡ <em>Consider choosing an executive with lower equity requirements, or growing the business before expanding your leadership team.</em>
            </p>
          </div>
          
          <button onclick="game.closeExecEquityWarning()" 
                  class="w-full bg-slate-700 text-white py-3 rounded-xl font-semibold hover:bg-slate-800 transition-colors">
            Understood
          </button>
        </div>
      </div>
    `;
    
    // Remove any existing modal first
    const existing = document.getElementById("execEquityModal");
    if (existing) existing.remove();
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
  }

  closeExecEquityWarning() {
    const modal = document.getElementById("execEquityModal");
    if (modal) modal.remove();
  }

  update() {
    // === CAPTURE PREVIOUS VALUES FOR ANIMATIONS ===
    const prevCash = this.previousMetrics.cash;
    const prevBurn = this.previousMetrics.burn;
    const prevRunway = this.previousMetrics.runway;
    const prevValuation = this.previousMetrics.valuation;
    const region = getRegion();
    
    // Calculate new values
    const newCash = Math.round(this.metrics.cash * region.currencyMultiplier);
    const newBurn = Math.round(this.metrics.burn * region.currencyMultiplier);
    const grossRunway = this.metrics.burn > 0 ? Math.floor(this.metrics.cash / this.metrics.burn) : 99;
    const newValuation = Math.round(this.metrics.val * region.currencyMultiplier);
    
    document.getElementById("turnDisplay").textContent = `Q${this.turn}`;
    
    // Update chapter label
    this.updateChapterLabel();
    
    // === ANIMATED HEADER KPIs ===
    const headerCashEl = document.getElementById("headerCash");
    const headerValEl = document.getElementById("headerVal");
    const runwayEl = document.getElementById("headerRunway");
    
    // Animate cash if changed
    if (prevCash !== null && prevCash !== newCash) {
      const cashDiff = newCash - prevCash;
      UIEffects.animateNumber(headerCashEl, prevCash, newCash, {
        formatter: (v) => `${region.currency}${Math.round(v)}k`
      });
      UIEffects.animateKPI(headerCashEl.parentElement, cashDiff);
      
      // Show toast for significant cash changes
      if (Math.abs(cashDiff) >= 20) {
        UIEffects.showKPIChange('Cash', prevCash, newCash, {
          formatter: (v) => `${region.currency}${Math.round(v)}k`,
          isGood: cashDiff > 0
        });
      }
    } else {
      headerCashEl.textContent = `${region.currency}${newCash}k`;
    }
    
    // Animate valuation if changed
    if (prevValuation !== null && prevValuation !== newValuation) {
      const valDiff = newValuation - prevValuation;
      UIEffects.animateNumber(headerValEl, prevValuation, newValuation, {
        formatter: (v) => `${region.currency}${Math.round(v)}k`
      });
      UIEffects.animateKPI(headerValEl.parentElement, valDiff);
    } else {
      headerValEl.textContent = `${region.currency}${newValuation}k`;
    }
    
    document.getElementById("headerMilestones").textContent = `${this.completedMilestones.length}/3`;
    
    // Show extreme mode indicator
    const extremeIndicator = document.getElementById("extremeModeIndicator");
    if (this.extremeMode) {
      extremeIndicator.classList.remove("hidden");
    } else {
      extremeIndicator.classList.add("hidden");
    }
    
    // Show location in header
    if (this.location) {
      const locEl = document.getElementById("locationDisplay");
      locEl.textContent = `ğŸ“ ${this.location.name}`;
      locEl.classList.remove("hidden");
    }
    
    // Animate runway if changed
    if (prevRunway !== null && prevRunway !== grossRunway) {
      const runwayDiff = grossRunway - prevRunway;
      UIEffects.animateNumber(runwayEl, prevRunway, grossRunway, {
        formatter: (v) => `${Math.round(v)}q`
      });
      UIEffects.animateKPI(runwayEl.parentElement || runwayEl, runwayDiff);
      
      // Toast for runway changes
      if (Math.abs(runwayDiff) >= 1) {
        UIEffects.showKPIChange('Runway', prevRunway, grossRunway, {
          formatter: (v) => `${Math.round(v)}q`,
          isGood: runwayDiff > 0
        });
      }
    } else {
      runwayEl.textContent = `${grossRunway}q`;
    }
    
    // Runway color coding
    if (grossRunway <= 2) {
      runwayEl.className = "font-mono font-bold text-red-500 animate-pulse";
    } else if (grossRunway <= 4) {
      runwayEl.className = "font-mono font-bold text-amber-400";
    } else {
      runwayEl.className = "font-mono font-bold text-emerald-400";
    }
    
    // Store new values for next comparison
    this.previousMetrics.cash = newCash;
    this.previousMetrics.burn = newBurn;
    this.previousMetrics.runway = grossRunway;
    this.previousMetrics.valuation = newValuation;
    
    // Update funding card
    this.updateFundingCard(grossRunway);
    
    // Update unlocks panel
    this.renderUnlocksPanel();

    // Default runway display uses gross runway, but may be overridden by net burn below
    let displayRunway = grossRunway;
    
    document.getElementById("sciScore").textContent = Math.round(this.metrics.sci);
    document.getElementById("devScore").textContent = Math.round(this.metrics.dev);
    document.getElementById("mktScore").textContent = Math.round(this.metrics.mkt);
    document.getElementById("hrScore").textContent = Math.round(this.metrics.hr);
    
    document.getElementById("sciBar").style.width = Math.min(100, this.metrics.sci) + "%";
    document.getElementById("devBar").style.width = Math.min(100, this.metrics.dev) + "%";
    document.getElementById("mktBar").style.width = Math.min(100, this.metrics.mkt) + "%";
    document.getElementById("hrBar").style.width = Math.min(100, this.metrics.hr) + "%";
    
    document.getElementById("burnDisplay").textContent = `${getRegion().currency}${Math.round(this.metrics.burn * getRegion().currencyMultiplier)}k/q`;
    document.getElementById("equityDisplay").textContent = `${this.metrics.equity.toFixed(1)}%`;
    
    // === REVENUE SYSTEM: Update revenue displays ===
    const revenueDisplay = document.getElementById("revenueDisplay");
    const customerCountDisplay = document.getElementById("customerCountDisplay");
    const netBurnDisplay = document.getElementById("netBurnDisplay");
    const projectionStatus = document.getElementById("projectionStatus");
    const projectionVariance = document.getElementById("projectionVariance");
    const projectionsBtn = document.getElementById("projectionsBtn");
    
    if (this.revenueModel) {
      const revenueCalc = this.calculateQuarterlyRevenue();
      
      if (revenueDisplay) {
        revenueDisplay.textContent = `${getRegion().currency}${revenueCalc.gross}k/q`;
      }
      if (customerCountDisplay) {
        customerCountDisplay.textContent = this.customers.length.toString();
      }
      
      // Net burn (burn minus revenue contribution)
      const netBurn = this.metrics.burn - revenueCalc.net;
      if (netBurnDisplay) {
        if (netBurn <= 0) {
          netBurnDisplay.textContent = `+${getRegion().currency}${Math.abs(Math.round(netBurn))}k/q`;
          netBurnDisplay.className = "font-mono text-emerald-600";
        } else {
          netBurnDisplay.textContent = `-${getRegion().currency}${Math.round(netBurn)}k/q`;
          netBurnDisplay.className = "font-mono text-rose-600";
        }
      }
      
      // Adjusted runway based on net burn
      const effectiveBurn = Math.max(1, netBurn);
      displayRunway = (this.metrics.cash / effectiveBurn).toFixed(1);
      
      // Show projections button if we have a revenue model
      if (projectionsBtn) {
        projectionsBtn.classList.remove("hidden");
      }
      
      // Show projection status if we have projections and revenue target
      const projections = this.getSalesProjections();
      if (projections && projections.quarters[this.turn - 1] && projectionStatus && projectionVariance) {
        const current = projections.quarters[this.turn - 1];
        if (current.projected > 0) {
          projectionStatus.classList.remove("hidden");
          const annualized = revenueCalc.gross * 4;
          const variance = ((annualized - current.projected) / current.projected) * 100;
          
          if (variance >= 0) {
            projectionVariance.textContent = `+${variance.toFixed(0)}%`;
            projectionVariance.className = "font-mono text-emerald-600";
          } else if (variance >= -this.revenueModel.investorToleranceBand * 100) {
            projectionVariance.textContent = `${variance.toFixed(0)}%`;
            projectionVariance.className = "font-mono text-amber-600";
          } else {
            projectionVariance.textContent = `${variance.toFixed(0)}%`;
            projectionVariance.className = "font-mono text-rose-600";
          }
        } else {
          projectionStatus.classList.add("hidden");
        }
      }
    }
    
    document.getElementById("runwayDisplay").textContent = `${displayRunway}q`;
    
    // Update staff section in AP tracker
    const staffCount = document.getElementById("staffCount");
    const staffAPBonusDisplay = document.getElementById("staffAPBonusDisplay");
    const staffAPValue = document.getElementById("staffAPValue");
    const staffBurnImpact = document.getElementById("staffBurnImpact");
    const staffIconsRow = document.getElementById("staffIconsRow");
    const staffProgressBar = document.getElementById("staffProgressBar");
    const staffTierCurrent = document.getElementById("staffTierCurrent");
    const staffTierNext = document.getElementById("staffTierNext");
    const integrationNotice = document.getElementById("integrationNotice");
    
    const currentStaff = this.metrics.staff;
    const bonus = this.getStaffAPBonus();
    const penalty = this.staffAPPenalty;
    
    if (staffCount) {
      staffCount.textContent = currentStaff;
    }
    
    // Render staff icons
    if (staffIconsRow) {
      let iconsHtml = '';
      const integratingCount = this.integratingStaff;
      for (let i = 0; i < currentStaff; i++) {
        const isIntegrating = i >= (currentStaff - integratingCount);
        if (isIntegrating) {
          iconsHtml += '<span class="w-5 h-5 rounded-full bg-amber-200 border-2 border-amber-400 flex items-center justify-center text-[10px]" title="Integrating">ğŸ‘¤</span>';
        } else {
          iconsHtml += '<span class="w-5 h-5 rounded-full bg-indigo-100 border-2 border-indigo-300 flex items-center justify-center text-[10px]">ğŸ‘¤</span>';
        }
      }
      // Show empty slots up to next tier
      const nextTier = currentStaff < 3 ? 3 : currentStaff < 6 ? 6 : currentStaff < 9 ? 9 : currentStaff;
      for (let i = currentStaff; i < nextTier && i < 12; i++) {
        iconsHtml += '<span class="w-5 h-5 rounded-full bg-slate-100 border-2 border-dashed border-slate-300 flex items-center justify-center text-[10px] text-slate-300">+</span>';
      }
      staffIconsRow.innerHTML = iconsHtml;
    }
    
    // Update burn impact display
    if (staffBurnImpact) {
      // Calculate staff portion of burn (Â£25k per staff member)
      const staffBurn = currentStaff * 25;
      staffBurnImpact.textContent = `Â£${staffBurn}k`;
    }
    
    // Check hiring status this quarter
    const hiresRemaining = 2 - (this.hiresThisQuarter || 0);
    const hadHeavyHiringLastQ = (this.hiresPreviousQuarter || 0) >= 2;
    
    // Update AP value display - always shows actual bonus
    if (staffAPValue) {
      staffAPValue.textContent = `+${bonus}`;
      staffAPValue.className = "text-2xl font-bold text-indigo-600";
    }
    
    // Update badge display
    if (staffAPBonusDisplay) {
      if (penalty > 0) {
        staffAPBonusDisplay.textContent = `+${bonus} AP (âˆ’${penalty})`;
        staffAPBonusDisplay.className = "px-2 py-1 rounded-full text-xs font-bold bg-amber-100 text-amber-700";
      } else {
        staffAPBonusDisplay.textContent = `+${bonus} AP`;
        staffAPBonusDisplay.className = "px-2 py-1 rounded-full text-xs font-bold bg-emerald-100 text-emerald-700";
      }
    }
    
    // Update hiring limit notice in info panel
    const staffUnlockNotice = document.getElementById("staffUnlockNotice");
    if (staffUnlockNotice) {
      if (hiresRemaining <= 0) {
        staffUnlockNotice.innerHTML = `ğŸš« Hiring limit reached (2/quarter). More hiring available next quarter.`;
        staffUnlockNotice.className = "mb-3 text-red-700 bg-red-50 p-2 rounded border border-red-200";
      } else if (hadHeavyHiringLastQ && hiresRemaining === 1) {
        staffUnlockNotice.innerHTML = `âš ï¸ ${hiresRemaining} hire left. Warning: 2nd hire after last Q's heavy hiring = -2 AP strain penalty`;
        staffUnlockNotice.className = "mb-3 text-red-700 bg-red-50 p-2 rounded border border-red-200";
      } else {
        staffUnlockNotice.innerHTML = `ğŸ“‹ Hiring: ${hiresRemaining}/2 remaining this quarter. 2nd hire = extra AP penalty.`;
        staffUnlockNotice.className = "mb-3 text-amber-700 bg-amber-50 p-2 rounded border border-amber-200";
      }
      staffUnlockNotice.classList.remove("hidden");
    }
    
    // Calculate progress to next tier (based on HIRED staff, not total)
    if (staffProgressBar && staffTierCurrent && staffTierNext) {
      const startingStaff = this.startingStaff || 0;
      const hiredStaff = Math.max(0, currentStaff - startingStaff);
      let progress = 0;
      let currentTierName = "";
      let nextTierInfo = "";
      
      if (hiredStaff >= 5) {
        progress = 100;
        currentTierName = "Full capacity (+3 AP)";
        nextTierInfo = "Maximum reached";
        staffProgressBar.className = "h-full bg-gradient-to-r from-blue-400 to-indigo-500 transition-all rounded-full";
      } else if (hiredStaff >= 3) {
        progress = ((hiredStaff - 3) / 2) * 100;
        currentTierName = "Scaling team (+2 AP)";
        nextTierInfo = `${5 - hiredStaff} more hires â†’ +3 AP`;
        staffProgressBar.className = "h-full bg-gradient-to-r from-blue-400 to-indigo-500 transition-all rounded-full";
      } else if (hiredStaff >= 1) {
        progress = ((hiredStaff - 1) / 2) * 100;
        currentTierName = "Growing team (+1 AP)";
        nextTierInfo = `${3 - hiredStaff} more hires â†’ +2 AP`;
        staffProgressBar.className = "h-full bg-gradient-to-r from-blue-400 to-indigo-500 transition-all rounded-full";
      } else {
        progress = 0;
        currentTierName = `Founding team (${startingStaff}) +0 AP`;
        nextTierInfo = `1 hire â†’ +1 AP`;
        staffProgressBar.className = "h-full bg-gradient-to-r from-blue-400 to-indigo-500 transition-all rounded-full";
      }
      
      staffProgressBar.style.width = `${progress}%`;
      staffTierCurrent.textContent = currentTierName;
      staffTierNext.textContent = nextTierInfo;
    }
    
    if (integrationNotice) {
      if (this.staffAPPenalty > 0) {
        const disruptionText = document.getElementById("disruptionText");
        const disruptionPenalty = document.getElementById("disruptionPenalty");
        
        if (this.integratingStaff > 0) {
          disruptionText.textContent = `${this.integratingStaff} staff integrating`;
        } else {
          disruptionText.textContent = `Team reorganizing after changes`;
        }
        disruptionPenalty.textContent = this.staffAPPenalty;
        
        integrationNotice.classList.remove("hidden");
      } else {
        integrationNotice.classList.add("hidden");
      }
    }
    
    // Update hire/fire button states
    const hireBtn = document.getElementById("hireBtn");
    const fireBtn = document.getElementById("fireBtn");
    if (hireBtn) {
      const remainingAP = this.getTotalAP() - this.getUsedAP();
      const canHire = remainingAP >= 1; // Job posting costs 1 AP
      hireBtn.disabled = !canHire;
      hireBtn.className = canHire 
        ? "group relative overflow-hidden rounded-lg border-2 border-emerald-300 bg-gradient-to-b from-white to-emerald-50 hover:from-emerald-50 hover:to-emerald-100 transition-all p-2.5"
        : "group relative overflow-hidden rounded-lg border-2 border-slate-200 bg-slate-100 cursor-not-allowed opacity-50 p-2.5";
    }
    if (fireBtn) {
      const hasHiredStaff = (this.hiredStaff || []).length > 0;
      const canFire = hasHiredStaff && this.metrics.cash >= 40;
      fireBtn.disabled = !canFire;
      fireBtn.className = canFire
        ? "group relative overflow-hidden rounded-lg border-2 border-rose-300 bg-gradient-to-b from-white to-rose-50 hover:from-rose-50 hover:to-rose-100 transition-all p-2.5"
        : "group relative overflow-hidden rounded-lg border-2 border-slate-200 bg-slate-100 cursor-not-allowed opacity-50 p-2.5";
    }
    
    // Update milestone tracker (both sidebar and main)
    if (this.milestone) {
      const turnsLeft = this.milestone.deadline - this.turn;
      const urgencyClass = turnsLeft <= 1 ? "text-red-600" : turnsLeft <= 2 ? "text-amber-600" : "text-slate-500";
      const deadlineText = turnsLeft <= 0 ? "âš  OVERDUE!" : `Due Q${this.milestone.deadline} (${turnsLeft}q left)`;
      
      // Sidebar milestone (legacy)
      document.getElementById("milestoneLabel").textContent = this.milestone.name;
      document.getElementById("milestoneBar").style.width = this.milestoneProgress + "%";
      document.getElementById("milestoneProgress").textContent = this.milestoneProgress + "%";
      document.getElementById("milestoneDeadline").textContent = `Due Q${this.milestone.deadline}`;
      
      // Main milestone tracker at top
      document.getElementById("milestoneLabel2").textContent = this.milestone.name;
      document.getElementById("milestoneBar2").style.width = this.milestoneProgress + "%";
      document.getElementById("milestoneProgress2").textContent = this.milestoneProgress;
      document.getElementById("milestoneDeadline2").textContent = deadlineText;
      document.getElementById("milestoneDeadline2").className = `text-xs font-medium ${urgencyClass}`;
      
      // Show focus areas hint
      const focusLabels = { sci: "Research", dev: "Product", mkt: "Sales" };
      const focusAreas = this.milestone.focus.map(f => focusLabels[f] || f).join(" & ");
      document.getElementById("milestoneFocusAreas").textContent = focusAreas;
      document.getElementById("milestoneHint").classList.remove("hidden");
      
      // Update tracker border color based on progress
      const tracker = document.getElementById("milestoneTracker");
      if (this.milestoneProgress >= 100) {
        tracker.className = "bg-gradient-to-r from-emerald-50 to-green-50 rounded-xl shadow-sm p-4 border-2 border-emerald-400 mb-4";
      } else if (turnsLeft <= 1 && this.milestoneProgress < 80) {
        tracker.className = "bg-gradient-to-r from-red-50 to-orange-50 rounded-xl shadow-sm p-4 border-2 border-red-400 mb-4 animate-pulse";
      } else {
        tracker.className = "bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl shadow-sm p-4 border-2 border-amber-300 mb-4";
      }
    } else {
      // No active milestone - show "select milestone" state
      document.getElementById("milestoneLabel").textContent = "Select next milestone...";
      document.getElementById("milestoneBar").style.width = "0%";
      document.getElementById("milestoneProgress").textContent = "0%";
      document.getElementById("milestoneDeadline").textContent = "";
      
      document.getElementById("milestoneLabel2").textContent = "ğŸ¯ Choose your next milestone";
      document.getElementById("milestoneBar2").style.width = "0%";
      document.getElementById("milestoneProgress2").textContent = "0";
      document.getElementById("milestoneDeadline2").textContent = "Ready to select";
      document.getElementById("milestoneDeadline2").className = "text-xs font-medium text-blue-600";
      
      document.getElementById("milestoneHint").classList.add("hidden");
      
      const tracker = document.getElementById("milestoneTracker");
      tracker.className = "bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl shadow-sm p-4 border-2 border-blue-300 mb-4";
    }
    
    // Update strategic review button visibility
    // Show when: completed at least 1 milestone, OR rival ahead, OR struggling
    const strategicBtn = document.getElementById("strategicReviewBtn");
    if (strategicBtn) {
      const hasCompletedMilestone = this.completedMilestones.length >= 1;
      const rivalAhead = this.getLeadingRival() !== null;
      const isStruggling = this.milestoneProgress < 40 && this.turn > 6;
      const inSecondYear = this.turn >= 5;
      
      // Show if: has active milestone AND (completed M1 OR rival ahead OR struggling after Y1)
      const shouldShow = this.milestone && (
        hasCompletedMilestone || // Always show after completing first milestone
        (inSecondYear && rivalAhead) || // Show if rival ahead in Year 2+
        (inSecondYear && isStruggling) // Show if struggling in Year 2+
      );
      
      strategicBtn.classList.toggle("hidden", !shouldShow);
    }
  }

  log(msg) {
    const div = document.getElementById("log");
    const p = document.createElement("p");
    p.innerHTML = `<span class="text-slate-400">Q${this.turn}</span> ${msg}`;
    div.prepend(p);
  }
  
  // Computed properties for quarter and year
  get quarter() {
    return ((this.turn - 1) % 4) + 1;
  }
  
  get year() {
    return Math.floor((this.turn - 1) / 4) + 1;
  }
  
  // Quarter transition animation system
  shouldShowTransition() {
    // Always show for first year (turns 1-4)
    if (this.turn <= 4) return true;
    // After first year, show ~50% of the time
    return Math.random() < 0.5;
  }
  
  showQuarterTransition(callback, isCelebration = false) {
    // Create transition overlay
    const overlay = document.createElement('div');
    overlay.id = 'quarterTransition';
    overlay.className = 'fixed inset-0 z-50 flex items-center justify-center bg-slate-900/90 cursor-pointer';
    overlay.onclick = () => this.skipTransition(callback);
    
    // Pick scene: celebration for milestones, random otherwise
    const sceneType = isCelebration ? 'celebration' : (Math.random() < 0.5 ? 'workday' : 'meeting');
    
    overlay.innerHTML = `
      <div class="text-center">
        <div class="bg-slate-800 rounded-2xl overflow-hidden shadow-2xl" style="width: 800px; max-width: 95vw;">
          ${this.getTransitionScene(sceneType)}
        </div>
        <p class="text-slate-400 text-sm mt-4">Click anywhere to skip</p>
      </div>
      <style>
        @keyframes walk-right { 0% { transform: translateX(-80px); } 100% { transform: translateX(750px); } }
        @keyframes walk-left { 0% { transform: translateX(750px) scaleX(-1); } 100% { transform: translateX(-80px) scaleX(-1); } }
        .walking-right { animation: walk-right 2.5s linear infinite; }
        .walking-left { animation: walk-left 3s linear infinite; }
        .walking-right-slow { animation: walk-right 4s linear infinite; }
        @keyframes bob-walk { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
        .walk-bob { animation: bob-walk 0.08s ease-in-out infinite; }
        @keyframes typing { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
        .typing { animation: typing 0.04s ease-in-out infinite; }
        @keyframes think-sway { 0%, 100% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } }
        .thinking { animation: think-sway 0.5s ease-in-out infinite; }
        @keyframes nod { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(4px); } }
        .nodding { animation: nod 0.375s ease-in-out infinite; }
        @keyframes gesture { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(-20deg); } 75% { transform: rotate(15deg); } }
        .gesturing { animation: gesture 0.2s ease-in-out infinite; transform-origin: bottom center; }
        @keyframes point { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(10deg); } }
        .pointing { animation: point 0.375s ease-in-out infinite; transform-origin: left center; }
        @keyframes pour { 0%, 80%, 100% { transform: rotate(0deg); } 40% { transform: rotate(-45deg); } }
        .pouring { animation: pour 0.75s ease-in-out infinite; transform-origin: bottom right; }
        @keyframes steam { 0% { transform: translateY(0); opacity: 0.8; } 100% { transform: translateY(-20px); opacity: 0; } }
        .steam { animation: steam 0.5s ease-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        .floating { animation: float 0.75s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 0.5; transform: scale(1); } 50% { opacity: 1; transform: scale(1.15); } }
        .pulsing { animation: pulse 0.375s ease-in-out infinite; }
        @keyframes screen-glow { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.7; } }
        .screen-glow { animation: screen-glow 0.5s ease-in-out infinite; }
        @keyframes write { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(10px); } }
        .writing { animation: write 0.5s ease-in-out infinite; }
        @keyframes chair-spin { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(8deg); } 75% { transform: rotate(-8deg); } }
        .chair-spin { animation: chair-spin 0.75s ease-in-out infinite; }
        @keyframes lean { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(5px); } }
        .leaning { animation: lean 0.5s ease-in-out infinite; }
        @keyframes high-five-l { 0%, 60%, 100% { transform: rotate(0deg); } 30% { transform: rotate(-35deg); } }
        @keyframes high-five-r { 0%, 60%, 100% { transform: rotate(0deg); } 30% { transform: rotate(35deg); } }
        .high-five-left { animation: high-five-l 0.5s ease-in-out infinite; transform-origin: bottom; }
        .high-five-right { animation: high-five-r 0.5s ease-in-out infinite; transform-origin: bottom; }
        @keyframes celebrate { 0%, 100% { transform: translateY(0) rotate(0deg); } 25% { transform: translateY(-10px) rotate(-5deg); } 75% { transform: translateY(-10px) rotate(5deg); } }
        .celebrating { animation: celebrate 0.125s ease-in-out infinite; }
      </style>
    `;
    
    document.body.appendChild(overlay);
    
    // Auto-advance after 7 seconds
    this.transitionTimeout = setTimeout(() => this.skipTransition(callback), 7000);
  }
  
  skipTransition(callback) {
    clearTimeout(this.transitionTimeout);
    const overlay = document.getElementById('quarterTransition');
    if (overlay) overlay.remove();
    if (callback) callback();
  }
  
  getTransitionScene(type) {
    if (type === 'celebration') return this.getCelebrationScene();
    if (type === 'meeting') return this.getMeetingScene();
    return this.getWorkdayScene();
  }
  
  getWorkdayScene() {
    return `
      <div class="h-96 bg-gradient-to-b from-amber-50 to-slate-100 relative overflow-hidden">
        <div class="absolute inset-x-0 top-0 h-64 bg-gradient-to-b from-slate-200 to-slate-100"></div>
        <div class="absolute top-6 right-12 w-36 h-28 bg-sky-200 border-4 border-amber-700 rounded shadow-inner">
          <div class="absolute inset-1 border border-amber-600 grid grid-cols-2">
            <div class="border-r border-amber-600"></div>
            <div></div>
          </div>
          <div class="absolute top-3 left-4 text-xl floating">â˜</div>
          <div class="absolute top-6 right-3 text-base floating" style="animation-delay: 0.3s;">â˜</div>
        </div>
        <div class="absolute top-6 left-6 px-3 py-1.5 bg-indigo-600 rounded text-white font-bold text-sm shadow">ğŸš€ ${this.company?.name || 'AIven'}</div>
        <div class="absolute top-6 left-36 w-14 h-12 bg-white rounded shadow border border-slate-200 flex items-center justify-center text-xl">ğŸ“ˆ</div>
        <div class="absolute top-6 left-56 w-12 h-12 bg-white rounded-full border-2 border-slate-300 flex items-center justify-center text-xl">ğŸ•</div>
        <div class="absolute bottom-0 left-0 right-0 h-8 bg-amber-200"></div>
        
        <!-- Bookshelf -->
        <div class="absolute top-20 left-6 w-20 h-32 bg-amber-800 rounded-sm shadow">
          <div class="absolute top-2 left-2 right-2 h-8 flex gap-1">
            <div class="w-3 h-full bg-blue-400 rounded-sm"></div>
            <div class="w-3 h-full bg-red-400 rounded-sm"></div>
            <div class="w-4 h-full bg-green-400 rounded-sm"></div>
            <div class="w-3 h-full bg-yellow-400 rounded-sm"></div>
          </div>
          <div class="absolute top-12 left-2 right-2 h-8 flex gap-1">
            <div class="w-4 h-full bg-purple-400 rounded-sm"></div>
            <div class="w-3 h-full bg-orange-400 rounded-sm"></div>
            <div class="w-3 h-full bg-pink-400 rounded-sm"></div>
          </div>
          <div class="absolute bottom-2 left-3 text-lg">ğŸ†</div>
        </div>
        
        <!-- Coffee Station -->
        <div class="absolute bottom-8 right-4 w-24 h-28 bg-amber-700 rounded-t-lg shadow-md">
          <div class="absolute top-3 left-1/2 -translate-x-1/2 w-16 h-12 bg-slate-600 rounded">
            <div class="absolute top-1 left-1/2 -translate-x-1/2 w-8 h-4 bg-slate-800 rounded-t"></div>
            <div class="absolute bottom-1 left-1/2 -translate-x-1/2 w-3 h-4 bg-amber-900"></div>
          </div>
          <div class="absolute bottom-3 left-2 text-base">â˜•</div>
          <div class="absolute bottom-3 left-10 text-base">â˜•</div>
          <div class="absolute bottom-3 right-2 text-sm">ğŸ¥¤</div>
          <div class="absolute -top-4 left-10 flex gap-1">
            <div class="w-1.5 h-5 bg-white/50 rounded-full blur-sm steam"></div>
            <div class="w-1.5 h-5 bg-white/50 rounded-full blur-sm steam" style="animation-delay: 0.2s;"></div>
          </div>
        </div>
        
        <!-- Person at coffee - Bald man -->
        <svg viewBox="0 0 50 80" class="absolute bottom-8 right-28 w-14 h-28">
          <ellipse cx="25" cy="16" rx="10" ry="12" fill="#6B4423"/>
          <ellipse cx="20" cy="14" rx="2" ry="2.5" fill="white"/>
          <ellipse cx="30" cy="14" rx="2" ry="2.5" fill="white"/>
          <circle cx="20" cy="14" r="1" fill="#2d1810"/>
          <circle cx="30" cy="14" r="1" fill="#2d1810"/>
          <path d="M20 24 Q25 28 30 24" stroke="#4A2F1F" fill="none" stroke-width="1.5"/>
          <path d="M14 30 L20 27 L30 27 L36 30 L36 60 L14 60 Z" fill="#dc2626"/>
          <path d="M22 27 L25 32 L28 27" fill="#b91c1c"/>
          <g class="pouring">
            <rect x="32" y="32" width="5" height="14" rx="2" fill="#dc2626"/>
            <ellipse cx="37" cy="48" rx="3" ry="2.5" fill="#6B4423"/>
            <rect x="35" y="44" width="6" height="8" rx="1" fill="#4a3728"/>
          </g>
          <rect x="10" y="32" width="5" height="16" rx="2" fill="#dc2626"/>
          <ellipse cx="12" cy="50" rx="3" ry="2.5" fill="#6B4423"/>
        </svg>
        
        <!-- Desk Row with people -->
        <div class="absolute bottom-8 left-32">
          <div class="w-36 h-16 bg-slate-300 rounded-t shadow-md"></div>
          <div class="absolute -top-14 left-3 w-14 h-11 bg-slate-800 rounded border border-slate-600">
            <div class="w-full h-full bg-blue-500/40 rounded screen-glow"></div>
          </div>
          <div class="absolute -top-14 left-20 w-14 h-11 bg-slate-800 rounded border border-slate-600">
            <div class="w-full h-full bg-green-500/40 rounded screen-glow" style="animation-delay: 0.2s;"></div>
          </div>
          <div class="absolute top-2 left-6 w-10 h-3 bg-slate-700 rounded-sm"></div>
          <div class="absolute top-2 left-22 w-10 h-3 bg-slate-700 rounded-sm"></div>
          <div class="absolute top-1 right-2 text-sm">â˜•</div>
          
          <!-- Person 1 - typing -->
          <svg viewBox="0 0 40 55" class="absolute -top-20 left-2 w-14 h-20">
            <ellipse cx="20" cy="10" rx="10" ry="9" fill="#1a1a1a"/>
            <ellipse cx="20" cy="7" rx="8" ry="6" fill="#2d2d2d"/>
            <ellipse cx="20" cy="15" rx="8" ry="9" fill="#8B5A2B"/>
            <circle cx="11" cy="17" r="1.5" fill="#FFD700"/>
            <circle cx="29" cy="17" r="1.5" fill="#FFD700"/>
            <path d="M16 21 Q20 24 24 21" stroke="#5C3D1E" fill="none" stroke-width="1"/>
            <path d="M10 26 L15 24 L25 24 L30 26 L30 44 L10 44 Z" fill="#2563eb"/>
            <path d="M17 24 L20 30 L23 24" fill="white"/>
            <rect x="6" y="30" width="4" height="10" rx="2" fill="#2563eb" class="typing"/>
            <rect x="30" y="30" width="4" height="10" rx="2" fill="#2563eb" class="typing" style="animation-delay: 0.02s"/>
          </svg>
          
          <!-- Person 2 - thinking -->
          <svg viewBox="0 0 40 55" class="absolute -top-20 left-20 w-14 h-20 chair-spin">
            <ellipse cx="20" cy="8" rx="8" ry="6" fill="#0a0a0a"/>
            <ellipse cx="20" cy="15" rx="8" ry="9" fill="#F5DEB3" class="thinking"/>
            <rect x="12" y="11" width="7" height="5" rx="1" fill="none" stroke="#333" stroke-width="1.5"/>
            <rect x="21" y="11" width="7" height="5" rx="1" fill="none" stroke="#333" stroke-width="1.5"/>
            <line x1="19" y1="13" x2="21" y2="13" stroke="#333" stroke-width="1"/>
            <circle cx="15" cy="13" r="0.8" fill="#2d1810"/>
            <circle cx="25" cy="13" r="0.8" fill="#2d1810"/>
            <path d="M17 21 L23 21" stroke="#8B7355" stroke-width="1.5"/>
            <path d="M10 26 L16 24 L24 24 L30 26 L30 44 L10 44 Z" fill="#6366f1"/>
          </svg>
          <div class="absolute -top-28 left-24 text-2xl pulsing">ğŸ’¡</div>
        </div>
        
        <!-- Standing desk area -->
        <div class="absolute bottom-32 right-48 w-24 h-24 bg-slate-400 rounded-t shadow">
          <div class="absolute top-2 left-2 w-20 h-12 bg-slate-800 rounded border border-slate-600">
            <div class="w-full h-full bg-purple-500/40 rounded screen-glow" style="animation-delay: 0.4s;"></div>
          </div>
          <svg viewBox="0 0 40 55" class="absolute -top-10 left-6 w-12 h-18">
            <ellipse cx="20" cy="10" rx="10" ry="8" fill="#C41E3A"/>
            <path d="M10 12 Q8 24 13 34" stroke="#A01830" stroke-width="3" fill="none"/>
            <path d="M30 12 Q32 24 27 34" stroke="#A01830" stroke-width="3" fill="none"/>
            <ellipse cx="20" cy="16" rx="8" ry="9" fill="#FFE4C4"/>
            <path d="M16 22 Q20 25 24 22" stroke="#CC6666" fill="none" stroke-width="1"/>
            <path d="M12 28 L17 26 L23 26 L28 28 L28 46 L12 46 Z" fill="#10b981"/>
            <rect x="8" y="30" width="4" height="10" rx="2" fill="#10b981" class="typing"/>
            <rect x="28" y="30" width="4" height="10" rx="2" fill="#10b981" class="typing" style="animation-delay: 0.02s"/>
          </svg>
        </div>
        
        <!-- Walking people -->
        <div class="walking-right absolute bottom-8" style="left: -60px;">
          <svg viewBox="0 0 40 70" class="w-12 h-24 walk-bob">
            <ellipse cx="20" cy="10" rx="9" ry="7" fill="#1a1a1a"/>
            <ellipse cx="20" cy="16" rx="8" ry="9" fill="#C68642"/>
            <path d="M12 20 Q14 28 20 30 Q26 28 28 20" fill="#1a1a1a"/>
            <ellipse cx="16" cy="14" rx="1.5" ry="2" fill="white"/>
            <ellipse cx="24" cy="14" rx="1.5" ry="2" fill="white"/>
            <circle cx="16" cy="14" r="0.8" fill="#2d1810"/>
            <circle cx="24" cy="14" r="0.8" fill="#2d1810"/>
            <path d="M12 32 L17 30 L23 30 L28 32 L28 50 L12 50 Z" fill="#374151"/>
            <path d="M18 30 L20 34 L22 30" fill="white"/>
            <rect x="14" y="50" width="4" height="14" rx="2" fill="#1f2937"/>
            <rect x="22" y="50" width="4" height="14" rx="2" fill="#1f2937"/>
            <rect x="8" y="34" width="4" height="10" rx="2" fill="#374151"/>
            <rect x="28" y="34" width="4" height="10" rx="2" fill="#374151"/>
            <rect x="28" y="38" width="8" height="10" rx="1" fill="#1f2937"/>
          </svg>
        </div>
        <div class="walking-left absolute bottom-8" style="animation-delay: 1s;">
          <svg viewBox="0 0 40 70" class="w-12 h-24 walk-bob">
            <path d="M10 12 Q10 4 20 4 Q30 4 30 12 L30 24 Q27 25 24 23 L24 14 Q22 12 20 12 Q18 12 16 14 L16 23 Q13 25 10 24 Z" fill="#0a0a0a"/>
            <ellipse cx="20" cy="18" rx="8" ry="9" fill="#F5DEB3"/>
            <path d="M15 16 Q17 14 19 16 Q17 17 15 16" fill="white"/>
            <path d="M21 16 Q23 14 25 16 Q23 17 21 16" fill="white"/>
            <circle cx="17" cy="16" r="0.8" fill="#2d1810"/>
            <circle cx="23" cy="16" r="0.8" fill="#2d1810"/>
            <path d="M16 24 Q20 27 24 24" stroke="#CC8080" fill="none" stroke-width="1"/>
            <path d="M12 30 L17 28 L23 28 L28 30 L28 50 L12 50 Z" fill="white" stroke="#e5e7eb"/>
            <rect x="18" y="30" width="4" height="6" fill="#06b6d4"/>
            <rect x="14" y="50" width="4" height="14" rx="2" fill="#1e3a5f"/>
            <rect x="22" y="50" width="4" height="14" rx="2" fill="#1e3a5f"/>
            <rect x="6" y="34" width="4" height="10" rx="2" fill="white" stroke="#e5e7eb"/>
            <rect x="4" y="42" width="5" height="7" rx="1" fill="white" stroke="#ddd"/>
          </svg>
        </div>
        <div class="walking-right-slow absolute bottom-8" style="left: -40px; animation-delay: 2s;">
          <svg viewBox="0 0 40 70" class="w-12 h-24 walk-bob">
            <ellipse cx="20" cy="16" rx="10" ry="12" fill="#5C4033"/>
            <ellipse cx="16" cy="14" rx="2" ry="2.5" fill="white"/>
            <ellipse cx="24" cy="14" rx="2" ry="2.5" fill="white"/>
            <circle cx="16" cy="14" r="1" fill="#2d1810"/>
            <circle cx="24" cy="14" r="1" fill="#2d1810"/>
            <path d="M16 22 Q20 26 24 22" stroke="#3d2817" fill="none" stroke-width="1.5"/>
            <path d="M12 30 L17 28 L23 28 L28 30 L28 50 L12 50 Z" fill="#0891b2"/>
            <rect x="14" y="50" width="4" height="14" rx="2" fill="#374151"/>
            <rect x="22" y="50" width="4" height="14" rx="2" fill="#374151"/>
            <rect x="8" y="32" width="4" height="12" rx="2" fill="#0891b2"/>
            <rect x="28" y="32" width="4" height="12" rx="2" fill="#0891b2"/>
          </svg>
        </div>
        
        <div class="absolute bottom-8 left-6 text-3xl">ğŸª´</div>
        <div class="absolute bottom-40 right-[55%] text-2xl">ğŸŒ¿</div>
        
        <div class="absolute bottom-2 left-0 right-0 text-center">
          <div class="text-slate-600 text-sm font-medium bg-white/80 inline-block px-4 py-1.5 rounded-full shadow">
            â˜• Q${this.turn} â†’ Q${this.turn + 1}...
          </div>
        </div>
      </div>
    `;
  }
  
  getMeetingScene() {
    return `
      <div class="h-96 bg-gradient-to-b from-slate-100 to-slate-200 relative overflow-hidden">
        <div class="absolute inset-3 bg-gradient-to-b from-slate-50 to-slate-100 rounded-lg shadow-inner"></div>
        
        <!-- Whiteboard -->
        <div class="absolute top-4 left-1/2 -translate-x-1/2 w-72 h-40 bg-white border-4 border-slate-400 rounded shadow-lg">
          <div class="p-3">
            <div class="text-sm text-slate-600 font-bold mb-2">Q${this.turn + 1} PLANNING</div>
            <div class="flex gap-4">
              <div>
                <div class="text-xs text-blue-600 mb-1">Research</div>
                <div class="w-14 h-1.5 bg-blue-400 rounded mb-1"></div>
                <div class="w-12 h-1.5 bg-blue-300 rounded mb-1"></div>
                <div class="w-10 h-1.5 bg-blue-400 rounded"></div>
              </div>
              <div>
                <div class="text-xs text-emerald-600 mb-1">Product</div>
                <div class="w-12 h-1.5 bg-emerald-400 rounded mb-1"></div>
                <div class="w-14 h-1.5 bg-emerald-300 rounded mb-1"></div>
                <div class="w-10 h-1.5 bg-emerald-400 rounded"></div>
              </div>
              <div>
                <div class="text-xs text-fuchsia-600 mb-1">Sales</div>
                <div class="w-10 h-1.5 bg-fuchsia-400 rounded mb-1"></div>
                <div class="w-12 h-1.5 bg-fuchsia-300 rounded mb-1"></div>
                <div class="w-14 h-1.5 bg-fuchsia-400 rounded"></div>
              </div>
            </div>
            <div class="mt-3 flex gap-2">
              <div class="w-8 h-8 bg-yellow-100 rounded shadow-sm flex items-center justify-center text-base">ğŸ¯</div>
              <div class="w-8 h-8 bg-blue-100 rounded shadow-sm flex items-center justify-center text-base">ğŸ“Š</div>
              <div class="w-8 h-8 bg-green-100 rounded shadow-sm flex items-center justify-center text-base">ğŸš€</div>
              <div class="w-8 h-8 bg-pink-100 rounded shadow-sm flex items-center justify-center text-base writing">âœ</div>
            </div>
          </div>
        </div>
        
        <div class="absolute bottom-0 left-0 right-0 h-8 bg-slate-300 rounded-b-lg"></div>
        
        <!-- Table -->
        <div class="absolute bottom-24 left-1/2 -translate-x-1/2 w-80 h-12 bg-amber-700 rounded shadow-lg"></div>
        <div class="absolute bottom-8 left-28 w-3 h-16 bg-amber-800"></div>
        <div class="absolute bottom-8 right-28 w-3 h-16 bg-amber-800"></div>
        
        <!-- Presenter -->
        <svg viewBox="0 0 50 90" class="absolute bottom-8 left-6 w-14 h-28">
          <path d="M12 12 Q12 4 25 4 Q38 4 38 12 L38 24 Q35 25 32 23 L32 14 Q28 12 25 12 Q22 12 18 14 L18 23 Q15 25 12 24 Z" fill="#0a0a0a"/>
          <ellipse cx="25" cy="20" rx="10" ry="11" fill="#F5DEB3"/>
          <path d="M19 18 Q22 16 24 18 Q22 19 19 18" fill="white"/>
          <path d="M26 18 Q28 16 31 18 Q28 19 26 18" fill="white"/>
          <circle cx="21" cy="18" r="0.8" fill="#2d1810"/>
          <circle cx="29" cy="18" r="0.8" fill="#2d1810"/>
          <ellipse cx="25" cy="26" rx="3" ry="2" fill="#CC8080"/>
          <path d="M14 34 L20 31 L30 31 L36 34 L36 58 L14 58 Z" fill="white" stroke="#e5e7eb"/>
          <path d="M20 31 L25 40 L30 31" fill="#f3f4f6"/>
          <rect x="22" y="34" width="6" height="6" fill="#06b6d4"/>
          <path d="M22 36 Q18 42 20 48" stroke="#374151" stroke-width="2" fill="none"/>
          <circle cx="20" cy="50" r="2.5" fill="#374151"/>
          <g class="pointing">
            <rect x="34" y="36" width="5" height="16" rx="2" fill="white" stroke="#e5e7eb"/>
            <ellipse cx="44" cy="38" rx="3" ry="2.5" fill="#F5DEB3"/>
          </g>
          <rect x="10" y="38" width="5" height="14" rx="2" fill="white" stroke="#e5e7eb"/>
          <rect x="18" y="58" width="5" height="20" rx="2" fill="#1e3a5f"/>
          <rect x="27" y="58" width="5" height="20" rx="2" fill="#1e3a5f"/>
        </svg>
        
        <!-- Seated people with legs visible -->
        <svg viewBox="0 0 40 75" class="absolute bottom-8 left-28 w-12 h-24">
          <rect x="8" y="22" width="24" height="18" rx="2" fill="#4b5563"/>
          <ellipse cx="20" cy="10" rx="10" ry="8" fill="#1a1a1a"/>
          <ellipse cx="20" cy="7" rx="8" ry="5" fill="#2d2d2d"/>
          <ellipse cx="20" cy="16" rx="8" ry="9" fill="#8B5A2B" class="nodding"/>
          <circle cx="10" cy="18" r="1.5" fill="#FFD700"/>
          <circle cx="30" cy="18" r="1.5" fill="#FFD700"/>
          <path d="M16 22 Q20 25 24 22" stroke="#5C3D1E" fill="none" stroke-width="1"/>
          <path d="M10 26 L15 24 L25 24 L30 26 L30 42 L10 42 Z" fill="#2563eb"/>
          <path d="M17 24 L20 30 L23 24" fill="white"/>
          <rect x="14" y="42" width="5" height="20" rx="2" fill="#1e3a5f"/>
          <rect x="21" y="42" width="5" height="20" rx="2" fill="#1e3a5f"/>
        </svg>
        
        <svg viewBox="0 0 40 75" class="absolute bottom-8 left-48 w-12 h-24">
          <rect x="8" y="22" width="24" height="18" rx="2" fill="#4b5563"/>
          <ellipse cx="20" cy="8" rx="8" ry="5" fill="#0a0a0a"/>
          <ellipse cx="20" cy="16" rx="8" ry="9" fill="#F5DEB3"/>
          <rect x="12" y="12" width="7" height="5" rx="1" fill="none" stroke="#333" stroke-width="1"/>
          <rect x="21" y="12" width="7" height="5" rx="1" fill="none" stroke="#333" stroke-width="1"/>
          <line x1="19" y1="14" x2="21" y2="14" stroke="#333" stroke-width="1"/>
          <circle cx="15" cy="14" r="0.8" fill="#2d1810"/>
          <circle cx="25" cy="14" r="0.8" fill="#2d1810"/>
          <ellipse cx="20" cy="22" rx="2.5" ry="1.5" fill="#8B7355"/>
          <path d="M10 26 L15 24 L25 24 L30 26 L30 42 L10 42 Z" fill="#6366f1"/>
          <rect x="30" y="28" width="4" height="12" rx="2" fill="#6366f1" class="gesturing"/>
          <ellipse cx="36" cy="34" rx="3" ry="2.5" fill="#F5DEB3"/>
          <rect x="14" y="42" width="5" height="20" rx="2" fill="#374151"/>
          <rect x="21" y="42" width="5" height="20" rx="2" fill="#374151"/>
        </svg>
        
        <svg viewBox="0 0 40 75" class="absolute bottom-8 right-36 w-12 h-24 leaning">
          <rect x="8" y="22" width="24" height="18" rx="2" fill="#4b5563"/>
          <ellipse cx="20" cy="13" rx="10" ry="11" fill="#6B4423"/>
          <ellipse cx="16" cy="11" rx="1.5" ry="2" fill="white"/>
          <ellipse cx="24" cy="11" rx="1.5" ry="2" fill="white"/>
          <circle cx="16" cy="11" r="0.8" fill="#2d1810"/>
          <circle cx="24" cy="11" r="0.8" fill="#2d1810"/>
          <path d="M16 19 Q20 23 24 19" stroke="#4A2F1F" fill="none" stroke-width="1"/>
          <path d="M10 26 L15 24 L25 24 L30 26 L30 42 L10 42 Z" fill="#dc2626"/>
          <path d="M17 24 L20 29 L23 24" fill="#b91c1c"/>
          <rect x="14" y="42" width="5" height="20" rx="2" fill="#374151"/>
          <rect x="21" y="42" width="5" height="20" rx="2" fill="#374151"/>
        </svg>
        
        <svg viewBox="0 0 40 75" class="absolute bottom-8 right-16 w-12 h-24">
          <rect x="8" y="22" width="24" height="18" rx="2" fill="#4b5563"/>
          <ellipse cx="20" cy="10" rx="10" ry="7" fill="#C41E3A"/>
          <path d="M10 12 Q8 22 12 30" stroke="#A01830" stroke-width="3" fill="none"/>
          <path d="M30 12 Q32 22 28 30" stroke="#A01830" stroke-width="3" fill="none"/>
          <ellipse cx="20" cy="16" rx="8" ry="9" fill="#FFE4C4"/>
          <circle cx="15" cy="17" r="0.5" fill="#D2A679"/>
          <circle cx="25" cy="17" r="0.5" fill="#D2A679"/>
          <path d="M16 22 Q20 25 24 22" stroke="#CC6666" fill="none" stroke-width="1"/>
          <path d="M10 26 L15 24 L25 24 L30 26 L30 42 L10 42 Z" fill="#10b981"/>
          <rect x="30" y="30" width="4" height="10" rx="2" fill="#10b981"/>
          <rect x="34" y="38" width="7" height="10" rx="1" fill="white" stroke="#e5e7eb"/>
          <rect x="35" y="40" width="5" height="1" fill="#333" class="writing"/>
          <rect x="14" y="42" width="5" height="20" rx="2" fill="#374151"/>
          <rect x="21" y="42" width="5" height="20" rx="2" fill="#374151"/>
        </svg>
        
        <!-- Laptop and coffee on table -->
        <div class="absolute bottom-28 left-1/2 -translate-x-1/2 w-10 h-6 bg-slate-600 rounded-t">
          <div class="w-full h-full bg-blue-400/30 rounded-t screen-glow"></div>
        </div>
        <div class="absolute bottom-26 left-36 text-base">â˜•</div>
        <div class="absolute bottom-26 right-40 text-base">â˜•</div>
        
        <!-- Walking people -->
        <div class="walking-right absolute bottom-8" style="left: -50px; animation-duration: 3s;">
          <svg viewBox="0 0 40 70" class="w-10 h-20 walk-bob">
            <ellipse cx="20" cy="10" rx="9" ry="7" fill="#1a1a1a"/>
            <ellipse cx="20" cy="18" rx="9" ry="10" fill="#C68642"/>
            <path d="M12 22 Q14 30 20 32 Q26 30 28 22" fill="#1a1a1a"/>
            <path d="M12 34 L17 32 L23 32 L28 34 L28 50 L12 50 Z" fill="#374151"/>
            <path d="M18 32 L20 36 L22 32" fill="white"/>
            <rect x="14" y="50" width="4" height="14" rx="2" fill="#1f2937"/>
            <rect x="22" y="50" width="4" height="14" rx="2" fill="#1f2937"/>
            <rect x="28" y="42" width="6" height="8" rx="1" fill="white"/>
          </svg>
        </div>
        <div class="walking-left absolute bottom-8" style="animation-duration: 3.5s; animation-delay: 0.5s;">
          <svg viewBox="0 0 40 70" class="w-10 h-20 walk-bob">
            <ellipse cx="20" cy="12" rx="11" ry="9" fill="#C41E3A"/>
            <path d="M9 14 Q7 28 12 38" stroke="#A01830" stroke-width="4" fill="none"/>
            <path d="M31 14 Q33 28 28 38" stroke="#A01830" stroke-width="4" fill="none"/>
            <ellipse cx="20" cy="18" rx="8" ry="9" fill="#FFE4C4"/>
            <path d="M16 24 Q20 27 24 24" stroke="#CC6666" fill="none" stroke-width="1"/>
            <path d="M12 32 L17 30 L23 30 L28 32 L28 50 L12 50 Z" fill="#10b981"/>
            <rect x="14" y="50" width="4" height="14" rx="2" fill="#374151"/>
            <rect x="22" y="50" width="4" height="14" rx="2" fill="#374151"/>
            <rect x="4" y="42" width="5" height="7" rx="1" fill="white"/>
          </svg>
        </div>
        
        <div class="absolute bottom-2 left-0 right-0 text-center">
          <div class="text-slate-600 text-sm font-medium bg-white/80 inline-block px-4 py-1.5 rounded-full shadow">
            ğŸ“‹ Planning Q${this.turn + 1}...
          </div>
        </div>
      </div>
    `;
  }
  
  getCelebrationScene() {
    return `
      <div class="h-96 bg-gradient-to-b from-amber-50 to-orange-50 relative overflow-hidden">
        <div class="absolute top-8 left-[15%] text-3xl floating">ğŸŠ</div>
        <div class="absolute top-14 right-[15%] text-3xl floating" style="animation-delay: 0.2s;">ğŸ‰</div>
        <div class="absolute top-6 left-[40%] text-2xl floating" style="animation-delay: 0.4s;">âœ¨</div>
        <div class="absolute top-16 left-[30%] text-xl floating" style="animation-delay: 0.15s;">â­</div>
        <div class="absolute top-10 right-[30%] text-2xl floating" style="animation-delay: 0.35s;">ğŸŠ</div>
        <div class="absolute top-20 right-[45%] text-xl floating" style="animation-delay: 0.5s;">âœ¨</div>
        <div class="absolute top-8 left-[55%] text-2xl floating" style="animation-delay: 0.25s;">ğŸ‰</div>
        
        <div class="absolute top-4 left-1/2 -translate-x-1/2 px-6 py-2 bg-gradient-to-r from-emerald-500 to-green-500 rounded-lg text-white font-bold text-base shadow-lg">
          ğŸš€ MILESTONE ACHIEVED!
        </div>
        
        <div class="absolute top-20 left-1/2 -translate-x-1/2 text-6xl floating">ğŸ†</div>
        
        <div class="absolute bottom-0 left-0 right-0 h-8 bg-amber-200"></div>
        
        <!-- High-fiving pair -->
        <div class="absolute bottom-8 left-1/2 -translate-x-10 flex items-end gap-2">
          <svg viewBox="0 0 45 80" class="w-14 h-24 celebrating">
            <ellipse cx="22" cy="12" rx="9" ry="7" fill="#0a0a0a"/>
            <ellipse cx="22" cy="18" rx="8" ry="9" fill="#F5DEB3"/>
            <rect x="14" y="14" width="7" height="5" rx="1" fill="none" stroke="#333" stroke-width="1"/>
            <rect x="23" y="14" width="7" height="5" rx="1" fill="none" stroke="#333" stroke-width="1"/>
            <line x1="21" y1="16" x2="23" y2="16" stroke="#333" stroke-width="1"/>
            <path d="M16 16 Q18 14 20 16" stroke="#2d1810" stroke-width="1.5" fill="none"/>
            <path d="M24 16 Q26 14 28 16" stroke="#2d1810" stroke-width="1.5" fill="none"/>
            <path d="M17 24 Q22 30 27 24" stroke="#8B7355" stroke-width="1.5" fill="white"/>
            <path d="M12 32 L18 29 L26 29 L32 32 L32 60 L12 60 Z" fill="#6366f1"/>
            <g class="high-five-left">
              <rect x="30" y="34" width="5" height="14" rx="2" fill="#6366f1"/>
              <ellipse cx="38" cy="36" rx="4" ry="5" fill="#F5DEB3"/>
            </g>
            <rect x="8" y="32" width="5" height="14" rx="2" fill="#6366f1" style="transform: rotate(-25deg); transform-origin: bottom;"/>
            <rect x="14" y="60" width="5" height="14" rx="2" fill="#374151"/>
            <rect x="25" y="60" width="5" height="14" rx="2" fill="#374151"/>
          </svg>
          <svg viewBox="0 0 45 80" class="w-14 h-24 celebrating" style="animation-delay: 0.05s;">
            <ellipse cx="22" cy="14" rx="10" ry="12" fill="#6B4423"/>
            <path d="M16 12 Q18 10 20 12" stroke="white" stroke-width="1.5" fill="none"/>
            <path d="M24 12 Q26 10 28 12" stroke="white" stroke-width="1.5" fill="none"/>
            <path d="M17 20 Q22 26 27 20" stroke="#4A2F1F" stroke-width="1.5" fill="white"/>
            <path d="M12 32 L18 29 L26 29 L32 32 L32 60 L12 60 Z" fill="#dc2626"/>
            <path d="M19 29 L22 34 L25 29" fill="#b91c1c"/>
            <g class="high-five-right">
              <rect x="8" y="34" width="5" height="14" rx="2" fill="#dc2626"/>
              <ellipse cx="6" cy="36" rx="4" ry="5" fill="#6B4423"/>
            </g>
            <rect x="30" y="32" width="5" height="14" rx="2" fill="#dc2626" style="transform: rotate(25deg); transform-origin: bottom;"/>
            <rect x="14" y="60" width="5" height="14" rx="2" fill="#374151"/>
            <rect x="25" y="60" width="5" height="14" rx="2" fill="#374151"/>
          </svg>
        </div>
        
        <!-- Cheering people on sides -->
        <svg viewBox="0 0 45 80" class="absolute bottom-8 left-10 w-14 h-24 celebrating" style="animation-delay: 0.1s;">
          <ellipse cx="22" cy="10" rx="12" ry="10" fill="#1a1a1a"/>
          <ellipse cx="22" cy="7" rx="10" ry="7" fill="#2d2d2d"/>
          <ellipse cx="22" cy="18" rx="9" ry="10" fill="#8B5A2B"/>
          <path d="M16 16 Q18 14 20 16" stroke="#2d1810" stroke-width="1.5" fill="none"/>
          <path d="M24 16 Q26 14 28 16" stroke="#2d1810" stroke-width="1.5" fill="none"/>
          <circle cx="11" cy="20" r="2" fill="#FFD700"/>
          <circle cx="33" cy="20" r="2" fill="#FFD700"/>
          <ellipse cx="22" cy="24" rx="4" ry="3" fill="#5C3D1E"/>
          <path d="M12 32 L18 29 L26 29 L32 32 L32 60 L12 60 Z" fill="#2563eb"/>
          <path d="M19 29 L22 36 L25 29" fill="white"/>
          <rect x="6" y="28" width="5" height="16" rx="2" fill="#2563eb" style="transform: rotate(-40deg); transform-origin: bottom;"/>
          <rect x="33" y="28" width="5" height="16" rx="2" fill="#2563eb" style="transform: rotate(40deg); transform-origin: bottom;"/>
          <ellipse cx="2" cy="20" rx="3" ry="4" fill="#8B5A2B"/>
          <ellipse cx="42" cy="20" rx="3" ry="4" fill="#8B5A2B"/>
          <rect x="14" y="60" width="5" height="14" rx="2" fill="#1e3a5f"/>
          <rect x="25" y="60" width="5" height="14" rx="2" fill="#1e3a5f"/>
        </svg>
        
        <svg viewBox="0 0 45 80" class="absolute bottom-8 right-10 w-14 h-24 celebrating" style="animation-delay: 0.08s;">
          <ellipse cx="22" cy="10" rx="11" ry="8" fill="#C41E3A"/>
          <path d="M11 12 Q9 26 14 36" stroke="#A01830" stroke-width="4" fill="none"/>
          <path d="M33 12 Q35 26 30 36" stroke="#A01830" stroke-width="4" fill="none"/>
          <ellipse cx="22" cy="18" rx="9" ry="10" fill="#FFE4C4"/>
          <circle cx="16" cy="19" r="0.8" fill="#D2A679"/>
          <circle cx="28" cy="19" r="0.8" fill="#D2A679"/>
          <path d="M16 16 Q18 14 20 16" stroke="#2d1810" stroke-width="1.5" fill="none"/>
          <path d="M24 16 Q26 14 28 16" stroke="#2d1810" stroke-width="1.5" fill="none"/>
          <ellipse cx="22" cy="24" rx="4" ry="3" fill="#CC6666"/>
          <path d="M12 32 L18 29 L26 29 L32 32 L32 60 L12 60 Z" fill="#10b981"/>
          <rect x="6" y="28" width="5" height="16" rx="2" fill="#10b981" style="transform: rotate(-45deg); transform-origin: bottom;"/>
          <rect x="33" y="28" width="5" height="16" rx="2" fill="#10b981" style="transform: rotate(45deg); transform-origin: bottom;"/>
          <ellipse cx="1" cy="18" rx="3" ry="4" fill="#FFE4C4"/>
          <ellipse cx="43" cy="18" rx="3" ry="4" fill="#FFE4C4"/>
          <rect x="14" y="60" width="5" height="14" rx="2" fill="#374151"/>
          <rect x="25" y="60" width="5" height="14" rx="2" fill="#374151"/>
        </svg>
        
        <!-- Lab coat woman clapping -->
        <svg viewBox="0 0 45 80" class="absolute bottom-8 left-32 w-14 h-24">
          <path d="M10 14 Q10 6 22 6 Q34 6 34 14 L34 26 Q31 27 28 25 L28 16 Q25 14 22 14 Q19 14 16 16 L16 25 Q13 27 10 26 Z" fill="#0a0a0a"/>
          <ellipse cx="22" cy="20" rx="8" ry="9" fill="#F5DEB3"/>
          <path d="M17 18 Q19 16 21 18 Q19 19 17 18" fill="white"/>
          <path d="M23 18 Q25 16 27 18 Q25 19 23 18" fill="white"/>
          <circle cx="19" cy="18" r="0.8" fill="#2d1810"/>
          <circle cx="25" cy="18" r="0.8" fill="#2d1810"/>
          <path d="M18 25 Q22 29 26 25" stroke="#CC8080" stroke-width="1.5" fill="none"/>
          <path d="M10 32 L16 29 L28 29 L34 32 L34 60 L10 60 Z" fill="white" stroke="#e5e7eb"/>
          <path d="M16 29 L22 38 L28 29" fill="#f3f4f6"/>
          <rect x="19" y="32" width="6" height="7" fill="#06b6d4"/>
          <g class="gesturing">
            <rect x="8" y="34" width="4" height="12" rx="2" fill="white" stroke="#e5e7eb"/>
            <rect x="32" y="34" width="4" height="12" rx="2" fill="white" stroke="#e5e7eb"/>
            <ellipse cx="19" cy="48" rx="4" ry="3" fill="#F5DEB3"/>
            <ellipse cx="25" cy="48" rx="4" ry="3" fill="#F5DEB3"/>
          </g>
          <rect x="14" y="60" width="5" height="14" rx="2" fill="#1e3a5f"/>
          <rect x="25" y="60" width="5" height="14" rx="2" fill="#1e3a5f"/>
        </svg>
        
        <!-- South Asian man cheering -->
        <svg viewBox="0 0 45 80" class="absolute bottom-8 right-32 w-14 h-24 celebrating" style="animation-delay: 0.12s;">
          <ellipse cx="22" cy="10" rx="10" ry="7" fill="#1a1a1a"/>
          <ellipse cx="22" cy="18" rx="9" ry="10" fill="#C68642"/>
          <path d="M14 22 Q16 30 22 32 Q28 30 30 22" fill="#1a1a1a"/>
          <path d="M16 16 Q18 14 20 16" stroke="#2d1810" stroke-width="1.5" fill="none"/>
          <path d="M24 16 Q26 14 28 16" stroke="#2d1810" stroke-width="1.5" fill="none"/>
          <path d="M12 34 L18 31 L26 31 L32 34 L32 60 L12 60 Z" fill="#374151"/>
          <path d="M19 31 L22 36 L25 31" fill="white"/>
          <rect x="6" y="32" width="5" height="16" rx="2" fill="#374151" style="transform: rotate(-35deg); transform-origin: bottom;"/>
          <rect x="33" y="32" width="5" height="16" rx="2" fill="#374151" style="transform: rotate(35deg); transform-origin: bottom;"/>
          <ellipse cx="3" cy="24" rx="3" ry="4" fill="#C68642"/>
          <ellipse cx="41" cy="24" rx="3" ry="4" fill="#C68642"/>
          <rect x="14" y="60" width="5" height="14" rx="2" fill="#1f2937"/>
          <rect x="25" y="60" width="5" height="14" rx="2" fill="#1f2937"/>
        </svg>
        
        <div class="absolute bottom-2 left-0 right-0 text-center">
          <div class="text-slate-600 text-sm font-medium bg-white/80 inline-block px-4 py-1.5 rounded-full shadow">
            ğŸ‰ Great work team!
          </div>
        </div>
      </div>
    `;
  }

  // ===== YOUR JOURNEY - Comprehensive Case Study Generator =====
  
  // Log a journey event for the narrative
  logJourneyEvent(type, data) {
    this.journeyEvents.push({
      quarter: this.turn,
      year: Math.ceil(this.turn / 4),
      type: type,
      data: data,
      metrics: { ...this.metrics },
      timestamp: Date.now()
    });
    
    // Track peak valuation
    if (this.metrics.val > this.peakValuation) {
      this.peakValuation = this.metrics.val;
    }
    
    // Track lowest cash
    if (this.metrics.cash < this.lowestCash) {
      this.lowestCash = this.metrics.cash;
    }
  }
  
  // Track decision patterns for leadership style analysis
  trackDecisionPattern(domain, choiceIdx, event) {
    if (!event || !event.event || !event.event.choices) return;
    
    const choice = event.event.choices[choiceIdx];
    if (!choice) return;
    
    // Track AP investment per domain
    this.domainInvestments[domain] = (this.domainInvestments[domain] || 0) + (choice.ap || 0);
    
    // Track if player followed funder advice
    const advice = this.funderAdvices.find(a => a.domain === domain);
    if (advice) {
      if (advice.recommendedChoice === choiceIdx) {
        this.funderAdviceFollowed++;
      } else {
        this.funderAdviceIgnored++;
      }
    }
    
    // Track aggressive vs conservative (based on AP cost - higher AP = more aggressive)
    if (choice.ap >= 4) {
      this.aggressiveChoices++;
    } else if (choice.ap <= 2) {
      this.conservativeChoices++;
    }
    
    // Store the decision for Critical Decisions section
    if (!this.criticalDecisions) this.criticalDecisions = [];
    if (choice.ap >= 3) { // Only track significant decisions
      this.criticalDecisions.push({
        quarter: this.turn,
        domain: domain,
        situation: event.event.intro,
        choice: choice.text,
        ap: choice.ap
      });
    }
  }
  
  // Save quarter summary for narrative
  saveQuarterSummary() {
    const decisions = Object.entries(this.choices).map(([domain, choiceIdx]) => {
      const eventData = this.currentEvents[domain];
      if (eventData && eventData.event && eventData.event.choices && eventData.event.choices[choiceIdx]) {
        // Track decision pattern
        this.trackDecisionPattern(domain, choiceIdx, eventData);
        
        return {
          domain: domain,
          intro: eventData.event.intro,
          choice: eventData.event.choices[choiceIdx].text,
          reaction: eventData.event.choices[choiceIdx].reaction,
          ap: eventData.event.choices[choiceIdx].ap || 0
        };
      }
      return null;
    }).filter(Boolean);
    
    this.quarterSummaries.push({
      quarter: this.turn,
      year: Math.ceil(this.turn / 4),
      decisions: decisions,
      metrics: { ...this.metrics },
      milestone: this.milestone ? { ...this.milestone } : null,
      milestoneProgress: this.milestoneProgress,
      staff: this.metrics.staff,
      cash: this.metrics.cash,
      valuation: this.metrics.val,
      runway: this.metrics.burn > 0 ? Math.floor(this.metrics.cash / this.metrics.burn) : 99
    });
  }
  
  // Determine leadership style archetype
  getLeadershipArchetype() {
    const totalAdvice = this.funderAdviceFollowed + this.funderAdviceIgnored;
    const followRate = totalAdvice > 0 ? (this.funderAdviceFollowed / totalAdvice) : 0.5;
    const totalRisk = this.aggressiveChoices + this.conservativeChoices;
    const riskRate = totalRisk > 0 ? (this.aggressiveChoices / totalRisk) : 0.5;
    
    // Determine dominant domain
    const domains = Object.entries(this.domainInvestments).sort((a, b) => b[1] - a[1]);
    const topDomain = domains[0]?.[0] || 'research';
    
    // Archetypes based on patterns
    if (topDomain === 'research' && riskRate > 0.5) {
      return {
        title: "The Visionary Scientist",
        description: "A research-first leader who prioritized breakthrough science and wasn't afraid to bet big on technical moonshots, even when the path forward was uncertain."
      };
    } else if (topDomain === 'research' && riskRate <= 0.5) {
      return {
        title: "The Methodical Researcher",
        description: "A careful, evidence-driven leader who built the company on solid scientific foundations, preferring proven approaches over risky experiments."
      };
    } else if (topDomain === 'marketing' && riskRate > 0.5) {
      return {
        title: "The Growth Hacker",
        description: "An aggressive market-focused leader who believed that speed and customer traction would win the day, willing to sacrifice technical depth for commercial momentum."
      };
    } else if (topDomain === 'marketing' && riskRate <= 0.5) {
      return {
        title: "The Customer Champion",
        description: "A market-oriented leader who let customer needs guide every decision, building a company that truly understood its users."
      };
    } else if (topDomain === 'dev' && riskRate > 0.5) {
      return {
        title: "The Product Visionary",
        description: "A builder at heart who believed great products speak for themselves, investing heavily in creating something users would love."
      };
    } else if (topDomain === 'dev' && riskRate <= 0.5) {
      return {
        title: "The Pragmatic Builder",
        description: "A practical leader focused on shipping reliable products, knowing that sustainable progress beats flashy launches."
      };
    } else if (followRate > 0.7) {
      return {
        title: "The Collaborative Leader",
        description: "A team player who valued investor relationships and stakeholder input, building consensus before making major moves."
      };
    } else if (followRate < 0.3) {
      return {
        title: "The Independent Founder",
        description: "A conviction-driven leader who trusted their own judgment over external advice, for better or worse."
      };
    } else {
      return {
        title: "The Balanced Strategist",
        description: "A versatile leader who adapted their approach to circumstances, balancing technical depth with market awareness."
      };
    }
  }
  
  // Generate "The Story" section
  generateStorySection() {
    const companyName = this.company?.name || "The Startup";
    const companyId = this.company?.id || "aether";
    const locationName = this.location?.name || "the UK";
    const funderName = this.funder?.name || "early investors";
    
    // Company-specific opening hooks
    const companyHooks = {
      aether: "AI could fundamentally transform how we understand protein structures, with implications for drug discovery that could affect millions of lives",
      vanguard: "autonomous robots could revolutionize warehouse logistics, transforming supply chains and reshaping how goods move through the economy",
      quant: "machine learning could decode market patterns invisible to human traders, creating opportunities in financial markets that traditional analysts simply couldn't see",
      dream: "AI could understand and generate creative content, opening new possibilities for entertainment, education, and human expression",
      cyber: "AI-powered security could stay ahead of evolving threats, protecting organizations from attacks that legacy systems simply couldn't detect",
      terra: "satellite imagery combined with AI could unlock insights about our planet that would transform agriculture, urban planning, and environmental protection",
      legal: "natural language processing could democratize access to legal expertise, helping ordinary people navigate complex systems that had previously required expensive professionals",
      edu: "adaptive learning systems could personalize education at scale, giving every student the equivalent of a dedicated tutor"
    };
    
    const hook = companyHooks[companyId] || "AI could fundamentally transform entire industries, creating opportunities for those bold enough to pursue them";
    
    let story = `${companyName} emerged from a simple but powerful observation: ${hook}. `;
    
    if (locationName === "Oxford" || locationName === "Cambridge") {
      story += `Founded in ${locationName}'s thriving ${companyId === 'aether' ? 'life sciences' : 'research'} ecosystem, the company bet that deep technical expertise combined with ambitious goals could carve out a defensible position in an increasingly crowded AI landscape. `;
      story += `The founding team made a deliberate choice to start in ${locationName} rather than London. The decision prioritized access to world-class research talent and proximity to ${companyId === 'aether' ? 'pharmaceutical giants' : 'industry leaders'} over the networking density of the capital. This choice would prove significant-it shaped not just who they could hire, but how the company thought about problems.`;
    } else if (locationName === "London") {
      story += `Founded in London's vibrant tech scene, the company positioned itself at the intersection of capital, talent, and opportunity. `;
      story += `The choice of London was strategic: access to diverse talent pools, proximity to major ${companyId === 'quant' ? 'financial institutions' : 'clients'}, and the energy of Europe's largest startup ecosystem. The city's pace would set the tempo for everything that followed.`;
    } else if (locationName === "Manchester" || locationName === "Leeds" || locationName === "Bristol" || locationName === "Edinburgh") {
      story += `Founded in ${locationName}, the company took a different path from the London-centric startup playbook. `;
      story += `The decision to build outside the capital was deliberate-lower costs meant longer runway, and the local talent pool, while smaller, proved fiercely loyal. It was a bet that great companies could be built anywhere, and ${locationName}'s growing tech scene would provide everything needed to succeed.`;
    } else {
      story += `Founded in ${locationName}, the company set out to prove that breakthrough AI could come from anywhere, not just the usual tech hubs. `;
    }
    
    return story;
  }
  
  // Generate "Strategic Approach" section
  generateStrategicApproach() {
    const companyId = this.company?.id || "aether";
    const companyName = this.company?.name || "The Startup";
    const totalAdvice = this.funderAdviceFollowed + this.funderAdviceIgnored;
    const followRate = totalAdvice > 0 ? (this.funderAdviceFollowed / totalAdvice) : 0.5;
    const totalRisk = this.aggressiveChoices + this.conservativeChoices;
    const riskRate = totalRisk > 0 ? (this.aggressiveChoices / totalRisk) : 0.5;
    
    const domains = Object.entries(this.domainInvestments).sort((a, b) => b[1] - a[1]);
    const topDomain = domains[0]?.[0] || 'research';
    const secondDomain = domains[1]?.[0] || 'dev';
    
    // Company-specific domain narratives
    const domainNarratives = {
      research: {
        aether: "When faced with trade-offs between speed-to-market and technical depth, the team consistently chose depth. This wasn't recklessness-it was a calculated bet that in AI for life sciences, superficial solutions would eventually be exposed, while genuine breakthroughs would compound.",
        quant: "When faced with trade-offs between rapid deployment and model robustness, the team consistently chose robustness. They understood that in financial markets, a model that works 99% of the time but fails catastrophically during volatility is worthless.",
        cyber: "When faced with trade-offs between feature velocity and security depth, the team consistently chose depth. They knew that in cybersecurity, a single vulnerability could undermine everything else.",
        default: "When faced with trade-offs between speed-to-market and technical depth, the team consistently chose depth. This wasn't recklessness-it was a calculated bet that in AI, superficial solutions would eventually be exposed, while genuine breakthroughs would compound."
      },
      dev: {
        vanguard: "The focus on product quality meant that every robot shipped had to meet exacting standards. The team believed that in hardware-software integration, reputation is everything-a single failure in the field could undo years of credibility building.",
        dream: "The focus on user experience meant that every creative tool had to feel magical, not just functional. The team believed that in creative applications, delight was a feature, and anything that felt clunky would be abandoned.",
        default: "The focus on product quality meant that every feature shipped had to meet a high bar. The team believed that in a crowded market, the product itself was the best marketing-word of mouth from delighted users would outperform any advertising spend."
      },
      marketing: {
        edu: "The emphasis on market presence reflected a belief that in education, relationships with institutions mattered more than raw technology. The team invested heavily in understanding procurement cycles and building trusted relationships with decision-makers.",
        legal: "The emphasis on market presence reflected understanding that law firms buy on reputation and referral. The team invested heavily in thought leadership and case studies before competitors could establish themselves.",
        default: "The emphasis on market presence reflected a belief that technology alone doesn't win-you have to own the customer relationship. The team invested heavily in understanding customer needs and building the brand before competitors could establish themselves."
      },
      hr: {
        default: "The focus on team culture proved prescient. By investing early in the right people and the right environment, the company built an organization that could execute under pressure and adapt to changing circumstances."
      }
    };
    
    let approach = `The leadership approach that emerged was distinctly ${topDomain === 'research' ? 'research' : topDomain === 'dev' ? 'product' : topDomain === 'marketing' ? 'market' : 'people'}-centric. `;
    approach += (domainNarratives[topDomain]?.[companyId] || domainNarratives[topDomain]?.default || domainNarratives.research.default) + " ";
    
    // Risk appetite with specific examples
    if (riskRate > 0.6) {
      approach += `Risk appetite ran high. The team allocated significant resources to ambitious ${topDomain === 'research' ? 'research directions' : 'initiatives'}, accepting that some would fail entirely. This approach created tension with investors who preferred more predictable progress, but the founders held firm, believing that the upside from a genuine breakthrough would dwarf the cost of failed experiments. `;
    } else if (riskRate < 0.4) {
      approach += `The approach to risk was notably conservative. Rather than swinging for the fences, the team focused on steady, measurable progress-each quarter building on the last. This patience sometimes frustrated investors eager for dramatic growth, but it meant the company never faced an existential crisis from a failed moonshot. `;
    } else {
      approach += `The team maintained a balanced approach to risk, knowing when to push aggressively and when to consolidate gains. They weren't afraid to make bold bets, but they sized those bets carefully to ensure the company could survive if things went wrong. `;
    }
    
    // Investor relationship with more texture
    if (followRate > 0.6) {
      approach += `The relationship with ${this.funder?.name || 'investors'} evolved into something genuinely collaborative. Rather than treating board meetings as reporting exercises, the team engaged investors as thought partners, incorporating their pattern recognition from dozens of similar companies while maintaining conviction on technical direction. This balance proved crucial when the company needed to raise additional capital-the trust built over quarters of honest dialogue translated into strong terms.`;
    } else if (followRate < 0.4) {
      approach += `The relationship with ${this.funder?.name || 'investors'} was more independent than collaborative. The founders believed they understood the ${companyId === 'aether' ? 'science' : companyId === 'quant' ? 'markets' : 'technology'} better than anyone else and weren't afraid to overrule investor concerns when they disagreed. This independence came at a cost in relationship terms, but it allowed the company to pursue its vision without compromise-for better or worse.`;
    } else {
      approach += `The relationship with ${this.funder?.name || 'investors'} struck a pragmatic balance. The team listened carefully to investor input, implemented suggestions when they made sense, and pushed back firmly when they didn't. Neither party got everything they wanted, but the tension proved productive-each perspective sharpened the other's thinking.`;
    }
    
    return approach;
  }
  
  // Generate "The Journey" section
  generateJourneySection() {
    const companyName = this.company?.name || "The Startup";
    const companyId = this.company?.id || "aether";
    const milestones = this.completedMilestones || [];
    const funderName = this.funder?.name || "investors";
    let journey = "";
    
    // Company-specific early challenges
    const earlyChallengePhrases = {
      aether: "The scientific challenges proved thornier than anticipated, with initial approaches hitting dead ends that required fundamental rethinking. ",
      vanguard: "The hardware-software integration proved more complex than expected, with early prototypes revealing gaps between simulation and reality. ",
      quant: "Market conditions tested every assumption, with initial models failing to account for edge cases that only became apparent in live trading. ",
      dream: "User expectations evolved faster than the technology, forcing constant iteration on what \"good enough\" actually meant. ",
      cyber: "The threat landscape shifted continuously, requiring the team to balance defensive capability with the need to ship product. ",
      terra: "Data quality issues emerged that hadn't been apparent in early experiments, requiring significant preprocessing work. ",
      legal: "Regulatory complexity varied wildly across use cases, making it harder than expected to build generalizable solutions. ",
      edu: "Measuring learning outcomes proved surprisingly difficult, complicating efforts to demonstrate the system's effectiveness. "
    };
    
    // Early phase
    journey += `The early months were consumed by the race toward proof of concept. `;
    journey += earlyChallengePhrases[companyId] || "Initial approaches required iteration before finding the right path. ";
    
    // Add early critical decisions for texture
    const earlyDecisions = (this.criticalDecisions || []).filter(d => d.quarter <= 4);
    if (earlyDecisions.length > 0) {
      const keyDecision = earlyDecisions.sort((a, b) => (b.ap || 0) - (a.ap || 0))[0];
      const situationIntro = keyDecision.situation?.split('.')[0]?.toLowerCase() || 'the team faced a strategic crossroads';
      journey += `A defining early choice came when ${situationIntro}. The founders chose to "${keyDecision.choice}", a decision that would shape the company's trajectory. `;
    }
    
    // Calculate and include lowest cash point if it was close
    const lowestCashQuarter = this.quarterSummaries?.reduce((min, q) => (!min || q.cash < min.cash) ? q : min, null);
    if (lowestCashQuarter && lowestCashQuarter.cash < 100 && lowestCashQuarter.cash > 0) {
      journey += `Cash burned while the team iterated, at one point dropping to just Â£${lowestCashQuarter.cash}k in Quarter ${lowestCashQuarter.quarter}-close enough to the edge that every decision carried existential weight. But `;
    } else if (this.quarterSummaries?.some(q => q.cash < 150)) {
      journey += `Cash burned while the team iterated, and there were moments when the runway felt uncomfortably short. But `;
    }
    
    // First milestone
    const firstMilestoneEvent = this.journeyEvents.find(e => e.type === 'milestone' && e.data.milestoneNumber === 1);
    if (firstMilestoneEvent) {
      journey += `the breakthrough came in Quarter ${firstMilestoneEvent.quarter} when a novel approach finally yielded results that exceeded expectations. This first milestone unlocked everything that followed. `;
    }
    
    // Validation and funding
    const fundingEvents = this.journeyEvents.filter(e => e.type === 'funding' && e.quarter > 1);
    if (fundingEvents.length > 0) {
      const mainRaise = fundingEvents[0];
      journey += `Validation from early partners provided both revenue and credibility, making the subsequent funding round significantly easier. The Â£${Math.round(mainRaise.data.amount)}k from ${mainRaise.data.funderName} came at terms that reflected genuine confidence rather than desperation. `;
    }
    
    // Shocks and challenges with richer detail
    const shocks = this.journeyEvents.filter(e => e.type === 'shock');
    if (shocks.length > 0) {
      journey += `Not everything went smoothly. `;
      const negativeShock = shocks.find(s => s.data.type === 'negative');
      if (negativeShock) {
        journey += `Quarter ${negativeShock.quarter} brought the "${negativeShock.data.headline}"-a wave of ${negativeShock.data.text?.includes('investor') ? 'investor hesitation' : 'market uncertainty'} that spooked some customers and investors. The team's response was instructive: rather than retreating into defensive positioning, they ${this.aggressiveChoices > this.conservativeChoices ? 'doubled down on their approach' : 'adapted their messaging carefully'}, confident that their actual results would speak louder than market sentiment. The bet paid off; customers who conducted due diligence quickly distinguished ${companyName}'s genuine capabilities from vaporware competitors. `;
      } else {
        const positiveShock = shocks.find(s => s.data.type === 'positive');
        if (positiveShock) {
          journey += `Quarter ${positiveShock.quarter} brought an unexpected tailwind: "${positiveShock.data.headline}". The team moved quickly to capitalize on the fortunate timing. `;
        }
      }
    }
    
    // Add mid-game pivotal decisions
    const midDecisions = (this.criticalDecisions || []).filter(d => d.quarter > 4 && d.quarter <= 8);
    if (midDecisions.length > 0 && milestones.length >= 1) {
      const pivotalDecision = midDecisions.sort((a, b) => (b.ap || 0) - (a.ap || 0))[0];
      if (pivotalDecision) {
        journey += `A pivotal moment came in Quarter ${pivotalDecision.quarter}: ${pivotalDecision.situation?.split('.')[0] || 'the team faced another crossroads'}. They chose to "${pivotalDecision.choice}". `;
      }
    }
    
    // Later milestones with company-specific language
    if (milestones.length >= 2) {
      const laterMilestoneNarratives = {
        aether: "Clinical partnerships validated the commercial model, and the regulatory pathway milestone demonstrated that the science could survive contact with real-world constraints.",
        vanguard: "Deployment partnerships validated the commercial model, and the manufacturing milestone demonstrated that the technology could scale beyond prototype.",
        quant: "Institutional partnerships validated the commercial model, and the regulatory compliance milestone opened doors to larger mandates.",
        dream: "Enterprise partnerships validated the commercial model, and the platform stability milestone demonstrated readiness for scale.",
        cyber: "Enterprise deployments validated the commercial model, and the certification milestone opened doors to regulated industries.",
        terra: "Agricultural partnerships validated the commercial model, and the prediction accuracy milestone built credibility with skeptical customers.",
        legal: "Law firm partnerships validated the commercial model, and the compliance milestone demonstrated readiness for sensitive work.",
        edu: "Institutional partnerships validated the commercial model, and the outcomes milestone provided evidence for wider adoption."
      };
      
      journey += `The second and third milestones came with increasing momentum. ${milestones.length >= 3 ? (laterMilestoneNarratives[companyId] || laterMilestoneNarratives['aether']) : 'Each achievement built credibility that made the next step easier.'} `;
    } else if (milestones.length === 1) {
      journey += `With the first milestone complete, the path forward seemed clearer-though significant challenges remained.`;
    }
    
    return journey;
  }
  
  // Get defining moments for the journey with rich descriptions
  getDefiningMoments() {
    let moments = [];
    const companyId = this.company?.id || "aether";
    const companyName = this.company?.name || "The Startup";
    const topDomain = Object.entries(this.domainInvestments).sort((a, b) => b[1] - a[1])[0]?.[0] || 'research';
    
    // Company-specific milestone language
    const milestoneDescriptions = {
      1: {
        aether: "The breakthrough in protein structure prediction validated months of painstaking research and opened doors to pharmaceutical partnerships that had previously seemed out of reach.",
        vanguard: "The first robot successfully completed its warehouse tasks without human intervention-a milestone that proved the core technology worked and attracted serious commercial interest.",
        quant: "The trading model's first profitable quarter exceeded expectations, demonstrating that the AI could identify genuine market inefficiencies rather than just overfitting historical patterns.",
        dream: "The creative AI generated content that users genuinely loved, proving that machine learning could enhance rather than replace human creativity.",
        cyber: "The security system detected and blocked its first real attack, validating the approach and building confidence with enterprise customers who had been skeptical of AI claims.",
        terra: "Satellite analysis predictions matched ground-truth data with remarkable accuracy, convincing agricultural clients that the technology could genuinely improve their yields.",
        legal: "The contract analysis tool successfully identified a material error that human lawyers had missed, demonstrating real value beyond mere document processing.",
        edu: "Student outcome data showed measurable improvement compared to control groups, providing the evidence needed to convince cautious educational institutions."
      },
      2: {
        aether: "The clinical partnership brought not just revenue but validation from experts who understood the deep scientific challenges being addressed.",
        default: "This commercial milestone validated the business model and provided both revenue momentum and market credibility that accelerated subsequent deals."
      },
      3: {
        default: "The final milestone demonstrated that the company could execute at scale, proving that early success wasn't a fluke and the technology could handle real-world complexity."
      }
    };
    
    // Milestones with rich context
    this.journeyEvents.filter(e => e.type === 'milestone').forEach(e => {
      const milestoneNum = e.data.milestoneNumber;
      let description = "";
      
      if (milestoneNum === 1) {
        description = milestoneDescriptions[1][companyId] || milestoneDescriptions[1]['aether'];
      } else if (milestoneNum === 2) {
        description = milestoneDescriptions[2][companyId] || milestoneDescriptions[2]['default'];
      } else {
        description = milestoneDescriptions[3]['default'];
      }
      
      // Use actual milestone name if available
      const title = e.data.name || `Milestone ${milestoneNum} Complete`;
      
      moments.push({
        quarter: e.quarter,
        title: title,
        description: description,
        type: 'milestone'
      });
    });
    
    // Funding rounds with specific investor context
    this.journeyEvents.filter(e => e.type === 'funding' && e.quarter > 1).forEach(e => {
      const terms = e.data.dilution > 20 ? "demanding" : e.data.dilution > 15 ? "reasonable" : "favorable";
      const phase = e.data.stage === 'Series A' ? 'aggressive scaling and market expansion' : 'continued product development and team growth';
      
      moments.push({
        quarter: e.quarter,
        title: `${e.data.stage || 'Funding Round'} Closed`,
        description: `Raised Â£${Math.round(e.data.amount)}k from ${e.data.funderName} at ${terms} terms, providing the runway needed for ${phase}. The investment signaled growing market confidence in the company's trajectory.`,
        type: 'funding'
      });
    });
    
    // Significant shocks with detailed context
    this.journeyEvents.filter(e => e.type === 'shock').forEach(e => {
      const wasAggressive = this.aggressiveChoices > this.conservativeChoices;
      let description = "";
      
      if (e.data.type === 'positive') {
        description = `${e.data.text || 'Favorable market conditions emerged'} The team moved quickly to capitalize on the opportunity, ${wasAggressive ? 'accelerating plans that were already ambitious' : 'adjusting strategy to take advantage of the tailwind'}.`;
      } else {
        description = `${e.data.text || 'Market headwinds created unexpected challenges.'} Rather than retreating, the team ${wasAggressive ? 'doubled down on their conviction, betting that substance would prevail over sentiment' : 'adapted carefully, protecting core strengths while weathering the storm'}.`;
      }
      
      moments.push({
        quarter: e.quarter,
        title: e.data.headline || 'Market Shift',
        description: description,
        type: e.data.type === 'positive' ? 'opportunity' : 'challenge'
      });
    });
    
    // Cash crises with dramatic context
    this.quarterSummaries.filter(q => q.cash < 50 && q.cash > 0).forEach(q => {
      moments.push({
        quarter: q.quarter,
        title: "Runway Crisis",
        description: `With just Â£${q.cash}k remaining, the company faced an existential choice. Every expenditure was scrutinized, every hire questioned. The pressure forced clarity about what truly mattered-and what could wait.`,
        type: 'crisis'
      });
    });
    
    return moments.sort((a, b) => a.quarter - b.quarter).slice(0, 5);
  }
  
  // Get critical decisions
  getCriticalDecisions() {
    if (!this.criticalDecisions) return [];
    
    // Get most significant decisions (highest AP cost), max 4
    return this.criticalDecisions
      .sort((a, b) => b.ap - a.ap)
      .slice(0, 4)
      .map(d => ({
        quarter: d.quarter,
        domain: d.domain.charAt(0).toUpperCase() + d.domain.slice(1),
        situation: d.situation,
        choice: d.choice
      }));
  }
  
  // Generate what worked / what didn't
  generateWhatWorkedDidnt() {
    const companyId = this.company?.id || "aether";
    const domains = Object.entries(this.domainInvestments).sort((a, b) => b[1] - a[1]);
    const topDomain = domains[0]?.[0] || 'research';
    const bottomDomain = domains[domains.length - 1]?.[0] || 'marketing';
    
    const totalAdvice = this.funderAdviceFollowed + this.funderAdviceIgnored;
    const followRate = totalAdvice > 0 ? (this.funderAdviceFollowed / totalAdvice) : 0.5;
    
    const success = this.completedMilestones.length >= 3;
    const cashCrises = this.quarterSummaries.filter(q => q.cash < 50).length;
    
    let worked = [];
    let didnt = [];
    
    // What worked - domain specific with richer detail
    if (topDomain === 'research') {
      worked.push(`Research-first strategy created genuine technical moat that competitors ${success ? 'couldn\'t replicate' : 'found difficult to match'}`);
    } else if (topDomain === 'dev') {
      worked.push(`Product focus delivered quality that ${success ? 'users loved and recommended' : 'earned user appreciation'}`);
    } else if (topDomain === 'marketing') {
      worked.push("Market-driven approach built strong customer relationships early");
    } else if (topDomain === 'hr') {
      worked.push("Investment in team culture attracted and retained top talent");
    }
    
    if (followRate > 0.5) {
      worked.push("Collaborative investor relationships built trust that improved subsequent funding terms");
    }
    
    if (this.location?.name === "Oxford" || this.location?.name === "Cambridge") {
      worked.push(`${this.location.name} location provided access to exceptional ${topDomain === 'research' ? 'scientific' : 'technical'} talent`);
    } else if (this.location?.name === "London") {
      worked.push("London base enabled rapid networking and client access");
    } else {
      worked.push(`${this.location?.name || 'Regional'} location kept costs manageable while building the team`);
    }
    
    // What didn't work - more specific
    if (this.quarterSummaries.some(q => q.cash < 100)) {
      didnt.push(`Initial ${companyId === 'aether' ? 'algorithm approaches' : 'product iterations'} required multiple pivots before finding the right path`);
    }
    
    if (bottomDomain === 'marketing' && topDomain !== 'marketing') {
      didnt.push("Sales capability lagged behind technical progress, slowing early revenue growth");
    } else if (bottomDomain === 'research' && topDomain !== 'research') {
      didnt.push("Technical depth sometimes sacrificed for speed to market");
    }
    
    if (this.quarterSummaries.length > 0) {
      const avgStaff = this.quarterSummaries.reduce((s, q) => s + (q.staff || 5), 0) / this.quarterSummaries.length;
      if (avgStaff < 6) {
        didnt.push("Conservative hiring meant some opportunities moved slower than ideal");
      }
    }
    
    if (followRate < 0.4) {
      didnt.push("Tension with investors created friction that consumed management attention");
    }
    
    // Check for excessive passing/skipping
    if (this.totalPasses > this.turn * 1.5) {
      didnt.push("Too many decisions were deferred or skipped, slowing progress across all areas");
    }
    
    // Ensure at least 3 items each with meaningful content
    if (worked.length < 3) worked.push(`Team maintained focus and conviction through ${success ? 'challenges' : 'difficult periods'}`);
    if (didnt.length < 3) didnt.push("Some early assumptions proved wrong and required course correction");
    
    return { worked: worked.slice(0, 3), didnt: didnt.slice(0, 3) };
  }
  
  // Generate outcome section with rich detail
  generateOutcomeSection() {
    const companyName = this.company?.name || "The Startup";
    const companyId = this.company?.id || "aether";
    const milestones = this.completedMilestones.length;
    const quarters = this.turn;
    const val = this.metrics.val;
    const equity = this.metrics.equity;
    const staff = this.metrics.staff;
    const success = milestones >= 3;
    const topDomain = Object.entries(this.domainInvestments).sort((a, b) => b[1] - a[1])[0]?.[0] || 'research';
    
    let outcome = "";
    
    if (success) {
      outcome += `${companyName} achieved all three milestones in ${quarters} quarters-a genuine accomplishment in a domain where most startups fail. `;
      outcome += `The final position reflects both success and trade-offs: a Â£${(val/1000).toFixed(1)}M valuation validates the approach, while ${equity.toFixed(1)}% founder ownership means the team maintained meaningful control despite raising external capital. `;
      outcome += `The ${staff}-person team assembled by the end represents ${staff > 8 ? 'ambitious' : 'careful rather than aggressive'} hiring. Each addition was deliberate, prioritizing cultural fit and technical excellence over rapid scaling. This approach kept burn rate manageable and team dynamics healthy, even as expectations grew. `;
      outcome += `Perhaps most importantly, the company ends this phase with genuine ${topDomain === 'research' ? 'technical differentiation' : topDomain === 'marketing' ? 'market position' : 'product quality'}. The ${topDomain === 'research' ? 'research-first strategy created intellectual property' : topDomain === 'marketing' ? 'market-driven approach built customer relationships' : 'product focus delivered quality'} that competitors cannot easily replicate, providing a foundation for whatever comes next-whether that's continued independent growth, strategic partnership, or acquisition.`;
    } else if (this.metrics.cash <= 0) {
      outcome += `${companyName}'s journey ended after ${quarters} quarters when the company ran out of runway. `;
      outcome += `With ${milestones} milestone${milestones !== 1 ? 's' : ''} completed, the team had shown promise but ultimately couldn't sustain operations long enough to reach profitability or secure the next funding round. `;
      outcome += `This outcome, while disappointing, is far from unusual-the majority of startups fail, and those that do often fail for the same reason: cash ran out before product-market fit was achieved. `;
      outcome += `The lessons learned here will prove valuable for future ventures. Several team members have developed skills and networks that will serve them well, and the technical work may yet find a home through acqui-hire or IP sale.`;
    } else if (this.consecutiveHighPassQuarters >= 5) {
      outcome += `${companyName}'s journey ended after ${quarters} quarters when the board lost confidence in the founder's commitment. `;
      outcome += `Quarter after quarter of inaction-skipping decisions, avoiding tough calls-sent a clear message to investors and team alike: the founder had mentally checked out. `;
      outcome += `In startups, momentum is everything. A CEO who won't make decisions creates a leadership vacuum that talented people and patient capital simply won't tolerate. `;
      outcome += `The company may yet survive under new leadership, but this particular chapter has closed.`;
    } else {
      outcome += `${companyName} reached a crossroads after ${quarters} quarters with ${milestones} milestone${milestones !== 1 ? 's' : ''} completed. `;
      outcome += `While not achieving all objectives, the team built something of value-a Â£${(val/1000).toFixed(1)}M enterprise with real technology and customer relationships. `;
      outcome += `The story isn't over. This foundation could support a pivot, a merger, or a fresh attempt with new capital and hard-won lessons about what works in this market.`;
    }
    
    return outcome;
  }
  
  // Generate lessons section with rich reflections
  generateLessonsSection() {
    const companyName = this.company?.name || 'The Startup';
    const companyId = this.company?.id || 'aether';
    const locationName = this.location?.name || 'the UK';
    const topDomain = Object.entries(this.domainInvestments).sort((a, b) => b[1] - a[1])[0]?.[0] || 'research';
    const success = this.completedMilestones.length >= 3;
    const riskRate = (this.aggressiveChoices + 1) / (this.aggressiveChoices + this.conservativeChoices + 1);
    const totalAdvice = this.funderAdviceFollowed + this.funderAdviceIgnored;
    const followRate = totalAdvice > 0 ? (this.funderAdviceFollowed / totalAdvice) : 0.5;
    
    let lessons = "";
    
    lessons += `The ${companyName} journey ${success ? 'validates' : 'illustrates'} several principles while complicating others. `;
    
    // Domain-specific lessons
    if (topDomain === 'research') {
      lessons += `The research-centric approach ${success ? 'worked here' : 'showed promise'}, but it required patient capital and a market that valued genuine technical depth. In faster-moving consumer markets, the same approach might have been fatal. `;
    } else if (topDomain === 'marketing') {
      lessons += `The market-first approach ${success ? 'proved effective' : 'had merit'}, though it meant constantly balancing customer demands against technical capabilities. The tension was productive, but exhausting. `;
    } else if (topDomain === 'dev') {
      lessons += `The product-centric approach ${success ? 'delivered results' : 'showed potential'}, validating the belief that quality compounds over time. But it also meant saying no to opportunities that might have accelerated growth. `;
    }
    
    // Risk lessons
    if (riskRate > 0.5) {
      lessons += `The decision to embrace risk ${success ? 'paid off' : 'was a calculated gamble'}, but this outcome shouldn't be over-learned. High-variance strategies sometimes produce spectacular results; other times they produce spectacular failures. What mattered here was that the risks were calculated and the team had enough runway to survive the experiments that didn't work. `;
    } else {
      lessons += `The conservative approach to risk ${success ? 'provided stability' : 'may have limited upside'}. In a market that rewards bold moves, measured progress has its own risks. `;
    }
    
    // Investor relationship lessons
    if (followRate > 0.6) {
      lessons += `The collaborative investor relationship proved valuable, but it was built through consistent honesty, including about setbacks. Trust accumulated over time through a pattern of transparent communication, not through any single moment of openness. `;
    }
    
    // Location lessons
    lessons += `Finally, the ${locationName} ${locationName === 'London' ? '' : 'location '}choice illustrates how early decisions cascade through a company's life. `;
    if (locationName === "Oxford" || locationName === "Cambridge") {
      lessons += `Access to ${topDomain === 'research' ? 'research' : 'technical'} talent shaped hiring, which shaped culture, which shaped strategic choices. `;
    }
    lessons += `There's no single "right" answer to ${locationName === 'London' ? 'whether to base in London' : 'location decisions'}-but there are answers that align with a company's genuine strengths.`;
    
    return lessons;
  }
  
  // Show contributors modal
  showContributorsModal() {
    const modal = document.getElementById('contributorsModal');
    if (modal) {
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }
  }
  
  hideContributorsModal() {
    const modal = document.getElementById('contributorsModal');
    if (modal) {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }
  }
  
  // Show the journey modal
  showResearchModal() {
    const modal = document.getElementById('researchModal');
    if (modal) {
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }
  }
  
  hideResearchModal() {
    const modal = document.getElementById('researchModal');
    if (modal) {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }
  }
  
  showJourneyModal() {
    const modal = document.getElementById('journeyModal');
    const content = document.getElementById('journeyContent');
    
    if (!modal || !content) return;
    
    const archetype = this.getLeadershipArchetype();
    const success = this.completedMilestones.length >= 3;
    const whatWorked = this.generateWhatWorkedDidnt();
    const moments = this.getDefiningMoments();
    const decisions = this.getCriticalDecisions();
    
    // Calculate scores (0-100)
    const sciScore = Math.min(100, Math.round((this.metrics.sci || 50) * 1.2));
    const devScore = Math.min(100, Math.round((this.metrics.dev || 50) * 1.2));
    const mktScore = Math.min(100, Math.round((this.metrics.mkt || 50) * 1.2));
    const hrScore = Math.min(100, Math.round((this.metrics.hr || 50) * 1.2));
    
    let html = `
      <div class="space-y-6">
        <!-- Header -->
        <div class="text-center border-b pb-6">
          <div class="text-xs uppercase tracking-wider text-slate-400 mb-1">THE AI STARTUP GAME</div>
          <h1 class="text-3xl font-bold text-slate-800 mb-1">Your Entrepreneurial Journey</h1>
          <div class="text-2xl font-bold text-indigo-600">${this.company?.name || 'Your Startup'}</div>
          <div class="text-slate-500 text-sm mt-2">A management case study from your startup simulation</div>
          <div class="mt-3 inline-block px-4 py-2 rounded-full text-sm font-bold ${success ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'}">
            ${success ? 'SUCCESS' : 'JOURNEY ENDED'} Â· ${this.completedMilestones.length}/3 milestones Â· ${this.turn} quarters Â· Â£${this.metrics.val}k valuation
          </div>
        </div>
        
        <!-- Leadership Style -->
        <div class="bg-gradient-to-r from-slate-50 to-indigo-50 rounded-xl p-5">
          <h2 class="text-xl font-bold text-slate-800 mb-1">${archetype.title}</h2>
          <div class="text-xs uppercase tracking-wider text-slate-400 mb-3">Leadership Style</div>
          
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm mb-4">
            <div><span class="text-slate-500">Valuation:</span> <span class="font-bold">Â£${this.metrics.val}k</span></div>
            <div><span class="text-slate-500">Equity:</span> <span class="font-bold">${this.metrics.equity.toFixed(1)}%</span></div>
            <div><span class="text-slate-500">Team:</span> <span class="font-bold">${this.metrics.staff} people</span></div>
            <div><span class="text-slate-500">Cash:</span> <span class="font-bold">Â£${this.metrics.cash}k</span></div>
          </div>
          
          <p class="text-slate-600 text-sm mb-4">${archetype.description}</p>
          
          <!-- Score Bars -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <div>
              <div class="flex justify-between text-xs mb-1"><span class="text-slate-500">Science</span><span class="font-bold">${sciScore}</span></div>
              <div class="h-2 bg-slate-200 rounded-full overflow-hidden"><div class="h-full bg-emerald-500 rounded-full" style="width: ${sciScore}%"></div></div>
            </div>
            <div>
              <div class="flex justify-between text-xs mb-1"><span class="text-slate-500">Product</span><span class="font-bold">${devScore}</span></div>
              <div class="h-2 bg-slate-200 rounded-full overflow-hidden"><div class="h-full bg-sky-500 rounded-full" style="width: ${devScore}%"></div></div>
            </div>
            <div>
              <div class="flex justify-between text-xs mb-1"><span class="text-slate-500">Sales</span><span class="font-bold">${mktScore}</span></div>
              <div class="h-2 bg-slate-200 rounded-full overflow-hidden"><div class="h-full bg-fuchsia-500 rounded-full" style="width: ${mktScore}%"></div></div>
            </div>
            <div>
              <div class="flex justify-between text-xs mb-1"><span class="text-slate-500">Culture</span><span class="font-bold">${hrScore}</span></div>
              <div class="h-2 bg-slate-200 rounded-full overflow-hidden"><div class="h-full bg-amber-500 rounded-full" style="width: ${hrScore}%"></div></div>
            </div>
          </div>
        </div>
        
        <!-- The Story -->
        <div>
          <h3 class="text-lg font-bold text-slate-800 mb-2">The Story</h3>
          <p class="text-slate-600 text-sm leading-relaxed">${this.generateStorySection()}</p>
        </div>
        
        <!-- Strategic Approach -->
        <div>
          <h3 class="text-lg font-bold text-slate-800 mb-2">Strategic Approach</h3>
          <p class="text-slate-600 text-sm leading-relaxed">${this.generateStrategicApproach()}</p>
        </div>
        
        <!-- The Journey -->
        <div>
          <h3 class="text-lg font-bold text-slate-800 mb-2">The Journey</h3>
          <p class="text-slate-600 text-sm leading-relaxed">${this.generateJourneySection()}</p>
        </div>
        
        <!-- Defining Moments -->
        ${moments.length > 0 ? `
        <div>
          <h3 class="text-lg font-bold text-slate-800 mb-3">Defining Moments</h3>
          <div class="space-y-3">
            ${moments.map(m => `
              <div class="flex gap-3 text-sm">
                <div class="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${m.type === 'milestone' ? 'bg-emerald-100 text-emerald-600' : m.type === 'funding' ? 'bg-sky-100 text-sky-600' : m.type === 'crisis' ? 'bg-red-100 text-red-600' : 'bg-amber-100 text-amber-600'}">
                  Q${m.quarter}
                </div>
                <div>
                  <div class="font-medium text-slate-800">${m.title}</div>
                  <div class="text-slate-500 text-xs">${m.description}</div>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
        ` : ''}
        
        <!-- Critical Decisions -->
        ${decisions.length > 0 ? `
        <div>
          <h3 class="text-lg font-bold text-slate-800 mb-3">Critical Decisions</h3>
          <div class="space-y-3">
            ${decisions.map(d => `
              <div class="bg-slate-50 rounded-lg p-3">
                <div class="flex items-center gap-2 mb-1">
                  <span class="text-xs font-bold text-slate-400">Q${d.quarter}</span>
                  <span class="text-xs font-bold text-indigo-600">${d.domain}</span>
                </div>
                <div class="text-xs text-slate-500 mb-1">${d.situation}</div>
                <div class="text-sm font-medium text-slate-800">â†’ "${d.choice}"</div>
              </div>
            `).join('')}
          </div>
        </div>
        ` : ''}
        
        <!-- What Worked / What Didn't -->
        <div class="grid md:grid-cols-2 gap-4">
          <div class="bg-emerald-50 rounded-lg p-4">
            <h4 class="font-bold text-emerald-800 mb-2">What Worked</h4>
            <ul class="text-sm text-emerald-700 space-y-1">
              ${whatWorked.worked.map(w => `<li>â€¢ ${w}</li>`).join('')}
            </ul>
          </div>
          <div class="bg-amber-50 rounded-lg p-4">
            <h4 class="font-bold text-amber-800 mb-2">What Didn't</h4>
            <ul class="text-sm text-amber-700 space-y-1">
              ${whatWorked.didnt.map(w => `<li>â€¢ ${w}</li>`).join('')}
            </ul>
          </div>
        </div>
        
        <!-- The Outcome -->
        <div>
          <h3 class="text-lg font-bold text-slate-800 mb-2">The Outcome</h3>
          <p class="text-slate-600 text-sm leading-relaxed">${this.generateOutcomeSection()}</p>
        </div>
        
        <!-- Lessons -->
        <div>
          <h3 class="text-lg font-bold text-slate-800 mb-2">Lessons & Reflections</h3>
          <p class="text-slate-600 text-sm leading-relaxed">${this.generateLessonsSection()}</p>
        </div>
        
        <!-- Footer -->
        <div class="border-t pt-4 text-center text-xs text-slate-400">
          <p class="font-medium">The AI Startup Game</p>
          <p>Created by Ammon Salter with Stefano Baruffaldi & Federico Bignone</p>
          <p>Part of the ESRC-funded project "Profiting from Science" [ES/X003949/1]</p>
          <p>Â© 2025 Â· Licensed under CC BY-NC-SA 4.0</p>
        </div>
        
        <!-- Actions -->
        <div class="flex justify-center gap-4 pt-2">
          <button onclick="game.downloadJourneyPDF()" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2">
            <span>ğŸ“„</span> Download PDF
          </button>
          <button onclick="document.getElementById('journeyModal').classList.add('hidden')" class="px-6 py-3 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg font-medium transition-colors">
            Close
          </button>
        </div>
      </div>
    `;
    
    content.innerHTML = html;
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }
  
  // Download journey as PDF - Professional format matching case study template
  downloadJourneyPDF() {
    try {
      const { jsPDF } = window.jspdf;
      if (!jsPDF) {
        alert('PDF library not loaded. Please refresh the page and try again.');
        return;
      }
      const doc = new jsPDF({ format: 'a4', unit: 'mm' });
    
    const pageWidth = 210;
    const pageHeight = 297;
    const margin = 20;
    const contentWidth = pageWidth - 2 * margin;
    let y = margin;
    let pageNum = 1;
    
    const companyName = this.company?.name || 'Your Startup';
    const companyId = this.company?.id || 'aether';
    const archetype = this.getLeadershipArchetype();
    const success = this.completedMilestones.length >= 3;
    const failure = this.metrics.cash <= 0;
    const whatWorked = this.generateWhatWorkedDidnt();
    const moments = this.getDefiningMoments();
    const decisions = this.getCriticalDecisions();
    
    // Score calculations
    const sciScore = Math.min(99, Math.max(10, Math.round((this.metrics.sci || 50) * 1.2)));
    const devScore = Math.min(99, Math.max(10, Math.round((this.metrics.dev || 50) * 1.2)));
    const mktScore = Math.min(99, Math.max(10, Math.round((this.metrics.mkt || 50) * 1.2)));
    const hrScore = Math.min(99, Math.max(10, Math.round((this.metrics.hr || 50) * 1.2)));
    
    // Helper: Add page header (for pages 2+)
    const addPageHeader = () => {
      doc.setFontSize(9);
      doc.setTextColor(120);
      doc.text(`The AI Startup Game - ${companyName}`, margin, 12);
      doc.text(`Page ${pageNum}`, pageWidth - margin, 12, { align: 'right' });
      doc.setDrawColor(220);
      doc.line(margin, 15, pageWidth - margin, 15);
    };
    
    // Helper: Check page break and add header
    const checkPageBreak = (neededSpace = 30) => {
      if (y > pageHeight - neededSpace) {
        doc.addPage();
        pageNum++;
        addPageHeader();
        y = 25;
        return true;
      }
      return false;
    };
    
    // Helper: Add wrapped text with proper page breaks
    const addWrappedText = (text, x, startY, maxWidth, lineHeight = 5) => {
      const lines = doc.splitTextToSize(text, maxWidth);
      let currentY = startY;
      lines.forEach((line) => {
        if (currentY > pageHeight - 20) {
          doc.addPage();
          pageNum++;
          addPageHeader();
          currentY = 25;
        }
        doc.text(line, x, currentY);
        currentY += lineHeight;
      });
      return currentY;
    };
    
    // Helper: Draw score bar in "78 Science" format like the example
    const drawScoreBar = (x, y, score, label, color) => {
      const barWidth = 30;
      const barHeight = 4;
      
      // Score number first
      doc.setFontSize(11);
      doc.setFont(undefined, 'bold');
      doc.setTextColor(60);
      doc.text(String(score), x, y);
      
      // Label after score
      doc.setFontSize(10);
      doc.setFont(undefined, 'normal');
      doc.setTextColor(100);
      doc.text(label, x + 12, y);
      
      // Bar below
      const barYPos = y + 3;
      doc.setFillColor(230, 230, 230);
      doc.roundedRect(x, barYPos, barWidth, barHeight, 1.5, 1.5, 'F');
      doc.setFillColor(...color);
      doc.roundedRect(x, barYPos, barWidth * (score / 100), barHeight, 1.5, 1.5, 'F');
    };
    
    // ===== PAGE 1: Title Page =====
    
    // Small header
    doc.setFontSize(11);
    doc.setTextColor(100);
    doc.text('THE AI STARTUP GAME', pageWidth / 2, y, { align: 'center' });
    y += 12;
    
    // Main title
    doc.setFontSize(32);
    doc.setTextColor(30);
    doc.text('Your Entrepreneurial Journey', pageWidth / 2, y, { align: 'center' });
    y += 14;
    
    // Company name
    doc.setFontSize(24);
    doc.setTextColor(79, 70, 229);
    doc.text(companyName, pageWidth / 2, y, { align: 'center' });
    y += 10;
    
    // Subtitle
    doc.setFontSize(11);
    doc.setTextColor(100);
    doc.text('A management case study from your startup simulation', pageWidth / 2, y, { align: 'center' });
    y += 12;
    
    // Status badge
    doc.setFontSize(11);
    doc.setFont(undefined, 'bold');
    if (success) {
      doc.setTextColor(22, 163, 74);
      doc.text(`SUCCESS`, pageWidth / 2, y, { align: 'center' });
    } else if (failure) {
      doc.setTextColor(220, 38, 38);
      doc.text(`GAME OVER`, pageWidth / 2, y, { align: 'center' });
    } else {
      doc.setTextColor(161, 98, 7);
      doc.text(`JOURNEY ENDED`, pageWidth / 2, y, { align: 'center' });
    }
    y += 6;
    doc.setFont(undefined, 'normal');
    doc.setTextColor(100);
    doc.text(`${this.completedMilestones.length}/3 milestones â€¢ ${this.turn} quarters â€¢ Â£${this.metrics.val.toLocaleString()}k valuation`, pageWidth / 2, y, { align: 'center' });
    y += 18;
    
    // ===== Leadership Style Box =====
    const boxTop = y;
    const boxHeight = 52;
    doc.setFillColor(248, 250, 252);
    doc.setDrawColor(226, 232, 240);
    doc.roundedRect(margin, boxTop, contentWidth, boxHeight, 3, 3, 'FD');
    
    y = boxTop + 10;
    
    // Archetype title
    doc.setFontSize(18);
    doc.setFont(undefined, 'bold');
    doc.setTextColor(30);
    doc.text(archetype.title, margin + 8, y);
    y += 5;
    
    // Label
    doc.setFontSize(8);
    doc.setFont(undefined, 'normal');
    doc.setTextColor(150);
    doc.text('LEADERSHIP STYLE', margin + 8, y);
    y += 8;
    
    // Final Position section
    doc.setFontSize(8);
    doc.setTextColor(100);
    doc.text('FINAL POSITION', margin + 8, y);
    y += 5;
    
    doc.setFontSize(10);
    doc.setTextColor(30);
    doc.text(`Valuation: Â£${this.metrics.val.toLocaleString()}k`, margin + 8, y);
    doc.text(`Equity retained: ${this.metrics.equity.toFixed(1)}%`, margin + 70, y);
    y += 5;
    doc.text(`Team size: ${this.metrics.staff} people`, margin + 8, y);
    doc.text(`Cash remaining: Â£${this.metrics.cash}k`, margin + 70, y);
    y += 5;
    
    // === REVENUE METRICS ===
    const revenueNarrative = this.generateRevenueNarrative();
    if (revenueNarrative && this.customers.length > 0) {
      doc.text(`ARR: Â£${revenueNarrative.keyMetrics.finalARR.toLocaleString()}k`, margin + 8, y);
      doc.text(`Customers: ${revenueNarrative.keyMetrics.totalCustomers}`, margin + 70, y);
      y += 5;
      if (revenueNarrative.keyMetrics.avgCustomerRevenue > 0) {
        doc.text(`Avg customer value: Â£${revenueNarrative.keyMetrics.avgCustomerRevenue.toLocaleString()}k ARR`, margin + 8, y);
        y += 5;
      }
    } else {
      doc.text(`Revenue: Pre-revenue`, margin + 8, y);
      y += 5;
    }
    y += 3;
    
    // Description
    doc.setFontSize(10);
    doc.setTextColor(60);
    const descLines = doc.splitTextToSize(archetype.description, contentWidth - 16);
    descLines.forEach(line => {
      doc.text(line, margin + 8, y);
      y += 4.5;
    });
    
    y = boxTop + boxHeight + 10;
    
    // Score bars row - format: "78 Science" with bar below
    const barY = y;
    drawScoreBar(margin, barY, sciScore, 'Science', [34, 197, 94]);
    drawScoreBar(margin + 42, barY, devScore, 'Product', [59, 130, 246]);
    drawScoreBar(margin + 84, barY, mktScore, 'Sales', [168, 85, 247]);
    drawScoreBar(margin + 126, barY, hrScore, 'Culture', [251, 146, 60]);
    
    y = barY + 18;
    
    // ===== The Story =====
    doc.setFontSize(14);
    doc.setFont(undefined, 'bold');
    doc.setTextColor(30);
    doc.text('The Story', margin, y);
    doc.setFont(undefined, 'normal');
    y += 7;
    
    doc.setFontSize(10);
    doc.setTextColor(60);
    y = addWrappedText(this.generateStorySection() || 'The startup journey began with a vision to transform the industry.', margin, y, contentWidth, 5);
    y += 8;
    
    // ===== Strategic Approach =====
    checkPageBreak(50);
    doc.setFontSize(14);
    doc.setFont(undefined, 'bold');
    doc.setTextColor(30);
    doc.text('Strategic Approach', margin, y);
    doc.setFont(undefined, 'normal');
    y += 7;
    
    doc.setFontSize(10);
    doc.setTextColor(60);
    y = addWrappedText(this.generateStrategicApproach() || 'The team developed a strategic approach balancing technical depth with market awareness.', margin, y, contentWidth, 5);
    y += 8;
    
    // ===== The Journey =====
    checkPageBreak(50);
    doc.setFontSize(14);
    doc.setFont(undefined, 'bold');
    doc.setTextColor(30);
    doc.text('The Journey', margin, y);
    doc.setFont(undefined, 'normal');
    y += 7;
    
    doc.setFontSize(10);
    doc.setTextColor(60);
    y = addWrappedText(this.generateJourneySection() || 'The company navigated challenges and milestones on the path to building something meaningful.', margin, y, contentWidth, 5);
    y += 8;
    
    // ===== Defining Moments =====
    if (moments.length > 0) {
      checkPageBreak(60);
      doc.setFontSize(14);
      doc.setFont(undefined, 'bold');
      doc.setTextColor(30);
      doc.text('Defining Moments', margin, y);
      doc.setFont(undefined, 'normal');
      y += 10;
      
      moments.forEach(m => {
        checkPageBreak(25);
        // Quarter badge
        doc.setFontSize(11);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(79, 70, 229);
        doc.text(`Q${m.quarter || '?'}`, margin, y);
        
        // Title
        doc.setTextColor(30);
        doc.text(m.title || 'Milestone', margin + 12, y);
        doc.setFont(undefined, 'normal');
        y += 5;
        
        // Description - full text, no truncation
        doc.setFontSize(9);
        doc.setTextColor(100);
        const descText = m.description || 'A significant moment in the company journey.';
        const momentLines = doc.splitTextToSize(descText, contentWidth - 12);
        momentLines.forEach(line => {
          if (y > pageHeight - 20) {
            doc.addPage();
            pageNum++;
            addPageHeader();
            y = 25;
          }
          doc.text(line, margin + 12, y);
          y += 4;
        });
        y += 5;
      });
      y += 4;
    }
    
    // ===== Revenue Story =====
    const revenueNarr = this.generateRevenueNarrative();
    if (revenueNarr && revenueNarr.insights.length > 0) {
      checkPageBreak(50);
      doc.setFontSize(14);
      doc.setFont(undefined, 'bold');
      doc.setTextColor(30);
      doc.text('Revenue & Commercialization', margin, y);
      doc.setFont(undefined, 'normal');
      y += 7;
      
      doc.setFontSize(10);
      doc.setTextColor(60);
      
      // Revenue model context
      const modelContext = `The company pursued a ${revenueNarr.modelName} revenue model.`;
      y = addWrappedText(modelContext, margin, y, contentWidth, 5);
      y += 3;
      
      // Revenue insights
      revenueNarr.insights.forEach(insight => {
        if (y > pageHeight - 20) {
          doc.addPage();
          pageNum++;
          addPageHeader();
          y = 25;
        }
        const insightLines = doc.splitTextToSize(`â€¢ ${insight}`, contentWidth);
        insightLines.forEach(line => {
          doc.text(line, margin, y);
          y += 4.5;
        });
      });
      
      // Key timeline events
      if (revenueNarr.timeline.length > 0) {
        y += 3;
        doc.setFontSize(9);
        doc.setTextColor(100);
        doc.text('Key commercial milestones:', margin, y);
        y += 5;
        
        revenueNarr.timeline.slice(0, 5).forEach(event => {
          if (y > pageHeight - 20) {
            doc.addPage();
            pageNum++;
            addPageHeader();
            y = 25;
          }
          doc.setTextColor(79, 70, 229);
          doc.text(`Q${event.quarter}:`, margin, y);
          doc.setTextColor(60);
          const descLines = doc.splitTextToSize(event.description, contentWidth - 15);
          descLines.forEach((line, i) => {
            doc.text(line, margin + 12, y);
            y += 4;
          });
        });
      }
      y += 8;
    }
    
    // ===== Critical Decisions =====
    if (decisions.length > 0) {
      checkPageBreak(60);
      doc.setFontSize(14);
      doc.setFont(undefined, 'bold');
      doc.setTextColor(30);
      doc.text('Critical Decisions', margin, y);
      doc.setFont(undefined, 'normal');
      y += 5;
      
      doc.setFontSize(9);
      doc.setTextColor(100);
      doc.text('The choices that shaped the company\'s trajectory:', margin, y);
      y += 10;
      
      decisions.forEach(d => {
        checkPageBreak(30);
        
        // Quarter and domain
        doc.setFontSize(11);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(79, 70, 229);
        doc.text(`Quarter ${d.quarter || '?'}`, margin, y);
        doc.setTextColor(100);
        doc.text(d.domain || 'Decision', margin + 25, y);
        doc.setFont(undefined, 'normal');
        y += 6;
        
        // Situation - full text
        doc.setFontSize(9);
        doc.setTextColor(80);
        const sitText = d.situation || 'A strategic decision point.';
        const sitLines = doc.splitTextToSize(sitText, contentWidth);
        sitLines.forEach(line => {
          if (y > pageHeight - 25) {
            doc.addPage();
            pageNum++;
            addPageHeader();
            y = 25;
          }
          doc.text(line, margin, y);
          y += 4;
        });
        y += 1;
        
        // Choice
        doc.setTextColor(30);
        const choiceText = d.choice || 'Made a decision';
        doc.text(`â†’ "${choiceText}"`, margin, y);
        y += 10;
      });
      y += 4;
    }
    
    // ===== What Worked / What Didn't =====
    checkPageBreak(60);
    
    const colWidth = (contentWidth - 10) / 2;
    
    // Headers
    doc.setFontSize(12);
    doc.setFont(undefined, 'bold');
    doc.setTextColor(22, 163, 74);
    doc.text('What Worked', margin, y);
    doc.setTextColor(180, 83, 9);
    doc.text("What Didn't", margin + colWidth + 10, y);
    doc.setFont(undefined, 'normal');
    y += 8;
    
    // Items
    doc.setFontSize(9);
    const startY = y;
    let leftY = y;
    let rightY = y;
    
    // Left column (What Worked)
    doc.setTextColor(22, 163, 74);
    (whatWorked.worked || []).forEach(item => {
      const lines = doc.splitTextToSize(`â€¢ ${item || 'Good decision'}`, colWidth);
      lines.forEach(line => {
        if (leftY > pageHeight - 20) {
          // Would need page break - simplified handling
        }
        doc.text(line, margin, leftY);
        leftY += 4;
      });
      leftY += 2;
    });
    
    // Right column (What Didn't)
    doc.setTextColor(180, 83, 9);
    (whatWorked.didnt || []).forEach(item => {
      const lines = doc.splitTextToSize(`â€¢ ${item || 'Room for improvement'}`, colWidth);
      lines.forEach(line => {
        doc.text(line, margin + colWidth + 10, rightY);
        rightY += 4;
      });
      rightY += 2;
    });
    
    y = Math.max(leftY, rightY) + 8;
    
    // ===== The Outcome =====
    checkPageBreak(50);
    doc.setFontSize(14);
    doc.setFont(undefined, 'bold');
    doc.setTextColor(30);
    doc.text('The Outcome', margin, y);
    doc.setFont(undefined, 'normal');
    y += 7;
    
    doc.setFontSize(10);
    doc.setTextColor(60);
    y = addWrappedText(this.generateOutcomeSection() || 'The journey reached a conclusion with lessons learned and foundations laid.', margin, y, contentWidth, 5);
    y += 8;
    
    // ===== Lessons & Reflections =====
    checkPageBreak(50);
    doc.setFontSize(14);
    doc.setFont(undefined, 'bold');
    doc.setTextColor(30);
    doc.text('Lessons & Reflections', margin, y);
    doc.setFont(undefined, 'normal');
    y += 7;
    
    doc.setFontSize(10);
    doc.setTextColor(60);
    y = addWrappedText(this.generateLessonsSection() || 'Every startup journey offers lessons that inform future ventures.', margin, y, contentWidth, 5);
    y += 15;
    
    // ===== Footer =====
    checkPageBreak(40);
    
    doc.setDrawColor(200);
    doc.line(margin, y, pageWidth - margin, y);
    y += 10;
    
    doc.setFontSize(11);
    doc.setFont(undefined, 'bold');
    doc.setTextColor(30);
    doc.text('The AI Startup Game', pageWidth / 2, y, { align: 'center' });
    doc.setFont(undefined, 'normal');
    y += 6;
    
    doc.setFontSize(9);
    doc.setTextColor(100);
    doc.text('Created by Ammon Salter with Stefano Baruffaldi & Federico Bignone', pageWidth / 2, y, { align: 'center' });
    y += 5;
    doc.text('Part of the ESRC-funded project "Profiting from Science" [ES/X003949/1]', pageWidth / 2, y, { align: 'center' });
    y += 5;
    doc.text('Â© 2025 Salter, Baruffaldi & Bignone', pageWidth / 2, y, { align: 'center' });
    y += 5;
    doc.text('Licensed under CC BY-NC-SA 4.0', pageWidth / 2, y, { align: 'center' });
    y += 8;
    
    doc.setTextColor(150);
    const dateStr = new Date().toLocaleDateString('en-GB', { day: '2-digit', month: 'long', year: 'numeric' });
    doc.text(`Generated ${dateStr}`, pageWidth / 2, y, { align: 'center' });
    
    // Save the PDF
    const filename = success ? `Journey_${companyName.replace(/[^a-z0-9]/gi, '_')}_Success.pdf` : `Journey_${companyName.replace(/[^a-z0-9]/gi, '_')}.pdf`;
    doc.save(filename);
    
    } catch (error) {
      console.error('PDF generation error:', error);
      alert('Error generating PDF: ' + error.message + '\n\nPlease try again or check the browser console for details.');
    }
  }
  
  // ===== STRATEGIC PIVOT SYSTEM =====
  
  showStrategicPivotModal() {
    this.pivotState.mode = 'strategic';
    this.pivotState.selectedPivotType = null;
    this.pivotState.triggeringRival = null;
    
    // Play contemplative strategic review sound
    soundManager.playStrategicReview();
    
    // Find leading rival for context
    const leadingRival = this.rivals?.find(r => r.milestoneProgress > (this.milestoneProgress || 0));
    const progress = this.milestoneProgress || 0;
    
    const contextEl = document.getElementById("strategicPivotContext");
    if (leadingRival) {
      // Check if rival has completed milestones
      const rivalMilestones = leadingRival.milestonesCompleted || 0;
      const rivalStatus = rivalMilestones > 0 
        ? `They've completed ${rivalMilestones} milestone${rivalMilestones > 1 ? 's' : ''} while you're at ${progress}%.`
        : `They're at ${leadingRival.milestoneProgress}% while you're at ${progress}%.`;
      
      contextEl.innerHTML = `
        <span class="text-2xl">âš ï¸</span>
        <div class="text-sm flex-1">
          <strong class="text-red-700">${leadingRival.name} is pulling ahead.</strong>
          <span class="text-red-600">${rivalStatus}</span>
          <button onclick="game.showPivotCurrentMilestone()" class="text-red-700 underline ml-1">View your progress â†’</button>
        </div>
      `;
    } else {
      contextEl.innerHTML = `
        <span class="text-2xl">âš ï¸</span>
        <div class="text-sm flex-1">
          <strong class="text-red-700">Competition is intensifying.</strong>
          <span class="text-red-600">You're at ${progress}% on your current milestone.</span>
          <button onclick="game.showPivotCurrentMilestone()" class="text-red-700 underline ml-1">View your progress â†’</button>
        </div>
      `;
    }
    
    const content = document.getElementById("strategicPivotContent");
    content.innerHTML = this.renderPivotCards(STRATEGIC_PIVOTS, 'strategic');
    
    document.getElementById("strategicPivotModal").classList.remove("hidden");
    document.getElementById("strategicPivotModal").classList.add("flex");
  }
  
  closeStrategicPivotModal() {
    document.getElementById("strategicPivotModal").classList.add("hidden");
    document.getElementById("strategicPivotModal").classList.remove("flex");
    this.resetPivotState();
  }
  
  resetPivotState() {
    this.pivotState = { mode: null, selectedPivotType: null, selectedMilestone: null, selectedNameOption: null, triggeringRival: null, currentPivotData: null, currentMilestoneData: null };
  }
  
  showMarketShiftModal(rival) {
    this.pivotState.mode = 'forced';
    this.pivotState.selectedPivotType = null;
    this.pivotState.triggeringRival = rival;
    
    // Play urgent market shift alert
    soundManager.playMarketShift();
    
    const progress = this.milestoneProgress || 0;
    const milestoneName = this.milestone?.name || 'Enterprise AI Platform';
    
    const contextEl = document.getElementById("marketShiftContext");
    contextEl.innerHTML = `
      <span class="text-3xl">ğŸ“°</span>
      <div class="flex-1">
        <div class="font-bold text-slate-800 text-lg">${rival.name} Achieves Market Milestone</div>
        <p class="text-slate-600 mt-1">"${rival.name} has launched their ${milestoneName}, establishing market leadership."</p>
        <div class="mt-2 flex gap-3">
          <button onclick="game.showCompetitorDetailModal('${rival.id || ''}')" class="text-sm text-red-600 underline">View ${rival.name} â†’</button>
          <button onclick="game.showPivotCurrentMilestone()" class="text-sm text-red-600 underline">View your progress â†’</button>
        </div>
      </div>
    `;
    
    const content = document.getElementById("marketShiftContent");
    content.innerHTML = this.renderPivotCards(FORCED_RESPONSES, 'forced');
    
    document.getElementById("marketShiftModal").classList.remove("hidden");
    document.getElementById("marketShiftModal").classList.add("flex");
  }
  
  closeMarketShiftModal() {
    document.getElementById("marketShiftModal").classList.add("hidden");
    document.getElementById("marketShiftModal").classList.remove("flex");
  }
  
  // ===== TEST/DEBUG FUNCTIONS =====
  // Call these from browser console: game.testStrategicPivot() or game.testMarketShift()
  
  testStrategicPivot() {
    // Test the voluntary strategic pivot modal
    console.log("Testing Strategic Pivot Modal...");
    this.showStrategicPivotModal();
  }
  
  testMarketShift() {
    // Test the forced market shift modal (when rival gets ahead)
    console.log("Testing Market Shift Modal...");
    const testRival = this.rivals?.[0] || {
      name: "Test Rival Corp",
      focus: "Product",
      milestones: [{ name: "First Prototype", status: "complete" }]
    };
    this.showMarketShiftModal(testRival);
  }
  
  renderPivotCards(options, mode) {
    const colorClasses = { 
      violet: ['bg-violet-50', 'border-violet-300', 'text-violet-700', 'bg-violet-600', 'ring-violet-400'], 
      amber: ['bg-amber-50', 'border-amber-300', 'text-amber-700', 'bg-amber-600', 'ring-amber-400'], 
      rose: ['bg-rose-50', 'border-rose-300', 'text-rose-700', 'bg-rose-600', 'ring-rose-400'],
      emerald: ['bg-emerald-50', 'border-emerald-300', 'text-emerald-700', 'bg-emerald-600', 'ring-emerald-400']
    };
    
    return options.map(opt => {
      const c = colorClasses[opt.color] || colorClasses.violet;
      const isSelected = this.pivotState.selectedPivotType === opt.id;
      const ringClass = isSelected ? `ring-2 ${c[4]}` : '';
      const hasInfo = opt.id !== 'compete'; // All options except compete have detailed info
      
      // Create team support dots (matching demo exactly)
      const supportDots = [1,2,3,4].map(i => 
        `<div class="w-2 h-2 rounded-full ${i <= opt.teamSupport ? c[3] : 'bg-slate-200'}"></div>`
      ).join('');
      
      return `
        <div onclick="game.selectPivotType('${opt.id}', '${mode}')" 
             class="choice-card ${c[0]} border-2 ${c[1]} rounded-xl p-4 cursor-pointer hover:shadow-lg ${ringClass}" style="transition: all 0.2s ease;">
          <div class="flex items-start gap-4">
            <div class="text-3xl">${opt.icon}</div>
            <div class="flex-1">
              <div class="flex items-center justify-between mb-1">
                <div>
                  <h3 class="font-bold text-slate-800 text-lg">${opt.name}</h3>
                  <p class="text-sm ${c[2]}">${opt.subtitle}</p>
                </div>
                <div class="text-right">
                  <div class="text-xs text-slate-500">Team support</div>
                  <div class="flex gap-0.5">${supportDots}</div>
                </div>
              </div>
              <p class="text-sm text-slate-600 mb-3">${opt.description}</p>
              <div class="grid grid-cols-2 gap-3 text-xs">
                <div>
                  <div class="font-medium text-emerald-700 mb-1">âœ“ Preserves</div>
                  <ul class="text-slate-600 space-y-0.5">${opt.preserves.map(p => `<li>â€¢ ${p}</li>`).join('')}</ul>
                </div>
                <div>
                  <div class="font-medium text-red-700 mb-1">âœ— Costs</div>
                  <ul class="text-slate-600 space-y-0.5">${opt.costs.map(c => `<li>â€¢ ${c}</li>`).join('')}</ul>
                </div>
              </div>
              <div class="mt-3 pt-3 border-t border-slate-200 flex items-center justify-between">
                <div class="text-xs text-slate-500"><strong>Time:</strong> ${opt.timeImpact}</div>
                <div class="flex items-center gap-2">
                  <span class="text-xs ${c[2]} font-medium">Best when: ${opt.bestWhen}</span>
                  ${hasInfo ? `<button onclick="event.stopPropagation(); game.showPivotInfo('${opt.id}', '${mode}')" class="px-2 py-1 text-xs bg-white border border-slate-300 rounded hover:bg-slate-50 text-slate-600">Get more information</button>` : ''}
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }).join('');
  }
  
  selectPivotType(pivotId, mode) {
    this.pivotState.selectedPivotType = pivotId;
    const options = mode === 'strategic' ? STRATEGIC_PIVOTS : FORCED_RESPONSES;
    this.pivotState.currentPivotData = options.find(o => o.id === pivotId);
    
    // Play selection sound
    soundManager.playPivotSelect();
    
    if (pivotId === 'compete') {
      this.handleCompeteHeadOn();
      return;
    }
    
    setTimeout(() => this.showPivotMilestoneModal(this.pivotState.currentPivotData, mode), 200);
  }
  
  getStakeholderRecommendations(mode) {
    // Play stakeholder gathering sound
    soundManager.playStakeholderGather();
    
    // Like the demo, this picks a recommended pivot and goes directly to milestone selection
    let pivot;
    if (mode === 'forced') {
      // In forced mode, recommend based on progress
      const progress = this.milestoneProgress || 0;
      if (progress > 70) {
        pivot = FORCED_RESPONSES.find(p => p.id === 'compete');
      } else if (progress > 40) {
        pivot = FORCED_RESPONSES.find(p => p.id === 'niche');
      } else {
        pivot = FORCED_RESPONSES.find(p => p.id === 'pivot');
      }
      this.log(`ğŸ’¡ Recommending: ${pivot.name}`);
    } else {
      // In strategic mode, recommend customer pivot (most common good choice)
      pivot = STRATEGIC_PIVOTS.find(p => p.id === 'customer');
      this.log(`ğŸ’¡ Recommending: ${pivot.name}`);
    }
    
    this.pivotState.selectedPivotType = pivot.id;
    this.pivotState.currentPivotData = pivot;
    
    // Handle compete head-on specially
    if (pivot.id === 'compete') {
      this.handleCompeteHeadOn();
      return;
    }
    
    // Go directly to milestone selection like the demo
    this.showPivotMilestoneModal(pivot, mode);
  }
  
  showPivotInfo(pivotId, mode, customContent = null) {
    const modal = document.getElementById("pivotInfoModal");
    const title = document.getElementById("pivotInfoTitle");
    const content = document.getElementById("pivotInfoContent");
    
    if (customContent) {
      title.textContent = "ğŸ’¡ Stakeholder Recommendation";
      content.innerHTML = customContent;
    } else {
      const options = mode === 'strategic' ? STRATEGIC_PIVOTS : FORCED_RESPONSES;
      const pivot = options.find(o => o.id === pivotId);
      if (!pivot) return;
      
      // Get current milestone info from game state
      const currMilestone = this.milestone || { name: 'Current Milestone', desc: 'Your current strategic goal' };
      const currProgress = this.milestoneProgress || 0;
      const invested = `Â£${Math.round((100 - (this.metrics?.equity || 85)) * 5)}k spent, ${(this.turn || 1) - 1} quarters elapsed`;
      
      // Current domain progress (from metrics)
      const currResearch = this.metrics?.sci || 30;
      const currProduct = this.metrics?.dev || 30;
      const currSales = this.metrics?.mkt || 20;
      
      // Get milestones for this pivot type
      const milestones = this.getPivotMilestones(pivot.id);
      const fitColors = { 
        high: 'bg-emerald-100 text-emerald-700 border-emerald-200', 
        medium: 'bg-amber-100 text-amber-700 border-amber-200',
        low: 'bg-slate-100 text-slate-600 border-slate-200'
      };
      
      // Build milestone cards
      const milestonesHtml = milestones.map(m => {
        const fit = m.startingProgress >= 40 ? 'high' : m.startingProgress >= 25 ? 'medium' : 'low';
        const fitLabel = fit === 'high' ? 'â­ Best fit' : 'Good fit';
        
        // Calculate transfer percentages (based on pivot type)
        const transferPcts = pivot.id === 'customer' ? { research: 80, product: 70, sales: 30 } :
                            pivot.id === 'problem' ? { research: 50, product: 60, sales: 40 } :
                            pivot.id === 'tech' ? { research: 40, product: 30, sales: 50 } :
                            pivot.id === 'niche' ? { research: 90, product: 85, sales: 55 } :
                            pivot.id === 'pivot' ? { research: 80, product: 65, sales: 25 } :
                            { research: 30, product: 30, sales: 30 };
        
        const researchTransfer = Math.round(currResearch * transferPcts.research / 100);
        const productTransfer = Math.round(currProduct * transferPcts.product / 100);
        const salesTransfer = Math.round(currSales * transferPcts.sales / 100);
        
        return `
          <div class="bg-white rounded-lg p-3 border ${fit === 'high' ? 'border-emerald-300' : 'border-slate-200'}">
            <div class="flex items-start justify-between mb-2">
              <div>
                <div class="flex items-center gap-2">
                  <span class="font-bold text-slate-800">${m.name}</span>
                  <span class="text-xs px-2 py-0.5 rounded border ${fitColors[fit]}">${fitLabel}</span>
                </div>
                <p class="text-xs text-slate-600 mt-1">${m.desc}</p>
              </div>
              <div class="text-right text-xs">
                <div class="text-emerald-600 font-bold">Â£${m.reward?.cash || 300}k</div>
                <div class="text-slate-500">${m.time}q â€¢ ${m.difficulty}</div>
              </div>
            </div>
            <div class="bg-slate-50 rounded p-2 text-xs">
              <div class="flex items-center justify-between mb-1">
                <span class="text-slate-500">Progress transfer:</span>
                <span class="font-medium text-emerald-600">Start at ${m.startingProgress}%</span>
              </div>
              <div class="grid grid-cols-3 gap-2 text-slate-600">
                <div>Research: ${currResearch} â†’ <span class="text-emerald-600">${researchTransfer}</span> <span class="text-slate-400">(${transferPcts.research}%)</span></div>
                <div>Product: ${currProduct} â†’ <span class="text-emerald-600">${productTransfer}</span> <span class="text-slate-400">(${transferPcts.product}%)</span></div>
                <div>Sales: ${currSales} â†’ <span class="text-emerald-600">${salesTransfer}</span> <span class="text-slate-400">(${transferPcts.sales}%)</span></div>
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      title.textContent = `ğŸ“Š ${pivot.name} - Details`;
      content.innerHTML = `
        <!-- Pivot Overview -->
        <div class="bg-slate-50 rounded-lg p-4 mb-4 border border-slate-200">
          <div class="flex items-start gap-3">
            <span class="text-3xl">${pivot.icon}</span>
            <div>
              <h3 class="font-bold text-slate-800 text-lg">${pivot.name}</h3>
              <p class="text-sm text-slate-600">${pivot.description}</p>
            </div>
          </div>
        </div>
        
        <!-- Current Milestone Summary -->
        <div class="bg-red-50 rounded-lg p-3 mb-4 border border-red-200">
          <div class="text-xs font-bold text-red-600 mb-2">ğŸ“ YOUR CURRENT POSITION</div>
          <div class="flex items-center justify-between">
            <div>
              <div class="font-medium text-slate-800">${currMilestone.name}</div>
              <div class="text-sm text-slate-600">${currProgress}% complete â€¢ ${invested}</div>
            </div>
            <div class="text-right">
              <div class="text-xs text-slate-500">Progress by domain:</div>
              <div class="text-xs text-slate-600">Research ${currResearch} â€¢ Product ${currProduct} â€¢ Sales ${currSales}</div>
            </div>
          </div>
        </div>
        
        <!-- Available Milestones Preview -->
        <div class="mb-4">
          <div class="text-sm font-bold text-slate-700 mb-3">ğŸ¯ MILESTONE OPTIONS IF YOU CHOOSE THIS PATH:</div>
          <div class="space-y-3">
            ${milestonesHtml}
          </div>
        </div>
        
        <!-- Summary -->
        <div class="grid grid-cols-2 gap-4">
          <div class="bg-red-50 rounded-lg p-3 border border-red-200">
            <div class="text-xs font-bold text-red-600 mb-2">What You Give Up:</div>
            <ul class="text-xs text-slate-600 space-y-1">
              ${pivot.costs.map(c => `<li>â€¢ ${c}</li>`).join('')}
            </ul>
          </div>
          <div class="bg-emerald-50 rounded-lg p-3 border border-emerald-200">
            <div class="text-xs font-bold text-emerald-600 mb-2">What You Gain:</div>
            <ul class="text-xs text-slate-600 space-y-1">
              ${pivot.preserves.map(p => `<li>â€¢ ${p}</li>`).join('')}
              <li>â€¢ Clear strategic direction</li>
            </ul>
          </div>
        </div>
      `;
    }
    
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  }
  
  closePivotInfo() {
    document.getElementById("pivotInfoModal").classList.add("hidden");
    document.getElementById("pivotInfoModal").classList.remove("flex");
  }
  
  // ===== PIVOT CONTEXT DETAIL MODALS =====
  showPivotTeamDetail() {
    const mode = this.pivotState.mode || 'strategic';
    const colorClasses = { 
      emerald: 'bg-emerald-50 border-emerald-200 hover:border-emerald-400', 
      sky: 'bg-sky-50 border-sky-200 hover:border-sky-400', 
      fuchsia: 'bg-fuchsia-50 border-fuchsia-200 hover:border-fuchsia-400', 
      amber: 'bg-amber-50 border-amber-200 hover:border-amber-400' 
    };
    
    const roles = ['research', 'product', 'sales', 'investor'];
    document.getElementById("pivotTeamContent").innerHTML = roles.map(role => {
      const member = PIVOT_TEAM[role];
      const viewText = mode === 'forced' ? member.forcedView : member.pivotView;
      return `
        <div onclick="game.showTeamMemberDetail('${role}')" 
             class="${colorClasses[member.color]} border rounded-xl p-4 mb-3 cursor-pointer transition-all hover:shadow-md">
          <div class="flex items-start gap-3">
            <div class="w-12 h-12 rounded-full bg-white border-2 border-slate-200 flex items-center justify-center text-2xl flex-shrink-0 shadow-sm">${member.emoji}</div>
            <div class="flex-1">
              <div class="flex items-center justify-between mb-1">
                <div><span class="font-bold text-slate-800">${member.name}</span> <span class="text-xs text-slate-500">${member.role}</span></div>
                <div class="flex items-center gap-2">
                  <span>${member.mood || 'ğŸ˜Š'}</span>
                </div>
              </div>
              <p class="text-sm text-slate-700 mb-2">"${viewText}"</p>
              <div class="flex items-center justify-between">
                <div class="text-xs text-slate-500">${member.moodText || ''}</div>
                <span class="text-xs text-indigo-600 hover:text-indigo-800">View full profile â†’</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }).join('');
    
    document.getElementById("pivotTeamModal").classList.remove("hidden");
    document.getElementById("pivotTeamModal").classList.add("flex");
  }
  
  closePivotTeamModal() {
    document.getElementById("pivotTeamModal").classList.add("hidden");
    document.getElementById("pivotTeamModal").classList.remove("flex");
  }
  
  showTeamMemberDetail(role) {
    const member = PIVOT_TEAM[role];
    if (!member) return;
    
    // Play team focus sound
    soundManager.playTeamFocus();
    
    const mode = this.pivotState.mode || 'strategic';
    const pivot = this.pivotState.currentPivotData;
    
    // Set header colors based on role
    const headerColors = {
      research: 'from-blue-600 to-indigo-600',
      product: 'from-green-600 to-teal-600',
      sales: 'from-fuchsia-600 to-pink-600',
      investor: 'from-amber-500 to-orange-500'
    };
    
    document.getElementById("teamMemberHeader").className = `sticky top-0 bg-gradient-to-r ${headerColors[role]} text-white p-4 rounded-t-2xl z-10`;
    document.getElementById("teamMemberEmoji").textContent = member.emoji;
    document.getElementById("teamMemberName").textContent = member.name;
    document.getElementById("teamMemberRole").textContent = member.role;
    
    // Get pivot-specific opinion
    let pivotOpinion = '';
    let supportStatus = '';
    if (pivot) {
      const pivotKey = pivot.id === 'customer' ? 'customerPivot' : 
                       pivot.id === 'problem' ? 'problemPivot' :
                       pivot.id === 'tech' ? 'techPivot' :
                       pivot.id === 'pivot' ? 'changeDirection' :
                       pivot.id === 'compete' ? 'competeHeadOn' :
                       pivot.id === 'niche' ? 'narrowFocus' : null;
      
      if (pivotKey && member[pivotKey]) {
        const opinion = member[pivotKey];
        supportStatus = opinion.support ? 'Supports' : 'Opposes';
        pivotOpinion = opinion.note;
      }
    }
    
    document.getElementById("teamMemberContent").innerHTML = `
      <!-- Background -->
      <div class="bg-slate-50 rounded-xl p-4 border border-slate-200 mb-4">
        <div class="text-xs font-bold text-slate-500 mb-2">BACKGROUND</div>
        <p class="text-sm text-slate-700">${member.background || 'Experienced professional with deep domain expertise.'}</p>
      </div>
      
      <!-- Expertise -->
      ${member.expertise ? `
        <div class="mb-4">
          <div class="text-xs font-bold text-slate-500 mb-2">EXPERTISE</div>
          <div class="flex flex-wrap gap-2">
            ${member.expertise.map(e => `
              <span class="px-2 py-1 bg-indigo-50 text-indigo-700 text-xs rounded-full border border-indigo-200">${e}</span>
            `).join('')}
          </div>
        </div>
      ` : ''}
      
      <!-- Current Mood & View -->
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
          <div class="text-xs text-slate-500 mb-1">Current Mood</div>
          <div class="flex items-center gap-2">
            <span class="text-2xl">${member.mood}</span>
            <span class="font-medium text-slate-700">${member.moodText}</span>
          </div>
        </div>
        ${supportStatus ? `
          <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
            <div class="text-xs text-slate-500 mb-1">Position on ${pivot?.name || 'Current Pivot'}</div>
            <div class="font-bold ${supportStatus === 'Supports' ? 'text-emerald-600' : 'text-red-600'}">${supportStatus}</div>
          </div>
        ` : ''}
      </div>
      
      <!-- Current Perspective -->
      <div class="bg-indigo-50 rounded-xl p-4 border border-indigo-200 mb-4">
        <div class="text-xs font-bold text-indigo-600 mb-2">ğŸ’¬ CURRENT PERSPECTIVE</div>
        <p class="text-sm text-slate-700 italic">"${mode === 'forced' ? member.forcedView : member.pivotView}"</p>
      </div>
      
      <!-- Pivot-Specific Opinion -->
      ${pivotOpinion ? `
        <div class="${supportStatus === 'Supports' ? 'bg-emerald-50 border-emerald-200' : 'bg-red-50 border-red-200'} rounded-xl p-4 border mb-4">
          <div class="text-xs font-bold ${supportStatus === 'Supports' ? 'text-emerald-600' : 'text-red-600'} mb-2">
            ${supportStatus === 'Supports' ? 'âœ“' : 'âœ—'} ON ${(pivot?.name || 'THIS PIVOT').toUpperCase()}
          </div>
          <p class="text-sm text-slate-700">"${pivotOpinion}"</p>
        </div>
      ` : ''}
      
      <!-- Concerns -->
      ${member.concerns ? `
        <div class="bg-amber-50 rounded-xl p-4 border border-amber-200">
          <div class="text-xs font-bold text-amber-700 mb-2">âš ï¸ KEY CONCERNS</div>
          <ul class="text-sm text-slate-700 space-y-1">
            ${member.concerns.map(c => `<li>â€¢ ${c}</li>`).join('')}
          </ul>
        </div>
      ` : ''}
    `;
    
    document.getElementById("teamMemberModal").classList.remove("hidden");
    document.getElementById("teamMemberModal").classList.add("flex");
  }
  
  closeTeamMemberModal() {
    document.getElementById("teamMemberModal").classList.add("hidden");
    document.getElementById("teamMemberModal").classList.remove("flex");
  }
  
  showCompetitorDetailModal(rivalId) {
    // Play competitor intel sound
    soundManager.playCompetitorIntel();
    
    // Find the rival - either from triggering rival or by ID
    let rival = this.pivotState.triggeringRival;
    if (!rival && rivalId && this.rivals) {
      rival = this.rivals.find(r => r.id === rivalId);
    }
    if (!rival) {
      rival = { name: 'Competitor', focus: 'Technology', milestoneProgress: 100 };
    }
    
    const milestoneName = this.milestone?.name || 'Enterprise AI Platform';
    const ceo = rival.ceo || { name: 'Unknown', photo: 'ğŸ‘¤', background: 'No information available', personality: '', quote: '' };
    const strengths = rival.strengths || ['Well-funded', 'Experienced team'];
    const weaknesses = rival.weaknesses || ['Unknown weaknesses'];
    const funder = rival.funder || { name: 'Unknown', raised: 'Undisclosed' };
    
    // Build competitor profile
    document.getElementById("competitorDetailTitle").textContent = `ğŸ¢ ${rival.name}`;
    document.getElementById("competitorDetailContent").innerHTML = `
      <!-- Company Header -->
      <div class="mb-4">
        <div class="flex items-center gap-4 mb-3">
          <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-red-500 to-orange-500 flex items-center justify-center text-3xl text-white font-bold shadow-lg">
            ${rival.logo || rival.name.charAt(0)}
          </div>
          <div class="flex-1">
            <h3 class="font-bold text-slate-800 text-lg">${rival.name}</h3>
            <p class="text-sm text-slate-500">${rival.desc || 'AI Technology Company'}</p>
            <div class="flex items-center gap-3 mt-1 text-xs text-slate-500">
              <span>ğŸ“ ${rival.location || 'UK'}</span>
              <span>ğŸ‘¥ ${rival.employees || '?'} employees</span>
              <span>ğŸ’° ${rival.funded || 'Unknown'}</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- CEO Profile -->
      <div class="bg-amber-50 rounded-xl p-4 border border-amber-200 mb-4">
        <div class="flex items-start gap-3">
          <div class="w-12 h-12 rounded-full bg-amber-100 border-2 border-amber-300 flex items-center justify-center text-2xl flex-shrink-0">
            ${ceo.photo}
          </div>
          <div class="flex-1">
            <div class="text-xs text-amber-600 font-bold mb-1">FOUNDER & CEO</div>
            <div class="font-bold text-slate-800">${ceo.name}</div>
            <div class="text-sm text-slate-600 mt-1">${ceo.background}</div>
            ${ceo.personality ? `<div class="text-xs text-slate-500 mt-2 italic">${ceo.personality}</div>` : ''}
            ${ceo.quote ? `
              <div class="mt-2 bg-white rounded-lg p-2 border border-amber-200">
                <p class="text-xs text-slate-600 italic">"${ceo.quote}"</p>
              </div>
            ` : ''}
          </div>
        </div>
      </div>
      
      <!-- Intelligence -->
      <div class="bg-indigo-50 rounded-lg p-3 border border-indigo-200 mb-4">
        <div class="text-xs font-bold text-indigo-700 mb-1">ğŸ”® Intelligence</div>
        <div class="text-sm text-slate-700">
          ${rival.style === 'aggressive' ? 'Moving fast and breaking things. High risk tolerance, prioritizes speed over quality.' :
            rival.style === 'methodical' ? 'Careful and deliberate. Strong on fundamentals but slow to market.' :
            rival.style === 'cautious' ? 'Risk-averse and research-focused. May struggle with commercialization.' :
            'Competitive threat level unclear. Monitor their progress closely.'}
        </div>
      </div>
      
      <!-- Funding -->
      ${funder ? `
        <div class="bg-slate-50 rounded-lg p-3 border border-slate-200 mb-4">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-xs text-slate-500">Backed by</div>
              <div class="font-medium text-slate-800">${funder.name}</div>
            </div>
            <div class="text-right">
              <div class="text-xs text-slate-500">Raised</div>
              <div class="font-bold text-emerald-600">${funder.raised}</div>
            </div>
          </div>
        </div>
      ` : ''}
      
      <!-- Strengths & Weaknesses -->
      <div class="grid grid-cols-2 gap-3 mb-4">
        <div class="bg-emerald-50 rounded-lg p-3 border border-emerald-200">
          <div class="text-xs font-bold text-emerald-700 mb-2">âœ… Strengths</div>
          <ul class="text-xs text-slate-600 space-y-1">
            ${strengths.map(s => `<li>â€¢ ${s}</li>`).join('')}
          </ul>
        </div>
        <div class="bg-red-50 rounded-lg p-3 border border-red-200">
          <div class="text-xs font-bold text-red-700 mb-2">âš ï¸ Weaknesses</div>
          <ul class="text-xs text-slate-600 space-y-1">
            ${weaknesses.map(w => `<li>â€¢ ${w}</li>`).join('')}
          </ul>
        </div>
      </div>
      
      <!-- Their Milestones -->
      ${rival.milestones ? `
        <div class="bg-slate-50 rounded-lg p-3 border border-slate-200 mb-4">
          <div class="text-xs font-bold text-slate-700 mb-2">ğŸ“‹ Their Milestones</div>
          <div class="space-y-2">
            ${rival.milestones.map(m => `
              <div class="flex items-center gap-2 text-xs">
                <span class="${m.status === 'complete' ? 'text-emerald-500' : m.status === 'in-progress' ? 'text-amber-500' : 'text-slate-400'}">
                  ${m.status === 'complete' ? 'âœ“' : m.status === 'in-progress' ? 'â—' : 'â—‹'}
                </span>
                <span class="${m.status === 'complete' ? 'text-slate-700' : 'text-slate-500'}">${m.name}</span>
                ${m.status === 'complete' && m.quarter ? `<span class="text-slate-400 ml-auto">Q${m.quarter}</span>` : ''}
              </div>
            `).join('')}
          </div>
        </div>
      ` : ''}
      
      <!-- Progress Comparison -->
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="bg-red-50 rounded-lg p-3 border border-red-200">
          <div class="text-xs text-red-600 font-medium">Their Progress</div>
          <div class="text-2xl font-bold text-red-600">${rival.milestoneProgress || 100}%</div>
        </div>
        <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
          <div class="text-xs text-slate-500">Your Progress</div>
          <div class="text-2xl font-bold text-amber-600">${this.milestoneProgress || 0}%</div>
        </div>
      </div>
      
      <!-- Market Impact -->
      <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
        <div class="text-xs font-bold text-amber-700 mb-2">âš ï¸ MARKET IMPACT</div>
        <ul class="text-sm text-slate-700 space-y-1">
          <li>â€¢ They now have first-mover advantage</li>
          <li>â€¢ Customer attention has shifted to them</li>
          <li>â€¢ You'll need to differentiate or pivot</li>
          <li>â€¢ Continuing head-on will be harder</li>
        </ul>
      </div>
    `;
    
    document.getElementById("competitorDetailModal").classList.remove("hidden");
    document.getElementById("competitorDetailModal").classList.add("flex");
  }
  
  closeCompetitorDetailModal() {
    document.getElementById("competitorDetailModal").classList.add("hidden");
    document.getElementById("competitorDetailModal").classList.remove("flex");
  }
  
  showPivotCompanyDetail() {
    const cash = this.metrics?.cash || 200;
    const burnRate = 40; // Approximate quarterly burn
    const runway = (cash / burnRate).toFixed(1);
    
    // Get metric strengths
    const getStrength = (val) => val >= 60 ? 'Strong' : val >= 40 ? 'Growing' : 'Developing';
    const sci = this.metrics?.sci || 50;
    const dev = this.metrics?.dev || 50;
    const mkt = this.metrics?.mkt || 30;
    
    document.getElementById("pivotCompanyContent").innerHTML = `
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="bg-slate-50 rounded-lg p-3">
          <div class="text-xs text-slate-500">Cash</div>
          <div class="text-xl font-bold text-slate-800">Â£${cash}k</div>
        </div>
        <div class="bg-amber-50 rounded-lg p-3">
          <div class="text-xs text-amber-600">Runway</div>
          <div class="text-xl font-bold text-amber-700">${runway} quarters</div>
        </div>
      </div>
      <div class="space-y-3">
        <div>
          <div class="flex justify-between text-sm mb-1"><span class="text-blue-600 font-medium">Research</span><span>${getStrength(sci)}</span></div>
          <div class="h-2 bg-slate-200 rounded-full"><div class="h-full bg-blue-500 rounded-full" style="width: ${sci}%"></div></div>
        </div>
        <div>
          <div class="flex justify-between text-sm mb-1"><span class="text-green-600 font-medium">Product</span><span>${getStrength(dev)}</span></div>
          <div class="h-2 bg-slate-200 rounded-full"><div class="h-full bg-green-500 rounded-full" style="width: ${dev}%"></div></div>
        </div>
        <div>
          <div class="flex justify-between text-sm mb-1"><span class="text-amber-600 font-medium">Sales</span><span>${getStrength(mkt)}</span></div>
          <div class="h-2 bg-slate-200 rounded-full"><div class="h-full bg-amber-500 rounded-full" style="width: ${mkt}%"></div></div>
        </div>
      </div>
      <div class="mt-4 pt-4 border-t border-slate-200">
        <div class="text-xs text-slate-500 mb-2"><strong>Team:</strong> ${this.staff?.length || 5} employees</div>
        <div class="text-xs text-slate-500"><strong>Equity:</strong> ${this.metrics?.equity || 85}% founder ownership</div>
      </div>
    `;
    
    document.getElementById("pivotCompanyModal").classList.remove("hidden");
    document.getElementById("pivotCompanyModal").classList.add("flex");
  }
  
  closePivotCompanyModal() {
    document.getElementById("pivotCompanyModal").classList.add("hidden");
    document.getElementById("pivotCompanyModal").classList.remove("flex");
  }
  
  showPivotCurrentMilestone() {
    const m = this.milestone || { name: 'Enterprise AI Platform', desc: 'Build and deploy an AI solution for enterprise customers' };
    const progress = this.milestoneProgress || 0;
    const quartersLeft = (m.time || 8) - (this.turn || 1) + 1;
    const reward = `Â£${m.reward?.cash || 300}k`;
    
    // Domain progress (derived from game metrics)
    const sci = this.metrics?.sci || 30;
    const dev = this.metrics?.dev || 30;
    const mkt = this.metrics?.mkt || 20;
    
    // Estimate requirements based on milestone
    const domains = {
      research: { current: Math.round(sci * 0.7), required: 70, label: 'Publications & patents' },
      product: { current: Math.round(dev * 0.8), required: 80, label: 'MVP completion' },
      sales: { current: Math.round(mkt * 0.6), required: 60, label: 'Customer acquisition' }
    };
    
    const invested = `Â£${Math.round((100 - (this.metrics?.equity || 85)) * 5)}k spent, ${(this.turn || 1) - 1} quarters elapsed`;
    
    document.getElementById("pivotCurrentMilestoneContent").innerHTML = `
      <div class="mb-4">
        <h3 class="font-bold text-slate-800 text-lg">${m.name}</h3>
        <p class="text-sm text-slate-600">${m.desc}</p>
      </div>
      
      <div class="grid grid-cols-3 gap-3 mb-4 text-center">
        <div class="bg-slate-50 rounded-lg p-2">
          <div class="text-2xl font-bold text-amber-600">${progress}%</div>
          <div class="text-xs text-slate-500">Overall</div>
        </div>
        <div class="bg-slate-50 rounded-lg p-2">
          <div class="text-2xl font-bold text-slate-700">${Math.max(0, quartersLeft)}q</div>
          <div class="text-xs text-slate-500">Remaining</div>
        </div>
        <div class="bg-slate-50 rounded-lg p-2">
          <div class="text-lg font-bold text-emerald-600">${reward}</div>
          <div class="text-xs text-slate-500">Reward</div>
        </div>
      </div>
      
      <div class="text-sm font-medium text-slate-700 mb-2">Progress by Domain:</div>
      <div class="space-y-3">
        ${Object.entries(domains).map(([key, d]) => `
          <div>
            <div class="flex justify-between text-xs mb-1">
              <span class="font-medium capitalize">${key}</span>
              <span class="text-slate-500">${d.current}/${d.required} needed</span>
            </div>
            <div class="h-2 bg-slate-200 rounded-full relative">
              <div class="h-full bg-blue-500 rounded-full" style="width: ${Math.min(100, (d.current/d.required)*100)}%"></div>
            </div>
            <div class="text-xs text-slate-500 mt-0.5">${d.label}</div>
          </div>
        `).join('')}
      </div>
      
      <div class="mt-4 pt-4 border-t border-slate-200 text-xs text-slate-500">
        <strong>Investment so far:</strong> ${invested}
      </div>
    `;
    
    document.getElementById("pivotCurrentMilestoneModal").classList.remove("hidden");
    document.getElementById("pivotCurrentMilestoneModal").classList.add("flex");
  }
  
  closePivotCurrentMilestoneModal() {
    document.getElementById("pivotCurrentMilestoneModal").classList.add("hidden");
    document.getElementById("pivotCurrentMilestoneModal").classList.remove("flex");
  }
  
  showMilestoneComparison(milestoneId, pivotId) {
    const pivot = this.pivotState.currentPivotData || 
      STRATEGIC_PIVOTS.find(p => p.id === pivotId) || 
      FORCED_RESPONSES.find(p => p.id === pivotId);
    if (!pivot) return;
    
    const milestones = this.getPivotMilestones(pivotId);
    const newMilestone = milestones.find(m => m.id === milestoneId);
    if (!newMilestone) return;
    
    const currentMilestone = this.milestone || { name: 'Current Milestone', desc: '' };
    const currentProgress = this.milestoneProgress || 0;
    const equity = this.metrics?.equity || 85;
    const invested = `Â£${Math.round((100 - equity) * 5)}k spent, ${(this.turn || 1) - 1} quarters elapsed`;
    
    // Current domain values (approximated from metrics)
    const currResearch = this.metrics?.sci || 30;
    const currProduct = this.metrics?.dev || 30;
    const currSales = this.metrics?.mkt || 20;
    
    // Calculate transfers
    const researchTransfer = Math.round(currResearch * (newMilestone.transfer?.sci || 70) / 100);
    const productTransfer = Math.round(currProduct * (newMilestone.transfer?.dev || 60) / 100);
    const salesTransfer = Math.round(currSales * (newMilestone.transfer?.mkt || 30) / 100);
    
    const modal = document.getElementById("pivotInfoModal");
    const title = document.getElementById("pivotInfoTitle");
    const content = document.getElementById("pivotInfoContent");
    
    title.textContent = `ğŸ“Š ${newMilestone.name} - Detailed Comparison`;
    
    content.innerHTML = `
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="bg-red-50 rounded-xl p-4 border border-red-200">
          <div class="text-xs font-bold text-red-600 mb-2">ğŸ“ LEAVING</div>
          <div class="font-bold text-slate-800">${currentMilestone.name}</div>
          <div class="text-sm text-slate-600">${currentProgress}% complete</div>
          <div class="text-xs text-slate-500 mt-1">${invested}</div>
        </div>
        <div class="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
          <div class="text-xs font-bold text-emerald-600 mb-2">ğŸ¯ JOINING</div>
          <div class="font-bold text-slate-800">${newMilestone.name}</div>
          <div class="text-sm text-slate-600">${newMilestone.startingProgress}% start â€¢ ${newMilestone.time}q</div>
          <div class="text-xs text-slate-500 mt-1">Reward: Â£${newMilestone.reward?.cash || 300}k + Â£${newMilestone.reward?.val || 500}k val</div>
        </div>
      </div>
      
      <div class="bg-slate-50 rounded-xl p-4 mb-4 border border-slate-200">
        <div class="text-sm font-bold text-slate-700 mb-3">Progress Transfer by Domain:</div>
        <div class="space-y-3">
          <div>
            <div class="flex justify-between text-xs mb-1">
              <span class="font-medium">Research</span>
              <span>
                <span class="text-slate-400">${currResearch}</span>
                <span class="text-slate-400 mx-1">â†’</span>
                <span class="text-emerald-600 font-medium">${researchTransfer}</span>
                <span class="text-slate-400 ml-1">(${newMilestone.transfer?.sci || 70}% transfers)</span>
              </span>
            </div>
            <div class="h-3 bg-slate-200 rounded-full relative overflow-hidden">
              <div class="h-full bg-slate-300 rounded-full absolute" style="width: ${currResearch}%"></div>
              <div class="h-full bg-emerald-500 rounded-full relative" style="width: ${researchTransfer}%"></div>
            </div>
          </div>
          <div>
            <div class="flex justify-between text-xs mb-1">
              <span class="font-medium">Product</span>
              <span>
                <span class="text-slate-400">${currProduct}</span>
                <span class="text-slate-400 mx-1">â†’</span>
                <span class="text-emerald-600 font-medium">${productTransfer}</span>
                <span class="text-slate-400 ml-1">(${newMilestone.transfer?.dev || 60}% transfers)</span>
              </span>
            </div>
            <div class="h-3 bg-slate-200 rounded-full relative overflow-hidden">
              <div class="h-full bg-slate-300 rounded-full absolute" style="width: ${currProduct}%"></div>
              <div class="h-full bg-sky-500 rounded-full relative" style="width: ${productTransfer}%"></div>
            </div>
          </div>
          <div>
            <div class="flex justify-between text-xs mb-1">
              <span class="font-medium">Sales</span>
              <span>
                <span class="text-slate-400">${currSales}</span>
                <span class="text-slate-400 mx-1">â†’</span>
                <span class="text-emerald-600 font-medium">${salesTransfer}</span>
                <span class="text-slate-400 ml-1">(${newMilestone.transfer?.mkt || 30}% transfers)</span>
              </span>
            </div>
            <div class="h-3 bg-slate-200 rounded-full relative overflow-hidden">
              <div class="h-full bg-slate-300 rounded-full absolute" style="width: ${currSales}%"></div>
              <div class="h-full bg-fuchsia-500 rounded-full relative" style="width: ${salesTransfer}%"></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="bg-indigo-50 rounded-xl p-4 mb-4 border border-indigo-200">
        <div class="text-xs font-bold text-indigo-700 mb-1">ğŸ’¡ Analysis</div>
        <p class="text-sm text-slate-700">${newMilestone.notes || 'This milestone aligns well with your pivot strategy and team capabilities.'}</p>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-red-50 rounded-lg p-3 border border-red-200">
          <div class="text-xs font-bold text-red-600 mb-2">What You Lose:</div>
          <ul class="text-xs text-slate-600 space-y-1">
            <li>â€¢ ${100 - (newMilestone.transfer?.sci || 70)}% of research progress</li>
            <li>â€¢ ${100 - (newMilestone.transfer?.dev || 60)}% of product progress</li>
            <li>â€¢ ${100 - (newMilestone.transfer?.mkt || 30)}% of sales pipeline</li>
            <li>â€¢ ${pivot.costs[2] || pivot.costs[0]}</li>
          </ul>
        </div>
        <div class="bg-emerald-50 rounded-lg p-3 border border-emerald-200">
          <div class="text-xs font-bold text-emerald-600 mb-2">What You Gain:</div>
          <ul class="text-xs text-slate-600 space-y-1">
            <li>â€¢ Clear market differentiation</li>
            <li>â€¢ ${newMilestone.startingProgress}% starting progress</li>
            <li>â€¢ New strategic direction</li>
            <li>â€¢ ${newMilestone.reward?.cash || 300}k cash potential</li>
          </ul>
        </div>
      </div>
    `;
    
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  }
  
  getPivotMilestones(pivotType) {
    const archetype = this.company?.archetype || 'general';
    const milestoneSet = ARCHETYPE_PIVOT_MAP[archetype] || 'general';
    const categoryMap = { 'customer': 'customer', 'problem': 'problem', 'tech': 'tech', 'pivot': 'customer', 'niche': 'niche' };
    const category = categoryMap[pivotType] || 'customer';
    return PIVOT_MILESTONES[milestoneSet]?.[category] || PIVOT_MILESTONES.general[category] || [];
  }
  
  showPivotMilestoneModal(pivot, mode) {
    if (mode === 'strategic') {
      document.getElementById("strategicPivotModal").classList.add("hidden");
      document.getElementById("strategicPivotModal").classList.remove("flex");
    } else {
      document.getElementById("marketShiftModal").classList.add("hidden");
      document.getElementById("marketShiftModal").classList.remove("flex");
    }
    
    const milestones = this.getPivotMilestones(pivot.id);
    document.getElementById("pivotMilestoneTitle").textContent = `Stakeholder Recommendations`;
    
    // Build pivot summary (matching demo)
    const pivotSummaryHtml = `
      <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4 mb-4">
        <div class="flex items-start gap-3">
          <span class="text-2xl">${pivot.icon}</span>
          <div class="flex-1">
            <div class="font-bold text-emerald-800">${pivot.name}</div>
            <p class="text-sm text-emerald-700">${pivot.description}</p>
            <div class="mt-2 grid grid-cols-2 gap-2 text-xs">
              <div><span class="text-emerald-600">âœ“</span> ${pivot.preserves[0]}</div>
              <div><span class="text-red-600">âœ—</span> ${pivot.costs[0]}</div>
            </div>
          </div>
        </div>
      </div>
    `;
    
    // Build ENHANCED stakeholder section with portraits and detailed advice
    const teamQuotes = pivot.teamQuotes || {};
    const stakeholderColors = {
      research: { bg: 'bg-blue-50', border: 'border-blue-200', accent: 'text-blue-600', ring: 'ring-blue-400' },
      product: { bg: 'bg-green-50', border: 'border-green-200', accent: 'text-green-600', ring: 'ring-green-400' },
      sales: { bg: 'bg-amber-50', border: 'border-amber-200', accent: 'text-amber-600', ring: 'ring-amber-400' },
      investor: { bg: 'bg-purple-50', border: 'border-purple-200', accent: 'text-purple-600', ring: 'ring-purple-400' }
    };
    
    const stakeholderCardsHtml = `
      <div class="mb-5">
        <div class="text-sm font-bold text-slate-700 mb-3">ğŸ‘¥ Stakeholder Perspectives on This Strategy:</div>
        <div class="grid grid-cols-2 gap-3">
          ${['research', 'product', 'sales', 'investor'].map(role => {
            const member = PIVOT_TEAM[role];
            const colors = stakeholderColors[role];
            const quote = teamQuotes[role] || (mode === 'forced' ? member.forcedView : member.pivotView);
            const supportLevel = pivot.teamSupport >= 3 ? 'Supports' : pivot.teamSupport >= 2 ? 'Cautious' : 'Concerned';
            const supportColor = pivot.teamSupport >= 3 ? 'text-emerald-600' : pivot.teamSupport >= 2 ? 'text-amber-600' : 'text-red-600';
            
            return `
              <div onclick="game.showTeamMemberDetail('${role}')" 
                   class="${colors.bg} ${colors.border} border rounded-xl p-3 cursor-pointer hover:shadow-md transition-all">
                <div class="flex items-start gap-3">
                  <div class="w-10 h-10 rounded-full bg-white border-2 ${colors.border} flex items-center justify-center text-lg flex-shrink-0 shadow-sm">
                    ${member.emoji}
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center justify-between mb-1">
                      <div>
                        <span class="font-bold text-slate-800 text-sm">${member.name}</span>
                        <span class="text-xs ${colors.accent} ml-1">${member.role}</span>
                      </div>
                      <span class="text-xs ${supportColor} font-medium">${supportLevel}</span>
                    </div>
                    <p class="text-xs text-slate-700 leading-relaxed">"${quote}"</p>
                    <div class="text-xs text-indigo-500 mt-1 hover:text-indigo-700">View profile â†’</div>
                  </div>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      </div>
    `;
    
    const fitColors = { 
      high: 'bg-emerald-100 text-emerald-700', 
      medium: 'bg-amber-100 text-amber-700',
      low: 'bg-slate-100 text-slate-600'
    };
    
    const listEl = document.getElementById("pivotMilestoneList");
    listEl.innerHTML = pivotSummaryHtml + stakeholderCardsHtml + 
      '<div class="text-sm font-bold text-slate-700 mb-3">ğŸ¯ Choose Your New Milestone:</div>' + 
      milestones.map(m => {
        const isSelected = this.pivotState.selectedMilestone === m.id;
        const fit = m.startingProgress >= 40 ? 'high' : m.startingProgress >= 25 ? 'medium' : 'low';
        const fitLabel = fit === 'high' ? 'â­ Best fit' : 'Good fit';
        
        return `
          <div onclick="game.selectPivotMilestone('${m.id}')" 
               class="choice-card p-4 bg-white border-2 ${isSelected ? 'border-indigo-400 ring-2 ring-indigo-300' : 'border-slate-200'} rounded-xl cursor-pointer hover:border-indigo-300 hover:shadow-md" style="transition: all 0.2s ease;">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                  <h4 class="font-bold text-slate-800">${m.name}</h4>
                  <span class="text-xs px-2 py-0.5 rounded ${fitColors[fit]}">${fitLabel}</span>
                </div>
                <p class="text-sm text-slate-600">${m.desc}</p>
                <div class="mt-2 flex items-center justify-between">
                  <div class="flex items-center gap-4 text-xs text-slate-500">
                    <span>ğŸš€ Start at ${m.startingProgress}%</span>
                    <span>â± ${m.time}q</span>
                    <span>ğŸ’° Â£${m.reward?.cash || 300}k</span>
                    <span class="text-slate-400">${m.difficulty}</span>
                  </div>
                  <button onclick="event.stopPropagation(); game.showMilestoneComparison('${m.id}', '${pivot.id}')" class="px-2 py-1 text-xs bg-slate-100 border border-slate-300 rounded hover:bg-slate-200 text-slate-600">Get more information</button>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    
    document.getElementById("confirmPivotMilestoneBtn").disabled = true;
    document.getElementById("pivotMilestoneModal").classList.remove("hidden");
    document.getElementById("pivotMilestoneModal").classList.add("flex");
  }
  
  selectPivotMilestone(milestoneId) {
    this.pivotState.selectedMilestone = milestoneId;
    const milestones = this.getPivotMilestones(this.pivotState.currentPivotData.id);
    this.pivotState.currentMilestoneData = milestones.find(m => m.id === milestoneId);
    
    // Play milestone selection sound
    soundManager.playPivotMilestoneSelect();
    
    this.showPivotMilestoneModal(this.pivotState.currentPivotData, this.pivotState.mode);
    document.getElementById("confirmPivotMilestoneBtn").disabled = false;
  }
  
  confirmPivotMilestone() {
    if (!this.pivotState.currentMilestoneData) return;
    document.getElementById("pivotMilestoneModal").classList.add("hidden");
    document.getElementById("pivotMilestoneModal").classList.remove("flex");
    this.showCompanyRenameModal(this.pivotState.currentMilestoneData);
  }
  
  backToPivotChoice() {
    document.getElementById("pivotMilestoneModal").classList.add("hidden");
    document.getElementById("pivotMilestoneModal").classList.remove("flex");
    this.pivotState.selectedMilestone = null;
    this.pivotState.currentMilestoneData = null;
    
    if (this.pivotState.mode === 'strategic') this.showStrategicPivotModal();
    else this.showMarketShiftModal(this.pivotState.triggeringRival);
  }
  
  showCompanyRenameModal(milestone) {
    const optionsEl = document.getElementById("companyRenameOptions");
    const nameOptions = milestone.nameOptions || [];
    const currentName = this.company?.name || "Your Company";
    const pivot = this.pivotState.currentPivotData;
    
    const fitColors = { 
      high: 'bg-emerald-100 text-emerald-700 border-emerald-300', 
      medium: 'bg-amber-100 text-amber-700 border-amber-300', 
      low: 'bg-slate-100 text-slate-600 border-slate-300'
    };
    const fitLabels = { high: 'â­ Best fit', medium: 'Good fit', low: 'Safe choice' };
    
    // Build header context (matching demo)
    const headerHtml = `
      <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-4">
        <div class="flex items-center gap-3">
          <span class="text-2xl">${pivot?.icon || 'ğŸ¯'}</span>
          <div>
            <div class="font-bold text-indigo-800">New Direction: ${milestone.name}</div>
            <p class="text-sm text-indigo-600">${milestone.desc}</p>
          </div>
        </div>
      </div>
      
      <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4">
        <div class="flex items-start gap-2">
          <span class="text-lg">âš–ï¸</span>
          <div class="text-sm text-amber-800">
            <strong>Rebranding Trade-offs:</strong> A new name can boost credibility in your target market and signal commitment to stakeholders. 
            But it costs time, creates confusion with existing contacts, and temporarily hurts sales while you rebuild recognition.
          </div>
        </div>
      </div>
      
      <div class="text-sm font-bold text-slate-700 mb-3">Choose Your Company Name:</div>
    `;
    
    optionsEl.innerHTML = headerHtml + nameOptions.map((opt, idx) => {
      const isSelected = this.pivotState.selectedNameOption === idx;
      const fitStyle = fitColors[opt.fit] || fitColors.medium;
      const fitLabel = fitLabels[opt.fit] || fitLabels.medium;
      
      return `
        <div onclick="game.selectNameOption(${idx})"
             class="name-card choice-card p-4 bg-white border-2 ${isSelected ? 'border-indigo-400 ring-2 ring-indigo-300' : 'border-slate-200'} rounded-xl cursor-pointer hover:border-indigo-300 hover:shadow-md" style="transition: all 0.2s ease;">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-2">
                <span class="text-xl font-bold text-slate-800">ğŸ§¬ ${opt.name}</span>
                <span class="text-xs px-2 py-0.5 rounded border ${fitStyle}">${fitLabel}</span>
              </div>
              
              <div class="bg-slate-50 rounded-lg p-3 mb-3">
                <div class="flex items-start gap-2">
                  <span class="text-sm">ğŸ’¬</span>
                  <div>
                    <span class="text-sm text-slate-700 italic">"${opt.quote}"</span>
                    <span class="text-xs text-slate-500 ml-2">â€” ${opt.stakeholder}</span>
                  </div>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-3">
                <div class="flex items-center gap-2">
                  <span class="text-xs font-medium ${opt.salesImpact < 0 ? 'text-red-600' : opt.salesImpact > 0 ? 'text-emerald-600' : 'text-slate-500'}">
                    ğŸ“‰ Sales Impact:
                  </span>
                  <span class="text-xs font-bold ${opt.salesImpact < 0 ? 'text-red-600' : opt.salesImpact > 0 ? 'text-emerald-600' : 'text-slate-500'}">
                    ${opt.salesImpact > 0 ? '+' : ''}${opt.salesImpact}%
                  </span>
                  <span class="text-xs text-slate-400">${opt.salesImpact < 0 ? '(short-term disruption)' : opt.salesImpact > 0 ? '(market fit)' : '(no change)'}</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="text-xs font-medium ${opt.brandImpact > 10 ? 'text-emerald-600' : opt.brandImpact > 0 ? 'text-blue-600' : 'text-slate-500'}">
                    âœ¨ Brand Impact:
                  </span>
                  <span class="text-xs font-bold ${opt.brandImpact > 10 ? 'text-emerald-600' : opt.brandImpact > 0 ? 'text-blue-600' : 'text-slate-500'}">
                    +${opt.brandImpact}%
                  </span>
                  <span class="text-xs text-slate-400">${opt.brandImpact > 10 ? '(strong positioning)' : opt.brandImpact > 0 ? '(modest gain)' : '(minimal change)'}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }).join('') + `
      <!-- Keep current name option -->
      <div onclick="game.selectNameOption(-1)"
           class="name-card choice-card p-4 bg-slate-50 border-2 ${this.pivotState.selectedNameOption === -1 ? 'border-slate-400 ring-2 ring-slate-300' : 'border-slate-200'} rounded-xl cursor-pointer hover:border-slate-400 hover:shadow-md" style="transition: all 0.2s ease;">
        <div class="flex items-start justify-between">
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-xl font-bold text-slate-700">ğŸ§¬ ${currentName}</span>
              <span class="text-xs px-2 py-0.5 rounded border bg-slate-200 text-slate-600 border-slate-300">Keep Current</span>
            </div>
            
            <div class="bg-white rounded-lg p-3 mb-3 border border-slate-200">
              <div class="flex items-start gap-2">
                <span class="text-sm">ğŸ’¬</span>
                <div>
                  <span class="text-sm text-slate-700 italic">"We've built recognition. Changing names now adds risk to an already risky pivot."</span>
                  <span class="text-xs text-slate-500 ml-2">â€” Sarah (Investor)</span>
                </div>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-3">
              <div class="flex items-center gap-2">
                <span class="text-xs font-medium text-slate-500">ğŸ“‰ Sales Impact:</span>
                <span class="text-xs font-bold text-slate-500">0%</span>
                <span class="text-xs text-slate-400">(no disruption)</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="text-xs font-medium text-slate-500">âœ¨ Brand Impact:</span>
                <span class="text-xs font-bold text-slate-500">0%</span>
                <span class="text-xs text-slate-400">(continuity)</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
    
    document.getElementById("confirmRenameBtn").disabled = true;
    document.getElementById("companyRenameModal").classList.remove("hidden");
    document.getElementById("companyRenameModal").classList.add("flex");
  }
  
  selectNameOption(index) {
    this.pivotState.selectedNameOption = index;
    
    // Play rename/rebrand sound when selecting a new name
    if (index !== -1) {
      soundManager.playCompanyRename();
    } else {
      soundManager.playClick();
    }
    
    this.showCompanyRenameModal(this.pivotState.currentMilestoneData);
    document.getElementById("confirmRenameBtn").disabled = false;
  }
  
  backToPivotMilestone() {
    document.getElementById("companyRenameModal").classList.add("hidden");
    document.getElementById("companyRenameModal").classList.remove("flex");
    this.pivotState.selectedNameOption = null;
    this.showPivotMilestoneModal(this.pivotState.currentPivotData, this.pivotState.mode);
  }
  
  confirmCompanyRename() {
    const milestone = this.pivotState.currentMilestoneData;
    const nameOptions = milestone.nameOptions || [];
    const selectedIdx = this.pivotState.selectedNameOption;
    
    let selectedName, salesImpact, brandImpact;
    if (selectedIdx === -1) {
      selectedName = this.company?.name || "Your Company";
      salesImpact = 0;
      brandImpact = 0;
    } else {
      const opt = nameOptions[selectedIdx];
      selectedName = opt.name;
      salesImpact = opt.salesImpact;
      brandImpact = opt.brandImpact;
    }
    
    document.getElementById("companyRenameModal").classList.add("hidden");
    document.getElementById("companyRenameModal").classList.remove("flex");
    
    this.showPivotOutcome({
      newName: selectedName,
      oldName: this.company?.name,
      nameChanged: selectedIdx !== -1,
      milestone: milestone,
      pivot: this.pivotState.currentPivotData,
      salesImpact: salesImpact,
      brandImpact: brandImpact
    });
  }
  
  handleCompeteHeadOn() {
    document.getElementById("marketShiftModal").classList.add("hidden");
    document.getElementById("marketShiftModal").classList.remove("flex");
    
    // Play battle determination sound
    soundManager.playCompeteHeadOn();
    
    const valuationPenalty = Math.round(this.metrics.val * 0.20);
    this.metrics.val = Math.max(100, this.metrics.val - valuationPenalty);
    
    this.log(`âš”ï¸ Chose to compete head-on. Valuation hit: -Â£${valuationPenalty}k`);
    
    this.journeyEvents.push({
      quarter: this.turn,
      type: 'pivot_compete',
      description: `Chose to compete head-on after ${this.pivotState.triggeringRival?.name} took the lead`
    });
    
    this.showPivotOutcome({ competed: true, rival: this.pivotState.triggeringRival, valuationPenalty });
  }
  
  showPivotOutcome(data) {
    const summaryEl = document.getElementById("pivotOutcomeSummary");
    const titleEl = document.getElementById("pivotOutcomeTitle");
    
    // Play appropriate sound based on outcome
    if (!data.competed) {
      soundManager.playPivotComplete();
    }
    // Note: compete sound already played in handleCompeteHeadOn
    
    if (data.competed) {
      titleEl.textContent = "âš”ï¸ Staying the Course";
      summaryEl.innerHTML = `
        <div class="text-center mb-6">
          <div class="text-5xl mb-4">âš”ï¸</div>
          <div class="inline-flex items-center gap-2 px-4 py-2 bg-slate-100 rounded-full mb-2">
            <span class="text-lg">ğŸ§¬</span>
            <span class="font-bold text-slate-800">${this.company?.name || 'Your Company'}</span>
          </div>
        </div>
        
        <div class="bg-amber-50 rounded-xl p-4 border border-amber-200 mb-4">
          <p class="text-amber-800 font-medium">You've chosen to compete head-on against ${data.rival?.name}.</p>
          <p class="text-amber-700 text-sm mt-2">All your milestone progress is preserved, but investors have noted the competitive pressure. You're now fighting for market position as #2.</p>
        </div>
        
        <div class="bg-slate-50 rounded-xl p-4 border border-slate-200 mb-4">
          <div class="text-sm text-slate-600 space-y-2">
            <div>ğŸ“‹ <strong>Milestone:</strong> ${this.milestone?.name || 'Current Milestone'} (unchanged)</div>
            <div>ğŸ“Š <strong>Progress:</strong> ${this.milestoneProgress || 0}% (preserved)</div>
            <div>ğŸ’° <strong>Cost:</strong> None</div>
          </div>
        </div>
        
        <div class="bg-red-50 rounded-xl p-4 border border-red-200">
          <div class="flex justify-between items-center mb-2">
            <span class="text-red-700 font-medium">Valuation Impact</span>
            <span class="font-bold text-red-700 text-lg">-Â£${data.valuationPenalty}k</span>
          </div>
          <p class="text-xs text-red-600">Market perceives competitive disadvantage. Future fundraising will be +15% more dilutive.</p>
        </div>
      `;
    } else {
      titleEl.textContent = "âœ“ Pivot Complete";
      const pivot = this.pivotState.currentPivotData;
      
      summaryEl.innerHTML = `
        <div class="text-center mb-6">
          <div class="text-5xl mb-4">ğŸ¯</div>
          
          ${data.nameChanged ? `
            <div class="inline-flex items-center gap-2 px-4 py-2 bg-emerald-100 rounded-full mb-2">
              <span class="text-lg">ğŸ§¬</span>
              <span class="font-bold text-emerald-800">${data.newName}</span>
              <span class="text-xs text-emerald-600 px-2 py-0.5 bg-emerald-200 rounded-full">New Identity</span>
            </div>
            <div class="text-sm text-slate-500">formerly ${data.oldName}</div>
          ` : `
            <div class="inline-flex items-center gap-2 px-4 py-2 bg-slate-100 rounded-full mb-2">
              <span class="text-lg">ğŸ§¬</span>
              <span class="font-bold text-slate-800">${this.company?.name || 'Your Company'}</span>
            </div>
          `}
        </div>
        
        <h3 class="text-xl font-bold text-slate-800 mb-2 text-center">${pivot?.name || 'Strategic Pivot'}</h3>
        <p class="text-slate-600 mb-6 text-center">New direction set. Your company is ready for the next chapter.</p>
        
        <div class="bg-slate-50 rounded-xl p-4 border border-slate-200 mb-4">
          <div class="text-sm text-slate-600 space-y-2">
            ${data.nameChanged ? `
              <div class="pb-2 mb-2 border-b border-slate-200">
                <div>ğŸ·ï¸ <strong>Company:</strong> ${data.newName}</div>
                <div class="flex gap-4 mt-1 text-xs">
                  <span class="${data.salesImpact < 0 ? 'text-red-600' : 'text-slate-500'}">ğŸ“‰ Sales: ${data.salesImpact}%</span>
                  <span class="${data.brandImpact > 0 ? 'text-emerald-600' : 'text-slate-500'}">âœ¨ Brand: +${data.brandImpact}%</span>
                </div>
              </div>
            ` : ''}
            <div>ğŸ“‹ <strong>New milestone:</strong> ${data.milestone.name}</div>
            <div>â° <strong>Timeline:</strong> +${data.milestone.time} quarters</div>
            <div>ğŸ’° <strong>Cost:</strong> ${pivot?.costs?.[2] || '~Â£30k transition'}</div>
            <div>ğŸ“Š <strong>Progress:</strong> ${data.milestone.startingProgress}% (transferred from current work)</div>
          </div>
        </div>
        
        ${data.nameChanged && data.salesImpact < 0 ? `
          <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4">
            <div class="text-sm text-amber-800">
              <strong>âš ï¸ Rebrand Effect:</strong> Expect ${Math.abs(data.salesImpact)}% slower sales for 1-2 quarters while market learns your new name. 
              Brand positioning boost of +${data.brandImpact}% will compound over time.
            </div>
          </div>
        ` : ''}
        
        <div class="bg-indigo-50 rounded-xl p-4 border border-indigo-200">
          <h4 class="font-medium text-indigo-800 mb-2">${data.milestone.icon || 'ğŸ¯'} ${data.milestone.name}</h4>
          <p class="text-sm text-indigo-700">${data.milestone.desc}</p>
        </div>
      `;
    }
    
    document.getElementById("pivotOutcomeModal").classList.remove("hidden");
    document.getElementById("pivotOutcomeModal").classList.add("flex");
  }
  
  completePivotProcess() {
    document.getElementById("pivotOutcomeModal").classList.add("hidden");
    document.getElementById("pivotOutcomeModal").classList.remove("flex");
    
    // If it was a compete decision, just continue
    if (this.pivotState.currentPivotData?.id === 'compete' || !this.pivotState.currentMilestoneData) {
      this.resetPivotState();
      this.update();
      this.continueAfterShock();
      return;
    }
    
    const milestone = this.pivotState.currentMilestoneData;
    const pivot = this.pivotState.currentPivotData;
    const nameOptions = milestone.nameOptions || [];
    const selectedIdx = this.pivotState.selectedNameOption;
    
    // === REVENUE SYSTEM: Apply pivot impact on customers and pipeline ===
    this.applyPivotRevenueImpact(pivot);
    
    // Apply name change
    if (selectedIdx !== -1 && nameOptions[selectedIdx]) {
      const opt = nameOptions[selectedIdx];
      this.company.name = opt.name;
      
      // Apply sales impact to mkt metric
      if (opt.salesImpact) {
        this.metrics.mkt = Math.max(0, this.metrics.mkt * (1 + opt.salesImpact / 100));
      }
      
      // Apply brand impact to valuation
      if (opt.brandImpact) {
        this.metrics.val = Math.round(this.metrics.val * (1 + opt.brandImpact / 100));
      }
      
      // Update displays
      this.updateCompanyNameDisplays();
    }
    
    // Set new milestone
    this.milestone = {
      ...milestone,
      deadline: this.turn + milestone.time
    };
    this.milestoneProgress = milestone.startingProgress || 0;
    
    // Apply transition costs
    const costMap = { customer: 25, problem: 40, tech: 50, pivot: 30, niche: 20 };
    const cost = costMap[pivot.id] || 30;
    this.metrics.cash = Math.max(0, this.metrics.cash - cost);
    
    // Log the pivot
    this.log(`ğŸ”„ Pivoted to: ${milestone.name}. Transition cost: Â£${cost}k`);
    
    this.journeyEvents.push({
      quarter: this.turn,
      type: 'pivot',
      description: `Pivoted via ${pivot.name} to ${milestone.name}`,
      newCompanyName: this.company.name
    });
    
    this.resetPivotState();
    this.update();
    this.continueAfterShock();
  }
  
  // === REVENUE SYSTEM: Handle pivot impact on customers/pipeline ===
  applyPivotRevenueImpact(pivot) {
    if (!this.revenueModel) return;
    
    // Different pivot types have different customer retention rates
    // customer: targeting new customers entirely - lose most
    // problem: solving different problem - lose many
    // tech: same problem, different tech - keep most (they care about outcome)
    // pivot: full direction change - lose all
    // niche: narrower focus - keep some (the ones in the niche)
    const retentionRates = {
      customer: 0.1,   // 10% retention - new customer segment
      problem: 0.25,   // 25% retention - different problem
      tech: 0.7,       // 70% retention - same outcome, different approach
      pivot: 0,        // 0% retention - complete restart
      niche: 0.5       // 50% retention - narrower focus
    };
    
    const retention = retentionRates[pivot.id] ?? 0.3;
    const originalCustomerCount = this.customers.length;
    const originalPipelineCount = this.pipeline.length;
    
    if (originalCustomerCount > 0) {
      // Determine which customers stay
      const keptCustomers = [];
      const lostCustomers = [];
      
      this.customers.forEach(customer => {
        // Strategic customers are more likely to stay (they're invested)
        const customerRetention = customer.strategic ? Math.min(1, retention + 0.3) : retention;
        
        if (Math.random() < customerRetention) {
          // Customer stays but satisfaction drops (uncertainty)
          customer.satisfaction = Math.max(0.3, customer.satisfaction - 0.2);
          keptCustomers.push(customer);
        } else {
          lostCustomers.push(customer);
        }
      });
      
      this.customers = keptCustomers;
      
      if (lostCustomers.length > 0) {
        const lostRevenue = lostCustomers.reduce((sum, c) => sum + c.quarterlyRevenue, 0);
        this.log(`ğŸ“‰ Pivot impact: Lost ${lostCustomers.length} customer(s) (-Â£${Math.round(lostRevenue)}k/q)`);
        
        // Track in journey
        this.journeyEvents.push({
          quarter: this.turn,
          type: 'pivot_customer_loss',
          description: `Lost ${lostCustomers.length} customers due to pivot`,
          customersLost: lostCustomers.length,
          revenueLost: lostRevenue
        });
      }
      
      if (keptCustomers.length > 0) {
        this.log(`ğŸ¤ ${keptCustomers.length} customer(s) committed to the new direction`);
      }
    }
    
    // Pipeline deals are mostly invalidated by pivots (except tech pivot)
    if (this.pipeline.length > 0) {
      const pipelineRetention = pivot.id === 'tech' ? 0.5 : 0.1;
      const keptPipeline = this.pipeline.filter(() => Math.random() < pipelineRetention);
      const lostDeals = this.pipeline.length - keptPipeline.length;
      
      if (lostDeals > 0) {
        this.log(`ğŸ“‹ ${lostDeals} pipeline deal(s) no longer relevant after pivot`);
      }
      
      this.pipeline = keptPipeline;
    }
    
    // Grant applications - research pivots might preserve these
    if (this.grantApplications.length > 0) {
      const grantRetention = (pivot.id === 'tech' || pivot.id === 'niche') ? 0.6 : 0.2;
      const keptGrants = this.grantApplications.filter(() => Math.random() < grantRetention);
      const lostGrants = this.grantApplications.length - keptGrants.length;
      
      if (lostGrants > 0) {
        this.log(`ğŸ“ ${lostGrants} grant application(s) withdrawn - no longer aligned`);
      }
      
      this.grantApplications = keptGrants;
    }
    
    // Check if pivot changes the revenue MODEL (more dramatic pivots)
    // This would happen if the milestone implies a different go-to-market
    // For now, we'll flag this for the player but not auto-change
    if (pivot.id === 'customer' || pivot.id === 'pivot') {
      this.log(`ğŸ’¡ Consider: Your go-to-market strategy may need to evolve with this pivot`);
    }
  }
  
  updateCompanyNameDisplays() {
    const nameEl = document.getElementById("companyDisplay");
    if (nameEl) nameEl.textContent = this.company.name;
    
    const locNameEl = document.getElementById("locationVentureName");
    if (locNameEl) locNameEl.textContent = this.company.name;
  }
  
  getLeadingRival() {
    const playerMilestones = this.completedMilestones.length;
    return this.rivals.find(r => {
      const rivalMilestones = r.milestones?.filter(m => m.status === 'complete').length || 0;
      return rivalMilestones > playerMilestones;
    }) || null;
  }
}

// Global sound toggle function
function toggleSound() {
  const enabled = soundManager.toggle();
  document.getElementById("soundIcon").textContent = enabled ? "ğŸ”Š" : "ğŸ”‡";
}

const game = new Game();
</script>

</body>
</html>

